import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as l}from"./index.DAubIFHI.js";import{f as P,g as Z,a as S,b as z,c as A}from"./formatters.P2c1JhjN.js";import{O as w,f as O,C as y,g as I,X as T,T as N,D as C,R as H}from"./x.BNoxzAwW.js";import{c as h}from"./utils.CDN07tui.js";function K({text:s,words:a=2}){const[n,o]=l.useState(!1),r=l.useRef(null);l.useEffect(()=>{if(!n)return;const i=c=>{r.current&&!r.current.contains(c.target)&&o(!1)};return document.addEventListener("mousedown",i),()=>document.removeEventListener("mousedown",i)},[n]);const d=s.split(" ").slice(0,a).join(" ")+(s.split(" ").length>a?"...":"");return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-1 cursor-pointer text-muted-foreground hover:text-foreground transition",onClick:()=>o(!0),children:[e.jsx("span",{className:"truncate",children:d}),e.jsx("span",{className:"text-xs opacity-70",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"16",height:"16",children:e.jsx("path",{d:"m12,16.074c-.4,0-.777-.156-1.061-.439l-5.281-5.281.707-.707,5.281,5.281c.189.189.518.189.707,0l5.281-5.281.707.707-5.281,5.281c-.283.283-.66.439-1.061.439Z"})})})]}),n&&e.jsx("div",{className:"fixed inset-0 bg-black/40 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-in fade-in duration-150",children:e.jsxs("div",{ref:r,className:"bg-white dark:bg-neutral-900 p-6 rounded-xl shadow-xl max-w-md w-full animate-in zoom-in duration-200",children:[e.jsx("h2",{className:"text-lg font-semibold mb-3",children:"Descripción completa"}),e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-line leading-relaxed",children:s}),e.jsx("button",{onClick:()=>o(!1),className:"mt-4 px-4 py-2 rounded-lg bg-gray-200 text-black hover:text-white hover:bg-mainColor w-full transition",children:"Cerrar"})]})})]})}const V=H,F=O,k=l.forwardRef(({className:s,...a},n)=>e.jsx(w,{ref:n,className:h("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...a}));k.displayName=w.displayName;const _=l.forwardRef(({className:s,children:a,...n},o)=>e.jsxs(F,{children:[e.jsx(k,{}),e.jsxs(y,{ref:o,className:h("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...n,children:[a,e.jsxs(I,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(T,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));_.displayName=y.displayName;const D=({className:s,...a})=>e.jsx("div",{className:h("flex flex-col space-y-1.5 text-center sm:text-left",s),...a});D.displayName="DialogHeader";const M=l.forwardRef(({className:s,...a},n)=>e.jsx(N,{ref:n,className:h("text-lg font-semibold leading-none tracking-tight",s),...a}));M.displayName=N.displayName;const R=l.forwardRef(({className:s,...a},n)=>e.jsx(C,{ref:n,className:h("text-sm text-muted-foreground",s),...a}));R.displayName=C.displayName;function B({open:s,onClose:a,fileName:n,expenseId:o,mime:r}){const i=`undefined/api/expense/${o}/receipt`,c=r==="application/pdf"||(n?.toLowerCase().endsWith(".pdf")??!1),u=r?.startsWith("image/")??!1;return e.jsx(V,{open:s,onOpenChange:a,children:e.jsxs(_,{className:"max-w-5xl h-[80vh] flex flex-col",children:[e.jsxs(D,{children:[e.jsx(M,{className:"flex justify-between items-center p-2",children:e.jsx("span",{children:n})}),e.jsx(R,{className:"sr-only",children:"Vista previa del comprobante en PDF."})]}),e.jsx("div",{className:"flex-1 w-full h-full border rounded overflow-hidden",children:c?e.jsx("iframe",{src:i,className:"w-full h-full",title:n??"PDF"}):u?e.jsx("img",{src:i,alt:n??"Imagen",className:"w-full max-h-full object-contain"}):e.jsxs("div",{className:"p-4 text-sm text-gray-600 text-center",children:["No se puede previsualizar este tipo de archivo.",e.jsx("div",{className:"mt-2",children:e.jsx("a",{href:i,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 underline",children:"Abrir/descargar"})})]})})]})})}function W({fileName:s,expenseId:a,mime:n}){const[o,r]=l.useState(!1);return s?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"text-xs truncate max-w-[120px]",children:s??"Comprobante"}),e.jsx("button",{type:"button",className:"text-blue-600 hover:text-blue-800",onClick:()=>r(!0),title:"Ver comprobante",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",id:"Outline",viewBox:"0 0 24 24",width:"14",height:"14",children:[e.jsx("path",{d:"M23.271,9.419C21.72,6.893,18.192,2.655,12,2.655S2.28,6.893.729,9.419a4.908,4.908,0,0,0,0,5.162C2.28,17.107,5.808,21.345,12,21.345s9.72-4.238,11.271-6.764A4.908,4.908,0,0,0,23.271,9.419Zm-1.705,4.115C20.234,15.7,17.219,19.345,12,19.345S3.766,15.7,2.434,13.534a2.918,2.918,0,0,1,0-3.068C3.766,8.3,6.781,4.655,12,4.655s8.234,3.641,9.566,5.811A2.918,2.918,0,0,1,21.566,13.534Z"}),e.jsx("path",{d:"M12,7a5,5,0,1,0,5,5A5.006,5.006,0,0,0,12,7Zm0,8a3,3,0,1,1,3-3A3,3,0,0,1,12,15Z"})]})})]}),e.jsx(B,{open:o,onClose:()=>r(!1),fileName:s??void 0,expenseId:a,mime:n??void 0})]}):e.jsx("span",{className:"text-gray-400",children:"—"})}function $({data:s,columns:a,visibleColumns:n,onVisibleColumnsChange:o,isActionMode:r=!1,onEdit:d,onDelete:i}){const[c,u]=l.useState({open:!1}),m=t=>t.accessorKey||t.key,[E,X]=l.useState(Object.fromEntries(a.map(t=>[m(t),!0]))),f=n??E,g={date:t=>A(t),money:t=>z(t),yesno:t=>t?"Sí":"No",paymentMethod:t=>S(t),general:t=>Z(t),phone:t=>P(t),description:t=>e.jsx(K,{text:t}),receipt:(t,x)=>e.jsx(W,{fileName:x.receipt_original_name,expenseId:x.expense_id,mime:x.receipt_mime})},L=t=>t.render&&typeof t.render=="function"?t.render:t.renderKey&&g[t.renderKey]?g[t.renderKey]:null;return e.jsx("div",{className:"w-full text-center",children:e.jsx("div",{className:"h-80 bg-white overflow-auto  border rounded-lg relative",children:e.jsxs("table",{className:"w-full table-auto",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[a.filter(t=>f[m(t)]).map(t=>e.jsx("th",{className:"sticky top-0 z-10 bg-gray-100 px-4 py-2 font-semibold text-gray-700 border-b",children:t.header},m(t))),r&&e.jsx("th",{className:`
                  sticky top-0 right-0
                  z-30
                  bg-gray-200
                  px-2
                  shadow-[inset_10px_0_10px_-10px_rgba(0,0,0,0.25)]
                `,children:"Acción"})]})}),e.jsx("tbody",{children:s.map((t,x)=>e.jsxs("tr",{className:"bg-white hover:bg-gray-50 border-b align-middle",children:[a.filter(p=>f[m(p)]).map(p=>{const j=m(p),v=t[j],b=L(p);return e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:b?b(v,t):String(v??"")},j)}),r&&e.jsx("td",{className:`
                    sticky right-0
                    z-20
                    bg-white
                    shadow-[inset_10px_0_10px_-10px_rgba(0,0,0,0.15)]
                  `,children:e.jsxs("div",{className:"flex gap-2 justify-center items-center",children:[d&&e.jsx("button",{className:"w-8 h-8 flex items-center justify-center rounded hover:bg-blue-100 text-blue-600 hover:text-blue-800",onClick:()=>d(t),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",id:"Layer_1","data-name":"Layer 1",viewBox:"0 0 24 24",width:"20",height:"20",children:e.jsx("path",{d:"M22.94,1.061c-1.368-1.367-3.76-1.365-5.124,0L1.611,17.265c-1.039,1.04-1.611,2.421-1.611,3.89v2.346c0,.276,.224,.5,.5,.5H2.846c1.47,0,2.851-.572,3.889-1.611L22.86,6.265c.579-.581,.953-1.262,1.08-1.972,.216-1.202-.148-2.381-1-3.232ZM6.028,21.682c-.85,.851-1.979,1.318-3.182,1.318H1v-1.846c0-1.202,.468-2.332,1.318-3.183L15.292,4.999l3.709,3.709L6.028,21.682ZM22.956,4.116c-.115,.642-.5,1.138-.803,1.441l-2.444,2.444-3.709-3.709,2.525-2.525c.986-.988,2.718-.99,3.709,0,.617,.617,.88,1.473,.723,2.349Z"})})}),i&&e.jsx("button",{className:"w-8 h-8 flex items-center justify-center rounded hover:bg-red-100 text-red-600 hover:text-red-800",onClick:()=>i(t),children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",id:"Layer_1","data-name":"Layer 1",viewBox:"0 0 24 24",width:"20",height:"20",children:e.jsx("path",{d:"M21.5,4h-3.551c-.252-2.244-2.139-4-4.449-4h-3c-2.31,0-4.197,1.756-4.449,4H2.5c-.276,0-.5,.224-.5,.5s.224,.5,.5,.5h1.5v14.5c0,2.481,2.019,4.5,4.5,4.5h7c2.481,0,4.5-2.019,4.5-4.5V5h1.5c.276,0,.5-.224,.5-.5s-.224-.5-.5-.5ZM10.5,1h3c1.758,0,3.204,1.308,3.449,3H7.051c.245-1.692,1.691-3,3.449-3Zm8.5,18.5c0,1.93-1.57,3.5-3.5,3.5h-7c-1.93,0-3.5-1.57-3.5-3.5V5h14v14.5ZM10,10.5v7c0,.276-.224,.5-.5,.5s-.5-.224-.5-.5v-7c0-.276,.224-.5,.5-.5s.5,.224,.5,.5Zm5,0v7c0,.276-.224,.5-.5,.5s-.5-.224-.5-.5v-7c0-.276,.224-.5,.5-.5s.5,.224,.5,.5Z"})})})]})})]},t.id??x))})]})})})}function Y({data:s,columns:a,onEdit:n,onDelete:o}){const[r,d]=l.useState(null);return l.useEffect(()=>{const i=c=>{d(c.detail??null)};return window.addEventListener("action-mode-change",i),()=>window.removeEventListener("action-mode-change",i)},[]),e.jsx("div",{children:e.jsx($,{data:s,columns:a,isActionMode:!!r,onEdit:r==="edit"?i=>n?.(i):void 0,onDelete:r==="delete"?i=>o?.(i):void 0})})}export{Y as T};
