import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{C as V,L as s,I as n}from"./input.MG_-FBsV.js";import{B as p}from"./button.Dcm3U4MY.js";import{SheetFormExpense as Z}from"./SheetFormExpense.DjwUHo5V.js";import{r as o}from"./index.DAubIFHI.js";import{c as k}from"./clientAPI.Cs9ptr1e.js";import{D as j,a as v,C as f,b as y,c as b}from"./dropdown-menu.BysoY2q6.js";import{a as J,p as K}from"./phoneCategories.BdKgBTqW.js";import{C as Q}from"./checkbox.Cg_f7469.js";import"./x.BNoxzAwW.js";import"./index.C7LY66bV.js";import"./index.64NwWGNV.js";import"./utils.CDN07tui.js";import"./paymentMethods.QdXxarE_.js";import"./index.Dym27YVG.js";const U=[{value:"64",label:"64 GB"},{value:"128",label:"128 GB"},{value:"256",label:"256 GB"},{value:"512",label:"512 GB"},{value:"1024",label:"1 TB"}],W=()=>{const u=new Date;return new Date(u.getTime()-u.getTimezoneOffset()*6e4)};function he({isOpen:u,onClose:l,zIndex:A,depth:_=0}){const[M,C]=o.useState(!1),P=u!==void 0?u:M,S=t=>{if(l){t||l();return}else C(t)},[g,L]=o.useState(null),[a,i]=o.useState({datetime:"",name:"",brand:"",imei:"",device_type:"Tipo",battery_health:"",storage_capacity:"Almacenamiento",color:"",category:"Categoria",price:"",buy_cost:"",deposit:"",sold:!1,trade_in:!1});o.useEffect(()=>{const t=d=>{const r=d.detail;L(r);const c=r.datetime instanceof Date?r.datetime.toISOString():String(r.datetime),[x,m]=c.split("T");D(x),T(m.slice(0,5)),i({datetime:String(r.datetime)??"",name:r.name??"",brand:r.brand??"",imei:r.imei?String(r.imei):"",device_type:r.device_type??"",battery_health:r.battery_health?String(r.battery_health):"",storage_capacity:r.storage_capacity?String(r.storage_capacity):"",color:r.color??"",category:r.category??"",price:r.price??"",buy_cost:r.buy_cost??"",deposit:r.deposit??"",sold:r.sold??!1,trade_in:r.trade_in??!1}),C(!0)};return window.addEventListener("open-edit-phone",t),()=>window.removeEventListener("open-edit-phone",t)},[]);const w=W(),[N,D]=o.useState(w.toISOString().split("T")[0]),[E,T]=o.useState(w.toISOString().slice(11,16)),[I,O]=o.useState(!1),[h,q]=o.useState(!1),$=()=>{q(!1)};o.useEffect(()=>{if(g)return;const t=parseFloat(a.buy_cost);if(t>0&&!h&&!I){const d=setTimeout(()=>{q(!0),O(!0)},400);return()=>clearTimeout(d)}t<=0&&O(!1)},[a.buy_cost,h,I]);const G=async t=>{t.preventDefault(),t.stopPropagation();const d=`${N}T${E}:00Z`;alert("Submitting phone with datetime:"+d);const r={...a,datetime:d,battery_health:Number(a.battery_health),storage_capacity:Number(a.storage_capacity),trade_in:B};try{let c;g?c=await k.phone({id:g.device_id}).put(r):c=await k.phone.post(r);const{data:x,error:m}=c;if(m)throw m.value;const F=x?.[0]?.device_id;l?F?l(String(F)):l():window.location.reload()}catch(c){console.error("Error al cargar celular:",c),alert("Error al cargar celular")}},z=`Compra de ${a.brand} ${a.name}`.trim(),B=l!==void 0,H=_*380,R=_+1;return e.jsxs(e.Fragment,{children:[e.jsx("form",{id:"form-phone",onSubmit:G,children:e.jsxs(V,{title:"Agregar Celular",description:"Agregar un celular al inventario",onInteractOutside:t=>{t.preventDefault()},style:B?{right:`${H}px`}:{},side:"right",isOpen:P,onOpenChange:S,zIndex:A||(l?50:10),footer:e.jsxs(e.Fragment,{children:[e.jsx(p,{type:"submit",form:"form-phone",children:"Agregar"}),e.jsx(p,{variant:"outline",onClick:()=>S(!1),children:"Cancelar"})]}),children:[e.jsxs("div",{className:"grid gap-3",children:[e.jsx(s,{children:"Fecha y hora"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(n,{type:"date",value:N,onChange:t=>D(t.target.value)}),e.jsx(n,{type:"time",value:E,onChange:t=>T(t.target.value)})]})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(s,{children:"Marca"}),e.jsx(n,{value:a.brand,onChange:t=>i({...a,brand:t.target.value}),required:!0})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(s,{children:"Modelo"}),e.jsx(n,{value:a.name,onChange:t=>i({...a,name:t.target.value}),required:!0})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(s,{children:"IMEI"}),e.jsx(n,{value:a.imei,onChange:t=>i({...a,imei:t.target.value}),required:!0})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(s,{children:"Tipo de producto"}),e.jsxs(j,{children:[e.jsx(v,{asChild:!0,children:e.jsxs(p,{variant:"outline",className:"ml-auto w-full justify-between font-normal",children:[a.device_type," ",e.jsx(f,{})]})}),e.jsx(y,{align:"end",children:J.map(t=>e.jsx(b,{onClick:()=>i({...a,device_type:t.value}),children:t.label},t.value))})]})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(s,{children:"Condición Batería"}),e.jsx(n,{type:"number",value:a.battery_health,onChange:t=>i({...a,battery_health:t.target.value}),required:!0})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(s,{children:"Almacenamiento"}),e.jsxs(j,{children:[e.jsx(v,{asChild:!0,children:e.jsxs(p,{variant:"outline",className:"ml-auto w-full justify-between font-normal",children:[a.storage_capacity," ",e.jsx(f,{})]})}),e.jsx(y,{align:"end",children:U.map(t=>e.jsx(b,{onClick:()=>i({...a,storage_capacity:t.value}),children:t.label},t.value))})]})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(s,{children:"Color"}),e.jsx(n,{value:a.color,onChange:t=>i({...a,color:t.target.value}),required:!0})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(s,{children:"Categoría"}),e.jsxs(j,{children:[e.jsx(v,{asChild:!0,children:e.jsxs(p,{variant:"outline",className:"ml-auto w-full justify-between font-normal",children:[a.category," ",e.jsx(f,{})]})}),e.jsx(y,{align:"end",children:K.map(t=>e.jsx(b,{onClick:()=>i({...a,category:t.value}),children:t.label},t.value))})]})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(s,{children:"Precio de venta"}),e.jsx(n,{type:"number",value:a.price,onChange:t=>i({...a,price:t.target.value}),required:!0})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(s,{children:"Costo de compra"}),e.jsx(n,{type:"number",value:a.buy_cost,onChange:t=>i({...a,buy_cost:t.target.value}),required:!0})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(s,{children:"Deposito"}),e.jsx(n,{value:a.deposit,onChange:t=>i({...a,deposit:t.target.value}),required:!0})]}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx(s,{children:"Vendido"}),e.jsx(Q,{checked:a.sold,onCheckedChange:t=>i({...a,sold:!!t})})]})]})}),h&&e.jsx(Z,{isOpen:h,onClose:$,zIndex:50,injectedAmount:a.buy_cost,injectedDescription:z,depth:R})]})}export{he as SheetFormPhone};
