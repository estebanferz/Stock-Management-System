import{j as t}from"./jsx-runtime.D_zvdyIk.js";import{r as i}from"./index.DAubIFHI.js";import{c as h}from"./clientAPI.Cs9ptr1e.js";import{T as N}from"./TableWrapper.DH7mLV_p.js";import"./schema.Fil2OqHt.js";import"./formatters.P2c1JhjN.js";import"./parsePhoneNumber.CAsXhxWl.js";import"./x.BNoxzAwW.js";import"./index.C7LY66bV.js";import"./index.64NwWGNV.js";import"./utils.CDN07tui.js";function w({data:d,columns:l}){const o=i.useCallback(c=>{console.log("ENTRA HANDLEEDIT");const m=new CustomEvent("open-edit-sale",{detail:c});window.dispatchEvent(m)},[]),r=i.useCallback(async c=>{await h.sale({id:c.sale_id}).delete(),window.location.reload()},[]);return t.jsx(N,{data:d,columns:l,onEdit:o,onDelete:r})}function E(d){const l={};return d.date&&(l.date=d.date),d.client_id&&(l.client_id=d.client_id),d.seller_id&&(l.seller_id=d.seller_id),d.device_id&&(l.device_id=d.device_id),d.deleted==="active"&&(l.is_deleted="false"),d.deleted==="deleted"&&(l.is_deleted="true"),l}function R({initialSales:d,clients:l,sellers:o,phones:r,columns:c}){const[m,j]=i.useState(d),[y,u]=i.useState(!1),[p,T]=i.useState(null),[s,n]=i.useState({date:"",client_id:"",seller_id:"",device_id:"",deleted:"active"}),x=i.useMemo(()=>new Map(l.map(e=>[e.client_id,e.name])),[l]),v=i.useMemo(()=>new Map(o.map(e=>[e.seller_id,e.name])),[o]),g=i.useMemo(()=>new Map(r.map(e=>[e.device_id,e.name])),[r]),f=i.useMemo(()=>m.map(e=>({...e,client_name:x.get(e.client_id)??"—",seller_name:v.get(e.seller_id)??"—",device_name:g.get(e.device_id)??"—"})),[m,x,v,g]),_=i.useMemo(()=>E(s),[s]);i.useEffect(()=>{const e=setTimeout(async()=>{u(!0);const a=await h.sale.all.get({query:_});j(Array.isArray(a.data)?a.data:[]),u(!1)},300);return()=>clearTimeout(e)},[_]);function b(){n({date:"",client_id:"",seller_id:"",device_id:"",deleted:"active"})}return t.jsx("div",{className:"w-full",children:t.jsx("div",{className:"mx-auto max-w-6xl rounded-2xl border bg-white p-4 shadow-lg",children:t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2 lg:grid-cols-5",children:[t.jsx("input",{type:"date",value:s.date,onChange:e=>n(a=>({...a,date:e.target.value})),className:"rounded-lg border px-3 py-2 text-sm"}),t.jsxs("select",{value:s.client_id,onChange:e=>n(a=>({...a,client_id:e.target.value})),className:"rounded-lg border px-3 py-2 text-sm",children:[t.jsx("option",{value:"",children:"Todos los clientes"}),l.map(e=>t.jsx("option",{value:e.client_id,children:e.name},e.client_id))]}),t.jsxs("select",{value:s.seller_id,onChange:e=>n(a=>({...a,seller_id:e.target.value})),className:"rounded-lg border px-3 py-2 text-sm",children:[t.jsx("option",{value:"",children:"Todos los vendedores"}),o.map(e=>t.jsx("option",{value:e.seller_id,children:e.name},e.seller_id))]}),t.jsxs("select",{value:s.device_id,onChange:e=>n(a=>({...a,device_id:e.target.value})),className:"rounded-lg border px-3 py-2 text-sm",children:[t.jsx("option",{value:"",children:"Todos los dispositivos"}),r.map(e=>t.jsx("option",{value:e.device_id,children:e.name},e.device_id))]}),t.jsxs("select",{value:s.deleted,onChange:e=>n(a=>({...a,deleted:e.target.value})),className:"rounded-lg border px-3 py-2 text-sm",children:[t.jsx("option",{value:"active",children:"Activos"}),t.jsx("option",{value:"deleted",children:"Eliminados"}),t.jsx("option",{value:"all",children:"Todos"})]})]}),t.jsx("div",{className:"my-4",children:t.jsx(w,{data:f,columns:c})}),t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600",children:[y?"Buscando...":`${m.length} resultado(s)`,p?t.jsx("span",{className:"text-red-600",children:p}):null]}),t.jsx("button",{className:"rounded-lg border px-3 py-2 text-sm font-medium hover:bg-gray-50",onClick:b,type:"button",children:"Limpiar filtros"})]})]})})})}export{R as SalesPageManager};
