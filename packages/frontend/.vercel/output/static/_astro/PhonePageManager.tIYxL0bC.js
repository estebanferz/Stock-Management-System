import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r}from"./index.DAubIFHI.js";import{c as x}from"./clientAPI.Cs9ptr1e.js";import{p as h,a as y}from"./phoneCategories.BdKgBTqW.js";import{T as f}from"./TableWrapper.DH7mLV_p.js";import"./schema.Fil2OqHt.js";import"./formatters.P2c1JhjN.js";import"./parsePhoneNumber.CAsXhxWl.js";import"./x.BNoxzAwW.js";import"./index.C7LY66bV.js";import"./index.64NwWGNV.js";import"./utils.CDN07tui.js";function b({data:l,columns:o}){const s=r.useCallback(c=>{const u=new CustomEvent("open-edit-phone",{detail:c});window.dispatchEvent(u)},[]),d=r.useCallback(async c=>{await x.phone({id:c.device_id}).delete(),window.location.reload()},[]);return e.jsx(f,{data:l,columns:o,onEdit:s,onDelete:d})}function j(l){const o={};l.device.trim()&&(o.device=l.device.trim()),l.imei.trim()&&(o.imei=l.imei.trim());const s=l.storage_capacity.trim();s&&(o.storage_capacity=s);const d=l.battery_health.trim();return d&&(o.battery_health=d),l.color.trim()&&(o.color=l.color.trim()),l.category.trim()&&(o.category=l.category.trim()),l.device_type.trim()&&(o.device_type=l.device_type.trim()),l.trade_in!=="all"&&(o.trade_in=l.trade_in),l.sold==="sold"&&(o.sold="true"),l.sold==="available"&&(o.sold="false"),l.deleted==="active"&&(o.is_deleted="false"),l.deleted==="deleted"&&(o.is_deleted="true"),o}function P({initialData:l,columns:o}){const[s,d]=r.useState(l),[c,u]=r.useState(!1),[p,m]=r.useState(null),[n,i]=r.useState({device:"",imei:"",storage_capacity:"",battery_health:"",color:"",category:"",device_type:"",trade_in:"all",sold:"all",deleted:"active"}),g=r.useMemo(()=>j(n),[n]);r.useEffect(()=>{const a=setTimeout(async()=>{u(!0),m(null);try{const t=await x.phone.all.get({query:g});d(t.data||[])}catch(t){m(t?.message??"Error buscando dispositivos")}finally{u(!1)}},350);return()=>clearTimeout(a)},[g]);function v(){i({device:"",imei:"",storage_capacity:"",battery_health:"",color:"",category:"",device_type:"",trade_in:"all",sold:"all",deleted:"active"})}return e.jsx("div",{className:"w-full",children:e.jsx("div",{className:"mx-auto max-w-6xl",children:e.jsx("div",{className:"rounded-2xl border bg-white p-4 shadow-lg",children:e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2 lg:grid-cols-5",children:[e.jsx("input",{className:"w-full rounded-lg border px-3 py-2 text-sm outline-none focus:ring-2",placeholder:"Marca / Modelo",value:n.device,onChange:a=>i(t=>({...t,device:a.target.value}))}),e.jsx("input",{className:"w-full rounded-lg border px-3 py-2 text-sm outline-none focus:ring-2",placeholder:"IMEI (exacto)",value:n.imei,onChange:a=>i(t=>({...t,imei:a.target.value}))}),e.jsx("input",{type:"number",inputMode:"numeric",className:"w-full rounded-lg border px-3 py-2 text-sm outline-none focus:ring-2",placeholder:"Almacenamiento (GB)",value:n.storage_capacity,onChange:a=>i(t=>({...t,storage_capacity:a.target.value}))}),e.jsx("input",{type:"number",inputMode:"numeric",className:"w-full rounded-lg border px-3 py-2 text-sm outline-none focus:ring-2",placeholder:"Batería ≥ %",value:n.battery_health,onChange:a=>i(t=>({...t,battery_health:a.target.value}))}),e.jsx("input",{className:"w-full rounded-lg border px-3 py-2 text-sm outline-none focus:ring-2",placeholder:"Color",value:n.color,onChange:a=>i(t=>({...t,color:a.target.value}))}),e.jsxs("select",{className:"w-full rounded-lg border px-3 py-2 text-sm outline-none focus:ring-2",value:n.category,onChange:a=>i(t=>({...t,category:a.target.value})),children:[e.jsx("option",{value:"",children:"Todas las categorías"}),h.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]}),e.jsxs("select",{className:"w-full rounded-lg border px-3 py-2 text-sm outline-none focus:ring-2",value:n.device_type,onChange:a=>i(t=>({...t,device_type:a.target.value})),children:[e.jsx("option",{value:"",children:"Todos los tipos"}),y.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))]}),e.jsxs("select",{className:"w-full rounded-lg border px-3 py-2 text-sm outline-none focus:ring-2",value:n.trade_in,onChange:a=>i(t=>({...t,trade_in:a.target.value})),children:[e.jsx("option",{value:"all",children:"Trade-in y no"}),e.jsx("option",{value:"true",children:"Trade-in"}),e.jsx("option",{value:"false",children:"No Trade-in"})]}),e.jsxs("select",{className:"w-full rounded-lg border px-3 py-2 text-sm outline-none focus:ring-2",value:n.sold,onChange:a=>i(t=>({...t,sold:a.target.value})),children:[e.jsx("option",{value:"available",children:"Disponibles"}),e.jsx("option",{value:"sold",children:"Vendidos"}),e.jsx("option",{value:"all",children:"Vendidos y disponibles"})]}),e.jsxs("select",{className:"w-full rounded-lg border px-3 py-2 text-sm outline-none focus:ring-2",value:n.deleted,onChange:a=>i(t=>({...t,deleted:a.target.value})),children:[e.jsx("option",{value:"active",children:"Activos"}),e.jsx("option",{value:"deleted",children:"Eliminados"}),e.jsx("option",{value:"all",children:"Todos"})]})]}),e.jsx("div",{className:"my-4",children:e.jsx(b,{data:s,columns:o})}),e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600",children:[c?"Buscando...":`${s.length} resultado(s)`,p?e.jsx("span",{className:"text-red-600",children:p}):null]}),e.jsx("button",{className:"rounded-lg border px-3 py-2 text-sm font-medium hover:bg-gray-50",onClick:v,type:"button",children:"Limpiar filtros"})]})]})})})})}export{P as PhonesPageManager};
