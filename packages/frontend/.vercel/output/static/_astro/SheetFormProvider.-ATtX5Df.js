import{j as r}from"./jsx-runtime.D_zvdyIk.js";import{C as I,L as c,I as l,S as O}from"./input.MG_-FBsV.js";import{B as b}from"./button.Dcm3U4MY.js";import{r as p}from"./index.DAubIFHI.js";import{c as _}from"./clientAPI.Cs9ptr1e.js";import{p as F}from"./parsePhoneNumber.CAsXhxWl.js";import"./x.BNoxzAwW.js";import"./index.C7LY66bV.js";import"./index.64NwWGNV.js";import"./utils.CDN07tui.js";function E(o){if(!o)return null;const n=F(o,"AR");return!n||!n.isValid()?null:n.format("E.164")}function V({isOpen:o,onClose:n,zIndex:N}){const[w,h]=p.useState(!1),S=o!==void 0?o:w,v=e=>{n?e||n():h(e)},[u,P]=p.useState(null),[s,t]=p.useState({name:"",email:"",phone_number:"",address_st:"",address_number:""});p.useEffect(()=>{const e=m=>{const a=m.detail;P(a);const i=(a.address??"").match(/^(.*?)(\d+)\s*$/);t({name:a.name??"",email:a.email??"",phone_number:a.phone_number??"",address_st:i?i[1].trim():"",address_number:i?i[2]:""}),h(!0)};return window.addEventListener("open-edit-provider",e),()=>window.removeEventListener("open-edit-provider",e)},[]);const C=async e=>{e.preventDefault(),e.stopPropagation();const m=E(s.phone_number);if(!m){alert("El número de teléfono es inválido.");return}const{address_st:a,address_number:g,...i}=s,f={...i,address:`${a} ${g}`.trim(),phone_number:m};try{let d;u?d=await _.provider({id:u.provider_id}).put(f):d=await _.provider.post(f);const{data:A,error:x}=d;if(x)throw x.value;const j=A?.[0]?.provider_id;n?.(j?String(j):void 0),window.location.reload()}catch(d){console.error(d),n?.()}},y=n!==void 0?"right-[380px]":"";return r.jsx("form",{id:"form-provider",onSubmit:C,children:r.jsxs(I,{title:"Agregar Proveedor",description:"Agregar proveedor al sistema",className:`${y}`,side:"right",isOpen:S,onOpenChange:v,isModal:!n,zIndex:N||(n?50:10),footer:r.jsxs(r.Fragment,{children:[r.jsx(b,{type:"submit",form:"form-provider",children:u?"Guardar":"Agregar"}),r.jsx(O,{asChild:!0,children:r.jsx(b,{variant:"outline",onClick:()=>v(!1),children:"Cancelar"})})]}),children:[r.jsxs("div",{className:"grid gap-3",children:[r.jsx(c,{children:"Nombre"}),r.jsx(l,{value:s.name,onChange:e=>t({...s,name:e.target.value}),required:!0})]}),r.jsxs("div",{className:"grid gap-3",children:[r.jsx(c,{children:"Email"}),r.jsx(l,{type:"email",value:s.email,onChange:e=>t({...s,email:e.target.value}),required:!0})]}),r.jsxs("div",{className:"grid gap-3",children:[r.jsx(c,{children:"Telefono"}),r.jsx(l,{value:s.phone_number,onChange:e=>t({...s,phone_number:e.target.value.replace(/[^\d+]/g,"")}),onBlur:()=>{const e=E(s.phone_number);e&&t({...s,phone_number:e})},inputMode:"tel",placeholder:"+54 9 11 1234 5678",required:!0})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[r.jsx("div",{className:"grid gap-3",children:r.jsx(l,{value:s.address_st,onChange:e=>t({...s,address_st:e.target.value})})}),r.jsx("div",{className:"grid gap-3",children:r.jsx(l,{type:"number",value:s.address_number,onChange:e=>t({...s,address_number:e.target.value})})})]})]})})}export{V as SheetFormProvider};
