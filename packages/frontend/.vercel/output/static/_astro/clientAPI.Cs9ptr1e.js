var F=class extends Error{constructor(e,t){super(t+""),this.status=e,this.value=t}},$=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,q=/(?:Sun|Mon|Tue|Wed|Thu|Fri|Sat)\s(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s\d{2}\s\d{4}\s\d{2}:\d{2}:\d{2}\sGMT(?:\+|-)\d{4}\s\([^)]+\)/,P=/^(?:(?:(?:(?:0?[1-9]|[12][0-9]|3[01])[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:19|20)\d{2})|(?:(?:19|20)\d{2}[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:0?[1-9]|[12][0-9]|3[01]))))(?:\s(?:1[012]|0?[1-9]):[0-5][0-9](?::[0-5][0-9])?(?:\s[AP]M)?)?$/,B=e=>e.trim().length!==0&&!Number.isNaN(Number(e)),T=e=>{if(typeof e!="string")return null;let t=e.replace(/"/g,"");if($.test(t)||q.test(t)||P.test(t)){let r=new Date(t);if(!Number.isNaN(r.getTime()))return r}return null},H=e=>{let t=e.charCodeAt(0),r=e.charCodeAt(e.length-1);return t===123&&r===125||t===91&&r===93},I=e=>JSON.parse(e,(t,r)=>T(r)||r),O=e=>{if(!e)return e;if(B(e))return+e;if(e==="true")return!0;if(e==="false")return!1;let t=T(e);if(t)return t;if(H(e))try{return I(e)}catch{}return e},Z=e=>{let t=e.data.toString();return t==="null"?null:O(t)},G=class{constructor(e){this.url=e,this.ws=new WebSocket(e)}ws;send(e){return Array.isArray(e)?(e.forEach(t=>this.send(t)),this):(this.ws.send(typeof e=="object"?JSON.stringify(e):e.toString()),this)}on(e,t,r){return this.addEventListener(e,t,r)}off(e,t,r){return this.ws.removeEventListener(e,t,r),this}subscribe(e,t){return this.addEventListener("message",e,t)}addEventListener(e,t,r){return this.ws.addEventListener(e,n=>{if(e==="message"){let f=Z(n);t({...n,data:f})}else t(n)},r),this}removeEventListener(e,t,r){return this.off(e,t,r),this}close(){return this.ws.close(),this}},K=["get","post","put","delete","patch","options","head","connect","subscribe"],M=["localhost","127.0.0.1","0.0.0.0"],J=typeof FileList>"u",D=e=>J?e instanceof Blob:e instanceof FileList||e instanceof File,Q=e=>{if(!e)return!1;for(let t in e)if(D(e[t])||Array.isArray(e[t])&&e[t].find(D))return!0;return!1},C=e=>J?e:new Promise(t=>{let r=new FileReader;r.onload=()=>{let n=new File([r.result],e.name,{lastModified:e.lastModified,type:e.type});t(n)},r.readAsArrayBuffer(e)}),A=(e,t,r={},n={})=>{if(Array.isArray(e)){for(let f of e)if(!Array.isArray(f))n=A(f,t,r,n);else{let o=f[0];if(typeof o=="string")n[o.toLowerCase()]=f[1];else for(let[a,p]of o)n[a.toLowerCase()]=p}return n}if(!e)return n;switch(typeof e){case"function":if(e instanceof Headers)return A(e,t,r,n);let f=e(t,r);return f?A(f,t,r,n):n;case"object":if(e instanceof Headers)return e.forEach((o,a)=>{n[a.toLowerCase()]=o}),n;for(let[o,a]of Object.entries(e))n[o.toLowerCase()]=a;return n;default:return n}};async function*_(e){let t=e.body;if(!t)return;let r=t.getReader(),n=new TextDecoder;try{for(;;){let{done:f,value:o}=await r.read();if(f)break;let a=typeof o=="string"?o:n.decode(o);a.includes(`

`)?yield*z(a):yield O(a)}}finally{r.releaseLock()}}function*z(e){let t=e.split(`

`);for(let r of t){if(r.indexOf(":")<=0){r&&(yield O(r));continue}let n=r.split(`
`),f={};for(let o of n){let a=o.indexOf(":");if(a>0){let p=o.slice(0,a).trim(),S=o.slice(a+1).trim();f[p]=O(S)}}yield f}}var N=(e,t,r=[],n)=>new Proxy(()=>{},{get(f,o){return N(e,t,o==="index"?r:[...r,o],n)},apply(f,o,[a,p]){if(!a||p||typeof a=="object"&&Object.keys(a).length!==1||K.includes(r.at(-1))){let S=[...r],v=S.pop(),g="/"+S.join("/"),{fetcher:U=fetch,headers:k,onRequest:h,onResponse:j,fetch:W}=t,m=v==="get"||v==="head"||v==="subscribe";k=A(k,g,p);let R=m?a?.query:p?.query,x="";if(R){let s=(w,y)=>{x+=(x?"&":"?")+`${encodeURIComponent(w)}=${encodeURIComponent(y)}`};for(let[w,y]of Object.entries(R)){if(Array.isArray(y)){for(let d of y)s(w,d);continue}if(y!=null){if(typeof y=="object"){s(w,JSON.stringify(y));continue}s(w,`${y}`)}}}if(v==="subscribe"){let s=e.replace(/^([^]+):\/\//,e.startsWith("https://")?"wss://":e.startsWith("http://")||M.find(w=>e.includes(w))?"ws://":"wss://")+g+x;return new G(s)}return(async()=>{let s={method:v?.toUpperCase(),body:a,...W,headers:k};s.headers={...k,...A(m?a?.headers:p?.headers,g,s)};let w=m&&typeof a=="object"?a.fetch:p?.fetch;if(s={...s,...w},m&&delete s.body,h){Array.isArray(h)||(h=[h]);for(let u of h){let i=await u(g,s);typeof i=="object"&&(s={...s,...i,headers:{...s.headers,...A(i.headers,g,s)}})}}if(m&&delete s.body,Q(a)){let u=new FormData;for(let[i,l]of Object.entries(s.body)){if(Array.isArray(l)){for(let b=0;b<l.length;b++){let E=l[b];u.append(i,E instanceof File?await C(E):E)}continue}if(J){if(Array.isArray(l))for(let b of l)u.append(i,b);else u.append(i,l);continue}if(l instanceof File){u.append(i,await C(l));continue}if(l instanceof FileList){for(let b=0;b<l.length;b++)u.append(i,await C(l[b]));continue}u.append(i,l)}s.body=u}else typeof a=="object"?(s.headers["content-type"]="application/json",s.body=JSON.stringify(a)):a!=null&&(s.headers["content-type"]="text/plain");if(m&&delete s.body,h){Array.isArray(h)||(h=[h]);for(let u of h){let i=await u(g,s);typeof i=="object"&&(s={...s,...i,headers:{...s.headers,...A(i.headers,g,s)}})}}p?.headers?.["content-type"]&&(s.headers["content-type"]=p?.headers["content-type"]);let y=e+g+x,d=await(n?.handle(new Request(y,s))??U(y,s)),c=null,L=null;if(j){Array.isArray(j)||(j=[j]);for(let u of j)try{let i=await u(d.clone());if(i!=null){c=i;break}}catch(i){i instanceof F?L=i:L=new F(422,i);break}}if(c!==null)return{data:c,error:L,response:d,status:d.status,headers:d.headers};switch(d.headers.get("Content-Type")?.split(";")[0]){case"text/event-stream":c=_(d);break;case"application/json":c=JSON.parse(await d.text(),(i,l)=>typeof l!="string"?l:T(l)||l);break;case"application/octet-stream":c=await d.arrayBuffer();break;case"multipart/form-data":let u=await d.formData();c={},u.forEach((i,l)=>{c[l]=i});break;default:c=await d.text().then(O)}return(d.status>=300||d.status<200)&&(L=new F(d.status,c),c=null),{data:c,error:L,response:d,status:d.status,headers:d.headers}})()}return typeof a=="object"?N(e,t,[...r,Object.values(a)[0]],n):N(e,t,r)}}),V=(e,t={})=>typeof e=="string"?(t.keepDomain||(e.includes("://")||(e=(M.find(r=>e.includes(r))?"http://":"https://")+e),e.endsWith("/")&&(e=e.slice(0,-1))),N(e,t)):(typeof window<"u"&&console.warn("Elysia instance server found on client side, this is not recommended for security reason. Use generic type instead."),N("http://e.ly",t,[],e));const X=V(void 0,{fetch:{credentials:"include"}}).api;export{X as c};
