import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{C as q,L as l,I as c}from"./input.MG_-FBsV.js";import{B as j}from"./button.Dcm3U4MY.js";import{r as o}from"./index.DAubIFHI.js";import{D as z,a as B,C as G,b as R,c as A,S as Z}from"./dropdown-menu.BysoY2q6.js";import{p as H}from"./paymentMethods.QdXxarE_.js";import{c as O}from"./clientAPI.Cs9ptr1e.js";import"./x.BNoxzAwW.js";import"./index.C7LY66bV.js";import"./index.64NwWGNV.js";import"./utils.CDN07tui.js";import"./index.Dym27YVG.js";const N=()=>{const p=new Date;return new Date(p.getTime()-p.getTimezoneOffset()*6e4)};function ae({isOpen:p,onClose:m,zIndex:T,injectedAmount:g,injectedDescription:h,depth:S=0}){const y=N(),[w,x]=o.useState(y.toISOString().split("T")[0]),[C,f]=o.useState(y.toISOString().slice(11,16)),[b,_]=o.useState(void 0),[P,E]=o.useState(!1),s=m!==void 0,L=p!==void 0?p:P,[v,D]=o.useState(null),[r,a]=o.useState({category:s?"Producto":"",description:"",amount:`${g||""}`,payment_method:"Pago",provider_id:""});o.useEffect(()=>{const t=n=>{const i=n.detail;D(i);const d=i.datetime instanceof Date?i.datetime.toISOString():String(i.datetime),[u,k]=d.split("T");x(u),f(k.slice(0,5)),a({category:i.category??"",description:i.description??"",amount:i.amount??"",payment_method:i.payment_method??"",provider_id:String(i.provider_id)??""}),E(!0)};return window.addEventListener("open-edit-expense",t),()=>window.removeEventListener("open-edit-expense",t)},[]),o.useEffect(()=>{g&&a({...r,amount:g})},[g]),o.useEffect(()=>{h&&a({...r,description:h})},[h]);const I=t=>{if(m){t||m();return}else E(t);if(!t&&!s){D(null),_(void 0),a({category:s?"Producto":"",description:"",amount:"",payment_method:"Pago",provider_id:""});const n=N();x(n.toISOString().split("T")[0]),f(n.toISOString().slice(11,16))}},M=async t=>{t.preventDefault(),t.stopPropagation();const n=`${w}T${C}:00Z`,i={...r,datetime:n,provider_id:r.provider_id?Number(r.provider_id):null,receipt:b};try{let d;v?d=await O.expense({id:v.expense_id}).put(i):d=await O.expense.post(i);const{error:u}=d;if(u)throw u.value;s?m():window.location.href="/expense"}catch(d){console.error("❌ Error al cargar gasto:",d),alert("Error al cargar gasto"),s&&m()}},F=S*380,$=t=>{t.stopPropagation()};return e.jsx("form",{id:"form-expense",onSubmit:M,children:e.jsxs(q,{title:"Agregar Gasto",description:"Agregar gasto de dispositivo al sistema",onInteractOutside:t=>{t.preventDefault()},style:s?{right:`${F}px`}:{},side:"right",isOpen:L,onOpenChange:I,zIndex:T||10,footer:e.jsxs(e.Fragment,{children:[e.jsx(j,{type:"submit",form:"form-expense",onClick:$,children:v?"Guardar":"Agregar"}),e.jsx(j,{variant:"outline",onClick:()=>I(!1),children:"Cancelar"})]}),children:[e.jsxs("div",{className:"grid gap-3",children:[e.jsx(l,{children:"Fecha y hora"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(c,{type:"date",value:w,onChange:t=>x(t.target.value)}),e.jsx(c,{type:"time",value:C,onChange:t=>f(t.target.value)})]})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(l,{children:"Categoría"}),e.jsx(c,{value:r.category,onChange:t=>a({...r,category:t.target.value}),required:!0})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(l,{children:"Descripción"}),e.jsx(c,{value:r.description,onChange:t=>a({...r,description:t.target.value}),required:!0})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(l,{children:"Monto"}),e.jsx(c,{type:"number",value:r.amount,onChange:t=>a({...r,amount:t.target.value}),placeholder:"0.00"})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(l,{children:"Método de pago"}),e.jsxs(z,{children:[e.jsx(B,{asChild:!0,children:e.jsxs(j,{variant:"outline",className:"ml-auto w-full justify-between font-normal",children:[r.payment_method," ",e.jsx(G,{})]})}),e.jsx(R,{align:"end",children:H.map(t=>e.jsx(A,{onClick:()=>a({...r,payment_method:t.value}),children:t.label},t.value))})]})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(l,{children:"Comprobante"}),e.jsx(c,{type:"file",accept:"image/*,application/pdf",onChange:t=>{const n=t.target.files?.[0];_(n)}})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(l,{children:"Proveedor"}),e.jsx(Z,{depth:s?S:1,type:"provider",currentId:r.provider_id,onSelect:t=>a({...r,provider_id:t??""})})]})]})})}export{ae as SheetFormExpense};
