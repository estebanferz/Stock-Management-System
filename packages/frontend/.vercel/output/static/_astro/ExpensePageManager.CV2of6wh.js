import{j as t}from"./jsx-runtime.D_zvdyIk.js";import{r as d}from"./index.DAubIFHI.js";import{c as v}from"./clientAPI.Cs9ptr1e.js";import{T as _}from"./TableWrapper.DH7mLV_p.js";import{p as j}from"./paymentMethods.QdXxarE_.js";import"./formatters.P2c1JhjN.js";import"./parsePhoneNumber.CAsXhxWl.js";import"./x.BNoxzAwW.js";import"./index.C7LY66bV.js";import"./index.64NwWGNV.js";import"./utils.CDN07tui.js";function b({data:a,columns:n}){const m=d.useCallback(l=>{const c=new CustomEvent("open-edit-expense",{detail:l});window.dispatchEvent(c)},[]),i=d.useCallback(async l=>{await v.expense({id:l.expense_id}).delete(),window.location.reload()},[]);return t.jsx(_,{data:a,columns:n,onEdit:m,onDelete:i})}function f(a){const n={};return a.date&&(n.date=a.date),a.category.trim()&&(n.category=a.category.trim()),a.payment_method.trim()&&(n.payment_method=a.payment_method.trim()),a.provider_id&&(n.provider_id=a.provider_id),a.amount_min&&(n.amount_min=a.amount_min),a.amount_max&&(n.amount_max=a.amount_max),a.deleted==="active"&&(n.is_deleted="false"),a.deleted==="deleted"&&(n.is_deleted="true"),n}function F({initialExpenses:a,providers:n,columns:m}){const[i,l]=d.useState(a),[c,p]=d.useState(!1),[u,N]=d.useState(null),[r,s]=d.useState({date:"",category:"",payment_method:"",provider_id:"",amount_min:"",amount_max:"",deleted:"active"}),x=d.useMemo(()=>new Map(n.map(e=>[e.provider_id,e.name])),[n]),h=d.useMemo(()=>i.map(e=>({...e,provider_name:x.get(e.provider_id)??"—"})),[i,x]),g=d.useMemo(()=>f(r),[r]);d.useEffect(()=>{const e=setTimeout(async()=>{p(!0);const o=await v.expense.all.get({query:g});l(Array.isArray(o.data)?o.data:[]),p(!1)},300);return()=>clearTimeout(e)},[g]);function y(){s({date:"",category:"",payment_method:"",provider_id:"",amount_min:"",amount_max:"",deleted:"active"})}return t.jsx("div",{className:"w-full",children:t.jsx("div",{className:"mx-auto max-w-6xl rounded-2xl border bg-white p-4 shadow-lg",children:t.jsxs("div",{className:"flex flex-col gap-3",children:[t.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2 lg:grid-cols-4",children:[t.jsx("input",{type:"date",value:r.date,onChange:e=>s(o=>({...o,date:e.target.value})),className:"rounded-lg border px-3 py-2 text-sm"}),t.jsx("input",{placeholder:"Categoría",value:r.category,onChange:e=>s(o=>({...o,category:e.target.value})),className:"rounded-lg border px-3 py-2 text-sm"}),t.jsxs("select",{value:r.payment_method,onChange:e=>s(o=>({...o,payment_method:e.target.value})),className:"rounded-lg border px-3 py-2 text-sm",children:[t.jsx("option",{value:"",children:"Todos los métodos de pago"}),j.map(e=>t.jsx("option",{value:e.value,children:e.label},e.value))]}),t.jsxs("select",{value:r.provider_id,onChange:e=>s(o=>({...o,provider_id:e.target.value})),className:"rounded-lg border px-3 py-2 text-sm",children:[t.jsx("option",{value:"",children:"Todos los proveedores"}),n.map(e=>t.jsx("option",{value:e.provider_id,children:e.name},e.provider_id))]}),t.jsxs("select",{value:r.deleted,onChange:e=>s(o=>({...o,deleted:e.target.value})),className:"rounded-lg border px-3 py-2 text-sm",children:[t.jsx("option",{value:"active",children:"Activos"}),t.jsx("option",{value:"deleted",children:"Eliminados"}),t.jsx("option",{value:"all",children:"Todos"})]}),t.jsx("input",{type:"number",placeholder:"Monto mínimo",value:r.amount_min,onChange:e=>s(o=>({...o,amount_min:e.target.value})),className:"rounded-lg border px-3 py-2 text-sm"}),t.jsx("input",{type:"number",placeholder:"Monto máximo",value:r.amount_max,onChange:e=>s(o=>({...o,amount_max:e.target.value})),className:"rounded-lg border px-3 py-2 text-sm"})]}),t.jsx("div",{className:"my-4",children:t.jsx(b,{data:h,columns:m})}),t.jsxs("div",{className:"flex items-center justify-between gap-3",children:[t.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600",children:[c?"Buscando...":`${i.length} resultado(s)`,u?t.jsx("span",{className:"text-red-600",children:u}):null]}),t.jsx("button",{className:"rounded-lg border px-3 py-2 text-sm font-medium hover:bg-gray-50",onClick:y,type:"button",children:"Limpiar filtros"})]})]})})})}export{F as ExpensesPageManager};
