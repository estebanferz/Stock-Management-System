import{j as i}from"./jsx-runtime.D_zvdyIk.js";import{r as o}from"./index.DAubIFHI.js";import{c as y}from"./clientAPI.Cs9ptr1e.js";import{T as N}from"./TableWrapper.DH7mLV_p.js";import{r as C,p as E}from"./repairStates.Su5DRb8C.js";import"./schema.Fil2OqHt.js";import"./formatters.P2c1JhjN.js";import"./parsePhoneNumber.CAsXhxWl.js";import"./x.BNoxzAwW.js";import"./index.C7LY66bV.js";import"./index.64NwWGNV.js";import"./utils.CDN07tui.js";function M({data:t,columns:n}){const r=o.useCallback(d=>{const u=new CustomEvent("open-edit-repair",{detail:d});window.dispatchEvent(u)},[]),c=o.useCallback(async d=>{await y.repair({id:d.repair_id}).delete(),window.location.reload()},[]);return i.jsx(N,{data:t,columns:n,onEdit:r,onDelete:c})}function T(t){const n={};return t.date&&(n.date=t.date),t.repair_state&&(n.repair_state=t.repair_state),t.priority&&(n.priority=t.priority),t.client_id&&(n.client_id=t.client_id),t.technician_id&&(n.technician_id=t.technician_id),t.device_id&&(n.device_id=t.device_id),t.cost_min&&(n.cost_min=t.cost_min),t.cost_max&&(n.cost_max=t.cost_max),t.deleted==="active"&&(n.is_deleted="false"),t.deleted==="deleted"&&(n.is_deleted="true"),n}function W({initialRepairs:t,columns:n,clients:r,technicians:c,phones:d}){const[u,f]=o.useState(t),[b,m]=o.useState(!1),[p,x]=o.useState(null),[l,s]=o.useState({date:"",repair_state:"",priority:"",client_id:"",technician_id:"",device_id:"",cost_min:"",cost_max:"",deleted:"active"}),v=o.useMemo(()=>T(l),[l]),g=o.useMemo(()=>new Map(r.map(e=>[e.client_id,e.name])),[r]),_=o.useMemo(()=>new Map(c.map(e=>[e.technician_id,e.name])),[c]),h=o.useMemo(()=>new Map(d.map(e=>[e.device_id,e.name])),[d]),j=o.useMemo(()=>u.map(e=>({...e,client_name:g.get(e.client_id)??"—",technician_name:_.get(e.technician_id)??"—",device_name:h.get(e.device_id)??"—"})),[u,g,_,h]);o.useEffect(()=>{const e=setTimeout(async()=>{m(!0),x(null);try{const a=await y.repair.all.get({query:v});f(Array.isArray(a.data)?a.data:[])}catch(a){x(a?.message??"Error buscando reparaciones")}finally{m(!1)}},350);return()=>clearTimeout(e)},[v]);function w(){s({date:"",repair_state:"",priority:"",client_id:"",technician_id:"",device_id:"",cost_min:"",cost_max:"",deleted:"active"})}return i.jsx("div",{className:"w-full",children:i.jsx("div",{className:"mx-auto max-w-6xl",children:i.jsx("div",{className:"rounded-2xl border bg-white p-4 shadow-lg",children:i.jsxs("div",{className:"flex flex-col gap-3",children:[i.jsxs("div",{className:"grid grid-cols-1 gap-3 md:grid-cols-2 lg:grid-cols-5",children:[i.jsx("input",{type:"date",className:"w-full rounded-lg border px-3 py-2 text-sm outline-none focus:ring-2",value:l.date,onChange:e=>s(a=>({...a,date:e.target.value}))}),i.jsxs("select",{className:"w-full rounded-lg border px-3 py-2 text-sm outline-none focus:ring-2",value:l.repair_state,onChange:e=>s(a=>({...a,repair_state:e.target.value})),children:[i.jsx("option",{value:"",children:"Estado"}),C.map(e=>i.jsx("option",{value:e.value,children:e.label},e.value))]}),i.jsxs("select",{className:"w-full rounded-lg border px-3 py-2 text-sm outline-none focus:ring-2",value:l.priority,onChange:e=>s(a=>({...a,priority:e.target.value})),children:[i.jsx("option",{value:"",children:"Prioridad"}),E.map(e=>i.jsx("option",{value:e.value,children:e.label},e.value))]}),i.jsxs("select",{className:"w-full rounded-lg border px-3 py-2 text-sm outline-none focus:ring-2",value:l.client_id,onChange:e=>s(a=>({...a,client_id:e.target.value})),children:[i.jsx("option",{value:"",children:"Todos los clientes"}),r.map(e=>i.jsx("option",{value:e.client_id,children:e.name},e.client_id))]}),i.jsxs("select",{className:"w-full rounded-lg border px-3 py-2 text-sm outline-none focus:ring-2",value:l.technician_id,onChange:e=>s(a=>({...a,technician_id:e.target.value})),children:[i.jsx("option",{value:"",children:"Todos los técnicos"}),c.map(e=>i.jsx("option",{value:e.technician_id,children:e.name},e.technician_id))]}),i.jsxs("select",{className:"w-full rounded-lg border px-3 py-2 text-sm outline-none focus:ring-2",value:l.device_id,onChange:e=>s(a=>({...a,device_id:e.target.value})),children:[i.jsx("option",{value:"",children:"Todos los dispositivos"}),d.map(e=>i.jsx("option",{value:e.device_id,children:e.name},e.device_id))]}),i.jsx("input",{type:"number",className:"w-full rounded-lg border px-3 py-2 text-sm outline-none focus:ring-2",placeholder:"Costo mín.",value:l.cost_min,onChange:e=>s(a=>({...a,cost_min:e.target.value}))}),i.jsx("input",{type:"number",className:"w-full rounded-lg border px-3 py-2 text-sm outline-none focus:ring-2",placeholder:"Costo máx.",value:l.cost_max,onChange:e=>s(a=>({...a,cost_max:e.target.value}))}),i.jsxs("select",{className:"w-full rounded-lg border px-3 py-2 text-sm outline-none focus:ring-2",value:l.deleted,onChange:e=>s(a=>({...a,deleted:e.target.value})),children:[i.jsx("option",{value:"active",children:"Activas"}),i.jsx("option",{value:"deleted",children:"Eliminadas"}),i.jsx("option",{value:"all",children:"Todas"})]})]}),i.jsx("div",{className:"my-4",children:i.jsx(M,{data:j,columns:n})}),i.jsxs("div",{className:"flex items-center justify-between gap-3",children:[i.jsxs("div",{className:"flex items-center gap-3 text-sm text-gray-600",children:[b?"Buscando...":`${j.length} resultado(s)`,p?i.jsx("span",{className:"text-red-600",children:p}):null]}),i.jsx("button",{className:"rounded-lg border px-3 py-2 text-sm font-medium hover:bg-gray-50",onClick:w,type:"button",children:"Limpiar filtros"})]})]})})})})}export{W as RepairPageManager};
