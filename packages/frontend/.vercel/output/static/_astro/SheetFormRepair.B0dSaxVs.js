import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{C as O,L as a,I as c,S as L}from"./input.MG_-FBsV.js";import{B as l}from"./button.Dcm3U4MY.js";import{S as g,D as C,a as w,C as y,b as N,c as D}from"./dropdown-menu.BysoY2q6.js";import{r as o}from"./index.DAubIFHI.js";import{r as M,p as R}from"./repairStates.Su5DRb8C.js";import{c as b}from"./clientAPI.Cs9ptr1e.js";import"./x.BNoxzAwW.js";import"./index.C7LY66bV.js";import"./index.64NwWGNV.js";import"./utils.CDN07tui.js";import"./index.Dym27YVG.js";const A=()=>{const d=new Date;return new Date(d.getTime()-d.getTimezoneOffset()*6e4)};function Q(){const d=A(),[m,u]=o.useState(d.toISOString().split("T")[0]),[h,x]=o.useState(d.toISOString().slice(11,16)),[E,j]=o.useState(!1),[v,I]=o.useState(null),[t,n]=o.useState({datetime:"",repair_state:"Estado",priority:"",description:"",diagnostic:"",client_cost:"",internal_cost:"",client_id:"",technician_id:"",device_id:""});o.useEffect(()=>{const i=p=>{const r=p.detail;I(r);const s=r.datetime instanceof Date?r.datetime.toISOString():String(r.datetime),[_,f]=s.split("T");u(_),x(f.slice(0,5)),n({datetime:r.datetime?String(r.datetime):"",repair_state:r.repair_state??"",priority:r.priority??"",description:r.description??"",diagnostic:r.diagnostic??"",client_cost:r.client_cost??"",internal_cost:r.internal_cost??"",client_id:r.client_id?r.client_id.toString():"",technician_id:r.technician_id?r.technician_id.toString():"",device_id:r.device_id?r.device_id.toString():""}),j(!0)};return window.addEventListener("open-edit-repair",i),()=>window.removeEventListener("open-edit-repair",i)},[]);const T=async i=>{i.preventDefault(),i.stopPropagation();const p=`${m}T${h}:00Z`,r={...t,datetime:p,client_id:Number(t.client_id),technician_id:Number(t.technician_id),device_id:Number(t.device_id)};try{let s;!!v?s=await b.repair({id:v.repair_id}).put(r):s=await b.repair.post(r);const{data:f,error:S}=s;if(S)throw S.value;window.location.reload()}catch(s){console.error("❌ Error al cargar reparación:",s),alert("Error al cargar reparación")}};return e.jsx("form",{id:"form-sale",onSubmit:T,children:e.jsxs(O,{title:"Agregar Reparación",zIndex:60,isOpen:E,onOpenChange:j,description:"Agregar reparación de dispositivo al sistema",isModal:!0,footer:e.jsxs(e.Fragment,{children:[e.jsx(l,{type:"submit",form:"form-sale",children:"Agregar"}),e.jsx(L,{asChild:!0,children:e.jsx(l,{variant:"outline",children:"Cancelar"})})]}),children:[e.jsxs("div",{className:"grid gap-3",children:[e.jsx(a,{children:"Fecha y hora"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsx(c,{type:"date",value:m,onChange:i=>u(i.target.value)}),e.jsx(c,{type:"time",value:h,onChange:i=>x(i.target.value)})]})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(a,{children:"Dispositivo"}),e.jsx(g,{type:"device",currentId:t.device_id,onSelect:i=>n({...t,device_id:i})})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(a,{children:"Cliente"}),e.jsx(g,{type:"client",currentId:t.client_id,onSelect:i=>n({...t,client_id:i})})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(a,{children:"Tecnico"}),e.jsx(g,{type:"technician",currentId:t.technician_id,onSelect:i=>n({...t,technician_id:i})})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(a,{children:"Estado de reparación"}),e.jsxs(C,{children:[e.jsx(w,{asChild:!0,children:e.jsxs(l,{variant:"outline",className:"ml-auto w-full justify-between font-normal",children:[t.repair_state," ",e.jsx(y,{})]})}),e.jsx(N,{align:"end",children:M.map(i=>e.jsx(D,{onClick:()=>n({...t,repair_state:i.value}),children:i.label},i.value))})]})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(a,{children:"Prioridad"}),e.jsxs(C,{children:[e.jsx(w,{asChild:!0,children:e.jsxs(l,{variant:"outline",className:"ml-auto w-full justify-between font-normal",children:[t.priority," ",e.jsx(y,{})]})}),e.jsx(N,{align:"end",children:R.map(i=>e.jsx(D,{onClick:()=>n({...t,priority:i.value}),children:i.label},i.value))})]})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(a,{children:"Descripción"}),e.jsx(c,{value:t.description,onChange:i=>n({...t,description:i.target.value}),required:!0})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(a,{children:"Diagnóstico técnico"}),e.jsx(c,{value:t.diagnostic,onChange:i=>n({...t,diagnostic:i.target.value}),required:!0})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(a,{children:"Costo al cliente"}),e.jsx(c,{type:"number",placeholder:"0.00",value:t.client_cost,onChange:i=>n({...t,client_cost:i.target.value})})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsx(a,{children:"Costo interno"}),e.jsx(c,{type:"number",placeholder:"0.00",value:t.internal_cost,onChange:i=>n({...t,internal_cost:i.target.value})})]})]})})}export{Q as SheetFormRepair};
