---

import Layout from "../../layouts/Layout.astro";
import { SheetFormPhone } from "@/components/SheetForms/SheetFormPhone";
import { serverApp } from "@/lib/serverAPI";
import { phoneColumns } from "@/config/PhoneColumnConfig";
import { computerColumns } from "@/config/ComputerColumnConfig";
import { tabletColumns } from "@/config/TabletColumnConfig";
import { watchColumns } from "@/config/WatchColumnConfig";
import { headphoneColumns } from "@/config/HeadphoneColumnConfig";
import { accessoryColumns } from "@/config/AccessoryColumnConfig";
import ActionPanel from "@/components/ActionPanel";
import { PhonesPageManager } from "@/components/PageManager/PhonePageManager";
import { AccessoriesPageManager } from "@/components/PageManager/AccessoryPageManager";
import { requireAuth } from "@/lib/requireAuth";
import { SheetFormAccessory } from "@/components/SheetForms/SheetFormAccessory";
import { Headphones, Smartphone } from "lucide-react";
const session = await requireAuth(Astro);
if (!session) return Astro.redirect("/login");
const { auth, cookieHeader } = session;
const authed = { headers: { cookie: cookieHeader } };

const response = await serverApp.phone.all.get(authed);
const data: any[] = Array.isArray(response.data) ? response.data : [];
    

---

<Layout title="Inventario" user={auth.user}>
    <h1 class="w-full text-3xl text-gray-700 font-bold mt-5">Inventario</h1>
    <p class="mb-5 text-sm text-gray-600 font-medium">Dispositivos en stock e históricos</p>
    

    <PhonesPageManager
        client:load
        initialData={data}
        phoneColumns={phoneColumns}
        computerColumns={computerColumns}
        tabletColumns={tabletColumns}
        watchColumns={watchColumns}
        headphoneColumns={headphoneColumns}
    />

    <h1 class="w-full text-3xl text-gray-700 font-bold mt-10">Accessorios</h1>
    <p class="mb-5 text-sm text-gray-600 font-medium">Cargadores, Auriculares, y demás productos con stock</p>

    <AccessoriesPageManager
        client:load
        initialData={data}
        columns={accessoryColumns}
    />

    <div class="justify-center mt-24 lg:mt-20 hidden md:block" slot="tercer-columna">
        <ActionPanel client:load />
    </div>

    <div class="group fixed right-10 bottom-28 z-30">
        <span
          class="absolute bottom-full right-0 mb-2 whitespace-nowrap rounded-md border bg-white px-4 py-2 
                     text-sm font-medium text-black shadow-lg
                     opacity-0 scale-95 transition-all duration-200 
                     group-hover:opacity-100 group-hover:scale-100
                     pointer-events-none"
        >
          Nuevo celular
        </span>

        <button
            id="btn-new-phone"
            type="button"
            class="flex justify-center items-center h-16 w-16 rounded-full bg-white text-gray-500 hover:bg-secondColor hover:opacity-90 hover:text-white text-3xl shadow-lg"
        >
            <Smartphone />
        </button>

        <SheetFormPhone client:load/>
      </div>

      <div class="group fixed right-10 bottom-10 z-30">
        <span
          class="absolute bottom-full right-0 mb-2 whitespace-nowrap rounded-md border bg-white px-4 py-2 
                     text-sm font-medium text-black shadow-lg
                     opacity-0 scale-95 transition-all duration-200 
                     group-hover:opacity-100 group-hover:scale-100
                     pointer-events-none"
        >
          Nuevo Accesorio
        </span>

        <button
            id="btn-new-accessory"
            type="button"
            class="flex justify-center items-center h-16 w-16 rounded-full bg-white text-gray-500 hover:bg-secondColor hover:opacity-90 hover:text-white text-3xl shadow-lg"
        >
            <Headphones />
        </button>

        <SheetFormAccessory client:load />
    </div>
</Layout>


<script is:inline>
document.getElementById("btn-new-phone")?.addEventListener("click", () => {
    window.dispatchEvent(new CustomEvent("open-new-phone"));
});
document.getElementById("btn-new-accessory")?.addEventListener("click", () => {
    window.dispatchEvent(new CustomEvent("open-new-accessory"));
});
</script>