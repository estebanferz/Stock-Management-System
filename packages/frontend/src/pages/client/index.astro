---
import Layout from "../../layouts/Layout.astro";
import {ActionPanel} from "@/components/ActionPanel";
import { SheetFormClient } from "@/components/SheetForms/SheetFormClient";
import { serverApp } from "@/lib/serverAPI";
import { clientColumns } from "@/config/ClientColumnConfig";
import { ClientsPageManager } from "@/components/PageManager/ClientPageManager";
import { requireAuth } from "@/lib/requireAuth";

const user = await requireAuth(Astro);
if (!user) return Astro.redirect("/login");
const response = await serverApp.client.all.get({ query: { is_deleted: false } });
const data = Array.isArray(response.data)
    ? response.data
    : [];

---

<Layout title="Clientes" user={user}>

  <h1 class="w-full text-center text-4xl text-gray-700 font-bold my-5">
    Clientes
  </h1>

  <ClientsPageManager 
    client:load 
    initialData={data} 
    columns={clientColumns} 
  />

  <div class="m-4 mt-20" slot="tercer-columna">
    <ActionPanel client:load />
  </div>

  <div slot="tercer-columna" class="group absolute bottom-10 right-10 hidden md:block lg:hidden">
      <span 
      class="absolute bottom-full right-0 mb-2 whitespace-nowrap rounded-md border bg-white px-4 py-2 
          text-sm font-medium text-black shadow-lg
          opacity-0 scale-95 transition-all duration-200 
          group-hover:opacity-100 group-hover:scale-100
          pointer-events-none"
      >
      Nuevo Cliente
      </span>
      <SheetFormClient zIndex={60} client:load/>
  </div>

  <div class="group absolute bottom-10 right-10 hidden lg:block">
    <span 
      class="absolute bottom-full right-0 mb-2 whitespace-nowrap rounded-md border bg-white px-4 py-2 
         text-sm font-medium text-black shadow-lg
         opacity-0 scale-95 transition-all duration-200 
         group-hover:opacity-100 group-hover:scale-100
         pointer-events-none"
    >
      Nuevo Cliente
    </span>

    <SheetFormClient zIndex={60}  client:load />
  </div>

</Layout>
