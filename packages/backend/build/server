// @bun
var __create=Object.create;var{getPrototypeOf:__getProtoOf,defineProperty:__defProp,getOwnPropertyNames:__getOwnPropNames}=Object;var __hasOwnProp=Object.prototype.hasOwnProperty;var __toESM=(mod,isNodeMode,target)=>{target=mod!=null?__create(__getProtoOf(mod)):{};let to=isNodeMode||!mod||!mod.__esModule?__defProp(target,"default",{value:mod,enumerable:!0}):target;for(let key of __getOwnPropNames(mod))if(!__hasOwnProp.call(to,key))__defProp(to,key,{get:()=>mod[key],enumerable:!0});return to};var __commonJS=(cb,mod)=>()=>(mod||cb((mod={exports:{}}).exports,mod),mod.exports);var __export=(target,all)=>{for(var name in all)__defProp(target,name,{get:all[name],enumerable:!0,configurable:!0,set:(newValue)=>all[name]=()=>newValue})};var __esm=(fn,res)=>()=>(fn&&(res=fn(fn=0)),res);var __require=import.meta.require;var EndOfStreamError,AbortError;var init_Errors=__esm(()=>{EndOfStreamError=class EndOfStreamError extends Error{constructor(){super("End-Of-Stream");this.name="EndOfStreamError"}};AbortError=class AbortError extends Error{constructor(message="The operation was aborted"){super(message);this.name="AbortError"}}});class Deferred{constructor(){this.resolve=()=>null,this.reject=()=>null,this.promise=new Promise((resolve,reject)=>{this.reject=reject,this.resolve=resolve})}}class AbstractStreamReader{constructor(){this.endOfStream=!1,this.interrupted=!1,this.peekQueue=[]}async peek(uint8Array,mayBeLess=!1){let bytesRead=await this.read(uint8Array,mayBeLess);return this.peekQueue.push(uint8Array.subarray(0,bytesRead)),bytesRead}async read(buffer,mayBeLess=!1){if(buffer.length===0)return 0;let bytesRead=this.readFromPeekBuffer(buffer);if(!this.endOfStream)bytesRead+=await this.readRemainderFromStream(buffer.subarray(bytesRead),mayBeLess);if(bytesRead===0&&!mayBeLess)throw new EndOfStreamError;return bytesRead}readFromPeekBuffer(buffer){let remaining=buffer.length,bytesRead=0;while(this.peekQueue.length>0&&remaining>0){let peekData=this.peekQueue.pop();if(!peekData)throw Error("peekData should be defined");let lenCopy=Math.min(peekData.length,remaining);if(buffer.set(peekData.subarray(0,lenCopy),bytesRead),bytesRead+=lenCopy,remaining-=lenCopy,lenCopy<peekData.length)this.peekQueue.push(peekData.subarray(lenCopy))}return bytesRead}async readRemainderFromStream(buffer,mayBeLess){let bytesRead=0;while(bytesRead<buffer.length&&!this.endOfStream){if(this.interrupted)throw new AbortError;let chunkLen=await this.readFromStream(buffer.subarray(bytesRead),mayBeLess);if(chunkLen===0)break;bytesRead+=chunkLen}if(!mayBeLess&&bytesRead<buffer.length)throw new EndOfStreamError;return bytesRead}}var init_AbstractStreamReader=__esm(()=>{init_Errors()});var StreamReader;var init_StreamReader=__esm(()=>{init_Errors();init_AbstractStreamReader();StreamReader=class StreamReader extends AbstractStreamReader{constructor(s){super();if(this.s=s,this.deferred=null,!s.read||!s.once)throw Error("Expected an instance of stream.Readable");this.s.once("end",()=>{if(this.endOfStream=!0,this.deferred)this.deferred.resolve(0)}),this.s.once("error",(err)=>this.reject(err)),this.s.once("close",()=>this.abort())}async readFromStream(buffer,mayBeLess){if(buffer.length===0)return 0;let readBuffer=this.s.read(buffer.length);if(readBuffer)return buffer.set(readBuffer),readBuffer.length;let request={buffer,mayBeLess,deferred:new Deferred};return this.deferred=request.deferred,this.s.once("readable",()=>{this.readDeferred(request)}),request.deferred.promise}readDeferred(request){let readBuffer=this.s.read(request.buffer.length);if(readBuffer)request.buffer.set(readBuffer),request.deferred.resolve(readBuffer.length),this.deferred=null;else this.s.once("readable",()=>{this.readDeferred(request)})}reject(err){if(this.interrupted=!0,this.deferred)this.deferred.reject(err),this.deferred=null}async abort(){this.reject(new AbortError)}async close(){return this.abort()}}});var WebStreamReader;var init_WebStreamReader=__esm(()=>{init_AbstractStreamReader();WebStreamReader=class WebStreamReader extends AbstractStreamReader{constructor(reader){super();this.reader=reader}async abort(){return this.close()}async close(){this.reader.releaseLock()}}});var WebStreamByobReader;var init_WebStreamByobReader=__esm(()=>{init_WebStreamReader();WebStreamByobReader=class WebStreamByobReader extends WebStreamReader{async readFromStream(buffer,mayBeLess){if(buffer.length===0)return 0;let result=await this.reader.read(new Uint8Array(buffer.length),{min:mayBeLess?void 0:buffer.length});if(result.done)this.endOfStream=result.done;if(result.value)return buffer.set(result.value),result.value.length;return 0}}});var WebStreamDefaultReader;var init_WebStreamDefaultReader=__esm(()=>{init_Errors();init_AbstractStreamReader();WebStreamDefaultReader=class WebStreamDefaultReader extends AbstractStreamReader{constructor(reader){super();this.reader=reader,this.buffer=null}writeChunk(target,chunk){let written=Math.min(chunk.length,target.length);if(target.set(chunk.subarray(0,written)),written<chunk.length)this.buffer=chunk.subarray(written);else this.buffer=null;return written}async readFromStream(buffer,mayBeLess){if(buffer.length===0)return 0;let totalBytesRead=0;if(this.buffer)totalBytesRead+=this.writeChunk(buffer,this.buffer);while(totalBytesRead<buffer.length&&!this.endOfStream){let result=await this.reader.read();if(result.done){this.endOfStream=!0;break}if(result.value)totalBytesRead+=this.writeChunk(buffer.subarray(totalBytesRead),result.value)}if(!mayBeLess&&totalBytesRead===0&&this.endOfStream)throw new EndOfStreamError;return totalBytesRead}abort(){return this.interrupted=!0,this.reader.cancel()}async close(){await this.abort(),this.reader.releaseLock()}}});function makeWebStreamReader(stream){try{let reader=stream.getReader({mode:"byob"});if(reader instanceof ReadableStreamDefaultReader)return new WebStreamDefaultReader(reader);return new WebStreamByobReader(reader)}catch(error){if(error instanceof TypeError)return new WebStreamDefaultReader(stream.getReader());throw error}}var init_WebStreamReaderFactory=__esm(()=>{init_WebStreamByobReader();init_WebStreamDefaultReader()});var init_stream=__esm(()=>{init_Errors();init_StreamReader();init_WebStreamByobReader();init_WebStreamDefaultReader();init_WebStreamReaderFactory()});class AbstractTokenizer{constructor(options){if(this.numBuffer=new Uint8Array(8),this.position=0,this.onClose=options?.onClose,options?.abortSignal)options.abortSignal.addEventListener("abort",()=>{this.abort()})}async readToken(token,position=this.position){let uint8Array=new Uint8Array(token.len);if(await this.readBuffer(uint8Array,{position})<token.len)throw new EndOfStreamError;return token.get(uint8Array,0)}async peekToken(token,position=this.position){let uint8Array=new Uint8Array(token.len);if(await this.peekBuffer(uint8Array,{position})<token.len)throw new EndOfStreamError;return token.get(uint8Array,0)}async readNumber(token){if(await this.readBuffer(this.numBuffer,{length:token.len})<token.len)throw new EndOfStreamError;return token.get(this.numBuffer,0)}async peekNumber(token){if(await this.peekBuffer(this.numBuffer,{length:token.len})<token.len)throw new EndOfStreamError;return token.get(this.numBuffer,0)}async ignore(length){if(this.fileInfo.size!==void 0){let bytesLeft=this.fileInfo.size-this.position;if(length>bytesLeft)return this.position+=bytesLeft,bytesLeft}return this.position+=length,length}async close(){await this.abort(),await this.onClose?.()}normalizeOptions(uint8Array,options){if(!this.supportsRandomAccess()&&options&&options.position!==void 0&&options.position<this.position)throw Error("`options.position` must be equal or greater than `tokenizer.position`");return{...{mayBeLess:!1,offset:0,length:uint8Array.length,position:this.position},...options}}abort(){return Promise.resolve()}}var init_AbstractTokenizer=__esm(()=>{init_stream()});var maxBufferSize=256000,ReadStreamTokenizer;var init_ReadStreamTokenizer=__esm(()=>{init_AbstractTokenizer();init_stream();ReadStreamTokenizer=class ReadStreamTokenizer extends AbstractTokenizer{constructor(streamReader,options){super(options);this.streamReader=streamReader,this.fileInfo=options?.fileInfo??{}}async readBuffer(uint8Array,options){let normOptions=this.normalizeOptions(uint8Array,options),skipBytes=normOptions.position-this.position;if(skipBytes>0)return await this.ignore(skipBytes),this.readBuffer(uint8Array,options);if(skipBytes<0)throw Error("`options.position` must be equal or greater than `tokenizer.position`");if(normOptions.length===0)return 0;let bytesRead=await this.streamReader.read(uint8Array.subarray(0,normOptions.length),normOptions.mayBeLess);if(this.position+=bytesRead,(!options||!options.mayBeLess)&&bytesRead<normOptions.length)throw new EndOfStreamError;return bytesRead}async peekBuffer(uint8Array,options){let normOptions=this.normalizeOptions(uint8Array,options),bytesRead=0;if(normOptions.position){let skipBytes=normOptions.position-this.position;if(skipBytes>0){let skipBuffer=new Uint8Array(normOptions.length+skipBytes);return bytesRead=await this.peekBuffer(skipBuffer,{mayBeLess:normOptions.mayBeLess}),uint8Array.set(skipBuffer.subarray(skipBytes)),bytesRead-skipBytes}if(skipBytes<0)throw Error("Cannot peek from a negative offset in a stream")}if(normOptions.length>0){try{bytesRead=await this.streamReader.peek(uint8Array.subarray(0,normOptions.length),normOptions.mayBeLess)}catch(err){if(options?.mayBeLess&&err instanceof EndOfStreamError)return 0;throw err}if(!normOptions.mayBeLess&&bytesRead<normOptions.length)throw new EndOfStreamError}return bytesRead}async ignore(length){let bufSize=Math.min(maxBufferSize,length),buf=new Uint8Array(bufSize),totBytesRead=0;while(totBytesRead<length){let remaining=length-totBytesRead,bytesRead=await this.readBuffer(buf,{length:Math.min(bufSize,remaining)});if(bytesRead<0)return bytesRead;totBytesRead+=bytesRead}return totBytesRead}abort(){return this.streamReader.abort()}async close(){return this.streamReader.close()}supportsRandomAccess(){return!1}}});var BufferTokenizer;var init_BufferTokenizer=__esm(()=>{init_stream();init_AbstractTokenizer();BufferTokenizer=class BufferTokenizer extends AbstractTokenizer{constructor(uint8Array,options){super(options);this.uint8Array=uint8Array,this.fileInfo={...options?.fileInfo??{},...{size:uint8Array.length}}}async readBuffer(uint8Array,options){if(options?.position)this.position=options.position;let bytesRead=await this.peekBuffer(uint8Array,options);return this.position+=bytesRead,bytesRead}async peekBuffer(uint8Array,options){let normOptions=this.normalizeOptions(uint8Array,options),bytes2read=Math.min(this.uint8Array.length-normOptions.position,normOptions.length);if(!normOptions.mayBeLess&&bytes2read<normOptions.length)throw new EndOfStreamError;return uint8Array.set(this.uint8Array.subarray(normOptions.position,normOptions.position+bytes2read)),bytes2read}close(){return super.close()}supportsRandomAccess(){return!0}setPosition(position){this.position=position}}});var BlobTokenizer;var init_BlobTokenizer=__esm(()=>{init_stream();init_AbstractTokenizer();BlobTokenizer=class BlobTokenizer extends AbstractTokenizer{constructor(blob,options){super(options);this.blob=blob,this.fileInfo={...options?.fileInfo??{},...{size:blob.size,mimeType:blob.type}}}async readBuffer(uint8Array,options){if(options?.position)this.position=options.position;let bytesRead=await this.peekBuffer(uint8Array,options);return this.position+=bytesRead,bytesRead}async peekBuffer(buffer,options){let normOptions=this.normalizeOptions(buffer,options),bytes2read=Math.min(this.blob.size-normOptions.position,normOptions.length);if(!normOptions.mayBeLess&&bytes2read<normOptions.length)throw new EndOfStreamError;let arrayBuffer=await this.blob.slice(normOptions.position,normOptions.position+bytes2read).arrayBuffer();return buffer.set(new Uint8Array(arrayBuffer)),bytes2read}close(){return super.close()}supportsRandomAccess(){return!0}setPosition(position){this.position=position}}});function fromStream(stream,options){let streamReader=new StreamReader(stream),_options=options??{},chainedClose=_options.onClose;return _options.onClose=async()=>{if(await streamReader.close(),chainedClose)return chainedClose()},new ReadStreamTokenizer(streamReader,_options)}function fromWebStream(webStream,options){let webStreamReader=makeWebStreamReader(webStream),_options=options??{},chainedClose=_options.onClose;return _options.onClose=async()=>{if(await webStreamReader.close(),chainedClose)return chainedClose()},new ReadStreamTokenizer(webStreamReader,_options)}function fromBuffer(uint8Array,options){return new BufferTokenizer(uint8Array,options)}function fromBlob(blob,options){return new BlobTokenizer(blob,options)}var init_core=__esm(()=>{init_stream();init_ReadStreamTokenizer();init_BufferTokenizer();init_BlobTokenizer();init_stream();init_AbstractTokenizer()});import{open as fsOpen}from"fs/promises";var FileTokenizer;var init_FileTokenizer=__esm(()=>{init_AbstractTokenizer();init_stream();FileTokenizer=class FileTokenizer extends AbstractTokenizer{static async fromFile(sourceFilePath){let fileHandle=await fsOpen(sourceFilePath,"r"),stat=await fileHandle.stat();return new FileTokenizer(fileHandle,{fileInfo:{path:sourceFilePath,size:stat.size}})}constructor(fileHandle,options){super(options);this.fileHandle=fileHandle,this.fileInfo=options.fileInfo}async readBuffer(uint8Array,options){let normOptions=this.normalizeOptions(uint8Array,options);if(this.position=normOptions.position,normOptions.length===0)return 0;let res=await this.fileHandle.read(uint8Array,0,normOptions.length,normOptions.position);if(this.position+=res.bytesRead,res.bytesRead<normOptions.length&&(!options||!options.mayBeLess))throw new EndOfStreamError;return res.bytesRead}async peekBuffer(uint8Array,options){let normOptions=this.normalizeOptions(uint8Array,options),res=await this.fileHandle.read(uint8Array,0,normOptions.length,normOptions.position);if(!normOptions.mayBeLess&&res.bytesRead<normOptions.length)throw new EndOfStreamError;return res.bytesRead}async close(){return await this.fileHandle.close(),super.close()}setPosition(position){this.position=position}supportsRandomAccess(){return!0}}});import{stat as fsStat}from"fs/promises";async function fromStream2(stream,options){let rst=fromStream(stream,options);if(stream.path){let stat=await fsStat(stream.path);rst.fileInfo.path=stream.path,rst.fileInfo.size=stat.size}return rst}var fromFile;var init_lib=__esm(()=>{init_core();init_FileTokenizer();init_FileTokenizer();init_core();fromFile=FileTokenizer.fromFile});var init_ieee754=__esm(()=>{/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */});function textDecode(bytes,encoding="utf-8"){switch(encoding.toLowerCase()){case"utf-8":case"utf8":if(typeof globalThis.TextDecoder<"u")return new globalThis.TextDecoder("utf-8").decode(bytes);return decodeUTF8(bytes);case"utf-16le":return decodeUTF16LE(bytes);case"ascii":return decodeASCII(bytes);case"latin1":case"iso-8859-1":return decodeLatin1(bytes);case"windows-1252":return decodeWindows1252(bytes);default:throw RangeError(`Encoding '${encoding}' not supported`)}}function decodeUTF8(bytes){let out="",i=0;while(i<bytes.length){let b1=bytes[i++];if(b1<128)out+=String.fromCharCode(b1);else if(b1<224){let b2=bytes[i++]&63;out+=String.fromCharCode((b1&31)<<6|b2)}else if(b1<240){let b2=bytes[i++]&63,b3=bytes[i++]&63;out+=String.fromCharCode((b1&15)<<12|b2<<6|b3)}else{let b2=bytes[i++]&63,b3=bytes[i++]&63,b4=bytes[i++]&63,cp=(b1&7)<<18|b2<<12|b3<<6|b4;cp-=65536,out+=String.fromCharCode(55296+(cp>>10&1023),56320+(cp&1023))}}return out}function decodeUTF16LE(bytes){let out="";for(let i=0;i<bytes.length;i+=2)out+=String.fromCharCode(bytes[i]|bytes[i+1]<<8);return out}function decodeASCII(bytes){return String.fromCharCode(...bytes.map((b)=>b&127))}function decodeLatin1(bytes){return String.fromCharCode(...bytes)}function decodeWindows1252(bytes){let out="";for(let b of bytes)if(b>=128&&b<=159&&WINDOWS_1252_EXTRA[b])out+=WINDOWS_1252_EXTRA[b];else out+=String.fromCharCode(b);return out}var WINDOWS_1252_EXTRA,WINDOWS_1252_REVERSE;var init_lib2=__esm(()=>{WINDOWS_1252_EXTRA={128:"\u20AC",130:"\u201A",131:"\u0192",132:"\u201E",133:"\u2026",134:"\u2020",135:"\u2021",136:"\u02C6",137:"\u2030",138:"\u0160",139:"\u2039",140:"\u0152",142:"\u017D",145:"\u2018",146:"\u2019",147:"\u201C",148:"\u201D",149:"\u2022",150:"\u2013",151:"\u2014",152:"\u02DC",153:"\u2122",154:"\u0161",155:"\u203A",156:"\u0153",158:"\u017E",159:"\u0178"},WINDOWS_1252_REVERSE={};for(let[code,char]of Object.entries(WINDOWS_1252_EXTRA))WINDOWS_1252_REVERSE[char]=Number.parseInt(code)});function dv(array){return new DataView(array.buffer,array.byteOffset)}class StringType2{constructor(len,encoding){this.len=len,this.encoding=encoding}get(data,offset=0){let bytes=data.subarray(offset,offset+this.len);return textDecode(bytes,this.encoding)}}var UINT8,UINT16_LE,UINT16_BE,UINT32_LE,UINT32_BE,INT32_BE,UINT64_LE;var init_lib3=__esm(()=>{init_ieee754();init_lib2();UINT8={len:1,get(array,offset){return dv(array).getUint8(offset)},put(array,offset,value){return dv(array).setUint8(offset,value),offset+1}},UINT16_LE={len:2,get(array,offset){return dv(array).getUint16(offset,!0)},put(array,offset,value){return dv(array).setUint16(offset,value,!0),offset+2}},UINT16_BE={len:2,get(array,offset){return dv(array).getUint16(offset)},put(array,offset,value){return dv(array).setUint16(offset,value),offset+2}},UINT32_LE={len:4,get(array,offset){return dv(array).getUint32(offset,!0)},put(array,offset,value){return dv(array).setUint32(offset,value,!0),offset+4}},UINT32_BE={len:4,get(array,offset){return dv(array).getUint32(offset)},put(array,offset,value){return dv(array).setUint32(offset,value),offset+4}},INT32_BE={len:4,get(array,offset){return dv(array).getInt32(offset)},put(array,offset,value){return dv(array).setInt32(offset,value),offset+4}},UINT64_LE={len:8,get(array,offset){return dv(array).getBigUint64(offset,!0)},put(array,offset,value){return dv(array).setBigUint64(offset,value,!0),offset+8}}});var require_ms=__commonJS((exports,module)=>{var s=1000,m=s*60,h=m*60,d=h*24,w=d*7,y=d*365.25;module.exports=function(val,options){options=options||{};var type=typeof val;if(type==="string"&&val.length>0)return parse2(val);else if(type==="number"&&isFinite(val))return options.long?fmtLong(val):fmtShort(val);throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(val))};function parse2(str){if(str=String(str),str.length>100)return;var match=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(str);if(!match)return;var n=parseFloat(match[1]),type=(match[2]||"ms").toLowerCase();switch(type){case"years":case"year":case"yrs":case"yr":case"y":return n*y;case"weeks":case"week":case"w":return n*w;case"days":case"day":case"d":return n*d;case"hours":case"hour":case"hrs":case"hr":case"h":return n*h;case"minutes":case"minute":case"mins":case"min":case"m":return n*m;case"seconds":case"second":case"secs":case"sec":case"s":return n*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}function fmtShort(ms){var msAbs=Math.abs(ms);if(msAbs>=d)return Math.round(ms/d)+"d";if(msAbs>=h)return Math.round(ms/h)+"h";if(msAbs>=m)return Math.round(ms/m)+"m";if(msAbs>=s)return Math.round(ms/s)+"s";return ms+"ms"}function fmtLong(ms){var msAbs=Math.abs(ms);if(msAbs>=d)return plural(ms,msAbs,d,"day");if(msAbs>=h)return plural(ms,msAbs,h,"hour");if(msAbs>=m)return plural(ms,msAbs,m,"minute");if(msAbs>=s)return plural(ms,msAbs,s,"second");return ms+" ms"}function plural(ms,msAbs,n,name){var isPlural=msAbs>=n*1.5;return Math.round(ms/n)+" "+name+(isPlural?"s":"")}});var require_common=__commonJS((exports,module)=>{function setup(env){createDebug.debug=createDebug,createDebug.default=createDebug,createDebug.coerce=coerce,createDebug.disable=disable,createDebug.enable=enable,createDebug.enabled=enabled,createDebug.humanize=require_ms(),createDebug.destroy=destroy,Object.keys(env).forEach((key)=>{createDebug[key]=env[key]}),createDebug.names=[],createDebug.skips=[],createDebug.formatters={};function selectColor(namespace){let hash2=0;for(let i=0;i<namespace.length;i++)hash2=(hash2<<5)-hash2+namespace.charCodeAt(i),hash2|=0;return createDebug.colors[Math.abs(hash2)%createDebug.colors.length]}createDebug.selectColor=selectColor;function createDebug(namespace){let prevTime,enableOverride=null,namespacesCache,enabledCache;function debug(...args){if(!debug.enabled)return;let self2=debug,curr=Number(new Date),ms=curr-(prevTime||curr);if(self2.diff=ms,self2.prev=prevTime,self2.curr=curr,prevTime=curr,args[0]=createDebug.coerce(args[0]),typeof args[0]!=="string")args.unshift("%O");let index=0;args[0]=args[0].replace(/%([a-zA-Z%])/g,(match,format)=>{if(match==="%%")return"%";index++;let formatter=createDebug.formatters[format];if(typeof formatter==="function"){let val=args[index];match=formatter.call(self2,val),args.splice(index,1),index--}return match}),createDebug.formatArgs.call(self2,args),(self2.log||createDebug.log).apply(self2,args)}if(debug.namespace=namespace,debug.useColors=createDebug.useColors(),debug.color=createDebug.selectColor(namespace),debug.extend=extend,debug.destroy=createDebug.destroy,Object.defineProperty(debug,"enabled",{enumerable:!0,configurable:!1,get:()=>{if(enableOverride!==null)return enableOverride;if(namespacesCache!==createDebug.namespaces)namespacesCache=createDebug.namespaces,enabledCache=createDebug.enabled(namespace);return enabledCache},set:(v)=>{enableOverride=v}}),typeof createDebug.init==="function")createDebug.init(debug);return debug}function extend(namespace,delimiter){let newDebug=createDebug(this.namespace+(typeof delimiter>"u"?":":delimiter)+namespace);return newDebug.log=this.log,newDebug}function enable(namespaces){createDebug.save(namespaces),createDebug.namespaces=namespaces,createDebug.names=[],createDebug.skips=[];let split=(typeof namespaces==="string"?namespaces:"").trim().replace(/\s+/g,",").split(",").filter(Boolean);for(let ns of split)if(ns[0]==="-")createDebug.skips.push(ns.slice(1));else createDebug.names.push(ns)}function matchesTemplate(search,template){let searchIndex=0,templateIndex=0,starIndex=-1,matchIndex=0;while(searchIndex<search.length)if(templateIndex<template.length&&(template[templateIndex]===search[searchIndex]||template[templateIndex]==="*"))if(template[templateIndex]==="*")starIndex=templateIndex,matchIndex=searchIndex,templateIndex++;else searchIndex++,templateIndex++;else if(starIndex!==-1)templateIndex=starIndex+1,matchIndex++,searchIndex=matchIndex;else return!1;while(templateIndex<template.length&&template[templateIndex]==="*")templateIndex++;return templateIndex===template.length}function disable(){let namespaces=[...createDebug.names,...createDebug.skips.map((namespace)=>"-"+namespace)].join(",");return createDebug.enable(""),namespaces}function enabled(name){for(let skip of createDebug.skips)if(matchesTemplate(name,skip))return!1;for(let ns of createDebug.names)if(matchesTemplate(name,ns))return!0;return!1}function coerce(val){if(val instanceof Error)return val.stack||val.message;return val}function destroy(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return createDebug.enable(createDebug.load()),createDebug}module.exports=setup});var require_browser=__commonJS((exports,module)=>{exports.formatArgs=formatArgs;exports.save=save;exports.load=load;exports.useColors=useColors;exports.storage=localstorage();exports.destroy=(()=>{let warned=!1;return()=>{if(!warned)warned=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}})();exports.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function useColors(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let m;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(m=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(m[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function formatArgs(args){if(args[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+args[0]+(this.useColors?"%c ":" ")+"+"+module.exports.humanize(this.diff),!this.useColors)return;let c="color: "+this.color;args.splice(1,0,c,"color: inherit");let index=0,lastC=0;args[0].replace(/%[a-zA-Z%]/g,(match)=>{if(match==="%%")return;if(index++,match==="%c")lastC=index}),args.splice(lastC,0,c)}exports.log=console.debug||console.log||(()=>{});function save(namespaces){try{if(namespaces)exports.storage.setItem("debug",namespaces);else exports.storage.removeItem("debug")}catch(error){}}function load(){let r;try{r=exports.storage.getItem("debug")||exports.storage.getItem("DEBUG")}catch(error){}if(!r&&typeof process<"u"&&"env"in process)r=process.env.DEBUG;return r}function localstorage(){try{return localStorage}catch(error){}}module.exports=require_common()(exports);var{formatters}=module.exports;formatters.j=function(v){try{return JSON.stringify(v)}catch(error){return"[UnexpectedJSONParseError]: "+error.message}}});var require_has_flag=__commonJS((exports,module)=>{module.exports=(flag,argv=process.argv)=>{let prefix=flag.startsWith("-")?"":flag.length===1?"-":"--",position=argv.indexOf(prefix+flag),terminatorPosition=argv.indexOf("--");return position!==-1&&(terminatorPosition===-1||position<terminatorPosition)}});var require_supports_color=__commonJS((exports,module)=>{var os=__require("os"),tty=__require("tty"),hasFlag=require_has_flag(),{env}=process,forceColor;if(hasFlag("no-color")||hasFlag("no-colors")||hasFlag("color=false")||hasFlag("color=never"))forceColor=0;else if(hasFlag("color")||hasFlag("colors")||hasFlag("color=true")||hasFlag("color=always"))forceColor=1;if("FORCE_COLOR"in env)if(env.FORCE_COLOR==="true")forceColor=1;else if(env.FORCE_COLOR==="false")forceColor=0;else forceColor=env.FORCE_COLOR.length===0?1:Math.min(parseInt(env.FORCE_COLOR,10),3);function translateLevel(level){if(level===0)return!1;return{level,hasBasic:!0,has256:level>=2,has16m:level>=3}}function supportsColor(haveStream,streamIsTTY){if(forceColor===0)return 0;if(hasFlag("color=16m")||hasFlag("color=full")||hasFlag("color=truecolor"))return 3;if(hasFlag("color=256"))return 2;if(haveStream&&!streamIsTTY&&forceColor===void 0)return 0;let min=forceColor||0;if(env.TERM==="dumb")return min;if(process.platform==="win32"){let osRelease=os.release().split(".");if(Number(osRelease[0])>=10&&Number(osRelease[2])>=10586)return Number(osRelease[2])>=14931?3:2;return 1}if("CI"in env){if(["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI","GITHUB_ACTIONS","BUILDKITE"].some((sign)=>(sign in env))||env.CI_NAME==="codeship")return 1;return min}if("TEAMCITY_VERSION"in env)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(env.TEAMCITY_VERSION)?1:0;if(env.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in env){let version=parseInt((env.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(env.TERM_PROGRAM){case"iTerm.app":return version>=3?3:2;case"Apple_Terminal":return 2}}if(/-256(color)?$/i.test(env.TERM))return 2;if(/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(env.TERM))return 1;if("COLORTERM"in env)return 1;return min}function getSupportLevel(stream){let level=supportsColor(stream,stream&&stream.isTTY);return translateLevel(level)}module.exports={supportsColor:getSupportLevel,stdout:translateLevel(supportsColor(!0,tty.isatty(1))),stderr:translateLevel(supportsColor(!0,tty.isatty(2)))}});var require_node=__commonJS((exports,module)=>{var tty=__require("tty"),util=__require("util");exports.init=init;exports.log=log;exports.formatArgs=formatArgs;exports.save=save;exports.load=load;exports.useColors=useColors;exports.destroy=util.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");exports.colors=[6,2,3,4,5,1];try{let supportsColor=require_supports_color();if(supportsColor&&(supportsColor.stderr||supportsColor).level>=2)exports.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221]}catch(error){}exports.inspectOpts=Object.keys(process.env).filter((key)=>{return/^debug_/i.test(key)}).reduce((obj,key)=>{let prop=key.substring(6).toLowerCase().replace(/_([a-z])/g,(_,k)=>{return k.toUpperCase()}),val=process.env[key];if(/^(yes|on|true|enabled)$/i.test(val))val=!0;else if(/^(no|off|false|disabled)$/i.test(val))val=!1;else if(val==="null")val=null;else val=Number(val);return obj[prop]=val,obj},{});function useColors(){return"colors"in exports.inspectOpts?Boolean(exports.inspectOpts.colors):tty.isatty(process.stderr.fd)}function formatArgs(args){let{namespace:name,useColors:useColors2}=this;if(useColors2){let c=this.color,colorCode="\x1B[3"+(c<8?c:"8;5;"+c),prefix=`  ${colorCode};1m${name} \x1B[0m`;args[0]=prefix+args[0].split(`
`).join(`
`+prefix),args.push(colorCode+"m+"+module.exports.humanize(this.diff)+"\x1B[0m")}else args[0]=getDate()+name+" "+args[0]}function getDate(){if(exports.inspectOpts.hideDate)return"";return new Date().toISOString()+" "}function log(...args){return process.stderr.write(util.formatWithOptions(exports.inspectOpts,...args)+`
`)}function save(namespaces){if(namespaces)process.env.DEBUG=namespaces;else delete process.env.DEBUG}function load(){return process.env.DEBUG}function init(debug){debug.inspectOpts={};let keys=Object.keys(exports.inspectOpts);for(let i=0;i<keys.length;i++)debug.inspectOpts[keys[i]]=exports.inspectOpts[keys[i]]}module.exports=require_common()(exports);var{formatters}=module.exports;formatters.o=function(v){return this.inspectOpts.colors=this.useColors,util.inspect(v,this.inspectOpts).split(`
`).map((str)=>str.trim()).join(" ")};formatters.O=function(v){return this.inspectOpts.colors=this.useColors,util.inspect(v,this.inspectOpts)}});var require_src=__commonJS((exports,module)=>{if(typeof process>"u"||process.type==="renderer"||!1||process.__nwjs)module.exports=require_browser();else module.exports=require_node()});var Signature,DataDescriptor,LocalFileHeaderToken,EndOfCentralDirectoryRecordToken,FileHeader;var init_ZipToken=__esm(()=>{init_lib3();Signature={LocalFileHeader:67324752,DataDescriptor:134695760,CentralFileHeader:33639248,EndOfCentralDirectory:101010256},DataDescriptor={get(array){return{signature:UINT32_LE.get(array,0),compressedSize:UINT32_LE.get(array,8),uncompressedSize:UINT32_LE.get(array,12)}},len:16},LocalFileHeaderToken={get(array){let flags=UINT16_LE.get(array,6);return{signature:UINT32_LE.get(array,0),minVersion:UINT16_LE.get(array,4),dataDescriptor:!!(flags&8),compressedMethod:UINT16_LE.get(array,8),compressedSize:UINT32_LE.get(array,18),uncompressedSize:UINT32_LE.get(array,22),filenameLength:UINT16_LE.get(array,26),extraFieldLength:UINT16_LE.get(array,28),filename:null}},len:30},EndOfCentralDirectoryRecordToken={get(array){return{signature:UINT32_LE.get(array,0),nrOfThisDisk:UINT16_LE.get(array,4),nrOfThisDiskWithTheStart:UINT16_LE.get(array,6),nrOfEntriesOnThisDisk:UINT16_LE.get(array,8),nrOfEntriesOfSize:UINT16_LE.get(array,10),sizeOfCd:UINT32_LE.get(array,12),offsetOfStartOfCd:UINT32_LE.get(array,16),zipFileCommentLength:UINT16_LE.get(array,20)}},len:22},FileHeader={get(array){let flags=UINT16_LE.get(array,8);return{signature:UINT32_LE.get(array,0),minVersion:UINT16_LE.get(array,6),dataDescriptor:!!(flags&8),compressedMethod:UINT16_LE.get(array,10),compressedSize:UINT32_LE.get(array,20),uncompressedSize:UINT32_LE.get(array,24),filenameLength:UINT16_LE.get(array,28),extraFieldLength:UINT16_LE.get(array,30),fileCommentLength:UINT16_LE.get(array,32),relativeOffsetOfLocalHeader:UINT32_LE.get(array,42),filename:null}},len:46}});function signatureToArray(signature){let signatureBytes=new Uint8Array(UINT32_LE.len);return UINT32_LE.put(signatureBytes,0,signature),signatureBytes}class ZipHandler{constructor(tokenizer){this.tokenizer=tokenizer,this.syncBuffer=new Uint8Array(syncBufferSize)}async isZip(){return await this.peekSignature()===Signature.LocalFileHeader}peekSignature(){return this.tokenizer.peekToken(UINT32_LE)}async findEndOfCentralDirectoryLocator(){let randomReadTokenizer=this.tokenizer,chunkLength=Math.min(16384,randomReadTokenizer.fileInfo.size),buffer=this.syncBuffer.subarray(0,chunkLength);await this.tokenizer.readBuffer(buffer,{position:randomReadTokenizer.fileInfo.size-chunkLength});for(let i=buffer.length-4;i>=0;i--)if(buffer[i]===eocdSignatureBytes[0]&&buffer[i+1]===eocdSignatureBytes[1]&&buffer[i+2]===eocdSignatureBytes[2]&&buffer[i+3]===eocdSignatureBytes[3])return randomReadTokenizer.fileInfo.size-chunkLength+i;return-1}async readCentralDirectory(){if(!this.tokenizer.supportsRandomAccess()){debug("Cannot reading central-directory without random-read support");return}debug("Reading central-directory...");let pos=this.tokenizer.position,offset=await this.findEndOfCentralDirectoryLocator();if(offset>0){debug("Central-directory 32-bit signature found");let eocdHeader=await this.tokenizer.readToken(EndOfCentralDirectoryRecordToken,offset),files=[];this.tokenizer.setPosition(eocdHeader.offsetOfStartOfCd);for(let n=0;n<eocdHeader.nrOfEntriesOfSize;++n){let entry=await this.tokenizer.readToken(FileHeader);if(entry.signature!==Signature.CentralFileHeader)throw Error("Expected Central-File-Header signature");entry.filename=await this.tokenizer.readToken(new StringType2(entry.filenameLength,"utf-8")),await this.tokenizer.ignore(entry.extraFieldLength),await this.tokenizer.ignore(entry.fileCommentLength),files.push(entry),debug(`Add central-directory file-entry: n=${n+1}/${files.length}: filename=${files[n].filename}`)}return this.tokenizer.setPosition(pos),files}this.tokenizer.setPosition(pos)}async unzip(fileCb){let entries=await this.readCentralDirectory();if(entries)return this.iterateOverCentralDirectory(entries,fileCb);let stop=!1;do{let zipHeader=await this.readLocalFileHeader();if(!zipHeader)break;let next=fileCb(zipHeader);stop=!!next.stop;let fileData;if(await this.tokenizer.ignore(zipHeader.extraFieldLength),zipHeader.dataDescriptor&&zipHeader.compressedSize===0){let chunks=[],len=syncBufferSize;debug("Compressed-file-size unknown, scanning for next data-descriptor-signature....");let nextHeaderIndex=-1;while(nextHeaderIndex<0&&len===syncBufferSize){len=await this.tokenizer.peekBuffer(this.syncBuffer,{mayBeLess:!0}),nextHeaderIndex=indexOf(this.syncBuffer.subarray(0,len),ddSignatureArray);let size=nextHeaderIndex>=0?nextHeaderIndex:len;if(next.handler){let data=new Uint8Array(size);await this.tokenizer.readBuffer(data),chunks.push(data)}else await this.tokenizer.ignore(size)}if(debug(`Found data-descriptor-signature at pos=${this.tokenizer.position}`),next.handler)await this.inflate(zipHeader,mergeArrays(chunks),next.handler)}else if(next.handler)debug(`Reading compressed-file-data: ${zipHeader.compressedSize} bytes`),fileData=new Uint8Array(zipHeader.compressedSize),await this.tokenizer.readBuffer(fileData),await this.inflate(zipHeader,fileData,next.handler);else debug(`Ignoring compressed-file-data: ${zipHeader.compressedSize} bytes`),await this.tokenizer.ignore(zipHeader.compressedSize);if(debug(`Reading data-descriptor at pos=${this.tokenizer.position}`),zipHeader.dataDescriptor){if((await this.tokenizer.readToken(DataDescriptor)).signature!==134695760)throw Error(`Expected data-descriptor-signature at position ${this.tokenizer.position-DataDescriptor.len}`)}}while(!stop)}async iterateOverCentralDirectory(entries,fileCb){for(let fileHeader of entries){let next=fileCb(fileHeader);if(next.handler){this.tokenizer.setPosition(fileHeader.relativeOffsetOfLocalHeader);let zipHeader=await this.readLocalFileHeader();if(zipHeader){await this.tokenizer.ignore(zipHeader.extraFieldLength);let fileData=new Uint8Array(fileHeader.compressedSize);await this.tokenizer.readBuffer(fileData),await this.inflate(zipHeader,fileData,next.handler)}}if(next.stop)break}}async inflate(zipHeader,fileData,cb){if(zipHeader.compressedMethod===0)return cb(fileData);if(zipHeader.compressedMethod!==8)throw Error(`Unsupported ZIP compression method: ${zipHeader.compressedMethod}`);debug(`Decompress filename=${zipHeader.filename}, compressed-size=${fileData.length}`);let uncompressedData=await ZipHandler.decompressDeflateRaw(fileData);return cb(uncompressedData)}static async decompressDeflateRaw(data){let input=new ReadableStream({start(controller){controller.enqueue(data),controller.close()}}),ds=new DecompressionStream("deflate-raw"),output=input.pipeThrough(ds);try{let buffer=await new Response(output).arrayBuffer();return new Uint8Array(buffer)}catch(err){let message=err instanceof Error?`Failed to deflate ZIP entry: ${err.message}`:"Unknown decompression error in ZIP entry";throw TypeError(message)}}async readLocalFileHeader(){let signature=await this.tokenizer.peekToken(UINT32_LE);if(signature===Signature.LocalFileHeader){let header=await this.tokenizer.readToken(LocalFileHeaderToken);return header.filename=await this.tokenizer.readToken(new StringType2(header.filenameLength,"utf-8")),header}if(signature===Signature.CentralFileHeader)return!1;if(signature===3759263696)throw Error("Encrypted ZIP");throw Error("Unexpected signature")}}function indexOf(buffer,portion){let bufferLength=buffer.length,portionLength=portion.length;if(portionLength>bufferLength)return-1;for(let i=0;i<=bufferLength-portionLength;i++){let found=!0;for(let j=0;j<portionLength;j++)if(buffer[i+j]!==portion[j]){found=!1;break}if(found)return i}return-1}function mergeArrays(chunks){let totalLength=chunks.reduce((acc,curr)=>acc+curr.length,0),mergedArray=new Uint8Array(totalLength),offset=0;for(let chunk of chunks)mergedArray.set(chunk,offset),offset+=chunk.length;return mergedArray}var import_debug,debug,syncBufferSize=262144,ddSignatureArray,eocdSignatureBytes;var init_ZipHandler=__esm(()=>{init_lib3();init_ZipToken();import_debug=__toESM(require_src(),1);debug=import_debug.default("tokenizer:inflate"),ddSignatureArray=signatureToArray(Signature.DataDescriptor),eocdSignatureBytes=signatureToArray(Signature.EndOfCentralDirectory)});class GzipHandler{constructor(tokenizer){this.tokenizer=tokenizer}inflate(){let tokenizer=this.tokenizer;return new ReadableStream({async pull(controller){let buffer=new Uint8Array(1024),size=await tokenizer.readBuffer(buffer,{mayBeLess:!0});if(size===0){controller.close();return}controller.enqueue(buffer.subarray(0,size))}}).pipeThrough(new DecompressionStream("gzip"))}}var init_lib4=__esm(()=>{init_ZipHandler()});function getUintBE(view){let{byteLength}=view;if(byteLength===6)return view.getUint16(0)*4294967296+view.getUint32(2);if(byteLength===5)return view.getUint8(0)*4294967296+view.getUint32(1);if(byteLength===4)return view.getUint32(0);if(byteLength===3)return view.getUint8(0)*65536+view.getUint16(1);if(byteLength===2)return view.getUint16(0);if(byteLength===1)return view.getUint8(0)}var cachedDecoders,cachedEncoder,byteToHexLookupTable;var init_uint8array_extras=__esm(()=>{cachedDecoders={utf8:new globalThis.TextDecoder("utf8")},cachedEncoder=new globalThis.TextEncoder,byteToHexLookupTable=Array.from({length:256},(_,index)=>index.toString(16).padStart(2,"0"))});function stringToBytes(string,encoding){if(encoding==="utf-16le"){let bytes=[];for(let index=0;index<string.length;index++){let code=string.charCodeAt(index);bytes.push(code&255,code>>8&255)}return bytes}if(encoding==="utf-16be"){let bytes=[];for(let index=0;index<string.length;index++){let code=string.charCodeAt(index);bytes.push(code>>8&255,code&255)}return bytes}return[...string].map((character)=>character.charCodeAt(0))}function tarHeaderChecksumMatches(arrayBuffer,offset=0){let readSum=Number.parseInt(new StringType2(6).get(arrayBuffer,148).replace(/\0.*$/,"").trim(),8);if(Number.isNaN(readSum))return!1;let sum=256;for(let index=offset;index<offset+148;index++)sum+=arrayBuffer[index];for(let index=offset+156;index<offset+512;index++)sum+=arrayBuffer[index];return readSum===sum}var uint32SyncSafeToken;var init_util=__esm(()=>{init_lib3();uint32SyncSafeToken={get:(buffer,offset)=>buffer[offset+3]&127|buffer[offset+2]<<7|buffer[offset+1]<<14|buffer[offset]<<21,len:4}});var extensions,mimeTypes;var init_supported=__esm(()=>{extensions=["jpg","png","apng","gif","webp","flif","xcf","cr2","cr3","orf","arw","dng","nef","rw2","raf","tif","bmp","icns","jxr","psd","indd","zip","tar","rar","gz","bz2","7z","dmg","mp4","mid","mkv","webm","mov","avi","mpg","mp2","mp3","m4a","oga","ogg","ogv","opus","flac","wav","spx","amr","pdf","epub","elf","macho","exe","swf","rtf","wasm","woff","woff2","eot","ttf","otf","ttc","ico","flv","ps","xz","sqlite","nes","crx","xpi","cab","deb","ar","rpm","Z","lz","cfb","mxf","mts","blend","bpg","docx","pptx","xlsx","3gp","3g2","j2c","jp2","jpm","jpx","mj2","aif","qcp","odt","ods","odp","xml","mobi","heic","cur","ktx","ape","wv","dcm","ics","glb","pcap","dsf","lnk","alias","voc","ac3","m4v","m4p","m4b","f4v","f4p","f4b","f4a","mie","asf","ogm","ogx","mpc","arrow","shp","aac","mp1","it","s3m","xm","skp","avif","eps","lzh","pgp","asar","stl","chm","3mf","zst","jxl","vcf","jls","pst","dwg","parquet","class","arj","cpio","ace","avro","icc","fbx","vsdx","vtt","apk","drc","lz4","potx","xltx","dotx","xltm","ott","ots","otp","odg","otg","xlsm","docm","dotm","potm","pptm","jar","rm","ppsm","ppsx","tar.gz","reg","dat"],mimeTypes=["image/jpeg","image/png","image/gif","image/webp","image/flif","image/x-xcf","image/x-canon-cr2","image/x-canon-cr3","image/tiff","image/bmp","image/vnd.ms-photo","image/vnd.adobe.photoshop","application/x-indesign","application/epub+zip","application/x-xpinstall","application/vnd.ms-powerpoint.slideshow.macroenabled.12","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.presentationml.slideshow","application/zip","application/x-tar","application/x-rar-compressed","application/gzip","application/x-bzip2","application/x-7z-compressed","application/x-apple-diskimage","application/vnd.apache.arrow.file","video/mp4","audio/midi","video/matroska","video/webm","video/quicktime","video/vnd.avi","audio/wav","audio/qcelp","audio/x-ms-asf","video/x-ms-asf","application/vnd.ms-asf","video/mpeg","video/3gpp","audio/mpeg","audio/mp4","video/ogg","audio/ogg","audio/ogg; codecs=opus","application/ogg","audio/flac","audio/ape","audio/wavpack","audio/amr","application/pdf","application/x-elf","application/x-mach-binary","application/x-msdownload","application/x-shockwave-flash","application/rtf","application/wasm","font/woff","font/woff2","application/vnd.ms-fontobject","font/ttf","font/otf","font/collection","image/x-icon","video/x-flv","application/postscript","application/eps","application/x-xz","application/x-sqlite3","application/x-nintendo-nes-rom","application/x-google-chrome-extension","application/vnd.ms-cab-compressed","application/x-deb","application/x-unix-archive","application/x-rpm","application/x-compress","application/x-lzip","application/x-cfb","application/x-mie","application/mxf","video/mp2t","application/x-blender","image/bpg","image/j2c","image/jp2","image/jpx","image/jpm","image/mj2","audio/aiff","application/xml","application/x-mobipocket-ebook","image/heif","image/heif-sequence","image/heic","image/heic-sequence","image/icns","image/ktx","application/dicom","audio/x-musepack","text/calendar","text/vcard","text/vtt","model/gltf-binary","application/vnd.tcpdump.pcap","audio/x-dsf","application/x.ms.shortcut","application/x.apple.alias","audio/x-voc","audio/vnd.dolby.dd-raw","audio/x-m4a","image/apng","image/x-olympus-orf","image/x-sony-arw","image/x-adobe-dng","image/x-nikon-nef","image/x-panasonic-rw2","image/x-fujifilm-raf","video/x-m4v","video/3gpp2","application/x-esri-shape","audio/aac","audio/x-it","audio/x-s3m","audio/x-xm","video/MP1S","video/MP2P","application/vnd.sketchup.skp","image/avif","application/x-lzh-compressed","application/pgp-encrypted","application/x-asar","model/stl","application/vnd.ms-htmlhelp","model/3mf","image/jxl","application/zstd","image/jls","application/vnd.ms-outlook","image/vnd.dwg","application/vnd.apache.parquet","application/java-vm","application/x-arj","application/x-cpio","application/x-ace-compressed","application/avro","application/vnd.iccprofile","application/x.autodesk.fbx","application/vnd.visio","application/vnd.android.package-archive","application/vnd.google.draco","application/x-lz4","application/vnd.openxmlformats-officedocument.presentationml.template","application/vnd.openxmlformats-officedocument.spreadsheetml.template","application/vnd.openxmlformats-officedocument.wordprocessingml.template","application/vnd.ms-excel.template.macroenabled.12","application/vnd.oasis.opendocument.text-template","application/vnd.oasis.opendocument.spreadsheet-template","application/vnd.oasis.opendocument.presentation-template","application/vnd.oasis.opendocument.graphics","application/vnd.oasis.opendocument.graphics-template","application/vnd.ms-excel.sheet.macroenabled.12","application/vnd.ms-word.document.macroenabled.12","application/vnd.ms-word.template.macroenabled.12","application/vnd.ms-powerpoint.template.macroenabled.12","application/vnd.ms-powerpoint.presentation.macroenabled.12","application/java-archive","application/vnd.rn-realmedia","application/x-ms-regedit","application/x-ft-windows-registry-hive"]});async function fileTypeFromBuffer(input,options){return new FileTypeParser(options).fromBuffer(input)}async function fileTypeFromBlob(blob,options){return new FileTypeParser(options).fromBlob(blob)}function getFileTypeFromMimeType(mimeType){switch(mimeType=mimeType.toLowerCase(),mimeType){case"application/epub+zip":return{ext:"epub",mime:mimeType};case"application/vnd.oasis.opendocument.text":return{ext:"odt",mime:mimeType};case"application/vnd.oasis.opendocument.text-template":return{ext:"ott",mime:mimeType};case"application/vnd.oasis.opendocument.spreadsheet":return{ext:"ods",mime:mimeType};case"application/vnd.oasis.opendocument.spreadsheet-template":return{ext:"ots",mime:mimeType};case"application/vnd.oasis.opendocument.presentation":return{ext:"odp",mime:mimeType};case"application/vnd.oasis.opendocument.presentation-template":return{ext:"otp",mime:mimeType};case"application/vnd.oasis.opendocument.graphics":return{ext:"odg",mime:mimeType};case"application/vnd.oasis.opendocument.graphics-template":return{ext:"otg",mime:mimeType};case"application/vnd.openxmlformats-officedocument.presentationml.slideshow":return{ext:"ppsx",mime:mimeType};case"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":return{ext:"xlsx",mime:mimeType};case"application/vnd.ms-excel.sheet.macroenabled":return{ext:"xlsm",mime:"application/vnd.ms-excel.sheet.macroenabled.12"};case"application/vnd.openxmlformats-officedocument.spreadsheetml.template":return{ext:"xltx",mime:mimeType};case"application/vnd.ms-excel.template.macroenabled":return{ext:"xltm",mime:"application/vnd.ms-excel.template.macroenabled.12"};case"application/vnd.ms-powerpoint.slideshow.macroenabled":return{ext:"ppsm",mime:"application/vnd.ms-powerpoint.slideshow.macroenabled.12"};case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":return{ext:"docx",mime:mimeType};case"application/vnd.ms-word.document.macroenabled":return{ext:"docm",mime:"application/vnd.ms-word.document.macroenabled.12"};case"application/vnd.openxmlformats-officedocument.wordprocessingml.template":return{ext:"dotx",mime:mimeType};case"application/vnd.ms-word.template.macroenabledtemplate":return{ext:"dotm",mime:"application/vnd.ms-word.template.macroenabled.12"};case"application/vnd.openxmlformats-officedocument.presentationml.template":return{ext:"potx",mime:mimeType};case"application/vnd.ms-powerpoint.template.macroenabled":return{ext:"potm",mime:"application/vnd.ms-powerpoint.template.macroenabled.12"};case"application/vnd.openxmlformats-officedocument.presentationml.presentation":return{ext:"pptx",mime:mimeType};case"application/vnd.ms-powerpoint.presentation.macroenabled":return{ext:"pptm",mime:"application/vnd.ms-powerpoint.presentation.macroenabled.12"};case"application/vnd.ms-visio.drawing":return{ext:"vsdx",mime:"application/vnd.visio"};case"application/vnd.ms-package.3dmanufacturing-3dmodel+xml":return{ext:"3mf",mime:"model/3mf"};default:}}function _check(buffer,headers,options){options={offset:0,...options};for(let[index,header]of headers.entries())if(options.mask){if(header!==(options.mask[index]&buffer[index+options.offset]))return!1}else if(header!==buffer[index+options.offset])return!1;return!0}async function fileTypeFromTokenizer(tokenizer,options){return new FileTypeParser(options).fromTokenizer(tokenizer)}class FileTypeParser{constructor(options){this.options={mpegOffsetTolerance:0,...options},this.detectors=[...options?.customDetectors??[],{id:"core",detect:this.detectConfident},{id:"core.imprecise",detect:this.detectImprecise}],this.tokenizerOptions={abortSignal:options?.signal}}async fromTokenizer(tokenizer){let initialPosition=tokenizer.position;for(let detector of this.detectors){let fileType=await detector.detect(tokenizer);if(fileType)return fileType;if(initialPosition!==tokenizer.position)return}}async fromBuffer(input){if(!(input instanceof Uint8Array||input instanceof ArrayBuffer))throw TypeError(`Expected the \`input\` argument to be of type \`Uint8Array\` or \`ArrayBuffer\`, got \`${typeof input}\``);let buffer=input instanceof Uint8Array?input:new Uint8Array(input);if(!(buffer?.length>1))return;return this.fromTokenizer(fromBuffer(buffer,this.tokenizerOptions))}async fromBlob(blob){let tokenizer=fromBlob(blob,this.tokenizerOptions);try{return await this.fromTokenizer(tokenizer)}finally{await tokenizer.close()}}async fromStream(stream){let tokenizer=fromWebStream(stream,this.tokenizerOptions);try{return await this.fromTokenizer(tokenizer)}finally{await tokenizer.close()}}async toDetectionStream(stream,options){let{sampleSize=reasonableDetectionSizeInBytes}=options,detectedFileType,firstChunk,reader=stream.getReader({mode:"byob"});try{let{value:chunk,done}=await reader.read(new Uint8Array(sampleSize));if(firstChunk=chunk,!done&&chunk)try{detectedFileType=await this.fromBuffer(chunk.subarray(0,sampleSize))}catch(error){if(!(error instanceof EndOfStreamError))throw error;detectedFileType=void 0}firstChunk=chunk}finally{reader.releaseLock()}let transformStream=new TransformStream({async start(controller){controller.enqueue(firstChunk)},transform(chunk,controller){controller.enqueue(chunk)}}),newStream=stream.pipeThrough(transformStream);return newStream.fileType=detectedFileType,newStream}check(header,options){return _check(this.buffer,header,options)}checkString(header,options){return this.check(stringToBytes(header,options?.encoding),options)}detectConfident=async(tokenizer)=>{if(this.buffer=new Uint8Array(reasonableDetectionSizeInBytes),tokenizer.fileInfo.size===void 0)tokenizer.fileInfo.size=Number.MAX_SAFE_INTEGER;if(this.tokenizer=tokenizer,await tokenizer.peekBuffer(this.buffer,{length:32,mayBeLess:!0}),this.check([66,77]))return{ext:"bmp",mime:"image/bmp"};if(this.check([11,119]))return{ext:"ac3",mime:"audio/vnd.dolby.dd-raw"};if(this.check([120,1]))return{ext:"dmg",mime:"application/x-apple-diskimage"};if(this.check([77,90]))return{ext:"exe",mime:"application/x-msdownload"};if(this.check([37,33])){if(await tokenizer.peekBuffer(this.buffer,{length:24,mayBeLess:!0}),this.checkString("PS-Adobe-",{offset:2})&&this.checkString(" EPSF-",{offset:14}))return{ext:"eps",mime:"application/eps"};return{ext:"ps",mime:"application/postscript"}}if(this.check([31,160])||this.check([31,157]))return{ext:"Z",mime:"application/x-compress"};if(this.check([199,113]))return{ext:"cpio",mime:"application/x-cpio"};if(this.check([96,234]))return{ext:"arj",mime:"application/x-arj"};if(this.check([239,187,191]))return this.tokenizer.ignore(3),this.detectConfident(tokenizer);if(this.check([71,73,70]))return{ext:"gif",mime:"image/gif"};if(this.check([73,73,188]))return{ext:"jxr",mime:"image/vnd.ms-photo"};if(this.check([31,139,8])){let stream=new GzipHandler(tokenizer).inflate(),shouldCancelStream=!0;try{let compressedFileType;try{compressedFileType=await this.fromStream(stream)}catch{shouldCancelStream=!1}if(compressedFileType&&compressedFileType.ext==="tar")return{ext:"tar.gz",mime:"application/gzip"}}finally{if(shouldCancelStream)await stream.cancel()}return{ext:"gz",mime:"application/gzip"}}if(this.check([66,90,104]))return{ext:"bz2",mime:"application/x-bzip2"};if(this.checkString("ID3")){await tokenizer.ignore(6);let id3HeaderLength=await tokenizer.readToken(uint32SyncSafeToken);if(tokenizer.position+id3HeaderLength>tokenizer.fileInfo.size)return{ext:"mp3",mime:"audio/mpeg"};return await tokenizer.ignore(id3HeaderLength),this.fromTokenizer(tokenizer)}if(this.checkString("MP+"))return{ext:"mpc",mime:"audio/x-musepack"};if((this.buffer[0]===67||this.buffer[0]===70)&&this.check([87,83],{offset:1}))return{ext:"swf",mime:"application/x-shockwave-flash"};if(this.check([255,216,255])){if(this.check([247],{offset:3}))return{ext:"jls",mime:"image/jls"};return{ext:"jpg",mime:"image/jpeg"}}if(this.check([79,98,106,1]))return{ext:"avro",mime:"application/avro"};if(this.checkString("FLIF"))return{ext:"flif",mime:"image/flif"};if(this.checkString("8BPS"))return{ext:"psd",mime:"image/vnd.adobe.photoshop"};if(this.checkString("MPCK"))return{ext:"mpc",mime:"audio/x-musepack"};if(this.checkString("FORM"))return{ext:"aif",mime:"audio/aiff"};if(this.checkString("icns",{offset:0}))return{ext:"icns",mime:"image/icns"};if(this.check([80,75,3,4])){let fileType;return await new ZipHandler(tokenizer).unzip((zipHeader)=>{switch(zipHeader.filename){case"META-INF/mozilla.rsa":return fileType={ext:"xpi",mime:"application/x-xpinstall"},{stop:!0};case"META-INF/MANIFEST.MF":return fileType={ext:"jar",mime:"application/java-archive"},{stop:!0};case"mimetype":return{async handler(fileData){let mimeType=new TextDecoder("utf-8").decode(fileData).trim();fileType=getFileTypeFromMimeType(mimeType)},stop:!0};case"[Content_Types].xml":return{async handler(fileData){let xmlContent=new TextDecoder("utf-8").decode(fileData),endPos=xmlContent.indexOf('.main+xml"');if(endPos===-1){if(xmlContent.includes('ContentType="application/vnd.ms-package.3dmanufacturing-3dmodel+xml"'))fileType=getFileTypeFromMimeType("application/vnd.ms-package.3dmanufacturing-3dmodel+xml")}else{xmlContent=xmlContent.slice(0,Math.max(0,endPos));let firstPos=xmlContent.lastIndexOf('"'),mimeType=xmlContent.slice(Math.max(0,firstPos+1));fileType=getFileTypeFromMimeType(mimeType)}},stop:!0};default:if(/classes\d*\.dex/.test(zipHeader.filename))return fileType={ext:"apk",mime:"application/vnd.android.package-archive"},{stop:!0};return{}}}).catch((error)=>{if(!(error instanceof EndOfStreamError))throw error}),fileType??{ext:"zip",mime:"application/zip"}}if(this.checkString("OggS")){await tokenizer.ignore(28);let type=new Uint8Array(8);if(await tokenizer.readBuffer(type),_check(type,[79,112,117,115,72,101,97,100]))return{ext:"opus",mime:"audio/ogg; codecs=opus"};if(_check(type,[128,116,104,101,111,114,97]))return{ext:"ogv",mime:"video/ogg"};if(_check(type,[1,118,105,100,101,111,0]))return{ext:"ogm",mime:"video/ogg"};if(_check(type,[127,70,76,65,67]))return{ext:"oga",mime:"audio/ogg"};if(_check(type,[83,112,101,101,120,32,32]))return{ext:"spx",mime:"audio/ogg"};if(_check(type,[1,118,111,114,98,105,115]))return{ext:"ogg",mime:"audio/ogg"};return{ext:"ogx",mime:"application/ogg"}}if(this.check([80,75])&&(this.buffer[2]===3||this.buffer[2]===5||this.buffer[2]===7)&&(this.buffer[3]===4||this.buffer[3]===6||this.buffer[3]===8))return{ext:"zip",mime:"application/zip"};if(this.checkString("MThd"))return{ext:"mid",mime:"audio/midi"};if(this.checkString("wOFF")&&(this.check([0,1,0,0],{offset:4})||this.checkString("OTTO",{offset:4})))return{ext:"woff",mime:"font/woff"};if(this.checkString("wOF2")&&(this.check([0,1,0,0],{offset:4})||this.checkString("OTTO",{offset:4})))return{ext:"woff2",mime:"font/woff2"};if(this.check([212,195,178,161])||this.check([161,178,195,212]))return{ext:"pcap",mime:"application/vnd.tcpdump.pcap"};if(this.checkString("DSD "))return{ext:"dsf",mime:"audio/x-dsf"};if(this.checkString("LZIP"))return{ext:"lz",mime:"application/x-lzip"};if(this.checkString("fLaC"))return{ext:"flac",mime:"audio/flac"};if(this.check([66,80,71,251]))return{ext:"bpg",mime:"image/bpg"};if(this.checkString("wvpk"))return{ext:"wv",mime:"audio/wavpack"};if(this.checkString("%PDF"))return{ext:"pdf",mime:"application/pdf"};if(this.check([0,97,115,109]))return{ext:"wasm",mime:"application/wasm"};if(this.check([73,73])){let fileType=await this.readTiffHeader(!1);if(fileType)return fileType}if(this.check([77,77])){let fileType=await this.readTiffHeader(!0);if(fileType)return fileType}if(this.checkString("MAC "))return{ext:"ape",mime:"audio/ape"};if(this.check([26,69,223,163])){async function readField(){let msb=await tokenizer.peekNumber(UINT8),mask=128,ic=0;while((msb&mask)===0&&mask!==0)++ic,mask>>=1;let id=new Uint8Array(ic+1);return await tokenizer.readBuffer(id),id}async function readElement(){let idField=await readField(),lengthField=await readField();lengthField[0]^=128>>lengthField.length-1;let nrLength=Math.min(6,lengthField.length),idView=new DataView(idField.buffer),lengthView=new DataView(lengthField.buffer,lengthField.length-nrLength,nrLength);return{id:getUintBE(idView),len:getUintBE(lengthView)}}async function readChildren(children){while(children>0){let element=await readElement();if(element.id===17026)return(await tokenizer.readToken(new StringType2(element.len))).replaceAll(/\00.*$/g,"");await tokenizer.ignore(element.len),--children}}let re=await readElement();switch(await readChildren(re.len)){case"webm":return{ext:"webm",mime:"video/webm"};case"matroska":return{ext:"mkv",mime:"video/matroska"};default:return}}if(this.checkString("SQLi"))return{ext:"sqlite",mime:"application/x-sqlite3"};if(this.check([78,69,83,26]))return{ext:"nes",mime:"application/x-nintendo-nes-rom"};if(this.checkString("Cr24"))return{ext:"crx",mime:"application/x-google-chrome-extension"};if(this.checkString("MSCF")||this.checkString("ISc("))return{ext:"cab",mime:"application/vnd.ms-cab-compressed"};if(this.check([237,171,238,219]))return{ext:"rpm",mime:"application/x-rpm"};if(this.check([197,208,211,198]))return{ext:"eps",mime:"application/eps"};if(this.check([40,181,47,253]))return{ext:"zst",mime:"application/zstd"};if(this.check([127,69,76,70]))return{ext:"elf",mime:"application/x-elf"};if(this.check([33,66,68,78]))return{ext:"pst",mime:"application/vnd.ms-outlook"};if(this.checkString("PAR1")||this.checkString("PARE"))return{ext:"parquet",mime:"application/vnd.apache.parquet"};if(this.checkString("ttcf"))return{ext:"ttc",mime:"font/collection"};if(this.check([207,250,237,254]))return{ext:"macho",mime:"application/x-mach-binary"};if(this.check([4,34,77,24]))return{ext:"lz4",mime:"application/x-lz4"};if(this.checkString("regf"))return{ext:"dat",mime:"application/x-ft-windows-registry-hive"};if(this.check([79,84,84,79,0]))return{ext:"otf",mime:"font/otf"};if(this.checkString("#!AMR"))return{ext:"amr",mime:"audio/amr"};if(this.checkString("{\\rtf"))return{ext:"rtf",mime:"application/rtf"};if(this.check([70,76,86,1]))return{ext:"flv",mime:"video/x-flv"};if(this.checkString("IMPM"))return{ext:"it",mime:"audio/x-it"};if(this.checkString("-lh0-",{offset:2})||this.checkString("-lh1-",{offset:2})||this.checkString("-lh2-",{offset:2})||this.checkString("-lh3-",{offset:2})||this.checkString("-lh4-",{offset:2})||this.checkString("-lh5-",{offset:2})||this.checkString("-lh6-",{offset:2})||this.checkString("-lh7-",{offset:2})||this.checkString("-lzs-",{offset:2})||this.checkString("-lz4-",{offset:2})||this.checkString("-lz5-",{offset:2})||this.checkString("-lhd-",{offset:2}))return{ext:"lzh",mime:"application/x-lzh-compressed"};if(this.check([0,0,1,186])){if(this.check([33],{offset:4,mask:[241]}))return{ext:"mpg",mime:"video/MP1S"};if(this.check([68],{offset:4,mask:[196]}))return{ext:"mpg",mime:"video/MP2P"}}if(this.checkString("ITSF"))return{ext:"chm",mime:"application/vnd.ms-htmlhelp"};if(this.check([202,254,186,190]))return{ext:"class",mime:"application/java-vm"};if(this.checkString(".RMF"))return{ext:"rm",mime:"application/vnd.rn-realmedia"};if(this.checkString("DRACO"))return{ext:"drc",mime:"application/vnd.google.draco"};if(this.check([253,55,122,88,90,0]))return{ext:"xz",mime:"application/x-xz"};if(this.checkString("<?xml "))return{ext:"xml",mime:"application/xml"};if(this.check([55,122,188,175,39,28]))return{ext:"7z",mime:"application/x-7z-compressed"};if(this.check([82,97,114,33,26,7])&&(this.buffer[6]===0||this.buffer[6]===1))return{ext:"rar",mime:"application/x-rar-compressed"};if(this.checkString("solid "))return{ext:"stl",mime:"model/stl"};if(this.checkString("AC")){let version=new StringType2(4,"latin1").get(this.buffer,2);if(version.match("^d*")&&version>=1000&&version<=1050)return{ext:"dwg",mime:"image/vnd.dwg"}}if(this.checkString("070707"))return{ext:"cpio",mime:"application/x-cpio"};if(this.checkString("BLENDER"))return{ext:"blend",mime:"application/x-blender"};if(this.checkString("!<arch>")){if(await tokenizer.ignore(8),await tokenizer.readToken(new StringType2(13,"ascii"))==="debian-binary")return{ext:"deb",mime:"application/x-deb"};return{ext:"ar",mime:"application/x-unix-archive"}}if(this.checkString("WEBVTT")&&[`
`,"\r","\t"," ","\x00"].some((char7)=>this.checkString(char7,{offset:6})))return{ext:"vtt",mime:"text/vtt"};if(this.check([137,80,78,71,13,10,26,10])){await tokenizer.ignore(8);async function readChunkHeader(){return{length:await tokenizer.readToken(INT32_BE),type:await tokenizer.readToken(new StringType2(4,"latin1"))}}do{let chunk=await readChunkHeader();if(chunk.length<0)return;switch(chunk.type){case"IDAT":return{ext:"png",mime:"image/png"};case"acTL":return{ext:"apng",mime:"image/apng"};default:await tokenizer.ignore(chunk.length+4)}}while(tokenizer.position+8<tokenizer.fileInfo.size);return{ext:"png",mime:"image/png"}}if(this.check([65,82,82,79,87,49,0,0]))return{ext:"arrow",mime:"application/vnd.apache.arrow.file"};if(this.check([103,108,84,70,2,0,0,0]))return{ext:"glb",mime:"model/gltf-binary"};if(this.check([102,114,101,101],{offset:4})||this.check([109,100,97,116],{offset:4})||this.check([109,111,111,118],{offset:4})||this.check([119,105,100,101],{offset:4}))return{ext:"mov",mime:"video/quicktime"};if(this.check([73,73,82,79,8,0,0,0,24]))return{ext:"orf",mime:"image/x-olympus-orf"};if(this.checkString("gimp xcf "))return{ext:"xcf",mime:"image/x-xcf"};if(this.checkString("ftyp",{offset:4})&&(this.buffer[8]&96)!==0){let brandMajor=new StringType2(4,"latin1").get(this.buffer,8).replace("\x00"," ").trim();switch(brandMajor){case"avif":case"avis":return{ext:"avif",mime:"image/avif"};case"mif1":return{ext:"heic",mime:"image/heif"};case"msf1":return{ext:"heic",mime:"image/heif-sequence"};case"heic":case"heix":return{ext:"heic",mime:"image/heic"};case"hevc":case"hevx":return{ext:"heic",mime:"image/heic-sequence"};case"qt":return{ext:"mov",mime:"video/quicktime"};case"M4V":case"M4VH":case"M4VP":return{ext:"m4v",mime:"video/x-m4v"};case"M4P":return{ext:"m4p",mime:"video/mp4"};case"M4B":return{ext:"m4b",mime:"audio/mp4"};case"M4A":return{ext:"m4a",mime:"audio/x-m4a"};case"F4V":return{ext:"f4v",mime:"video/mp4"};case"F4P":return{ext:"f4p",mime:"video/mp4"};case"F4A":return{ext:"f4a",mime:"audio/mp4"};case"F4B":return{ext:"f4b",mime:"audio/mp4"};case"crx":return{ext:"cr3",mime:"image/x-canon-cr3"};default:if(brandMajor.startsWith("3g")){if(brandMajor.startsWith("3g2"))return{ext:"3g2",mime:"video/3gpp2"};return{ext:"3gp",mime:"video/3gpp"}}return{ext:"mp4",mime:"video/mp4"}}}if(this.checkString(`REGEDIT4\r
`))return{ext:"reg",mime:"application/x-ms-regedit"};if(this.check([82,73,70,70])){if(this.checkString("WEBP",{offset:8}))return{ext:"webp",mime:"image/webp"};if(this.check([65,86,73],{offset:8}))return{ext:"avi",mime:"video/vnd.avi"};if(this.check([87,65,86,69],{offset:8}))return{ext:"wav",mime:"audio/wav"};if(this.check([81,76,67,77],{offset:8}))return{ext:"qcp",mime:"audio/qcelp"}}if(this.check([73,73,85,0,24,0,0,0,136,231,116,216]))return{ext:"rw2",mime:"image/x-panasonic-rw2"};if(this.check([48,38,178,117,142,102,207,17,166,217])){async function readHeader(){let guid=new Uint8Array(16);return await tokenizer.readBuffer(guid),{id:guid,size:Number(await tokenizer.readToken(UINT64_LE))}}await tokenizer.ignore(30);while(tokenizer.position+24<tokenizer.fileInfo.size){let header=await readHeader(),payload=header.size-24;if(_check(header.id,[145,7,220,183,183,169,207,17,142,230,0,192,12,32,83,101])){let typeId=new Uint8Array(16);if(payload-=await tokenizer.readBuffer(typeId),_check(typeId,[64,158,105,248,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"audio/x-ms-asf"};if(_check(typeId,[192,239,25,188,77,91,207,17,168,253,0,128,95,92,68,43]))return{ext:"asf",mime:"video/x-ms-asf"};break}await tokenizer.ignore(payload)}return{ext:"asf",mime:"application/vnd.ms-asf"}}if(this.check([171,75,84,88,32,49,49,187,13,10,26,10]))return{ext:"ktx",mime:"image/ktx"};if((this.check([126,16,4])||this.check([126,24,4]))&&this.check([48,77,73,69],{offset:4}))return{ext:"mie",mime:"application/x-mie"};if(this.check([39,10,0,0,0,0,0,0,0,0,0,0],{offset:2}))return{ext:"shp",mime:"application/x-esri-shape"};if(this.check([255,79,255,81]))return{ext:"j2c",mime:"image/j2c"};if(this.check([0,0,0,12,106,80,32,32,13,10,135,10]))switch(await tokenizer.ignore(20),await tokenizer.readToken(new StringType2(4,"ascii"))){case"jp2 ":return{ext:"jp2",mime:"image/jp2"};case"jpx ":return{ext:"jpx",mime:"image/jpx"};case"jpm ":return{ext:"jpm",mime:"image/jpm"};case"mjp2":return{ext:"mj2",mime:"image/mj2"};default:return}if(this.check([255,10])||this.check([0,0,0,12,74,88,76,32,13,10,135,10]))return{ext:"jxl",mime:"image/jxl"};if(this.check([254,255])){if(this.checkString("<?xml ",{offset:2,encoding:"utf-16be"}))return{ext:"xml",mime:"application/xml"};return}if(this.check([208,207,17,224,161,177,26,225]))return{ext:"cfb",mime:"application/x-cfb"};if(await tokenizer.peekBuffer(this.buffer,{length:Math.min(256,tokenizer.fileInfo.size),mayBeLess:!0}),this.check([97,99,115,112],{offset:36}))return{ext:"icc",mime:"application/vnd.iccprofile"};if(this.checkString("**ACE",{offset:7})&&this.checkString("**",{offset:12}))return{ext:"ace",mime:"application/x-ace-compressed"};if(this.checkString("BEGIN:")){if(this.checkString("VCARD",{offset:6}))return{ext:"vcf",mime:"text/vcard"};if(this.checkString("VCALENDAR",{offset:6}))return{ext:"ics",mime:"text/calendar"}}if(this.checkString("FUJIFILMCCD-RAW"))return{ext:"raf",mime:"image/x-fujifilm-raf"};if(this.checkString("Extended Module:"))return{ext:"xm",mime:"audio/x-xm"};if(this.checkString("Creative Voice File"))return{ext:"voc",mime:"audio/x-voc"};if(this.check([4,0,0,0])&&this.buffer.length>=16){let jsonSize=new DataView(this.buffer.buffer).getUint32(12,!0);if(jsonSize>12&&this.buffer.length>=jsonSize+16)try{let header=new TextDecoder().decode(this.buffer.subarray(16,jsonSize+16));if(JSON.parse(header).files)return{ext:"asar",mime:"application/x-asar"}}catch{}}if(this.check([6,14,43,52,2,5,1,1,13,1,2,1,1,2]))return{ext:"mxf",mime:"application/mxf"};if(this.checkString("SCRM",{offset:44}))return{ext:"s3m",mime:"audio/x-s3m"};if(this.check([71])&&this.check([71],{offset:188}))return{ext:"mts",mime:"video/mp2t"};if(this.check([71],{offset:4})&&this.check([71],{offset:196}))return{ext:"mts",mime:"video/mp2t"};if(this.check([66,79,79,75,77,79,66,73],{offset:60}))return{ext:"mobi",mime:"application/x-mobipocket-ebook"};if(this.check([68,73,67,77],{offset:128}))return{ext:"dcm",mime:"application/dicom"};if(this.check([76,0,0,0,1,20,2,0,0,0,0,0,192,0,0,0,0,0,0,70]))return{ext:"lnk",mime:"application/x.ms.shortcut"};if(this.check([98,111,111,107,0,0,0,0,109,97,114,107,0,0,0,0]))return{ext:"alias",mime:"application/x.apple.alias"};if(this.checkString("Kaydara FBX Binary  \x00"))return{ext:"fbx",mime:"application/x.autodesk.fbx"};if(this.check([76,80],{offset:34})&&(this.check([0,0,1],{offset:8})||this.check([1,0,2],{offset:8})||this.check([2,0,2],{offset:8})))return{ext:"eot",mime:"application/vnd.ms-fontobject"};if(this.check([6,6,237,245,216,29,70,229,189,49,239,231,254,116,183,29]))return{ext:"indd",mime:"application/x-indesign"};if(await tokenizer.peekBuffer(this.buffer,{length:Math.min(512,tokenizer.fileInfo.size),mayBeLess:!0}),this.checkString("ustar",{offset:257})&&(this.checkString("\x00",{offset:262})||this.checkString(" ",{offset:262}))||this.check([0,0,0,0,0,0],{offset:257})&&tarHeaderChecksumMatches(this.buffer))return{ext:"tar",mime:"application/x-tar"};if(this.check([255,254])){if(this.checkString("<?xml ",{offset:2,encoding:"utf-16le"}))return{ext:"xml",mime:"application/xml"};if(this.check([255,14],{offset:2})&&this.checkString("SketchUp Model",{offset:4,encoding:"utf-16le"}))return{ext:"skp",mime:"application/vnd.sketchup.skp"};if(this.checkString(`Windows Registry Editor Version 5.00\r
`,{offset:2,encoding:"utf-16le"}))return{ext:"reg",mime:"application/x-ms-regedit"};return}if(this.checkString("-----BEGIN PGP MESSAGE-----"))return{ext:"pgp",mime:"application/pgp-encrypted"}};detectImprecise=async(tokenizer)=>{if(this.buffer=new Uint8Array(reasonableDetectionSizeInBytes),await tokenizer.peekBuffer(this.buffer,{length:Math.min(8,tokenizer.fileInfo.size),mayBeLess:!0}),this.check([0,0,1,186])||this.check([0,0,1,179]))return{ext:"mpg",mime:"video/mpeg"};if(this.check([0,1,0,0,0]))return{ext:"ttf",mime:"font/ttf"};if(this.check([0,0,1,0]))return{ext:"ico",mime:"image/x-icon"};if(this.check([0,0,2,0]))return{ext:"cur",mime:"image/x-icon"};if(await tokenizer.peekBuffer(this.buffer,{length:Math.min(2+this.options.mpegOffsetTolerance,tokenizer.fileInfo.size),mayBeLess:!0}),this.buffer.length>=2+this.options.mpegOffsetTolerance)for(let depth=0;depth<=this.options.mpegOffsetTolerance;++depth){let type=this.scanMpeg(depth);if(type)return type}};async readTiffTag(bigEndian){let tagId=await this.tokenizer.readToken(bigEndian?UINT16_BE:UINT16_LE);switch(this.tokenizer.ignore(10),tagId){case 50341:return{ext:"arw",mime:"image/x-sony-arw"};case 50706:return{ext:"dng",mime:"image/x-adobe-dng"};default:}}async readTiffIFD(bigEndian){let numberOfTags=await this.tokenizer.readToken(bigEndian?UINT16_BE:UINT16_LE);for(let n=0;n<numberOfTags;++n){let fileType=await this.readTiffTag(bigEndian);if(fileType)return fileType}}async readTiffHeader(bigEndian){let version=(bigEndian?UINT16_BE:UINT16_LE).get(this.buffer,2),ifdOffset=(bigEndian?UINT32_BE:UINT32_LE).get(this.buffer,4);if(version===42){if(ifdOffset>=6){if(this.checkString("CR",{offset:8}))return{ext:"cr2",mime:"image/x-canon-cr2"};if(ifdOffset>=8){let someId1=(bigEndian?UINT16_BE:UINT16_LE).get(this.buffer,8),someId2=(bigEndian?UINT16_BE:UINT16_LE).get(this.buffer,10);if(someId1===28&&someId2===254||someId1===31&&someId2===11)return{ext:"nef",mime:"image/x-nikon-nef"}}}return await this.tokenizer.ignore(ifdOffset),await this.readTiffIFD(bigEndian)??{ext:"tif",mime:"image/tiff"}}if(version===43)return{ext:"tif",mime:"image/tiff"}}scanMpeg(offset){if(this.check([255,224],{offset,mask:[255,224]})){if(this.check([16],{offset:offset+1,mask:[22]})){if(this.check([8],{offset:offset+1,mask:[8]}))return{ext:"aac",mime:"audio/aac"};return{ext:"aac",mime:"audio/aac"}}if(this.check([2],{offset:offset+1,mask:[6]}))return{ext:"mp3",mime:"audio/mpeg"};if(this.check([4],{offset:offset+1,mask:[6]}))return{ext:"mp2",mime:"audio/mpeg"};if(this.check([6],{offset:offset+1,mask:[6]}))return{ext:"mp1",mime:"audio/mpeg"}}}}var reasonableDetectionSizeInBytes=4100,supportedExtensions,supportedMimeTypes;var init_core2=__esm(()=>{init_lib3();init_core();init_lib4();init_uint8array_extras();init_util();init_supported();supportedExtensions=new Set(extensions),supportedMimeTypes=new Set(mimeTypes)});var exports_file_type={};__export(exports_file_type,{supportedMimeTypes:()=>supportedMimeTypes,supportedExtensions:()=>supportedExtensions,fileTypeStream:()=>fileTypeStream,fileTypeFromTokenizer:()=>fileTypeFromTokenizer,fileTypeFromStream:()=>fileTypeFromStream,fileTypeFromFile:()=>fileTypeFromFile,fileTypeFromBuffer:()=>fileTypeFromBuffer,fileTypeFromBlob:()=>fileTypeFromBlob,FileTypeParser:()=>FileTypeParser2});import{ReadableStream as WebReadableStream}from"stream/web";import{pipeline,PassThrough,Readable}from"stream";async function fileTypeFromFile(path,options){return new FileTypeParser2(options).fromFile(path,options)}async function fileTypeFromStream(stream,options){return new FileTypeParser2(options).fromStream(stream)}async function fileTypeStream(readableStream,options={}){return new FileTypeParser2(options).toDetectionStream(readableStream,options)}var FileTypeParser2;var init_file_type=__esm(()=>{init_lib();init_core2();init_core2();FileTypeParser2=class FileTypeParser2 extends FileTypeParser{async fromStream(stream){let tokenizer=await(stream instanceof WebReadableStream?fromWebStream(stream,this.tokenizerOptions):fromStream2(stream,this.tokenizerOptions));try{return await super.fromTokenizer(tokenizer)}finally{await tokenizer.close()}}async fromFile(path){let tokenizer=await fromFile(path);try{return await super.fromTokenizer(tokenizer)}finally{await tokenizer.close()}}async toDetectionStream(readableStream,options={}){if(!(readableStream instanceof Readable))return super.toDetectionStream(readableStream,options);let{sampleSize=reasonableDetectionSizeInBytes}=options;return new Promise((resolve,reject)=>{readableStream.on("error",reject),readableStream.once("readable",()=>{(async()=>{try{let pass=new PassThrough,outputStream=pipeline?pipeline(readableStream,pass,()=>{}):readableStream.pipe(pass),chunk=readableStream.read(sampleSize)??readableStream.read()??new Uint8Array(0);try{pass.fileType=await this.fromBuffer(chunk)}catch(error){if(error instanceof EndOfStreamError)pass.fileType=void 0;else reject(error)}resolve(outputStream)}catch(error){reject(error)}})()})})}}});var require_package=__commonJS((exports,module)=>{module.exports={name:"dotenv",version:"17.2.3",description:"Loads environment variables from .env file",main:"lib/main.js",types:"lib/main.d.ts",exports:{".":{types:"./lib/main.d.ts",require:"./lib/main.js",default:"./lib/main.js"},"./config":"./config.js","./config.js":"./config.js","./lib/env-options":"./lib/env-options.js","./lib/env-options.js":"./lib/env-options.js","./lib/cli-options":"./lib/cli-options.js","./lib/cli-options.js":"./lib/cli-options.js","./package.json":"./package.json"},scripts:{"dts-check":"tsc --project tests/types/tsconfig.json",lint:"standard",pretest:"npm run lint && npm run dts-check",test:"tap run tests/**/*.js --allow-empty-coverage --disable-coverage --timeout=60000","test:coverage":"tap run tests/**/*.js --show-full-coverage --timeout=60000 --coverage-report=text --coverage-report=lcov",prerelease:"npm test",release:"standard-version"},repository:{type:"git",url:"git://github.com/motdotla/dotenv.git"},homepage:"https://github.com/motdotla/dotenv#readme",funding:"https://dotenvx.com",keywords:["dotenv","env",".env","environment","variables","config","settings"],readmeFilename:"README.md",license:"BSD-2-Clause",devDependencies:{"@types/node":"^18.11.3",decache:"^4.6.2",sinon:"^14.0.1",standard:"^17.0.0","standard-version":"^9.5.0",tap:"^19.2.0",typescript:"^4.8.4"},engines:{node:">=12"},browser:{fs:!1}}});var require_main=__commonJS((exports,module)=>{var fs=__require("fs"),path=__require("path"),os=__require("os"),crypto2=__require("crypto"),packageJson=require_package(),version=packageJson.version,TIPS=["\uD83D\uDD10 encrypt with Dotenvx: https://dotenvx.com","\uD83D\uDD10 prevent committing .env to code: https://dotenvx.com/precommit","\uD83D\uDD10 prevent building .env in docker: https://dotenvx.com/prebuild","\uD83D\uDCE1 add observability to secrets: https://dotenvx.com/ops","\uD83D\uDC65 sync secrets across teammates & machines: https://dotenvx.com/ops","\uD83D\uDDC2\uFE0F backup and recover secrets: https://dotenvx.com/ops","\u2705 audit secrets and track compliance: https://dotenvx.com/ops","\uD83D\uDD04 add secrets lifecycle management: https://dotenvx.com/ops","\uD83D\uDD11 add access controls to secrets: https://dotenvx.com/ops","\uD83D\uDEE0\uFE0F  run anywhere with `dotenvx run -- yourcommand`","\u2699\uFE0F  specify custom .env file path with { path: '/custom/path/.env' }","\u2699\uFE0F  enable debug logging with { debug: true }","\u2699\uFE0F  override existing env vars with { override: true }","\u2699\uFE0F  suppress all logs with { quiet: true }","\u2699\uFE0F  write to custom object with { processEnv: myObject }","\u2699\uFE0F  load multiple .env files with { path: ['.env.local', '.env'] }"];function _getRandomTip(){return TIPS[Math.floor(Math.random()*TIPS.length)]}function parseBoolean(value){if(typeof value==="string")return!["false","0","no","off",""].includes(value.toLowerCase());return Boolean(value)}function supportsAnsi(){return process.stdout.isTTY}function dim(text){return supportsAnsi()?`\x1B[2m${text}\x1B[0m`:text}var LINE=/(?:^|^)\s*(?:export\s+)?([\w.-]+)(?:\s*=\s*?|:\s+?)(\s*'(?:\\'|[^'])*'|\s*"(?:\\"|[^"])*"|\s*`(?:\\`|[^`])*`|[^#\r\n]+)?\s*(?:#.*)?(?:$|$)/mg;function parse2(src){let obj={},lines=src.toString();lines=lines.replace(/\r\n?/mg,`
`);let match;while((match=LINE.exec(lines))!=null){let key=match[1],value=match[2]||"";value=value.trim();let maybeQuote=value[0];if(value=value.replace(/^(['"`])([\s\S]*)\1$/mg,"$2"),maybeQuote==='"')value=value.replace(/\\n/g,`
`),value=value.replace(/\\r/g,"\r");obj[key]=value}return obj}function _parseVault(options){options=options||{};let vaultPath=_vaultPath(options);options.path=vaultPath;let result=DotenvModule.configDotenv(options);if(!result.parsed){let err=Error(`MISSING_DATA: Cannot parse ${vaultPath} for an unknown reason`);throw err.code="MISSING_DATA",err}let keys=_dotenvKey(options).split(","),length=keys.length,decrypted;for(let i=0;i<length;i++)try{let key=keys[i].trim(),attrs=_instructions(result,key);decrypted=DotenvModule.decrypt(attrs.ciphertext,attrs.key);break}catch(error){if(i+1>=length)throw error}return DotenvModule.parse(decrypted)}function _warn(message){console.error(`[dotenv@${version}][WARN] ${message}`)}function _debug(message){console.log(`[dotenv@${version}][DEBUG] ${message}`)}function _log(message){console.log(`[dotenv@${version}] ${message}`)}function _dotenvKey(options){if(options&&options.DOTENV_KEY&&options.DOTENV_KEY.length>0)return options.DOTENV_KEY;if(process.env.DOTENV_KEY&&process.env.DOTENV_KEY.length>0)return process.env.DOTENV_KEY;return""}function _instructions(result,dotenvKey){let uri2;try{uri2=new URL(dotenvKey)}catch(error){if(error.code==="ERR_INVALID_URL"){let err=Error("INVALID_DOTENV_KEY: Wrong format. Must be in valid uri format like dotenv://:key_1234@dotenvx.com/vault/.env.vault?environment=development");throw err.code="INVALID_DOTENV_KEY",err}throw error}let key=uri2.password;if(!key){let err=Error("INVALID_DOTENV_KEY: Missing key part");throw err.code="INVALID_DOTENV_KEY",err}let environment=uri2.searchParams.get("environment");if(!environment){let err=Error("INVALID_DOTENV_KEY: Missing environment part");throw err.code="INVALID_DOTENV_KEY",err}let environmentKey=`DOTENV_VAULT_${environment.toUpperCase()}`,ciphertext=result.parsed[environmentKey];if(!ciphertext){let err=Error(`NOT_FOUND_DOTENV_ENVIRONMENT: Cannot locate environment ${environmentKey} in your .env.vault file.`);throw err.code="NOT_FOUND_DOTENV_ENVIRONMENT",err}return{ciphertext,key}}function _vaultPath(options){let possibleVaultPath=null;if(options&&options.path&&options.path.length>0)if(Array.isArray(options.path)){for(let filepath of options.path)if(fs.existsSync(filepath))possibleVaultPath=filepath.endsWith(".vault")?filepath:`${filepath}.vault`}else possibleVaultPath=options.path.endsWith(".vault")?options.path:`${options.path}.vault`;else possibleVaultPath=path.resolve(process.cwd(),".env.vault");if(fs.existsSync(possibleVaultPath))return possibleVaultPath;return null}function _resolveHome(envPath){return envPath[0]==="~"?path.join(os.homedir(),envPath.slice(1)):envPath}function _configVault(options){let debug2=parseBoolean(process.env.DOTENV_CONFIG_DEBUG||options&&options.debug),quiet=parseBoolean(process.env.DOTENV_CONFIG_QUIET||options&&options.quiet);if(debug2||!quiet)_log("Loading env from encrypted .env.vault");let parsed=DotenvModule._parseVault(options),processEnv=process.env;if(options&&options.processEnv!=null)processEnv=options.processEnv;return DotenvModule.populate(processEnv,parsed,options),{parsed}}function configDotenv(options){let dotenvPath=path.resolve(process.cwd(),".env"),encoding="utf8",processEnv=process.env;if(options&&options.processEnv!=null)processEnv=options.processEnv;let debug2=parseBoolean(processEnv.DOTENV_CONFIG_DEBUG||options&&options.debug),quiet=parseBoolean(processEnv.DOTENV_CONFIG_QUIET||options&&options.quiet);if(options&&options.encoding)encoding=options.encoding;else if(debug2)_debug("No encoding is specified. UTF-8 is used by default");let optionPaths=[dotenvPath];if(options&&options.path)if(!Array.isArray(options.path))optionPaths=[_resolveHome(options.path)];else{optionPaths=[];for(let filepath of options.path)optionPaths.push(_resolveHome(filepath))}let lastError,parsedAll={};for(let path2 of optionPaths)try{let parsed=DotenvModule.parse(fs.readFileSync(path2,{encoding}));DotenvModule.populate(parsedAll,parsed,options)}catch(e){if(debug2)_debug(`Failed to load ${path2} ${e.message}`);lastError=e}let populated=DotenvModule.populate(processEnv,parsedAll,options);if(debug2=parseBoolean(processEnv.DOTENV_CONFIG_DEBUG||debug2),quiet=parseBoolean(processEnv.DOTENV_CONFIG_QUIET||quiet),debug2||!quiet){let keysCount=Object.keys(populated).length,shortPaths=[];for(let filePath of optionPaths)try{let relative=path.relative(process.cwd(),filePath);shortPaths.push(relative)}catch(e){if(debug2)_debug(`Failed to load ${filePath} ${e.message}`);lastError=e}_log(`injecting env (${keysCount}) from ${shortPaths.join(",")} ${dim(`-- tip: ${_getRandomTip()}`)}`)}if(lastError)return{parsed:parsedAll,error:lastError};else return{parsed:parsedAll}}function config(options){if(_dotenvKey(options).length===0)return DotenvModule.configDotenv(options);let vaultPath=_vaultPath(options);if(!vaultPath)return _warn(`You set DOTENV_KEY but you are missing a .env.vault file at ${vaultPath}. Did you forget to build it?`),DotenvModule.configDotenv(options);return DotenvModule._configVault(options)}function decrypt(encrypted,keyStr){let key=Buffer.from(keyStr.slice(-64),"hex"),ciphertext=Buffer.from(encrypted,"base64"),nonce=ciphertext.subarray(0,12),authTag=ciphertext.subarray(-16);ciphertext=ciphertext.subarray(12,-16);try{let aesgcm=crypto2.createDecipheriv("aes-256-gcm",key,nonce);return aesgcm.setAuthTag(authTag),`${aesgcm.update(ciphertext)}${aesgcm.final()}`}catch(error){let isRange=error instanceof RangeError,invalidKeyLength=error.message==="Invalid key length",decryptionFailed=error.message==="Unsupported state or unable to authenticate data";if(isRange||invalidKeyLength){let err=Error("INVALID_DOTENV_KEY: It must be 64 characters long (or more)");throw err.code="INVALID_DOTENV_KEY",err}else if(decryptionFailed){let err=Error("DECRYPTION_FAILED: Please check your DOTENV_KEY");throw err.code="DECRYPTION_FAILED",err}else throw error}}function populate(processEnv,parsed,options={}){let debug2=Boolean(options&&options.debug),override=Boolean(options&&options.override),populated={};if(typeof parsed!=="object"){let err=Error("OBJECT_REQUIRED: Please check the processEnv argument being passed to populate");throw err.code="OBJECT_REQUIRED",err}for(let key of Object.keys(parsed))if(Object.prototype.hasOwnProperty.call(processEnv,key)){if(override===!0)processEnv[key]=parsed[key],populated[key]=parsed[key];if(debug2)if(override===!0)_debug(`"${key}" is already defined and WAS overwritten`);else _debug(`"${key}" is already defined and was NOT overwritten`)}else processEnv[key]=parsed[key],populated[key]=parsed[key];return populated}var DotenvModule={configDotenv,_configVault,_parseVault,config,decrypt,parse:parse2,populate};exports.configDotenv=DotenvModule.configDotenv;exports._configVault=DotenvModule._configVault;exports._parseVault=DotenvModule._parseVault;exports.config=DotenvModule.config;exports.decrypt=DotenvModule.decrypt;exports.parse=DotenvModule.parse;exports.populate=DotenvModule.populate;module.exports=DotenvModule});var require_env_options=__commonJS((exports,module)=>{var options={};if(process.env.DOTENV_CONFIG_ENCODING!=null)options.encoding=process.env.DOTENV_CONFIG_ENCODING;if(process.env.DOTENV_CONFIG_PATH!=null)options.path=process.env.DOTENV_CONFIG_PATH;if(process.env.DOTENV_CONFIG_QUIET!=null)options.quiet=process.env.DOTENV_CONFIG_QUIET;if(process.env.DOTENV_CONFIG_DEBUG!=null)options.debug=process.env.DOTENV_CONFIG_DEBUG;if(process.env.DOTENV_CONFIG_OVERRIDE!=null)options.override=process.env.DOTENV_CONFIG_OVERRIDE;if(process.env.DOTENV_CONFIG_DOTENV_KEY!=null)options.DOTENV_KEY=process.env.DOTENV_CONFIG_DOTENV_KEY;module.exports=options});var require_cli_options=__commonJS((exports,module)=>{var re=/^dotenv_config_(encoding|path|quiet|debug|override|DOTENV_KEY)=(.+)$/;module.exports=function(args){let options=args.reduce(function(acc,cur){let matches=cur.match(re);if(matches)acc[matches[1]]=matches[2];return acc},{});if(!("quiet"in options))options.quiet="true";return options}});var require_config=__commonJS(()=>{(function(){require_main().config(Object.assign({},require_env_options(),require_cli_options()(process.argv)))})()});var require_dist_cjs=__commonJS((exports)=>{exports.HttpAuthLocation=void 0;(function(HttpAuthLocation){HttpAuthLocation.HEADER="header",HttpAuthLocation.QUERY="query"})(exports.HttpAuthLocation||(exports.HttpAuthLocation={}));exports.HttpApiKeyAuthLocation=void 0;(function(HttpApiKeyAuthLocation){HttpApiKeyAuthLocation.HEADER="header",HttpApiKeyAuthLocation.QUERY="query"})(exports.HttpApiKeyAuthLocation||(exports.HttpApiKeyAuthLocation={}));exports.EndpointURLScheme=void 0;(function(EndpointURLScheme){EndpointURLScheme.HTTP="http",EndpointURLScheme.HTTPS="https"})(exports.EndpointURLScheme||(exports.EndpointURLScheme={}));exports.AlgorithmId=void 0;(function(AlgorithmId){AlgorithmId.MD5="md5",AlgorithmId.CRC32="crc32",AlgorithmId.CRC32C="crc32c",AlgorithmId.SHA1="sha1",AlgorithmId.SHA256="sha256"})(exports.AlgorithmId||(exports.AlgorithmId={}));var getChecksumConfiguration=(runtimeConfig)=>{let checksumAlgorithms=[];if(runtimeConfig.sha256!==void 0)checksumAlgorithms.push({algorithmId:()=>exports.AlgorithmId.SHA256,checksumConstructor:()=>runtimeConfig.sha256});if(runtimeConfig.md5!=null)checksumAlgorithms.push({algorithmId:()=>exports.AlgorithmId.MD5,checksumConstructor:()=>runtimeConfig.md5});return{addChecksumAlgorithm(algo){checksumAlgorithms.push(algo)},checksumAlgorithms(){return checksumAlgorithms}}},resolveChecksumRuntimeConfig=(clientConfig)=>{let runtimeConfig={};return clientConfig.checksumAlgorithms().forEach((checksumAlgorithm)=>{runtimeConfig[checksumAlgorithm.algorithmId()]=checksumAlgorithm.checksumConstructor()}),runtimeConfig},getDefaultClientConfiguration=(runtimeConfig)=>{return getChecksumConfiguration(runtimeConfig)},resolveDefaultRuntimeConfig=(config)=>{return resolveChecksumRuntimeConfig(config)};exports.FieldPosition=void 0;(function(FieldPosition){FieldPosition[FieldPosition.HEADER=0]="HEADER",FieldPosition[FieldPosition.TRAILER=1]="TRAILER"})(exports.FieldPosition||(exports.FieldPosition={}));var SMITHY_CONTEXT_KEY="__smithy_context";exports.IniSectionType=void 0;(function(IniSectionType){IniSectionType.PROFILE="profile",IniSectionType.SSO_SESSION="sso-session",IniSectionType.SERVICES="services"})(exports.IniSectionType||(exports.IniSectionType={}));exports.RequestHandlerProtocol=void 0;(function(RequestHandlerProtocol){RequestHandlerProtocol.HTTP_0_9="http/0.9",RequestHandlerProtocol.HTTP_1_0="http/1.0",RequestHandlerProtocol.TDS_8_0="tds/8.0"})(exports.RequestHandlerProtocol||(exports.RequestHandlerProtocol={}));exports.SMITHY_CONTEXT_KEY=SMITHY_CONTEXT_KEY;exports.getDefaultClientConfiguration=getDefaultClientConfiguration;exports.resolveDefaultRuntimeConfig=resolveDefaultRuntimeConfig});var require_dist_cjs2=__commonJS((exports)=>{var types3=require_dist_cjs(),getHttpHandlerExtensionConfiguration=(runtimeConfig)=>{return{setHttpHandler(handler){runtimeConfig.httpHandler=handler},httpHandler(){return runtimeConfig.httpHandler},updateHttpClientConfig(key,value){runtimeConfig.httpHandler?.updateHttpClientConfig(key,value)},httpHandlerConfigs(){return runtimeConfig.httpHandler.httpHandlerConfigs()}}},resolveHttpHandlerRuntimeConfig=(httpHandlerExtensionConfiguration)=>{return{httpHandler:httpHandlerExtensionConfiguration.httpHandler()}};class Field{name;kind;values;constructor({name,kind=types3.FieldPosition.HEADER,values:values2=[]}){this.name=name,this.kind=kind,this.values=values2}add(value){this.values.push(value)}set(values2){this.values=values2}remove(value){this.values=this.values.filter((v)=>v!==value)}toString(){return this.values.map((v)=>v.includes(",")||v.includes(" ")?`"${v}"`:v).join(", ")}get(){return this.values}}class Fields{entries={};encoding;constructor({fields=[],encoding="utf-8"}){fields.forEach(this.setField.bind(this)),this.encoding=encoding}setField(field){this.entries[field.name.toLowerCase()]=field}getField(name){return this.entries[name.toLowerCase()]}removeField(name){delete this.entries[name.toLowerCase()]}getByType(kind){return Object.values(this.entries).filter((field)=>field.kind===kind)}}class HttpRequest{method;protocol;hostname;port;path;query;headers;username;password;fragment;body;constructor(options){this.method=options.method||"GET",this.hostname=options.hostname||"localhost",this.port=options.port,this.query=options.query||{},this.headers=options.headers||{},this.body=options.body,this.protocol=options.protocol?options.protocol.slice(-1)!==":"?`${options.protocol}:`:options.protocol:"https:",this.path=options.path?options.path.charAt(0)!=="/"?`/${options.path}`:options.path:"/",this.username=options.username,this.password=options.password,this.fragment=options.fragment}static clone(request){let cloned=new HttpRequest({...request,headers:{...request.headers}});if(cloned.query)cloned.query=cloneQuery(cloned.query);return cloned}static isInstance(request){if(!request)return!1;let req=request;return"method"in req&&"protocol"in req&&"hostname"in req&&"path"in req&&typeof req.query==="object"&&typeof req.headers==="object"}clone(){return HttpRequest.clone(this)}}function cloneQuery(query){return Object.keys(query).reduce((carry,paramName)=>{let param=query[paramName];return{...carry,[paramName]:Array.isArray(param)?[...param]:param}},{})}class HttpResponse{statusCode;reason;headers;body;constructor(options){this.statusCode=options.statusCode,this.reason=options.reason,this.headers=options.headers||{},this.body=options.body}static isInstance(response){if(!response)return!1;let resp=response;return typeof resp.statusCode==="number"&&typeof resp.headers==="object"}}function isValidHostname(hostname){return/^[a-z0-9][a-z0-9\.\-]*[a-z0-9]$/.test(hostname)}exports.Field=Field;exports.Fields=Fields;exports.HttpRequest=HttpRequest;exports.HttpResponse=HttpResponse;exports.getHttpHandlerExtensionConfiguration=getHttpHandlerExtensionConfiguration;exports.isValidHostname=isValidHostname;exports.resolveHttpHandlerRuntimeConfig=resolveHttpHandlerRuntimeConfig});var require_dist_cjs3=__commonJS((exports)=>{var types3=require_dist_cjs(),getSmithyContext=(context)=>context[types3.SMITHY_CONTEXT_KEY]||(context[types3.SMITHY_CONTEXT_KEY]={}),normalizeProvider=(input)=>{if(typeof input==="function")return input;let promisified=Promise.resolve(input);return()=>promisified};exports.getSmithyContext=getSmithyContext;exports.normalizeProvider=normalizeProvider});var require_dist_cjs4=__commonJS((exports)=>{var protocolHttp=require_dist_cjs2(),deserializerMiddleware=(options,deserializer)=>(next,context)=>async(args)=>{let{response}=await next(args);try{let parsed=await deserializer(response,options);return{response,output:parsed}}catch(error){if(Object.defineProperty(error,"$response",{value:response,enumerable:!1,writable:!1,configurable:!1}),!("$metadata"in error)){try{error.message+=`
  Deserialization error: to see the raw response, inspect the hidden field {error}.$response on this object.`}catch(e){if(!context.logger||context.logger?.constructor?.name==="NoOpLogger")console.warn("Deserialization error: to see the raw response, inspect the hidden field {error}.$response on this object.");else context.logger?.warn?.("Deserialization error: to see the raw response, inspect the hidden field {error}.$response on this object.")}if(typeof error.$responseBodyText<"u"){if(error.$response)error.$response.body=error.$responseBodyText}try{if(protocolHttp.HttpResponse.isInstance(response)){let{headers={}}=response,headerEntries=Object.entries(headers);error.$metadata={httpStatusCode:response.statusCode,requestId:findHeader(/^x-[\w-]+-request-?id$/,headerEntries),extendedRequestId:findHeader(/^x-[\w-]+-id-2$/,headerEntries),cfId:findHeader(/^x-[\w-]+-cf-id$/,headerEntries)}}}catch(e){}}throw error}},findHeader=(pattern,headers)=>{return(headers.find(([k2])=>{return k2.match(pattern)})||[void 0,void 0])[1]},serializerMiddleware=(options,serializer)=>(next,context)=>async(args)=>{let endpointConfig=options,endpoint=context.endpointV2?.url&&endpointConfig.urlParser?async()=>endpointConfig.urlParser(context.endpointV2.url):endpointConfig.endpoint;if(!endpoint)throw Error("No valid endpoint provider available.");let request=await serializer(args.input,{...options,endpoint});return next({...args,request})},deserializerMiddlewareOption={name:"deserializerMiddleware",step:"deserialize",tags:["DESERIALIZER"],override:!0},serializerMiddlewareOption={name:"serializerMiddleware",step:"serialize",tags:["SERIALIZER"],override:!0};function getSerdePlugin(config,serializer,deserializer){return{applyToStack:(commandStack)=>{commandStack.add(deserializerMiddleware(config,deserializer),deserializerMiddlewareOption),commandStack.add(serializerMiddleware(config,serializer),serializerMiddlewareOption)}}}exports.deserializerMiddleware=deserializerMiddleware;exports.deserializerMiddlewareOption=deserializerMiddlewareOption;exports.getSerdePlugin=getSerdePlugin;exports.serializerMiddleware=serializerMiddleware;exports.serializerMiddlewareOption=serializerMiddlewareOption});var require_dist_cjs5=__commonJS((exports)=>{var isArrayBuffer=(arg)=>typeof ArrayBuffer==="function"&&arg instanceof ArrayBuffer||Object.prototype.toString.call(arg)==="[object ArrayBuffer]";exports.isArrayBuffer=isArrayBuffer});var require_dist_cjs6=__commonJS((exports)=>{var isArrayBuffer=require_dist_cjs5(),buffer2=__require("buffer"),fromArrayBuffer=(input,offset=0,length=input.byteLength-offset)=>{if(!isArrayBuffer.isArrayBuffer(input))throw TypeError(`The "input" argument must be ArrayBuffer. Received type ${typeof input} (${input})`);return buffer2.Buffer.from(input,offset,length)},fromString=(input,encoding)=>{if(typeof input!=="string")throw TypeError(`The "input" argument must be of type string. Received type ${typeof input} (${input})`);return encoding?buffer2.Buffer.from(input,encoding):buffer2.Buffer.from(input)};exports.fromArrayBuffer=fromArrayBuffer;exports.fromString=fromString});var require_fromBase64=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.fromBase64=void 0;var util_buffer_from_1=require_dist_cjs6(),BASE64_REGEX=/^[A-Za-z0-9+/]*={0,2}$/,fromBase64=(input)=>{if(input.length*3%4!==0)throw TypeError("Incorrect padding on base64 string.");if(!BASE64_REGEX.exec(input))throw TypeError("Invalid base64 string.");let buffer2=(0,util_buffer_from_1.fromString)(input,"base64");return new Uint8Array(buffer2.buffer,buffer2.byteOffset,buffer2.byteLength)};exports.fromBase64=fromBase64});var require_dist_cjs7=__commonJS((exports)=>{var utilBufferFrom=require_dist_cjs6(),fromUtf8=(input)=>{let buf=utilBufferFrom.fromString(input,"utf8");return new Uint8Array(buf.buffer,buf.byteOffset,buf.byteLength/Uint8Array.BYTES_PER_ELEMENT)},toUint8Array=(data)=>{if(typeof data==="string")return fromUtf8(data);if(ArrayBuffer.isView(data))return new Uint8Array(data.buffer,data.byteOffset,data.byteLength/Uint8Array.BYTES_PER_ELEMENT);return new Uint8Array(data)},toUtf8=(input)=>{if(typeof input==="string")return input;if(typeof input!=="object"||typeof input.byteOffset!=="number"||typeof input.byteLength!=="number")throw Error("@smithy/util-utf8: toUtf8 encoder function only accepts string | Uint8Array.");return utilBufferFrom.fromArrayBuffer(input.buffer,input.byteOffset,input.byteLength).toString("utf8")};exports.fromUtf8=fromUtf8;exports.toUint8Array=toUint8Array;exports.toUtf8=toUtf8});var require_toBase64=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.toBase64=void 0;var util_buffer_from_1=require_dist_cjs6(),util_utf8_1=require_dist_cjs7(),toBase64=(_input)=>{let input;if(typeof _input==="string")input=(0,util_utf8_1.fromUtf8)(_input);else input=_input;if(typeof input!=="object"||typeof input.byteOffset!=="number"||typeof input.byteLength!=="number")throw Error("@smithy/util-base64: toBase64 encoder function only accepts string | Uint8Array.");return(0,util_buffer_from_1.fromArrayBuffer)(input.buffer,input.byteOffset,input.byteLength).toString("base64")};exports.toBase64=toBase64});var require_dist_cjs8=__commonJS((exports)=>{var fromBase64=require_fromBase64(),toBase64=require_toBase64();Object.keys(fromBase64).forEach(function(k2){if(k2!=="default"&&!Object.prototype.hasOwnProperty.call(exports,k2))Object.defineProperty(exports,k2,{enumerable:!0,get:function(){return fromBase64[k2]}})});Object.keys(toBase64).forEach(function(k2){if(k2!=="default"&&!Object.prototype.hasOwnProperty.call(exports,k2))Object.defineProperty(exports,k2,{enumerable:!0,get:function(){return toBase64[k2]}})})});var require_ChecksumStream=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.ChecksumStream=void 0;var util_base64_1=require_dist_cjs8(),stream_1=__require("stream");class ChecksumStream extends stream_1.Duplex{expectedChecksum;checksumSourceLocation;checksum;source;base64Encoder;constructor({expectedChecksum,checksum:checksum2,source,checksumSourceLocation,base64Encoder}){super();if(typeof source.pipe==="function")this.source=source;else throw Error(`@smithy/util-stream: unsupported source type ${source?.constructor?.name??source} in ChecksumStream.`);this.base64Encoder=base64Encoder??util_base64_1.toBase64,this.expectedChecksum=expectedChecksum,this.checksum=checksum2,this.checksumSourceLocation=checksumSourceLocation,this.source.pipe(this)}_read(size){}_write(chunk,encoding,callback){try{this.checksum.update(chunk),this.push(chunk)}catch(e){return callback(e)}return callback()}async _final(callback){try{let digest=await this.checksum.digest(),received=this.base64Encoder(digest);if(this.expectedChecksum!==received)return callback(Error(`Checksum mismatch: expected "${this.expectedChecksum}" but received "${received}" in response header "${this.checksumSourceLocation}".`))}catch(e){return callback(e)}return this.push(null),callback()}}exports.ChecksumStream=ChecksumStream});var require_stream_type_check=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.isBlob=exports.isReadableStream=void 0;var isReadableStream=(stream)=>typeof ReadableStream==="function"&&(stream?.constructor?.name===ReadableStream.name||stream instanceof ReadableStream);exports.isReadableStream=isReadableStream;var isBlob=(blob)=>{return typeof Blob==="function"&&(blob?.constructor?.name===Blob.name||blob instanceof Blob)};exports.isBlob=isBlob});var require_ChecksumStream_browser=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.ChecksumStream=void 0;var ReadableStreamRef=typeof ReadableStream==="function"?ReadableStream:function(){};class ChecksumStream extends ReadableStreamRef{}exports.ChecksumStream=ChecksumStream});var require_createChecksumStream_browser=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.createChecksumStream=void 0;var util_base64_1=require_dist_cjs8(),stream_type_check_1=require_stream_type_check(),ChecksumStream_browser_1=require_ChecksumStream_browser(),createChecksumStream=({expectedChecksum,checksum:checksum2,source,checksumSourceLocation,base64Encoder})=>{if(!(0,stream_type_check_1.isReadableStream)(source))throw Error(`@smithy/util-stream: unsupported source type ${source?.constructor?.name??source} in ChecksumStream.`);let encoder2=base64Encoder??util_base64_1.toBase64;if(typeof TransformStream!=="function")throw Error("@smithy/util-stream: unable to instantiate ChecksumStream because API unavailable: ReadableStream/TransformStream.");let transform2=new TransformStream({start(){},async transform(chunk,controller){checksum2.update(chunk),controller.enqueue(chunk)},async flush(controller){let digest=await checksum2.digest(),received=encoder2(digest);if(expectedChecksum!==received){let error=Error(`Checksum mismatch: expected "${expectedChecksum}" but received "${received}" in response header "${checksumSourceLocation}".`);controller.error(error)}else controller.terminate()}});source.pipeThrough(transform2);let readable=transform2.readable;return Object.setPrototypeOf(readable,ChecksumStream_browser_1.ChecksumStream.prototype),readable};exports.createChecksumStream=createChecksumStream});var require_createChecksumStream=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.createChecksumStream=createChecksumStream;var stream_type_check_1=require_stream_type_check(),ChecksumStream_1=require_ChecksumStream(),createChecksumStream_browser_1=require_createChecksumStream_browser();function createChecksumStream(init){if(typeof ReadableStream==="function"&&(0,stream_type_check_1.isReadableStream)(init.source))return(0,createChecksumStream_browser_1.createChecksumStream)(init);return new ChecksumStream_1.ChecksumStream(init)}});var require_ByteArrayCollector=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.ByteArrayCollector=void 0;class ByteArrayCollector{allocByteArray;byteLength=0;byteArrays=[];constructor(allocByteArray){this.allocByteArray=allocByteArray}push(byteArray){this.byteArrays.push(byteArray),this.byteLength+=byteArray.byteLength}flush(){if(this.byteArrays.length===1){let bytes=this.byteArrays[0];return this.reset(),bytes}let aggregation=this.allocByteArray(this.byteLength),cursor=0;for(let i=0;i<this.byteArrays.length;++i){let bytes=this.byteArrays[i];aggregation.set(bytes,cursor),cursor+=bytes.byteLength}return this.reset(),aggregation}reset(){this.byteArrays=[],this.byteLength=0}}exports.ByteArrayCollector=ByteArrayCollector});var require_createBufferedReadableStream=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.createBufferedReadable=void 0;exports.createBufferedReadableStream=createBufferedReadableStream;exports.merge=merge2;exports.flush=flush;exports.sizeOf=sizeOf;exports.modeOf=modeOf;var ByteArrayCollector_1=require_ByteArrayCollector();function createBufferedReadableStream(upstream,size,logger){let reader=upstream.getReader(),streamBufferingLoggedWarning=!1,bytesSeen=0,buffers=["",new ByteArrayCollector_1.ByteArrayCollector((size2)=>new Uint8Array(size2))],mode=-1,pull=async(controller)=>{let{value,done}=await reader.read(),chunk=value;if(done){if(mode!==-1){let remainder=flush(buffers,mode);if(sizeOf(remainder)>0)controller.enqueue(remainder)}controller.close()}else{let chunkMode=modeOf(chunk,!1);if(mode!==chunkMode){if(mode>=0)controller.enqueue(flush(buffers,mode));mode=chunkMode}if(mode===-1){controller.enqueue(chunk);return}let chunkSize=sizeOf(chunk);bytesSeen+=chunkSize;let bufferSize=sizeOf(buffers[mode]);if(chunkSize>=size&&bufferSize===0)controller.enqueue(chunk);else{let newSize=merge2(buffers,mode,chunk);if(!streamBufferingLoggedWarning&&bytesSeen>size*2)streamBufferingLoggedWarning=!0,logger?.warn(`@smithy/util-stream - stream chunk size ${chunkSize} is below threshold of ${size}, automatically buffering.`);if(newSize>=size)controller.enqueue(flush(buffers,mode));else await pull(controller)}}};return new ReadableStream({pull})}exports.createBufferedReadable=createBufferedReadableStream;function merge2(buffers,mode,chunk){switch(mode){case 0:return buffers[0]+=chunk,sizeOf(buffers[0]);case 1:case 2:return buffers[mode].push(chunk),sizeOf(buffers[mode])}}function flush(buffers,mode){switch(mode){case 0:let s=buffers[0];return buffers[0]="",s;case 1:case 2:return buffers[mode].flush()}throw Error(`@smithy/util-stream - invalid index ${mode} given to flush()`)}function sizeOf(chunk){return chunk?.byteLength??chunk?.length??0}function modeOf(chunk,allowBuffer=!0){if(allowBuffer&&typeof Buffer<"u"&&chunk instanceof Buffer)return 2;if(chunk instanceof Uint8Array)return 1;if(typeof chunk==="string")return 0;return-1}});var require_createBufferedReadable=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.createBufferedReadable=createBufferedReadable;var node_stream_1=__require("stream"),ByteArrayCollector_1=require_ByteArrayCollector(),createBufferedReadableStream_1=require_createBufferedReadableStream(),stream_type_check_1=require_stream_type_check();function createBufferedReadable(upstream,size,logger){if((0,stream_type_check_1.isReadableStream)(upstream))return(0,createBufferedReadableStream_1.createBufferedReadableStream)(upstream,size,logger);let downstream=new node_stream_1.Readable({read(){}}),streamBufferingLoggedWarning=!1,bytesSeen=0,buffers=["",new ByteArrayCollector_1.ByteArrayCollector((size2)=>new Uint8Array(size2)),new ByteArrayCollector_1.ByteArrayCollector((size2)=>Buffer.from(new Uint8Array(size2)))],mode=-1;return upstream.on("data",(chunk)=>{let chunkMode=(0,createBufferedReadableStream_1.modeOf)(chunk,!0);if(mode!==chunkMode){if(mode>=0)downstream.push((0,createBufferedReadableStream_1.flush)(buffers,mode));mode=chunkMode}if(mode===-1){downstream.push(chunk);return}let chunkSize=(0,createBufferedReadableStream_1.sizeOf)(chunk);bytesSeen+=chunkSize;let bufferSize=(0,createBufferedReadableStream_1.sizeOf)(buffers[mode]);if(chunkSize>=size&&bufferSize===0)downstream.push(chunk);else{let newSize=(0,createBufferedReadableStream_1.merge)(buffers,mode,chunk);if(!streamBufferingLoggedWarning&&bytesSeen>size*2)streamBufferingLoggedWarning=!0,logger?.warn(`@smithy/util-stream - stream chunk size ${chunkSize} is below threshold of ${size}, automatically buffering.`);if(newSize>=size)downstream.push((0,createBufferedReadableStream_1.flush)(buffers,mode))}}),upstream.on("end",()=>{if(mode!==-1){let remainder=(0,createBufferedReadableStream_1.flush)(buffers,mode);if((0,createBufferedReadableStream_1.sizeOf)(remainder)>0)downstream.push(remainder)}downstream.push(null)}),downstream}});var require_getAwsChunkedEncodingStream_browser=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.getAwsChunkedEncodingStream=void 0;var getAwsChunkedEncodingStream=(readableStream,options)=>{let{base64Encoder,bodyLengthChecker,checksumAlgorithmFn,checksumLocationName,streamHasher}=options,checksumRequired=base64Encoder!==void 0&&bodyLengthChecker!==void 0&&checksumAlgorithmFn!==void 0&&checksumLocationName!==void 0&&streamHasher!==void 0,digest=checksumRequired?streamHasher(checksumAlgorithmFn,readableStream):void 0,reader=readableStream.getReader();return new ReadableStream({async pull(controller){let{value,done}=await reader.read();if(done){if(controller.enqueue(`0\r
`),checksumRequired){let checksum2=base64Encoder(await digest);controller.enqueue(`${checksumLocationName}:${checksum2}\r
`),controller.enqueue(`\r
`)}controller.close()}else controller.enqueue(`${(bodyLengthChecker(value)||0).toString(16)}\r
${value}\r
`)}})};exports.getAwsChunkedEncodingStream=getAwsChunkedEncodingStream});var require_getAwsChunkedEncodingStream=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.getAwsChunkedEncodingStream=getAwsChunkedEncodingStream;var node_stream_1=__require("stream"),getAwsChunkedEncodingStream_browser_1=require_getAwsChunkedEncodingStream_browser(),stream_type_check_1=require_stream_type_check();function getAwsChunkedEncodingStream(stream,options){let readable=stream,readableStream=stream;if((0,stream_type_check_1.isReadableStream)(readableStream))return(0,getAwsChunkedEncodingStream_browser_1.getAwsChunkedEncodingStream)(readableStream,options);let{base64Encoder,bodyLengthChecker,checksumAlgorithmFn,checksumLocationName,streamHasher}=options,checksumRequired=base64Encoder!==void 0&&checksumAlgorithmFn!==void 0&&checksumLocationName!==void 0&&streamHasher!==void 0,digest=checksumRequired?streamHasher(checksumAlgorithmFn,readable):void 0,awsChunkedEncodingStream=new node_stream_1.Readable({read:()=>{}});return readable.on("data",(data)=>{let length=bodyLengthChecker(data)||0;if(length===0)return;awsChunkedEncodingStream.push(`${length.toString(16)}\r
`),awsChunkedEncodingStream.push(data),awsChunkedEncodingStream.push(`\r
`)}),readable.on("end",async()=>{if(awsChunkedEncodingStream.push(`0\r
`),checksumRequired){let checksum2=base64Encoder(await digest);awsChunkedEncodingStream.push(`${checksumLocationName}:${checksum2}\r
`),awsChunkedEncodingStream.push(`\r
`)}awsChunkedEncodingStream.push(null)}),awsChunkedEncodingStream}});var require_headStream_browser=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.headStream=headStream;async function headStream(stream,bytes){let byteLengthCounter=0,chunks=[],reader=stream.getReader(),isDone=!1;while(!isDone){let{done,value}=await reader.read();if(value)chunks.push(value),byteLengthCounter+=value?.byteLength??0;if(byteLengthCounter>=bytes)break;isDone=done}reader.releaseLock();let collected=new Uint8Array(Math.min(bytes,byteLengthCounter)),offset=0;for(let chunk of chunks){if(chunk.byteLength>collected.byteLength-offset){collected.set(chunk.subarray(0,collected.byteLength-offset),offset);break}else collected.set(chunk,offset);offset+=chunk.length}return collected}});var require_headStream=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.headStream=void 0;var stream_1=__require("stream"),headStream_browser_1=require_headStream_browser(),stream_type_check_1=require_stream_type_check(),headStream=(stream,bytes)=>{if((0,stream_type_check_1.isReadableStream)(stream))return(0,headStream_browser_1.headStream)(stream,bytes);return new Promise((resolve,reject)=>{let collector=new Collector;collector.limit=bytes,stream.pipe(collector),stream.on("error",(err)=>{collector.end(),reject(err)}),collector.on("error",reject),collector.on("finish",function(){let bytes2=new Uint8Array(Buffer.concat(this.buffers));resolve(bytes2)})})};exports.headStream=headStream;class Collector extends stream_1.Writable{buffers=[];limit=1/0;bytesBuffered=0;_write(chunk,encoding,callback){if(this.buffers.push(chunk),this.bytesBuffered+=chunk.byteLength??0,this.bytesBuffered>=this.limit){let excess=this.bytesBuffered-this.limit,tailBuffer=this.buffers[this.buffers.length-1];this.buffers[this.buffers.length-1]=tailBuffer.subarray(0,tailBuffer.byteLength-excess),this.emit("finish")}callback()}}});var require_dist_cjs9=__commonJS((exports)=>{var escapeUri=(uri2)=>encodeURIComponent(uri2).replace(/[!'()*]/g,hexEncode),hexEncode=(c)=>`%${c.charCodeAt(0).toString(16).toUpperCase()}`,escapeUriPath=(uri2)=>uri2.split("/").map(escapeUri).join("/");exports.escapeUri=escapeUri;exports.escapeUriPath=escapeUriPath});var require_dist_cjs10=__commonJS((exports)=>{var utilUriEscape=require_dist_cjs9();function buildQueryString(query){let parts=[];for(let key of Object.keys(query).sort()){let value=query[key];if(key=utilUriEscape.escapeUri(key),Array.isArray(value))for(let i=0,iLen=value.length;i<iLen;i++)parts.push(`${key}=${utilUriEscape.escapeUri(value[i])}`);else{let qsEntry=key;if(value||typeof value==="string")qsEntry+=`=${utilUriEscape.escapeUri(value)}`;parts.push(qsEntry)}}return parts.join("&")}exports.buildQueryString=buildQueryString});var require_dist_cjs11=__commonJS((exports)=>{var protocolHttp=require_dist_cjs2(),querystringBuilder=require_dist_cjs10(),http=__require("http"),https=__require("https"),stream=__require("stream"),http2=__require("http2"),NODEJS_TIMEOUT_ERROR_CODES=["ECONNRESET","EPIPE","ETIMEDOUT"],getTransformedHeaders=(headers)=>{let transformedHeaders={};for(let name of Object.keys(headers)){let headerValues=headers[name];transformedHeaders[name]=Array.isArray(headerValues)?headerValues.join(","):headerValues}return transformedHeaders},timing={setTimeout:(cb,ms)=>setTimeout(cb,ms),clearTimeout:(timeoutId)=>clearTimeout(timeoutId)},DEFER_EVENT_LISTENER_TIME$2=1000,setConnectionTimeout=(request,reject,timeoutInMs=0)=>{if(!timeoutInMs)return-1;let registerTimeout=(offset)=>{let timeoutId=timing.setTimeout(()=>{request.destroy(),reject(Object.assign(Error(`@smithy/node-http-handler - the request socket did not establish a connection with the server within the configured timeout of ${timeoutInMs} ms.`),{name:"TimeoutError"}))},timeoutInMs-offset),doWithSocket=(socket)=>{if(socket?.connecting)socket.on("connect",()=>{timing.clearTimeout(timeoutId)});else timing.clearTimeout(timeoutId)};if(request.socket)doWithSocket(request.socket);else request.on("socket",doWithSocket)};if(timeoutInMs<2000)return registerTimeout(0),0;return timing.setTimeout(registerTimeout.bind(null,DEFER_EVENT_LISTENER_TIME$2),DEFER_EVENT_LISTENER_TIME$2)},setRequestTimeout=(req,reject,timeoutInMs=0,throwOnRequestTimeout,logger)=>{if(timeoutInMs)return timing.setTimeout(()=>{let msg=`@smithy/node-http-handler - [${throwOnRequestTimeout?"ERROR":"WARN"}] a request has exceeded the configured ${timeoutInMs} ms requestTimeout.`;if(throwOnRequestTimeout){let error=Object.assign(Error(msg),{name:"TimeoutError",code:"ETIMEDOUT"});req.destroy(error),reject(error)}else msg+=" Init client requestHandler with throwOnRequestTimeout=true to turn this into an error.",logger?.warn?.(msg)},timeoutInMs);return-1},DEFER_EVENT_LISTENER_TIME$1=3000,setSocketKeepAlive=(request,{keepAlive,keepAliveMsecs},deferTimeMs=DEFER_EVENT_LISTENER_TIME$1)=>{if(keepAlive!==!0)return-1;let registerListener=()=>{if(request.socket)request.socket.setKeepAlive(keepAlive,keepAliveMsecs||0);else request.on("socket",(socket)=>{socket.setKeepAlive(keepAlive,keepAliveMsecs||0)})};if(deferTimeMs===0)return registerListener(),0;return timing.setTimeout(registerListener,deferTimeMs)},DEFER_EVENT_LISTENER_TIME=3000,setSocketTimeout=(request,reject,timeoutInMs=0)=>{let registerTimeout=(offset)=>{let timeout=timeoutInMs-offset,onTimeout=()=>{request.destroy(),reject(Object.assign(Error(`@smithy/node-http-handler - the request socket timed out after ${timeoutInMs} ms of inactivity (configured by client requestHandler).`),{name:"TimeoutError"}))};if(request.socket)request.socket.setTimeout(timeout,onTimeout),request.on("close",()=>request.socket?.removeListener("timeout",onTimeout));else request.setTimeout(timeout,onTimeout)};if(0<timeoutInMs&&timeoutInMs<6000)return registerTimeout(0),0;return timing.setTimeout(registerTimeout.bind(null,timeoutInMs===0?0:DEFER_EVENT_LISTENER_TIME),DEFER_EVENT_LISTENER_TIME)},MIN_WAIT_TIME=6000;async function writeRequestBody(httpRequest,request,maxContinueTimeoutMs=MIN_WAIT_TIME,externalAgent=!1){let headers=request.headers??{},expect=headers.Expect||headers.expect,timeoutId=-1,sendBody=!0;if(!externalAgent&&expect==="100-continue")sendBody=await Promise.race([new Promise((resolve)=>{timeoutId=Number(timing.setTimeout(()=>resolve(!0),Math.max(MIN_WAIT_TIME,maxContinueTimeoutMs)))}),new Promise((resolve)=>{httpRequest.on("continue",()=>{timing.clearTimeout(timeoutId),resolve(!0)}),httpRequest.on("response",()=>{timing.clearTimeout(timeoutId),resolve(!1)}),httpRequest.on("error",()=>{timing.clearTimeout(timeoutId),resolve(!1)})})]);if(sendBody)writeBody(httpRequest,request.body)}function writeBody(httpRequest,body){if(body instanceof stream.Readable){body.pipe(httpRequest);return}if(body){let isBuffer=Buffer.isBuffer(body);if(isBuffer||typeof body==="string"){if(isBuffer&&body.byteLength===0)httpRequest.end();else httpRequest.end(body);return}let uint8=body;if(typeof uint8==="object"&&uint8.buffer&&typeof uint8.byteOffset==="number"&&typeof uint8.byteLength==="number"){httpRequest.end(Buffer.from(uint8.buffer,uint8.byteOffset,uint8.byteLength));return}httpRequest.end(Buffer.from(body));return}httpRequest.end()}var DEFAULT_REQUEST_TIMEOUT=0;class NodeHttpHandler{config;configProvider;socketWarningTimestamp=0;externalAgent=!1;metadata={handlerProtocol:"http/1.1"};static create(instanceOrOptions){if(typeof instanceOrOptions?.handle==="function")return instanceOrOptions;return new NodeHttpHandler(instanceOrOptions)}static checkSocketUsage(agent,socketWarningTimestamp,logger=console){let{sockets,requests,maxSockets}=agent;if(typeof maxSockets!=="number"||maxSockets===1/0)return socketWarningTimestamp;let interval2=15000;if(Date.now()-interval2<socketWarningTimestamp)return socketWarningTimestamp;if(sockets&&requests)for(let origin in sockets){let socketsInUse=sockets[origin]?.length??0,requestsEnqueued=requests[origin]?.length??0;if(socketsInUse>=maxSockets&&requestsEnqueued>=2*maxSockets)return logger?.warn?.(`@smithy/node-http-handler:WARN - socket usage at capacity=${socketsInUse} and ${requestsEnqueued} additional requests are enqueued.
See https://docs.aws.amazon.com/sdk-for-javascript/v3/developer-guide/node-configuring-maxsockets.html
or increase socketAcquisitionWarningTimeout=(millis) in the NodeHttpHandler config.`),Date.now()}return socketWarningTimestamp}constructor(options){this.configProvider=new Promise((resolve,reject)=>{if(typeof options==="function")options().then((_options)=>{resolve(this.resolveDefaultConfig(_options))}).catch(reject);else resolve(this.resolveDefaultConfig(options))})}resolveDefaultConfig(options){let{requestTimeout,connectionTimeout,socketTimeout,socketAcquisitionWarningTimeout,httpAgent,httpsAgent,throwOnRequestTimeout,logger}=options||{},keepAlive=!0,maxSockets=50;return{connectionTimeout,requestTimeout,socketTimeout,socketAcquisitionWarningTimeout,throwOnRequestTimeout,httpAgent:(()=>{if(httpAgent instanceof http.Agent||typeof httpAgent?.destroy==="function")return this.externalAgent=!0,httpAgent;return new http.Agent({keepAlive:!0,maxSockets:50,...httpAgent})})(),httpsAgent:(()=>{if(httpsAgent instanceof https.Agent||typeof httpsAgent?.destroy==="function")return this.externalAgent=!0,httpsAgent;return new https.Agent({keepAlive:!0,maxSockets:50,...httpsAgent})})(),logger}}destroy(){this.config?.httpAgent?.destroy(),this.config?.httpsAgent?.destroy()}async handle(request,{abortSignal,requestTimeout}={}){if(!this.config)this.config=await this.configProvider;return new Promise((_resolve,_reject)=>{let config=this.config,writeRequestBodyPromise=void 0,timeouts=[],resolve=async(arg)=>{await writeRequestBodyPromise,timeouts.forEach(timing.clearTimeout),_resolve(arg)},reject=async(arg)=>{await writeRequestBodyPromise,timeouts.forEach(timing.clearTimeout),_reject(arg)};if(abortSignal?.aborted){let abortError=Error("Request aborted");abortError.name="AbortError",reject(abortError);return}let isSSL=request.protocol==="https:",headers=request.headers??{},expectContinue=(headers.Expect??headers.expect)==="100-continue",agent=isSSL?config.httpsAgent:config.httpAgent;if(expectContinue&&!this.externalAgent)agent=new(isSSL?https.Agent:http.Agent)({keepAlive:!1,maxSockets:1/0});timeouts.push(timing.setTimeout(()=>{this.socketWarningTimestamp=NodeHttpHandler.checkSocketUsage(agent,this.socketWarningTimestamp,config.logger)},config.socketAcquisitionWarningTimeout??(config.requestTimeout??2000)+(config.connectionTimeout??1000)));let queryString=querystringBuilder.buildQueryString(request.query||{}),auth=void 0;if(request.username!=null||request.password!=null){let username=request.username??"",password=request.password??"";auth=`${username}:${password}`}let path=request.path;if(queryString)path+=`?${queryString}`;if(request.fragment)path+=`#${request.fragment}`;let hostname=request.hostname??"";if(hostname[0]==="["&&hostname.endsWith("]"))hostname=request.hostname.slice(1,-1);else hostname=request.hostname;let nodeHttpsOptions={headers:request.headers,host:hostname,method:request.method,path,port:request.port,agent,auth},req=(isSSL?https.request:http.request)(nodeHttpsOptions,(res)=>{let httpResponse=new protocolHttp.HttpResponse({statusCode:res.statusCode||-1,reason:res.statusMessage,headers:getTransformedHeaders(res.headers),body:res});resolve({response:httpResponse})});if(req.on("error",(err)=>{if(NODEJS_TIMEOUT_ERROR_CODES.includes(err.code))reject(Object.assign(err,{name:"TimeoutError"}));else reject(err)}),abortSignal){let onAbort=()=>{req.destroy();let abortError=Error("Request aborted");abortError.name="AbortError",reject(abortError)};if(typeof abortSignal.addEventListener==="function"){let signal=abortSignal;signal.addEventListener("abort",onAbort,{once:!0}),req.once("close",()=>signal.removeEventListener("abort",onAbort))}else abortSignal.onabort=onAbort}let effectiveRequestTimeout=requestTimeout??config.requestTimeout;timeouts.push(setConnectionTimeout(req,reject,config.connectionTimeout)),timeouts.push(setRequestTimeout(req,reject,effectiveRequestTimeout,config.throwOnRequestTimeout,config.logger??console)),timeouts.push(setSocketTimeout(req,reject,config.socketTimeout));let httpAgent=nodeHttpsOptions.agent;if(typeof httpAgent==="object"&&"keepAlive"in httpAgent)timeouts.push(setSocketKeepAlive(req,{keepAlive:httpAgent.keepAlive,keepAliveMsecs:httpAgent.keepAliveMsecs}));writeRequestBodyPromise=writeRequestBody(req,request,effectiveRequestTimeout,this.externalAgent).catch((e)=>{return timeouts.forEach(timing.clearTimeout),_reject(e)})})}updateHttpClientConfig(key,value){this.config=void 0,this.configProvider=this.configProvider.then((config)=>{return{...config,[key]:value}})}httpHandlerConfigs(){return this.config??{}}}class NodeHttp2ConnectionPool{sessions=[];constructor(sessions){this.sessions=sessions??[]}poll(){if(this.sessions.length>0)return this.sessions.shift()}offerLast(session){this.sessions.push(session)}contains(session){return this.sessions.includes(session)}remove(session){this.sessions=this.sessions.filter((s)=>s!==session)}[Symbol.iterator](){return this.sessions[Symbol.iterator]()}destroy(connection3){for(let session of this.sessions)if(session===connection3){if(!session.destroyed)session.destroy()}}}class NodeHttp2ConnectionManager{constructor(config){if(this.config=config,this.config.maxConcurrency&&this.config.maxConcurrency<=0)throw RangeError("maxConcurrency must be greater than zero.")}config;sessionCache=new Map;lease(requestContext,connectionConfiguration){let url=this.getUrlString(requestContext),existingPool=this.sessionCache.get(url);if(existingPool){let existingSession=existingPool.poll();if(existingSession&&!this.config.disableConcurrency)return existingSession}let session=http2.connect(url);if(this.config.maxConcurrency)session.settings({maxConcurrentStreams:this.config.maxConcurrency},(err)=>{if(err)throw Error("Fail to set maxConcurrentStreams to "+this.config.maxConcurrency+"when creating new session for "+requestContext.destination.toString())});session.unref();let destroySessionCb=()=>{session.destroy(),this.deleteSession(url,session)};if(session.on("goaway",destroySessionCb),session.on("error",destroySessionCb),session.on("frameError",destroySessionCb),session.on("close",()=>this.deleteSession(url,session)),connectionConfiguration.requestTimeout)session.setTimeout(connectionConfiguration.requestTimeout,destroySessionCb);let connectionPool=this.sessionCache.get(url)||new NodeHttp2ConnectionPool;return connectionPool.offerLast(session),this.sessionCache.set(url,connectionPool),session}deleteSession(authority,session){let existingConnectionPool=this.sessionCache.get(authority);if(!existingConnectionPool)return;if(!existingConnectionPool.contains(session))return;existingConnectionPool.remove(session),this.sessionCache.set(authority,existingConnectionPool)}release(requestContext,session){let cacheKey=this.getUrlString(requestContext);this.sessionCache.get(cacheKey)?.offerLast(session)}destroy(){for(let[key,connectionPool]of this.sessionCache){for(let session of connectionPool){if(!session.destroyed)session.destroy();connectionPool.remove(session)}this.sessionCache.delete(key)}}setMaxConcurrentStreams(maxConcurrentStreams){if(maxConcurrentStreams&&maxConcurrentStreams<=0)throw RangeError("maxConcurrentStreams must be greater than zero.");this.config.maxConcurrency=maxConcurrentStreams}setDisableConcurrentStreams(disableConcurrentStreams){this.config.disableConcurrency=disableConcurrentStreams}getUrlString(request){return request.destination.toString()}}class NodeHttp2Handler{config;configProvider;metadata={handlerProtocol:"h2"};connectionManager=new NodeHttp2ConnectionManager({});static create(instanceOrOptions){if(typeof instanceOrOptions?.handle==="function")return instanceOrOptions;return new NodeHttp2Handler(instanceOrOptions)}constructor(options){this.configProvider=new Promise((resolve,reject)=>{if(typeof options==="function")options().then((opts)=>{resolve(opts||{})}).catch(reject);else resolve(options||{})})}destroy(){this.connectionManager.destroy()}async handle(request,{abortSignal,requestTimeout}={}){if(!this.config){if(this.config=await this.configProvider,this.connectionManager.setDisableConcurrentStreams(this.config.disableConcurrentStreams||!1),this.config.maxConcurrentStreams)this.connectionManager.setMaxConcurrentStreams(this.config.maxConcurrentStreams)}let{requestTimeout:configRequestTimeout,disableConcurrentStreams}=this.config,effectiveRequestTimeout=requestTimeout??configRequestTimeout;return new Promise((_resolve,_reject)=>{let fulfilled=!1,writeRequestBodyPromise=void 0,resolve=async(arg)=>{await writeRequestBodyPromise,_resolve(arg)},reject=async(arg)=>{await writeRequestBodyPromise,_reject(arg)};if(abortSignal?.aborted){fulfilled=!0;let abortError=Error("Request aborted");abortError.name="AbortError",reject(abortError);return}let{hostname,method,port,protocol,query}=request,auth="";if(request.username!=null||request.password!=null){let username=request.username??"",password=request.password??"";auth=`${username}:${password}@`}let authority=`${protocol}//${auth}${hostname}${port?`:${port}`:""}`,requestContext={destination:new URL(authority)},session=this.connectionManager.lease(requestContext,{requestTimeout:this.config?.sessionTimeout,disableConcurrentStreams:disableConcurrentStreams||!1}),rejectWithDestroy=(err)=>{if(disableConcurrentStreams)this.destroySession(session);fulfilled=!0,reject(err)},queryString=querystringBuilder.buildQueryString(query||{}),path=request.path;if(queryString)path+=`?${queryString}`;if(request.fragment)path+=`#${request.fragment}`;let req=session.request({...request.headers,[http2.constants.HTTP2_HEADER_PATH]:path,[http2.constants.HTTP2_HEADER_METHOD]:method});if(session.ref(),req.on("response",(headers)=>{let httpResponse=new protocolHttp.HttpResponse({statusCode:headers[":status"]||-1,headers:getTransformedHeaders(headers),body:req});if(fulfilled=!0,resolve({response:httpResponse}),disableConcurrentStreams)session.close(),this.connectionManager.deleteSession(authority,session)}),effectiveRequestTimeout)req.setTimeout(effectiveRequestTimeout,()=>{req.close();let timeoutError=Error(`Stream timed out because of no activity for ${effectiveRequestTimeout} ms`);timeoutError.name="TimeoutError",rejectWithDestroy(timeoutError)});if(abortSignal){let onAbort=()=>{req.close();let abortError=Error("Request aborted");abortError.name="AbortError",rejectWithDestroy(abortError)};if(typeof abortSignal.addEventListener==="function"){let signal=abortSignal;signal.addEventListener("abort",onAbort,{once:!0}),req.once("close",()=>signal.removeEventListener("abort",onAbort))}else abortSignal.onabort=onAbort}req.on("frameError",(type,code,id)=>{rejectWithDestroy(Error(`Frame type id ${type} in stream id ${id} has failed with code ${code}.`))}),req.on("error",rejectWithDestroy),req.on("aborted",()=>{rejectWithDestroy(Error(`HTTP/2 stream is abnormally aborted in mid-communication with result code ${req.rstCode}.`))}),req.on("close",()=>{if(session.unref(),disableConcurrentStreams)session.destroy();if(!fulfilled)rejectWithDestroy(Error("Unexpected error: http2 request did not get a response"))}),writeRequestBodyPromise=writeRequestBody(req,request,effectiveRequestTimeout)})}updateHttpClientConfig(key,value){this.config=void 0,this.configProvider=this.configProvider.then((config)=>{return{...config,[key]:value}})}httpHandlerConfigs(){return this.config??{}}destroySession(session){if(!session.destroyed)session.destroy()}}class Collector extends stream.Writable{bufferedBytes=[];_write(chunk,encoding,callback){this.bufferedBytes.push(chunk),callback()}}var streamCollector=(stream2)=>{if(isReadableStreamInstance(stream2))return collectReadableStream(stream2);return new Promise((resolve,reject)=>{let collector=new Collector;stream2.pipe(collector),stream2.on("error",(err)=>{collector.end(),reject(err)}),collector.on("error",reject),collector.on("finish",function(){let bytes=new Uint8Array(Buffer.concat(this.bufferedBytes));resolve(bytes)})})},isReadableStreamInstance=(stream2)=>typeof ReadableStream==="function"&&stream2 instanceof ReadableStream;async function collectReadableStream(stream2){let chunks=[],reader=stream2.getReader(),isDone=!1,length=0;while(!isDone){let{done,value}=await reader.read();if(value)chunks.push(value),length+=value.length;isDone=done}let collected=new Uint8Array(length),offset=0;for(let chunk of chunks)collected.set(chunk,offset),offset+=chunk.length;return collected}exports.DEFAULT_REQUEST_TIMEOUT=DEFAULT_REQUEST_TIMEOUT;exports.NodeHttp2Handler=NodeHttp2Handler;exports.NodeHttpHandler=NodeHttpHandler;exports.streamCollector=streamCollector});var require_dist_cjs12=__commonJS((exports)=>{var protocolHttp=require_dist_cjs2(),querystringBuilder=require_dist_cjs10(),utilBase64=require_dist_cjs8();function createRequest(url,requestOptions){return new Request(url,requestOptions)}function requestTimeout(timeoutInMs=0){return new Promise((resolve,reject)=>{if(timeoutInMs)setTimeout(()=>{let timeoutError=Error(`Request did not complete within ${timeoutInMs} ms`);timeoutError.name="TimeoutError",reject(timeoutError)},timeoutInMs)})}var keepAliveSupport={supported:void 0};class FetchHttpHandler{config;configProvider;static create(instanceOrOptions){if(typeof instanceOrOptions?.handle==="function")return instanceOrOptions;return new FetchHttpHandler(instanceOrOptions)}constructor(options){if(typeof options==="function")this.configProvider=options().then((opts)=>opts||{});else this.config=options??{},this.configProvider=Promise.resolve(this.config);if(keepAliveSupport.supported===void 0)keepAliveSupport.supported=Boolean(typeof Request<"u"&&"keepalive"in createRequest("https://[::1]"))}destroy(){}async handle(request,{abortSignal,requestTimeout:requestTimeout$1}={}){if(!this.config)this.config=await this.configProvider;let requestTimeoutInMs=requestTimeout$1??this.config.requestTimeout,keepAlive=this.config.keepAlive===!0,credentials=this.config.credentials;if(abortSignal?.aborted){let abortError=Error("Request aborted");return abortError.name="AbortError",Promise.reject(abortError)}let path=request.path,queryString=querystringBuilder.buildQueryString(request.query||{});if(queryString)path+=`?${queryString}`;if(request.fragment)path+=`#${request.fragment}`;let auth="";if(request.username!=null||request.password!=null){let username=request.username??"",password=request.password??"";auth=`${username}:${password}@`}let{port,method}=request,url=`${request.protocol}//${auth}${request.hostname}${port?`:${port}`:""}${path}`,body=method==="GET"||method==="HEAD"?void 0:request.body,requestOptions={body,headers:new Headers(request.headers),method,credentials};if(this.config?.cache)requestOptions.cache=this.config.cache;if(body)requestOptions.duplex="half";if(typeof AbortController<"u")requestOptions.signal=abortSignal;if(keepAliveSupport.supported)requestOptions.keepalive=keepAlive;if(typeof this.config.requestInit==="function")Object.assign(requestOptions,this.config.requestInit(request));let removeSignalEventListener=()=>{},fetchRequest=createRequest(url,requestOptions),raceOfPromises=[fetch(fetchRequest).then((response)=>{let fetchHeaders=response.headers,transformedHeaders={};for(let pair of fetchHeaders.entries())transformedHeaders[pair[0]]=pair[1];if(response.body==null)return response.blob().then((body2)=>({response:new protocolHttp.HttpResponse({headers:transformedHeaders,reason:response.statusText,statusCode:response.status,body:body2})}));return{response:new protocolHttp.HttpResponse({headers:transformedHeaders,reason:response.statusText,statusCode:response.status,body:response.body})}}),requestTimeout(requestTimeoutInMs)];if(abortSignal)raceOfPromises.push(new Promise((resolve,reject)=>{let onAbort=()=>{let abortError=Error("Request aborted");abortError.name="AbortError",reject(abortError)};if(typeof abortSignal.addEventListener==="function"){let signal=abortSignal;signal.addEventListener("abort",onAbort,{once:!0}),removeSignalEventListener=()=>signal.removeEventListener("abort",onAbort)}else abortSignal.onabort=onAbort}));return Promise.race(raceOfPromises).finally(removeSignalEventListener)}updateHttpClientConfig(key,value){this.config=void 0,this.configProvider=this.configProvider.then((config)=>{return config[key]=value,config})}httpHandlerConfigs(){return this.config??{}}}var streamCollector=async(stream)=>{if(typeof Blob==="function"&&stream instanceof Blob||stream.constructor?.name==="Blob"){if(Blob.prototype.arrayBuffer!==void 0)return new Uint8Array(await stream.arrayBuffer());return collectBlob(stream)}return collectStream(stream)};async function collectBlob(blob){let base64=await readToBase64(blob),arrayBuffer=utilBase64.fromBase64(base64);return new Uint8Array(arrayBuffer)}async function collectStream(stream){let chunks=[],reader=stream.getReader(),isDone=!1,length=0;while(!isDone){let{done,value}=await reader.read();if(value)chunks.push(value),length+=value.length;isDone=done}let collected=new Uint8Array(length),offset=0;for(let chunk of chunks)collected.set(chunk,offset),offset+=chunk.length;return collected}function readToBase64(blob){return new Promise((resolve,reject)=>{let reader=new FileReader;reader.onloadend=()=>{if(reader.readyState!==2)return reject(Error("Reader aborted too early"));let result2=reader.result??"",commaIndex=result2.indexOf(","),dataOffset=commaIndex>-1?commaIndex+1:result2.length;resolve(result2.substring(dataOffset))},reader.onabort=()=>reject(Error("Read aborted")),reader.onerror=()=>reject(reader.error),reader.readAsDataURL(blob)})}exports.FetchHttpHandler=FetchHttpHandler;exports.keepAliveSupport=keepAliveSupport;exports.streamCollector=streamCollector});var require_dist_cjs13=__commonJS((exports)=>{var SHORT_TO_HEX={},HEX_TO_SHORT={};for(let i=0;i<256;i++){let encodedByte=i.toString(16).toLowerCase();if(encodedByte.length===1)encodedByte=`0${encodedByte}`;SHORT_TO_HEX[i]=encodedByte,HEX_TO_SHORT[encodedByte]=i}function fromHex(encoded){if(encoded.length%2!==0)throw Error("Hex encoded strings must have an even number length");let out=new Uint8Array(encoded.length/2);for(let i=0;i<encoded.length;i+=2){let encodedByte=encoded.slice(i,i+2).toLowerCase();if(encodedByte in HEX_TO_SHORT)out[i/2]=HEX_TO_SHORT[encodedByte];else throw Error(`Cannot decode unrecognized sequence ${encodedByte} as hexadecimal`)}return out}function toHex(bytes){let out="";for(let i=0;i<bytes.byteLength;i++)out+=SHORT_TO_HEX[bytes[i]];return out}exports.fromHex=fromHex;exports.toHex=toHex});var require_sdk_stream_mixin_browser=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.sdkStreamMixin=void 0;var fetch_http_handler_1=require_dist_cjs12(),util_base64_1=require_dist_cjs8(),util_hex_encoding_1=require_dist_cjs13(),util_utf8_1=require_dist_cjs7(),stream_type_check_1=require_stream_type_check(),ERR_MSG_STREAM_HAS_BEEN_TRANSFORMED="The stream has already been transformed.",sdkStreamMixin=(stream)=>{if(!isBlobInstance(stream)&&!(0,stream_type_check_1.isReadableStream)(stream)){let name=stream?.__proto__?.constructor?.name||stream;throw Error(`Unexpected stream implementation, expect Blob or ReadableStream, got ${name}`)}let transformed=!1,transformToByteArray=async()=>{if(transformed)throw Error(ERR_MSG_STREAM_HAS_BEEN_TRANSFORMED);return transformed=!0,await(0,fetch_http_handler_1.streamCollector)(stream)},blobToWebStream=(blob)=>{if(typeof blob.stream!=="function")throw Error(`Cannot transform payload Blob to web stream. Please make sure the Blob.stream() is polyfilled.
If you are using React Native, this API is not yet supported, see: https://react-native.canny.io/feature-requests/p/fetch-streaming-body`);return blob.stream()};return Object.assign(stream,{transformToByteArray,transformToString:async(encoding)=>{let buf=await transformToByteArray();if(encoding==="base64")return(0,util_base64_1.toBase64)(buf);else if(encoding==="hex")return(0,util_hex_encoding_1.toHex)(buf);else if(encoding===void 0||encoding==="utf8"||encoding==="utf-8")return(0,util_utf8_1.toUtf8)(buf);else if(typeof TextDecoder==="function")return new TextDecoder(encoding).decode(buf);else throw Error("TextDecoder is not available, please make sure polyfill is provided.")},transformToWebStream:()=>{if(transformed)throw Error(ERR_MSG_STREAM_HAS_BEEN_TRANSFORMED);if(transformed=!0,isBlobInstance(stream))return blobToWebStream(stream);else if((0,stream_type_check_1.isReadableStream)(stream))return stream;else throw Error(`Cannot transform payload to web stream, got ${stream}`)}})};exports.sdkStreamMixin=sdkStreamMixin;var isBlobInstance=(stream)=>typeof Blob==="function"&&stream instanceof Blob});var require_sdk_stream_mixin=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.sdkStreamMixin=void 0;var node_http_handler_1=require_dist_cjs11(),util_buffer_from_1=require_dist_cjs6(),stream_1=__require("stream"),sdk_stream_mixin_browser_1=require_sdk_stream_mixin_browser(),ERR_MSG_STREAM_HAS_BEEN_TRANSFORMED="The stream has already been transformed.",sdkStreamMixin=(stream)=>{if(!(stream instanceof stream_1.Readable))try{return(0,sdk_stream_mixin_browser_1.sdkStreamMixin)(stream)}catch(e){let name=stream?.__proto__?.constructor?.name||stream;throw Error(`Unexpected stream implementation, expect Stream.Readable instance, got ${name}`)}let transformed=!1,transformToByteArray=async()=>{if(transformed)throw Error(ERR_MSG_STREAM_HAS_BEEN_TRANSFORMED);return transformed=!0,await(0,node_http_handler_1.streamCollector)(stream)};return Object.assign(stream,{transformToByteArray,transformToString:async(encoding)=>{let buf=await transformToByteArray();if(encoding===void 0||Buffer.isEncoding(encoding))return(0,util_buffer_from_1.fromArrayBuffer)(buf.buffer,buf.byteOffset,buf.byteLength).toString(encoding);else return new TextDecoder(encoding).decode(buf)},transformToWebStream:()=>{if(transformed)throw Error(ERR_MSG_STREAM_HAS_BEEN_TRANSFORMED);if(stream.readableFlowing!==null)throw Error("The stream has been consumed by other callbacks.");if(typeof stream_1.Readable.toWeb!=="function")throw Error("Readable.toWeb() is not supported. Please ensure a polyfill is available.");return transformed=!0,stream_1.Readable.toWeb(stream)}})};exports.sdkStreamMixin=sdkStreamMixin});var require_splitStream_browser=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.splitStream=splitStream;async function splitStream(stream){if(typeof stream.stream==="function")stream=stream.stream();return stream.tee()}});var require_splitStream=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.splitStream=splitStream;var stream_1=__require("stream"),splitStream_browser_1=require_splitStream_browser(),stream_type_check_1=require_stream_type_check();async function splitStream(stream){if((0,stream_type_check_1.isReadableStream)(stream)||(0,stream_type_check_1.isBlob)(stream))return(0,splitStream_browser_1.splitStream)(stream);let stream1=new stream_1.PassThrough,stream2=new stream_1.PassThrough;return stream.pipe(stream1),stream.pipe(stream2),[stream1,stream2]}});var require_dist_cjs14=__commonJS((exports)=>{var utilBase64=require_dist_cjs8(),utilUtf8=require_dist_cjs7(),ChecksumStream=require_ChecksumStream(),createChecksumStream=require_createChecksumStream(),createBufferedReadable=require_createBufferedReadable(),getAwsChunkedEncodingStream=require_getAwsChunkedEncodingStream(),headStream=require_headStream(),sdkStreamMixin=require_sdk_stream_mixin(),splitStream=require_splitStream(),streamTypeCheck=require_stream_type_check();class Uint8ArrayBlobAdapter extends Uint8Array{static fromString(source,encoding="utf-8"){if(typeof source==="string"){if(encoding==="base64")return Uint8ArrayBlobAdapter.mutate(utilBase64.fromBase64(source));return Uint8ArrayBlobAdapter.mutate(utilUtf8.fromUtf8(source))}throw Error(`Unsupported conversion from ${typeof source} to Uint8ArrayBlobAdapter.`)}static mutate(source){return Object.setPrototypeOf(source,Uint8ArrayBlobAdapter.prototype),source}transformToString(encoding="utf-8"){if(encoding==="base64")return utilBase64.toBase64(this);return utilUtf8.toUtf8(this)}}Object.defineProperty(exports,"isBlob",{enumerable:!0,get:function(){return streamTypeCheck.isBlob}});Object.defineProperty(exports,"isReadableStream",{enumerable:!0,get:function(){return streamTypeCheck.isReadableStream}});exports.Uint8ArrayBlobAdapter=Uint8ArrayBlobAdapter;Object.keys(ChecksumStream).forEach(function(k2){if(k2!=="default"&&!Object.prototype.hasOwnProperty.call(exports,k2))Object.defineProperty(exports,k2,{enumerable:!0,get:function(){return ChecksumStream[k2]}})});Object.keys(createChecksumStream).forEach(function(k2){if(k2!=="default"&&!Object.prototype.hasOwnProperty.call(exports,k2))Object.defineProperty(exports,k2,{enumerable:!0,get:function(){return createChecksumStream[k2]}})});Object.keys(createBufferedReadable).forEach(function(k2){if(k2!=="default"&&!Object.prototype.hasOwnProperty.call(exports,k2))Object.defineProperty(exports,k2,{enumerable:!0,get:function(){return createBufferedReadable[k2]}})});Object.keys(getAwsChunkedEncodingStream).forEach(function(k2){if(k2!=="default"&&!Object.prototype.hasOwnProperty.call(exports,k2))Object.defineProperty(exports,k2,{enumerable:!0,get:function(){return getAwsChunkedEncodingStream[k2]}})});Object.keys(headStream).forEach(function(k2){if(k2!=="default"&&!Object.prototype.hasOwnProperty.call(exports,k2))Object.defineProperty(exports,k2,{enumerable:!0,get:function(){return headStream[k2]}})});Object.keys(sdkStreamMixin).forEach(function(k2){if(k2!=="default"&&!Object.prototype.hasOwnProperty.call(exports,k2))Object.defineProperty(exports,k2,{enumerable:!0,get:function(){return sdkStreamMixin[k2]}})});Object.keys(splitStream).forEach(function(k2){if(k2!=="default"&&!Object.prototype.hasOwnProperty.call(exports,k2))Object.defineProperty(exports,k2,{enumerable:!0,get:function(){return splitStream[k2]}})})});var require_schema=__commonJS((exports)=>{var protocolHttp=require_dist_cjs2(),utilMiddleware=require_dist_cjs3(),deref=(schemaRef)=>{if(typeof schemaRef==="function")return schemaRef();return schemaRef},operation=(namespace,name,traits,input,output)=>({name,namespace,traits,input,output}),schemaDeserializationMiddleware=(config)=>(next,context)=>async(args)=>{let{response}=await next(args),{operationSchema}=utilMiddleware.getSmithyContext(context),[,ns,n2,t2,i,o]=operationSchema??[];try{let parsed=await config.protocol.deserializeResponse(operation(ns,n2,t2,i,o),{...config,...context},response);return{response,output:parsed}}catch(error2){if(Object.defineProperty(error2,"$response",{value:response,enumerable:!1,writable:!1,configurable:!1}),!("$metadata"in error2)){try{error2.message+=`
  Deserialization error: to see the raw response, inspect the hidden field {error}.$response on this object.`}catch(e){if(!context.logger||context.logger?.constructor?.name==="NoOpLogger")console.warn("Deserialization error: to see the raw response, inspect the hidden field {error}.$response on this object.");else context.logger?.warn?.("Deserialization error: to see the raw response, inspect the hidden field {error}.$response on this object.")}if(typeof error2.$responseBodyText<"u"){if(error2.$response)error2.$response.body=error2.$responseBodyText}try{if(protocolHttp.HttpResponse.isInstance(response)){let{headers={}}=response,headerEntries=Object.entries(headers);error2.$metadata={httpStatusCode:response.statusCode,requestId:findHeader(/^x-[\w-]+-request-?id$/,headerEntries),extendedRequestId:findHeader(/^x-[\w-]+-id-2$/,headerEntries),cfId:findHeader(/^x-[\w-]+-cf-id$/,headerEntries)}}}catch(e){}}throw error2}},findHeader=(pattern,headers)=>{return(headers.find(([k2])=>{return k2.match(pattern)})||[void 0,void 0])[1]},schemaSerializationMiddleware=(config)=>(next,context)=>async(args)=>{let{operationSchema}=utilMiddleware.getSmithyContext(context),[,ns,n2,t2,i,o]=operationSchema??[],endpoint=context.endpointV2?.url&&config.urlParser?async()=>config.urlParser(context.endpointV2.url):config.endpoint,request=await config.protocol.serializeRequest(operation(ns,n2,t2,i,o),args.input,{...config,...context,endpoint});return next({...args,request})},deserializerMiddlewareOption={name:"deserializerMiddleware",step:"deserialize",tags:["DESERIALIZER"],override:!0},serializerMiddlewareOption={name:"serializerMiddleware",step:"serialize",tags:["SERIALIZER"],override:!0};function getSchemaSerdePlugin(config){return{applyToStack:(commandStack)=>{commandStack.add(schemaSerializationMiddleware(config),serializerMiddlewareOption),commandStack.add(schemaDeserializationMiddleware(config),deserializerMiddlewareOption),config.protocol.setSerdeContext(config)}}}class Schema2{name;namespace;traits;static assign(instance,values2){return Object.assign(instance,values2)}static[Symbol.hasInstance](lhs){let isPrototype=this.prototype.isPrototypeOf(lhs);if(!isPrototype&&typeof lhs==="object"&&lhs!==null)return lhs.symbol===this.symbol;return isPrototype}getName(){return this.namespace+"#"+this.name}}class ListSchema extends Schema2{static symbol=Symbol.for("@smithy/lis");name;traits;valueSchema;symbol=ListSchema.symbol}var list=(namespace,name,traits,valueSchema)=>Schema2.assign(new ListSchema,{name,namespace,traits,valueSchema});class MapSchema extends Schema2{static symbol=Symbol.for("@smithy/map");name;traits;keySchema;valueSchema;symbol=MapSchema.symbol}var map3=(namespace,name,traits,keySchema,valueSchema)=>Schema2.assign(new MapSchema,{name,namespace,traits,keySchema,valueSchema});class OperationSchema extends Schema2{static symbol=Symbol.for("@smithy/ope");name;traits;input;output;symbol=OperationSchema.symbol}var op=(namespace,name,traits,input,output)=>Schema2.assign(new OperationSchema,{name,namespace,traits,input,output});class StructureSchema extends Schema2{static symbol=Symbol.for("@smithy/str");name;traits;memberNames;memberList;symbol=StructureSchema.symbol}var struct=(namespace,name,traits,memberNames,memberList)=>Schema2.assign(new StructureSchema,{name,namespace,traits,memberNames,memberList});class ErrorSchema extends StructureSchema{static symbol=Symbol.for("@smithy/err");ctor;symbol=ErrorSchema.symbol}var error=(namespace,name,traits,memberNames,memberList,ctor)=>Schema2.assign(new ErrorSchema,{name,namespace,traits,memberNames,memberList,ctor:null});function translateTraits(indicator){if(typeof indicator==="object")return indicator;indicator=indicator|0;let traits={},i=0;for(let trait of["httpLabel","idempotent","idempotencyToken","sensitive","httpPayload","httpResponseCode","httpQueryParams"])if((indicator>>i++&1)===1)traits[trait]=1;return traits}var anno={it:Symbol.for("@smithy/nor-struct-it")};class NormalizedSchema{ref;memberName;static symbol=Symbol.for("@smithy/nor");symbol=NormalizedSchema.symbol;name;schema;_isMemberSchema;traits;memberTraits;normalizedTraits;constructor(ref,memberName){this.ref=ref,this.memberName=memberName;let traitStack=[],_ref=ref,schema=ref;this._isMemberSchema=!1;while(isMemberSchema(_ref))traitStack.push(_ref[1]),_ref=_ref[0],schema=deref(_ref),this._isMemberSchema=!0;if(traitStack.length>0){this.memberTraits={};for(let i=traitStack.length-1;i>=0;--i){let traitSet=traitStack[i];Object.assign(this.memberTraits,translateTraits(traitSet))}}else this.memberTraits=0;if(schema instanceof NormalizedSchema){let computedMemberTraits=this.memberTraits;Object.assign(this,schema),this.memberTraits=Object.assign({},computedMemberTraits,schema.getMemberTraits(),this.getMemberTraits()),this.normalizedTraits=void 0,this.memberName=memberName??schema.memberName;return}if(this.schema=deref(schema),isStaticSchema(this.schema))this.name=`${this.schema[1]}#${this.schema[2]}`,this.traits=this.schema[3];else this.name=this.memberName??String(schema),this.traits=0;if(this._isMemberSchema&&!memberName)throw Error(`@smithy/core/schema - NormalizedSchema member init ${this.getName(!0)} missing member name.`)}static[Symbol.hasInstance](lhs){let isPrototype=this.prototype.isPrototypeOf(lhs);if(!isPrototype&&typeof lhs==="object"&&lhs!==null)return lhs.symbol===this.symbol;return isPrototype}static of(ref){let sc=deref(ref);if(sc instanceof NormalizedSchema)return sc;if(isMemberSchema(sc)){let[ns,traits]=sc;if(ns instanceof NormalizedSchema)return Object.assign(ns.getMergedTraits(),translateTraits(traits)),ns;throw Error(`@smithy/core/schema - may not init unwrapped member schema=${JSON.stringify(ref,null,2)}.`)}return new NormalizedSchema(sc)}getSchema(){let sc=this.schema;if(Array.isArray(sc)&&sc[0]===0)return sc[4];return sc}getName(withNamespace=!1){let{name}=this;return!withNamespace&&name&&name.includes("#")?name.split("#")[1]:name||void 0}getMemberName(){return this.memberName}isMemberSchema(){return this._isMemberSchema}isListSchema(){let sc=this.getSchema();return typeof sc==="number"?sc>=64&&sc<128:sc[0]===1}isMapSchema(){let sc=this.getSchema();return typeof sc==="number"?sc>=128&&sc<=255:sc[0]===2}isStructSchema(){let sc=this.getSchema();if(typeof sc!=="object")return!1;let id=sc[0];return id===3||id===-3||id===4}isUnionSchema(){let sc=this.getSchema();if(typeof sc!=="object")return!1;return sc[0]===4}isBlobSchema(){let sc=this.getSchema();return sc===21||sc===42}isTimestampSchema(){let sc=this.getSchema();return typeof sc==="number"&&sc>=4&&sc<=7}isUnitSchema(){return this.getSchema()==="unit"}isDocumentSchema(){return this.getSchema()===15}isStringSchema(){return this.getSchema()===0}isBooleanSchema(){return this.getSchema()===2}isNumericSchema(){return this.getSchema()===1}isBigIntegerSchema(){return this.getSchema()===17}isBigDecimalSchema(){return this.getSchema()===19}isStreaming(){let{streaming}=this.getMergedTraits();return!!streaming||this.getSchema()===42}isIdempotencyToken(){return!!this.getMergedTraits().idempotencyToken}getMergedTraits(){return this.normalizedTraits??(this.normalizedTraits={...this.getOwnTraits(),...this.getMemberTraits()})}getMemberTraits(){return translateTraits(this.memberTraits)}getOwnTraits(){return translateTraits(this.traits)}getKeySchema(){let[isDoc,isMap]=[this.isDocumentSchema(),this.isMapSchema()];if(!isDoc&&!isMap)throw Error(`@smithy/core/schema - cannot get key for non-map: ${this.getName(!0)}`);let schema=this.getSchema(),memberSchema=isDoc?15:schema[4]??0;return member([memberSchema,0],"key")}getValueSchema(){let sc=this.getSchema(),[isDoc,isMap,isList]=[this.isDocumentSchema(),this.isMapSchema(),this.isListSchema()],memberSchema=typeof sc==="number"?63&sc:sc&&typeof sc==="object"&&(isMap||isList)?sc[3+sc[0]]:isDoc?15:void 0;if(memberSchema!=null)return member([memberSchema,0],isMap?"value":"member");throw Error(`@smithy/core/schema - ${this.getName(!0)} has no value member.`)}getMemberSchema(memberName){let struct2=this.getSchema();if(this.isStructSchema()&&struct2[4].includes(memberName)){let i=struct2[4].indexOf(memberName),memberSchema=struct2[5][i];return member(isMemberSchema(memberSchema)?memberSchema:[memberSchema,0],memberName)}if(this.isDocumentSchema())return member([15,0],memberName);throw Error(`@smithy/core/schema - ${this.getName(!0)} has no no member=${memberName}.`)}getMemberSchemas(){let buffer2={};try{for(let[k2,v]of this.structIterator())buffer2[k2]=v}catch(ignored){}return buffer2}getEventStreamMember(){if(this.isStructSchema()){for(let[memberName,memberSchema]of this.structIterator())if(memberSchema.isStreaming()&&memberSchema.isStructSchema())return memberName}return""}*structIterator(){if(this.isUnitSchema())return;if(!this.isStructSchema())throw Error("@smithy/core/schema - cannot iterate non-struct schema.");let struct2=this.getSchema(),z=struct2[4].length,it=struct2[anno.it];if(it&&z===it.length){yield*it;return}it=Array(z);for(let i=0;i<z;++i){let k2=struct2[4][i],v=member([struct2[5][i],0],k2);yield it[i]=[k2,v]}struct2[anno.it]=it}}function member(memberSchema,memberName){if(memberSchema instanceof NormalizedSchema)return Object.assign(memberSchema,{memberName,_isMemberSchema:!0});return new NormalizedSchema(memberSchema,memberName)}var isMemberSchema=(sc)=>Array.isArray(sc)&&sc.length===2,isStaticSchema=(sc)=>Array.isArray(sc)&&sc.length>=5;class SimpleSchema extends Schema2{static symbol=Symbol.for("@smithy/sim");name;schemaRef;traits;symbol=SimpleSchema.symbol}var sim=(namespace,name,schemaRef,traits)=>Schema2.assign(new SimpleSchema,{name,namespace,traits,schemaRef}),simAdapter=(namespace,name,traits,schemaRef)=>Schema2.assign(new SimpleSchema,{name,namespace,traits,schemaRef}),SCHEMA={BLOB:21,STREAMING_BLOB:42,BOOLEAN:2,STRING:0,NUMERIC:1,BIG_INTEGER:17,BIG_DECIMAL:19,DOCUMENT:15,TIMESTAMP_DEFAULT:4,TIMESTAMP_DATE_TIME:5,TIMESTAMP_HTTP_DATE:6,TIMESTAMP_EPOCH_SECONDS:7,LIST_MODIFIER:64,MAP_MODIFIER:128};class TypeRegistry{namespace;schemas;exceptions;static registries=new Map;constructor(namespace,schemas=new Map,exceptions=new Map){this.namespace=namespace,this.schemas=schemas,this.exceptions=exceptions}static for(namespace){if(!TypeRegistry.registries.has(namespace))TypeRegistry.registries.set(namespace,new TypeRegistry(namespace));return TypeRegistry.registries.get(namespace)}copyFrom(other){let{schemas,exceptions}=this;for(let[k2,v]of other.schemas)if(!schemas.has(k2))schemas.set(k2,v);for(let[k2,v]of other.exceptions)if(!exceptions.has(k2))exceptions.set(k2,v)}register(shapeId,schema){let qualifiedName=this.normalizeShapeId(shapeId);for(let r2 of[this,TypeRegistry.for(qualifiedName.split("#")[0])])r2.schemas.set(qualifiedName,schema)}getSchema(shapeId){let id=this.normalizeShapeId(shapeId);if(!this.schemas.has(id))throw Error(`@smithy/core/schema - schema not found for ${id}`);return this.schemas.get(id)}registerError(es,ctor){let $error2=es,ns=$error2[1];for(let r2 of[this,TypeRegistry.for(ns)])r2.schemas.set(ns+"#"+$error2[2],$error2),r2.exceptions.set($error2,ctor)}getErrorCtor(es){let $error2=es;if(this.exceptions.has($error2))return this.exceptions.get($error2);return TypeRegistry.for($error2[1]).exceptions.get($error2)}getBaseException(){for(let exceptionKey of this.exceptions.keys())if(Array.isArray(exceptionKey)){let[,ns,name]=exceptionKey,id=ns+"#"+name;if(id.startsWith("smithy.ts.sdk.synthetic.")&&id.endsWith("ServiceException"))return exceptionKey}return}find(predicate){return[...this.schemas.values()].find(predicate)}clear(){this.schemas.clear(),this.exceptions.clear()}normalizeShapeId(shapeId){if(shapeId.includes("#"))return shapeId;return this.namespace+"#"+shapeId}}exports.ErrorSchema=ErrorSchema;exports.ListSchema=ListSchema;exports.MapSchema=MapSchema;exports.NormalizedSchema=NormalizedSchema;exports.OperationSchema=OperationSchema;exports.SCHEMA=SCHEMA;exports.Schema=Schema2;exports.SimpleSchema=SimpleSchema;exports.StructureSchema=StructureSchema;exports.TypeRegistry=TypeRegistry;exports.deref=deref;exports.deserializerMiddlewareOption=deserializerMiddlewareOption;exports.error=error;exports.getSchemaSerdePlugin=getSchemaSerdePlugin;exports.isStaticSchema=isStaticSchema;exports.list=list;exports.map=map3;exports.op=op;exports.operation=operation;exports.serializerMiddlewareOption=serializerMiddlewareOption;exports.sim=sim;exports.simAdapter=simAdapter;exports.struct=struct;exports.translateTraits=translateTraits});var require_tslib=__commonJS((exports,module)=>{var __extends,__assign,__rest,__decorate,__param,__esDecorate,__runInitializers,__propKey,__setFunctionName,__metadata,__awaiter,__generator,__exportStar,__values,__read,__spread,__spreadArrays,__spreadArray,__await,__asyncGenerator,__asyncDelegator,__asyncValues,__makeTemplateObject,__importStar,__importDefault,__classPrivateFieldGet2,__classPrivateFieldSet2,__classPrivateFieldIn,__createBinding,__addDisposableResource,__disposeResources,__rewriteRelativeImportExtension;(function(factory){var root=typeof global==="object"?global:typeof self==="object"?self:typeof this==="object"?this:{};if(typeof define==="function"&&define.amd)define("tslib",["exports"],function(exports2){factory(createExporter(root,createExporter(exports2)))});else if(typeof module==="object"&&typeof exports==="object")factory(createExporter(root,createExporter(exports)));else factory(createExporter(root));function createExporter(exports2,previous){if(exports2!==root)if(typeof Object.create==="function")Object.defineProperty(exports2,"__esModule",{value:!0});else exports2.__esModule=!0;return function(id,v){return exports2[id]=previous?previous(id,v):v}}})(function(exporter){var extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(d,b2){d.__proto__=b2}||function(d,b2){for(var p in b2)if(Object.prototype.hasOwnProperty.call(b2,p))d[p]=b2[p]};__extends=function(d,b2){if(typeof b2!=="function"&&b2!==null)throw TypeError("Class extends value "+String(b2)+" is not a constructor or null");extendStatics(d,b2);function __(){this.constructor=d}d.prototype=b2===null?Object.create(b2):(__.prototype=b2.prototype,new __)},__assign=Object.assign||function(t2){for(var s,i=1,n2=arguments.length;i<n2;i++){s=arguments[i];for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p))t2[p]=s[p]}return t2},__rest=function(s,e){var t2={};for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0)t2[p]=s[p];if(s!=null&&typeof Object.getOwnPropertySymbols==="function"){for(var i=0,p=Object.getOwnPropertySymbols(s);i<p.length;i++)if(e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i]))t2[p[i]]=s[p[i]]}return t2},__decorate=function(decorators,target,key,desc2){var c=arguments.length,r2=c<3?target:desc2===null?desc2=Object.getOwnPropertyDescriptor(target,key):desc2,d;if(typeof Reflect==="object"&&typeof Reflect.decorate==="function")r2=Reflect.decorate(decorators,target,key,desc2);else for(var i=decorators.length-1;i>=0;i--)if(d=decorators[i])r2=(c<3?d(r2):c>3?d(target,key,r2):d(target,key))||r2;return c>3&&r2&&Object.defineProperty(target,key,r2),r2},__param=function(paramIndex,decorator){return function(target,key){decorator(target,key,paramIndex)}},__esDecorate=function(ctor,descriptorIn,decorators,contextIn,initializers,extraInitializers){function accept(f){if(f!==void 0&&typeof f!=="function")throw TypeError("Function expected");return f}var kind=contextIn.kind,key=kind==="getter"?"get":kind==="setter"?"set":"value",target=!descriptorIn&&ctor?contextIn.static?ctor:ctor.prototype:null,descriptor=descriptorIn||(target?Object.getOwnPropertyDescriptor(target,contextIn.name):{}),_2,done=!1;for(var i=decorators.length-1;i>=0;i--){var context={};for(var p in contextIn)context[p]=p==="access"?{}:contextIn[p];for(var p in contextIn.access)context.access[p]=contextIn.access[p];context.addInitializer=function(f){if(done)throw TypeError("Cannot add initializers after decoration has completed");extraInitializers.push(accept(f||null))};var result2=(0,decorators[i])(kind==="accessor"?{get:descriptor.get,set:descriptor.set}:descriptor[key],context);if(kind==="accessor"){if(result2===void 0)continue;if(result2===null||typeof result2!=="object")throw TypeError("Object expected");if(_2=accept(result2.get))descriptor.get=_2;if(_2=accept(result2.set))descriptor.set=_2;if(_2=accept(result2.init))initializers.unshift(_2)}else if(_2=accept(result2))if(kind==="field")initializers.unshift(_2);else descriptor[key]=_2}if(target)Object.defineProperty(target,contextIn.name,descriptor);done=!0},__runInitializers=function(thisArg,initializers,value){var useValue=arguments.length>2;for(var i=0;i<initializers.length;i++)value=useValue?initializers[i].call(thisArg,value):initializers[i].call(thisArg);return useValue?value:void 0},__propKey=function(x){return typeof x==="symbol"?x:"".concat(x)},__setFunctionName=function(f,name,prefix){if(typeof name==="symbol")name=name.description?"[".concat(name.description,"]"):"";return Object.defineProperty(f,"name",{configurable:!0,value:prefix?"".concat(prefix," ",name):name})},__metadata=function(metadataKey,metadataValue){if(typeof Reflect==="object"&&typeof Reflect.metadata==="function")return Reflect.metadata(metadataKey,metadataValue)},__awaiter=function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result2){result2.done?resolve(result2.value):adopt(result2.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})},__generator=function(thisArg,body){var _2={label:0,sent:function(){if(t2[0]&1)throw t2[1];return t2[1]},trys:[],ops:[]},f,y,t2,g=Object.create((typeof Iterator==="function"?Iterator:Object).prototype);return g.next=verb(0),g.throw=verb(1),g.return=verb(2),typeof Symbol==="function"&&(g[Symbol.iterator]=function(){return this}),g;function verb(n2){return function(v){return step([n2,v])}}function step(op){if(f)throw TypeError("Generator is already executing.");while(g&&(g=0,op[0]&&(_2=0)),_2)try{if(f=1,y&&(t2=op[0]&2?y.return:op[0]?y.throw||((t2=y.return)&&t2.call(y),0):y.next)&&!(t2=t2.call(y,op[1])).done)return t2;if(y=0,t2)op=[op[0]&2,t2.value];switch(op[0]){case 0:case 1:t2=op;break;case 4:return _2.label++,{value:op[1],done:!1};case 5:_2.label++,y=op[1],op=[0];continue;case 7:op=_2.ops.pop(),_2.trys.pop();continue;default:if((t2=_2.trys,!(t2=t2.length>0&&t2[t2.length-1]))&&(op[0]===6||op[0]===2)){_2=0;continue}if(op[0]===3&&(!t2||op[1]>t2[0]&&op[1]<t2[3])){_2.label=op[1];break}if(op[0]===6&&_2.label<t2[1]){_2.label=t2[1],t2=op;break}if(t2&&_2.label<t2[2]){_2.label=t2[2],_2.ops.push(op);break}if(t2[2])_2.ops.pop();_2.trys.pop();continue}op=body.call(thisArg,_2)}catch(e){op=[6,e],y=0}finally{f=t2=0}if(op[0]&5)throw op[1];return{value:op[0]?op[1]:void 0,done:!0}}},__exportStar=function(m2,o){for(var p in m2)if(p!=="default"&&!Object.prototype.hasOwnProperty.call(o,p))__createBinding(o,m2,p)},__createBinding=Object.create?function(o,m2,k2,k22){if(k22===void 0)k22=k2;var desc2=Object.getOwnPropertyDescriptor(m2,k2);if(!desc2||("get"in desc2?!m2.__esModule:desc2.writable||desc2.configurable))desc2={enumerable:!0,get:function(){return m2[k2]}};Object.defineProperty(o,k22,desc2)}:function(o,m2,k2,k22){if(k22===void 0)k22=k2;o[k22]=m2[k2]},__values=function(o){var s=typeof Symbol==="function"&&Symbol.iterator,m2=s&&o[s],i=0;if(m2)return m2.call(o);if(o&&typeof o.length==="number")return{next:function(){if(o&&i>=o.length)o=void 0;return{value:o&&o[i++],done:!o}}};throw TypeError(s?"Object is not iterable.":"Symbol.iterator is not defined.")},__read=function(o,n2){var m2=typeof Symbol==="function"&&o[Symbol.iterator];if(!m2)return o;var i=m2.call(o),r2,ar=[],e;try{while((n2===void 0||n2-- >0)&&!(r2=i.next()).done)ar.push(r2.value)}catch(error){e={error}}finally{try{if(r2&&!r2.done&&(m2=i.return))m2.call(i)}finally{if(e)throw e.error}}return ar},__spread=function(){for(var ar=[],i=0;i<arguments.length;i++)ar=ar.concat(__read(arguments[i]));return ar},__spreadArrays=function(){for(var s=0,i=0,il=arguments.length;i<il;i++)s+=arguments[i].length;for(var r2=Array(s),k2=0,i=0;i<il;i++)for(var a12=arguments[i],j=0,jl=a12.length;j<jl;j++,k2++)r2[k2]=a12[j];return r2},__spreadArray=function(to,from,pack){if(pack||arguments.length===2){for(var i=0,l2=from.length,ar;i<l2;i++)if(ar||!(i in from)){if(!ar)ar=Array.prototype.slice.call(from,0,i);ar[i]=from[i]}}return to.concat(ar||Array.prototype.slice.call(from))},__await=function(v){return this instanceof __await?(this.v=v,this):new __await(v)},__asyncGenerator=function(thisArg,_arguments,generator){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var g=generator.apply(thisArg,_arguments||[]),i,q=[];return i=Object.create((typeof AsyncIterator==="function"?AsyncIterator:Object).prototype),verb("next"),verb("throw"),verb("return",awaitReturn),i[Symbol.asyncIterator]=function(){return this},i;function awaitReturn(f){return function(v){return Promise.resolve(v).then(f,reject)}}function verb(n2,f){if(g[n2]){if(i[n2]=function(v){return new Promise(function(a12,b2){q.push([n2,v,a12,b2])>1||resume(n2,v)})},f)i[n2]=f(i[n2])}}function resume(n2,v){try{step(g[n2](v))}catch(e){settle(q[0][3],e)}}function step(r2){r2.value instanceof __await?Promise.resolve(r2.value.v).then(fulfill,reject):settle(q[0][2],r2)}function fulfill(value){resume("next",value)}function reject(value){resume("throw",value)}function settle(f,v){if(f(v),q.shift(),q.length)resume(q[0][0],q[0][1])}},__asyncDelegator=function(o){var i,p;return i={},verb("next"),verb("throw",function(e){throw e}),verb("return"),i[Symbol.iterator]=function(){return this},i;function verb(n2,f){i[n2]=o[n2]?function(v){return(p=!p)?{value:__await(o[n2](v)),done:!1}:f?f(v):v}:f}},__asyncValues=function(o){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var m2=o[Symbol.asyncIterator],i;return m2?m2.call(o):(o=typeof __values==="function"?__values(o):o[Symbol.iterator](),i={},verb("next"),verb("throw"),verb("return"),i[Symbol.asyncIterator]=function(){return this},i);function verb(n2){i[n2]=o[n2]&&function(v){return new Promise(function(resolve,reject){v=o[n2](v),settle(resolve,reject,v.done,v.value)})}}function settle(resolve,reject,d,v){Promise.resolve(v).then(function(v2){resolve({value:v2,done:d})},reject)}},__makeTemplateObject=function(cooked,raw){if(Object.defineProperty)Object.defineProperty(cooked,"raw",{value:raw});else cooked.raw=raw;return cooked};var __setModuleDefault=Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:!0,value:v})}:function(o,v){o.default=v},ownKeys5=function(o){return ownKeys5=Object.getOwnPropertyNames||function(o2){var ar=[];for(var k2 in o2)if(Object.prototype.hasOwnProperty.call(o2,k2))ar[ar.length]=k2;return ar},ownKeys5(o)};__importStar=function(mod){if(mod&&mod.__esModule)return mod;var result2={};if(mod!=null){for(var k2=ownKeys5(mod),i=0;i<k2.length;i++)if(k2[i]!=="default")__createBinding(result2,mod,k2[i])}return __setModuleDefault(result2,mod),result2},__importDefault=function(mod){return mod&&mod.__esModule?mod:{default:mod}},__classPrivateFieldGet2=function(receiver,state,kind,f){if(kind==="a"&&!f)throw TypeError("Private accessor was defined without a getter");if(typeof state==="function"?receiver!==state||!f:!state.has(receiver))throw TypeError("Cannot read private member from an object whose class did not declare it");return kind==="m"?f:kind==="a"?f.call(receiver):f?f.value:state.get(receiver)},__classPrivateFieldSet2=function(receiver,state,value,kind,f){if(kind==="m")throw TypeError("Private method is not writable");if(kind==="a"&&!f)throw TypeError("Private accessor was defined without a setter");if(typeof state==="function"?receiver!==state||!f:!state.has(receiver))throw TypeError("Cannot write private member to an object whose class did not declare it");return kind==="a"?f.call(receiver,value):f?f.value=value:state.set(receiver,value),value},__classPrivateFieldIn=function(state,receiver){if(receiver===null||typeof receiver!=="object"&&typeof receiver!=="function")throw TypeError("Cannot use 'in' operator on non-object");return typeof state==="function"?receiver===state:state.has(receiver)},__addDisposableResource=function(env3,value,async){if(value!==null&&value!==void 0){if(typeof value!=="object"&&typeof value!=="function")throw TypeError("Object expected.");var dispose,inner;if(async){if(!Symbol.asyncDispose)throw TypeError("Symbol.asyncDispose is not defined.");dispose=value[Symbol.asyncDispose]}if(dispose===void 0){if(!Symbol.dispose)throw TypeError("Symbol.dispose is not defined.");if(dispose=value[Symbol.dispose],async)inner=dispose}if(typeof dispose!=="function")throw TypeError("Object not disposable.");if(inner)dispose=function(){try{inner.call(this)}catch(e){return Promise.reject(e)}};env3.stack.push({value,dispose,async})}else if(async)env3.stack.push({async:!0});return value};var _SuppressedError=typeof SuppressedError==="function"?SuppressedError:function(error,suppressed,message){var e=Error(message);return e.name="SuppressedError",e.error=error,e.suppressed=suppressed,e};__disposeResources=function(env3){function fail(e){env3.error=env3.hasError?new _SuppressedError(e,env3.error,"An error was suppressed during disposal."):e,env3.hasError=!0}var r2,s=0;function next(){while(r2=env3.stack.pop())try{if(!r2.async&&s===1)return s=0,env3.stack.push(r2),Promise.resolve().then(next);if(r2.dispose){var result2=r2.dispose.call(r2.value);if(r2.async)return s|=2,Promise.resolve(result2).then(next,function(e){return fail(e),next()})}else s|=1}catch(e){fail(e)}if(s===1)return env3.hasError?Promise.reject(env3.error):Promise.resolve();if(env3.hasError)throw env3.error}return next()},__rewriteRelativeImportExtension=function(path,preserveJsx){if(typeof path==="string"&&/^\.\.?\//.test(path))return path.replace(/\.(tsx)$|((?:\.d)?)((?:\.[^./]+?)?)\.([cm]?)ts$/i,function(m2,tsx,d,ext,cm){return tsx?preserveJsx?".jsx":".js":d&&(!ext||!cm)?m2:d+ext+"."+cm.toLowerCase()+"js"});return path},exporter("__extends",__extends),exporter("__assign",__assign),exporter("__rest",__rest),exporter("__decorate",__decorate),exporter("__param",__param),exporter("__esDecorate",__esDecorate),exporter("__runInitializers",__runInitializers),exporter("__propKey",__propKey),exporter("__setFunctionName",__setFunctionName),exporter("__metadata",__metadata),exporter("__awaiter",__awaiter),exporter("__generator",__generator),exporter("__exportStar",__exportStar),exporter("__createBinding",__createBinding),exporter("__values",__values),exporter("__read",__read),exporter("__spread",__spread),exporter("__spreadArrays",__spreadArrays),exporter("__spreadArray",__spreadArray),exporter("__await",__await),exporter("__asyncGenerator",__asyncGenerator),exporter("__asyncDelegator",__asyncDelegator),exporter("__asyncValues",__asyncValues),exporter("__makeTemplateObject",__makeTemplateObject),exporter("__importStar",__importStar),exporter("__importDefault",__importDefault),exporter("__classPrivateFieldGet",__classPrivateFieldGet2),exporter("__classPrivateFieldSet",__classPrivateFieldSet2),exporter("__classPrivateFieldIn",__classPrivateFieldIn),exporter("__addDisposableResource",__addDisposableResource),exporter("__disposeResources",__disposeResources),exporter("__rewriteRelativeImportExtension",__rewriteRelativeImportExtension)})});var require_randomUUID=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.randomUUID=void 0;var tslib_1=require_tslib(),crypto_1=tslib_1.__importDefault(__require("crypto"));exports.randomUUID=crypto_1.default.randomUUID.bind(crypto_1.default)});var require_dist_cjs15=__commonJS((exports)=>{var randomUUID=require_randomUUID(),decimalToHex=Array.from({length:256},(_2,i)=>i.toString(16).padStart(2,"0")),v4=()=>{if(randomUUID.randomUUID)return randomUUID.randomUUID();let rnds=new Uint8Array(16);return crypto.getRandomValues(rnds),rnds[6]=rnds[6]&15|64,rnds[8]=rnds[8]&63|128,decimalToHex[rnds[0]]+decimalToHex[rnds[1]]+decimalToHex[rnds[2]]+decimalToHex[rnds[3]]+"-"+decimalToHex[rnds[4]]+decimalToHex[rnds[5]]+"-"+decimalToHex[rnds[6]]+decimalToHex[rnds[7]]+"-"+decimalToHex[rnds[8]]+decimalToHex[rnds[9]]+"-"+decimalToHex[rnds[10]]+decimalToHex[rnds[11]]+decimalToHex[rnds[12]]+decimalToHex[rnds[13]]+decimalToHex[rnds[14]]+decimalToHex[rnds[15]]};exports.v4=v4});var require_serde=__commonJS((exports)=>{var uuid2=require_dist_cjs15(),copyDocumentWithTransform=(source,schemaRef,transform2=(_2)=>_2)=>source,parseBoolean=(value)=>{switch(value){case"true":return!0;case"false":return!1;default:throw Error(`Unable to parse boolean value "${value}"`)}},expectBoolean=(value)=>{if(value===null||value===void 0)return;if(typeof value==="number"){if(value===0||value===1)logger.warn(stackTraceWarning(`Expected boolean, got ${typeof value}: ${value}`));if(value===0)return!1;if(value===1)return!0}if(typeof value==="string"){let lower=value.toLowerCase();if(lower==="false"||lower==="true")logger.warn(stackTraceWarning(`Expected boolean, got ${typeof value}: ${value}`));if(lower==="false")return!1;if(lower==="true")return!0}if(typeof value==="boolean")return value;throw TypeError(`Expected boolean, got ${typeof value}: ${value}`)},expectNumber=(value)=>{if(value===null||value===void 0)return;if(typeof value==="string"){let parsed=parseFloat(value);if(!Number.isNaN(parsed)){if(String(parsed)!==String(value))logger.warn(stackTraceWarning(`Expected number but observed string: ${value}`));return parsed}}if(typeof value==="number")return value;throw TypeError(`Expected number, got ${typeof value}: ${value}`)},MAX_FLOAT=Math.ceil(340282346638528860000000000000000000000),expectFloat32=(value)=>{let expected=expectNumber(value);if(expected!==void 0&&!Number.isNaN(expected)&&expected!==1/0&&expected!==-1/0){if(Math.abs(expected)>MAX_FLOAT)throw TypeError(`Expected 32-bit float, got ${value}`)}return expected},expectLong=(value)=>{if(value===null||value===void 0)return;if(Number.isInteger(value)&&!Number.isNaN(value))return value;throw TypeError(`Expected integer, got ${typeof value}: ${value}`)},expectInt=expectLong,expectInt32=(value)=>expectSizedInt(value,32),expectShort=(value)=>expectSizedInt(value,16),expectByte=(value)=>expectSizedInt(value,8),expectSizedInt=(value,size)=>{let expected=expectLong(value);if(expected!==void 0&&castInt(expected,size)!==expected)throw TypeError(`Expected ${size}-bit integer, got ${value}`);return expected},castInt=(value,size)=>{switch(size){case 32:return Int32Array.of(value)[0];case 16:return Int16Array.of(value)[0];case 8:return Int8Array.of(value)[0]}},expectNonNull=(value,location)=>{if(value===null||value===void 0){if(location)throw TypeError(`Expected a non-null value for ${location}`);throw TypeError("Expected a non-null value")}return value},expectObject=(value)=>{if(value===null||value===void 0)return;if(typeof value==="object"&&!Array.isArray(value))return value;let receivedType=Array.isArray(value)?"array":typeof value;throw TypeError(`Expected object, got ${receivedType}: ${value}`)},expectString=(value)=>{if(value===null||value===void 0)return;if(typeof value==="string")return value;if(["boolean","number","bigint"].includes(typeof value))return logger.warn(stackTraceWarning(`Expected string, got ${typeof value}: ${value}`)),String(value);throw TypeError(`Expected string, got ${typeof value}: ${value}`)},expectUnion=(value)=>{if(value===null||value===void 0)return;let asObject=expectObject(value),setKeys=Object.entries(asObject).filter(([,v])=>v!=null).map(([k2])=>k2);if(setKeys.length===0)throw TypeError("Unions must have exactly one non-null member. None were found.");if(setKeys.length>1)throw TypeError(`Unions must have exactly one non-null member. Keys ${setKeys} were not null.`);return asObject},strictParseDouble=(value)=>{if(typeof value=="string")return expectNumber(parseNumber(value));return expectNumber(value)},strictParseFloat=strictParseDouble,strictParseFloat32=(value)=>{if(typeof value=="string")return expectFloat32(parseNumber(value));return expectFloat32(value)},NUMBER_REGEX=/(-?(?:0|[1-9]\d*)(?:\.\d+)?(?:[eE][+-]?\d+)?)|(-?Infinity)|(NaN)/g,parseNumber=(value)=>{let matches=value.match(NUMBER_REGEX);if(matches===null||matches[0].length!==value.length)throw TypeError("Expected real number, got implicit NaN");return parseFloat(value)},limitedParseDouble=(value)=>{if(typeof value=="string")return parseFloatString(value);return expectNumber(value)},handleFloat=limitedParseDouble,limitedParseFloat=limitedParseDouble,limitedParseFloat32=(value)=>{if(typeof value=="string")return parseFloatString(value);return expectFloat32(value)},parseFloatString=(value)=>{switch(value){case"NaN":return NaN;case"Infinity":return 1/0;case"-Infinity":return-1/0;default:throw Error(`Unable to parse float value: ${value}`)}},strictParseLong=(value)=>{if(typeof value==="string")return expectLong(parseNumber(value));return expectLong(value)},strictParseInt=strictParseLong,strictParseInt32=(value)=>{if(typeof value==="string")return expectInt32(parseNumber(value));return expectInt32(value)},strictParseShort=(value)=>{if(typeof value==="string")return expectShort(parseNumber(value));return expectShort(value)},strictParseByte=(value)=>{if(typeof value==="string")return expectByte(parseNumber(value));return expectByte(value)},stackTraceWarning=(message)=>{return String(TypeError(message).stack||message).split(`
`).slice(0,5).filter((s)=>!s.includes("stackTraceWarning")).join(`
`)},logger={warn:console.warn},DAYS2=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],MONTHS=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function dateToUtcString(date4){let year2=date4.getUTCFullYear(),month=date4.getUTCMonth(),dayOfWeek=date4.getUTCDay(),dayOfMonthInt=date4.getUTCDate(),hoursInt=date4.getUTCHours(),minutesInt=date4.getUTCMinutes(),secondsInt=date4.getUTCSeconds(),dayOfMonthString=dayOfMonthInt<10?`0${dayOfMonthInt}`:`${dayOfMonthInt}`,hoursString=hoursInt<10?`0${hoursInt}`:`${hoursInt}`,minutesString=minutesInt<10?`0${minutesInt}`:`${minutesInt}`,secondsString=secondsInt<10?`0${secondsInt}`:`${secondsInt}`;return`${DAYS2[dayOfWeek]}, ${dayOfMonthString} ${MONTHS[month]} ${year2} ${hoursString}:${minutesString}:${secondsString} GMT`}var RFC3339=new RegExp(/^(\d{4})-(\d{2})-(\d{2})[tT](\d{2}):(\d{2}):(\d{2})(?:\.(\d+))?[zZ]$/),parseRfc3339DateTime=(value)=>{if(value===null||value===void 0)return;if(typeof value!=="string")throw TypeError("RFC-3339 date-times must be expressed as strings");let match=RFC3339.exec(value);if(!match)throw TypeError("Invalid RFC-3339 date-time value");let[_2,yearStr,monthStr,dayStr,hours,minutes,seconds,fractionalMilliseconds]=match,year2=strictParseShort(stripLeadingZeroes(yearStr)),month=parseDateValue(monthStr,"month",1,12),day=parseDateValue(dayStr,"day",1,31);return buildDate(year2,month,day,{hours,minutes,seconds,fractionalMilliseconds})},RFC3339_WITH_OFFSET$1=new RegExp(/^(\d{4})-(\d{2})-(\d{2})[tT](\d{2}):(\d{2}):(\d{2})(?:\.(\d+))?(([-+]\d{2}\:\d{2})|[zZ])$/),parseRfc3339DateTimeWithOffset=(value)=>{if(value===null||value===void 0)return;if(typeof value!=="string")throw TypeError("RFC-3339 date-times must be expressed as strings");let match=RFC3339_WITH_OFFSET$1.exec(value);if(!match)throw TypeError("Invalid RFC-3339 date-time value");let[_2,yearStr,monthStr,dayStr,hours,minutes,seconds,fractionalMilliseconds,offsetStr]=match,year2=strictParseShort(stripLeadingZeroes(yearStr)),month=parseDateValue(monthStr,"month",1,12),day=parseDateValue(dayStr,"day",1,31),date4=buildDate(year2,month,day,{hours,minutes,seconds,fractionalMilliseconds});if(offsetStr.toUpperCase()!="Z")date4.setTime(date4.getTime()-parseOffsetToMilliseconds(offsetStr));return date4},IMF_FIXDATE$1=new RegExp(/^(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d{2}) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d{1,2}):(\d{2}):(\d{2})(?:\.(\d+))? GMT$/),RFC_850_DATE$1=new RegExp(/^(?:Monday|Tuesday|Wednesday|Thursday|Friday|Saturday|Sunday), (\d{2})-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d{2}) (\d{1,2}):(\d{2}):(\d{2})(?:\.(\d+))? GMT$/),ASC_TIME$1=new RegExp(/^(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( [1-9]|\d{2}) (\d{1,2}):(\d{2}):(\d{2})(?:\.(\d+))? (\d{4})$/),parseRfc7231DateTime=(value)=>{if(value===null||value===void 0)return;if(typeof value!=="string")throw TypeError("RFC-7231 date-times must be expressed as strings");let match=IMF_FIXDATE$1.exec(value);if(match){let[_2,dayStr,monthStr,yearStr,hours,minutes,seconds,fractionalMilliseconds]=match;return buildDate(strictParseShort(stripLeadingZeroes(yearStr)),parseMonthByShortName(monthStr),parseDateValue(dayStr,"day",1,31),{hours,minutes,seconds,fractionalMilliseconds})}if(match=RFC_850_DATE$1.exec(value),match){let[_2,dayStr,monthStr,yearStr,hours,minutes,seconds,fractionalMilliseconds]=match;return adjustRfc850Year(buildDate(parseTwoDigitYear(yearStr),parseMonthByShortName(monthStr),parseDateValue(dayStr,"day",1,31),{hours,minutes,seconds,fractionalMilliseconds}))}if(match=ASC_TIME$1.exec(value),match){let[_2,monthStr,dayStr,hours,minutes,seconds,fractionalMilliseconds,yearStr]=match;return buildDate(strictParseShort(stripLeadingZeroes(yearStr)),parseMonthByShortName(monthStr),parseDateValue(dayStr.trimLeft(),"day",1,31),{hours,minutes,seconds,fractionalMilliseconds})}throw TypeError("Invalid RFC-7231 date-time value")},parseEpochTimestamp=(value)=>{if(value===null||value===void 0)return;let valueAsDouble;if(typeof value==="number")valueAsDouble=value;else if(typeof value==="string")valueAsDouble=strictParseDouble(value);else if(typeof value==="object"&&value.tag===1)valueAsDouble=value.value;else throw TypeError("Epoch timestamps must be expressed as floating point numbers or their string representation");if(Number.isNaN(valueAsDouble)||valueAsDouble===1/0||valueAsDouble===-1/0)throw TypeError("Epoch timestamps must be valid, non-Infinite, non-NaN numerics");return new Date(Math.round(valueAsDouble*1000))},buildDate=(year2,month,day,time3)=>{let adjustedMonth=month-1;return validateDayOfMonth(year2,adjustedMonth,day),new Date(Date.UTC(year2,adjustedMonth,day,parseDateValue(time3.hours,"hour",0,23),parseDateValue(time3.minutes,"minute",0,59),parseDateValue(time3.seconds,"seconds",0,60),parseMilliseconds(time3.fractionalMilliseconds)))},parseTwoDigitYear=(value)=>{let thisYear=new Date().getUTCFullYear(),valueInThisCentury=Math.floor(thisYear/100)*100+strictParseShort(stripLeadingZeroes(value));if(valueInThisCentury<thisYear)return valueInThisCentury+100;return valueInThisCentury},FIFTY_YEARS_IN_MILLIS=1576800000000,adjustRfc850Year=(input)=>{if(input.getTime()-new Date().getTime()>FIFTY_YEARS_IN_MILLIS)return new Date(Date.UTC(input.getUTCFullYear()-100,input.getUTCMonth(),input.getUTCDate(),input.getUTCHours(),input.getUTCMinutes(),input.getUTCSeconds(),input.getUTCMilliseconds()));return input},parseMonthByShortName=(value)=>{let monthIdx=MONTHS.indexOf(value);if(monthIdx<0)throw TypeError(`Invalid month: ${value}`);return monthIdx+1},DAYS_IN_MONTH=[31,28,31,30,31,30,31,31,30,31,30,31],validateDayOfMonth=(year2,month,day)=>{let maxDays=DAYS_IN_MONTH[month];if(month===1&&isLeapYear2(year2))maxDays=29;if(day>maxDays)throw TypeError(`Invalid day for ${MONTHS[month]} in ${year2}: ${day}`)},isLeapYear2=(year2)=>{return year2%4===0&&(year2%100!==0||year2%400===0)},parseDateValue=(value,type,lower,upper)=>{let dateVal=strictParseByte(stripLeadingZeroes(value));if(dateVal<lower||dateVal>upper)throw TypeError(`${type} must be between ${lower} and ${upper}, inclusive`);return dateVal},parseMilliseconds=(value)=>{if(value===null||value===void 0)return 0;return strictParseFloat32("0."+value)*1000},parseOffsetToMilliseconds=(value)=>{let directionStr=value[0],direction=1;if(directionStr=="+")direction=1;else if(directionStr=="-")direction=-1;else throw TypeError(`Offset direction, ${directionStr}, must be "+" or "-"`);let hour=Number(value.substring(1,3)),minute=Number(value.substring(4,6));return direction*(hour*60+minute)*60*1000},stripLeadingZeroes=(value)=>{let idx=0;while(idx<value.length-1&&value.charAt(idx)==="0")idx++;if(idx===0)return value;return value.slice(idx)},LazyJsonString=function(val){return Object.assign(new String(val),{deserializeJSON(){return JSON.parse(String(val))},toString(){return String(val)},toJSON(){return String(val)}})};LazyJsonString.from=(object)=>{if(object&&typeof object==="object"&&(object instanceof LazyJsonString||("deserializeJSON"in object)))return object;else if(typeof object==="string"||Object.getPrototypeOf(object)===String.prototype)return LazyJsonString(String(object));return LazyJsonString(JSON.stringify(object))};LazyJsonString.fromObject=LazyJsonString.from;function quoteHeader(part){if(part.includes(",")||part.includes('"'))part=`"${part.replace(/"/g,"\\\"")}"`;return part}var ddd="(?:Mon|Tue|Wed|Thu|Fri|Sat|Sun)(?:[ne|u?r]?s?day)?",mmm="(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)",time2="(\\d?\\d):(\\d{2}):(\\d{2})(?:\\.(\\d+))?",date3="(\\d?\\d)",year="(\\d{4})",RFC3339_WITH_OFFSET=new RegExp(/^(\d{4})-(\d\d)-(\d\d)[tT](\d\d):(\d\d):(\d\d)(\.(\d+))?(([-+]\d\d:\d\d)|[zZ])$/),IMF_FIXDATE=new RegExp(`^${ddd}, ${date3} ${mmm} ${year} ${time2} GMT$`),RFC_850_DATE=new RegExp(`^${ddd}, ${date3}-${mmm}-(\\d\\d) ${time2} GMT$`),ASC_TIME=new RegExp(`^${ddd} ${mmm} ( [1-9]|\\d\\d) ${time2} ${year}$`),months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],_parseEpochTimestamp=(value)=>{if(value==null)return;let num=NaN;if(typeof value==="number")num=value;else if(typeof value==="string"){if(!/^-?\d*\.?\d+$/.test(value))throw TypeError("parseEpochTimestamp - numeric string invalid.");num=Number.parseFloat(value)}else if(typeof value==="object"&&value.tag===1)num=value.value;if(isNaN(num)||Math.abs(num)===1/0)throw TypeError("Epoch timestamps must be valid finite numbers.");return new Date(Math.round(num*1000))},_parseRfc3339DateTimeWithOffset=(value)=>{if(value==null)return;if(typeof value!=="string")throw TypeError("RFC3339 timestamps must be strings");let matches=RFC3339_WITH_OFFSET.exec(value);if(!matches)throw TypeError(`Invalid RFC3339 timestamp format ${value}`);let[,yearStr,monthStr,dayStr,hours,minutes,seconds,,ms,offsetStr]=matches;range(monthStr,1,12),range(dayStr,1,31),range(hours,0,23),range(minutes,0,59),range(seconds,0,60);let date4=new Date(Date.UTC(Number(yearStr),Number(monthStr)-1,Number(dayStr),Number(hours),Number(minutes),Number(seconds),Number(ms)?Math.round(parseFloat(`0.${ms}`)*1000):0));if(date4.setUTCFullYear(Number(yearStr)),offsetStr.toUpperCase()!="Z"){let[,sign,offsetH,offsetM]=/([+-])(\d\d):(\d\d)/.exec(offsetStr)||[void 0,"+",0,0],scalar=sign==="-"?1:-1;date4.setTime(date4.getTime()+scalar*(Number(offsetH)*60*60*1000+Number(offsetM)*60*1000))}return date4},_parseRfc7231DateTime=(value)=>{if(value==null)return;if(typeof value!=="string")throw TypeError("RFC7231 timestamps must be strings.");let day,month,year2,hour,minute,second,fraction,matches;if(matches=IMF_FIXDATE.exec(value))[,day,month,year2,hour,minute,second,fraction]=matches;else if(matches=RFC_850_DATE.exec(value))[,day,month,year2,hour,minute,second,fraction]=matches,year2=(Number(year2)+1900).toString();else if(matches=ASC_TIME.exec(value))[,month,day,hour,minute,second,fraction,year2]=matches;if(year2&&second){let timestamp2=Date.UTC(Number(year2),months.indexOf(month),Number(day),Number(hour),Number(minute),Number(second),fraction?Math.round(parseFloat(`0.${fraction}`)*1000):0);range(day,1,31),range(hour,0,23),range(minute,0,59),range(second,0,60);let date4=new Date(timestamp2);return date4.setUTCFullYear(Number(year2)),date4}throw TypeError(`Invalid RFC7231 date-time value ${value}.`)};function range(v,min,max){let _v=Number(v);if(_v<min||_v>max)throw Error(`Value ${_v} out of range [${min}, ${max}]`)}function splitEvery(value,delimiter,numDelimiters){if(numDelimiters<=0||!Number.isInteger(numDelimiters))throw Error("Invalid number of delimiters ("+numDelimiters+") for splitEvery.");let segments=value.split(delimiter);if(numDelimiters===1)return segments;let compoundSegments=[],currentSegment="";for(let i=0;i<segments.length;i++){if(currentSegment==="")currentSegment=segments[i];else currentSegment+=delimiter+segments[i];if((i+1)%numDelimiters===0)compoundSegments.push(currentSegment),currentSegment=""}if(currentSegment!=="")compoundSegments.push(currentSegment);return compoundSegments}var splitHeader=(value)=>{let z=value.length,values2=[],withinQuotes=!1,prevChar=void 0,anchor=0;for(let i=0;i<z;++i){let char2=value[i];switch(char2){case'"':if(prevChar!=="\\")withinQuotes=!withinQuotes;break;case",":if(!withinQuotes)values2.push(value.slice(anchor,i)),anchor=i+1;break}prevChar=char2}return values2.push(value.slice(anchor)),values2.map((v)=>{v=v.trim();let z2=v.length;if(z2<2)return v;if(v[0]==='"'&&v[z2-1]==='"')v=v.slice(1,z2-1);return v.replace(/\\"/g,'"')})},format=/^-?\d*(\.\d+)?$/;class NumericValue{string;type;constructor(string,type){if(this.string=string,this.type=type,!format.test(string))throw Error('@smithy/core/serde - NumericValue must only contain [0-9], at most one decimal point ".", and an optional negation prefix "-".')}toString(){return this.string}static[Symbol.hasInstance](object){if(!object||typeof object!=="object")return!1;let _nv=object;return NumericValue.prototype.isPrototypeOf(object)||_nv.type==="bigDecimal"&&format.test(_nv.string)}}function nv(input){return new NumericValue(String(input),"bigDecimal")}Object.defineProperty(exports,"generateIdempotencyToken",{enumerable:!0,get:function(){return uuid2.v4}});exports.LazyJsonString=LazyJsonString;exports.NumericValue=NumericValue;exports._parseEpochTimestamp=_parseEpochTimestamp;exports._parseRfc3339DateTimeWithOffset=_parseRfc3339DateTimeWithOffset;exports._parseRfc7231DateTime=_parseRfc7231DateTime;exports.copyDocumentWithTransform=copyDocumentWithTransform;exports.dateToUtcString=dateToUtcString;exports.expectBoolean=expectBoolean;exports.expectByte=expectByte;exports.expectFloat32=expectFloat32;exports.expectInt=expectInt;exports.expectInt32=expectInt32;exports.expectLong=expectLong;exports.expectNonNull=expectNonNull;exports.expectNumber=expectNumber;exports.expectObject=expectObject;exports.expectShort=expectShort;exports.expectString=expectString;exports.expectUnion=expectUnion;exports.handleFloat=handleFloat;exports.limitedParseDouble=limitedParseDouble;exports.limitedParseFloat=limitedParseFloat;exports.limitedParseFloat32=limitedParseFloat32;exports.logger=logger;exports.nv=nv;exports.parseBoolean=parseBoolean;exports.parseEpochTimestamp=parseEpochTimestamp;exports.parseRfc3339DateTime=parseRfc3339DateTime;exports.parseRfc3339DateTimeWithOffset=parseRfc3339DateTimeWithOffset;exports.parseRfc7231DateTime=parseRfc7231DateTime;exports.quoteHeader=quoteHeader;exports.splitEvery=splitEvery;exports.splitHeader=splitHeader;exports.strictParseByte=strictParseByte;exports.strictParseDouble=strictParseDouble;exports.strictParseFloat=strictParseFloat;exports.strictParseFloat32=strictParseFloat32;exports.strictParseInt=strictParseInt;exports.strictParseInt32=strictParseInt32;exports.strictParseLong=strictParseLong;exports.strictParseShort=strictParseShort});var require_event_streams=__commonJS((exports)=>{var utilUtf8=require_dist_cjs7();class EventStreamSerde{marshaller;serializer;deserializer;serdeContext;defaultContentType;constructor({marshaller,serializer,deserializer,serdeContext,defaultContentType}){this.marshaller=marshaller,this.serializer=serializer,this.deserializer=deserializer,this.serdeContext=serdeContext,this.defaultContentType=defaultContentType}async serializeEventStream({eventStream,requestSchema,initialRequest}){let marshaller=this.marshaller,eventStreamMember=requestSchema.getEventStreamMember(),unionSchema=requestSchema.getMemberSchema(eventStreamMember),serializer=this.serializer,defaultContentType=this.defaultContentType,initialRequestMarker=Symbol("initialRequestMarker"),eventStreamIterable={async*[Symbol.asyncIterator](){if(initialRequest){let headers={":event-type":{type:"string",value:"initial-request"},":message-type":{type:"string",value:"event"},":content-type":{type:"string",value:defaultContentType}};serializer.write(requestSchema,initialRequest);let body=serializer.flush();yield{[initialRequestMarker]:!0,headers,body}}for await(let page of eventStream)yield page}};return marshaller.serialize(eventStreamIterable,(event)=>{if(event[initialRequestMarker])return{headers:event.headers,body:event.body};let unionMember=Object.keys(event).find((key)=>{return key!=="__type"})??"",{additionalHeaders,body,eventType,explicitPayloadContentType}=this.writeEventBody(unionMember,unionSchema,event);return{headers:{":event-type":{type:"string",value:eventType},":message-type":{type:"string",value:"event"},":content-type":{type:"string",value:explicitPayloadContentType??defaultContentType},...additionalHeaders},body}})}async deserializeEventStream({response,responseSchema,initialResponseContainer}){let marshaller=this.marshaller,eventStreamMember=responseSchema.getEventStreamMember(),memberSchemas=responseSchema.getMemberSchema(eventStreamMember).getMemberSchemas(),initialResponseMarker=Symbol("initialResponseMarker"),asyncIterable=marshaller.deserialize(response.body,async(event)=>{let unionMember=Object.keys(event).find((key)=>{return key!=="__type"})??"",body=event[unionMember].body;if(unionMember==="initial-response"){let dataObject=await this.deserializer.read(responseSchema,body);return delete dataObject[eventStreamMember],{[initialResponseMarker]:!0,...dataObject}}else if(unionMember in memberSchemas){let eventStreamSchema=memberSchemas[unionMember];if(eventStreamSchema.isStructSchema()){let out={},hasBindings=!1;for(let[name,member]of eventStreamSchema.structIterator()){let{eventHeader,eventPayload}=member.getMergedTraits();if(hasBindings=hasBindings||Boolean(eventHeader||eventPayload),eventPayload){if(member.isBlobSchema())out[name]=body;else if(member.isStringSchema())out[name]=(this.serdeContext?.utf8Encoder??utilUtf8.toUtf8)(body);else if(member.isStructSchema())out[name]=await this.deserializer.read(member,body)}else if(eventHeader){let value=event[unionMember].headers[name]?.value;if(value!=null)if(member.isNumericSchema())if(value&&typeof value==="object"&&"bytes"in value)out[name]=BigInt(value.toString());else out[name]=Number(value);else out[name]=value}}if(hasBindings)return{[unionMember]:out};if(body.byteLength===0)return{[unionMember]:{}}}return{[unionMember]:await this.deserializer.read(eventStreamSchema,body)}}else return{$unknown:event}}),asyncIterator=asyncIterable[Symbol.asyncIterator](),firstEvent=await asyncIterator.next();if(firstEvent.done)return asyncIterable;if(firstEvent.value?.[initialResponseMarker]){if(!responseSchema)throw Error("@smithy::core/protocols - initial-response event encountered in event stream but no response schema given.");for(let[key,value]of Object.entries(firstEvent.value))initialResponseContainer[key]=value}return{async*[Symbol.asyncIterator](){if(!firstEvent?.value?.[initialResponseMarker])yield firstEvent.value;while(!0){let{done,value}=await asyncIterator.next();if(done)break;yield value}}}}writeEventBody(unionMember,unionSchema,event){let serializer=this.serializer,eventType=unionMember,explicitPayloadMember=null,explicitPayloadContentType,isKnownSchema=(()=>{return unionSchema.getSchema()[4].includes(unionMember)})(),additionalHeaders={};if(!isKnownSchema){let[type,value]=event[unionMember];eventType=type,serializer.write(15,value)}else{let eventSchema=unionSchema.getMemberSchema(unionMember);if(eventSchema.isStructSchema()){for(let[memberName,memberSchema]of eventSchema.structIterator()){let{eventHeader,eventPayload}=memberSchema.getMergedTraits();if(eventPayload)explicitPayloadMember=memberName;else if(eventHeader){let value=event[unionMember][memberName],type="binary";if(memberSchema.isNumericSchema())if(-2147483648<=value&&value<=2147483647)type="integer";else type="long";else if(memberSchema.isTimestampSchema())type="timestamp";else if(memberSchema.isStringSchema())type="string";else if(memberSchema.isBooleanSchema())type="boolean";if(value!=null)additionalHeaders[memberName]={type,value},delete event[unionMember][memberName]}}if(explicitPayloadMember!==null){let payloadSchema=eventSchema.getMemberSchema(explicitPayloadMember);if(payloadSchema.isBlobSchema())explicitPayloadContentType="application/octet-stream";else if(payloadSchema.isStringSchema())explicitPayloadContentType="text/plain";serializer.write(payloadSchema,event[unionMember][explicitPayloadMember])}else serializer.write(eventSchema,event[unionMember])}else throw Error("@smithy/core/event-streams - non-struct member not supported in event stream union.")}let messageSerialization=serializer.flush();return{body:typeof messageSerialization==="string"?(this.serdeContext?.utf8Decoder??utilUtf8.fromUtf8)(messageSerialization):messageSerialization,eventType,explicitPayloadContentType,additionalHeaders}}}exports.EventStreamSerde=EventStreamSerde});var require_protocols=__commonJS((exports)=>{var utilStream=require_dist_cjs14(),schema=require_schema(),serde=require_serde(),protocolHttp=require_dist_cjs2(),utilBase64=require_dist_cjs8(),utilUtf8=require_dist_cjs7(),collectBody=async(streamBody=new Uint8Array,context)=>{if(streamBody instanceof Uint8Array)return utilStream.Uint8ArrayBlobAdapter.mutate(streamBody);if(!streamBody)return utilStream.Uint8ArrayBlobAdapter.mutate(new Uint8Array);let fromContext=context.streamCollector(streamBody);return utilStream.Uint8ArrayBlobAdapter.mutate(await fromContext)};function extendedEncodeURIComponent(str){return encodeURIComponent(str).replace(/[!'()*]/g,function(c){return"%"+c.charCodeAt(0).toString(16).toUpperCase()})}class SerdeContext{serdeContext;setSerdeContext(serdeContext){this.serdeContext=serdeContext}}class HttpProtocol extends SerdeContext{options;compositeErrorRegistry;constructor(options){super();this.options=options,this.compositeErrorRegistry=schema.TypeRegistry.for(options.defaultNamespace);for(let etr of options.errorTypeRegistries??[])this.compositeErrorRegistry.copyFrom(etr)}getRequestType(){return protocolHttp.HttpRequest}getResponseType(){return protocolHttp.HttpResponse}setSerdeContext(serdeContext){if(this.serdeContext=serdeContext,this.serializer.setSerdeContext(serdeContext),this.deserializer.setSerdeContext(serdeContext),this.getPayloadCodec())this.getPayloadCodec().setSerdeContext(serdeContext)}updateServiceEndpoint(request,endpoint){if("url"in endpoint){if(request.protocol=endpoint.url.protocol,request.hostname=endpoint.url.hostname,request.port=endpoint.url.port?Number(endpoint.url.port):void 0,request.path=endpoint.url.pathname,request.fragment=endpoint.url.hash||void 0,request.username=endpoint.url.username||void 0,request.password=endpoint.url.password||void 0,!request.query)request.query={};for(let[k2,v]of endpoint.url.searchParams.entries())request.query[k2]=v;return request}else return request.protocol=endpoint.protocol,request.hostname=endpoint.hostname,request.port=endpoint.port?Number(endpoint.port):void 0,request.path=endpoint.path,request.query={...endpoint.query},request}setHostPrefix(request,operationSchema,input){if(this.serdeContext?.disableHostPrefix)return;let inputNs=schema.NormalizedSchema.of(operationSchema.input),opTraits=schema.translateTraits(operationSchema.traits??{});if(opTraits.endpoint){let hostPrefix=opTraits.endpoint?.[0];if(typeof hostPrefix==="string"){let hostLabelInputs=[...inputNs.structIterator()].filter(([,member])=>member.getMergedTraits().hostLabel);for(let[name]of hostLabelInputs){let replacement=input[name];if(typeof replacement!=="string")throw Error(`@smithy/core/schema - ${name} in input must be a string as hostLabel.`);hostPrefix=hostPrefix.replace(`{${name}}`,replacement)}request.hostname=hostPrefix+request.hostname}}}deserializeMetadata(output){return{httpStatusCode:output.statusCode,requestId:output.headers["x-amzn-requestid"]??output.headers["x-amzn-request-id"]??output.headers["x-amz-request-id"],extendedRequestId:output.headers["x-amz-id-2"],cfId:output.headers["x-amz-cf-id"]}}async serializeEventStream({eventStream,requestSchema,initialRequest}){return(await this.loadEventStreamCapability()).serializeEventStream({eventStream,requestSchema,initialRequest})}async deserializeEventStream({response,responseSchema,initialResponseContainer}){return(await this.loadEventStreamCapability()).deserializeEventStream({response,responseSchema,initialResponseContainer})}async loadEventStreamCapability(){let{EventStreamSerde}=await Promise.resolve().then(() => __toESM(require_event_streams()));return new EventStreamSerde({marshaller:this.getEventStreamMarshaller(),serializer:this.serializer,deserializer:this.deserializer,serdeContext:this.serdeContext,defaultContentType:this.getDefaultContentType()})}getDefaultContentType(){throw Error(`@smithy/core/protocols - ${this.constructor.name} getDefaultContentType() implementation missing.`)}async deserializeHttpMessage(schema2,context,response,arg4,arg5){return[]}getEventStreamMarshaller(){let context=this.serdeContext;if(!context.eventStreamMarshaller)throw Error("@smithy/core - HttpProtocol: eventStreamMarshaller missing in serdeContext.");return context.eventStreamMarshaller}}class HttpBindingProtocol extends HttpProtocol{async serializeRequest(operationSchema,_input,context){let input={..._input??{}},serializer=this.serializer,query={},headers={},endpoint=await context.endpoint(),ns=schema.NormalizedSchema.of(operationSchema?.input),schema$1=ns.getSchema(),hasNonHttpBindingMember=!1,payload,request=new protocolHttp.HttpRequest({protocol:"",hostname:"",port:void 0,path:"",fragment:void 0,query,headers,body:void 0});if(endpoint){this.updateServiceEndpoint(request,endpoint),this.setHostPrefix(request,operationSchema,input);let opTraits=schema.translateTraits(operationSchema.traits);if(opTraits.http){request.method=opTraits.http[0];let[path,search]=opTraits.http[1].split("?");if(request.path=="/")request.path=path;else request.path+=path;let traitSearchParams=new URLSearchParams(search??"");Object.assign(query,Object.fromEntries(traitSearchParams))}}for(let[memberName,memberNs]of ns.structIterator()){let memberTraits=memberNs.getMergedTraits()??{},inputMemberValue=input[memberName];if(inputMemberValue==null&&!memberNs.isIdempotencyToken()){if(memberTraits.httpLabel){if(request.path.includes(`{${memberName}+}`)||request.path.includes(`{${memberName}}`))throw Error(`No value provided for input HTTP label: ${memberName}.`)}continue}if(memberTraits.httpPayload){if(memberNs.isStreaming())if(memberNs.isStructSchema()){if(input[memberName])payload=await this.serializeEventStream({eventStream:input[memberName],requestSchema:ns})}else payload=inputMemberValue;else serializer.write(memberNs,inputMemberValue),payload=serializer.flush();delete input[memberName]}else if(memberTraits.httpLabel){serializer.write(memberNs,inputMemberValue);let replacement=serializer.flush();if(request.path.includes(`{${memberName}+}`))request.path=request.path.replace(`{${memberName}+}`,replacement.split("/").map(extendedEncodeURIComponent).join("/"));else if(request.path.includes(`{${memberName}}`))request.path=request.path.replace(`{${memberName}}`,extendedEncodeURIComponent(replacement));delete input[memberName]}else if(memberTraits.httpHeader)serializer.write(memberNs,inputMemberValue),headers[memberTraits.httpHeader.toLowerCase()]=String(serializer.flush()),delete input[memberName];else if(typeof memberTraits.httpPrefixHeaders==="string"){for(let[key,val]of Object.entries(inputMemberValue)){let amalgam=memberTraits.httpPrefixHeaders+key;serializer.write([memberNs.getValueSchema(),{httpHeader:amalgam}],val),headers[amalgam.toLowerCase()]=serializer.flush()}delete input[memberName]}else if(memberTraits.httpQuery||memberTraits.httpQueryParams)this.serializeQuery(memberNs,inputMemberValue,query),delete input[memberName];else hasNonHttpBindingMember=!0}if(hasNonHttpBindingMember&&input)serializer.write(schema$1,input),payload=serializer.flush();return request.headers=headers,request.query=query,request.body=payload,request}serializeQuery(ns,data,query){let serializer=this.serializer,traits=ns.getMergedTraits();if(traits.httpQueryParams){for(let[key,val]of Object.entries(data))if(!(key in query)){let valueSchema=ns.getValueSchema();Object.assign(valueSchema.getMergedTraits(),{...traits,httpQuery:key,httpQueryParams:void 0}),this.serializeQuery(valueSchema,val,query)}return}if(ns.isListSchema()){let sparse=!!ns.getMergedTraits().sparse,buffer2=[];for(let item of data){serializer.write([ns.getValueSchema(),traits],item);let serializable=serializer.flush();if(sparse||serializable!==void 0)buffer2.push(serializable)}query[traits.httpQuery]=buffer2}else serializer.write([ns,traits],data),query[traits.httpQuery]=serializer.flush()}async deserializeResponse(operationSchema,context,response){let deserializer=this.deserializer,ns=schema.NormalizedSchema.of(operationSchema.output),dataObject={};if(response.statusCode>=300){let bytes=await collectBody(response.body,context);if(bytes.byteLength>0)Object.assign(dataObject,await deserializer.read(15,bytes));throw await this.handleError(operationSchema,context,response,dataObject,this.deserializeMetadata(response)),Error("@smithy/core/protocols - HTTP Protocol error handler failed to throw.")}for(let header in response.headers){let value=response.headers[header];delete response.headers[header],response.headers[header.toLowerCase()]=value}let nonHttpBindingMembers=await this.deserializeHttpMessage(ns,context,response,dataObject);if(nonHttpBindingMembers.length){let bytes=await collectBody(response.body,context);if(bytes.byteLength>0){let dataFromBody=await deserializer.read(ns,bytes);for(let member of nonHttpBindingMembers)dataObject[member]=dataFromBody[member]}}else if(nonHttpBindingMembers.discardResponseBody)await collectBody(response.body,context);return dataObject.$metadata=this.deserializeMetadata(response),dataObject}async deserializeHttpMessage(schema$1,context,response,arg4,arg5){let dataObject;if(arg4 instanceof Set)dataObject=arg5;else dataObject=arg4;let discardResponseBody=!0,deserializer=this.deserializer,ns=schema.NormalizedSchema.of(schema$1),nonHttpBindingMembers=[];for(let[memberName,memberSchema]of ns.structIterator()){let memberTraits=memberSchema.getMemberTraits();if(memberTraits.httpPayload){if(discardResponseBody=!1,memberSchema.isStreaming())if(memberSchema.isStructSchema())dataObject[memberName]=await this.deserializeEventStream({response,responseSchema:ns});else dataObject[memberName]=utilStream.sdkStreamMixin(response.body);else if(response.body){let bytes=await collectBody(response.body,context);if(bytes.byteLength>0)dataObject[memberName]=await deserializer.read(memberSchema,bytes)}}else if(memberTraits.httpHeader){let key=String(memberTraits.httpHeader).toLowerCase(),value=response.headers[key];if(value!=null)if(memberSchema.isListSchema()){let headerListValueSchema=memberSchema.getValueSchema();headerListValueSchema.getMergedTraits().httpHeader=key;let sections;if(headerListValueSchema.isTimestampSchema()&&headerListValueSchema.getSchema()===4)sections=serde.splitEvery(value,",",2);else sections=serde.splitHeader(value);let list=[];for(let section of sections)list.push(await deserializer.read(headerListValueSchema,section.trim()));dataObject[memberName]=list}else dataObject[memberName]=await deserializer.read(memberSchema,value)}else if(memberTraits.httpPrefixHeaders!==void 0){dataObject[memberName]={};for(let[header,value]of Object.entries(response.headers))if(header.startsWith(memberTraits.httpPrefixHeaders)){let valueSchema=memberSchema.getValueSchema();valueSchema.getMergedTraits().httpHeader=header,dataObject[memberName][header.slice(memberTraits.httpPrefixHeaders.length)]=await deserializer.read(valueSchema,value)}}else if(memberTraits.httpResponseCode)dataObject[memberName]=response.statusCode;else nonHttpBindingMembers.push(memberName)}return nonHttpBindingMembers.discardResponseBody=discardResponseBody,nonHttpBindingMembers}}class RpcProtocol extends HttpProtocol{async serializeRequest(operationSchema,input,context){let serializer=this.serializer,query={},headers={},endpoint=await context.endpoint(),ns=schema.NormalizedSchema.of(operationSchema?.input),schema$1=ns.getSchema(),payload,request=new protocolHttp.HttpRequest({protocol:"",hostname:"",port:void 0,path:"/",fragment:void 0,query,headers,body:void 0});if(endpoint)this.updateServiceEndpoint(request,endpoint),this.setHostPrefix(request,operationSchema,input);let _input={...input};if(input){let eventStreamMember=ns.getEventStreamMember();if(eventStreamMember){if(_input[eventStreamMember]){let initialRequest={};for(let[memberName,memberSchema]of ns.structIterator())if(memberName!==eventStreamMember&&_input[memberName])serializer.write(memberSchema,_input[memberName]),initialRequest[memberName]=serializer.flush();payload=await this.serializeEventStream({eventStream:_input[eventStreamMember],requestSchema:ns,initialRequest})}}else serializer.write(schema$1,_input),payload=serializer.flush()}return request.headers=headers,request.query=query,request.body=payload,request.method="POST",request}async deserializeResponse(operationSchema,context,response){let deserializer=this.deserializer,ns=schema.NormalizedSchema.of(operationSchema.output),dataObject={};if(response.statusCode>=300){let bytes=await collectBody(response.body,context);if(bytes.byteLength>0)Object.assign(dataObject,await deserializer.read(15,bytes));throw await this.handleError(operationSchema,context,response,dataObject,this.deserializeMetadata(response)),Error("@smithy/core/protocols - RPC Protocol error handler failed to throw.")}for(let header in response.headers){let value=response.headers[header];delete response.headers[header],response.headers[header.toLowerCase()]=value}let eventStreamMember=ns.getEventStreamMember();if(eventStreamMember)dataObject[eventStreamMember]=await this.deserializeEventStream({response,responseSchema:ns,initialResponseContainer:dataObject});else{let bytes=await collectBody(response.body,context);if(bytes.byteLength>0)Object.assign(dataObject,await deserializer.read(ns,bytes))}return dataObject.$metadata=this.deserializeMetadata(response),dataObject}}var resolvedPath=(resolvedPath2,input,memberName,labelValueProvider,uriLabel,isGreedyLabel)=>{if(input!=null&&input[memberName]!==void 0){let labelValue=labelValueProvider();if(labelValue.length<=0)throw Error("Empty value provided for input HTTP label: "+memberName+".");resolvedPath2=resolvedPath2.replace(uriLabel,isGreedyLabel?labelValue.split("/").map((segment)=>extendedEncodeURIComponent(segment)).join("/"):extendedEncodeURIComponent(labelValue))}else throw Error("No value provided for input HTTP label: "+memberName+".");return resolvedPath2};function requestBuilder(input,context){return new RequestBuilder(input,context)}class RequestBuilder{input;context;query={};method="";headers={};path="";body=null;hostname="";resolvePathStack=[];constructor(input,context){this.input=input,this.context=context}async build(){let{hostname,protocol="https",port,path:basePath}=await this.context.endpoint();this.path=basePath;for(let resolvePath of this.resolvePathStack)resolvePath(this.path);return new protocolHttp.HttpRequest({protocol,hostname:this.hostname||hostname,port,method:this.method,path:this.path,query:this.query,body:this.body,headers:this.headers})}hn(hostname){return this.hostname=hostname,this}bp(uriLabel){return this.resolvePathStack.push((basePath)=>{this.path=`${basePath?.endsWith("/")?basePath.slice(0,-1):basePath||""}`+uriLabel}),this}p(memberName,labelValueProvider,uriLabel,isGreedyLabel){return this.resolvePathStack.push((path)=>{this.path=resolvedPath(path,this.input,memberName,labelValueProvider,uriLabel,isGreedyLabel)}),this}h(headers){return this.headers=headers,this}q(query){return this.query=query,this}b(body){return this.body=body,this}m(method){return this.method=method,this}}function determineTimestampFormat(ns,settings){if(settings.timestampFormat.useTrait){if(ns.isTimestampSchema()&&(ns.getSchema()===5||ns.getSchema()===6||ns.getSchema()===7))return ns.getSchema()}let{httpLabel,httpPrefixHeaders,httpHeader,httpQuery}=ns.getMergedTraits();return(settings.httpBindings?typeof httpPrefixHeaders==="string"||Boolean(httpHeader)?6:Boolean(httpQuery)||Boolean(httpLabel)?5:void 0:void 0)??settings.timestampFormat.default}class FromStringShapeDeserializer extends SerdeContext{settings;constructor(settings){super();this.settings=settings}read(_schema,data){let ns=schema.NormalizedSchema.of(_schema);if(ns.isListSchema())return serde.splitHeader(data).map((item)=>this.read(ns.getValueSchema(),item));if(ns.isBlobSchema())return(this.serdeContext?.base64Decoder??utilBase64.fromBase64)(data);if(ns.isTimestampSchema())switch(determineTimestampFormat(ns,this.settings)){case 5:return serde._parseRfc3339DateTimeWithOffset(data);case 6:return serde._parseRfc7231DateTime(data);case 7:return serde._parseEpochTimestamp(data);default:return console.warn("Missing timestamp format, parsing value with Date constructor:",data),new Date(data)}if(ns.isStringSchema()){let mediaType=ns.getMergedTraits().mediaType,intermediateValue=data;if(mediaType){if(ns.getMergedTraits().httpHeader)intermediateValue=this.base64ToUtf8(intermediateValue);if(mediaType==="application/json"||mediaType.endsWith("+json"))intermediateValue=serde.LazyJsonString.from(intermediateValue);return intermediateValue}}if(ns.isNumericSchema())return Number(data);if(ns.isBigIntegerSchema())return BigInt(data);if(ns.isBigDecimalSchema())return new serde.NumericValue(data,"bigDecimal");if(ns.isBooleanSchema())return String(data).toLowerCase()==="true";return data}base64ToUtf8(base64String){return(this.serdeContext?.utf8Encoder??utilUtf8.toUtf8)((this.serdeContext?.base64Decoder??utilBase64.fromBase64)(base64String))}}class HttpInterceptingShapeDeserializer extends SerdeContext{codecDeserializer;stringDeserializer;constructor(codecDeserializer,codecSettings){super();this.codecDeserializer=codecDeserializer,this.stringDeserializer=new FromStringShapeDeserializer(codecSettings)}setSerdeContext(serdeContext){this.stringDeserializer.setSerdeContext(serdeContext),this.codecDeserializer.setSerdeContext(serdeContext),this.serdeContext=serdeContext}read(schema$1,data){let ns=schema.NormalizedSchema.of(schema$1),traits=ns.getMergedTraits(),toString=this.serdeContext?.utf8Encoder??utilUtf8.toUtf8;if(traits.httpHeader||traits.httpResponseCode)return this.stringDeserializer.read(ns,toString(data));if(traits.httpPayload){if(ns.isBlobSchema()){let toBytes=this.serdeContext?.utf8Decoder??utilUtf8.fromUtf8;if(typeof data==="string")return toBytes(data);return data}else if(ns.isStringSchema()){if("byteLength"in data)return toString(data);return data}}return this.codecDeserializer.read(ns,data)}}class ToStringShapeSerializer extends SerdeContext{settings;stringBuffer="";constructor(settings){super();this.settings=settings}write(schema$1,value){let ns=schema.NormalizedSchema.of(schema$1);switch(typeof value){case"object":if(value===null){this.stringBuffer="null";return}if(ns.isTimestampSchema()){if(!(value instanceof Date))throw Error(`@smithy/core/protocols - received non-Date value ${value} when schema expected Date in ${ns.getName(!0)}`);switch(determineTimestampFormat(ns,this.settings)){case 5:this.stringBuffer=value.toISOString().replace(".000Z","Z");break;case 6:this.stringBuffer=serde.dateToUtcString(value);break;case 7:this.stringBuffer=String(value.getTime()/1000);break;default:console.warn("Missing timestamp format, using epoch seconds",value),this.stringBuffer=String(value.getTime()/1000)}return}if(ns.isBlobSchema()&&"byteLength"in value){this.stringBuffer=(this.serdeContext?.base64Encoder??utilBase64.toBase64)(value);return}if(ns.isListSchema()&&Array.isArray(value)){let buffer2="";for(let item of value){this.write([ns.getValueSchema(),ns.getMergedTraits()],item);let headerItem=this.flush(),serialized=ns.getValueSchema().isTimestampSchema()?headerItem:serde.quoteHeader(headerItem);if(buffer2!=="")buffer2+=", ";buffer2+=serialized}this.stringBuffer=buffer2;return}this.stringBuffer=JSON.stringify(value,null,2);break;case"string":let mediaType=ns.getMergedTraits().mediaType,intermediateValue=value;if(mediaType){if(mediaType==="application/json"||mediaType.endsWith("+json"))intermediateValue=serde.LazyJsonString.from(intermediateValue);if(ns.getMergedTraits().httpHeader){this.stringBuffer=(this.serdeContext?.base64Encoder??utilBase64.toBase64)(intermediateValue.toString());return}}this.stringBuffer=value;break;default:if(ns.isIdempotencyToken())this.stringBuffer=serde.generateIdempotencyToken();else this.stringBuffer=String(value)}}flush(){let buffer2=this.stringBuffer;return this.stringBuffer="",buffer2}}class HttpInterceptingShapeSerializer{codecSerializer;stringSerializer;buffer;constructor(codecSerializer,codecSettings,stringSerializer=new ToStringShapeSerializer(codecSettings)){this.codecSerializer=codecSerializer,this.stringSerializer=stringSerializer}setSerdeContext(serdeContext){this.codecSerializer.setSerdeContext(serdeContext),this.stringSerializer.setSerdeContext(serdeContext)}write(schema$1,value){let ns=schema.NormalizedSchema.of(schema$1),traits=ns.getMergedTraits();if(traits.httpHeader||traits.httpLabel||traits.httpQuery){this.stringSerializer.write(ns,value),this.buffer=this.stringSerializer.flush();return}return this.codecSerializer.write(ns,value)}flush(){if(this.buffer!==void 0){let buffer2=this.buffer;return this.buffer=void 0,buffer2}return this.codecSerializer.flush()}}exports.FromStringShapeDeserializer=FromStringShapeDeserializer;exports.HttpBindingProtocol=HttpBindingProtocol;exports.HttpInterceptingShapeDeserializer=HttpInterceptingShapeDeserializer;exports.HttpInterceptingShapeSerializer=HttpInterceptingShapeSerializer;exports.HttpProtocol=HttpProtocol;exports.RequestBuilder=RequestBuilder;exports.RpcProtocol=RpcProtocol;exports.SerdeContext=SerdeContext;exports.ToStringShapeSerializer=ToStringShapeSerializer;exports.collectBody=collectBody;exports.determineTimestampFormat=determineTimestampFormat;exports.extendedEncodeURIComponent=extendedEncodeURIComponent;exports.requestBuilder=requestBuilder;exports.resolvedPath=resolvedPath});var require_dist_cjs16=__commonJS((exports)=>{var types3=require_dist_cjs(),utilMiddleware=require_dist_cjs3(),middlewareSerde=require_dist_cjs4(),protocolHttp=require_dist_cjs2(),protocols=require_protocols(),getSmithyContext=(context)=>context[types3.SMITHY_CONTEXT_KEY]||(context[types3.SMITHY_CONTEXT_KEY]={}),resolveAuthOptions=(candidateAuthOptions,authSchemePreference)=>{if(!authSchemePreference||authSchemePreference.length===0)return candidateAuthOptions;let preferredAuthOptions=[];for(let preferredSchemeName of authSchemePreference)for(let candidateAuthOption of candidateAuthOptions)if(candidateAuthOption.schemeId.split("#")[1]===preferredSchemeName)preferredAuthOptions.push(candidateAuthOption);for(let candidateAuthOption of candidateAuthOptions)if(!preferredAuthOptions.find(({schemeId})=>schemeId===candidateAuthOption.schemeId))preferredAuthOptions.push(candidateAuthOption);return preferredAuthOptions};function convertHttpAuthSchemesToMap(httpAuthSchemes){let map3=new Map;for(let scheme of httpAuthSchemes)map3.set(scheme.schemeId,scheme);return map3}var httpAuthSchemeMiddleware=(config,mwOptions)=>(next,context)=>async(args)=>{let options=config.httpAuthSchemeProvider(await mwOptions.httpAuthSchemeParametersProvider(config,context,args.input)),authSchemePreference=config.authSchemePreference?await config.authSchemePreference():[],resolvedOptions=resolveAuthOptions(options,authSchemePreference),authSchemes=convertHttpAuthSchemesToMap(config.httpAuthSchemes),smithyContext=utilMiddleware.getSmithyContext(context),failureReasons=[];for(let option of resolvedOptions){let scheme=authSchemes.get(option.schemeId);if(!scheme){failureReasons.push(`HttpAuthScheme \`${option.schemeId}\` was not enabled for this service.`);continue}let identityProvider=scheme.identityProvider(await mwOptions.identityProviderConfigProvider(config));if(!identityProvider){failureReasons.push(`HttpAuthScheme \`${option.schemeId}\` did not have an IdentityProvider configured.`);continue}let{identityProperties={},signingProperties={}}=option.propertiesExtractor?.(config,context)||{};option.identityProperties=Object.assign(option.identityProperties||{},identityProperties),option.signingProperties=Object.assign(option.signingProperties||{},signingProperties),smithyContext.selectedHttpAuthScheme={httpAuthOption:option,identity:await identityProvider(option.identityProperties),signer:scheme.signer};break}if(!smithyContext.selectedHttpAuthScheme)throw Error(failureReasons.join(`
`));return next(args)},httpAuthSchemeEndpointRuleSetMiddlewareOptions={step:"serialize",tags:["HTTP_AUTH_SCHEME"],name:"httpAuthSchemeMiddleware",override:!0,relation:"before",toMiddleware:"endpointV2Middleware"},getHttpAuthSchemeEndpointRuleSetPlugin=(config,{httpAuthSchemeParametersProvider,identityProviderConfigProvider})=>({applyToStack:(clientStack)=>{clientStack.addRelativeTo(httpAuthSchemeMiddleware(config,{httpAuthSchemeParametersProvider,identityProviderConfigProvider}),httpAuthSchemeEndpointRuleSetMiddlewareOptions)}}),httpAuthSchemeMiddlewareOptions={step:"serialize",tags:["HTTP_AUTH_SCHEME"],name:"httpAuthSchemeMiddleware",override:!0,relation:"before",toMiddleware:middlewareSerde.serializerMiddlewareOption.name},getHttpAuthSchemePlugin=(config,{httpAuthSchemeParametersProvider,identityProviderConfigProvider})=>({applyToStack:(clientStack)=>{clientStack.addRelativeTo(httpAuthSchemeMiddleware(config,{httpAuthSchemeParametersProvider,identityProviderConfigProvider}),httpAuthSchemeMiddlewareOptions)}}),defaultErrorHandler=(signingProperties)=>(error)=>{throw error},defaultSuccessHandler=(httpResponse,signingProperties)=>{},httpSigningMiddleware=(config)=>(next,context)=>async(args)=>{if(!protocolHttp.HttpRequest.isInstance(args.request))return next(args);let scheme=utilMiddleware.getSmithyContext(context).selectedHttpAuthScheme;if(!scheme)throw Error("No HttpAuthScheme was selected: unable to sign request");let{httpAuthOption:{signingProperties={}},identity,signer}=scheme,output=await next({...args,request:await signer.sign(args.request,identity,signingProperties)}).catch((signer.errorHandler||defaultErrorHandler)(signingProperties));return(signer.successHandler||defaultSuccessHandler)(output.response,signingProperties),output},httpSigningMiddlewareOptions={step:"finalizeRequest",tags:["HTTP_SIGNING"],name:"httpSigningMiddleware",aliases:["apiKeyMiddleware","tokenMiddleware","awsAuthMiddleware"],override:!0,relation:"after",toMiddleware:"retryMiddleware"},getHttpSigningPlugin=(config)=>({applyToStack:(clientStack)=>{clientStack.addRelativeTo(httpSigningMiddleware(),httpSigningMiddlewareOptions)}}),normalizeProvider=(input)=>{if(typeof input==="function")return input;let promisified=Promise.resolve(input);return()=>promisified},makePagedClientRequest=async(CommandCtor,client,input,withCommand=(_2)=>_2,...args)=>{let command=new CommandCtor(input);return command=withCommand(command)??command,await client.send(command,...args)};function createPaginator(ClientCtor,CommandCtor,inputTokenName,outputTokenName,pageSizeTokenName){return async function*(config,input,...additionalArguments){let _input=input,token=config.startingToken??_input[inputTokenName],hasNext=!0,page;while(hasNext){if(_input[inputTokenName]=token,pageSizeTokenName)_input[pageSizeTokenName]=_input[pageSizeTokenName]??config.pageSize;if(config.client instanceof ClientCtor)page=await makePagedClientRequest(CommandCtor,config.client,input,config.withCommand,...additionalArguments);else throw Error(`Invalid client, expected instance of ${ClientCtor.name}`);yield page;let prevToken=token;token=get(page,outputTokenName),hasNext=!!(token&&(!config.stopOnSameToken||token!==prevToken))}return}}var get=(fromObject,path)=>{let cursor=fromObject,pathComponents=path.split(".");for(let step of pathComponents){if(!cursor||typeof cursor!=="object")return;cursor=cursor[step]}return cursor};function setFeature(context,feature,value){if(!context.__smithy_context)context.__smithy_context={features:{}};else if(!context.__smithy_context.features)context.__smithy_context.features={};context.__smithy_context.features[feature]=value}class DefaultIdentityProviderConfig{authSchemes=new Map;constructor(config){for(let[key,value]of Object.entries(config))if(value!==void 0)this.authSchemes.set(key,value)}getIdentityProvider(schemeId){return this.authSchemes.get(schemeId)}}class HttpApiKeyAuthSigner{async sign(httpRequest,identity,signingProperties){if(!signingProperties)throw Error("request could not be signed with `apiKey` since the `name` and `in` signer properties are missing");if(!signingProperties.name)throw Error("request could not be signed with `apiKey` since the `name` signer property is missing");if(!signingProperties.in)throw Error("request could not be signed with `apiKey` since the `in` signer property is missing");if(!identity.apiKey)throw Error("request could not be signed with `apiKey` since the `apiKey` is not defined");let clonedRequest=protocolHttp.HttpRequest.clone(httpRequest);if(signingProperties.in===types3.HttpApiKeyAuthLocation.QUERY)clonedRequest.query[signingProperties.name]=identity.apiKey;else if(signingProperties.in===types3.HttpApiKeyAuthLocation.HEADER)clonedRequest.headers[signingProperties.name]=signingProperties.scheme?`${signingProperties.scheme} ${identity.apiKey}`:identity.apiKey;else throw Error("request can only be signed with `apiKey` locations `query` or `header`, but found: `"+signingProperties.in+"`");return clonedRequest}}class HttpBearerAuthSigner{async sign(httpRequest,identity,signingProperties){let clonedRequest=protocolHttp.HttpRequest.clone(httpRequest);if(!identity.token)throw Error("request could not be signed with `token` since the `token` is not defined");return clonedRequest.headers.Authorization=`Bearer ${identity.token}`,clonedRequest}}class NoAuthSigner{async sign(httpRequest,identity,signingProperties){return httpRequest}}var createIsIdentityExpiredFunction=(expirationMs)=>function(identity){return doesIdentityRequireRefresh(identity)&&identity.expiration.getTime()-Date.now()<expirationMs},EXPIRATION_MS=300000,isIdentityExpired=createIsIdentityExpiredFunction(EXPIRATION_MS),doesIdentityRequireRefresh=(identity)=>identity.expiration!==void 0,memoizeIdentityProvider=(provider,isExpired,requiresRefresh)=>{if(provider===void 0)return;let normalizedProvider=typeof provider!=="function"?async()=>Promise.resolve(provider):provider,resolved,pending,hasResult,isConstant=!1,coalesceProvider=async(options)=>{if(!pending)pending=normalizedProvider(options);try{resolved=await pending,hasResult=!0,isConstant=!1}finally{pending=void 0}return resolved};if(isExpired===void 0)return async(options)=>{if(!hasResult||options?.forceRefresh)resolved=await coalesceProvider(options);return resolved};return async(options)=>{if(!hasResult||options?.forceRefresh)resolved=await coalesceProvider(options);if(isConstant)return resolved;if(!requiresRefresh(resolved))return isConstant=!0,resolved;if(isExpired(resolved))return await coalesceProvider(options),resolved;return resolved}};Object.defineProperty(exports,"requestBuilder",{enumerable:!0,get:function(){return protocols.requestBuilder}});exports.DefaultIdentityProviderConfig=DefaultIdentityProviderConfig;exports.EXPIRATION_MS=EXPIRATION_MS;exports.HttpApiKeyAuthSigner=HttpApiKeyAuthSigner;exports.HttpBearerAuthSigner=HttpBearerAuthSigner;exports.NoAuthSigner=NoAuthSigner;exports.createIsIdentityExpiredFunction=createIsIdentityExpiredFunction;exports.createPaginator=createPaginator;exports.doesIdentityRequireRefresh=doesIdentityRequireRefresh;exports.getHttpAuthSchemeEndpointRuleSetPlugin=getHttpAuthSchemeEndpointRuleSetPlugin;exports.getHttpAuthSchemePlugin=getHttpAuthSchemePlugin;exports.getHttpSigningPlugin=getHttpSigningPlugin;exports.getSmithyContext=getSmithyContext;exports.httpAuthSchemeEndpointRuleSetMiddlewareOptions=httpAuthSchemeEndpointRuleSetMiddlewareOptions;exports.httpAuthSchemeMiddleware=httpAuthSchemeMiddleware;exports.httpAuthSchemeMiddlewareOptions=httpAuthSchemeMiddlewareOptions;exports.httpSigningMiddleware=httpSigningMiddleware;exports.httpSigningMiddlewareOptions=httpSigningMiddlewareOptions;exports.isIdentityExpired=isIdentityExpired;exports.memoizeIdentityProvider=memoizeIdentityProvider;exports.normalizeProvider=normalizeProvider;exports.setFeature=setFeature});var require_dist_cjs17=__commonJS((exports)=>{class ProviderError extends Error{name="ProviderError";tryNextLink;constructor(message,options=!0){let logger,tryNextLink=!0;if(typeof options==="boolean")logger=void 0,tryNextLink=options;else if(options!=null&&typeof options==="object")logger=options.logger,tryNextLink=options.tryNextLink??!0;super(message);this.tryNextLink=tryNextLink,Object.setPrototypeOf(this,ProviderError.prototype),logger?.debug?.(`@smithy/property-provider ${tryNextLink?"->":"(!)"} ${message}`)}static from(error,options=!0){return Object.assign(new this(error.message,options),error)}}class CredentialsProviderError extends ProviderError{name="CredentialsProviderError";constructor(message,options=!0){super(message,options);Object.setPrototypeOf(this,CredentialsProviderError.prototype)}}class TokenProviderError extends ProviderError{name="TokenProviderError";constructor(message,options=!0){super(message,options);Object.setPrototypeOf(this,TokenProviderError.prototype)}}var chain=(...providers)=>async()=>{if(providers.length===0)throw new ProviderError("No providers in chain");let lastProviderError;for(let provider of providers)try{return await provider()}catch(err){if(lastProviderError=err,err?.tryNextLink)continue;throw err}throw lastProviderError},fromStatic=(staticValue)=>()=>Promise.resolve(staticValue),memoize=(provider,isExpired,requiresRefresh)=>{let resolved,pending,hasResult,isConstant=!1,coalesceProvider=async()=>{if(!pending)pending=provider();try{resolved=await pending,hasResult=!0,isConstant=!1}finally{pending=void 0}return resolved};if(isExpired===void 0)return async(options)=>{if(!hasResult||options?.forceRefresh)resolved=await coalesceProvider();return resolved};return async(options)=>{if(!hasResult||options?.forceRefresh)resolved=await coalesceProvider();if(isConstant)return resolved;if(requiresRefresh&&!requiresRefresh(resolved))return isConstant=!0,resolved;if(isExpired(resolved))return await coalesceProvider(),resolved;return resolved}};exports.CredentialsProviderError=CredentialsProviderError;exports.ProviderError=ProviderError;exports.TokenProviderError=TokenProviderError;exports.chain=chain;exports.fromStatic=fromStatic;exports.memoize=memoize});var require_client=__commonJS((exports)=>{var state={warningEmitted:!1},emitWarningIfUnsupportedVersion=(version2)=>{if(version2&&!state.warningEmitted&&parseInt(version2.substring(1,version2.indexOf(".")))<20)state.warningEmitted=!0,process.emitWarning(`NodeDeprecationWarning: The AWS SDK for JavaScript (v3) will
no longer support Node.js ${version2} in January 2026.

To continue receiving updates to AWS services, bug fixes, and security
updates please upgrade to a supported Node.js LTS version.

More information can be found at: https://a.co/c895JFp`)};function setCredentialFeature(credentials,feature,value){if(!credentials.$source)credentials.$source={};return credentials.$source[feature]=value,credentials}function setFeature(context,feature,value){if(!context.__aws_sdk_context)context.__aws_sdk_context={features:{}};else if(!context.__aws_sdk_context.features)context.__aws_sdk_context.features={};context.__aws_sdk_context.features[feature]=value}function setTokenFeature(token,feature,value){if(!token.$source)token.$source={};return token.$source[feature]=value,token}exports.emitWarningIfUnsupportedVersion=emitWarningIfUnsupportedVersion;exports.setCredentialFeature=setCredentialFeature;exports.setFeature=setFeature;exports.setTokenFeature=setTokenFeature;exports.state=state});var require_dist_cjs18=__commonJS((exports)=>{var utilHexEncoding=require_dist_cjs13(),utilUtf8=require_dist_cjs7(),isArrayBuffer=require_dist_cjs5(),protocolHttp=require_dist_cjs2(),utilMiddleware=require_dist_cjs3(),utilUriEscape=require_dist_cjs9(),ALGORITHM_QUERY_PARAM="X-Amz-Algorithm",CREDENTIAL_QUERY_PARAM="X-Amz-Credential",AMZ_DATE_QUERY_PARAM="X-Amz-Date",SIGNED_HEADERS_QUERY_PARAM="X-Amz-SignedHeaders",EXPIRES_QUERY_PARAM="X-Amz-Expires",SIGNATURE_QUERY_PARAM="X-Amz-Signature",TOKEN_QUERY_PARAM="X-Amz-Security-Token",REGION_SET_PARAM="X-Amz-Region-Set",AUTH_HEADER="authorization",AMZ_DATE_HEADER=AMZ_DATE_QUERY_PARAM.toLowerCase(),DATE_HEADER="date",GENERATED_HEADERS=[AUTH_HEADER,AMZ_DATE_HEADER,DATE_HEADER],SIGNATURE_HEADER=SIGNATURE_QUERY_PARAM.toLowerCase(),SHA256_HEADER="x-amz-content-sha256",TOKEN_HEADER=TOKEN_QUERY_PARAM.toLowerCase(),HOST_HEADER="host",ALWAYS_UNSIGNABLE_HEADERS={authorization:!0,"cache-control":!0,connection:!0,expect:!0,from:!0,"keep-alive":!0,"max-forwards":!0,pragma:!0,referer:!0,te:!0,trailer:!0,"transfer-encoding":!0,upgrade:!0,"user-agent":!0,"x-amzn-trace-id":!0},PROXY_HEADER_PATTERN=/^proxy-/,SEC_HEADER_PATTERN=/^sec-/,UNSIGNABLE_PATTERNS=[/^proxy-/i,/^sec-/i],ALGORITHM_IDENTIFIER="AWS4-HMAC-SHA256",ALGORITHM_IDENTIFIER_V4A="AWS4-ECDSA-P256-SHA256",EVENT_ALGORITHM_IDENTIFIER="AWS4-HMAC-SHA256-PAYLOAD",UNSIGNED_PAYLOAD="UNSIGNED-PAYLOAD",MAX_CACHE_SIZE=50,KEY_TYPE_IDENTIFIER="aws4_request",MAX_PRESIGNED_TTL=604800,signingKeyCache={},cacheQueue=[],createScope=(shortDate,region,service)=>`${shortDate}/${region}/${service}/${KEY_TYPE_IDENTIFIER}`,getSigningKey=async(sha256Constructor,credentials,shortDate,region,service)=>{let credsHash=await hmac2(sha256Constructor,credentials.secretAccessKey,credentials.accessKeyId),cacheKey=`${shortDate}:${region}:${service}:${utilHexEncoding.toHex(credsHash)}:${credentials.sessionToken}`;if(cacheKey in signingKeyCache)return signingKeyCache[cacheKey];cacheQueue.push(cacheKey);while(cacheQueue.length>MAX_CACHE_SIZE)delete signingKeyCache[cacheQueue.shift()];let key=`AWS4${credentials.secretAccessKey}`;for(let signable of[shortDate,region,service,KEY_TYPE_IDENTIFIER])key=await hmac2(sha256Constructor,key,signable);return signingKeyCache[cacheKey]=key},clearCredentialCache=()=>{cacheQueue.length=0,Object.keys(signingKeyCache).forEach((cacheKey)=>{delete signingKeyCache[cacheKey]})},hmac2=(ctor,secret,data)=>{let hash3=new ctor(secret);return hash3.update(utilUtf8.toUint8Array(data)),hash3.digest()},getCanonicalHeaders=({headers},unsignableHeaders,signableHeaders)=>{let canonical={};for(let headerName of Object.keys(headers).sort()){if(headers[headerName]==null)continue;let canonicalHeaderName=headerName.toLowerCase();if(canonicalHeaderName in ALWAYS_UNSIGNABLE_HEADERS||unsignableHeaders?.has(canonicalHeaderName)||PROXY_HEADER_PATTERN.test(canonicalHeaderName)||SEC_HEADER_PATTERN.test(canonicalHeaderName)){if(!signableHeaders||signableHeaders&&!signableHeaders.has(canonicalHeaderName))continue}canonical[canonicalHeaderName]=headers[headerName].trim().replace(/\s+/g," ")}return canonical},getPayloadHash=async({headers,body},hashConstructor)=>{for(let headerName of Object.keys(headers))if(headerName.toLowerCase()===SHA256_HEADER)return headers[headerName];if(body==null)return"e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855";else if(typeof body==="string"||ArrayBuffer.isView(body)||isArrayBuffer.isArrayBuffer(body)){let hashCtor=new hashConstructor;return hashCtor.update(utilUtf8.toUint8Array(body)),utilHexEncoding.toHex(await hashCtor.digest())}return UNSIGNED_PAYLOAD};class HeaderFormatter{format(headers){let chunks=[];for(let headerName of Object.keys(headers)){let bytes=utilUtf8.fromUtf8(headerName);chunks.push(Uint8Array.from([bytes.byteLength]),bytes,this.formatHeaderValue(headers[headerName]))}let out=new Uint8Array(chunks.reduce((carry,bytes)=>carry+bytes.byteLength,0)),position=0;for(let chunk of chunks)out.set(chunk,position),position+=chunk.byteLength;return out}formatHeaderValue(header){switch(header.type){case"boolean":return Uint8Array.from([header.value?0:1]);case"byte":return Uint8Array.from([2,header.value]);case"short":let shortView=new DataView(new ArrayBuffer(3));return shortView.setUint8(0,3),shortView.setInt16(1,header.value,!1),new Uint8Array(shortView.buffer);case"integer":let intView=new DataView(new ArrayBuffer(5));return intView.setUint8(0,4),intView.setInt32(1,header.value,!1),new Uint8Array(intView.buffer);case"long":let longBytes=new Uint8Array(9);return longBytes[0]=5,longBytes.set(header.value.bytes,1),longBytes;case"binary":let binView=new DataView(new ArrayBuffer(3+header.value.byteLength));binView.setUint8(0,6),binView.setUint16(1,header.value.byteLength,!1);let binBytes=new Uint8Array(binView.buffer);return binBytes.set(header.value,3),binBytes;case"string":let utf8Bytes=utilUtf8.fromUtf8(header.value),strView=new DataView(new ArrayBuffer(3+utf8Bytes.byteLength));strView.setUint8(0,7),strView.setUint16(1,utf8Bytes.byteLength,!1);let strBytes=new Uint8Array(strView.buffer);return strBytes.set(utf8Bytes,3),strBytes;case"timestamp":let tsBytes=new Uint8Array(9);return tsBytes[0]=8,tsBytes.set(Int64.fromNumber(header.value.valueOf()).bytes,1),tsBytes;case"uuid":if(!UUID_PATTERN.test(header.value))throw Error(`Invalid UUID received: ${header.value}`);let uuidBytes=new Uint8Array(17);return uuidBytes[0]=9,uuidBytes.set(utilHexEncoding.fromHex(header.value.replace(/\-/g,"")),1),uuidBytes}}}var UUID_PATTERN=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/;class Int64{bytes;constructor(bytes){if(this.bytes=bytes,bytes.byteLength!==8)throw Error("Int64 buffers must be exactly 8 bytes")}static fromNumber(number){if(number>9223372036854776000||number<-9223372036854776000)throw Error(`${number} is too large (or, if negative, too small) to represent as an Int64`);let bytes=new Uint8Array(8);for(let i=7,remaining=Math.abs(Math.round(number));i>-1&&remaining>0;i--,remaining/=256)bytes[i]=remaining;if(number<0)negate(bytes);return new Int64(bytes)}valueOf(){let bytes=this.bytes.slice(0),negative=bytes[0]&128;if(negative)negate(bytes);return parseInt(utilHexEncoding.toHex(bytes),16)*(negative?-1:1)}toString(){return String(this.valueOf())}}function negate(bytes){for(let i=0;i<8;i++)bytes[i]^=255;for(let i=7;i>-1;i--)if(bytes[i]++,bytes[i]!==0)break}var hasHeader=(soughtHeader,headers)=>{soughtHeader=soughtHeader.toLowerCase();for(let headerName of Object.keys(headers))if(soughtHeader===headerName.toLowerCase())return!0;return!1},moveHeadersToQuery=(request,options={})=>{let{headers,query={}}=protocolHttp.HttpRequest.clone(request);for(let name of Object.keys(headers)){let lname=name.toLowerCase();if(lname.slice(0,6)==="x-amz-"&&!options.unhoistableHeaders?.has(lname)||options.hoistableHeaders?.has(lname))query[name]=headers[name],delete headers[name]}return{...request,headers,query}},prepareRequest=(request)=>{request=protocolHttp.HttpRequest.clone(request);for(let headerName of Object.keys(request.headers))if(GENERATED_HEADERS.indexOf(headerName.toLowerCase())>-1)delete request.headers[headerName];return request},getCanonicalQuery=({query={}})=>{let keys=[],serialized={};for(let key of Object.keys(query)){if(key.toLowerCase()===SIGNATURE_HEADER)continue;let encodedKey=utilUriEscape.escapeUri(key);keys.push(encodedKey);let value=query[key];if(typeof value==="string")serialized[encodedKey]=`${encodedKey}=${utilUriEscape.escapeUri(value)}`;else if(Array.isArray(value))serialized[encodedKey]=value.slice(0).reduce((encoded,value2)=>encoded.concat([`${encodedKey}=${utilUriEscape.escapeUri(value2)}`]),[]).sort().join("&")}return keys.sort().map((key)=>serialized[key]).filter((serialized2)=>serialized2).join("&")},iso8601=(time2)=>toDate(time2).toISOString().replace(/\.\d{3}Z$/,"Z"),toDate=(time2)=>{if(typeof time2==="number")return new Date(time2*1000);if(typeof time2==="string"){if(Number(time2))return new Date(Number(time2)*1000);return new Date(time2)}return time2};class SignatureV4Base{service;regionProvider;credentialProvider;sha256;uriEscapePath;applyChecksum;constructor({applyChecksum,credentials,region,service,sha256:sha2562,uriEscapePath=!0}){this.service=service,this.sha256=sha2562,this.uriEscapePath=uriEscapePath,this.applyChecksum=typeof applyChecksum==="boolean"?applyChecksum:!0,this.regionProvider=utilMiddleware.normalizeProvider(region),this.credentialProvider=utilMiddleware.normalizeProvider(credentials)}createCanonicalRequest(request,canonicalHeaders,payloadHash){let sortedHeaders=Object.keys(canonicalHeaders).sort();return`${request.method}
${this.getCanonicalPath(request)}
${getCanonicalQuery(request)}
${sortedHeaders.map((name)=>`${name}:${canonicalHeaders[name]}`).join(`
`)}

${sortedHeaders.join(";")}
${payloadHash}`}async createStringToSign(longDate,credentialScope,canonicalRequest,algorithmIdentifier){let hash3=new this.sha256;hash3.update(utilUtf8.toUint8Array(canonicalRequest));let hashedRequest=await hash3.digest();return`${algorithmIdentifier}
${longDate}
${credentialScope}
${utilHexEncoding.toHex(hashedRequest)}`}getCanonicalPath({path}){if(this.uriEscapePath){let normalizedPathSegments=[];for(let pathSegment of path.split("/")){if(pathSegment?.length===0)continue;if(pathSegment===".")continue;if(pathSegment==="..")normalizedPathSegments.pop();else normalizedPathSegments.push(pathSegment)}let normalizedPath=`${path?.startsWith("/")?"/":""}${normalizedPathSegments.join("/")}${normalizedPathSegments.length>0&&path?.endsWith("/")?"/":""}`;return utilUriEscape.escapeUri(normalizedPath).replace(/%2F/g,"/")}return path}validateResolvedCredentials(credentials){if(typeof credentials!=="object"||typeof credentials.accessKeyId!=="string"||typeof credentials.secretAccessKey!=="string")throw Error("Resolved credential object is not valid")}formatDate(now){let longDate=iso8601(now).replace(/[\-:]/g,"");return{longDate,shortDate:longDate.slice(0,8)}}getCanonicalHeaderList(headers){return Object.keys(headers).sort().join(";")}}class SignatureV4 extends SignatureV4Base{headerFormatter=new HeaderFormatter;constructor({applyChecksum,credentials,region,service,sha256:sha2562,uriEscapePath=!0}){super({applyChecksum,credentials,region,service,sha256:sha2562,uriEscapePath})}async presign(originalRequest,options={}){let{signingDate=new Date,expiresIn=3600,unsignableHeaders,unhoistableHeaders,signableHeaders,hoistableHeaders,signingRegion,signingService}=options,credentials=await this.credentialProvider();this.validateResolvedCredentials(credentials);let region=signingRegion??await this.regionProvider(),{longDate,shortDate}=this.formatDate(signingDate);if(expiresIn>MAX_PRESIGNED_TTL)return Promise.reject("Signature version 4 presigned URLs must have an expiration date less than one week in the future");let scope=createScope(shortDate,region,signingService??this.service),request=moveHeadersToQuery(prepareRequest(originalRequest),{unhoistableHeaders,hoistableHeaders});if(credentials.sessionToken)request.query[TOKEN_QUERY_PARAM]=credentials.sessionToken;request.query[ALGORITHM_QUERY_PARAM]=ALGORITHM_IDENTIFIER,request.query[CREDENTIAL_QUERY_PARAM]=`${credentials.accessKeyId}/${scope}`,request.query[AMZ_DATE_QUERY_PARAM]=longDate,request.query[EXPIRES_QUERY_PARAM]=expiresIn.toString(10);let canonicalHeaders=getCanonicalHeaders(request,unsignableHeaders,signableHeaders);return request.query[SIGNED_HEADERS_QUERY_PARAM]=this.getCanonicalHeaderList(canonicalHeaders),request.query[SIGNATURE_QUERY_PARAM]=await this.getSignature(longDate,scope,this.getSigningKey(credentials,region,shortDate,signingService),this.createCanonicalRequest(request,canonicalHeaders,await getPayloadHash(originalRequest,this.sha256))),request}async sign(toSign,options){if(typeof toSign==="string")return this.signString(toSign,options);else if(toSign.headers&&toSign.payload)return this.signEvent(toSign,options);else if(toSign.message)return this.signMessage(toSign,options);else return this.signRequest(toSign,options)}async signEvent({headers,payload},{signingDate=new Date,priorSignature,signingRegion,signingService}){let region=signingRegion??await this.regionProvider(),{shortDate,longDate}=this.formatDate(signingDate),scope=createScope(shortDate,region,signingService??this.service),hashedPayload=await getPayloadHash({headers:{},body:payload},this.sha256),hash3=new this.sha256;hash3.update(headers);let hashedHeaders=utilHexEncoding.toHex(await hash3.digest()),stringToSign=[EVENT_ALGORITHM_IDENTIFIER,longDate,scope,priorSignature,hashedHeaders,hashedPayload].join(`
`);return this.signString(stringToSign,{signingDate,signingRegion:region,signingService})}async signMessage(signableMessage,{signingDate=new Date,signingRegion,signingService}){return this.signEvent({headers:this.headerFormatter.format(signableMessage.message.headers),payload:signableMessage.message.body},{signingDate,signingRegion,signingService,priorSignature:signableMessage.priorSignature}).then((signature)=>{return{message:signableMessage.message,signature}})}async signString(stringToSign,{signingDate=new Date,signingRegion,signingService}={}){let credentials=await this.credentialProvider();this.validateResolvedCredentials(credentials);let region=signingRegion??await this.regionProvider(),{shortDate}=this.formatDate(signingDate),hash3=new this.sha256(await this.getSigningKey(credentials,region,shortDate,signingService));return hash3.update(utilUtf8.toUint8Array(stringToSign)),utilHexEncoding.toHex(await hash3.digest())}async signRequest(requestToSign,{signingDate=new Date,signableHeaders,unsignableHeaders,signingRegion,signingService}={}){let credentials=await this.credentialProvider();this.validateResolvedCredentials(credentials);let region=signingRegion??await this.regionProvider(),request=prepareRequest(requestToSign),{longDate,shortDate}=this.formatDate(signingDate),scope=createScope(shortDate,region,signingService??this.service);if(request.headers[AMZ_DATE_HEADER]=longDate,credentials.sessionToken)request.headers[TOKEN_HEADER]=credentials.sessionToken;let payloadHash=await getPayloadHash(request,this.sha256);if(!hasHeader(SHA256_HEADER,request.headers)&&this.applyChecksum)request.headers[SHA256_HEADER]=payloadHash;let canonicalHeaders=getCanonicalHeaders(request,unsignableHeaders,signableHeaders),signature=await this.getSignature(longDate,scope,this.getSigningKey(credentials,region,shortDate,signingService),this.createCanonicalRequest(request,canonicalHeaders,payloadHash));return request.headers[AUTH_HEADER]=`${ALGORITHM_IDENTIFIER} Credential=${credentials.accessKeyId}/${scope}, SignedHeaders=${this.getCanonicalHeaderList(canonicalHeaders)}, Signature=${signature}`,request}async getSignature(longDate,credentialScope,keyPromise,canonicalRequest){let stringToSign=await this.createStringToSign(longDate,credentialScope,canonicalRequest,ALGORITHM_IDENTIFIER),hash3=new this.sha256(await keyPromise);return hash3.update(utilUtf8.toUint8Array(stringToSign)),utilHexEncoding.toHex(await hash3.digest())}getSigningKey(credentials,region,shortDate,service){return getSigningKey(this.sha256,credentials,shortDate,region,service||this.service)}}var signatureV4aContainer={SignatureV4a:null};exports.ALGORITHM_IDENTIFIER=ALGORITHM_IDENTIFIER;exports.ALGORITHM_IDENTIFIER_V4A=ALGORITHM_IDENTIFIER_V4A;exports.ALGORITHM_QUERY_PARAM=ALGORITHM_QUERY_PARAM;exports.ALWAYS_UNSIGNABLE_HEADERS=ALWAYS_UNSIGNABLE_HEADERS;exports.AMZ_DATE_HEADER=AMZ_DATE_HEADER;exports.AMZ_DATE_QUERY_PARAM=AMZ_DATE_QUERY_PARAM;exports.AUTH_HEADER=AUTH_HEADER;exports.CREDENTIAL_QUERY_PARAM=CREDENTIAL_QUERY_PARAM;exports.DATE_HEADER=DATE_HEADER;exports.EVENT_ALGORITHM_IDENTIFIER=EVENT_ALGORITHM_IDENTIFIER;exports.EXPIRES_QUERY_PARAM=EXPIRES_QUERY_PARAM;exports.GENERATED_HEADERS=GENERATED_HEADERS;exports.HOST_HEADER=HOST_HEADER;exports.KEY_TYPE_IDENTIFIER=KEY_TYPE_IDENTIFIER;exports.MAX_CACHE_SIZE=MAX_CACHE_SIZE;exports.MAX_PRESIGNED_TTL=MAX_PRESIGNED_TTL;exports.PROXY_HEADER_PATTERN=PROXY_HEADER_PATTERN;exports.REGION_SET_PARAM=REGION_SET_PARAM;exports.SEC_HEADER_PATTERN=SEC_HEADER_PATTERN;exports.SHA256_HEADER=SHA256_HEADER;exports.SIGNATURE_HEADER=SIGNATURE_HEADER;exports.SIGNATURE_QUERY_PARAM=SIGNATURE_QUERY_PARAM;exports.SIGNED_HEADERS_QUERY_PARAM=SIGNED_HEADERS_QUERY_PARAM;exports.SignatureV4=SignatureV4;exports.SignatureV4Base=SignatureV4Base;exports.TOKEN_HEADER=TOKEN_HEADER;exports.TOKEN_QUERY_PARAM=TOKEN_QUERY_PARAM;exports.UNSIGNABLE_PATTERNS=UNSIGNABLE_PATTERNS;exports.UNSIGNED_PAYLOAD=UNSIGNED_PAYLOAD;exports.clearCredentialCache=clearCredentialCache;exports.createScope=createScope;exports.getCanonicalHeaders=getCanonicalHeaders;exports.getCanonicalQuery=getCanonicalQuery;exports.getPayloadHash=getPayloadHash;exports.getSigningKey=getSigningKey;exports.hasHeader=hasHeader;exports.moveHeadersToQuery=moveHeadersToQuery;exports.prepareRequest=prepareRequest;exports.signatureV4aContainer=signatureV4aContainer});var require_dist_cjs19=__commonJS((exports)=>{var TEXT_ENCODER=typeof TextEncoder=="function"?new TextEncoder:null,calculateBodyLength=(body)=>{if(typeof body==="string"){if(TEXT_ENCODER)return TEXT_ENCODER.encode(body).byteLength;let len=body.length;for(let i=len-1;i>=0;i--){let code=body.charCodeAt(i);if(code>127&&code<=2047)len++;else if(code>2047&&code<=65535)len+=2;if(code>=56320&&code<=57343)i--}return len}else if(typeof body.byteLength==="number")return body.byteLength;else if(typeof body.size==="number")return body.size;throw Error(`Body Length computation failed for ${body}`)};exports.calculateBodyLength=calculateBodyLength});var require_cbor=__commonJS((exports)=>{var serde=require_serde(),utilUtf8=require_dist_cjs7(),protocols=require_protocols(),protocolHttp=require_dist_cjs2(),utilBodyLengthBrowser=require_dist_cjs19(),schema=require_schema(),utilMiddleware=require_dist_cjs3(),utilBase64=require_dist_cjs8(),majorUint64=0,majorNegativeInt64=1,majorUnstructuredByteString=2,majorUtf8String=3,majorList=4,majorMap=5,majorTag=6,majorSpecial=7,specialFalse=20,specialTrue=21,specialNull=22,specialUndefined=23,extendedOneByte=24,extendedFloat16=25,extendedFloat32=26,extendedFloat64=27,minorIndefinite=31;function alloc(size){return typeof Buffer<"u"?Buffer.alloc(size):new Uint8Array(size)}var tagSymbol=Symbol("@smithy/core/cbor::tagSymbol");function tag(data2){return data2[tagSymbol]=!0,data2}var USE_TEXT_DECODER=typeof TextDecoder<"u",USE_BUFFER$1=typeof Buffer<"u",payload=alloc(0),dataView$1=new DataView(payload.buffer,payload.byteOffset,payload.byteLength),textDecoder=USE_TEXT_DECODER?new TextDecoder:null,_offset=0;function setPayload(bytes){payload=bytes,dataView$1=new DataView(payload.buffer,payload.byteOffset,payload.byteLength)}function decode2(at,to){if(at>=to)throw Error("unexpected end of (decode) payload.");let major=(payload[at]&224)>>5,minor=payload[at]&31;switch(major){case majorUint64:case majorNegativeInt64:case majorTag:let unsignedInt,offset;if(minor<24)unsignedInt=minor,offset=1;else switch(minor){case extendedOneByte:case extendedFloat16:case extendedFloat32:case extendedFloat64:let countLength=minorValueToArgumentLength[minor],countOffset=countLength+1;if(offset=countOffset,to-at<countOffset)throw Error(`countLength ${countLength} greater than remaining buf len.`);let countIndex=at+1;if(countLength===1)unsignedInt=payload[countIndex];else if(countLength===2)unsignedInt=dataView$1.getUint16(countIndex);else if(countLength===4)unsignedInt=dataView$1.getUint32(countIndex);else unsignedInt=dataView$1.getBigUint64(countIndex);break;default:throw Error(`unexpected minor value ${minor}.`)}if(major===majorUint64)return _offset=offset,castBigInt(unsignedInt);else if(major===majorNegativeInt64){let negativeInt;if(typeof unsignedInt==="bigint")negativeInt=BigInt(-1)-unsignedInt;else negativeInt=-1-unsignedInt;return _offset=offset,castBigInt(negativeInt)}else if(minor===2||minor===3){let length=decodeCount(at+offset,to),b2=BigInt(0),start=at+offset+_offset;for(let i=start;i<start+length;++i)b2=b2<<BigInt(8)|BigInt(payload[i]);return _offset=offset+_offset+length,minor===3?-b2-BigInt(1):b2}else if(minor===4){let decimalFraction=decode2(at+offset,to),[exponent,mantissa]=decimalFraction,normalizer=mantissa<0?-1:1,mantissaStr="0".repeat(Math.abs(exponent)+1)+String(BigInt(normalizer)*BigInt(mantissa)),numericString,sign=mantissa<0?"-":"";if(numericString=exponent===0?mantissaStr:mantissaStr.slice(0,mantissaStr.length+exponent)+"."+mantissaStr.slice(exponent),numericString=numericString.replace(/^0+/g,""),numericString==="")numericString="0";if(numericString[0]===".")numericString="0"+numericString;return numericString=sign+numericString,_offset=offset+_offset,serde.nv(numericString)}else{let value=decode2(at+offset,to);return _offset=offset+_offset,tag({tag:castBigInt(unsignedInt),value})}case majorUtf8String:case majorMap:case majorList:case majorUnstructuredByteString:if(minor===minorIndefinite)switch(major){case majorUtf8String:return decodeUtf8StringIndefinite(at,to);case majorMap:return decodeMapIndefinite(at,to);case majorList:return decodeListIndefinite(at,to);case majorUnstructuredByteString:return decodeUnstructuredByteStringIndefinite(at,to)}else switch(major){case majorUtf8String:return decodeUtf8String(at,to);case majorMap:return decodeMap(at,to);case majorList:return decodeList(at,to);case majorUnstructuredByteString:return decodeUnstructuredByteString(at,to)}default:return decodeSpecial(at,to)}}function bytesToUtf8(bytes,at,to){if(USE_BUFFER$1&&bytes.constructor?.name==="Buffer")return bytes.toString("utf-8",at,to);if(textDecoder)return textDecoder.decode(bytes.subarray(at,to));return utilUtf8.toUtf8(bytes.subarray(at,to))}function demote(bigInteger){let num=Number(bigInteger);if(num<Number.MIN_SAFE_INTEGER||Number.MAX_SAFE_INTEGER<num)console.warn(Error(`@smithy/core/cbor - truncating BigInt(${bigInteger}) to ${num} with loss of precision.`));return num}var minorValueToArgumentLength={[extendedOneByte]:1,[extendedFloat16]:2,[extendedFloat32]:4,[extendedFloat64]:8};function bytesToFloat16(a12,b2){let sign=a12>>7,exponent=(a12&124)>>2,fraction=(a12&3)<<8|b2,scalar=sign===0?1:-1,exponentComponent,summation;if(exponent===0)if(fraction===0)return 0;else exponentComponent=Math.pow(2,-14),summation=0;else if(exponent===31)if(fraction===0)return scalar*(1/0);else return NaN;else exponentComponent=Math.pow(2,exponent-15),summation=1;return summation+=fraction/1024,scalar*(exponentComponent*summation)}function decodeCount(at,to){let minor=payload[at]&31;if(minor<24)return _offset=1,minor;if(minor===extendedOneByte||minor===extendedFloat16||minor===extendedFloat32||minor===extendedFloat64){let countLength=minorValueToArgumentLength[minor];if(_offset=countLength+1,to-at<_offset)throw Error(`countLength ${countLength} greater than remaining buf len.`);let countIndex=at+1;if(countLength===1)return payload[countIndex];else if(countLength===2)return dataView$1.getUint16(countIndex);else if(countLength===4)return dataView$1.getUint32(countIndex);return demote(dataView$1.getBigUint64(countIndex))}throw Error(`unexpected minor value ${minor}.`)}function decodeUtf8String(at,to){let length=decodeCount(at,to),offset=_offset;if(at+=offset,to-at<length)throw Error(`string len ${length} greater than remaining buf len.`);let value=bytesToUtf8(payload,at,at+length);return _offset=offset+length,value}function decodeUtf8StringIndefinite(at,to){at+=1;let vector2=[];for(let base=at;at<to;){if(payload[at]===255){let data2=alloc(vector2.length);return data2.set(vector2,0),_offset=at-base+2,bytesToUtf8(data2,0,data2.length)}let major=(payload[at]&224)>>5,minor=payload[at]&31;if(major!==majorUtf8String)throw Error(`unexpected major type ${major} in indefinite string.`);if(minor===minorIndefinite)throw Error("nested indefinite string.");let bytes=decodeUnstructuredByteString(at,to);at+=_offset;for(let i=0;i<bytes.length;++i)vector2.push(bytes[i])}throw Error("expected break marker.")}function decodeUnstructuredByteString(at,to){let length=decodeCount(at,to),offset=_offset;if(at+=offset,to-at<length)throw Error(`unstructured byte string len ${length} greater than remaining buf len.`);let value=payload.subarray(at,at+length);return _offset=offset+length,value}function decodeUnstructuredByteStringIndefinite(at,to){at+=1;let vector2=[];for(let base=at;at<to;){if(payload[at]===255){let data2=alloc(vector2.length);return data2.set(vector2,0),_offset=at-base+2,data2}let major=(payload[at]&224)>>5,minor=payload[at]&31;if(major!==majorUnstructuredByteString)throw Error(`unexpected major type ${major} in indefinite string.`);if(minor===minorIndefinite)throw Error("nested indefinite string.");let bytes=decodeUnstructuredByteString(at,to);at+=_offset;for(let i=0;i<bytes.length;++i)vector2.push(bytes[i])}throw Error("expected break marker.")}function decodeList(at,to){let listDataLength=decodeCount(at,to),offset=_offset;at+=offset;let base=at,list=Array(listDataLength);for(let i=0;i<listDataLength;++i){let item=decode2(at,to),itemOffset=_offset;list[i]=item,at+=itemOffset}return _offset=offset+(at-base),list}function decodeListIndefinite(at,to){at+=1;let list=[];for(let base=at;at<to;){if(payload[at]===255)return _offset=at-base+2,list;let item=decode2(at,to);at+=_offset,list.push(item)}throw Error("expected break marker.")}function decodeMap(at,to){let mapDataLength=decodeCount(at,to),offset=_offset;at+=offset;let base=at,map3={};for(let i=0;i<mapDataLength;++i){if(at>=to)throw Error("unexpected end of map payload.");let major=(payload[at]&224)>>5;if(major!==majorUtf8String)throw Error(`unexpected major type ${major} for map key at index ${at}.`);let key=decode2(at,to);at+=_offset;let value=decode2(at,to);at+=_offset,map3[key]=value}return _offset=offset+(at-base),map3}function decodeMapIndefinite(at,to){at+=1;let base=at,map3={};for(;at<to;){if(at>=to)throw Error("unexpected end of map payload.");if(payload[at]===255)return _offset=at-base+2,map3;let major=(payload[at]&224)>>5;if(major!==majorUtf8String)throw Error(`unexpected major type ${major} for map key.`);let key=decode2(at,to);at+=_offset;let value=decode2(at,to);at+=_offset,map3[key]=value}throw Error("expected break marker.")}function decodeSpecial(at,to){let minor=payload[at]&31;switch(minor){case specialTrue:case specialFalse:return _offset=1,minor===specialTrue;case specialNull:return _offset=1,null;case specialUndefined:return _offset=1,null;case extendedFloat16:if(to-at<3)throw Error("incomplete float16 at end of buf.");return _offset=3,bytesToFloat16(payload[at+1],payload[at+2]);case extendedFloat32:if(to-at<5)throw Error("incomplete float32 at end of buf.");return _offset=5,dataView$1.getFloat32(at+1);case extendedFloat64:if(to-at<9)throw Error("incomplete float64 at end of buf.");return _offset=9,dataView$1.getFloat64(at+1);default:throw Error(`unexpected minor value ${minor}.`)}}function castBigInt(bigInt){if(typeof bigInt==="number")return bigInt;let num=Number(bigInt);if(Number.MIN_SAFE_INTEGER<=num&&num<=Number.MAX_SAFE_INTEGER)return num;return bigInt}var USE_BUFFER=typeof Buffer<"u",initialSize=2048,data=alloc(initialSize),dataView=new DataView(data.buffer,data.byteOffset,data.byteLength),cursor=0;function ensureSpace(bytes){if(data.byteLength-cursor<bytes)if(cursor<16000000)resize(Math.max(data.byteLength*4,data.byteLength+bytes));else resize(data.byteLength+bytes+16000000)}function toUint8Array(){let out=alloc(cursor);return out.set(data.subarray(0,cursor),0),cursor=0,out}function resize(size){let old=data;if(data=alloc(size),old)if(old.copy)old.copy(data,0,0,old.byteLength);else data.set(old,0);dataView=new DataView(data.buffer,data.byteOffset,data.byteLength)}function encodeHeader(major,value){if(value<24)data[cursor++]=major<<5|value;else if(value<256)data[cursor++]=major<<5|24,data[cursor++]=value;else if(value<65536)data[cursor++]=major<<5|extendedFloat16,dataView.setUint16(cursor,value),cursor+=2;else if(value<4294967296)data[cursor++]=major<<5|extendedFloat32,dataView.setUint32(cursor,value),cursor+=4;else data[cursor++]=major<<5|extendedFloat64,dataView.setBigUint64(cursor,typeof value==="bigint"?value:BigInt(value)),cursor+=8}function encode2(_input){let encodeStack=[_input];while(encodeStack.length){let input=encodeStack.pop();if(ensureSpace(typeof input==="string"?input.length*4:64),typeof input==="string"){if(USE_BUFFER)encodeHeader(majorUtf8String,Buffer.byteLength(input)),cursor+=data.write(input,cursor);else{let bytes=utilUtf8.fromUtf8(input);encodeHeader(majorUtf8String,bytes.byteLength),data.set(bytes,cursor),cursor+=bytes.byteLength}continue}else if(typeof input==="number"){if(Number.isInteger(input)){let nonNegative=input>=0,major=nonNegative?majorUint64:majorNegativeInt64,value=nonNegative?input:-input-1;if(value<24)data[cursor++]=major<<5|value;else if(value<256)data[cursor++]=major<<5|24,data[cursor++]=value;else if(value<65536)data[cursor++]=major<<5|extendedFloat16,data[cursor++]=value>>8,data[cursor++]=value;else if(value<4294967296)data[cursor++]=major<<5|extendedFloat32,dataView.setUint32(cursor,value),cursor+=4;else data[cursor++]=major<<5|extendedFloat64,dataView.setBigUint64(cursor,BigInt(value)),cursor+=8;continue}data[cursor++]=majorSpecial<<5|extendedFloat64,dataView.setFloat64(cursor,input),cursor+=8;continue}else if(typeof input==="bigint"){let nonNegative=input>=0,major=nonNegative?majorUint64:majorNegativeInt64,value=nonNegative?input:-input-BigInt(1),n2=Number(value);if(n2<24)data[cursor++]=major<<5|n2;else if(n2<256)data[cursor++]=major<<5|24,data[cursor++]=n2;else if(n2<65536)data[cursor++]=major<<5|extendedFloat16,data[cursor++]=n2>>8,data[cursor++]=n2&255;else if(n2<4294967296)data[cursor++]=major<<5|extendedFloat32,dataView.setUint32(cursor,n2),cursor+=4;else if(value<BigInt("18446744073709551616"))data[cursor++]=major<<5|extendedFloat64,dataView.setBigUint64(cursor,value),cursor+=8;else{let binaryBigInt=value.toString(2),bigIntBytes=new Uint8Array(Math.ceil(binaryBigInt.length/8)),b2=value,i=0;while(bigIntBytes.byteLength-++i>=0)bigIntBytes[bigIntBytes.byteLength-i]=Number(b2&BigInt(255)),b2>>=BigInt(8);if(ensureSpace(bigIntBytes.byteLength*2),data[cursor++]=nonNegative?194:195,USE_BUFFER)encodeHeader(majorUnstructuredByteString,Buffer.byteLength(bigIntBytes));else encodeHeader(majorUnstructuredByteString,bigIntBytes.byteLength);data.set(bigIntBytes,cursor),cursor+=bigIntBytes.byteLength}continue}else if(input===null){data[cursor++]=majorSpecial<<5|specialNull;continue}else if(typeof input==="boolean"){data[cursor++]=majorSpecial<<5|(input?specialTrue:specialFalse);continue}else if(typeof input>"u")throw Error("@smithy/core/cbor: client may not serialize undefined value.");else if(Array.isArray(input)){for(let i=input.length-1;i>=0;--i)encodeStack.push(input[i]);encodeHeader(majorList,input.length);continue}else if(typeof input.byteLength==="number"){ensureSpace(input.length*2),encodeHeader(majorUnstructuredByteString,input.length),data.set(input,cursor),cursor+=input.byteLength;continue}else if(typeof input==="object"){if(input instanceof serde.NumericValue){let decimalIndex=input.string.indexOf("."),exponent=decimalIndex===-1?0:decimalIndex-input.string.length+1,mantissa=BigInt(input.string.replace(".",""));data[cursor++]=196,encodeStack.push(mantissa),encodeStack.push(exponent),encodeHeader(majorList,2);continue}if(input[tagSymbol])if("tag"in input&&"value"in input){encodeStack.push(input.value),encodeHeader(majorTag,input.tag);continue}else throw Error("tag encountered with missing fields, need 'tag' and 'value', found: "+JSON.stringify(input));let keys=Object.keys(input);for(let i=keys.length-1;i>=0;--i){let key=keys[i];encodeStack.push(input[key]),encodeStack.push(key)}encodeHeader(majorMap,keys.length);continue}throw Error(`data type ${input?.constructor?.name??typeof input} not compatible for encoding.`)}}var cbor={deserialize(payload2){return setPayload(payload2),decode2(0,payload2.length)},serialize(input){try{return encode2(input),toUint8Array()}catch(e){throw toUint8Array(),e}},resizeEncodingBuffer(size){resize(size)}},parseCborBody=(streamBody,context)=>{return protocols.collectBody(streamBody,context).then(async(bytes)=>{if(bytes.length)try{return cbor.deserialize(bytes)}catch(e){throw Object.defineProperty(e,"$responseBodyText",{value:context.utf8Encoder(bytes)}),e}return{}})},dateToTag=(date3)=>{return tag({tag:1,value:date3.getTime()/1000})},parseCborErrorBody=async(errorBody,context)=>{let value=await parseCborBody(errorBody,context);return value.message=value.message??value.Message,value},loadSmithyRpcV2CborErrorCode=(output,data2)=>{let sanitizeErrorCode=(rawValue)=>{let cleanValue=rawValue;if(typeof cleanValue==="number")cleanValue=cleanValue.toString();if(cleanValue.indexOf(",")>=0)cleanValue=cleanValue.split(",")[0];if(cleanValue.indexOf(":")>=0)cleanValue=cleanValue.split(":")[0];if(cleanValue.indexOf("#")>=0)cleanValue=cleanValue.split("#")[1];return cleanValue};if(data2.__type!==void 0)return sanitizeErrorCode(data2.__type);let codeKey=Object.keys(data2).find((key)=>key.toLowerCase()==="code");if(codeKey&&data2[codeKey]!==void 0)return sanitizeErrorCode(data2[codeKey])},checkCborResponse=(response)=>{if(String(response.headers["smithy-protocol"]).toLowerCase()!=="rpc-v2-cbor")throw Error("Malformed RPCv2 CBOR response, status: "+response.statusCode)},buildHttpRpcRequest=async(context,headers,path,resolvedHostname,body)=>{let{hostname,protocol="https",port,path:basePath}=await context.endpoint(),contents={protocol,hostname,port,method:"POST",path:basePath.endsWith("/")?basePath.slice(0,-1)+path:basePath+path,headers:{...headers}};if(resolvedHostname!==void 0)contents.hostname=resolvedHostname;if(body!==void 0){contents.body=body;try{contents.headers["content-length"]=String(utilBodyLengthBrowser.calculateBodyLength(body))}catch(e){}}return new protocolHttp.HttpRequest(contents)};class CborCodec extends protocols.SerdeContext{createSerializer(){let serializer=new CborShapeSerializer;return serializer.setSerdeContext(this.serdeContext),serializer}createDeserializer(){let deserializer=new CborShapeDeserializer;return deserializer.setSerdeContext(this.serdeContext),deserializer}}class CborShapeSerializer extends protocols.SerdeContext{value;write(schema2,value){this.value=this.serialize(schema2,value)}serialize(schema$1,source){let ns=schema.NormalizedSchema.of(schema$1);if(source==null){if(ns.isIdempotencyToken())return serde.generateIdempotencyToken();return source}if(ns.isBlobSchema()){if(typeof source==="string")return(this.serdeContext?.base64Decoder??utilBase64.fromBase64)(source);return source}if(ns.isTimestampSchema()){if(typeof source==="number"||typeof source==="bigint")return dateToTag(new Date(Number(source)/1000|0));return dateToTag(source)}if(typeof source==="function"||typeof source==="object"){let sourceObject=source;if(ns.isListSchema()&&Array.isArray(sourceObject)){let sparse=!!ns.getMergedTraits().sparse,newArray=[],i=0;for(let item of sourceObject){let value=this.serialize(ns.getValueSchema(),item);if(value!=null||sparse)newArray[i++]=value}return newArray}if(sourceObject instanceof Date)return dateToTag(sourceObject);let newObject={};if(ns.isMapSchema()){let sparse=!!ns.getMergedTraits().sparse;for(let key of Object.keys(sourceObject)){let value=this.serialize(ns.getValueSchema(),sourceObject[key]);if(value!=null||sparse)newObject[key]=value}}else if(ns.isStructSchema()){for(let[key,memberSchema]of ns.structIterator()){let value=this.serialize(memberSchema,sourceObject[key]);if(value!=null)newObject[key]=value}if(ns.isUnionSchema()&&Array.isArray(sourceObject.$unknown)){let[k2,v]=sourceObject.$unknown;newObject[k2]=v}else if(typeof sourceObject.__type==="string"){for(let[k2,v]of Object.entries(sourceObject))if(!(k2 in newObject))newObject[k2]=this.serialize(15,v)}}else if(ns.isDocumentSchema())for(let key of Object.keys(sourceObject))newObject[key]=this.serialize(ns.getValueSchema(),sourceObject[key]);else if(ns.isBigDecimalSchema())return sourceObject;return newObject}return source}flush(){let buffer2=cbor.serialize(this.value);return this.value=void 0,buffer2}}class CborShapeDeserializer extends protocols.SerdeContext{read(schema2,bytes){let data2=cbor.deserialize(bytes);return this.readValue(schema2,data2)}readValue(_schema,value){let ns=schema.NormalizedSchema.of(_schema);if(ns.isTimestampSchema()){if(typeof value==="number")return serde._parseEpochTimestamp(value);if(typeof value==="object"){if(value.tag===1&&"value"in value)return serde._parseEpochTimestamp(value.value)}}if(ns.isBlobSchema()){if(typeof value==="string")return(this.serdeContext?.base64Decoder??utilBase64.fromBase64)(value);return value}if(typeof value>"u"||typeof value==="boolean"||typeof value==="number"||typeof value==="string"||typeof value==="bigint"||typeof value==="symbol")return value;else if(typeof value==="object"){if(value===null)return null;if("byteLength"in value)return value;if(value instanceof Date)return value;if(ns.isDocumentSchema())return value;if(ns.isListSchema()){let newArray=[],memberSchema=ns.getValueSchema(),sparse=!!ns.getMergedTraits().sparse;for(let item of value){let itemValue=this.readValue(memberSchema,item);if(itemValue!=null||sparse)newArray.push(itemValue)}return newArray}let newObject={};if(ns.isMapSchema()){let sparse=!!ns.getMergedTraits().sparse,targetSchema=ns.getValueSchema();for(let key of Object.keys(value)){let itemValue=this.readValue(targetSchema,value[key]);if(itemValue!=null||sparse)newObject[key]=itemValue}}else if(ns.isStructSchema()){let isUnion2=ns.isUnionSchema(),keys;if(isUnion2)keys=new Set(Object.keys(value).filter((k2)=>k2!=="__type"));for(let[key,memberSchema]of ns.structIterator()){if(isUnion2)keys.delete(key);if(value[key]!=null)newObject[key]=this.readValue(memberSchema,value[key])}if(isUnion2&&keys?.size===1&&Object.keys(newObject).length===0){let k2=keys.values().next().value;newObject.$unknown=[k2,value[k2]]}else if(typeof value.__type==="string"){for(let[k2,v]of Object.entries(value))if(!(k2 in newObject))newObject[k2]=v}}else if(value instanceof serde.NumericValue)return value;return newObject}else return value}}class SmithyRpcV2CborProtocol extends protocols.RpcProtocol{codec=new CborCodec;serializer=this.codec.createSerializer();deserializer=this.codec.createDeserializer();constructor({defaultNamespace,errorTypeRegistries}){super({defaultNamespace,errorTypeRegistries})}getShapeId(){return"smithy.protocols#rpcv2Cbor"}getPayloadCodec(){return this.codec}async serializeRequest(operationSchema,input,context){let request=await super.serializeRequest(operationSchema,input,context);if(Object.assign(request.headers,{"content-type":this.getDefaultContentType(),"smithy-protocol":"rpc-v2-cbor",accept:this.getDefaultContentType()}),schema.deref(operationSchema.input)==="unit")delete request.body,delete request.headers["content-type"];else{if(!request.body)this.serializer.write(15,{}),request.body=this.serializer.flush();try{request.headers["content-length"]=String(request.body.byteLength)}catch(e){}}let{service,operation}=utilMiddleware.getSmithyContext(context),path=`/service/${service}/operation/${operation}`;if(request.path.endsWith("/"))request.path+=path.slice(1);else request.path+=path;return request}async deserializeResponse(operationSchema,context,response){return super.deserializeResponse(operationSchema,context,response)}async handleError(operationSchema,context,response,dataObject,metadata){let errorName=loadSmithyRpcV2CborErrorCode(response,dataObject)??"Unknown",errorMetadata={$metadata:metadata,$fault:response.statusCode<=500?"client":"server"},namespace=this.options.defaultNamespace;if(errorName.includes("#"))[namespace]=errorName.split("#");let registry=this.compositeErrorRegistry,nsRegistry=schema.TypeRegistry.for(namespace);registry.copyFrom(nsRegistry);let errorSchema;try{errorSchema=registry.getSchema(errorName)}catch(e){if(dataObject.Message)dataObject.message=dataObject.Message;let syntheticRegistry=schema.TypeRegistry.for("smithy.ts.sdk.synthetic."+namespace);registry.copyFrom(syntheticRegistry);let baseExceptionSchema=registry.getBaseException();if(baseExceptionSchema){let ErrorCtor2=registry.getErrorCtor(baseExceptionSchema);throw Object.assign(new ErrorCtor2({name:errorName}),errorMetadata,dataObject)}throw Object.assign(Error(errorName),errorMetadata,dataObject)}let ns=schema.NormalizedSchema.of(errorSchema),ErrorCtor=registry.getErrorCtor(errorSchema),message=dataObject.message??dataObject.Message??"Unknown",exception=new ErrorCtor(message),output={};for(let[name,member]of ns.structIterator())output[name]=this.deserializer.readValue(member,dataObject[name]);throw Object.assign(exception,errorMetadata,{$fault:ns.getMergedTraits().error,message},output)}getDefaultContentType(){return"application/cbor"}}exports.CborCodec=CborCodec;exports.CborShapeDeserializer=CborShapeDeserializer;exports.CborShapeSerializer=CborShapeSerializer;exports.SmithyRpcV2CborProtocol=SmithyRpcV2CborProtocol;exports.buildHttpRpcRequest=buildHttpRpcRequest;exports.cbor=cbor;exports.checkCborResponse=checkCborResponse;exports.dateToTag=dateToTag;exports.loadSmithyRpcV2CborErrorCode=loadSmithyRpcV2CborErrorCode;exports.parseCborBody=parseCborBody;exports.parseCborErrorBody=parseCborErrorBody;exports.tag=tag;exports.tagSymbol=tagSymbol});var require_dist_cjs20=__commonJS((exports)=>{var getAllAliases=(name,aliases)=>{let _aliases=[];if(name)_aliases.push(name);if(aliases)for(let alias of aliases)_aliases.push(alias);return _aliases},getMiddlewareNameWithAliases=(name,aliases)=>{return`${name||"anonymous"}${aliases&&aliases.length>0?` (a.k.a. ${aliases.join(",")})`:""}`},constructStack=()=>{let absoluteEntries=[],relativeEntries=[],identifyOnResolve=!1,entriesNameSet=new Set,sort=(entries)=>entries.sort((a12,b2)=>stepWeights[b2.step]-stepWeights[a12.step]||priorityWeights[b2.priority||"normal"]-priorityWeights[a12.priority||"normal"]),removeByName=(toRemove)=>{let isRemoved=!1,filterCb=(entry)=>{let aliases=getAllAliases(entry.name,entry.aliases);if(aliases.includes(toRemove)){isRemoved=!0;for(let alias of aliases)entriesNameSet.delete(alias);return!1}return!0};return absoluteEntries=absoluteEntries.filter(filterCb),relativeEntries=relativeEntries.filter(filterCb),isRemoved},removeByReference=(toRemove)=>{let isRemoved=!1,filterCb=(entry)=>{if(entry.middleware===toRemove){isRemoved=!0;for(let alias of getAllAliases(entry.name,entry.aliases))entriesNameSet.delete(alias);return!1}return!0};return absoluteEntries=absoluteEntries.filter(filterCb),relativeEntries=relativeEntries.filter(filterCb),isRemoved},cloneTo=(toStack)=>{return absoluteEntries.forEach((entry)=>{toStack.add(entry.middleware,{...entry})}),relativeEntries.forEach((entry)=>{toStack.addRelativeTo(entry.middleware,{...entry})}),toStack.identifyOnResolve?.(stack.identifyOnResolve()),toStack},expandRelativeMiddlewareList=(from)=>{let expandedMiddlewareList=[];return from.before.forEach((entry)=>{if(entry.before.length===0&&entry.after.length===0)expandedMiddlewareList.push(entry);else expandedMiddlewareList.push(...expandRelativeMiddlewareList(entry))}),expandedMiddlewareList.push(from),from.after.reverse().forEach((entry)=>{if(entry.before.length===0&&entry.after.length===0)expandedMiddlewareList.push(entry);else expandedMiddlewareList.push(...expandRelativeMiddlewareList(entry))}),expandedMiddlewareList},getMiddlewareList=(debug2=!1)=>{let normalizedAbsoluteEntries=[],normalizedRelativeEntries=[],normalizedEntriesNameMap={};return absoluteEntries.forEach((entry)=>{let normalizedEntry={...entry,before:[],after:[]};for(let alias of getAllAliases(normalizedEntry.name,normalizedEntry.aliases))normalizedEntriesNameMap[alias]=normalizedEntry;normalizedAbsoluteEntries.push(normalizedEntry)}),relativeEntries.forEach((entry)=>{let normalizedEntry={...entry,before:[],after:[]};for(let alias of getAllAliases(normalizedEntry.name,normalizedEntry.aliases))normalizedEntriesNameMap[alias]=normalizedEntry;normalizedRelativeEntries.push(normalizedEntry)}),normalizedRelativeEntries.forEach((entry)=>{if(entry.toMiddleware){let toMiddleware=normalizedEntriesNameMap[entry.toMiddleware];if(toMiddleware===void 0){if(debug2)return;throw Error(`${entry.toMiddleware} is not found when adding ${getMiddlewareNameWithAliases(entry.name,entry.aliases)} middleware ${entry.relation} ${entry.toMiddleware}`)}if(entry.relation==="after")toMiddleware.after.push(entry);if(entry.relation==="before")toMiddleware.before.push(entry)}}),sort(normalizedAbsoluteEntries).map(expandRelativeMiddlewareList).reduce((wholeList,expandedMiddlewareList)=>{return wholeList.push(...expandedMiddlewareList),wholeList},[])},stack={add:(middleware,options={})=>{let{name,override,aliases:_aliases}=options,entry={step:"initialize",priority:"normal",middleware,...options},aliases=getAllAliases(name,_aliases);if(aliases.length>0){if(aliases.some((alias)=>entriesNameSet.has(alias))){if(!override)throw Error(`Duplicate middleware name '${getMiddlewareNameWithAliases(name,_aliases)}'`);for(let alias of aliases){let toOverrideIndex=absoluteEntries.findIndex((entry2)=>entry2.name===alias||entry2.aliases?.some((a12)=>a12===alias));if(toOverrideIndex===-1)continue;let toOverride=absoluteEntries[toOverrideIndex];if(toOverride.step!==entry.step||entry.priority!==toOverride.priority)throw Error(`"${getMiddlewareNameWithAliases(toOverride.name,toOverride.aliases)}" middleware with ${toOverride.priority} priority in ${toOverride.step} step cannot be overridden by "${getMiddlewareNameWithAliases(name,_aliases)}" middleware with ${entry.priority} priority in ${entry.step} step.`);absoluteEntries.splice(toOverrideIndex,1)}}for(let alias of aliases)entriesNameSet.add(alias)}absoluteEntries.push(entry)},addRelativeTo:(middleware,options)=>{let{name,override,aliases:_aliases}=options,entry={middleware,...options},aliases=getAllAliases(name,_aliases);if(aliases.length>0){if(aliases.some((alias)=>entriesNameSet.has(alias))){if(!override)throw Error(`Duplicate middleware name '${getMiddlewareNameWithAliases(name,_aliases)}'`);for(let alias of aliases){let toOverrideIndex=relativeEntries.findIndex((entry2)=>entry2.name===alias||entry2.aliases?.some((a12)=>a12===alias));if(toOverrideIndex===-1)continue;let toOverride=relativeEntries[toOverrideIndex];if(toOverride.toMiddleware!==entry.toMiddleware||toOverride.relation!==entry.relation)throw Error(`"${getMiddlewareNameWithAliases(toOverride.name,toOverride.aliases)}" middleware ${toOverride.relation} "${toOverride.toMiddleware}" middleware cannot be overridden by "${getMiddlewareNameWithAliases(name,_aliases)}" middleware ${entry.relation} "${entry.toMiddleware}" middleware.`);relativeEntries.splice(toOverrideIndex,1)}}for(let alias of aliases)entriesNameSet.add(alias)}relativeEntries.push(entry)},clone:()=>cloneTo(constructStack()),use:(plugin)=>{plugin.applyToStack(stack)},remove:(toRemove)=>{if(typeof toRemove==="string")return removeByName(toRemove);else return removeByReference(toRemove)},removeByTag:(toRemove)=>{let isRemoved=!1,filterCb=(entry)=>{let{tags,name,aliases:_aliases}=entry;if(tags&&tags.includes(toRemove)){let aliases=getAllAliases(name,_aliases);for(let alias of aliases)entriesNameSet.delete(alias);return isRemoved=!0,!1}return!0};return absoluteEntries=absoluteEntries.filter(filterCb),relativeEntries=relativeEntries.filter(filterCb),isRemoved},concat:(from)=>{let cloned=cloneTo(constructStack());return cloned.use(from),cloned.identifyOnResolve(identifyOnResolve||cloned.identifyOnResolve()||(from.identifyOnResolve?.()??!1)),cloned},applyToStack:cloneTo,identify:()=>{return getMiddlewareList(!0).map((mw)=>{let step=mw.step??mw.relation+" "+mw.toMiddleware;return getMiddlewareNameWithAliases(mw.name,mw.aliases)+" - "+step})},identifyOnResolve(toggle){if(typeof toggle==="boolean")identifyOnResolve=toggle;return identifyOnResolve},resolve:(handler,context)=>{for(let middleware of getMiddlewareList().map((entry)=>entry.middleware).reverse())handler=middleware(handler,context);if(identifyOnResolve)console.log(stack.identify());return handler}};return stack},stepWeights={initialize:5,serialize:4,build:3,finalizeRequest:2,deserialize:1},priorityWeights={high:3,normal:2,low:1};exports.constructStack=constructStack});var require_dist_cjs21=__commonJS((exports)=>{var middlewareStack=require_dist_cjs20(),protocols=require_protocols(),types3=require_dist_cjs(),schema=require_schema(),serde=require_serde();class Client{config;middlewareStack=middlewareStack.constructStack();initConfig;handlers;constructor(config){this.config=config;let{protocol,protocolSettings}=config;if(protocolSettings){if(typeof protocol==="function")config.protocol=new protocol(protocolSettings)}}send(command,optionsOrCb,cb){let options=typeof optionsOrCb!=="function"?optionsOrCb:void 0,callback=typeof optionsOrCb==="function"?optionsOrCb:cb,useHandlerCache=options===void 0&&this.config.cacheMiddleware===!0,handler;if(useHandlerCache){if(!this.handlers)this.handlers=new WeakMap;let handlers=this.handlers;if(handlers.has(command.constructor))handler=handlers.get(command.constructor);else handler=command.resolveMiddleware(this.middlewareStack,this.config,options),handlers.set(command.constructor,handler)}else delete this.handlers,handler=command.resolveMiddleware(this.middlewareStack,this.config,options);if(callback)handler(command).then((result2)=>callback(null,result2.output),(err)=>callback(err)).catch(()=>{});else return handler(command).then((result2)=>result2.output)}destroy(){this.config?.requestHandler?.destroy?.(),delete this.handlers}}var SENSITIVE_STRING$1="***SensitiveInformation***";function schemaLogFilter(schema$1,data){if(data==null)return data;let ns=schema.NormalizedSchema.of(schema$1);if(ns.getMergedTraits().sensitive)return SENSITIVE_STRING$1;if(ns.isListSchema()){if(!!ns.getValueSchema().getMergedTraits().sensitive)return SENSITIVE_STRING$1}else if(ns.isMapSchema()){if(!!ns.getKeySchema().getMergedTraits().sensitive||!!ns.getValueSchema().getMergedTraits().sensitive)return SENSITIVE_STRING$1}else if(ns.isStructSchema()&&typeof data==="object"){let object=data,newObject={};for(let[member,memberNs]of ns.structIterator())if(object[member]!=null)newObject[member]=schemaLogFilter(memberNs,object[member]);return newObject}return data}class Command{middlewareStack=middlewareStack.constructStack();schema;static classBuilder(){return new ClassBuilder}resolveMiddlewareWithContext(clientStack,configuration,options,{middlewareFn,clientName,commandName,inputFilterSensitiveLog,outputFilterSensitiveLog,smithyContext,additionalContext,CommandCtor}){for(let mw of middlewareFn.bind(this)(CommandCtor,clientStack,configuration,options))this.middlewareStack.use(mw);let stack=clientStack.concat(this.middlewareStack),{logger}=configuration,handlerExecutionContext={logger,clientName,commandName,inputFilterSensitiveLog,outputFilterSensitiveLog,[types3.SMITHY_CONTEXT_KEY]:{commandInstance:this,...smithyContext},...additionalContext},{requestHandler}=configuration;return stack.resolve((request)=>requestHandler.handle(request.request,options||{}),handlerExecutionContext)}}class ClassBuilder{_init=()=>{};_ep={};_middlewareFn=()=>[];_commandName="";_clientName="";_additionalContext={};_smithyContext={};_inputFilterSensitiveLog=void 0;_outputFilterSensitiveLog=void 0;_serializer=null;_deserializer=null;_operationSchema;init(cb){this._init=cb}ep(endpointParameterInstructions){return this._ep=endpointParameterInstructions,this}m(middlewareSupplier){return this._middlewareFn=middlewareSupplier,this}s(service,operation,smithyContext={}){return this._smithyContext={service,operation,...smithyContext},this}c(additionalContext={}){return this._additionalContext=additionalContext,this}n(clientName,commandName){return this._clientName=clientName,this._commandName=commandName,this}f(inputFilter=(_2)=>_2,outputFilter=(_2)=>_2){return this._inputFilterSensitiveLog=inputFilter,this._outputFilterSensitiveLog=outputFilter,this}ser(serializer){return this._serializer=serializer,this}de(deserializer){return this._deserializer=deserializer,this}sc(operation){return this._operationSchema=operation,this._smithyContext.operationSchema=operation,this}build(){let closure=this,CommandRef;return CommandRef=class extends Command{input;static getEndpointParameterInstructions(){return closure._ep}constructor(...[input]){super();this.input=input??{},closure._init(this),this.schema=closure._operationSchema}resolveMiddleware(stack,configuration,options){let op=closure._operationSchema,input=op?.[4]??op?.input,output=op?.[5]??op?.output;return this.resolveMiddlewareWithContext(stack,configuration,options,{CommandCtor:CommandRef,middlewareFn:closure._middlewareFn,clientName:closure._clientName,commandName:closure._commandName,inputFilterSensitiveLog:closure._inputFilterSensitiveLog??(op?schemaLogFilter.bind(null,input):(_2)=>_2),outputFilterSensitiveLog:closure._outputFilterSensitiveLog??(op?schemaLogFilter.bind(null,output):(_2)=>_2),smithyContext:closure._smithyContext,additionalContext:closure._additionalContext})}serialize=closure._serializer;deserialize=closure._deserializer}}}var SENSITIVE_STRING="***SensitiveInformation***",createAggregatedClient=(commands,Client2,options)=>{for(let[command,CommandCtor]of Object.entries(commands)){let methodImpl=async function(args,optionsOrCb,cb){let command2=new CommandCtor(args);if(typeof optionsOrCb==="function")this.send(command2,optionsOrCb);else if(typeof cb==="function"){if(typeof optionsOrCb!=="object")throw Error(`Expected http options but got ${typeof optionsOrCb}`);this.send(command2,optionsOrCb||{},cb)}else return this.send(command2,optionsOrCb)},methodName=(command[0].toLowerCase()+command.slice(1)).replace(/Command$/,"");Client2.prototype[methodName]=methodImpl}let{paginators={},waiters={}}=options??{};for(let[paginatorName,paginatorFn]of Object.entries(paginators))if(Client2.prototype[paginatorName]===void 0)Client2.prototype[paginatorName]=function(commandInput={},paginationConfiguration,...rest){return paginatorFn({...paginationConfiguration,client:this},commandInput,...rest)};for(let[waiterName,waiterFn]of Object.entries(waiters))if(Client2.prototype[waiterName]===void 0)Client2.prototype[waiterName]=async function(commandInput={},waiterConfiguration,...rest){let config=waiterConfiguration;if(typeof waiterConfiguration==="number")config={maxWaitTime:waiterConfiguration};return waiterFn({...config,client:this},commandInput,...rest)}};class ServiceException extends Error{$fault;$response;$retryable;$metadata;constructor(options){super(options.message);Object.setPrototypeOf(this,Object.getPrototypeOf(this).constructor.prototype),this.name=options.name,this.$fault=options.$fault,this.$metadata=options.$metadata}static isInstance(value){if(!value)return!1;let candidate=value;return ServiceException.prototype.isPrototypeOf(candidate)||Boolean(candidate.$fault)&&Boolean(candidate.$metadata)&&(candidate.$fault==="client"||candidate.$fault==="server")}static[Symbol.hasInstance](instance){if(!instance)return!1;let candidate=instance;if(this===ServiceException)return ServiceException.isInstance(instance);if(ServiceException.isInstance(instance)){if(candidate.name&&this.name)return this.prototype.isPrototypeOf(instance)||candidate.name===this.name;return this.prototype.isPrototypeOf(instance)}return!1}}var decorateServiceException=(exception,additions={})=>{Object.entries(additions).filter(([,v])=>v!==void 0).forEach(([k2,v])=>{if(exception[k2]==null||exception[k2]==="")exception[k2]=v});let message=exception.message||exception.Message||"UnknownError";return exception.message=message,delete exception.Message,exception},throwDefaultError=({output,parsedBody,exceptionCtor,errorCode})=>{let $metadata=deserializeMetadata(output),statusCode=$metadata.httpStatusCode?$metadata.httpStatusCode+"":void 0,response=new exceptionCtor({name:parsedBody?.code||parsedBody?.Code||errorCode||statusCode||"UnknownError",$fault:"client",$metadata});throw decorateServiceException(response,parsedBody)},withBaseException=(ExceptionCtor)=>{return({output,parsedBody,errorCode})=>{throwDefaultError({output,parsedBody,exceptionCtor:ExceptionCtor,errorCode})}},deserializeMetadata=(output)=>({httpStatusCode:output.statusCode,requestId:output.headers["x-amzn-requestid"]??output.headers["x-amzn-request-id"]??output.headers["x-amz-request-id"],extendedRequestId:output.headers["x-amz-id-2"],cfId:output.headers["x-amz-cf-id"]}),loadConfigsForDefaultMode=(mode)=>{switch(mode){case"standard":return{retryMode:"standard",connectionTimeout:3100};case"in-region":return{retryMode:"standard",connectionTimeout:1100};case"cross-region":return{retryMode:"standard",connectionTimeout:3100};case"mobile":return{retryMode:"standard",connectionTimeout:30000};default:return{}}},warningEmitted=!1,emitWarningIfUnsupportedVersion=(version2)=>{if(version2&&!warningEmitted&&parseInt(version2.substring(1,version2.indexOf(".")))<16)warningEmitted=!0},getChecksumConfiguration=(runtimeConfig)=>{let checksumAlgorithms=[];for(let id in types3.AlgorithmId){let algorithmId=types3.AlgorithmId[id];if(runtimeConfig[algorithmId]===void 0)continue;checksumAlgorithms.push({algorithmId:()=>algorithmId,checksumConstructor:()=>runtimeConfig[algorithmId]})}return{addChecksumAlgorithm(algo){checksumAlgorithms.push(algo)},checksumAlgorithms(){return checksumAlgorithms}}},resolveChecksumRuntimeConfig=(clientConfig)=>{let runtimeConfig={};return clientConfig.checksumAlgorithms().forEach((checksumAlgorithm)=>{runtimeConfig[checksumAlgorithm.algorithmId()]=checksumAlgorithm.checksumConstructor()}),runtimeConfig},getRetryConfiguration=(runtimeConfig)=>{return{setRetryStrategy(retryStrategy){runtimeConfig.retryStrategy=retryStrategy},retryStrategy(){return runtimeConfig.retryStrategy}}},resolveRetryRuntimeConfig=(retryStrategyConfiguration)=>{let runtimeConfig={};return runtimeConfig.retryStrategy=retryStrategyConfiguration.retryStrategy(),runtimeConfig},getDefaultExtensionConfiguration=(runtimeConfig)=>{return Object.assign(getChecksumConfiguration(runtimeConfig),getRetryConfiguration(runtimeConfig))},getDefaultClientConfiguration=getDefaultExtensionConfiguration,resolveDefaultRuntimeConfig=(config)=>{return Object.assign(resolveChecksumRuntimeConfig(config),resolveRetryRuntimeConfig(config))},getArrayIfSingleItem=(mayBeArray)=>Array.isArray(mayBeArray)?mayBeArray:[mayBeArray],getValueFromTextNode=(obj)=>{for(let key in obj)if(obj.hasOwnProperty(key)&&obj[key]["#text"]!==void 0)obj[key]=obj[key]["#text"];else if(typeof obj[key]==="object"&&obj[key]!==null)obj[key]=getValueFromTextNode(obj[key]);return obj},isSerializableHeaderValue=(value)=>{return value!=null};class NoOpLogger{trace(){}debug(){}info(){}warn(){}error(){}}function map3(arg0,arg1,arg2){let target,filter,instructions;if(typeof arg1>"u"&&typeof arg2>"u")target={},instructions=arg0;else if(target=arg0,typeof arg1==="function")return filter=arg1,instructions=arg2,mapWithFilter(target,filter,instructions);else instructions=arg1;for(let key of Object.keys(instructions)){if(!Array.isArray(instructions[key])){target[key]=instructions[key];continue}applyInstruction(target,null,instructions,key)}return target}var convertMap=(target)=>{let output={};for(let[k2,v]of Object.entries(target||{}))output[k2]=[,v];return output},take=(source,instructions)=>{let out={};for(let key in instructions)applyInstruction(out,source,instructions,key);return out},mapWithFilter=(target,filter,instructions)=>{return map3(target,Object.entries(instructions).reduce((_instructions,[key,value])=>{if(Array.isArray(value))_instructions[key]=value;else if(typeof value==="function")_instructions[key]=[filter,value()];else _instructions[key]=[filter,value];return _instructions},{}))},applyInstruction=(target,source,instructions,targetKey)=>{if(source!==null){let instruction=instructions[targetKey];if(typeof instruction==="function")instruction=[,instruction];let[filter2=nonNullish,valueFn=pass,sourceKey=targetKey]=instruction;if(typeof filter2==="function"&&filter2(source[sourceKey])||typeof filter2!=="function"&&!!filter2)target[targetKey]=valueFn(source[sourceKey]);return}let[filter,value]=instructions[targetKey];if(typeof value==="function"){let _value,defaultFilterPassed=filter===void 0&&(_value=value())!=null,customFilterPassed=typeof filter==="function"&&!!filter(void 0)||typeof filter!=="function"&&!!filter;if(defaultFilterPassed)target[targetKey]=_value;else if(customFilterPassed)target[targetKey]=value()}else{let defaultFilterPassed=filter===void 0&&value!=null,customFilterPassed=typeof filter==="function"&&!!filter(value)||typeof filter!=="function"&&!!filter;if(defaultFilterPassed||customFilterPassed)target[targetKey]=value}},nonNullish=(_2)=>_2!=null,pass=(_2)=>_2,serializeFloat=(value)=>{if(value!==value)return"NaN";switch(value){case 1/0:return"Infinity";case-1/0:return"-Infinity";default:return value}},serializeDateTime=(date3)=>date3.toISOString().replace(".000Z","Z"),_json=(obj)=>{if(obj==null)return{};if(Array.isArray(obj))return obj.filter((_2)=>_2!=null).map(_json);if(typeof obj==="object"){let target={};for(let key of Object.keys(obj)){if(obj[key]==null)continue;target[key]=_json(obj[key])}return target}return obj};Object.defineProperty(exports,"collectBody",{enumerable:!0,get:function(){return protocols.collectBody}});Object.defineProperty(exports,"extendedEncodeURIComponent",{enumerable:!0,get:function(){return protocols.extendedEncodeURIComponent}});Object.defineProperty(exports,"resolvedPath",{enumerable:!0,get:function(){return protocols.resolvedPath}});exports.Client=Client;exports.Command=Command;exports.NoOpLogger=NoOpLogger;exports.SENSITIVE_STRING=SENSITIVE_STRING;exports.ServiceException=ServiceException;exports._json=_json;exports.convertMap=convertMap;exports.createAggregatedClient=createAggregatedClient;exports.decorateServiceException=decorateServiceException;exports.emitWarningIfUnsupportedVersion=emitWarningIfUnsupportedVersion;exports.getArrayIfSingleItem=getArrayIfSingleItem;exports.getDefaultClientConfiguration=getDefaultClientConfiguration;exports.getDefaultExtensionConfiguration=getDefaultExtensionConfiguration;exports.getValueFromTextNode=getValueFromTextNode;exports.isSerializableHeaderValue=isSerializableHeaderValue;exports.loadConfigsForDefaultMode=loadConfigsForDefaultMode;exports.map=map3;exports.resolveDefaultRuntimeConfig=resolveDefaultRuntimeConfig;exports.serializeDateTime=serializeDateTime;exports.serializeFloat=serializeFloat;exports.take=take;exports.throwDefaultError=throwDefaultError;exports.withBaseException=withBaseException;Object.keys(serde).forEach(function(k2){if(k2!=="default"&&!Object.prototype.hasOwnProperty.call(exports,k2))Object.defineProperty(exports,k2,{enumerable:!0,get:function(){return serde[k2]}})})});var require_fxp=__commonJS((exports,module)=>{(()=>{var t2={d:(e2,i2)=>{for(var n3 in i2)t2.o(i2,n3)&&!t2.o(e2,n3)&&Object.defineProperty(e2,n3,{enumerable:!0,get:i2[n3]})},o:(t3,e2)=>Object.prototype.hasOwnProperty.call(t3,e2),r:(t3)=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(t3,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t3,"__esModule",{value:!0})}},e={};t2.r(e),t2.d(e,{XMLBuilder:()=>ut,XMLParser:()=>et,XMLValidator:()=>ft});let i=":A-Za-z_\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",n2=new RegExp("^["+i+"]["+i+"\\-.\\d\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$");function s(t3,e2){let i2=[],n3=e2.exec(t3);for(;n3;){let s2=[];s2.startIndex=e2.lastIndex-n3[0].length;let r3=n3.length;for(let t4=0;t4<r3;t4++)s2.push(n3[t4]);i2.push(s2),n3=e2.exec(t3)}return i2}let r2=function(t3){return n2.exec(t3)!=null},o={allowBooleanAttributes:!1,unpairedTags:[]};function a12(t3,e2){e2=Object.assign({},o,e2);let i2=[],n3=!1,s2=!1;t3[0]==="\uFEFF"&&(t3=t3.substr(1));for(let o2=0;o2<t3.length;o2++)if(t3[o2]==="<"&&t3[o2+1]==="?"){if(o2+=2,o2=u(t3,o2),o2.err)return o2}else{if(t3[o2]!=="<"){if(l2(t3[o2]))continue;return x("InvalidChar","char '"+t3[o2]+"' is not expected.",b2(t3,o2))}{let a13=o2;if(o2++,t3[o2]==="!"){o2=h(t3,o2);continue}{let d2=!1;t3[o2]==="/"&&(d2=!0,o2++);let p2="";for(;o2<t3.length&&t3[o2]!==">"&&t3[o2]!==" "&&t3[o2]!=="\t"&&t3[o2]!==`
`&&t3[o2]!=="\r";o2++)p2+=t3[o2];if(p2=p2.trim(),p2[p2.length-1]==="/"&&(p2=p2.substring(0,p2.length-1),o2--),!r2(p2)){let e3;return e3=p2.trim().length===0?"Invalid space after '<'.":"Tag '"+p2+"' is an invalid name.",x("InvalidTag",e3,b2(t3,o2))}let c2=f(t3,o2);if(c2===!1)return x("InvalidAttr","Attributes for '"+p2+"' have open quote.",b2(t3,o2));let N2=c2.value;if(o2=c2.index,N2[N2.length-1]==="/"){let i3=o2-N2.length;N2=N2.substring(0,N2.length-1);let s3=g(N2,e2);if(s3!==!0)return x(s3.err.code,s3.err.msg,b2(t3,i3+s3.err.line));n3=!0}else if(d2){if(!c2.tagClosed)return x("InvalidTag","Closing tag '"+p2+"' doesn't have proper closing.",b2(t3,o2));if(N2.trim().length>0)return x("InvalidTag","Closing tag '"+p2+"' can't have attributes or invalid starting.",b2(t3,a13));if(i2.length===0)return x("InvalidTag","Closing tag '"+p2+"' has not been opened.",b2(t3,a13));{let e3=i2.pop();if(p2!==e3.tagName){let i3=b2(t3,e3.tagStartPos);return x("InvalidTag","Expected closing tag '"+e3.tagName+"' (opened in line "+i3.line+", col "+i3.col+") instead of closing tag '"+p2+"'.",b2(t3,a13))}i2.length==0&&(s2=!0)}}else{let r3=g(N2,e2);if(r3!==!0)return x(r3.err.code,r3.err.msg,b2(t3,o2-N2.length+r3.err.line));if(s2===!0)return x("InvalidXml","Multiple possible root nodes found.",b2(t3,o2));e2.unpairedTags.indexOf(p2)!==-1||i2.push({tagName:p2,tagStartPos:a13}),n3=!0}for(o2++;o2<t3.length;o2++)if(t3[o2]==="<"){if(t3[o2+1]==="!"){o2++,o2=h(t3,o2);continue}if(t3[o2+1]!=="?")break;if(o2=u(t3,++o2),o2.err)return o2}else if(t3[o2]==="&"){let e3=m2(t3,o2);if(e3==-1)return x("InvalidChar","char '&' is not expected.",b2(t3,o2));o2=e3}else if(s2===!0&&!l2(t3[o2]))return x("InvalidXml","Extra text at the end",b2(t3,o2));t3[o2]==="<"&&o2--}}}return n3?i2.length==1?x("InvalidTag","Unclosed tag '"+i2[0].tagName+"'.",b2(t3,i2[0].tagStartPos)):!(i2.length>0)||x("InvalidXml","Invalid '"+JSON.stringify(i2.map((t4)=>t4.tagName),null,4).replace(/\r?\n/g,"")+"' found.",{line:1,col:1}):x("InvalidXml","Start tag expected.",1)}function l2(t3){return t3===" "||t3==="\t"||t3===`
`||t3==="\r"}function u(t3,e2){let i2=e2;for(;e2<t3.length;e2++)if(t3[e2]!="?"&&t3[e2]!=" ");else{let n3=t3.substr(i2,e2-i2);if(e2>5&&n3==="xml")return x("InvalidXml","XML declaration allowed only at the start of the document.",b2(t3,e2));if(t3[e2]=="?"&&t3[e2+1]==">"){e2++;break}}return e2}function h(t3,e2){if(t3.length>e2+5&&t3[e2+1]==="-"&&t3[e2+2]==="-"){for(e2+=3;e2<t3.length;e2++)if(t3[e2]==="-"&&t3[e2+1]==="-"&&t3[e2+2]===">"){e2+=2;break}}else if(t3.length>e2+8&&t3[e2+1]==="D"&&t3[e2+2]==="O"&&t3[e2+3]==="C"&&t3[e2+4]==="T"&&t3[e2+5]==="Y"&&t3[e2+6]==="P"&&t3[e2+7]==="E"){let i2=1;for(e2+=8;e2<t3.length;e2++)if(t3[e2]==="<")i2++;else if(t3[e2]===">"&&(i2--,i2===0))break}else if(t3.length>e2+9&&t3[e2+1]==="["&&t3[e2+2]==="C"&&t3[e2+3]==="D"&&t3[e2+4]==="A"&&t3[e2+5]==="T"&&t3[e2+6]==="A"&&t3[e2+7]==="["){for(e2+=8;e2<t3.length;e2++)if(t3[e2]==="]"&&t3[e2+1]==="]"&&t3[e2+2]===">"){e2+=2;break}}return e2}let d='"',p="'";function f(t3,e2){let i2="",n3="",s2=!1;for(;e2<t3.length;e2++){if(t3[e2]===d||t3[e2]===p)n3===""?n3=t3[e2]:n3!==t3[e2]||(n3="");else if(t3[e2]===">"&&n3===""){s2=!0;break}i2+=t3[e2]}return n3===""&&{value:i2,index:e2,tagClosed:s2}}let c=new RegExp(`(\\s*)([^\\s=]+)(\\s*=)?(\\s*(['"])(([\\s\\S])*?)\\5)?`,"g");function g(t3,e2){let i2=s(t3,c),n3={};for(let t4=0;t4<i2.length;t4++){if(i2[t4][1].length===0)return x("InvalidAttr","Attribute '"+i2[t4][2]+"' has no space in starting.",E(i2[t4]));if(i2[t4][3]!==void 0&&i2[t4][4]===void 0)return x("InvalidAttr","Attribute '"+i2[t4][2]+"' is without value.",E(i2[t4]));if(i2[t4][3]===void 0&&!e2.allowBooleanAttributes)return x("InvalidAttr","boolean attribute '"+i2[t4][2]+"' is not allowed.",E(i2[t4]));let s2=i2[t4][2];if(!N(s2))return x("InvalidAttr","Attribute '"+s2+"' is an invalid name.",E(i2[t4]));if(n3.hasOwnProperty(s2))return x("InvalidAttr","Attribute '"+s2+"' is repeated.",E(i2[t4]));n3[s2]=1}return!0}function m2(t3,e2){if(t3[++e2]===";")return-1;if(t3[e2]==="#")return function(t4,e3){let i3=/\d/;for(t4[e3]==="x"&&(e3++,i3=/[\da-fA-F]/);e3<t4.length;e3++){if(t4[e3]===";")return e3;if(!t4[e3].match(i3))break}return-1}(t3,++e2);let i2=0;for(;e2<t3.length;e2++,i2++)if(!(t3[e2].match(/\w/)&&i2<20)){if(t3[e2]===";")break;return-1}return e2}function x(t3,e2,i2){return{err:{code:t3,msg:e2,line:i2.line||i2,col:i2.col}}}function N(t3){return r2(t3)}function b2(t3,e2){let i2=t3.substring(0,e2).split(/\r?\n/);return{line:i2.length,col:i2[i2.length-1].length+1}}function E(t3){return t3.startIndex+t3[1].length}let v={preserveOrder:!1,attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,removeNSPrefix:!1,allowBooleanAttributes:!1,parseTagValue:!0,parseAttributeValue:!1,trimValues:!0,cdataPropName:!1,numberParseOptions:{hex:!0,leadingZeros:!0,eNotation:!0},tagValueProcessor:function(t3,e2){return e2},attributeValueProcessor:function(t3,e2){return e2},stopNodes:[],alwaysCreateTextNode:!1,isArray:()=>!1,commentPropName:!1,unpairedTags:[],processEntities:!0,htmlEntities:!1,ignoreDeclaration:!1,ignorePiTags:!1,transformTagName:!1,transformAttributeName:!1,updateTag:function(t3,e2,i2){return t3},captureMetaData:!1},T2;T2=typeof Symbol!="function"?"@@xmlMetadata":Symbol("XML Node Metadata");class y{constructor(t3){this.tagname=t3,this.child=[],this[":@"]={}}add(t3,e2){t3==="__proto__"&&(t3="#__proto__"),this.child.push({[t3]:e2})}addChild(t3,e2){t3.tagname==="__proto__"&&(t3.tagname="#__proto__"),t3[":@"]&&Object.keys(t3[":@"]).length>0?this.child.push({[t3.tagname]:t3.child,":@":t3[":@"]}):this.child.push({[t3.tagname]:t3.child}),e2!==void 0&&(this.child[this.child.length-1][T2]={startIndex:e2})}static getMetaDataSymbol(){return T2}}class w{constructor(t3){this.suppressValidationErr=!t3}readDocType(t3,e2){let i2={};if(t3[e2+3]!=="O"||t3[e2+4]!=="C"||t3[e2+5]!=="T"||t3[e2+6]!=="Y"||t3[e2+7]!=="P"||t3[e2+8]!=="E")throw Error("Invalid Tag instead of DOCTYPE");{e2+=9;let n3=1,s2=!1,r3=!1,o2="";for(;e2<t3.length;e2++)if(t3[e2]!=="<"||r3)if(t3[e2]===">"){if(r3?t3[e2-1]==="-"&&t3[e2-2]==="-"&&(r3=!1,n3--):n3--,n3===0)break}else t3[e2]==="["?s2=!0:o2+=t3[e2];else{if(s2&&P(t3,"!ENTITY",e2)){let n4,s3;e2+=7,[n4,s3,e2]=this.readEntityExp(t3,e2+1,this.suppressValidationErr),s3.indexOf("&")===-1&&(i2[n4]={regx:RegExp(`&${n4};`,"g"),val:s3})}else if(s2&&P(t3,"!ELEMENT",e2)){e2+=8;let{index:i3}=this.readElementExp(t3,e2+1);e2=i3}else if(s2&&P(t3,"!ATTLIST",e2))e2+=8;else if(s2&&P(t3,"!NOTATION",e2)){e2+=9;let{index:i3}=this.readNotationExp(t3,e2+1,this.suppressValidationErr);e2=i3}else{if(!P(t3,"!--",e2))throw Error("Invalid DOCTYPE");r3=!0}n3++,o2=""}if(n3!==0)throw Error("Unclosed DOCTYPE")}return{entities:i2,i:e2}}readEntityExp(t3,e2){e2=I(t3,e2);let i2="";for(;e2<t3.length&&!/\s/.test(t3[e2])&&t3[e2]!=='"'&&t3[e2]!=="'";)i2+=t3[e2],e2++;if(O(i2),e2=I(t3,e2),!this.suppressValidationErr){if(t3.substring(e2,e2+6).toUpperCase()==="SYSTEM")throw Error("External entities are not supported");if(t3[e2]==="%")throw Error("Parameter entities are not supported")}let n3="";return[e2,n3]=this.readIdentifierVal(t3,e2,"entity"),[i2,n3,--e2]}readNotationExp(t3,e2){e2=I(t3,e2);let i2="";for(;e2<t3.length&&!/\s/.test(t3[e2]);)i2+=t3[e2],e2++;!this.suppressValidationErr&&O(i2),e2=I(t3,e2);let n3=t3.substring(e2,e2+6).toUpperCase();if(!this.suppressValidationErr&&n3!=="SYSTEM"&&n3!=="PUBLIC")throw Error(`Expected SYSTEM or PUBLIC, found "${n3}"`);e2+=n3.length,e2=I(t3,e2);let s2=null,r3=null;if(n3==="PUBLIC")[e2,s2]=this.readIdentifierVal(t3,e2,"publicIdentifier"),t3[e2=I(t3,e2)]!=='"'&&t3[e2]!=="'"||([e2,r3]=this.readIdentifierVal(t3,e2,"systemIdentifier"));else if(n3==="SYSTEM"&&([e2,r3]=this.readIdentifierVal(t3,e2,"systemIdentifier"),!this.suppressValidationErr&&!r3))throw Error("Missing mandatory system identifier for SYSTEM notation");return{notationName:i2,publicIdentifier:s2,systemIdentifier:r3,index:--e2}}readIdentifierVal(t3,e2,i2){let n3="",s2=t3[e2];if(s2!=='"'&&s2!=="'")throw Error(`Expected quoted string, found "${s2}"`);for(e2++;e2<t3.length&&t3[e2]!==s2;)n3+=t3[e2],e2++;if(t3[e2]!==s2)throw Error(`Unterminated ${i2} value`);return[++e2,n3]}readElementExp(t3,e2){e2=I(t3,e2);let i2="";for(;e2<t3.length&&!/\s/.test(t3[e2]);)i2+=t3[e2],e2++;if(!this.suppressValidationErr&&!r2(i2))throw Error(`Invalid element name: "${i2}"`);let n3="";if(t3[e2=I(t3,e2)]==="E"&&P(t3,"MPTY",e2))e2+=4;else if(t3[e2]==="A"&&P(t3,"NY",e2))e2+=2;else if(t3[e2]==="("){for(e2++;e2<t3.length&&t3[e2]!==")";)n3+=t3[e2],e2++;if(t3[e2]!==")")throw Error("Unterminated content model")}else if(!this.suppressValidationErr)throw Error(`Invalid Element Expression, found "${t3[e2]}"`);return{elementName:i2,contentModel:n3.trim(),index:e2}}readAttlistExp(t3,e2){e2=I(t3,e2);let i2="";for(;e2<t3.length&&!/\s/.test(t3[e2]);)i2+=t3[e2],e2++;O(i2),e2=I(t3,e2);let n3="";for(;e2<t3.length&&!/\s/.test(t3[e2]);)n3+=t3[e2],e2++;if(!O(n3))throw Error(`Invalid attribute name: "${n3}"`);e2=I(t3,e2);let s2="";if(t3.substring(e2,e2+8).toUpperCase()==="NOTATION"){if(s2="NOTATION",t3[e2=I(t3,e2+=8)]!=="(")throw Error(`Expected '(', found "${t3[e2]}"`);e2++;let i3=[];for(;e2<t3.length&&t3[e2]!==")";){let n4="";for(;e2<t3.length&&t3[e2]!=="|"&&t3[e2]!==")";)n4+=t3[e2],e2++;if(n4=n4.trim(),!O(n4))throw Error(`Invalid notation name: "${n4}"`);i3.push(n4),t3[e2]==="|"&&(e2++,e2=I(t3,e2))}if(t3[e2]!==")")throw Error("Unterminated list of notations");e2++,s2+=" ("+i3.join("|")+")"}else{for(;e2<t3.length&&!/\s/.test(t3[e2]);)s2+=t3[e2],e2++;let i3=["CDATA","ID","IDREF","IDREFS","ENTITY","ENTITIES","NMTOKEN","NMTOKENS"];if(!this.suppressValidationErr&&!i3.includes(s2.toUpperCase()))throw Error(`Invalid attribute type: "${s2}"`)}e2=I(t3,e2);let r3="";return t3.substring(e2,e2+8).toUpperCase()==="#REQUIRED"?(r3="#REQUIRED",e2+=8):t3.substring(e2,e2+7).toUpperCase()==="#IMPLIED"?(r3="#IMPLIED",e2+=7):[e2,r3]=this.readIdentifierVal(t3,e2,"ATTLIST"),{elementName:i2,attributeName:n3,attributeType:s2,defaultValue:r3,index:e2}}}let I=(t3,e2)=>{for(;e2<t3.length&&/\s/.test(t3[e2]);)e2++;return e2};function P(t3,e2,i2){for(let n3=0;n3<e2.length;n3++)if(e2[n3]!==t3[i2+n3+1])return!1;return!0}function O(t3){if(r2(t3))return t3;throw Error(`Invalid entity name ${t3}`)}let A=/^[-+]?0x[a-fA-F0-9]+$/,S=/^([\-\+])?(0*)([0-9]*(\.[0-9]*)?)$/,C={hex:!0,leadingZeros:!0,decimalPoint:".",eNotation:!0},V=/^([-+])?(0*)(\d*(\.\d*)?[eE][-\+]?\d+)$/;function $2(t3){return typeof t3=="function"?t3:Array.isArray(t3)?(e2)=>{for(let i2 of t3){if(typeof i2=="string"&&e2===i2)return!0;if(i2 instanceof RegExp&&i2.test(e2))return!0}}:()=>!1}class D{constructor(t3){if(this.options=t3,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"\xA2"},pound:{regex:/&(pound|#163);/g,val:"\xA3"},yen:{regex:/&(yen|#165);/g,val:"\xA5"},euro:{regex:/&(euro|#8364);/g,val:"\u20AC"},copyright:{regex:/&(copy|#169);/g,val:"\xA9"},reg:{regex:/&(reg|#174);/g,val:"\xAE"},inr:{regex:/&(inr|#8377);/g,val:"\u20B9"},num_dec:{regex:/&#([0-9]{1,7});/g,val:(t4,e2)=>Z(e2,10,"&#")},num_hex:{regex:/&#x([0-9a-fA-F]{1,6});/g,val:(t4,e2)=>Z(e2,16,"&#x")}},this.addExternalEntities=j,this.parseXml=L,this.parseTextData=M,this.resolveNameSpace=F,this.buildAttributesMap=k2,this.isItStopNode=Y2,this.replaceEntitiesValue=B,this.readStopNodeData=W,this.saveTextToParentTag=R,this.addChild=U,this.ignoreAttributesFn=$2(this.options.ignoreAttributes),this.options.stopNodes&&this.options.stopNodes.length>0){this.stopNodesExact=new Set,this.stopNodesWildcard=new Set;for(let t4=0;t4<this.options.stopNodes.length;t4++){let e2=this.options.stopNodes[t4];typeof e2=="string"&&(e2.startsWith("*.")?this.stopNodesWildcard.add(e2.substring(2)):this.stopNodesExact.add(e2))}}}}function j(t3){let e2=Object.keys(t3);for(let i2=0;i2<e2.length;i2++){let n3=e2[i2];this.lastEntities[n3]={regex:new RegExp("&"+n3+";","g"),val:t3[n3]}}}function M(t3,e2,i2,n3,s2,r3,o2){if(t3!==void 0&&(this.options.trimValues&&!n3&&(t3=t3.trim()),t3.length>0)){o2||(t3=this.replaceEntitiesValue(t3));let n4=this.options.tagValueProcessor(e2,t3,i2,s2,r3);return n4==null?t3:typeof n4!=typeof t3||n4!==t3?n4:this.options.trimValues||t3.trim()===t3?q(t3,this.options.parseTagValue,this.options.numberParseOptions):t3}}function F(t3){if(this.options.removeNSPrefix){let e2=t3.split(":"),i2=t3.charAt(0)==="/"?"/":"";if(e2[0]==="xmlns")return"";e2.length===2&&(t3=i2+e2[1])}return t3}let _2=new RegExp(`([^\\s=]+)\\s*(=\\s*(['"])([\\s\\S]*?)\\3)?`,"gm");function k2(t3,e2){if(this.options.ignoreAttributes!==!0&&typeof t3=="string"){let i2=s(t3,_2),n3=i2.length,r3={};for(let t4=0;t4<n3;t4++){let n4=this.resolveNameSpace(i2[t4][1]);if(this.ignoreAttributesFn(n4,e2))continue;let s2=i2[t4][4],o2=this.options.attributeNamePrefix+n4;if(n4.length)if(this.options.transformAttributeName&&(o2=this.options.transformAttributeName(o2)),o2==="__proto__"&&(o2="#__proto__"),s2!==void 0){this.options.trimValues&&(s2=s2.trim()),s2=this.replaceEntitiesValue(s2);let t5=this.options.attributeValueProcessor(n4,s2,e2);r3[o2]=t5==null?s2:typeof t5!=typeof s2||t5!==s2?t5:q(s2,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(r3[o2]=!0)}if(!Object.keys(r3).length)return;if(this.options.attributesGroupName){let t4={};return t4[this.options.attributesGroupName]=r3,t4}return r3}}let L=function(t3){t3=t3.replace(/\r\n?/g,`
`);let e2=new y("!xml"),i2=e2,n3="",s2="",r3=new w(this.options.processEntities);for(let o2=0;o2<t3.length;o2++)if(t3[o2]==="<")if(t3[o2+1]==="/"){let e3=G(t3,">",o2,"Closing Tag is not closed."),r4=t3.substring(o2+2,e3).trim();if(this.options.removeNSPrefix){let t4=r4.indexOf(":");t4!==-1&&(r4=r4.substr(t4+1))}this.options.transformTagName&&(r4=this.options.transformTagName(r4)),i2&&(n3=this.saveTextToParentTag(n3,i2,s2));let a13=s2.substring(s2.lastIndexOf(".")+1);if(r4&&this.options.unpairedTags.indexOf(r4)!==-1)throw Error(`Unpaired tag can not be used as closing tag: </${r4}>`);let l3=0;a13&&this.options.unpairedTags.indexOf(a13)!==-1?(l3=s2.lastIndexOf(".",s2.lastIndexOf(".")-1),this.tagsNodeStack.pop()):l3=s2.lastIndexOf("."),s2=s2.substring(0,l3),i2=this.tagsNodeStack.pop(),n3="",o2=e3}else if(t3[o2+1]==="?"){let e3=X(t3,o2,!1,"?>");if(!e3)throw Error("Pi Tag is not closed.");if(n3=this.saveTextToParentTag(n3,i2,s2),this.options.ignoreDeclaration&&e3.tagName==="?xml"||this.options.ignorePiTags);else{let t4=new y(e3.tagName);t4.add(this.options.textNodeName,""),e3.tagName!==e3.tagExp&&e3.attrExpPresent&&(t4[":@"]=this.buildAttributesMap(e3.tagExp,s2)),this.addChild(i2,t4,s2,o2)}o2=e3.closeIndex+1}else if(t3.substr(o2+1,3)==="!--"){let e3=G(t3,"-->",o2+4,"Comment is not closed.");if(this.options.commentPropName){let r4=t3.substring(o2+4,e3-2);n3=this.saveTextToParentTag(n3,i2,s2),i2.add(this.options.commentPropName,[{[this.options.textNodeName]:r4}])}o2=e3}else if(t3.substr(o2+1,2)==="!D"){let e3=r3.readDocType(t3,o2);this.docTypeEntities=e3.entities,o2=e3.i}else if(t3.substr(o2+1,2)==="!["){let e3=G(t3,"]]>",o2,"CDATA is not closed.")-2,r4=t3.substring(o2+9,e3);n3=this.saveTextToParentTag(n3,i2,s2);let a13=this.parseTextData(r4,i2.tagname,s2,!0,!1,!0,!0);a13==null&&(a13=""),this.options.cdataPropName?i2.add(this.options.cdataPropName,[{[this.options.textNodeName]:r4}]):i2.add(this.options.textNodeName,a13),o2=e3+2}else{let r4=X(t3,o2,this.options.removeNSPrefix),a13=r4.tagName,l3=r4.rawTagName,u2=r4.tagExp,h2=r4.attrExpPresent,d2=r4.closeIndex;if(this.options.transformTagName){let t4=this.options.transformTagName(a13);u2===a13&&(u2=t4),a13=t4}i2&&n3&&i2.tagname!=="!xml"&&(n3=this.saveTextToParentTag(n3,i2,s2,!1));let p2=i2;p2&&this.options.unpairedTags.indexOf(p2.tagname)!==-1&&(i2=this.tagsNodeStack.pop(),s2=s2.substring(0,s2.lastIndexOf("."))),a13!==e2.tagname&&(s2+=s2?"."+a13:a13);let f2=o2;if(this.isItStopNode(this.stopNodesExact,this.stopNodesWildcard,s2,a13)){let e3="";if(u2.length>0&&u2.lastIndexOf("/")===u2.length-1)a13[a13.length-1]==="/"?(a13=a13.substr(0,a13.length-1),s2=s2.substr(0,s2.length-1),u2=a13):u2=u2.substr(0,u2.length-1),o2=r4.closeIndex;else if(this.options.unpairedTags.indexOf(a13)!==-1)o2=r4.closeIndex;else{let i3=this.readStopNodeData(t3,l3,d2+1);if(!i3)throw Error(`Unexpected end of ${l3}`);o2=i3.i,e3=i3.tagContent}let n4=new y(a13);a13!==u2&&h2&&(n4[":@"]=this.buildAttributesMap(u2,s2)),e3&&(e3=this.parseTextData(e3,a13,s2,!0,h2,!0,!0)),s2=s2.substr(0,s2.lastIndexOf(".")),n4.add(this.options.textNodeName,e3),this.addChild(i2,n4,s2,f2)}else{if(u2.length>0&&u2.lastIndexOf("/")===u2.length-1){if(a13[a13.length-1]==="/"?(a13=a13.substr(0,a13.length-1),s2=s2.substr(0,s2.length-1),u2=a13):u2=u2.substr(0,u2.length-1),this.options.transformTagName){let t5=this.options.transformTagName(a13);u2===a13&&(u2=t5),a13=t5}let t4=new y(a13);a13!==u2&&h2&&(t4[":@"]=this.buildAttributesMap(u2,s2)),this.addChild(i2,t4,s2,f2),s2=s2.substr(0,s2.lastIndexOf("."))}else{let t4=new y(a13);this.tagsNodeStack.push(i2),a13!==u2&&h2&&(t4[":@"]=this.buildAttributesMap(u2,s2)),this.addChild(i2,t4,s2,f2),i2=t4}n3="",o2=d2}}else n3+=t3[o2];return e2.child};function U(t3,e2,i2,n3){this.options.captureMetaData||(n3=void 0);let s2=this.options.updateTag(e2.tagname,i2,e2[":@"]);s2===!1||(typeof s2=="string"?(e2.tagname=s2,t3.addChild(e2,n3)):t3.addChild(e2,n3))}let B=function(t3){if(this.options.processEntities){for(let e2 in this.docTypeEntities){let i2=this.docTypeEntities[e2];t3=t3.replace(i2.regx,i2.val)}for(let e2 in this.lastEntities){let i2=this.lastEntities[e2];t3=t3.replace(i2.regex,i2.val)}if(this.options.htmlEntities)for(let e2 in this.htmlEntities){let i2=this.htmlEntities[e2];t3=t3.replace(i2.regex,i2.val)}t3=t3.replace(this.ampEntity.regex,this.ampEntity.val)}return t3};function R(t3,e2,i2,n3){return t3&&(n3===void 0&&(n3=e2.child.length===0),(t3=this.parseTextData(t3,e2.tagname,i2,!1,!!e2[":@"]&&Object.keys(e2[":@"]).length!==0,n3))!==void 0&&t3!==""&&e2.add(this.options.textNodeName,t3),t3=""),t3}function Y2(t3,e2,i2,n3){return!(!e2||!e2.has(n3))||!(!t3||!t3.has(i2))}function G(t3,e2,i2,n3){let s2=t3.indexOf(e2,i2);if(s2===-1)throw Error(n3);return s2+e2.length-1}function X(t3,e2,i2,n3=">"){let s2=function(t4,e3,i3=">"){let n4,s3="";for(let r4=e3;r4<t4.length;r4++){let e4=t4[r4];if(n4)e4===n4&&(n4="");else if(e4==='"'||e4==="'")n4=e4;else if(e4===i3[0]){if(!i3[1])return{data:s3,index:r4};if(t4[r4+1]===i3[1])return{data:s3,index:r4}}else e4==="\t"&&(e4=" ");s3+=e4}}(t3,e2+1,n3);if(!s2)return;let{data:r3,index:o2}=s2,a13=r3.search(/\s/),l3=r3,u2=!0;a13!==-1&&(l3=r3.substring(0,a13),r3=r3.substring(a13+1).trimStart());let h2=l3;if(i2){let t4=l3.indexOf(":");t4!==-1&&(l3=l3.substr(t4+1),u2=l3!==s2.data.substr(t4+1))}return{tagName:l3,tagExp:r3,closeIndex:o2,attrExpPresent:u2,rawTagName:h2}}function W(t3,e2,i2){let n3=i2,s2=1;for(;i2<t3.length;i2++)if(t3[i2]==="<")if(t3[i2+1]==="/"){let r3=G(t3,">",i2,`${e2} is not closed`);if(t3.substring(i2+2,r3).trim()===e2&&(s2--,s2===0))return{tagContent:t3.substring(n3,i2),i:r3};i2=r3}else if(t3[i2+1]==="?")i2=G(t3,"?>",i2+1,"StopNode is not closed.");else if(t3.substr(i2+1,3)==="!--")i2=G(t3,"-->",i2+3,"StopNode is not closed.");else if(t3.substr(i2+1,2)==="![")i2=G(t3,"]]>",i2,"StopNode is not closed.")-2;else{let n4=X(t3,i2,">");n4&&((n4&&n4.tagName)===e2&&n4.tagExp[n4.tagExp.length-1]!=="/"&&s2++,i2=n4.closeIndex)}}function q(t3,e2,i2){if(e2&&typeof t3=="string"){let e3=t3.trim();return e3==="true"||e3!=="false"&&function(t4,e4={}){if(e4=Object.assign({},C,e4),!t4||typeof t4!="string")return t4;let i3=t4.trim();if(e4.skipLike!==void 0&&e4.skipLike.test(i3))return t4;if(t4==="0")return 0;if(e4.hex&&A.test(i3))return function(t5){if(parseInt)return parseInt(t5,16);if(Number.parseInt)return Number.parseInt(t5,16);if(window&&window.parseInt)return window.parseInt(t5,16);throw Error("parseInt, Number.parseInt, window.parseInt are not supported")}(i3);if(i3.search(/.+[eE].+/)!==-1)return function(t5,e5,i4){if(!i4.eNotation)return t5;let n4=e5.match(V);if(n4){let s2=n4[1]||"",r3=n4[3].indexOf("e")===-1?"E":"e",o2=n4[2],a13=s2?t5[o2.length+1]===r3:t5[o2.length]===r3;return o2.length>1&&a13?t5:o2.length!==1||!n4[3].startsWith(`.${r3}`)&&n4[3][0]!==r3?i4.leadingZeros&&!a13?(e5=(n4[1]||"")+n4[3],Number(e5)):t5:Number(e5)}return t5}(t4,i3,e4);{let s2=S.exec(i3);if(s2){let r3=s2[1]||"",o2=s2[2],a13=(n3=s2[3])&&n3.indexOf(".")!==-1?((n3=n3.replace(/0+$/,""))==="."?n3="0":n3[0]==="."?n3="0"+n3:n3[n3.length-1]==="."&&(n3=n3.substring(0,n3.length-1)),n3):n3,l3=r3?t4[o2.length+1]===".":t4[o2.length]===".";if(!e4.leadingZeros&&(o2.length>1||o2.length===1&&!l3))return t4;{let n4=Number(i3),s3=String(n4);if(n4===0||n4===-0)return n4;if(s3.search(/[eE]/)!==-1)return e4.eNotation?n4:t4;if(i3.indexOf(".")!==-1)return s3==="0"||s3===a13||s3===`${r3}${a13}`?n4:t4;let l4=o2?a13:i3;return o2?l4===s3||r3+l4===s3?n4:t4:l4===s3||l4===r3+s3?n4:t4}}return t4}var n3}(t3,i2)}return t3!==void 0?t3:""}function Z(t3,e2,i2){let n3=Number.parseInt(t3,e2);return n3>=0&&n3<=1114111?String.fromCodePoint(n3):i2+t3+";"}let K2=y.getMetaDataSymbol();function Q(t3,e2){return z(t3,e2)}function z(t3,e2,i2){let n3,s2={};for(let r3=0;r3<t3.length;r3++){let o2=t3[r3],a13=J(o2),l3="";if(l3=i2===void 0?a13:i2+"."+a13,a13===e2.textNodeName)n3===void 0?n3=o2[a13]:n3+=""+o2[a13];else{if(a13===void 0)continue;if(o2[a13]){let t4=z(o2[a13],e2,l3),i3=tt(t4,e2);o2[K2]!==void 0&&(t4[K2]=o2[K2]),o2[":@"]?H(t4,o2[":@"],l3,e2):Object.keys(t4).length!==1||t4[e2.textNodeName]===void 0||e2.alwaysCreateTextNode?Object.keys(t4).length===0&&(e2.alwaysCreateTextNode?t4[e2.textNodeName]="":t4=""):t4=t4[e2.textNodeName],s2[a13]!==void 0&&s2.hasOwnProperty(a13)?(Array.isArray(s2[a13])||(s2[a13]=[s2[a13]]),s2[a13].push(t4)):e2.isArray(a13,l3,i3)?s2[a13]=[t4]:s2[a13]=t4}}}return typeof n3=="string"?n3.length>0&&(s2[e2.textNodeName]=n3):n3!==void 0&&(s2[e2.textNodeName]=n3),s2}function J(t3){let e2=Object.keys(t3);for(let t4=0;t4<e2.length;t4++){let i2=e2[t4];if(i2!==":@")return i2}}function H(t3,e2,i2,n3){if(e2){let s2=Object.keys(e2),r3=s2.length;for(let o2=0;o2<r3;o2++){let r4=s2[o2];n3.isArray(r4,i2+"."+r4,!0,!0)?t3[r4]=[e2[r4]]:t3[r4]=e2[r4]}}}function tt(t3,e2){let{textNodeName:i2}=e2,n3=Object.keys(t3).length;return n3===0||!(n3!==1||!t3[i2]&&typeof t3[i2]!="boolean"&&t3[i2]!==0)}class et{constructor(t3){this.externalEntities={},this.options=function(t4){return Object.assign({},v,t4)}(t3)}parse(t3,e2){if(typeof t3!="string"&&t3.toString)t3=t3.toString();else if(typeof t3!="string")throw Error("XML data is accepted in String or Bytes[] form.");if(e2){e2===!0&&(e2={});let i3=a12(t3,e2);if(i3!==!0)throw Error(`${i3.err.msg}:${i3.err.line}:${i3.err.col}`)}let i2=new D(this.options);i2.addExternalEntities(this.externalEntities);let n3=i2.parseXml(t3);return this.options.preserveOrder||n3===void 0?n3:Q(n3,this.options)}addEntity(t3,e2){if(e2.indexOf("&")!==-1)throw Error("Entity value can't have '&'");if(t3.indexOf("&")!==-1||t3.indexOf(";")!==-1)throw Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(e2==="&")throw Error("An entity with value '&' is not permitted");this.externalEntities[t3]=e2}static getMetaDataSymbol(){return y.getMetaDataSymbol()}}function it(t3,e2){let i2="";return e2.format&&e2.indentBy.length>0&&(i2=`
`),nt(t3,e2,"",i2)}function nt(t3,e2,i2,n3){let s2="",r3=!1;for(let o2=0;o2<t3.length;o2++){let a13=t3[o2],l3=st(a13);if(l3===void 0)continue;let u2="";if(u2=i2.length===0?l3:`${i2}.${l3}`,l3===e2.textNodeName){let t4=a13[l3];ot(u2,e2)||(t4=e2.tagValueProcessor(l3,t4),t4=at(t4,e2)),r3&&(s2+=n3),s2+=t4,r3=!1;continue}if(l3===e2.cdataPropName){r3&&(s2+=n3),s2+=`<![CDATA[${a13[l3][0][e2.textNodeName]}]]>`,r3=!1;continue}if(l3===e2.commentPropName){s2+=n3+`<!--${a13[l3][0][e2.textNodeName]}-->`,r3=!0;continue}if(l3[0]==="?"){let t4=rt(a13[":@"],e2),i3=l3==="?xml"?"":n3,o3=a13[l3][0][e2.textNodeName];o3=o3.length!==0?" "+o3:"",s2+=i3+`<${l3}${o3}${t4}?>`,r3=!0;continue}let h2=n3;h2!==""&&(h2+=e2.indentBy);let d2=n3+`<${l3}${rt(a13[":@"],e2)}`,p2=nt(a13[l3],e2,u2,h2);e2.unpairedTags.indexOf(l3)!==-1?e2.suppressUnpairedNode?s2+=d2+">":s2+=d2+"/>":p2&&p2.length!==0||!e2.suppressEmptyNode?p2&&p2.endsWith(">")?s2+=d2+`>${p2}${n3}</${l3}>`:(s2+=d2+">",p2&&n3!==""&&(p2.includes("/>")||p2.includes("</"))?s2+=n3+e2.indentBy+p2+n3:s2+=p2,s2+=`</${l3}>`):s2+=d2+"/>",r3=!0}return s2}function st(t3){let e2=Object.keys(t3);for(let i2=0;i2<e2.length;i2++){let n3=e2[i2];if(t3.hasOwnProperty(n3)&&n3!==":@")return n3}}function rt(t3,e2){let i2="";if(t3&&!e2.ignoreAttributes)for(let n3 in t3){if(!t3.hasOwnProperty(n3))continue;let s2=e2.attributeValueProcessor(n3,t3[n3]);s2=at(s2,e2),s2===!0&&e2.suppressBooleanAttributes?i2+=` ${n3.substr(e2.attributeNamePrefix.length)}`:i2+=` ${n3.substr(e2.attributeNamePrefix.length)}="${s2}"`}return i2}function ot(t3,e2){let i2=(t3=t3.substr(0,t3.length-e2.textNodeName.length-1)).substr(t3.lastIndexOf(".")+1);for(let n3 in e2.stopNodes)if(e2.stopNodes[n3]===t3||e2.stopNodes[n3]==="*."+i2)return!0;return!1}function at(t3,e2){if(t3&&t3.length>0&&e2.processEntities)for(let i2=0;i2<e2.entities.length;i2++){let n3=e2.entities[i2];t3=t3.replace(n3.regex,n3.val)}return t3}let lt2={attributeNamePrefix:"@_",attributesGroupName:!1,textNodeName:"#text",ignoreAttributes:!0,cdataPropName:!1,format:!1,indentBy:"  ",suppressEmptyNode:!1,suppressUnpairedNode:!0,suppressBooleanAttributes:!0,tagValueProcessor:function(t3,e2){return e2},attributeValueProcessor:function(t3,e2){return e2},preserveOrder:!1,commentPropName:!1,unpairedTags:[],entities:[{regex:new RegExp("&","g"),val:"&amp;"},{regex:new RegExp(">","g"),val:"&gt;"},{regex:new RegExp("<","g"),val:"&lt;"},{regex:new RegExp("'","g"),val:"&apos;"},{regex:new RegExp('"',"g"),val:"&quot;"}],processEntities:!0,stopNodes:[],oneListGroup:!1};function ut(t3){this.options=Object.assign({},lt2,t3),this.options.ignoreAttributes===!0||this.options.attributesGroupName?this.isAttribute=function(){return!1}:(this.ignoreAttributesFn=$2(this.options.ignoreAttributes),this.attrPrefixLen=this.options.attributeNamePrefix.length,this.isAttribute=pt),this.processTextOrObjNode=ht,this.options.format?(this.indentate=dt,this.tagEndChar=`>
`,this.newLine=`
`):(this.indentate=function(){return""},this.tagEndChar=">",this.newLine="")}function ht(t3,e2,i2,n3){let s2=this.j2x(t3,i2+1,n3.concat(e2));return t3[this.options.textNodeName]!==void 0&&Object.keys(t3).length===1?this.buildTextValNode(t3[this.options.textNodeName],e2,s2.attrStr,i2):this.buildObjectNode(s2.val,e2,s2.attrStr,i2)}function dt(t3){return this.options.indentBy.repeat(t3)}function pt(t3){return!(!t3.startsWith(this.options.attributeNamePrefix)||t3===this.options.textNodeName)&&t3.substr(this.attrPrefixLen)}ut.prototype.build=function(t3){return this.options.preserveOrder?it(t3,this.options):(Array.isArray(t3)&&this.options.arrayNodeName&&this.options.arrayNodeName.length>1&&(t3={[this.options.arrayNodeName]:t3}),this.j2x(t3,0,[]).val)},ut.prototype.j2x=function(t3,e2,i2){let n3="",s2="",r3=i2.join(".");for(let o2 in t3)if(Object.prototype.hasOwnProperty.call(t3,o2))if(t3[o2]===void 0)this.isAttribute(o2)&&(s2+="");else if(t3[o2]===null)this.isAttribute(o2)||o2===this.options.cdataPropName?s2+="":o2[0]==="?"?s2+=this.indentate(e2)+"<"+o2+"?"+this.tagEndChar:s2+=this.indentate(e2)+"<"+o2+"/"+this.tagEndChar;else if(t3[o2]instanceof Date)s2+=this.buildTextValNode(t3[o2],o2,"",e2);else if(typeof t3[o2]!="object"){let i3=this.isAttribute(o2);if(i3&&!this.ignoreAttributesFn(i3,r3))n3+=this.buildAttrPairStr(i3,""+t3[o2]);else if(!i3)if(o2===this.options.textNodeName){let e3=this.options.tagValueProcessor(o2,""+t3[o2]);s2+=this.replaceEntitiesValue(e3)}else s2+=this.buildTextValNode(t3[o2],o2,"",e2)}else if(Array.isArray(t3[o2])){let n4=t3[o2].length,r4="",a13="";for(let l3=0;l3<n4;l3++){let n5=t3[o2][l3];if(n5===void 0);else if(n5===null)o2[0]==="?"?s2+=this.indentate(e2)+"<"+o2+"?"+this.tagEndChar:s2+=this.indentate(e2)+"<"+o2+"/"+this.tagEndChar;else if(typeof n5=="object")if(this.options.oneListGroup){let t4=this.j2x(n5,e2+1,i2.concat(o2));r4+=t4.val,this.options.attributesGroupName&&n5.hasOwnProperty(this.options.attributesGroupName)&&(a13+=t4.attrStr)}else r4+=this.processTextOrObjNode(n5,o2,e2,i2);else if(this.options.oneListGroup){let t4=this.options.tagValueProcessor(o2,n5);t4=this.replaceEntitiesValue(t4),r4+=t4}else r4+=this.buildTextValNode(n5,o2,"",e2)}this.options.oneListGroup&&(r4=this.buildObjectNode(r4,o2,a13,e2)),s2+=r4}else if(this.options.attributesGroupName&&o2===this.options.attributesGroupName){let e3=Object.keys(t3[o2]),i3=e3.length;for(let s3=0;s3<i3;s3++)n3+=this.buildAttrPairStr(e3[s3],""+t3[o2][e3[s3]])}else s2+=this.processTextOrObjNode(t3[o2],o2,e2,i2);return{attrStr:n3,val:s2}},ut.prototype.buildAttrPairStr=function(t3,e2){return e2=this.options.attributeValueProcessor(t3,""+e2),e2=this.replaceEntitiesValue(e2),this.options.suppressBooleanAttributes&&e2==="true"?" "+t3:" "+t3+'="'+e2+'"'},ut.prototype.buildObjectNode=function(t3,e2,i2,n3){if(t3==="")return e2[0]==="?"?this.indentate(n3)+"<"+e2+i2+"?"+this.tagEndChar:this.indentate(n3)+"<"+e2+i2+this.closeTag(e2)+this.tagEndChar;{let s2="</"+e2+this.tagEndChar,r3="";return e2[0]==="?"&&(r3="?",s2=""),!i2&&i2!==""||t3.indexOf("<")!==-1?this.options.commentPropName!==!1&&e2===this.options.commentPropName&&r3.length===0?this.indentate(n3)+`<!--${t3}-->`+this.newLine:this.indentate(n3)+"<"+e2+i2+r3+this.tagEndChar+t3+this.indentate(n3)+s2:this.indentate(n3)+"<"+e2+i2+r3+">"+t3+s2}},ut.prototype.closeTag=function(t3){let e2="";return this.options.unpairedTags.indexOf(t3)!==-1?this.options.suppressUnpairedNode||(e2="/"):e2=this.options.suppressEmptyNode?"/":`></${t3}`,e2},ut.prototype.buildTextValNode=function(t3,e2,i2,n3){if(this.options.cdataPropName!==!1&&e2===this.options.cdataPropName)return this.indentate(n3)+`<![CDATA[${t3}]]>`+this.newLine;if(this.options.commentPropName!==!1&&e2===this.options.commentPropName)return this.indentate(n3)+`<!--${t3}-->`+this.newLine;if(e2[0]==="?")return this.indentate(n3)+"<"+e2+i2+"?"+this.tagEndChar;{let s2=this.options.tagValueProcessor(e2,t3);return s2=this.replaceEntitiesValue(s2),s2===""?this.indentate(n3)+"<"+e2+i2+this.closeTag(e2)+this.tagEndChar:this.indentate(n3)+"<"+e2+i2+">"+s2+"</"+e2+this.tagEndChar}},ut.prototype.replaceEntitiesValue=function(t3){if(t3&&t3.length>0&&this.options.processEntities)for(let e2=0;e2<this.options.entities.length;e2++){let i2=this.options.entities[e2];t3=t3.replace(i2.regex,i2.val)}return t3};let ft={validate:a12};module.exports=e})()});var require_xml_parser=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.parseXML=parseXML;var fast_xml_parser_1=require_fxp(),parser=new fast_xml_parser_1.XMLParser({attributeNamePrefix:"",htmlEntities:!0,ignoreAttributes:!1,ignoreDeclaration:!0,parseTagValue:!1,trimValues:!1,tagValueProcessor:(_2,val)=>val.trim()===""&&val.includes(`
`)?"":void 0});parser.addEntity("#xD","\r");parser.addEntity("#10",`
`);function parseXML(xmlString){return parser.parse(xmlString,!0)}});var require_dist_cjs22=__commonJS((exports)=>{var xmlParser=require_xml_parser();function escapeAttribute(value){return value.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function escapeElement(value){return value.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&apos;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\r/g,"&#x0D;").replace(/\n/g,"&#x0A;").replace(/\u0085/g,"&#x85;").replace(/\u2028/,"&#x2028;")}class XmlText{value;constructor(value){this.value=value}toString(){return escapeElement(""+this.value)}}class XmlNode{name;children;attributes={};static of(name,childText,withName){let node=new XmlNode(name);if(childText!==void 0)node.addChildNode(new XmlText(childText));if(withName!==void 0)node.withName(withName);return node}constructor(name,children=[]){this.name=name,this.children=children}withName(name){return this.name=name,this}addAttribute(name,value){return this.attributes[name]=value,this}addChildNode(child){return this.children.push(child),this}removeAttribute(name){return delete this.attributes[name],this}n(name){return this.name=name,this}c(child){return this.children.push(child),this}a(name,value){if(value!=null)this.attributes[name]=value;return this}cc(input,field,withName=field){if(input[field]!=null){let node=XmlNode.of(field,input[field]).withName(withName);this.c(node)}}l(input,listName,memberName,valueProvider){if(input[listName]!=null)valueProvider().map((node)=>{node.withName(memberName),this.c(node)})}lc(input,listName,memberName,valueProvider){if(input[listName]!=null){let nodes=valueProvider(),containerNode=new XmlNode(memberName);nodes.map((node)=>{containerNode.c(node)}),this.c(containerNode)}}toString(){let hasChildren=Boolean(this.children.length),xmlText=`<${this.name}`,attributes=this.attributes;for(let attributeName of Object.keys(attributes)){let attribute=attributes[attributeName];if(attribute!=null)xmlText+=` ${attributeName}="${escapeAttribute(""+attribute)}"`}return xmlText+=!hasChildren?"/>":`>${this.children.map((c)=>c.toString()).join("")}</${this.name}>`}}Object.defineProperty(exports,"parseXML",{enumerable:!0,get:function(){return xmlParser.parseXML}});exports.XmlNode=XmlNode;exports.XmlText=XmlText});var require_dist_cjs23=__commonJS((exports)=>{var protocolHttp=require_dist_cjs2(),core2=require_dist_cjs16(),propertyProvider=require_dist_cjs17(),client=require_client(),signatureV4=require_dist_cjs18(),cbor=require_cbor(),schema=require_schema(),smithyClient=require_dist_cjs21(),protocols=require_protocols(),serde=require_serde(),utilBase64=require_dist_cjs8(),utilUtf8=require_dist_cjs7(),xmlBuilder=require_dist_cjs22(),state={warningEmitted:!1},emitWarningIfUnsupportedVersion=(version2)=>{if(version2&&!state.warningEmitted&&parseInt(version2.substring(1,version2.indexOf(".")))<20)state.warningEmitted=!0,process.emitWarning(`NodeDeprecationWarning: The AWS SDK for JavaScript (v3) will
no longer support Node.js ${version2} in January 2026.

To continue receiving updates to AWS services, bug fixes, and security
updates please upgrade to a supported Node.js LTS version.

More information can be found at: https://a.co/c895JFp`)};function setCredentialFeature(credentials,feature,value){if(!credentials.$source)credentials.$source={};return credentials.$source[feature]=value,credentials}function setFeature(context,feature,value){if(!context.__aws_sdk_context)context.__aws_sdk_context={features:{}};else if(!context.__aws_sdk_context.features)context.__aws_sdk_context.features={};context.__aws_sdk_context.features[feature]=value}function setTokenFeature(token,feature,value){if(!token.$source)token.$source={};return token.$source[feature]=value,token}var getDateHeader=(response)=>protocolHttp.HttpResponse.isInstance(response)?response.headers?.date??response.headers?.Date:void 0,getSkewCorrectedDate=(systemClockOffset)=>new Date(Date.now()+systemClockOffset),isClockSkewed=(clockTime,systemClockOffset)=>Math.abs(getSkewCorrectedDate(systemClockOffset).getTime()-clockTime)>=300000,getUpdatedSystemClockOffset=(clockTime,currentSystemClockOffset)=>{let clockTimeInMs=Date.parse(clockTime);if(isClockSkewed(clockTimeInMs,currentSystemClockOffset))return clockTimeInMs-Date.now();return currentSystemClockOffset},throwSigningPropertyError=(name,property)=>{if(!property)throw Error(`Property \`${name}\` is not resolved for AWS SDK SigV4Auth`);return property},validateSigningProperties=async(signingProperties)=>{let context=throwSigningPropertyError("context",signingProperties.context),config=throwSigningPropertyError("config",signingProperties.config),authScheme=context.endpointV2?.properties?.authSchemes?.[0],signer=await throwSigningPropertyError("signer",config.signer)(authScheme),signingRegion=signingProperties?.signingRegion,signingRegionSet=signingProperties?.signingRegionSet,signingName=signingProperties?.signingName;return{config,signer,signingRegion,signingRegionSet,signingName}};class AwsSdkSigV4Signer{async sign(httpRequest,identity,signingProperties){if(!protocolHttp.HttpRequest.isInstance(httpRequest))throw Error("The request is not an instance of `HttpRequest` and cannot be signed");let validatedProps=await validateSigningProperties(signingProperties),{config,signer}=validatedProps,{signingRegion,signingName}=validatedProps,handlerExecutionContext=signingProperties.context;if(handlerExecutionContext?.authSchemes?.length??!1){let[first,second]=handlerExecutionContext.authSchemes;if(first?.name==="sigv4a"&&second?.name==="sigv4")signingRegion=second?.signingRegion??signingRegion,signingName=second?.signingName??signingName}return await signer.sign(httpRequest,{signingDate:getSkewCorrectedDate(config.systemClockOffset),signingRegion,signingService:signingName})}errorHandler(signingProperties){return(error)=>{let serverTime=error.ServerTime??getDateHeader(error.$response);if(serverTime){let config=throwSigningPropertyError("config",signingProperties.config),initialSystemClockOffset=config.systemClockOffset;if(config.systemClockOffset=getUpdatedSystemClockOffset(serverTime,config.systemClockOffset),config.systemClockOffset!==initialSystemClockOffset&&error.$metadata)error.$metadata.clockSkewCorrected=!0}throw error}}successHandler(httpResponse,signingProperties){let dateHeader=getDateHeader(httpResponse);if(dateHeader){let config=throwSigningPropertyError("config",signingProperties.config);config.systemClockOffset=getUpdatedSystemClockOffset(dateHeader,config.systemClockOffset)}}}var AWSSDKSigV4Signer=AwsSdkSigV4Signer;class AwsSdkSigV4ASigner extends AwsSdkSigV4Signer{async sign(httpRequest,identity,signingProperties){if(!protocolHttp.HttpRequest.isInstance(httpRequest))throw Error("The request is not an instance of `HttpRequest` and cannot be signed");let{config,signer,signingRegion,signingRegionSet,signingName}=await validateSigningProperties(signingProperties),multiRegionOverride=(await config.sigv4aSigningRegionSet?.()??signingRegionSet??[signingRegion]).join(",");return await signer.sign(httpRequest,{signingDate:getSkewCorrectedDate(config.systemClockOffset),signingRegion:multiRegionOverride,signingService:signingName})}}var getArrayForCommaSeparatedString=(str)=>typeof str==="string"&&str.length>0?str.split(",").map((item)=>item.trim()):[],getBearerTokenEnvKey=(signingName)=>`AWS_BEARER_TOKEN_${signingName.replace(/[\s-]/g,"_").toUpperCase()}`,NODE_AUTH_SCHEME_PREFERENCE_ENV_KEY="AWS_AUTH_SCHEME_PREFERENCE",NODE_AUTH_SCHEME_PREFERENCE_CONFIG_KEY="auth_scheme_preference",NODE_AUTH_SCHEME_PREFERENCE_OPTIONS={environmentVariableSelector:(env3,options)=>{if(options?.signingName){if(getBearerTokenEnvKey(options.signingName)in env3)return["httpBearerAuth"]}if(!(NODE_AUTH_SCHEME_PREFERENCE_ENV_KEY in env3))return;return getArrayForCommaSeparatedString(env3[NODE_AUTH_SCHEME_PREFERENCE_ENV_KEY])},configFileSelector:(profile)=>{if(!(NODE_AUTH_SCHEME_PREFERENCE_CONFIG_KEY in profile))return;return getArrayForCommaSeparatedString(profile[NODE_AUTH_SCHEME_PREFERENCE_CONFIG_KEY])},default:[]},resolveAwsSdkSigV4AConfig=(config)=>{return config.sigv4aSigningRegionSet=core2.normalizeProvider(config.sigv4aSigningRegionSet),config},NODE_SIGV4A_CONFIG_OPTIONS={environmentVariableSelector(env3){if(env3.AWS_SIGV4A_SIGNING_REGION_SET)return env3.AWS_SIGV4A_SIGNING_REGION_SET.split(",").map((_2)=>_2.trim());throw new propertyProvider.ProviderError("AWS_SIGV4A_SIGNING_REGION_SET not set in env.",{tryNextLink:!0})},configFileSelector(profile){if(profile.sigv4a_signing_region_set)return(profile.sigv4a_signing_region_set??"").split(",").map((_2)=>_2.trim());throw new propertyProvider.ProviderError("sigv4a_signing_region_set not set in profile.",{tryNextLink:!0})},default:void 0},resolveAwsSdkSigV4Config=(config)=>{let inputCredentials=config.credentials,isUserSupplied=!!config.credentials,resolvedCredentials=void 0;Object.defineProperty(config,"credentials",{set(credentials){if(credentials&&credentials!==inputCredentials&&credentials!==resolvedCredentials)isUserSupplied=!0;inputCredentials=credentials;let memoizedProvider=normalizeCredentialProvider(config,{credentials:inputCredentials,credentialDefaultProvider:config.credentialDefaultProvider}),boundProvider=bindCallerConfig(config,memoizedProvider);if(isUserSupplied&&!boundProvider.attributed){let isCredentialObject=typeof inputCredentials==="object"&&inputCredentials!==null;resolvedCredentials=async(options)=>{let attributedCreds=await boundProvider(options);if(isCredentialObject&&(!attributedCreds.$source||Object.keys(attributedCreds.$source).length===0))return client.setCredentialFeature(attributedCreds,"CREDENTIALS_CODE","e");return attributedCreds},resolvedCredentials.memoized=boundProvider.memoized,resolvedCredentials.configBound=boundProvider.configBound,resolvedCredentials.attributed=!0}else resolvedCredentials=boundProvider},get(){return resolvedCredentials},enumerable:!0,configurable:!0}),config.credentials=inputCredentials;let{signingEscapePath=!0,systemClockOffset=config.systemClockOffset||0,sha256:sha2562}=config,signer;if(config.signer)signer=core2.normalizeProvider(config.signer);else if(config.regionInfoProvider)signer=()=>core2.normalizeProvider(config.region)().then(async(region)=>[await config.regionInfoProvider(region,{useFipsEndpoint:await config.useFipsEndpoint(),useDualstackEndpoint:await config.useDualstackEndpoint()})||{},region]).then(([regionInfo,region])=>{let{signingRegion,signingService}=regionInfo;config.signingRegion=config.signingRegion||signingRegion||region,config.signingName=config.signingName||signingService||config.serviceId;let params={...config,credentials:config.credentials,region:config.signingRegion,service:config.signingName,sha256:sha2562,uriEscapePath:signingEscapePath};return new(config.signerConstructor||signatureV4.SignatureV4)(params)});else signer=async(authScheme)=>{authScheme=Object.assign({},{name:"sigv4",signingName:config.signingName||config.defaultSigningName,signingRegion:await core2.normalizeProvider(config.region)(),properties:{}},authScheme);let{signingRegion,signingName:signingService}=authScheme;config.signingRegion=config.signingRegion||signingRegion,config.signingName=config.signingName||signingService||config.serviceId;let params={...config,credentials:config.credentials,region:config.signingRegion,service:config.signingName,sha256:sha2562,uriEscapePath:signingEscapePath};return new(config.signerConstructor||signatureV4.SignatureV4)(params)};return Object.assign(config,{systemClockOffset,signingEscapePath,signer})},resolveAWSSDKSigV4Config=resolveAwsSdkSigV4Config;function normalizeCredentialProvider(config,{credentials,credentialDefaultProvider}){let credentialsProvider;if(credentials)if(!credentials?.memoized)credentialsProvider=core2.memoizeIdentityProvider(credentials,core2.isIdentityExpired,core2.doesIdentityRequireRefresh);else credentialsProvider=credentials;else if(credentialDefaultProvider)credentialsProvider=core2.normalizeProvider(credentialDefaultProvider(Object.assign({},config,{parentClientConfig:config})));else credentialsProvider=async()=>{throw Error("@aws-sdk/core::resolveAwsSdkSigV4Config - `credentials` not provided and no credentialDefaultProvider was configured.")};return credentialsProvider.memoized=!0,credentialsProvider}function bindCallerConfig(config,credentialsProvider){if(credentialsProvider.configBound)return credentialsProvider;let fn=async(options)=>credentialsProvider({...options,callerClientConfig:config});return fn.memoized=credentialsProvider.memoized,fn.configBound=!0,fn}class ProtocolLib{queryCompat;constructor(queryCompat=!1){this.queryCompat=queryCompat}resolveRestContentType(defaultContentType,inputSchema){let members=inputSchema.getMemberSchemas(),httpPayloadMember=Object.values(members).find((m2)=>{return!!m2.getMergedTraits().httpPayload});if(httpPayloadMember){let mediaType=httpPayloadMember.getMergedTraits().mediaType;if(mediaType)return mediaType;else if(httpPayloadMember.isStringSchema())return"text/plain";else if(httpPayloadMember.isBlobSchema())return"application/octet-stream";else return defaultContentType}else if(!inputSchema.isUnitSchema()){if(Object.values(members).find((m2)=>{let{httpQuery,httpQueryParams,httpHeader,httpLabel,httpPrefixHeaders}=m2.getMergedTraits();return!httpQuery&&!httpQueryParams&&!httpHeader&&!httpLabel&&httpPrefixHeaders===void 0}))return defaultContentType}}async getErrorSchemaOrThrowBaseException(errorIdentifier,defaultNamespace,response,dataObject,metadata,getErrorSchema){let namespace=defaultNamespace,errorName=errorIdentifier;if(errorIdentifier.includes("#"))[namespace,errorName]=errorIdentifier.split("#");let errorMetadata={$metadata:metadata,$fault:response.statusCode<500?"client":"server"},registry=schema.TypeRegistry.for(namespace);try{return{errorSchema:getErrorSchema?.(registry,errorName)??registry.getSchema(errorIdentifier),errorMetadata}}catch(e){dataObject.message=dataObject.message??dataObject.Message??"UnknownError";let synthetic=schema.TypeRegistry.for("smithy.ts.sdk.synthetic."+namespace),baseExceptionSchema=synthetic.getBaseException();if(baseExceptionSchema){let ErrorCtor=synthetic.getErrorCtor(baseExceptionSchema)??Error;throw this.decorateServiceException(Object.assign(new ErrorCtor({name:errorName}),errorMetadata),dataObject)}throw this.decorateServiceException(Object.assign(Error(errorName),errorMetadata),dataObject)}}decorateServiceException(exception,additions={}){if(this.queryCompat){let msg=exception.Message??additions.Message,error=smithyClient.decorateServiceException(exception,additions);if(msg)error.message=msg;error.Error={...error.Error,Type:error.Error.Type,Code:error.Error.Code,Message:error.Error.message??error.Error.Message??msg};let reqId=error.$metadata.requestId;if(reqId)error.RequestId=reqId;return error}return smithyClient.decorateServiceException(exception,additions)}setQueryCompatError(output,response){let queryErrorHeader=response.headers?.["x-amzn-query-error"];if(output!==void 0&&queryErrorHeader!=null){let[Code,Type3]=queryErrorHeader.split(";"),entries=Object.entries(output),Error2={Code,Type:Type3};Object.assign(output,Error2);for(let[k2,v]of entries)Error2[k2==="message"?"Message":k2]=v;delete Error2.__type,output.Error=Error2}}queryCompatOutput(queryCompatErrorData,errorData){if(queryCompatErrorData.Error)errorData.Error=queryCompatErrorData.Error;if(queryCompatErrorData.Type)errorData.Type=queryCompatErrorData.Type;if(queryCompatErrorData.Code)errorData.Code=queryCompatErrorData.Code}findQueryCompatibleError(registry,errorName){try{return registry.getSchema(errorName)}catch(e){return registry.find((schema$1)=>schema.NormalizedSchema.of(schema$1).getMergedTraits().awsQueryError?.[0]===errorName)}}}class AwsSmithyRpcV2CborProtocol extends cbor.SmithyRpcV2CborProtocol{awsQueryCompatible;mixin;constructor({defaultNamespace,awsQueryCompatible}){super({defaultNamespace});this.awsQueryCompatible=!!awsQueryCompatible,this.mixin=new ProtocolLib(this.awsQueryCompatible)}async serializeRequest(operationSchema,input,context){let request=await super.serializeRequest(operationSchema,input,context);if(this.awsQueryCompatible)request.headers["x-amzn-query-mode"]="true";return request}async handleError(operationSchema,context,response,dataObject,metadata){if(this.awsQueryCompatible)this.mixin.setQueryCompatError(dataObject,response);let errorName=(()=>{let compatHeader=response.headers["x-amzn-query-error"];if(compatHeader&&this.awsQueryCompatible)return compatHeader.split(";")[0];return cbor.loadSmithyRpcV2CborErrorCode(response,dataObject)??"Unknown"})(),{errorSchema,errorMetadata}=await this.mixin.getErrorSchemaOrThrowBaseException(errorName,this.options.defaultNamespace,response,dataObject,metadata,this.awsQueryCompatible?this.mixin.findQueryCompatibleError:void 0),ns=schema.NormalizedSchema.of(errorSchema),message=dataObject.message??dataObject.Message??"Unknown",exception=new(schema.TypeRegistry.for(errorSchema[1]).getErrorCtor(errorSchema)??Error)(message),output={};for(let[name,member]of ns.structIterator())if(dataObject[name]!=null)output[name]=this.deserializer.readValue(member,dataObject[name]);if(this.awsQueryCompatible)this.mixin.queryCompatOutput(dataObject,output);throw this.mixin.decorateServiceException(Object.assign(exception,errorMetadata,{$fault:ns.getMergedTraits().error,message},output),dataObject)}}var _toStr=(val)=>{if(val==null)return val;if(typeof val==="number"||typeof val==="bigint"){let warning=Error(`Received number ${val} where a string was expected.`);return warning.name="Warning",console.warn(warning),String(val)}if(typeof val==="boolean"){let warning=Error(`Received boolean ${val} where a string was expected.`);return warning.name="Warning",console.warn(warning),String(val)}return val},_toBool=(val)=>{if(val==null)return val;if(typeof val==="string"){let lowercase=val.toLowerCase();if(val!==""&&lowercase!=="false"&&lowercase!=="true"){let warning=Error(`Received string "${val}" where a boolean was expected.`);warning.name="Warning",console.warn(warning)}return val!==""&&lowercase!=="false"}return val},_toNum=(val)=>{if(val==null)return val;if(typeof val==="string"){let num=Number(val);if(num.toString()!==val){let warning=Error(`Received string "${val}" where a number was expected.`);return warning.name="Warning",console.warn(warning),val}return num}return val};class SerdeContextConfig{serdeContext;setSerdeContext(serdeContext){this.serdeContext=serdeContext}}class UnionSerde{from;to;keys;constructor(from,to){this.from=from,this.to=to,this.keys=new Set(Object.keys(this.from).filter((k2)=>k2!=="__type"))}mark(key){this.keys.delete(key)}hasUnknown(){return this.keys.size===1&&Object.keys(this.to).length===0}writeUnknown(){if(this.hasUnknown()){let k2=this.keys.values().next().value,v=this.from[k2];this.to.$unknown=[k2,v]}}}function jsonReviver(key,value,context){if(context?.source){let numericString=context.source;if(typeof value==="number"){if(value>Number.MAX_SAFE_INTEGER||value<Number.MIN_SAFE_INTEGER||numericString!==String(value))if(numericString.includes("."))return new serde.NumericValue(numericString,"bigDecimal");else return BigInt(numericString)}}return value}var collectBodyString=(streamBody,context)=>smithyClient.collectBody(streamBody,context).then((body)=>(context?.utf8Encoder??utilUtf8.toUtf8)(body)),parseJsonBody=(streamBody,context)=>collectBodyString(streamBody,context).then((encoded)=>{if(encoded.length)try{return JSON.parse(encoded)}catch(e){if(e?.name==="SyntaxError")Object.defineProperty(e,"$responseBodyText",{value:encoded});throw e}return{}}),parseJsonErrorBody=async(errorBody,context)=>{let value=await parseJsonBody(errorBody,context);return value.message=value.message??value.Message,value},loadRestJsonErrorCode=(output,data)=>{let findKey=(object,key)=>Object.keys(object).find((k2)=>k2.toLowerCase()===key.toLowerCase()),sanitizeErrorCode=(rawValue)=>{let cleanValue=rawValue;if(typeof cleanValue==="number")cleanValue=cleanValue.toString();if(cleanValue.indexOf(",")>=0)cleanValue=cleanValue.split(",")[0];if(cleanValue.indexOf(":")>=0)cleanValue=cleanValue.split(":")[0];if(cleanValue.indexOf("#")>=0)cleanValue=cleanValue.split("#")[1];return cleanValue},headerKey=findKey(output.headers,"x-amzn-errortype");if(headerKey!==void 0)return sanitizeErrorCode(output.headers[headerKey]);if(data&&typeof data==="object"){let codeKey=findKey(data,"code");if(codeKey&&data[codeKey]!==void 0)return sanitizeErrorCode(data[codeKey]);if(data.__type!==void 0)return sanitizeErrorCode(data.__type)}};class JsonShapeDeserializer extends SerdeContextConfig{settings;constructor(settings){super();this.settings=settings}async read(schema2,data){return this._read(schema2,typeof data==="string"?JSON.parse(data,jsonReviver):await parseJsonBody(data,this.serdeContext))}readObject(schema2,data){return this._read(schema2,data)}_read(schema$1,value){let isObject3=value!==null&&typeof value==="object",ns=schema.NormalizedSchema.of(schema$1);if(isObject3){if(ns.isStructSchema()){let record=value,union2=ns.isUnionSchema(),out={},nameMap=void 0,{jsonName}=this.settings;if(jsonName)nameMap={};let unionSerde;if(union2)unionSerde=new UnionSerde(record,out);for(let[memberName,memberSchema]of ns.structIterator()){let fromKey=memberName;if(jsonName)fromKey=memberSchema.getMergedTraits().jsonName??fromKey,nameMap[fromKey]=memberName;if(union2)unionSerde.mark(fromKey);if(record[fromKey]!=null)out[memberName]=this._read(memberSchema,record[fromKey])}if(union2)unionSerde.writeUnknown();else if(typeof record.__type==="string")for(let[k2,v]of Object.entries(record)){let t2=jsonName?nameMap[k2]??k2:k2;if(!(t2 in out))out[t2]=v}return out}if(Array.isArray(value)&&ns.isListSchema()){let listMember=ns.getValueSchema(),out=[],sparse=!!ns.getMergedTraits().sparse;for(let item of value)if(sparse||item!=null)out.push(this._read(listMember,item));return out}if(ns.isMapSchema()){let mapMember=ns.getValueSchema(),out={},sparse=!!ns.getMergedTraits().sparse;for(let[_k,_v]of Object.entries(value))if(sparse||_v!=null)out[_k]=this._read(mapMember,_v);return out}}if(ns.isBlobSchema()&&typeof value==="string")return utilBase64.fromBase64(value);let mediaType=ns.getMergedTraits().mediaType;if(ns.isStringSchema()&&typeof value==="string"&&mediaType){if(mediaType==="application/json"||mediaType.endsWith("+json"))return serde.LazyJsonString.from(value);return value}if(ns.isTimestampSchema()&&value!=null)switch(protocols.determineTimestampFormat(ns,this.settings)){case 5:return serde.parseRfc3339DateTimeWithOffset(value);case 6:return serde.parseRfc7231DateTime(value);case 7:return serde.parseEpochTimestamp(value);default:return console.warn("Missing timestamp format, parsing value with Date constructor:",value),new Date(value)}if(ns.isBigIntegerSchema()&&(typeof value==="number"||typeof value==="string"))return BigInt(value);if(ns.isBigDecimalSchema()&&value!=null){if(value instanceof serde.NumericValue)return value;let untyped=value;if(untyped.type==="bigDecimal"&&"string"in untyped)return new serde.NumericValue(untyped.string,untyped.type);return new serde.NumericValue(String(value),"bigDecimal")}if(ns.isNumericSchema()&&typeof value==="string"){switch(value){case"Infinity":return 1/0;case"-Infinity":return-1/0;case"NaN":return NaN}return value}if(ns.isDocumentSchema())if(isObject3){let out=Array.isArray(value)?[]:{};for(let[k2,v]of Object.entries(value))if(v instanceof serde.NumericValue)out[k2]=v;else out[k2]=this._read(ns,v);return out}else return structuredClone(value);return value}}var NUMERIC_CONTROL_CHAR=String.fromCharCode(925);class JsonReplacer{values=new Map;counter=0;stage=0;createReplacer(){if(this.stage===1)throw Error("@aws-sdk/core/protocols - JsonReplacer already created.");if(this.stage===2)throw Error("@aws-sdk/core/protocols - JsonReplacer exhausted.");return this.stage=1,(key,value)=>{if(value instanceof serde.NumericValue){let v=`${NUMERIC_CONTROL_CHAR+"nv"+this.counter++}_`+value.string;return this.values.set(`"${v}"`,value.string),v}if(typeof value==="bigint"){let s=value.toString(),v=`${NUMERIC_CONTROL_CHAR+"b"+this.counter++}_`+s;return this.values.set(`"${v}"`,s),v}return value}}replaceInJson(json2){if(this.stage===0)throw Error("@aws-sdk/core/protocols - JsonReplacer not created yet.");if(this.stage===2)throw Error("@aws-sdk/core/protocols - JsonReplacer exhausted.");if(this.stage=2,this.counter===0)return json2;for(let[key,value]of this.values)json2=json2.replace(key,value);return json2}}class JsonShapeSerializer extends SerdeContextConfig{settings;buffer;useReplacer=!1;rootSchema;constructor(settings){super();this.settings=settings}write(schema$1,value){this.rootSchema=schema.NormalizedSchema.of(schema$1),this.buffer=this._write(this.rootSchema,value)}writeDiscriminatedDocument(schema$1,value){if(this.write(schema$1,value),typeof this.buffer==="object")this.buffer.__type=schema.NormalizedSchema.of(schema$1).getName(!0)}flush(){let{rootSchema,useReplacer}=this;if(this.rootSchema=void 0,this.useReplacer=!1,rootSchema?.isStructSchema()||rootSchema?.isDocumentSchema()){if(!useReplacer)return JSON.stringify(this.buffer);let replacer=new JsonReplacer;return replacer.replaceInJson(JSON.stringify(this.buffer,replacer.createReplacer(),0))}return this.buffer}_write(schema$1,value,container){let isObject3=value!==null&&typeof value==="object",ns=schema.NormalizedSchema.of(schema$1);if(isObject3){if(ns.isStructSchema()){let record=value,out={},{jsonName}=this.settings,nameMap=void 0;if(jsonName)nameMap={};for(let[memberName,memberSchema]of ns.structIterator()){let serializableValue=this._write(memberSchema,record[memberName],ns);if(serializableValue!==void 0){let targetKey=memberName;if(jsonName)targetKey=memberSchema.getMergedTraits().jsonName??memberName,nameMap[memberName]=targetKey;out[targetKey]=serializableValue}}if(ns.isUnionSchema()&&Object.keys(out).length===0){let{$unknown}=record;if(Array.isArray($unknown)){let[k2,v]=$unknown;out[k2]=this._write(15,v)}}else if(typeof record.__type==="string")for(let[k2,v]of Object.entries(record)){let targetKey=jsonName?nameMap[k2]??k2:k2;if(!(targetKey in out))out[targetKey]=this._write(15,v)}return out}if(Array.isArray(value)&&ns.isListSchema()){let listMember=ns.getValueSchema(),out=[],sparse=!!ns.getMergedTraits().sparse;for(let item of value)if(sparse||item!=null)out.push(this._write(listMember,item));return out}if(ns.isMapSchema()){let mapMember=ns.getValueSchema(),out={},sparse=!!ns.getMergedTraits().sparse;for(let[_k,_v]of Object.entries(value))if(sparse||_v!=null)out[_k]=this._write(mapMember,_v);return out}if(value instanceof Uint8Array&&(ns.isBlobSchema()||ns.isDocumentSchema())){if(ns===this.rootSchema)return value;return(this.serdeContext?.base64Encoder??utilBase64.toBase64)(value)}if(value instanceof Date&&(ns.isTimestampSchema()||ns.isDocumentSchema()))switch(protocols.determineTimestampFormat(ns,this.settings)){case 5:return value.toISOString().replace(".000Z","Z");case 6:return serde.dateToUtcString(value);case 7:return value.getTime()/1000;default:return console.warn("Missing timestamp format, using epoch seconds",value),value.getTime()/1000}if(value instanceof serde.NumericValue)this.useReplacer=!0}if(value===null&&container?.isStructSchema())return;if(ns.isStringSchema()){if(typeof value>"u"&&ns.isIdempotencyToken())return serde.generateIdempotencyToken();let mediaType=ns.getMergedTraits().mediaType;if(value!=null&&mediaType){if(mediaType==="application/json"||mediaType.endsWith("+json"))return serde.LazyJsonString.from(value)}return value}if(typeof value==="number"&&ns.isNumericSchema()){if(Math.abs(value)===1/0||isNaN(value))return String(value);return value}if(typeof value==="string"&&ns.isBlobSchema()){if(ns===this.rootSchema)return value;return(this.serdeContext?.base64Encoder??utilBase64.toBase64)(value)}if(typeof value==="bigint")this.useReplacer=!0;if(ns.isDocumentSchema())if(isObject3){let out=Array.isArray(value)?[]:{};for(let[k2,v]of Object.entries(value))if(v instanceof serde.NumericValue)this.useReplacer=!0,out[k2]=v;else out[k2]=this._write(ns,v);return out}else return structuredClone(value);return value}}class JsonCodec extends SerdeContextConfig{settings;constructor(settings){super();this.settings=settings}createSerializer(){let serializer=new JsonShapeSerializer(this.settings);return serializer.setSerdeContext(this.serdeContext),serializer}createDeserializer(){let deserializer=new JsonShapeDeserializer(this.settings);return deserializer.setSerdeContext(this.serdeContext),deserializer}}class AwsJsonRpcProtocol extends protocols.RpcProtocol{serializer;deserializer;serviceTarget;codec;mixin;awsQueryCompatible;constructor({defaultNamespace,serviceTarget,awsQueryCompatible,jsonCodec}){super({defaultNamespace});this.serviceTarget=serviceTarget,this.codec=jsonCodec??new JsonCodec({timestampFormat:{useTrait:!0,default:7},jsonName:!1}),this.serializer=this.codec.createSerializer(),this.deserializer=this.codec.createDeserializer(),this.awsQueryCompatible=!!awsQueryCompatible,this.mixin=new ProtocolLib(this.awsQueryCompatible)}async serializeRequest(operationSchema,input,context){let request=await super.serializeRequest(operationSchema,input,context);if(!request.path.endsWith("/"))request.path+="/";if(Object.assign(request.headers,{"content-type":`application/x-amz-json-${this.getJsonRpcVersion()}`,"x-amz-target":`${this.serviceTarget}.${operationSchema.name}`}),this.awsQueryCompatible)request.headers["x-amzn-query-mode"]="true";if(schema.deref(operationSchema.input)==="unit"||!request.body)request.body="{}";return request}getPayloadCodec(){return this.codec}async handleError(operationSchema,context,response,dataObject,metadata){if(this.awsQueryCompatible)this.mixin.setQueryCompatError(dataObject,response);let errorIdentifier=loadRestJsonErrorCode(response,dataObject)??"Unknown",{errorSchema,errorMetadata}=await this.mixin.getErrorSchemaOrThrowBaseException(errorIdentifier,this.options.defaultNamespace,response,dataObject,metadata,this.awsQueryCompatible?this.mixin.findQueryCompatibleError:void 0),ns=schema.NormalizedSchema.of(errorSchema),message=dataObject.message??dataObject.Message??"Unknown",exception=new(schema.TypeRegistry.for(errorSchema[1]).getErrorCtor(errorSchema)??Error)(message),output={};for(let[name,member]of ns.structIterator())if(dataObject[name]!=null)output[name]=this.codec.createDeserializer().readObject(member,dataObject[name]);if(this.awsQueryCompatible)this.mixin.queryCompatOutput(dataObject,output);throw this.mixin.decorateServiceException(Object.assign(exception,errorMetadata,{$fault:ns.getMergedTraits().error,message},output),dataObject)}}class AwsJson1_0Protocol extends AwsJsonRpcProtocol{constructor({defaultNamespace,serviceTarget,awsQueryCompatible,jsonCodec}){super({defaultNamespace,serviceTarget,awsQueryCompatible,jsonCodec})}getShapeId(){return"aws.protocols#awsJson1_0"}getJsonRpcVersion(){return"1.0"}getDefaultContentType(){return"application/x-amz-json-1.0"}}class AwsJson1_1Protocol extends AwsJsonRpcProtocol{constructor({defaultNamespace,serviceTarget,awsQueryCompatible,jsonCodec}){super({defaultNamespace,serviceTarget,awsQueryCompatible,jsonCodec})}getShapeId(){return"aws.protocols#awsJson1_1"}getJsonRpcVersion(){return"1.1"}getDefaultContentType(){return"application/x-amz-json-1.1"}}class AwsRestJsonProtocol extends protocols.HttpBindingProtocol{serializer;deserializer;codec;mixin=new ProtocolLib;constructor({defaultNamespace}){super({defaultNamespace});let settings={timestampFormat:{useTrait:!0,default:7},httpBindings:!0,jsonName:!0};this.codec=new JsonCodec(settings),this.serializer=new protocols.HttpInterceptingShapeSerializer(this.codec.createSerializer(),settings),this.deserializer=new protocols.HttpInterceptingShapeDeserializer(this.codec.createDeserializer(),settings)}getShapeId(){return"aws.protocols#restJson1"}getPayloadCodec(){return this.codec}setSerdeContext(serdeContext){this.codec.setSerdeContext(serdeContext),super.setSerdeContext(serdeContext)}async serializeRequest(operationSchema,input,context){let request=await super.serializeRequest(operationSchema,input,context),inputSchema=schema.NormalizedSchema.of(operationSchema.input);if(!request.headers["content-type"]){let contentType=this.mixin.resolveRestContentType(this.getDefaultContentType(),inputSchema);if(contentType)request.headers["content-type"]=contentType}if(request.body==null&&request.headers["content-type"]===this.getDefaultContentType())request.body="{}";return request}async deserializeResponse(operationSchema,context,response){let output=await super.deserializeResponse(operationSchema,context,response),outputSchema=schema.NormalizedSchema.of(operationSchema.output);for(let[name,member]of outputSchema.structIterator())if(member.getMemberTraits().httpPayload&&!(name in output))output[name]=null;return output}async handleError(operationSchema,context,response,dataObject,metadata){let errorIdentifier=loadRestJsonErrorCode(response,dataObject)??"Unknown",{errorSchema,errorMetadata}=await this.mixin.getErrorSchemaOrThrowBaseException(errorIdentifier,this.options.defaultNamespace,response,dataObject,metadata),ns=schema.NormalizedSchema.of(errorSchema),message=dataObject.message??dataObject.Message??"Unknown",exception=new(schema.TypeRegistry.for(errorSchema[1]).getErrorCtor(errorSchema)??Error)(message);await this.deserializeHttpMessage(errorSchema,context,response,dataObject);let output={};for(let[name,member]of ns.structIterator()){let target=member.getMergedTraits().jsonName??name;output[name]=this.codec.createDeserializer().readObject(member,dataObject[target])}throw this.mixin.decorateServiceException(Object.assign(exception,errorMetadata,{$fault:ns.getMergedTraits().error,message},output),dataObject)}getDefaultContentType(){return"application/json"}}var awsExpectUnion=(value)=>{if(value==null)return;if(typeof value==="object"&&"__type"in value)delete value.__type;return smithyClient.expectUnion(value)};class XmlShapeDeserializer extends SerdeContextConfig{settings;stringDeserializer;constructor(settings){super();this.settings=settings,this.stringDeserializer=new protocols.FromStringShapeDeserializer(settings)}setSerdeContext(serdeContext){this.serdeContext=serdeContext,this.stringDeserializer.setSerdeContext(serdeContext)}read(schema$1,bytes,key){let ns=schema.NormalizedSchema.of(schema$1),memberSchemas=ns.getMemberSchemas();if(ns.isStructSchema()&&ns.isMemberSchema()&&!!Object.values(memberSchemas).find((memberNs)=>{return!!memberNs.getMemberTraits().eventPayload})){let output={},memberName=Object.keys(memberSchemas)[0];if(memberSchemas[memberName].isBlobSchema())output[memberName]=bytes;else output[memberName]=this.read(memberSchemas[memberName],bytes);return output}let xmlString=(this.serdeContext?.utf8Encoder??utilUtf8.toUtf8)(bytes),parsedObject=this.parseXml(xmlString);return this.readSchema(schema$1,key?parsedObject[key]:parsedObject)}readSchema(_schema,value){let ns=schema.NormalizedSchema.of(_schema);if(ns.isUnitSchema())return;let traits=ns.getMergedTraits();if(ns.isListSchema()&&!Array.isArray(value))return this.readSchema(ns,[value]);if(value==null)return value;if(typeof value==="object"){let sparse=!!traits.sparse,flat=!!traits.xmlFlattened;if(ns.isListSchema()){let listValue=ns.getValueSchema(),buffer3=[],sourceKey=listValue.getMergedTraits().xmlName??"member",source=flat?value:(value[0]??value)[sourceKey],sourceArray=Array.isArray(source)?source:[source];for(let v of sourceArray)if(v!=null||sparse)buffer3.push(this.readSchema(listValue,v));return buffer3}let buffer2={};if(ns.isMapSchema()){let keyNs=ns.getKeySchema(),memberNs=ns.getValueSchema(),entries;if(flat)entries=Array.isArray(value)?value:[value];else entries=Array.isArray(value.entry)?value.entry:[value.entry];let keyProperty=keyNs.getMergedTraits().xmlName??"key",valueProperty=memberNs.getMergedTraits().xmlName??"value";for(let entry of entries){let key=entry[keyProperty],value2=entry[valueProperty];if(value2!=null||sparse)buffer2[key]=this.readSchema(memberNs,value2)}return buffer2}if(ns.isStructSchema()){let union2=ns.isUnionSchema(),unionSerde;if(union2)unionSerde=new UnionSerde(value,buffer2);for(let[memberName,memberSchema]of ns.structIterator()){let memberTraits=memberSchema.getMergedTraits(),xmlObjectKey=!memberTraits.httpPayload?memberSchema.getMemberTraits().xmlName??memberName:memberTraits.xmlName??memberSchema.getName();if(union2)unionSerde.mark(xmlObjectKey);if(value[xmlObjectKey]!=null)buffer2[memberName]=this.readSchema(memberSchema,value[xmlObjectKey])}if(union2)unionSerde.writeUnknown();return buffer2}if(ns.isDocumentSchema())return value;throw Error(`@aws-sdk/core/protocols - xml deserializer unhandled schema type for ${ns.getName(!0)}`)}if(ns.isListSchema())return[];if(ns.isMapSchema()||ns.isStructSchema())return{};return this.stringDeserializer.read(ns,value)}parseXml(xml){if(xml.length){let parsedObj;try{parsedObj=xmlBuilder.parseXML(xml)}catch(e){if(e&&typeof e==="object")Object.defineProperty(e,"$responseBodyText",{value:xml});throw e}let textNodeName="#text",key=Object.keys(parsedObj)[0],parsedObjToReturn=parsedObj[key];if(parsedObjToReturn[textNodeName])parsedObjToReturn[key]=parsedObjToReturn[textNodeName],delete parsedObjToReturn[textNodeName];return smithyClient.getValueFromTextNode(parsedObjToReturn)}return{}}}class QueryShapeSerializer extends SerdeContextConfig{settings;buffer;constructor(settings){super();this.settings=settings}write(schema$1,value,prefix=""){if(this.buffer===void 0)this.buffer="";let ns=schema.NormalizedSchema.of(schema$1);if(prefix&&!prefix.endsWith("."))prefix+=".";if(ns.isBlobSchema()){if(typeof value==="string"||value instanceof Uint8Array)this.writeKey(prefix),this.writeValue((this.serdeContext?.base64Encoder??utilBase64.toBase64)(value))}else if(ns.isBooleanSchema()||ns.isNumericSchema()||ns.isStringSchema()){if(value!=null)this.writeKey(prefix),this.writeValue(String(value));else if(ns.isIdempotencyToken())this.writeKey(prefix),this.writeValue(serde.generateIdempotencyToken())}else if(ns.isBigIntegerSchema()){if(value!=null)this.writeKey(prefix),this.writeValue(String(value))}else if(ns.isBigDecimalSchema()){if(value!=null)this.writeKey(prefix),this.writeValue(value instanceof serde.NumericValue?value.string:String(value))}else if(ns.isTimestampSchema()){if(value instanceof Date)switch(this.writeKey(prefix),protocols.determineTimestampFormat(ns,this.settings)){case 5:this.writeValue(value.toISOString().replace(".000Z","Z"));break;case 6:this.writeValue(smithyClient.dateToUtcString(value));break;case 7:this.writeValue(String(value.getTime()/1000));break}}else if(ns.isDocumentSchema())if(Array.isArray(value))this.write(79,value,prefix);else if(value instanceof Date)this.write(4,value,prefix);else if(value instanceof Uint8Array)this.write(21,value,prefix);else if(value&&typeof value==="object")this.write(143,value,prefix);else this.writeKey(prefix),this.writeValue(String(value));else if(ns.isListSchema()){if(Array.isArray(value))if(value.length===0){if(this.settings.serializeEmptyLists)this.writeKey(prefix),this.writeValue("")}else{let member=ns.getValueSchema(),flat=this.settings.flattenLists||ns.getMergedTraits().xmlFlattened,i=1;for(let item of value){if(item==null)continue;let suffix=this.getKey("member",member.getMergedTraits().xmlName),key=flat?`${prefix}${i}`:`${prefix}${suffix}.${i}`;this.write(member,item,key),++i}}}else if(ns.isMapSchema()){if(value&&typeof value==="object"){let keySchema=ns.getKeySchema(),memberSchema=ns.getValueSchema(),flat=ns.getMergedTraits().xmlFlattened,i=1;for(let[k2,v]of Object.entries(value)){if(v==null)continue;let keySuffix=this.getKey("key",keySchema.getMergedTraits().xmlName),key=flat?`${prefix}${i}.${keySuffix}`:`${prefix}entry.${i}.${keySuffix}`,valueSuffix=this.getKey("value",memberSchema.getMergedTraits().xmlName),valueKey=flat?`${prefix}${i}.${valueSuffix}`:`${prefix}entry.${i}.${valueSuffix}`;this.write(keySchema,k2,key),this.write(memberSchema,v,valueKey),++i}}}else if(ns.isStructSchema()){if(value&&typeof value==="object"){let didWriteMember=!1;for(let[memberName,member]of ns.structIterator()){if(value[memberName]==null&&!member.isIdempotencyToken())continue;let suffix=this.getKey(memberName,member.getMergedTraits().xmlName),key=`${prefix}${suffix}`;this.write(member,value[memberName],key),didWriteMember=!0}if(!didWriteMember&&ns.isUnionSchema()){let{$unknown}=value;if(Array.isArray($unknown)){let[k2,v]=$unknown,key=`${prefix}${k2}`;this.write(15,v,key)}}}}else if(ns.isUnitSchema());else throw Error(`@aws-sdk/core/protocols - QuerySerializer unrecognized schema type ${ns.getName(!0)}`)}flush(){if(this.buffer===void 0)throw Error("@aws-sdk/core/protocols - QuerySerializer cannot flush with nothing written to buffer.");let str=this.buffer;return delete this.buffer,str}getKey(memberName,xmlName){let key=xmlName??memberName;if(this.settings.capitalizeKeys)return key[0].toUpperCase()+key.slice(1);return key}writeKey(key){if(key.endsWith("."))key=key.slice(0,key.length-1);this.buffer+=`&${protocols.extendedEncodeURIComponent(key)}=`}writeValue(value){this.buffer+=protocols.extendedEncodeURIComponent(value)}}class AwsQueryProtocol extends protocols.RpcProtocol{options;serializer;deserializer;mixin=new ProtocolLib;constructor(options){super({defaultNamespace:options.defaultNamespace});this.options=options;let settings={timestampFormat:{useTrait:!0,default:5},httpBindings:!1,xmlNamespace:options.xmlNamespace,serviceNamespace:options.defaultNamespace,serializeEmptyLists:!0};this.serializer=new QueryShapeSerializer(settings),this.deserializer=new XmlShapeDeserializer(settings)}getShapeId(){return"aws.protocols#awsQuery"}setSerdeContext(serdeContext){this.serializer.setSerdeContext(serdeContext),this.deserializer.setSerdeContext(serdeContext)}getPayloadCodec(){throw Error("AWSQuery protocol has no payload codec.")}async serializeRequest(operationSchema,input,context){let request=await super.serializeRequest(operationSchema,input,context);if(!request.path.endsWith("/"))request.path+="/";if(Object.assign(request.headers,{"content-type":"application/x-www-form-urlencoded"}),schema.deref(operationSchema.input)==="unit"||!request.body)request.body="";let action=operationSchema.name.split("#")[1]??operationSchema.name;if(request.body=`Action=${action}&Version=${this.options.version}`+request.body,request.body.endsWith("&"))request.body=request.body.slice(-1);return request}async deserializeResponse(operationSchema,context,response){let deserializer=this.deserializer,ns=schema.NormalizedSchema.of(operationSchema.output),dataObject={};if(response.statusCode>=300){let bytes2=await protocols.collectBody(response.body,context);if(bytes2.byteLength>0)Object.assign(dataObject,await deserializer.read(15,bytes2));await this.handleError(operationSchema,context,response,dataObject,this.deserializeMetadata(response))}for(let header in response.headers){let value=response.headers[header];delete response.headers[header],response.headers[header.toLowerCase()]=value}let shortName=operationSchema.name.split("#")[1]??operationSchema.name,awsQueryResultKey=ns.isStructSchema()&&this.useNestedResult()?shortName+"Result":void 0,bytes=await protocols.collectBody(response.body,context);if(bytes.byteLength>0)Object.assign(dataObject,await deserializer.read(ns,bytes,awsQueryResultKey));return{$metadata:this.deserializeMetadata(response),...dataObject}}useNestedResult(){return!0}async handleError(operationSchema,context,response,dataObject,metadata){let errorIdentifier=this.loadQueryErrorCode(response,dataObject)??"Unknown",errorData=this.loadQueryError(dataObject),message=this.loadQueryErrorMessage(dataObject);errorData.message=message,errorData.Error={Type:errorData.Type,Code:errorData.Code,Message:message};let{errorSchema,errorMetadata}=await this.mixin.getErrorSchemaOrThrowBaseException(errorIdentifier,this.options.defaultNamespace,response,errorData,metadata,this.mixin.findQueryCompatibleError),ns=schema.NormalizedSchema.of(errorSchema),exception=new(schema.TypeRegistry.for(errorSchema[1]).getErrorCtor(errorSchema)??Error)(message),output={Type:errorData.Error.Type,Code:errorData.Error.Code,Error:errorData.Error};for(let[name,member]of ns.structIterator()){let target=member.getMergedTraits().xmlName??name,value=errorData[target]??dataObject[target];output[name]=this.deserializer.readSchema(member,value)}throw this.mixin.decorateServiceException(Object.assign(exception,errorMetadata,{$fault:ns.getMergedTraits().error,message},output),dataObject)}loadQueryErrorCode(output,data){let code=(data.Errors?.[0]?.Error??data.Errors?.Error??data.Error)?.Code;if(code!==void 0)return code;if(output.statusCode==404)return"NotFound"}loadQueryError(data){return data.Errors?.[0]?.Error??data.Errors?.Error??data.Error}loadQueryErrorMessage(data){let errorData=this.loadQueryError(data);return errorData?.message??errorData?.Message??data.message??data.Message??"Unknown"}getDefaultContentType(){return"application/x-www-form-urlencoded"}}class AwsEc2QueryProtocol extends AwsQueryProtocol{options;constructor(options){super(options);this.options=options;let ec2Settings={capitalizeKeys:!0,flattenLists:!0,serializeEmptyLists:!1};Object.assign(this.serializer.settings,ec2Settings)}useNestedResult(){return!1}}var parseXmlBody=(streamBody,context)=>collectBodyString(streamBody,context).then((encoded)=>{if(encoded.length){let parsedObj;try{parsedObj=xmlBuilder.parseXML(encoded)}catch(e){if(e&&typeof e==="object")Object.defineProperty(e,"$responseBodyText",{value:encoded});throw e}let textNodeName="#text",key=Object.keys(parsedObj)[0],parsedObjToReturn=parsedObj[key];if(parsedObjToReturn[textNodeName])parsedObjToReturn[key]=parsedObjToReturn[textNodeName],delete parsedObjToReturn[textNodeName];return smithyClient.getValueFromTextNode(parsedObjToReturn)}return{}}),parseXmlErrorBody=async(errorBody,context)=>{let value=await parseXmlBody(errorBody,context);if(value.Error)value.Error.message=value.Error.message??value.Error.Message;return value},loadRestXmlErrorCode=(output,data)=>{if(data?.Error?.Code!==void 0)return data.Error.Code;if(data?.Code!==void 0)return data.Code;if(output.statusCode==404)return"NotFound"};class XmlShapeSerializer extends SerdeContextConfig{settings;stringBuffer;byteBuffer;buffer;constructor(settings){super();this.settings=settings}write(schema$1,value){let ns=schema.NormalizedSchema.of(schema$1);if(ns.isStringSchema()&&typeof value==="string")this.stringBuffer=value;else if(ns.isBlobSchema())this.byteBuffer="byteLength"in value?value:(this.serdeContext?.base64Decoder??utilBase64.fromBase64)(value);else{this.buffer=this.writeStruct(ns,value,void 0);let traits=ns.getMergedTraits();if(traits.httpPayload&&!traits.xmlName)this.buffer.withName(ns.getName())}}flush(){if(this.byteBuffer!==void 0){let bytes=this.byteBuffer;return delete this.byteBuffer,bytes}if(this.stringBuffer!==void 0){let str=this.stringBuffer;return delete this.stringBuffer,str}let buffer2=this.buffer;if(this.settings.xmlNamespace){if(!buffer2?.attributes?.xmlns)buffer2.addAttribute("xmlns",this.settings.xmlNamespace)}return delete this.buffer,buffer2.toString()}writeStruct(ns,value,parentXmlns){let traits=ns.getMergedTraits(),name=ns.isMemberSchema()&&!traits.httpPayload?ns.getMemberTraits().xmlName??ns.getMemberName():traits.xmlName??ns.getName();if(!name||!ns.isStructSchema())throw Error(`@aws-sdk/core/protocols - xml serializer, cannot write struct with empty name or non-struct, schema=${ns.getName(!0)}.`);let structXmlNode=xmlBuilder.XmlNode.of(name),[xmlnsAttr,xmlns]=this.getXmlnsAttribute(ns,parentXmlns);for(let[memberName,memberSchema]of ns.structIterator()){let val=value[memberName];if(val!=null||memberSchema.isIdempotencyToken()){if(memberSchema.getMergedTraits().xmlAttribute){structXmlNode.addAttribute(memberSchema.getMergedTraits().xmlName??memberName,this.writeSimple(memberSchema,val));continue}if(memberSchema.isListSchema())this.writeList(memberSchema,val,structXmlNode,xmlns);else if(memberSchema.isMapSchema())this.writeMap(memberSchema,val,structXmlNode,xmlns);else if(memberSchema.isStructSchema())structXmlNode.addChildNode(this.writeStruct(memberSchema,val,xmlns));else{let memberNode=xmlBuilder.XmlNode.of(memberSchema.getMergedTraits().xmlName??memberSchema.getMemberName());this.writeSimpleInto(memberSchema,val,memberNode,xmlns),structXmlNode.addChildNode(memberNode)}}}let{$unknown}=value;if($unknown&&ns.isUnionSchema()&&Array.isArray($unknown)&&Object.keys(value).length===1){let[k2,v]=$unknown,node=xmlBuilder.XmlNode.of(k2);if(typeof v!=="string")if(value instanceof xmlBuilder.XmlNode||value instanceof xmlBuilder.XmlText)structXmlNode.addChildNode(value);else throw Error("@aws-sdk - $unknown union member in XML requires value of type string, @aws-sdk/xml-builder::XmlNode or XmlText.");this.writeSimpleInto(0,v,node,xmlns),structXmlNode.addChildNode(node)}if(xmlns)structXmlNode.addAttribute(xmlnsAttr,xmlns);return structXmlNode}writeList(listMember,array,container,parentXmlns){if(!listMember.isMemberSchema())throw Error(`@aws-sdk/core/protocols - xml serializer, cannot write non-member list: ${listMember.getName(!0)}`);let listTraits=listMember.getMergedTraits(),listValueSchema=listMember.getValueSchema(),listValueTraits=listValueSchema.getMergedTraits(),sparse=!!listValueTraits.sparse,flat=!!listTraits.xmlFlattened,[xmlnsAttr,xmlns]=this.getXmlnsAttribute(listMember,parentXmlns),writeItem=(container2,value)=>{if(listValueSchema.isListSchema())this.writeList(listValueSchema,Array.isArray(value)?value:[value],container2,xmlns);else if(listValueSchema.isMapSchema())this.writeMap(listValueSchema,value,container2,xmlns);else if(listValueSchema.isStructSchema()){let struct=this.writeStruct(listValueSchema,value,xmlns);container2.addChildNode(struct.withName(flat?listTraits.xmlName??listMember.getMemberName():listValueTraits.xmlName??"member"))}else{let listItemNode=xmlBuilder.XmlNode.of(flat?listTraits.xmlName??listMember.getMemberName():listValueTraits.xmlName??"member");this.writeSimpleInto(listValueSchema,value,listItemNode,xmlns),container2.addChildNode(listItemNode)}};if(flat){for(let value of array)if(sparse||value!=null)writeItem(container,value)}else{let listNode=xmlBuilder.XmlNode.of(listTraits.xmlName??listMember.getMemberName());if(xmlns)listNode.addAttribute(xmlnsAttr,xmlns);for(let value of array)if(sparse||value!=null)writeItem(listNode,value);container.addChildNode(listNode)}}writeMap(mapMember,map3,container,parentXmlns,containerIsMap=!1){if(!mapMember.isMemberSchema())throw Error(`@aws-sdk/core/protocols - xml serializer, cannot write non-member map: ${mapMember.getName(!0)}`);let mapTraits=mapMember.getMergedTraits(),mapKeySchema=mapMember.getKeySchema(),keyTag=mapKeySchema.getMergedTraits().xmlName??"key",mapValueSchema=mapMember.getValueSchema(),mapValueTraits=mapValueSchema.getMergedTraits(),valueTag=mapValueTraits.xmlName??"value",sparse=!!mapValueTraits.sparse,flat=!!mapTraits.xmlFlattened,[xmlnsAttr,xmlns]=this.getXmlnsAttribute(mapMember,parentXmlns),addKeyValue=(entry,key,val)=>{let keyNode=xmlBuilder.XmlNode.of(keyTag,key),[keyXmlnsAttr,keyXmlns]=this.getXmlnsAttribute(mapKeySchema,xmlns);if(keyXmlns)keyNode.addAttribute(keyXmlnsAttr,keyXmlns);entry.addChildNode(keyNode);let valueNode=xmlBuilder.XmlNode.of(valueTag);if(mapValueSchema.isListSchema())this.writeList(mapValueSchema,val,valueNode,xmlns);else if(mapValueSchema.isMapSchema())this.writeMap(mapValueSchema,val,valueNode,xmlns,!0);else if(mapValueSchema.isStructSchema())valueNode=this.writeStruct(mapValueSchema,val,xmlns);else this.writeSimpleInto(mapValueSchema,val,valueNode,xmlns);entry.addChildNode(valueNode)};if(flat){for(let[key,val]of Object.entries(map3))if(sparse||val!=null){let entry=xmlBuilder.XmlNode.of(mapTraits.xmlName??mapMember.getMemberName());addKeyValue(entry,key,val),container.addChildNode(entry)}}else{let mapNode;if(!containerIsMap){if(mapNode=xmlBuilder.XmlNode.of(mapTraits.xmlName??mapMember.getMemberName()),xmlns)mapNode.addAttribute(xmlnsAttr,xmlns);container.addChildNode(mapNode)}for(let[key,val]of Object.entries(map3))if(sparse||val!=null){let entry=xmlBuilder.XmlNode.of("entry");addKeyValue(entry,key,val),(containerIsMap?container:mapNode).addChildNode(entry)}}}writeSimple(_schema,value){if(value===null)throw Error("@aws-sdk/core/protocols - (XML serializer) cannot write null value.");let ns=schema.NormalizedSchema.of(_schema),nodeContents=null;if(value&&typeof value==="object")if(ns.isBlobSchema())nodeContents=(this.serdeContext?.base64Encoder??utilBase64.toBase64)(value);else if(ns.isTimestampSchema()&&value instanceof Date)switch(protocols.determineTimestampFormat(ns,this.settings)){case 5:nodeContents=value.toISOString().replace(".000Z","Z");break;case 6:nodeContents=smithyClient.dateToUtcString(value);break;case 7:nodeContents=String(value.getTime()/1000);break;default:console.warn("Missing timestamp format, using http date",value),nodeContents=smithyClient.dateToUtcString(value);break}else if(ns.isBigDecimalSchema()&&value){if(value instanceof serde.NumericValue)return value.string;return String(value)}else if(ns.isMapSchema()||ns.isListSchema())throw Error("@aws-sdk/core/protocols - xml serializer, cannot call _write() on List/Map schema, call writeList or writeMap() instead.");else throw Error(`@aws-sdk/core/protocols - xml serializer, unhandled schema type for object value and schema: ${ns.getName(!0)}`);if(ns.isBooleanSchema()||ns.isNumericSchema()||ns.isBigIntegerSchema()||ns.isBigDecimalSchema())nodeContents=String(value);if(ns.isStringSchema())if(value===void 0&&ns.isIdempotencyToken())nodeContents=serde.generateIdempotencyToken();else nodeContents=String(value);if(nodeContents===null)throw Error(`Unhandled schema-value pair ${ns.getName(!0)}=${value}`);return nodeContents}writeSimpleInto(_schema,value,into,parentXmlns){let nodeContents=this.writeSimple(_schema,value),ns=schema.NormalizedSchema.of(_schema),content=new xmlBuilder.XmlText(nodeContents),[xmlnsAttr,xmlns]=this.getXmlnsAttribute(ns,parentXmlns);if(xmlns)into.addAttribute(xmlnsAttr,xmlns);into.addChildNode(content)}getXmlnsAttribute(ns,parentXmlns){let traits=ns.getMergedTraits(),[prefix,xmlns]=traits.xmlNamespace??[];if(xmlns&&xmlns!==parentXmlns)return[prefix?`xmlns:${prefix}`:"xmlns",xmlns];return[void 0,void 0]}}class XmlCodec extends SerdeContextConfig{settings;constructor(settings){super();this.settings=settings}createSerializer(){let serializer=new XmlShapeSerializer(this.settings);return serializer.setSerdeContext(this.serdeContext),serializer}createDeserializer(){let deserializer=new XmlShapeDeserializer(this.settings);return deserializer.setSerdeContext(this.serdeContext),deserializer}}class AwsRestXmlProtocol extends protocols.HttpBindingProtocol{codec;serializer;deserializer;mixin=new ProtocolLib;constructor(options){super(options);let settings={timestampFormat:{useTrait:!0,default:5},httpBindings:!0,xmlNamespace:options.xmlNamespace,serviceNamespace:options.defaultNamespace};this.codec=new XmlCodec(settings),this.serializer=new protocols.HttpInterceptingShapeSerializer(this.codec.createSerializer(),settings),this.deserializer=new protocols.HttpInterceptingShapeDeserializer(this.codec.createDeserializer(),settings)}getPayloadCodec(){return this.codec}getShapeId(){return"aws.protocols#restXml"}async serializeRequest(operationSchema,input,context){let request=await super.serializeRequest(operationSchema,input,context),inputSchema=schema.NormalizedSchema.of(operationSchema.input);if(!request.headers["content-type"]){let contentType=this.mixin.resolveRestContentType(this.getDefaultContentType(),inputSchema);if(contentType)request.headers["content-type"]=contentType}if(typeof request.body==="string"&&request.headers["content-type"]===this.getDefaultContentType()&&!request.body.startsWith("<?xml ")&&!this.hasUnstructuredPayloadBinding(inputSchema))request.body='<?xml version="1.0" encoding="UTF-8"?>'+request.body;return request}async deserializeResponse(operationSchema,context,response){return super.deserializeResponse(operationSchema,context,response)}async handleError(operationSchema,context,response,dataObject,metadata){let errorIdentifier=loadRestXmlErrorCode(response,dataObject)??"Unknown";if(dataObject.Error&&typeof dataObject.Error==="object"){for(let key of Object.keys(dataObject.Error))if(dataObject[key]=dataObject.Error[key],key.toLowerCase()==="message")dataObject.message=dataObject.Error[key]}if(dataObject.RequestId&&!metadata.requestId)metadata.requestId=dataObject.RequestId;let{errorSchema,errorMetadata}=await this.mixin.getErrorSchemaOrThrowBaseException(errorIdentifier,this.options.defaultNamespace,response,dataObject,metadata),ns=schema.NormalizedSchema.of(errorSchema),message=dataObject.Error?.message??dataObject.Error?.Message??dataObject.message??dataObject.Message??"Unknown",exception=new(schema.TypeRegistry.for(errorSchema[1]).getErrorCtor(errorSchema)??Error)(message);await this.deserializeHttpMessage(errorSchema,context,response,dataObject);let output={};for(let[name,member]of ns.structIterator()){let target=member.getMergedTraits().xmlName??name,value=dataObject.Error?.[target]??dataObject[target];output[name]=this.codec.createDeserializer().readSchema(member,value)}throw this.mixin.decorateServiceException(Object.assign(exception,errorMetadata,{$fault:ns.getMergedTraits().error,message},output),dataObject)}getDefaultContentType(){return"application/xml"}hasUnstructuredPayloadBinding(ns){for(let[,member]of ns.structIterator())if(member.getMergedTraits().httpPayload)return!(member.isStructSchema()||member.isMapSchema()||member.isListSchema());return!1}}exports.AWSSDKSigV4Signer=AWSSDKSigV4Signer;exports.AwsEc2QueryProtocol=AwsEc2QueryProtocol;exports.AwsJson1_0Protocol=AwsJson1_0Protocol;exports.AwsJson1_1Protocol=AwsJson1_1Protocol;exports.AwsJsonRpcProtocol=AwsJsonRpcProtocol;exports.AwsQueryProtocol=AwsQueryProtocol;exports.AwsRestJsonProtocol=AwsRestJsonProtocol;exports.AwsRestXmlProtocol=AwsRestXmlProtocol;exports.AwsSdkSigV4ASigner=AwsSdkSigV4ASigner;exports.AwsSdkSigV4Signer=AwsSdkSigV4Signer;exports.AwsSmithyRpcV2CborProtocol=AwsSmithyRpcV2CborProtocol;exports.JsonCodec=JsonCodec;exports.JsonShapeDeserializer=JsonShapeDeserializer;exports.JsonShapeSerializer=JsonShapeSerializer;exports.NODE_AUTH_SCHEME_PREFERENCE_OPTIONS=NODE_AUTH_SCHEME_PREFERENCE_OPTIONS;exports.NODE_SIGV4A_CONFIG_OPTIONS=NODE_SIGV4A_CONFIG_OPTIONS;exports.XmlCodec=XmlCodec;exports.XmlShapeDeserializer=XmlShapeDeserializer;exports.XmlShapeSerializer=XmlShapeSerializer;exports._toBool=_toBool;exports._toNum=_toNum;exports._toStr=_toStr;exports.awsExpectUnion=awsExpectUnion;exports.emitWarningIfUnsupportedVersion=emitWarningIfUnsupportedVersion;exports.getBearerTokenEnvKey=getBearerTokenEnvKey;exports.loadRestJsonErrorCode=loadRestJsonErrorCode;exports.loadRestXmlErrorCode=loadRestXmlErrorCode;exports.parseJsonBody=parseJsonBody;exports.parseJsonErrorBody=parseJsonErrorBody;exports.parseXmlBody=parseXmlBody;exports.parseXmlErrorBody=parseXmlErrorBody;exports.resolveAWSSDKSigV4Config=resolveAWSSDKSigV4Config;exports.resolveAwsSdkSigV4AConfig=resolveAwsSdkSigV4AConfig;exports.resolveAwsSdkSigV4Config=resolveAwsSdkSigV4Config;exports.setCredentialFeature=setCredentialFeature;exports.setFeature=setFeature;exports.setTokenFeature=setTokenFeature;exports.state=state;exports.validateSigningProperties=validateSigningProperties});var require_dist_cjs24=__commonJS((exports)=>{var protocolHttp=require_dist_cjs2();function resolveHostHeaderConfig(input){return input}var hostHeaderMiddleware=(options)=>(next)=>async(args)=>{if(!protocolHttp.HttpRequest.isInstance(args.request))return next(args);let{request}=args,{handlerProtocol=""}=options.requestHandler.metadata||{};if(handlerProtocol.indexOf("h2")>=0&&!request.headers[":authority"])delete request.headers.host,request.headers[":authority"]=request.hostname+(request.port?":"+request.port:"");else if(!request.headers.host){let host=request.hostname;if(request.port!=null)host+=`:${request.port}`;request.headers.host=host}return next(args)},hostHeaderMiddlewareOptions={name:"hostHeaderMiddleware",step:"build",priority:"low",tags:["HOST"],override:!0},getHostHeaderPlugin=(options)=>({applyToStack:(clientStack)=>{clientStack.add(hostHeaderMiddleware(options),hostHeaderMiddlewareOptions)}});exports.getHostHeaderPlugin=getHostHeaderPlugin;exports.hostHeaderMiddleware=hostHeaderMiddleware;exports.hostHeaderMiddlewareOptions=hostHeaderMiddlewareOptions;exports.resolveHostHeaderConfig=resolveHostHeaderConfig});var require_dist_cjs25=__commonJS((exports)=>{var loggerMiddleware=()=>(next,context)=>async(args)=>{try{let response=await next(args),{clientName,commandName,logger,dynamoDbDocumentClientOptions={}}=context,{overrideInputFilterSensitiveLog,overrideOutputFilterSensitiveLog}=dynamoDbDocumentClientOptions,inputFilterSensitiveLog=overrideInputFilterSensitiveLog??context.inputFilterSensitiveLog,outputFilterSensitiveLog=overrideOutputFilterSensitiveLog??context.outputFilterSensitiveLog,{$metadata,...outputWithoutMetadata}=response.output;return logger?.info?.({clientName,commandName,input:inputFilterSensitiveLog(args.input),output:outputFilterSensitiveLog(outputWithoutMetadata),metadata:$metadata}),response}catch(error){let{clientName,commandName,logger,dynamoDbDocumentClientOptions={}}=context,{overrideInputFilterSensitiveLog}=dynamoDbDocumentClientOptions,inputFilterSensitiveLog=overrideInputFilterSensitiveLog??context.inputFilterSensitiveLog;throw logger?.error?.({clientName,commandName,input:inputFilterSensitiveLog(args.input),error,metadata:error.$metadata}),error}},loggerMiddlewareOptions={name:"loggerMiddleware",tags:["LOGGER"],step:"initialize",override:!0},getLoggerPlugin=(options)=>({applyToStack:(clientStack)=>{clientStack.add(loggerMiddleware(),loggerMiddlewareOptions)}});exports.getLoggerPlugin=getLoggerPlugin;exports.loggerMiddleware=loggerMiddleware;exports.loggerMiddlewareOptions=loggerMiddlewareOptions});var require_invoke_store=__commonJS((exports)=>{var PROTECTED_KEYS={REQUEST_ID:Symbol.for("_AWS_LAMBDA_REQUEST_ID"),X_RAY_TRACE_ID:Symbol.for("_AWS_LAMBDA_X_RAY_TRACE_ID"),TENANT_ID:Symbol.for("_AWS_LAMBDA_TENANT_ID")},NO_GLOBAL_AWS_LAMBDA=["true","1"].includes(process.env?.AWS_LAMBDA_NODEJS_NO_GLOBAL_AWSLAMBDA??"");if(!NO_GLOBAL_AWS_LAMBDA)globalThis.awslambda=globalThis.awslambda||{};class InvokeStoreBase{static PROTECTED_KEYS=PROTECTED_KEYS;isProtectedKey(key){return Object.values(PROTECTED_KEYS).includes(key)}getRequestId(){return this.get(PROTECTED_KEYS.REQUEST_ID)??"-"}getXRayTraceId(){return this.get(PROTECTED_KEYS.X_RAY_TRACE_ID)}getTenantId(){return this.get(PROTECTED_KEYS.TENANT_ID)}}class InvokeStoreSingle extends InvokeStoreBase{currentContext;getContext(){return this.currentContext}hasContext(){return this.currentContext!==void 0}get(key){return this.currentContext?.[key]}set(key,value){if(this.isProtectedKey(key))throw Error(`Cannot modify protected Lambda context field: ${String(key)}`);this.currentContext=this.currentContext||{},this.currentContext[key]=value}run(context,fn){return this.currentContext=context,fn()}}class InvokeStoreMulti extends InvokeStoreBase{als;static async create(){let instance=new InvokeStoreMulti,asyncHooks=await import("async_hooks");return instance.als=new asyncHooks.AsyncLocalStorage,instance}getContext(){return this.als.getStore()}hasContext(){return this.als.getStore()!==void 0}get(key){return this.als.getStore()?.[key]}set(key,value){if(this.isProtectedKey(key))throw Error(`Cannot modify protected Lambda context field: ${String(key)}`);let store=this.als.getStore();if(!store)throw Error("No context available");store[key]=value}run(context,fn){return this.als.run(context,fn)}}exports.InvokeStore=void 0;(function(InvokeStore){let instance=null;async function getInstanceAsync(){if(!instance)instance=(async()=>{let newInstance="AWS_LAMBDA_MAX_CONCURRENCY"in process.env?await InvokeStoreMulti.create():new InvokeStoreSingle;if(!NO_GLOBAL_AWS_LAMBDA&&globalThis.awslambda?.InvokeStore)return globalThis.awslambda.InvokeStore;else if(!NO_GLOBAL_AWS_LAMBDA&&globalThis.awslambda)return globalThis.awslambda.InvokeStore=newInstance,newInstance;else return newInstance})();return instance}InvokeStore.getInstanceAsync=getInstanceAsync,InvokeStore._testing=process.env.AWS_LAMBDA_BENCHMARK_MODE==="1"?{reset:()=>{if(instance=null,globalThis.awslambda?.InvokeStore)delete globalThis.awslambda.InvokeStore;globalThis.awslambda={InvokeStore:void 0}}}:void 0})(exports.InvokeStore||(exports.InvokeStore={}));exports.InvokeStoreBase=InvokeStoreBase});var require_recursionDetectionMiddleware=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.recursionDetectionMiddleware=void 0;var lambda_invoke_store_1=require_invoke_store(),protocol_http_1=require_dist_cjs2(),TRACE_ID_HEADER_NAME="X-Amzn-Trace-Id",ENV_LAMBDA_FUNCTION_NAME="AWS_LAMBDA_FUNCTION_NAME",ENV_TRACE_ID="_X_AMZN_TRACE_ID",recursionDetectionMiddleware=()=>(next)=>async(args)=>{let{request}=args;if(!protocol_http_1.HttpRequest.isInstance(request))return next(args);let traceIdHeader=Object.keys(request.headers??{}).find((h)=>h.toLowerCase()===TRACE_ID_HEADER_NAME.toLowerCase())??TRACE_ID_HEADER_NAME;if(request.headers.hasOwnProperty(traceIdHeader))return next(args);let functionName=process.env[ENV_LAMBDA_FUNCTION_NAME],traceIdFromEnv=process.env[ENV_TRACE_ID],traceId=(await lambda_invoke_store_1.InvokeStore.getInstanceAsync())?.getXRayTraceId()??traceIdFromEnv,nonEmptyString=(str)=>typeof str==="string"&&str.length>0;if(nonEmptyString(functionName)&&nonEmptyString(traceId))request.headers[TRACE_ID_HEADER_NAME]=traceId;return next({...args,request})};exports.recursionDetectionMiddleware=recursionDetectionMiddleware});var require_dist_cjs26=__commonJS((exports)=>{var recursionDetectionMiddleware=require_recursionDetectionMiddleware(),recursionDetectionMiddlewareOptions={step:"build",tags:["RECURSION_DETECTION"],name:"recursionDetectionMiddleware",override:!0,priority:"low"},getRecursionDetectionPlugin=(options)=>({applyToStack:(clientStack)=>{clientStack.add(recursionDetectionMiddleware.recursionDetectionMiddleware(),recursionDetectionMiddlewareOptions)}});exports.getRecursionDetectionPlugin=getRecursionDetectionPlugin;Object.keys(recursionDetectionMiddleware).forEach(function(k2){if(k2!=="default"&&!Object.prototype.hasOwnProperty.call(exports,k2))Object.defineProperty(exports,k2,{enumerable:!0,get:function(){return recursionDetectionMiddleware[k2]}})})});var require_dist_cjs27=__commonJS((exports)=>{var booleanSelector=(obj,key,type)=>{if(!(key in obj))return;if(obj[key]==="true")return!0;if(obj[key]==="false")return!1;throw Error(`Cannot load ${type} "${key}". Expected "true" or "false", got ${obj[key]}.`)},numberSelector=(obj,key,type)=>{if(!(key in obj))return;let numberValue=parseInt(obj[key],10);if(Number.isNaN(numberValue))throw TypeError(`Cannot load ${type} '${key}'. Expected number, got '${obj[key]}'.`);return numberValue};exports.SelectorType=void 0;(function(SelectorType2){SelectorType2.ENV="env",SelectorType2.CONFIG="shared config entry"})(exports.SelectorType||(exports.SelectorType={}));exports.booleanSelector=booleanSelector;exports.numberSelector=numberSelector});var require_dist_cjs28=__commonJS((exports)=>{var types3=require_dist_cjs();class EndpointCache{capacity;data=new Map;parameters=[];constructor({size,params}){if(this.capacity=size??50,params)this.parameters=params}get(endpointParams,resolver){let key=this.hash(endpointParams);if(key===!1)return resolver();if(!this.data.has(key)){if(this.data.size>this.capacity+10){let keys=this.data.keys(),i=0;while(!0){let{value,done}=keys.next();if(this.data.delete(value),done||++i>10)break}}this.data.set(key,resolver())}return this.data.get(key)}size(){return this.data.size}hash(endpointParams){let buffer2="",{parameters}=this;if(parameters.length===0)return!1;for(let param of parameters){let val=String(endpointParams[param]??"");if(val.includes("|;"))return!1;buffer2+=val+"|;"}return buffer2}}var IP_V4_REGEX=new RegExp("^(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}$"),isIpAddress=(value)=>IP_V4_REGEX.test(value)||value.startsWith("[")&&value.endsWith("]"),VALID_HOST_LABEL_REGEX=new RegExp("^(?!.*-$)(?!-)[a-zA-Z0-9-]{1,63}$"),isValidHostLabel=(value,allowSubDomains=!1)=>{if(!allowSubDomains)return VALID_HOST_LABEL_REGEX.test(value);let labels=value.split(".");for(let label of labels)if(!isValidHostLabel(label))return!1;return!0},customEndpointFunctions={},debugId="endpoints";function toDebugString(input){if(typeof input!=="object"||input==null)return input;if("ref"in input)return`$${toDebugString(input.ref)}`;if("fn"in input)return`${input.fn}(${(input.argv||[]).map(toDebugString).join(", ")})`;return JSON.stringify(input,null,2)}class EndpointError extends Error{constructor(message){super(message);this.name="EndpointError"}}var booleanEquals=(value1,value2)=>value1===value2,getAttrPathList=(path)=>{let parts=path.split("."),pathList=[];for(let part of parts){let squareBracketIndex=part.indexOf("[");if(squareBracketIndex!==-1){if(part.indexOf("]")!==part.length-1)throw new EndpointError(`Path: '${path}' does not end with ']'`);let arrayIndex=part.slice(squareBracketIndex+1,-1);if(Number.isNaN(parseInt(arrayIndex)))throw new EndpointError(`Invalid array index: '${arrayIndex}' in path: '${path}'`);if(squareBracketIndex!==0)pathList.push(part.slice(0,squareBracketIndex));pathList.push(arrayIndex)}else pathList.push(part)}return pathList},getAttr=(value,path)=>getAttrPathList(path).reduce((acc,index2)=>{if(typeof acc!=="object")throw new EndpointError(`Index '${index2}' in '${path}' not found in '${JSON.stringify(value)}'`);else if(Array.isArray(acc))return acc[parseInt(index2)];return acc[index2]},value),isSet=(value)=>value!=null,not2=(value)=>!value,DEFAULT_PORTS={[types3.EndpointURLScheme.HTTP]:80,[types3.EndpointURLScheme.HTTPS]:443},parseURL=(value)=>{let whatwgURL=(()=>{try{if(value instanceof URL)return value;if(typeof value==="object"&&"hostname"in value){let{hostname:hostname2,port,protocol:protocol2="",path="",query={}}=value,url=new URL(`${protocol2}//${hostname2}${port?`:${port}`:""}${path}`);return url.search=Object.entries(query).map(([k2,v])=>`${k2}=${v}`).join("&"),url}return new URL(value)}catch(error){return null}})();if(!whatwgURL)return console.error(`Unable to parse ${JSON.stringify(value)} as a whatwg URL.`),null;let urlString=whatwgURL.href,{host,hostname,pathname,protocol,search}=whatwgURL;if(search)return null;let scheme=protocol.slice(0,-1);if(!Object.values(types3.EndpointURLScheme).includes(scheme))return null;let isIp=isIpAddress(hostname),inputContainsDefaultPort=urlString.includes(`${host}:${DEFAULT_PORTS[scheme]}`)||typeof value==="string"&&value.includes(`${host}:${DEFAULT_PORTS[scheme]}`),authority=`${host}${inputContainsDefaultPort?`:${DEFAULT_PORTS[scheme]}`:""}`;return{scheme,authority,path:pathname,normalizedPath:pathname.endsWith("/")?pathname:`${pathname}/`,isIp}},stringEquals=(value1,value2)=>value1===value2,substring=(input,start,stop,reverse)=>{if(start>=stop||input.length<stop)return null;if(!reverse)return input.substring(start,stop);return input.substring(input.length-stop,input.length-start)},uriEncode=(value)=>encodeURIComponent(value).replace(/[!*'()]/g,(c)=>`%${c.charCodeAt(0).toString(16).toUpperCase()}`),endpointFunctions={booleanEquals,getAttr,isSet,isValidHostLabel,not:not2,parseURL,stringEquals,substring,uriEncode},evaluateTemplate=(template,options)=>{let evaluatedTemplateArr=[],templateContext={...options.endpointParams,...options.referenceRecord},currentIndex=0;while(currentIndex<template.length){let openingBraceIndex=template.indexOf("{",currentIndex);if(openingBraceIndex===-1){evaluatedTemplateArr.push(template.slice(currentIndex));break}evaluatedTemplateArr.push(template.slice(currentIndex,openingBraceIndex));let closingBraceIndex=template.indexOf("}",openingBraceIndex);if(closingBraceIndex===-1){evaluatedTemplateArr.push(template.slice(openingBraceIndex));break}if(template[openingBraceIndex+1]==="{"&&template[closingBraceIndex+1]==="}")evaluatedTemplateArr.push(template.slice(openingBraceIndex+1,closingBraceIndex)),currentIndex=closingBraceIndex+2;let parameterName=template.substring(openingBraceIndex+1,closingBraceIndex);if(parameterName.includes("#")){let[refName,attrName]=parameterName.split("#");evaluatedTemplateArr.push(getAttr(templateContext[refName],attrName))}else evaluatedTemplateArr.push(templateContext[parameterName]);currentIndex=closingBraceIndex+1}return evaluatedTemplateArr.join("")},getReferenceValue=({ref},options)=>{return{...options.endpointParams,...options.referenceRecord}[ref]},evaluateExpression=(obj,keyName,options)=>{if(typeof obj==="string")return evaluateTemplate(obj,options);else if(obj.fn)return group$2.callFunction(obj,options);else if(obj.ref)return getReferenceValue(obj,options);throw new EndpointError(`'${keyName}': ${String(obj)} is not a string, function or reference.`)},callFunction=({fn,argv},options)=>{let evaluatedArgs=argv.map((arg)=>["boolean","number"].includes(typeof arg)?arg:group$2.evaluateExpression(arg,"arg",options)),fnSegments=fn.split(".");if(fnSegments[0]in customEndpointFunctions&&fnSegments[1]!=null)return customEndpointFunctions[fnSegments[0]][fnSegments[1]](...evaluatedArgs);return endpointFunctions[fn](...evaluatedArgs)},group$2={evaluateExpression,callFunction},evaluateCondition=({assign,...fnArgs},options)=>{if(assign&&assign in options.referenceRecord)throw new EndpointError(`'${assign}' is already defined in Reference Record.`);let value=callFunction(fnArgs,options);return options.logger?.debug?.(`${debugId} evaluateCondition: ${toDebugString(fnArgs)} = ${toDebugString(value)}`),{result:value===""?!0:!!value,...assign!=null&&{toAssign:{name:assign,value}}}},evaluateConditions=(conditions=[],options)=>{let conditionsReferenceRecord={};for(let condition of conditions){let{result:result2,toAssign}=evaluateCondition(condition,{...options,referenceRecord:{...options.referenceRecord,...conditionsReferenceRecord}});if(!result2)return{result:result2};if(toAssign)conditionsReferenceRecord[toAssign.name]=toAssign.value,options.logger?.debug?.(`${debugId} assign: ${toAssign.name} := ${toDebugString(toAssign.value)}`)}return{result:!0,referenceRecord:conditionsReferenceRecord}},getEndpointHeaders=(headers,options)=>Object.entries(headers).reduce((acc,[headerKey,headerVal])=>({...acc,[headerKey]:headerVal.map((headerValEntry)=>{let processedExpr=evaluateExpression(headerValEntry,"Header value entry",options);if(typeof processedExpr!=="string")throw new EndpointError(`Header '${headerKey}' value '${processedExpr}' is not a string`);return processedExpr})}),{}),getEndpointProperties=(properties,options)=>Object.entries(properties).reduce((acc,[propertyKey,propertyVal])=>({...acc,[propertyKey]:group$1.getEndpointProperty(propertyVal,options)}),{}),getEndpointProperty=(property,options)=>{if(Array.isArray(property))return property.map((propertyEntry)=>getEndpointProperty(propertyEntry,options));switch(typeof property){case"string":return evaluateTemplate(property,options);case"object":if(property===null)throw new EndpointError(`Unexpected endpoint property: ${property}`);return group$1.getEndpointProperties(property,options);case"boolean":return property;default:throw new EndpointError(`Unexpected endpoint property type: ${typeof property}`)}},group$1={getEndpointProperty,getEndpointProperties},getEndpointUrl=(endpointUrl,options)=>{let expression=evaluateExpression(endpointUrl,"Endpoint URL",options);if(typeof expression==="string")try{return new URL(expression)}catch(error){throw console.error(`Failed to construct URL with ${expression}`,error),error}throw new EndpointError(`Endpoint URL must be a string, got ${typeof expression}`)},evaluateEndpointRule=(endpointRule,options)=>{let{conditions,endpoint}=endpointRule,{result:result2,referenceRecord}=evaluateConditions(conditions,options);if(!result2)return;let endpointRuleOptions={...options,referenceRecord:{...options.referenceRecord,...referenceRecord}},{url,properties,headers}=endpoint;return options.logger?.debug?.(`${debugId} Resolving endpoint from template: ${toDebugString(endpoint)}`),{...headers!=null&&{headers:getEndpointHeaders(headers,endpointRuleOptions)},...properties!=null&&{properties:getEndpointProperties(properties,endpointRuleOptions)},url:getEndpointUrl(url,endpointRuleOptions)}},evaluateErrorRule=(errorRule,options)=>{let{conditions,error}=errorRule,{result:result2,referenceRecord}=evaluateConditions(conditions,options);if(!result2)return;throw new EndpointError(evaluateExpression(error,"Error",{...options,referenceRecord:{...options.referenceRecord,...referenceRecord}}))},evaluateRules=(rules,options)=>{for(let rule of rules)if(rule.type==="endpoint"){let endpointOrUndefined=evaluateEndpointRule(rule,options);if(endpointOrUndefined)return endpointOrUndefined}else if(rule.type==="error")evaluateErrorRule(rule,options);else if(rule.type==="tree"){let endpointOrUndefined=group.evaluateTreeRule(rule,options);if(endpointOrUndefined)return endpointOrUndefined}else throw new EndpointError(`Unknown endpoint rule: ${rule}`);throw new EndpointError("Rules evaluation failed")},evaluateTreeRule=(treeRule,options)=>{let{conditions,rules}=treeRule,{result:result2,referenceRecord}=evaluateConditions(conditions,options);if(!result2)return;return group.evaluateRules(rules,{...options,referenceRecord:{...options.referenceRecord,...referenceRecord}})},group={evaluateRules,evaluateTreeRule},resolveEndpoint=(ruleSetObject,options)=>{let{endpointParams,logger}=options,{parameters,rules}=ruleSetObject;options.logger?.debug?.(`${debugId} Initial EndpointParams: ${toDebugString(endpointParams)}`);let paramsWithDefault=Object.entries(parameters).filter(([,v])=>v.default!=null).map(([k2,v])=>[k2,v.default]);if(paramsWithDefault.length>0)for(let[paramKey,paramDefaultValue]of paramsWithDefault)endpointParams[paramKey]=endpointParams[paramKey]??paramDefaultValue;let requiredParams=Object.entries(parameters).filter(([,v])=>v.required).map(([k2])=>k2);for(let requiredParam of requiredParams)if(endpointParams[requiredParam]==null)throw new EndpointError(`Missing required parameter: '${requiredParam}'`);let endpoint=evaluateRules(rules,{endpointParams,logger,referenceRecord:{}});return options.logger?.debug?.(`${debugId} Resolved endpoint: ${toDebugString(endpoint)}`),endpoint};exports.EndpointCache=EndpointCache;exports.EndpointError=EndpointError;exports.customEndpointFunctions=customEndpointFunctions;exports.isIpAddress=isIpAddress;exports.isValidHostLabel=isValidHostLabel;exports.resolveEndpoint=resolveEndpoint});var require_dist_cjs29=__commonJS((exports)=>{function parseQueryString(querystring){let query={};if(querystring=querystring.replace(/^\?/,""),querystring)for(let pair of querystring.split("&")){let[key,value=null]=pair.split("=");if(key=decodeURIComponent(key),value)value=decodeURIComponent(value);if(!(key in query))query[key]=value;else if(Array.isArray(query[key]))query[key].push(value);else query[key]=[query[key],value]}return query}exports.parseQueryString=parseQueryString});var require_dist_cjs30=__commonJS((exports)=>{var querystringParser=require_dist_cjs29(),parseUrl2=(url)=>{if(typeof url==="string")return parseUrl2(new URL(url));let{hostname,pathname,port,protocol,search}=url,query;if(search)query=querystringParser.parseQueryString(search);return{hostname,port:port?parseInt(port):void 0,protocol,path:pathname,query}};exports.parseUrl=parseUrl2});var require_dist_cjs31=__commonJS((exports)=>{var utilEndpoints=require_dist_cjs28(),urlParser=require_dist_cjs30(),isVirtualHostableS3Bucket=(value,allowSubDomains=!1)=>{if(allowSubDomains){for(let label of value.split("."))if(!isVirtualHostableS3Bucket(label))return!1;return!0}if(!utilEndpoints.isValidHostLabel(value))return!1;if(value.length<3||value.length>63)return!1;if(value!==value.toLowerCase())return!1;if(utilEndpoints.isIpAddress(value))return!1;return!0},ARN_DELIMITER=":",RESOURCE_DELIMITER="/",parseArn=(value)=>{let segments=value.split(ARN_DELIMITER);if(segments.length<6)return null;let[arn,partition2,service,region,accountId,...resourcePath]=segments;if(arn!=="arn"||partition2===""||service===""||resourcePath.join(ARN_DELIMITER)==="")return null;let resourceId=resourcePath.map((resource)=>resource.split(RESOURCE_DELIMITER)).flat();return{partition:partition2,service,region,accountId,resourceId}},partitions=[{id:"aws",outputs:{dnsSuffix:"amazonaws.com",dualStackDnsSuffix:"api.aws",implicitGlobalRegion:"us-east-1",name:"aws",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^(us|eu|ap|sa|ca|me|af|il|mx)\\-\\w+\\-\\d+$",regions:{"af-south-1":{description:"Africa (Cape Town)"},"ap-east-1":{description:"Asia Pacific (Hong Kong)"},"ap-east-2":{description:"Asia Pacific (Taipei)"},"ap-northeast-1":{description:"Asia Pacific (Tokyo)"},"ap-northeast-2":{description:"Asia Pacific (Seoul)"},"ap-northeast-3":{description:"Asia Pacific (Osaka)"},"ap-south-1":{description:"Asia Pacific (Mumbai)"},"ap-south-2":{description:"Asia Pacific (Hyderabad)"},"ap-southeast-1":{description:"Asia Pacific (Singapore)"},"ap-southeast-2":{description:"Asia Pacific (Sydney)"},"ap-southeast-3":{description:"Asia Pacific (Jakarta)"},"ap-southeast-4":{description:"Asia Pacific (Melbourne)"},"ap-southeast-5":{description:"Asia Pacific (Malaysia)"},"ap-southeast-6":{description:"Asia Pacific (New Zealand)"},"ap-southeast-7":{description:"Asia Pacific (Thailand)"},"aws-global":{description:"aws global region"},"ca-central-1":{description:"Canada (Central)"},"ca-west-1":{description:"Canada West (Calgary)"},"eu-central-1":{description:"Europe (Frankfurt)"},"eu-central-2":{description:"Europe (Zurich)"},"eu-north-1":{description:"Europe (Stockholm)"},"eu-south-1":{description:"Europe (Milan)"},"eu-south-2":{description:"Europe (Spain)"},"eu-west-1":{description:"Europe (Ireland)"},"eu-west-2":{description:"Europe (London)"},"eu-west-3":{description:"Europe (Paris)"},"il-central-1":{description:"Israel (Tel Aviv)"},"me-central-1":{description:"Middle East (UAE)"},"me-south-1":{description:"Middle East (Bahrain)"},"mx-central-1":{description:"Mexico (Central)"},"sa-east-1":{description:"South America (Sao Paulo)"},"us-east-1":{description:"US East (N. Virginia)"},"us-east-2":{description:"US East (Ohio)"},"us-west-1":{description:"US West (N. California)"},"us-west-2":{description:"US West (Oregon)"}}},{id:"aws-cn",outputs:{dnsSuffix:"amazonaws.com.cn",dualStackDnsSuffix:"api.amazonwebservices.com.cn",implicitGlobalRegion:"cn-northwest-1",name:"aws-cn",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^cn\\-\\w+\\-\\d+$",regions:{"aws-cn-global":{description:"aws-cn global region"},"cn-north-1":{description:"China (Beijing)"},"cn-northwest-1":{description:"China (Ningxia)"}}},{id:"aws-eusc",outputs:{dnsSuffix:"amazonaws.eu",dualStackDnsSuffix:"api.amazonwebservices.eu",implicitGlobalRegion:"eusc-de-east-1",name:"aws-eusc",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^eusc\\-(de)\\-\\w+\\-\\d+$",regions:{"eusc-de-east-1":{description:"AWS European Sovereign Cloud (Germany)"}}},{id:"aws-iso",outputs:{dnsSuffix:"c2s.ic.gov",dualStackDnsSuffix:"api.aws.ic.gov",implicitGlobalRegion:"us-iso-east-1",name:"aws-iso",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^us\\-iso\\-\\w+\\-\\d+$",regions:{"aws-iso-global":{description:"aws-iso global region"},"us-iso-east-1":{description:"US ISO East"},"us-iso-west-1":{description:"US ISO WEST"}}},{id:"aws-iso-b",outputs:{dnsSuffix:"sc2s.sgov.gov",dualStackDnsSuffix:"api.aws.scloud",implicitGlobalRegion:"us-isob-east-1",name:"aws-iso-b",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^us\\-isob\\-\\w+\\-\\d+$",regions:{"aws-iso-b-global":{description:"aws-iso-b global region"},"us-isob-east-1":{description:"US ISOB East (Ohio)"},"us-isob-west-1":{description:"US ISOB West"}}},{id:"aws-iso-e",outputs:{dnsSuffix:"cloud.adc-e.uk",dualStackDnsSuffix:"api.cloud-aws.adc-e.uk",implicitGlobalRegion:"eu-isoe-west-1",name:"aws-iso-e",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^eu\\-isoe\\-\\w+\\-\\d+$",regions:{"aws-iso-e-global":{description:"aws-iso-e global region"},"eu-isoe-west-1":{description:"EU ISOE West"}}},{id:"aws-iso-f",outputs:{dnsSuffix:"csp.hci.ic.gov",dualStackDnsSuffix:"api.aws.hci.ic.gov",implicitGlobalRegion:"us-isof-south-1",name:"aws-iso-f",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^us\\-isof\\-\\w+\\-\\d+$",regions:{"aws-iso-f-global":{description:"aws-iso-f global region"},"us-isof-east-1":{description:"US ISOF EAST"},"us-isof-south-1":{description:"US ISOF SOUTH"}}},{id:"aws-us-gov",outputs:{dnsSuffix:"amazonaws.com",dualStackDnsSuffix:"api.aws",implicitGlobalRegion:"us-gov-west-1",name:"aws-us-gov",supportsDualStack:!0,supportsFIPS:!0},regionRegex:"^us\\-gov\\-\\w+\\-\\d+$",regions:{"aws-us-gov-global":{description:"aws-us-gov global region"},"us-gov-east-1":{description:"AWS GovCloud (US-East)"},"us-gov-west-1":{description:"AWS GovCloud (US-West)"}}}],version2="1.1",partitionsInfo={partitions,version:version2},selectedPartitionsInfo=partitionsInfo,selectedUserAgentPrefix="",partition=(value)=>{let{partitions:partitions2}=selectedPartitionsInfo;for(let partition2 of partitions2){let{regions,outputs}=partition2;for(let[region,regionData]of Object.entries(regions))if(region===value)return{...outputs,...regionData}}for(let partition2 of partitions2){let{regionRegex,outputs}=partition2;if(new RegExp(regionRegex).test(value))return{...outputs}}let DEFAULT_PARTITION=partitions2.find((partition2)=>partition2.id==="aws");if(!DEFAULT_PARTITION)throw Error("Provided region was not found in the partition array or regex, and default partition with id 'aws' doesn't exist.");return{...DEFAULT_PARTITION.outputs}},setPartitionInfo=(partitionsInfo2,userAgentPrefix="")=>{selectedPartitionsInfo=partitionsInfo2,selectedUserAgentPrefix=userAgentPrefix},useDefaultPartitionInfo=()=>{setPartitionInfo(partitionsInfo,"")},getUserAgentPrefix=()=>selectedUserAgentPrefix,awsEndpointFunctions={isVirtualHostableS3Bucket,parseArn,partition};utilEndpoints.customEndpointFunctions.aws=awsEndpointFunctions;var resolveDefaultAwsRegionalEndpointsConfig=(input)=>{if(typeof input.endpointProvider!=="function")throw Error("@aws-sdk/util-endpoint - endpointProvider and endpoint missing in config for this client.");let{endpoint}=input;if(endpoint===void 0)input.endpoint=async()=>{return toEndpointV1(input.endpointProvider({Region:typeof input.region==="function"?await input.region():input.region,UseDualStack:typeof input.useDualstackEndpoint==="function"?await input.useDualstackEndpoint():input.useDualstackEndpoint,UseFIPS:typeof input.useFipsEndpoint==="function"?await input.useFipsEndpoint():input.useFipsEndpoint,Endpoint:void 0},{logger:input.logger}))};return input},toEndpointV1=(endpoint)=>urlParser.parseUrl(endpoint.url);Object.defineProperty(exports,"EndpointError",{enumerable:!0,get:function(){return utilEndpoints.EndpointError}});Object.defineProperty(exports,"isIpAddress",{enumerable:!0,get:function(){return utilEndpoints.isIpAddress}});Object.defineProperty(exports,"resolveEndpoint",{enumerable:!0,get:function(){return utilEndpoints.resolveEndpoint}});exports.awsEndpointFunctions=awsEndpointFunctions;exports.getUserAgentPrefix=getUserAgentPrefix;exports.partition=partition;exports.resolveDefaultAwsRegionalEndpointsConfig=resolveDefaultAwsRegionalEndpointsConfig;exports.setPartitionInfo=setPartitionInfo;exports.toEndpointV1=toEndpointV1;exports.useDefaultPartitionInfo=useDefaultPartitionInfo});var require_dist_cjs32=__commonJS((exports)=>{var core2=require_dist_cjs16(),utilEndpoints=require_dist_cjs31(),protocolHttp=require_dist_cjs2(),core$1=require_dist_cjs23(),DEFAULT_UA_APP_ID=void 0;function isValidUserAgentAppId(appId){if(appId===void 0)return!0;return typeof appId==="string"&&appId.length<=50}function resolveUserAgentConfig(input){let normalizedAppIdProvider=core2.normalizeProvider(input.userAgentAppId??DEFAULT_UA_APP_ID),{customUserAgent}=input;return Object.assign(input,{customUserAgent:typeof customUserAgent==="string"?[[customUserAgent]]:customUserAgent,userAgentAppId:async()=>{let appId=await normalizedAppIdProvider();if(!isValidUserAgentAppId(appId)){let logger=input.logger?.constructor?.name==="NoOpLogger"||!input.logger?console:input.logger;if(typeof appId!=="string")logger?.warn("userAgentAppId must be a string or undefined.");else if(appId.length>50)logger?.warn("The provided userAgentAppId exceeds the maximum length of 50 characters.")}return appId}})}var ACCOUNT_ID_ENDPOINT_REGEX=/\d{12}\.ddb/;async function checkFeatures(context,config,args){if(args.request?.headers?.["smithy-protocol"]==="rpc-v2-cbor")core$1.setFeature(context,"PROTOCOL_RPC_V2_CBOR","M");if(typeof config.retryStrategy==="function"){let retryStrategy=await config.retryStrategy();if(typeof retryStrategy.acquireInitialRetryToken==="function")if(retryStrategy.constructor?.name?.includes("Adaptive"))core$1.setFeature(context,"RETRY_MODE_ADAPTIVE","F");else core$1.setFeature(context,"RETRY_MODE_STANDARD","E");else core$1.setFeature(context,"RETRY_MODE_LEGACY","D")}if(typeof config.accountIdEndpointMode==="function"){let endpointV2=context.endpointV2;if(String(endpointV2?.url?.hostname).match(ACCOUNT_ID_ENDPOINT_REGEX))core$1.setFeature(context,"ACCOUNT_ID_ENDPOINT","O");switch(await config.accountIdEndpointMode?.()){case"disabled":core$1.setFeature(context,"ACCOUNT_ID_MODE_DISABLED","Q");break;case"preferred":core$1.setFeature(context,"ACCOUNT_ID_MODE_PREFERRED","P");break;case"required":core$1.setFeature(context,"ACCOUNT_ID_MODE_REQUIRED","R");break}}let identity=context.__smithy_context?.selectedHttpAuthScheme?.identity;if(identity?.$source){let credentials=identity;if(credentials.accountId)core$1.setFeature(context,"RESOLVED_ACCOUNT_ID","T");for(let[key,value]of Object.entries(credentials.$source??{}))core$1.setFeature(context,key,value)}}var USER_AGENT="user-agent",X_AMZ_USER_AGENT="x-amz-user-agent",SPACE=" ",UA_NAME_SEPARATOR="/",UA_NAME_ESCAPE_REGEX=/[^!$%&'*+\-.^_`|~\w]/g,UA_VALUE_ESCAPE_REGEX=/[^!$%&'*+\-.^_`|~\w#]/g,UA_ESCAPE_CHAR="-",BYTE_LIMIT=1024;function encodeFeatures(features){let buffer2="";for(let key in features){let val=features[key];if(buffer2.length+val.length+1<=BYTE_LIMIT){if(buffer2.length)buffer2+=","+val;else buffer2+=val;continue}break}return buffer2}var userAgentMiddleware=(options)=>(next,context)=>async(args)=>{let{request}=args;if(!protocolHttp.HttpRequest.isInstance(request))return next(args);let{headers}=request,userAgent=context?.userAgent?.map(escapeUserAgent)||[],defaultUserAgent=(await options.defaultUserAgentProvider()).map(escapeUserAgent);await checkFeatures(context,options,args);let awsContext=context;defaultUserAgent.push(`m/${encodeFeatures(Object.assign({},context.__smithy_context?.features,awsContext.__aws_sdk_context?.features))}`);let customUserAgent=options?.customUserAgent?.map(escapeUserAgent)||[],appId=await options.userAgentAppId();if(appId)defaultUserAgent.push(escapeUserAgent(["app",`${appId}`]));let prefix=utilEndpoints.getUserAgentPrefix(),sdkUserAgentValue=(prefix?[prefix]:[]).concat([...defaultUserAgent,...userAgent,...customUserAgent]).join(SPACE),normalUAValue=[...defaultUserAgent.filter((section)=>section.startsWith("aws-sdk-")),...customUserAgent].join(SPACE);if(options.runtime!=="browser"){if(normalUAValue)headers[X_AMZ_USER_AGENT]=headers[X_AMZ_USER_AGENT]?`${headers[USER_AGENT]} ${normalUAValue}`:normalUAValue;headers[USER_AGENT]=sdkUserAgentValue}else headers[X_AMZ_USER_AGENT]=sdkUserAgentValue;return next({...args,request})},escapeUserAgent=(userAgentPair)=>{let name=userAgentPair[0].split(UA_NAME_SEPARATOR).map((part)=>part.replace(UA_NAME_ESCAPE_REGEX,UA_ESCAPE_CHAR)).join(UA_NAME_SEPARATOR),version2=userAgentPair[1]?.replace(UA_VALUE_ESCAPE_REGEX,UA_ESCAPE_CHAR),prefixSeparatorIndex=name.indexOf(UA_NAME_SEPARATOR),prefix=name.substring(0,prefixSeparatorIndex),uaName=name.substring(prefixSeparatorIndex+1);if(prefix==="api")uaName=uaName.toLowerCase();return[prefix,uaName,version2].filter((item)=>item&&item.length>0).reduce((acc,item,index2)=>{switch(index2){case 0:return item;case 1:return`${acc}/${item}`;default:return`${acc}#${item}`}},"")},getUserAgentMiddlewareOptions={name:"getUserAgentMiddleware",step:"build",priority:"low",tags:["SET_USER_AGENT","USER_AGENT"],override:!0},getUserAgentPlugin=(config)=>({applyToStack:(clientStack)=>{clientStack.add(userAgentMiddleware(config),getUserAgentMiddlewareOptions)}});exports.DEFAULT_UA_APP_ID=DEFAULT_UA_APP_ID;exports.getUserAgentMiddlewareOptions=getUserAgentMiddlewareOptions;exports.getUserAgentPlugin=getUserAgentPlugin;exports.resolveUserAgentConfig=resolveUserAgentConfig;exports.userAgentMiddleware=userAgentMiddleware});var require_dist_cjs33=__commonJS((exports)=>{var utilConfigProvider=require_dist_cjs27(),utilMiddleware=require_dist_cjs3(),utilEndpoints=require_dist_cjs28(),ENV_USE_DUALSTACK_ENDPOINT="AWS_USE_DUALSTACK_ENDPOINT",CONFIG_USE_DUALSTACK_ENDPOINT="use_dualstack_endpoint",DEFAULT_USE_DUALSTACK_ENDPOINT=!1,NODE_USE_DUALSTACK_ENDPOINT_CONFIG_OPTIONS={environmentVariableSelector:(env3)=>utilConfigProvider.booleanSelector(env3,ENV_USE_DUALSTACK_ENDPOINT,utilConfigProvider.SelectorType.ENV),configFileSelector:(profile)=>utilConfigProvider.booleanSelector(profile,CONFIG_USE_DUALSTACK_ENDPOINT,utilConfigProvider.SelectorType.CONFIG),default:!1},ENV_USE_FIPS_ENDPOINT="AWS_USE_FIPS_ENDPOINT",CONFIG_USE_FIPS_ENDPOINT="use_fips_endpoint",DEFAULT_USE_FIPS_ENDPOINT=!1,NODE_USE_FIPS_ENDPOINT_CONFIG_OPTIONS={environmentVariableSelector:(env3)=>utilConfigProvider.booleanSelector(env3,ENV_USE_FIPS_ENDPOINT,utilConfigProvider.SelectorType.ENV),configFileSelector:(profile)=>utilConfigProvider.booleanSelector(profile,CONFIG_USE_FIPS_ENDPOINT,utilConfigProvider.SelectorType.CONFIG),default:!1},resolveCustomEndpointsConfig=(input)=>{let{tls:tls2,endpoint,urlParser,useDualstackEndpoint}=input;return Object.assign(input,{tls:tls2??!0,endpoint:utilMiddleware.normalizeProvider(typeof endpoint==="string"?urlParser(endpoint):endpoint),isCustomEndpoint:!0,useDualstackEndpoint:utilMiddleware.normalizeProvider(useDualstackEndpoint??!1)})},getEndpointFromRegion=async(input)=>{let{tls:tls2=!0}=input,region=await input.region();if(!new RegExp(/^([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9-]{0,61}[a-zA-Z0-9])$/).test(region))throw Error("Invalid region in client config");let useDualstackEndpoint=await input.useDualstackEndpoint(),useFipsEndpoint=await input.useFipsEndpoint(),{hostname}=await input.regionInfoProvider(region,{useDualstackEndpoint,useFipsEndpoint})??{};if(!hostname)throw Error("Cannot resolve hostname from client config");return input.urlParser(`${tls2?"https:":"http:"}//${hostname}`)},resolveEndpointsConfig=(input)=>{let useDualstackEndpoint=utilMiddleware.normalizeProvider(input.useDualstackEndpoint??!1),{endpoint,useFipsEndpoint,urlParser,tls:tls2}=input;return Object.assign(input,{tls:tls2??!0,endpoint:endpoint?utilMiddleware.normalizeProvider(typeof endpoint==="string"?urlParser(endpoint):endpoint):()=>getEndpointFromRegion({...input,useDualstackEndpoint,useFipsEndpoint}),isCustomEndpoint:!!endpoint,useDualstackEndpoint})},REGION_ENV_NAME="AWS_REGION",REGION_INI_NAME="region",NODE_REGION_CONFIG_OPTIONS={environmentVariableSelector:(env3)=>env3[REGION_ENV_NAME],configFileSelector:(profile)=>profile[REGION_INI_NAME],default:()=>{throw Error("Region is missing")}},NODE_REGION_CONFIG_FILE_OPTIONS={preferredFile:"credentials"},validRegions=new Set,checkRegion=(region,check2=utilEndpoints.isValidHostLabel)=>{if(!validRegions.has(region)&&!check2(region))if(region==="*")console.warn('@smithy/config-resolver WARN - Please use the caller region instead of "*". See "sigv4a" in https://github.com/aws/aws-sdk-js-v3/blob/main/supplemental-docs/CLIENTS.md.');else throw Error(`Region not accepted: region="${region}" is not a valid hostname component.`);else validRegions.add(region)},isFipsRegion=(region)=>typeof region==="string"&&(region.startsWith("fips-")||region.endsWith("-fips")),getRealRegion=(region)=>isFipsRegion(region)?["fips-aws-global","aws-fips"].includes(region)?"us-east-1":region.replace(/fips-(dkr-|prod-)?|-fips/,""):region,resolveRegionConfig=(input)=>{let{region,useFipsEndpoint}=input;if(!region)throw Error("Region is missing");return Object.assign(input,{region:async()=>{let providedRegion=typeof region==="function"?await region():region,realRegion=getRealRegion(providedRegion);return checkRegion(realRegion),realRegion},useFipsEndpoint:async()=>{let providedRegion=typeof region==="string"?region:await region();if(isFipsRegion(providedRegion))return!0;return typeof useFipsEndpoint!=="function"?Promise.resolve(!!useFipsEndpoint):useFipsEndpoint()}})},getHostnameFromVariants=(variants=[],{useFipsEndpoint,useDualstackEndpoint})=>variants.find(({tags})=>useFipsEndpoint===tags.includes("fips")&&useDualstackEndpoint===tags.includes("dualstack"))?.hostname,getResolvedHostname=(resolvedRegion,{regionHostname,partitionHostname})=>regionHostname?regionHostname:partitionHostname?partitionHostname.replace("{region}",resolvedRegion):void 0,getResolvedPartition=(region,{partitionHash})=>Object.keys(partitionHash||{}).find((key)=>partitionHash[key].regions.includes(region))??"aws",getResolvedSigningRegion=(hostname,{signingRegion,regionRegex,useFipsEndpoint})=>{if(signingRegion)return signingRegion;else if(useFipsEndpoint){let regionRegexJs=regionRegex.replace("\\\\","\\").replace(/^\^/g,"\\.").replace(/\$$/g,"\\."),regionRegexmatchArray=hostname.match(regionRegexJs);if(regionRegexmatchArray)return regionRegexmatchArray[0].slice(1,-1)}},getRegionInfo=(region,{useFipsEndpoint=!1,useDualstackEndpoint=!1,signingService,regionHash,partitionHash})=>{let partition=getResolvedPartition(region,{partitionHash}),resolvedRegion=region in regionHash?region:partitionHash[partition]?.endpoint??region,hostnameOptions={useFipsEndpoint,useDualstackEndpoint},regionHostname=getHostnameFromVariants(regionHash[resolvedRegion]?.variants,hostnameOptions),partitionHostname=getHostnameFromVariants(partitionHash[partition]?.variants,hostnameOptions),hostname=getResolvedHostname(resolvedRegion,{regionHostname,partitionHostname});if(hostname===void 0)throw Error(`Endpoint resolution failed for: ${{resolvedRegion,useFipsEndpoint,useDualstackEndpoint}}`);let signingRegion=getResolvedSigningRegion(hostname,{signingRegion:regionHash[resolvedRegion]?.signingRegion,regionRegex:partitionHash[partition].regionRegex,useFipsEndpoint});return{partition,signingService,hostname,...signingRegion&&{signingRegion},...regionHash[resolvedRegion]?.signingService&&{signingService:regionHash[resolvedRegion].signingService}}};exports.CONFIG_USE_DUALSTACK_ENDPOINT=CONFIG_USE_DUALSTACK_ENDPOINT;exports.CONFIG_USE_FIPS_ENDPOINT=CONFIG_USE_FIPS_ENDPOINT;exports.DEFAULT_USE_DUALSTACK_ENDPOINT=DEFAULT_USE_DUALSTACK_ENDPOINT;exports.DEFAULT_USE_FIPS_ENDPOINT=DEFAULT_USE_FIPS_ENDPOINT;exports.ENV_USE_DUALSTACK_ENDPOINT=ENV_USE_DUALSTACK_ENDPOINT;exports.ENV_USE_FIPS_ENDPOINT=ENV_USE_FIPS_ENDPOINT;exports.NODE_REGION_CONFIG_FILE_OPTIONS=NODE_REGION_CONFIG_FILE_OPTIONS;exports.NODE_REGION_CONFIG_OPTIONS=NODE_REGION_CONFIG_OPTIONS;exports.NODE_USE_DUALSTACK_ENDPOINT_CONFIG_OPTIONS=NODE_USE_DUALSTACK_ENDPOINT_CONFIG_OPTIONS;exports.NODE_USE_FIPS_ENDPOINT_CONFIG_OPTIONS=NODE_USE_FIPS_ENDPOINT_CONFIG_OPTIONS;exports.REGION_ENV_NAME=REGION_ENV_NAME;exports.REGION_INI_NAME=REGION_INI_NAME;exports.getRegionInfo=getRegionInfo;exports.resolveCustomEndpointsConfig=resolveCustomEndpointsConfig;exports.resolveEndpointsConfig=resolveEndpointsConfig;exports.resolveRegionConfig=resolveRegionConfig});var require_dist_cjs34=__commonJS((exports)=>{var protocolHttp=require_dist_cjs2(),CONTENT_LENGTH_HEADER2="content-length";function contentLengthMiddleware(bodyLengthChecker){return(next)=>async(args)=>{let request=args.request;if(protocolHttp.HttpRequest.isInstance(request)){let{body,headers}=request;if(body&&Object.keys(headers).map((str)=>str.toLowerCase()).indexOf(CONTENT_LENGTH_HEADER2)===-1)try{let length=bodyLengthChecker(body);request.headers={...request.headers,[CONTENT_LENGTH_HEADER2]:String(length)}}catch(error){}}return next({...args,request})}}var contentLengthMiddlewareOptions={step:"build",tags:["SET_CONTENT_LENGTH","CONTENT_LENGTH"],name:"contentLengthMiddleware",override:!0},getContentLengthPlugin=(options)=>({applyToStack:(clientStack)=>{clientStack.add(contentLengthMiddleware(options.bodyLengthChecker),contentLengthMiddlewareOptions)}});exports.contentLengthMiddleware=contentLengthMiddleware;exports.contentLengthMiddlewareOptions=contentLengthMiddlewareOptions;exports.getContentLengthPlugin=getContentLengthPlugin});var require_getHomeDir=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.getHomeDir=void 0;var os_1=__require("os"),path_1=__require("path"),homeDirCache={},getHomeDirCacheKey=()=>{if(process&&process.geteuid)return`${process.geteuid()}`;return"DEFAULT"},getHomeDir=()=>{let{HOME,USERPROFILE,HOMEPATH,HOMEDRIVE=`C:${path_1.sep}`}=process.env;if(HOME)return HOME;if(USERPROFILE)return USERPROFILE;if(HOMEPATH)return`${HOMEDRIVE}${HOMEPATH}`;let homeDirCacheKey=getHomeDirCacheKey();if(!homeDirCache[homeDirCacheKey])homeDirCache[homeDirCacheKey]=(0,os_1.homedir)();return homeDirCache[homeDirCacheKey]};exports.getHomeDir=getHomeDir});var require_getSSOTokenFilepath=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.getSSOTokenFilepath=void 0;var crypto_1=__require("crypto"),path_1=__require("path"),getHomeDir_1=require_getHomeDir(),getSSOTokenFilepath=(id)=>{let cacheName=(0,crypto_1.createHash)("sha1").update(id).digest("hex");return(0,path_1.join)((0,getHomeDir_1.getHomeDir)(),".aws","sso","cache",`${cacheName}.json`)};exports.getSSOTokenFilepath=getSSOTokenFilepath});var require_getSSOTokenFromFile=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.getSSOTokenFromFile=exports.tokenIntercept=void 0;var promises_1=__require("fs/promises"),getSSOTokenFilepath_1=require_getSSOTokenFilepath();exports.tokenIntercept={};var getSSOTokenFromFile=async(id)=>{if(exports.tokenIntercept[id])return exports.tokenIntercept[id];let ssoTokenFilepath=(0,getSSOTokenFilepath_1.getSSOTokenFilepath)(id),ssoTokenText=await(0,promises_1.readFile)(ssoTokenFilepath,"utf8");return JSON.parse(ssoTokenText)};exports.getSSOTokenFromFile=getSSOTokenFromFile});var require_readFile=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.readFile=exports.fileIntercept=exports.filePromises=void 0;var promises_1=__require("fs/promises");exports.filePromises={};exports.fileIntercept={};var readFile=(path,options)=>{if(exports.fileIntercept[path]!==void 0)return exports.fileIntercept[path];if(!exports.filePromises[path]||options?.ignoreCache)exports.filePromises[path]=(0,promises_1.readFile)(path,"utf8");return exports.filePromises[path]};exports.readFile=readFile});var require_dist_cjs35=__commonJS((exports)=>{var getHomeDir=require_getHomeDir(),getSSOTokenFilepath=require_getSSOTokenFilepath(),getSSOTokenFromFile=require_getSSOTokenFromFile(),path=__require("path"),types3=require_dist_cjs(),readFile=require_readFile(),ENV_PROFILE="AWS_PROFILE",DEFAULT_PROFILE="default",getProfileName=(init)=>init.profile||process.env[ENV_PROFILE]||DEFAULT_PROFILE,CONFIG_PREFIX_SEPARATOR=".",getConfigData=(data)=>Object.entries(data).filter(([key])=>{let indexOfSeparator=key.indexOf(CONFIG_PREFIX_SEPARATOR);if(indexOfSeparator===-1)return!1;return Object.values(types3.IniSectionType).includes(key.substring(0,indexOfSeparator))}).reduce((acc,[key,value])=>{let indexOfSeparator=key.indexOf(CONFIG_PREFIX_SEPARATOR),updatedKey=key.substring(0,indexOfSeparator)===types3.IniSectionType.PROFILE?key.substring(indexOfSeparator+1):key;return acc[updatedKey]=value,acc},{...data.default&&{default:data.default}}),ENV_CONFIG_PATH="AWS_CONFIG_FILE",getConfigFilepath=()=>process.env[ENV_CONFIG_PATH]||path.join(getHomeDir.getHomeDir(),".aws","config"),ENV_CREDENTIALS_PATH="AWS_SHARED_CREDENTIALS_FILE",getCredentialsFilepath=()=>process.env[ENV_CREDENTIALS_PATH]||path.join(getHomeDir.getHomeDir(),".aws","credentials"),prefixKeyRegex=/^([\w-]+)\s(["'])?([\w-@\+\.%:/]+)\2$/,profileNameBlockList=["__proto__","profile __proto__"],parseIni=(iniData)=>{let map3={},currentSection,currentSubSection;for(let iniLine of iniData.split(/\r?\n/)){let trimmedLine=iniLine.split(/(^|\s)[;#]/)[0].trim();if(trimmedLine[0]==="["&&trimmedLine[trimmedLine.length-1]==="]"){currentSection=void 0,currentSubSection=void 0;let sectionName=trimmedLine.substring(1,trimmedLine.length-1),matches=prefixKeyRegex.exec(sectionName);if(matches){let[,prefix,,name]=matches;if(Object.values(types3.IniSectionType).includes(prefix))currentSection=[prefix,name].join(CONFIG_PREFIX_SEPARATOR)}else currentSection=sectionName;if(profileNameBlockList.includes(sectionName))throw Error(`Found invalid profile name "${sectionName}"`)}else if(currentSection){let indexOfEqualsSign=trimmedLine.indexOf("=");if(![0,-1].includes(indexOfEqualsSign)){let[name,value]=[trimmedLine.substring(0,indexOfEqualsSign).trim(),trimmedLine.substring(indexOfEqualsSign+1).trim()];if(value==="")currentSubSection=name;else{if(currentSubSection&&iniLine.trimStart()===iniLine)currentSubSection=void 0;map3[currentSection]=map3[currentSection]||{};let key=currentSubSection?[currentSubSection,name].join(CONFIG_PREFIX_SEPARATOR):name;map3[currentSection][key]=value}}}}return map3},swallowError$1=()=>({}),loadSharedConfigFiles=async(init={})=>{let{filepath=getCredentialsFilepath(),configFilepath=getConfigFilepath()}=init,homeDir=getHomeDir.getHomeDir(),relativeHomeDirPrefix="~/",resolvedFilepath=filepath;if(filepath.startsWith("~/"))resolvedFilepath=path.join(homeDir,filepath.slice(2));let resolvedConfigFilepath=configFilepath;if(configFilepath.startsWith("~/"))resolvedConfigFilepath=path.join(homeDir,configFilepath.slice(2));let parsedFiles=await Promise.all([readFile.readFile(resolvedConfigFilepath,{ignoreCache:init.ignoreCache}).then(parseIni).then(getConfigData).catch(swallowError$1),readFile.readFile(resolvedFilepath,{ignoreCache:init.ignoreCache}).then(parseIni).catch(swallowError$1)]);return{configFile:parsedFiles[0],credentialsFile:parsedFiles[1]}},getSsoSessionData=(data)=>Object.entries(data).filter(([key])=>key.startsWith(types3.IniSectionType.SSO_SESSION+CONFIG_PREFIX_SEPARATOR)).reduce((acc,[key,value])=>({...acc,[key.substring(key.indexOf(CONFIG_PREFIX_SEPARATOR)+1)]:value}),{}),swallowError=()=>({}),loadSsoSessionData=async(init={})=>readFile.readFile(init.configFilepath??getConfigFilepath()).then(parseIni).then(getSsoSessionData).catch(swallowError),mergeConfigFiles=(...files)=>{let merged={};for(let file of files)for(let[key,values2]of Object.entries(file))if(merged[key]!==void 0)Object.assign(merged[key],values2);else merged[key]=values2;return merged},parseKnownFiles=async(init)=>{let parsedFiles=await loadSharedConfigFiles(init);return mergeConfigFiles(parsedFiles.configFile,parsedFiles.credentialsFile)},externalDataInterceptor={getFileRecord(){return readFile.fileIntercept},interceptFile(path2,contents){readFile.fileIntercept[path2]=Promise.resolve(contents)},getTokenRecord(){return getSSOTokenFromFile.tokenIntercept},interceptToken(id,contents){getSSOTokenFromFile.tokenIntercept[id]=contents}};Object.defineProperty(exports,"getSSOTokenFromFile",{enumerable:!0,get:function(){return getSSOTokenFromFile.getSSOTokenFromFile}});Object.defineProperty(exports,"readFile",{enumerable:!0,get:function(){return readFile.readFile}});exports.CONFIG_PREFIX_SEPARATOR=CONFIG_PREFIX_SEPARATOR;exports.DEFAULT_PROFILE=DEFAULT_PROFILE;exports.ENV_PROFILE=ENV_PROFILE;exports.externalDataInterceptor=externalDataInterceptor;exports.getProfileName=getProfileName;exports.loadSharedConfigFiles=loadSharedConfigFiles;exports.loadSsoSessionData=loadSsoSessionData;exports.parseKnownFiles=parseKnownFiles;Object.keys(getHomeDir).forEach(function(k2){if(k2!=="default"&&!Object.prototype.hasOwnProperty.call(exports,k2))Object.defineProperty(exports,k2,{enumerable:!0,get:function(){return getHomeDir[k2]}})});Object.keys(getSSOTokenFilepath).forEach(function(k2){if(k2!=="default"&&!Object.prototype.hasOwnProperty.call(exports,k2))Object.defineProperty(exports,k2,{enumerable:!0,get:function(){return getSSOTokenFilepath[k2]}})})});var require_dist_cjs36=__commonJS((exports)=>{var propertyProvider=require_dist_cjs17(),sharedIniFileLoader=require_dist_cjs35();function getSelectorName(functionString){try{let constants=new Set(Array.from(functionString.match(/([A-Z_]){3,}/g)??[]));return constants.delete("CONFIG"),constants.delete("CONFIG_PREFIX_SEPARATOR"),constants.delete("ENV"),[...constants].join(", ")}catch(e){return functionString}}var fromEnv=(envVarSelector,options)=>async()=>{try{let config=envVarSelector(process.env,options);if(config===void 0)throw Error();return config}catch(e){throw new propertyProvider.CredentialsProviderError(e.message||`Not found in ENV: ${getSelectorName(envVarSelector.toString())}`,{logger:options?.logger})}},fromSharedConfigFiles=(configSelector,{preferredFile="config",...init}={})=>async()=>{let profile=sharedIniFileLoader.getProfileName(init),{configFile,credentialsFile}=await sharedIniFileLoader.loadSharedConfigFiles(init),profileFromCredentials=credentialsFile[profile]||{},profileFromConfig=configFile[profile]||{},mergedProfile=preferredFile==="config"?{...profileFromCredentials,...profileFromConfig}:{...profileFromConfig,...profileFromCredentials};try{let configValue=configSelector(mergedProfile,preferredFile==="config"?configFile:credentialsFile);if(configValue===void 0)throw Error();return configValue}catch(e){throw new propertyProvider.CredentialsProviderError(e.message||`Not found in config files w/ profile [${profile}]: ${getSelectorName(configSelector.toString())}`,{logger:init.logger})}},isFunction=(func)=>typeof func==="function",fromStatic=(defaultValue)=>isFunction(defaultValue)?async()=>await defaultValue():propertyProvider.fromStatic(defaultValue),loadConfig=({environmentVariableSelector,configFileSelector,default:defaultValue},configuration={})=>{let{signingName,logger}=configuration,envOptions={signingName,logger};return propertyProvider.memoize(propertyProvider.chain(fromEnv(environmentVariableSelector,envOptions),fromSharedConfigFiles(configFileSelector,configuration),fromStatic(defaultValue)))};exports.loadConfig=loadConfig});var require_getEndpointUrlConfig=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.getEndpointUrlConfig=void 0;var shared_ini_file_loader_1=require_dist_cjs35(),ENV_ENDPOINT_URL="AWS_ENDPOINT_URL",CONFIG_ENDPOINT_URL="endpoint_url",getEndpointUrlConfig=(serviceId)=>({environmentVariableSelector:(env3)=>{let serviceSuffixParts=serviceId.split(" ").map((w)=>w.toUpperCase()),serviceEndpointUrl=env3[[ENV_ENDPOINT_URL,...serviceSuffixParts].join("_")];if(serviceEndpointUrl)return serviceEndpointUrl;let endpointUrl=env3[ENV_ENDPOINT_URL];if(endpointUrl)return endpointUrl;return},configFileSelector:(profile,config)=>{if(config&&profile.services){let servicesSection=config[["services",profile.services].join(shared_ini_file_loader_1.CONFIG_PREFIX_SEPARATOR)];if(servicesSection){let servicePrefixParts=serviceId.split(" ").map((w)=>w.toLowerCase()),endpointUrl2=servicesSection[[servicePrefixParts.join("_"),CONFIG_ENDPOINT_URL].join(shared_ini_file_loader_1.CONFIG_PREFIX_SEPARATOR)];if(endpointUrl2)return endpointUrl2}}let endpointUrl=profile[CONFIG_ENDPOINT_URL];if(endpointUrl)return endpointUrl;return},default:void 0});exports.getEndpointUrlConfig=getEndpointUrlConfig});var require_getEndpointFromConfig=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.getEndpointFromConfig=void 0;var node_config_provider_1=require_dist_cjs36(),getEndpointUrlConfig_1=require_getEndpointUrlConfig(),getEndpointFromConfig=async(serviceId)=>(0,node_config_provider_1.loadConfig)((0,getEndpointUrlConfig_1.getEndpointUrlConfig)(serviceId??""))();exports.getEndpointFromConfig=getEndpointFromConfig});var require_dist_cjs37=__commonJS((exports)=>{var getEndpointFromConfig=require_getEndpointFromConfig(),urlParser=require_dist_cjs30(),core2=require_dist_cjs16(),utilMiddleware=require_dist_cjs3(),middlewareSerde=require_dist_cjs4(),resolveParamsForS3=async(endpointParams)=>{let bucket=endpointParams?.Bucket||"";if(typeof endpointParams.Bucket==="string")endpointParams.Bucket=bucket.replace(/#/g,encodeURIComponent("#")).replace(/\?/g,encodeURIComponent("?"));if(isArnBucketName(bucket)){if(endpointParams.ForcePathStyle===!0)throw Error("Path-style addressing cannot be used with ARN buckets")}else if(!isDnsCompatibleBucketName(bucket)||bucket.indexOf(".")!==-1&&!String(endpointParams.Endpoint).startsWith("http:")||bucket.toLowerCase()!==bucket||bucket.length<3)endpointParams.ForcePathStyle=!0;if(endpointParams.DisableMultiRegionAccessPoints)endpointParams.disableMultiRegionAccessPoints=!0,endpointParams.DisableMRAP=!0;return endpointParams},DOMAIN_PATTERN=/^[a-z0-9][a-z0-9\.\-]{1,61}[a-z0-9]$/,IP_ADDRESS_PATTERN=/(\d+\.){3}\d+/,DOTS_PATTERN=/\.\./,isDnsCompatibleBucketName=(bucketName)=>DOMAIN_PATTERN.test(bucketName)&&!IP_ADDRESS_PATTERN.test(bucketName)&&!DOTS_PATTERN.test(bucketName),isArnBucketName=(bucketName)=>{let[arn,partition,service,,,bucket]=bucketName.split(":"),isArn=arn==="arn"&&bucketName.split(":").length>=6,isValidArn=Boolean(isArn&&partition&&service&&bucket);if(isArn&&!isValidArn)throw Error(`Invalid ARN: ${bucketName} was an invalid ARN.`);return isValidArn},createConfigValueProvider=(configKey,canonicalEndpointParamKey,config,isClientContextParam=!1)=>{let configProvider=async()=>{let configValue;if(isClientContextParam)configValue=config.clientContextParams?.[configKey]??config[configKey]??config[canonicalEndpointParamKey];else configValue=config[configKey]??config[canonicalEndpointParamKey];if(typeof configValue==="function")return configValue();return configValue};if(configKey==="credentialScope"||canonicalEndpointParamKey==="CredentialScope")return async()=>{let credentials=typeof config.credentials==="function"?await config.credentials():config.credentials;return credentials?.credentialScope??credentials?.CredentialScope};if(configKey==="accountId"||canonicalEndpointParamKey==="AccountId")return async()=>{let credentials=typeof config.credentials==="function"?await config.credentials():config.credentials;return credentials?.accountId??credentials?.AccountId};if(configKey==="endpoint"||canonicalEndpointParamKey==="endpoint")return async()=>{if(config.isCustomEndpoint===!1)return;let endpoint=await configProvider();if(endpoint&&typeof endpoint==="object"){if("url"in endpoint)return endpoint.url.href;if("hostname"in endpoint){let{protocol,hostname,port,path}=endpoint;return`${protocol}//${hostname}${port?":"+port:""}${path}`}}return endpoint};return configProvider},toEndpointV1=(endpoint)=>{if(typeof endpoint==="object"){if("url"in endpoint)return urlParser.parseUrl(endpoint.url);return endpoint}return urlParser.parseUrl(endpoint)},getEndpointFromInstructions=async(commandInput,instructionsSupplier,clientConfig,context)=>{if(!clientConfig.isCustomEndpoint){let endpointFromConfig;if(clientConfig.serviceConfiguredEndpoint)endpointFromConfig=await clientConfig.serviceConfiguredEndpoint();else endpointFromConfig=await getEndpointFromConfig.getEndpointFromConfig(clientConfig.serviceId);if(endpointFromConfig)clientConfig.endpoint=()=>Promise.resolve(toEndpointV1(endpointFromConfig)),clientConfig.isCustomEndpoint=!0}let endpointParams=await resolveParams(commandInput,instructionsSupplier,clientConfig);if(typeof clientConfig.endpointProvider!=="function")throw Error("config.endpointProvider is not set.");return clientConfig.endpointProvider(endpointParams,context)},resolveParams=async(commandInput,instructionsSupplier,clientConfig)=>{let endpointParams={},instructions=instructionsSupplier?.getEndpointParameterInstructions?.()||{};for(let[name,instruction]of Object.entries(instructions))switch(instruction.type){case"staticContextParams":endpointParams[name]=instruction.value;break;case"contextParams":endpointParams[name]=commandInput[instruction.name];break;case"clientContextParams":case"builtInParams":endpointParams[name]=await createConfigValueProvider(instruction.name,name,clientConfig,instruction.type!=="builtInParams")();break;case"operationContextParams":endpointParams[name]=instruction.get(commandInput);break;default:throw Error("Unrecognized endpoint parameter instruction: "+JSON.stringify(instruction))}if(Object.keys(instructions).length===0)Object.assign(endpointParams,clientConfig);if(String(clientConfig.serviceId).toLowerCase()==="s3")await resolveParamsForS3(endpointParams);return endpointParams},endpointMiddleware=({config,instructions})=>{return(next,context)=>async(args)=>{if(config.isCustomEndpoint)core2.setFeature(context,"ENDPOINT_OVERRIDE","N");let endpoint=await getEndpointFromInstructions(args.input,{getEndpointParameterInstructions(){return instructions}},{...config},context);context.endpointV2=endpoint,context.authSchemes=endpoint.properties?.authSchemes;let authScheme=context.authSchemes?.[0];if(authScheme){context.signing_region=authScheme.signingRegion,context.signing_service=authScheme.signingName;let httpAuthOption=utilMiddleware.getSmithyContext(context)?.selectedHttpAuthScheme?.httpAuthOption;if(httpAuthOption)httpAuthOption.signingProperties=Object.assign(httpAuthOption.signingProperties||{},{signing_region:authScheme.signingRegion,signingRegion:authScheme.signingRegion,signing_service:authScheme.signingName,signingName:authScheme.signingName,signingRegionSet:authScheme.signingRegionSet},authScheme.properties)}return next({...args})}},endpointMiddlewareOptions={step:"serialize",tags:["ENDPOINT_PARAMETERS","ENDPOINT_V2","ENDPOINT"],name:"endpointV2Middleware",override:!0,relation:"before",toMiddleware:middlewareSerde.serializerMiddlewareOption.name},getEndpointPlugin=(config,instructions)=>({applyToStack:(clientStack)=>{clientStack.addRelativeTo(endpointMiddleware({config,instructions}),endpointMiddlewareOptions)}}),resolveEndpointConfig=(input)=>{let tls2=input.tls??!0,{endpoint,useDualstackEndpoint,useFipsEndpoint}=input,customEndpointProvider=endpoint!=null?async()=>toEndpointV1(await utilMiddleware.normalizeProvider(endpoint)()):void 0,resolvedConfig=Object.assign(input,{endpoint:customEndpointProvider,tls:tls2,isCustomEndpoint:!!endpoint,useDualstackEndpoint:utilMiddleware.normalizeProvider(useDualstackEndpoint??!1),useFipsEndpoint:utilMiddleware.normalizeProvider(useFipsEndpoint??!1)}),configuredEndpointPromise=void 0;return resolvedConfig.serviceConfiguredEndpoint=async()=>{if(input.serviceId&&!configuredEndpointPromise)configuredEndpointPromise=getEndpointFromConfig.getEndpointFromConfig(input.serviceId);return configuredEndpointPromise},resolvedConfig},resolveEndpointRequiredConfig=(input)=>{let{endpoint}=input;if(endpoint===void 0)input.endpoint=async()=>{throw Error("@smithy/middleware-endpoint: (default endpointRuleSet) endpoint is not set - you must configure an endpoint.")};return input};exports.endpointMiddleware=endpointMiddleware;exports.endpointMiddlewareOptions=endpointMiddlewareOptions;exports.getEndpointFromInstructions=getEndpointFromInstructions;exports.getEndpointPlugin=getEndpointPlugin;exports.resolveEndpointConfig=resolveEndpointConfig;exports.resolveEndpointRequiredConfig=resolveEndpointRequiredConfig;exports.resolveParams=resolveParams;exports.toEndpointV1=toEndpointV1});var require_dist_cjs38=__commonJS((exports)=>{var CLOCK_SKEW_ERROR_CODES=["AuthFailure","InvalidSignatureException","RequestExpired","RequestInTheFuture","RequestTimeTooSkewed","SignatureDoesNotMatch"],THROTTLING_ERROR_CODES=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException","TransactionInProgressException"],TRANSIENT_ERROR_CODES=["TimeoutError","RequestTimeout","RequestTimeoutException"],TRANSIENT_ERROR_STATUS_CODES=[500,502,503,504],NODEJS_TIMEOUT_ERROR_CODES=["ECONNRESET","ECONNREFUSED","EPIPE","ETIMEDOUT"],NODEJS_NETWORK_ERROR_CODES=["EHOSTUNREACH","ENETUNREACH","ENOTFOUND"],isRetryableByTrait=(error)=>error?.$retryable!==void 0,isClockSkewError=(error)=>CLOCK_SKEW_ERROR_CODES.includes(error.name),isClockSkewCorrectedError=(error)=>error.$metadata?.clockSkewCorrected,isBrowserNetworkError=(error)=>{let errorMessages=new Set(["Failed to fetch","NetworkError when attempting to fetch resource","The Internet connection appears to be offline","Load failed","Network request failed"]);if(!(error&&error instanceof TypeError))return!1;return errorMessages.has(error.message)},isThrottlingError=(error)=>error.$metadata?.httpStatusCode===429||THROTTLING_ERROR_CODES.includes(error.name)||error.$retryable?.throttling==!0,isTransientError=(error,depth=0)=>isRetryableByTrait(error)||isClockSkewCorrectedError(error)||TRANSIENT_ERROR_CODES.includes(error.name)||NODEJS_TIMEOUT_ERROR_CODES.includes(error?.code||"")||NODEJS_NETWORK_ERROR_CODES.includes(error?.code||"")||TRANSIENT_ERROR_STATUS_CODES.includes(error.$metadata?.httpStatusCode||0)||isBrowserNetworkError(error)||error.cause!==void 0&&depth<=10&&isTransientError(error.cause,depth+1),isServerError=(error)=>{if(error.$metadata?.httpStatusCode!==void 0){let statusCode=error.$metadata.httpStatusCode;if(500<=statusCode&&statusCode<=599&&!isTransientError(error))return!0;return!1}return!1};exports.isBrowserNetworkError=isBrowserNetworkError;exports.isClockSkewCorrectedError=isClockSkewCorrectedError;exports.isClockSkewError=isClockSkewError;exports.isRetryableByTrait=isRetryableByTrait;exports.isServerError=isServerError;exports.isThrottlingError=isThrottlingError;exports.isTransientError=isTransientError});var require_dist_cjs39=__commonJS((exports)=>{var serviceErrorClassification=require_dist_cjs38();exports.RETRY_MODES=void 0;(function(RETRY_MODES){RETRY_MODES.STANDARD="standard",RETRY_MODES.ADAPTIVE="adaptive"})(exports.RETRY_MODES||(exports.RETRY_MODES={}));var DEFAULT_MAX_ATTEMPTS=3,DEFAULT_RETRY_MODE=exports.RETRY_MODES.STANDARD;class DefaultRateLimiter{static setTimeoutFn=setTimeout;beta;minCapacity;minFillRate;scaleConstant;smooth;currentCapacity=0;enabled=!1;lastMaxRate=0;measuredTxRate=0;requestCount=0;fillRate;lastThrottleTime;lastTimestamp=0;lastTxRateBucket;maxCapacity;timeWindow=0;constructor(options){this.beta=options?.beta??0.7,this.minCapacity=options?.minCapacity??1,this.minFillRate=options?.minFillRate??0.5,this.scaleConstant=options?.scaleConstant??0.4,this.smooth=options?.smooth??0.8;let currentTimeInSeconds=this.getCurrentTimeInSeconds();this.lastThrottleTime=currentTimeInSeconds,this.lastTxRateBucket=Math.floor(this.getCurrentTimeInSeconds()),this.fillRate=this.minFillRate,this.maxCapacity=this.minCapacity}getCurrentTimeInSeconds(){return Date.now()/1000}async getSendToken(){return this.acquireTokenBucket(1)}async acquireTokenBucket(amount){if(!this.enabled)return;if(this.refillTokenBucket(),amount>this.currentCapacity){let delay=(amount-this.currentCapacity)/this.fillRate*1000;await new Promise((resolve)=>DefaultRateLimiter.setTimeoutFn(resolve,delay))}this.currentCapacity=this.currentCapacity-amount}refillTokenBucket(){let timestamp2=this.getCurrentTimeInSeconds();if(!this.lastTimestamp){this.lastTimestamp=timestamp2;return}let fillAmount=(timestamp2-this.lastTimestamp)*this.fillRate;this.currentCapacity=Math.min(this.maxCapacity,this.currentCapacity+fillAmount),this.lastTimestamp=timestamp2}updateClientSendingRate(response){let calculatedRate;if(this.updateMeasuredRate(),serviceErrorClassification.isThrottlingError(response)){let rateToUse=!this.enabled?this.measuredTxRate:Math.min(this.measuredTxRate,this.fillRate);this.lastMaxRate=rateToUse,this.calculateTimeWindow(),this.lastThrottleTime=this.getCurrentTimeInSeconds(),calculatedRate=this.cubicThrottle(rateToUse),this.enableTokenBucket()}else this.calculateTimeWindow(),calculatedRate=this.cubicSuccess(this.getCurrentTimeInSeconds());let newRate=Math.min(calculatedRate,2*this.measuredTxRate);this.updateTokenBucketRate(newRate)}calculateTimeWindow(){this.timeWindow=this.getPrecise(Math.pow(this.lastMaxRate*(1-this.beta)/this.scaleConstant,0.3333333333333333))}cubicThrottle(rateToUse){return this.getPrecise(rateToUse*this.beta)}cubicSuccess(timestamp2){return this.getPrecise(this.scaleConstant*Math.pow(timestamp2-this.lastThrottleTime-this.timeWindow,3)+this.lastMaxRate)}enableTokenBucket(){this.enabled=!0}updateTokenBucketRate(newRate){this.refillTokenBucket(),this.fillRate=Math.max(newRate,this.minFillRate),this.maxCapacity=Math.max(newRate,this.minCapacity),this.currentCapacity=Math.min(this.currentCapacity,this.maxCapacity)}updateMeasuredRate(){let t8=this.getCurrentTimeInSeconds(),timeBucket=Math.floor(t8*2)/2;if(this.requestCount++,timeBucket>this.lastTxRateBucket){let currentRate=this.requestCount/(timeBucket-this.lastTxRateBucket);this.measuredTxRate=this.getPrecise(currentRate*this.smooth+this.measuredTxRate*(1-this.smooth)),this.requestCount=0,this.lastTxRateBucket=timeBucket}}getPrecise(num){return parseFloat(num.toFixed(8))}}var DEFAULT_RETRY_DELAY_BASE=100,MAXIMUM_RETRY_DELAY=20000,THROTTLING_RETRY_DELAY_BASE=500,INITIAL_RETRY_TOKENS=500,RETRY_COST=5,TIMEOUT_RETRY_COST=10,NO_RETRY_INCREMENT=1,INVOCATION_ID_HEADER="amz-sdk-invocation-id",REQUEST_HEADER="amz-sdk-request",getDefaultRetryBackoffStrategy=()=>{let delayBase=DEFAULT_RETRY_DELAY_BASE;return{computeNextBackoffDelay:(attempts)=>{return Math.floor(Math.min(MAXIMUM_RETRY_DELAY,Math.random()*2**attempts*delayBase))},setDelayBase:(delay)=>{delayBase=delay}}},createDefaultRetryToken=({retryDelay,retryCount,retryCost})=>{return{getRetryCount:()=>retryCount,getRetryDelay:()=>Math.min(MAXIMUM_RETRY_DELAY,retryDelay),getRetryCost:()=>retryCost}};class StandardRetryStrategy{maxAttempts;mode=exports.RETRY_MODES.STANDARD;capacity=INITIAL_RETRY_TOKENS;retryBackoffStrategy=getDefaultRetryBackoffStrategy();maxAttemptsProvider;constructor(maxAttempts){this.maxAttempts=maxAttempts,this.maxAttemptsProvider=typeof maxAttempts==="function"?maxAttempts:async()=>maxAttempts}async acquireInitialRetryToken(retryTokenScope){return createDefaultRetryToken({retryDelay:DEFAULT_RETRY_DELAY_BASE,retryCount:0})}async refreshRetryTokenForRetry(token,errorInfo){let maxAttempts=await this.getMaxAttempts();if(this.shouldRetry(token,errorInfo,maxAttempts)){let errorType=errorInfo.errorType;this.retryBackoffStrategy.setDelayBase(errorType==="THROTTLING"?THROTTLING_RETRY_DELAY_BASE:DEFAULT_RETRY_DELAY_BASE);let delayFromErrorType=this.retryBackoffStrategy.computeNextBackoffDelay(token.getRetryCount()),retryDelay=errorInfo.retryAfterHint?Math.max(errorInfo.retryAfterHint.getTime()-Date.now()||0,delayFromErrorType):delayFromErrorType,capacityCost=this.getCapacityCost(errorType);return this.capacity-=capacityCost,createDefaultRetryToken({retryDelay,retryCount:token.getRetryCount()+1,retryCost:capacityCost})}throw Error("No retry token available")}recordSuccess(token){this.capacity=Math.max(INITIAL_RETRY_TOKENS,this.capacity+(token.getRetryCost()??NO_RETRY_INCREMENT))}getCapacity(){return this.capacity}async getMaxAttempts(){try{return await this.maxAttemptsProvider()}catch(error){return console.warn(`Max attempts provider could not resolve. Using default of ${DEFAULT_MAX_ATTEMPTS}`),DEFAULT_MAX_ATTEMPTS}}shouldRetry(tokenToRenew,errorInfo,maxAttempts){return tokenToRenew.getRetryCount()+1<maxAttempts&&this.capacity>=this.getCapacityCost(errorInfo.errorType)&&this.isRetryableError(errorInfo.errorType)}getCapacityCost(errorType){return errorType==="TRANSIENT"?TIMEOUT_RETRY_COST:RETRY_COST}isRetryableError(errorType){return errorType==="THROTTLING"||errorType==="TRANSIENT"}}class AdaptiveRetryStrategy{maxAttemptsProvider;rateLimiter;standardRetryStrategy;mode=exports.RETRY_MODES.ADAPTIVE;constructor(maxAttemptsProvider,options){this.maxAttemptsProvider=maxAttemptsProvider;let{rateLimiter}=options??{};this.rateLimiter=rateLimiter??new DefaultRateLimiter,this.standardRetryStrategy=new StandardRetryStrategy(maxAttemptsProvider)}async acquireInitialRetryToken(retryTokenScope){return await this.rateLimiter.getSendToken(),this.standardRetryStrategy.acquireInitialRetryToken(retryTokenScope)}async refreshRetryTokenForRetry(tokenToRenew,errorInfo){return this.rateLimiter.updateClientSendingRate(errorInfo),this.standardRetryStrategy.refreshRetryTokenForRetry(tokenToRenew,errorInfo)}recordSuccess(token){this.rateLimiter.updateClientSendingRate({}),this.standardRetryStrategy.recordSuccess(token)}}class ConfiguredRetryStrategy extends StandardRetryStrategy{computeNextBackoffDelay;constructor(maxAttempts,computeNextBackoffDelay=DEFAULT_RETRY_DELAY_BASE){super(typeof maxAttempts==="function"?maxAttempts:async()=>maxAttempts);if(typeof computeNextBackoffDelay==="number")this.computeNextBackoffDelay=()=>computeNextBackoffDelay;else this.computeNextBackoffDelay=computeNextBackoffDelay}async refreshRetryTokenForRetry(tokenToRenew,errorInfo){let token=await super.refreshRetryTokenForRetry(tokenToRenew,errorInfo);return token.getRetryDelay=()=>this.computeNextBackoffDelay(token.getRetryCount()),token}}exports.AdaptiveRetryStrategy=AdaptiveRetryStrategy;exports.ConfiguredRetryStrategy=ConfiguredRetryStrategy;exports.DEFAULT_MAX_ATTEMPTS=DEFAULT_MAX_ATTEMPTS;exports.DEFAULT_RETRY_DELAY_BASE=DEFAULT_RETRY_DELAY_BASE;exports.DEFAULT_RETRY_MODE=DEFAULT_RETRY_MODE;exports.DefaultRateLimiter=DefaultRateLimiter;exports.INITIAL_RETRY_TOKENS=INITIAL_RETRY_TOKENS;exports.INVOCATION_ID_HEADER=INVOCATION_ID_HEADER;exports.MAXIMUM_RETRY_DELAY=MAXIMUM_RETRY_DELAY;exports.NO_RETRY_INCREMENT=NO_RETRY_INCREMENT;exports.REQUEST_HEADER=REQUEST_HEADER;exports.RETRY_COST=RETRY_COST;exports.StandardRetryStrategy=StandardRetryStrategy;exports.THROTTLING_RETRY_DELAY_BASE=THROTTLING_RETRY_DELAY_BASE;exports.TIMEOUT_RETRY_COST=TIMEOUT_RETRY_COST});var require_isStreamingPayload=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.isStreamingPayload=void 0;var stream_1=__require("stream"),isStreamingPayload=(request)=>request?.body instanceof stream_1.Readable||typeof ReadableStream<"u"&&request?.body instanceof ReadableStream;exports.isStreamingPayload=isStreamingPayload});var require_dist_cjs40=__commonJS((exports)=>{var utilRetry=require_dist_cjs39(),protocolHttp=require_dist_cjs2(),serviceErrorClassification=require_dist_cjs38(),uuid2=require_dist_cjs15(),utilMiddleware=require_dist_cjs3(),smithyClient=require_dist_cjs21(),isStreamingPayload=require_isStreamingPayload(),getDefaultRetryQuota=(initialRetryTokens,options)=>{let MAX_CAPACITY=initialRetryTokens,noRetryIncrement=utilRetry.NO_RETRY_INCREMENT,retryCost=utilRetry.RETRY_COST,timeoutRetryCost=utilRetry.TIMEOUT_RETRY_COST,availableCapacity=initialRetryTokens,getCapacityAmount=(error)=>error.name==="TimeoutError"?timeoutRetryCost:retryCost,hasRetryTokens=(error)=>getCapacityAmount(error)<=availableCapacity;return Object.freeze({hasRetryTokens,retrieveRetryTokens:(error)=>{if(!hasRetryTokens(error))throw Error("No retry token available");let capacityAmount=getCapacityAmount(error);return availableCapacity-=capacityAmount,capacityAmount},releaseRetryTokens:(capacityReleaseAmount)=>{availableCapacity+=capacityReleaseAmount??noRetryIncrement,availableCapacity=Math.min(availableCapacity,MAX_CAPACITY)}})},defaultDelayDecider=(delayBase,attempts)=>Math.floor(Math.min(utilRetry.MAXIMUM_RETRY_DELAY,Math.random()*2**attempts*delayBase)),defaultRetryDecider=(error)=>{if(!error)return!1;return serviceErrorClassification.isRetryableByTrait(error)||serviceErrorClassification.isClockSkewError(error)||serviceErrorClassification.isThrottlingError(error)||serviceErrorClassification.isTransientError(error)},asSdkError=(error)=>{if(error instanceof Error)return error;if(error instanceof Object)return Object.assign(Error(),error);if(typeof error==="string")return Error(error);return Error(`AWS SDK error wrapper for ${error}`)};class StandardRetryStrategy{maxAttemptsProvider;retryDecider;delayDecider;retryQuota;mode=utilRetry.RETRY_MODES.STANDARD;constructor(maxAttemptsProvider,options){this.maxAttemptsProvider=maxAttemptsProvider,this.retryDecider=options?.retryDecider??defaultRetryDecider,this.delayDecider=options?.delayDecider??defaultDelayDecider,this.retryQuota=options?.retryQuota??getDefaultRetryQuota(utilRetry.INITIAL_RETRY_TOKENS)}shouldRetry(error,attempts,maxAttempts){return attempts<maxAttempts&&this.retryDecider(error)&&this.retryQuota.hasRetryTokens(error)}async getMaxAttempts(){let maxAttempts;try{maxAttempts=await this.maxAttemptsProvider()}catch(error){maxAttempts=utilRetry.DEFAULT_MAX_ATTEMPTS}return maxAttempts}async retry(next,args,options){let retryTokenAmount,attempts=0,totalDelay=0,maxAttempts=await this.getMaxAttempts(),{request}=args;if(protocolHttp.HttpRequest.isInstance(request))request.headers[utilRetry.INVOCATION_ID_HEADER]=uuid2.v4();while(!0)try{if(protocolHttp.HttpRequest.isInstance(request))request.headers[utilRetry.REQUEST_HEADER]=`attempt=${attempts+1}; max=${maxAttempts}`;if(options?.beforeRequest)await options.beforeRequest();let{response,output}=await next(args);if(options?.afterRequest)options.afterRequest(response);return this.retryQuota.releaseRetryTokens(retryTokenAmount),output.$metadata.attempts=attempts+1,output.$metadata.totalRetryDelay=totalDelay,{response,output}}catch(e){let err=asSdkError(e);if(attempts++,this.shouldRetry(err,attempts,maxAttempts)){retryTokenAmount=this.retryQuota.retrieveRetryTokens(err);let delayFromDecider=this.delayDecider(serviceErrorClassification.isThrottlingError(err)?utilRetry.THROTTLING_RETRY_DELAY_BASE:utilRetry.DEFAULT_RETRY_DELAY_BASE,attempts),delayFromResponse=getDelayFromRetryAfterHeader(err.$response),delay=Math.max(delayFromResponse||0,delayFromDecider);totalDelay+=delay,await new Promise((resolve)=>setTimeout(resolve,delay));continue}if(!err.$metadata)err.$metadata={};throw err.$metadata.attempts=attempts,err.$metadata.totalRetryDelay=totalDelay,err}}}var getDelayFromRetryAfterHeader=(response)=>{if(!protocolHttp.HttpResponse.isInstance(response))return;let retryAfterHeaderName=Object.keys(response.headers).find((key)=>key.toLowerCase()==="retry-after");if(!retryAfterHeaderName)return;let retryAfter=response.headers[retryAfterHeaderName],retryAfterSeconds=Number(retryAfter);if(!Number.isNaN(retryAfterSeconds))return retryAfterSeconds*1000;return new Date(retryAfter).getTime()-Date.now()};class AdaptiveRetryStrategy extends StandardRetryStrategy{rateLimiter;constructor(maxAttemptsProvider,options){let{rateLimiter,...superOptions}=options??{};super(maxAttemptsProvider,superOptions);this.rateLimiter=rateLimiter??new utilRetry.DefaultRateLimiter,this.mode=utilRetry.RETRY_MODES.ADAPTIVE}async retry(next,args){return super.retry(next,args,{beforeRequest:async()=>{return this.rateLimiter.getSendToken()},afterRequest:(response)=>{this.rateLimiter.updateClientSendingRate(response)}})}}var ENV_MAX_ATTEMPTS="AWS_MAX_ATTEMPTS",CONFIG_MAX_ATTEMPTS="max_attempts",NODE_MAX_ATTEMPT_CONFIG_OPTIONS={environmentVariableSelector:(env3)=>{let value=env3[ENV_MAX_ATTEMPTS];if(!value)return;let maxAttempt=parseInt(value);if(Number.isNaN(maxAttempt))throw Error(`Environment variable ${ENV_MAX_ATTEMPTS} mast be a number, got "${value}"`);return maxAttempt},configFileSelector:(profile)=>{let value=profile[CONFIG_MAX_ATTEMPTS];if(!value)return;let maxAttempt=parseInt(value);if(Number.isNaN(maxAttempt))throw Error(`Shared config file entry ${CONFIG_MAX_ATTEMPTS} mast be a number, got "${value}"`);return maxAttempt},default:utilRetry.DEFAULT_MAX_ATTEMPTS},resolveRetryConfig=(input)=>{let{retryStrategy,retryMode:_retryMode,maxAttempts:_maxAttempts}=input,maxAttempts=utilMiddleware.normalizeProvider(_maxAttempts??utilRetry.DEFAULT_MAX_ATTEMPTS);return Object.assign(input,{maxAttempts,retryStrategy:async()=>{if(retryStrategy)return retryStrategy;if(await utilMiddleware.normalizeProvider(_retryMode)()===utilRetry.RETRY_MODES.ADAPTIVE)return new utilRetry.AdaptiveRetryStrategy(maxAttempts);return new utilRetry.StandardRetryStrategy(maxAttempts)}})},ENV_RETRY_MODE="AWS_RETRY_MODE",CONFIG_RETRY_MODE="retry_mode",NODE_RETRY_MODE_CONFIG_OPTIONS={environmentVariableSelector:(env3)=>env3[ENV_RETRY_MODE],configFileSelector:(profile)=>profile[CONFIG_RETRY_MODE],default:utilRetry.DEFAULT_RETRY_MODE},omitRetryHeadersMiddleware=()=>(next)=>async(args)=>{let{request}=args;if(protocolHttp.HttpRequest.isInstance(request))delete request.headers[utilRetry.INVOCATION_ID_HEADER],delete request.headers[utilRetry.REQUEST_HEADER];return next(args)},omitRetryHeadersMiddlewareOptions={name:"omitRetryHeadersMiddleware",tags:["RETRY","HEADERS","OMIT_RETRY_HEADERS"],relation:"before",toMiddleware:"awsAuthMiddleware",override:!0},getOmitRetryHeadersPlugin=(options)=>({applyToStack:(clientStack)=>{clientStack.addRelativeTo(omitRetryHeadersMiddleware(),omitRetryHeadersMiddlewareOptions)}}),retryMiddleware=(options)=>(next,context)=>async(args)=>{let retryStrategy=await options.retryStrategy(),maxAttempts=await options.maxAttempts();if(isRetryStrategyV2(retryStrategy)){retryStrategy=retryStrategy;let retryToken=await retryStrategy.acquireInitialRetryToken(context.partition_id),lastError=Error(),attempts=0,totalRetryDelay=0,{request}=args,isRequest=protocolHttp.HttpRequest.isInstance(request);if(isRequest)request.headers[utilRetry.INVOCATION_ID_HEADER]=uuid2.v4();while(!0)try{if(isRequest)request.headers[utilRetry.REQUEST_HEADER]=`attempt=${attempts+1}; max=${maxAttempts}`;let{response,output}=await next(args);return retryStrategy.recordSuccess(retryToken),output.$metadata.attempts=attempts+1,output.$metadata.totalRetryDelay=totalRetryDelay,{response,output}}catch(e){let retryErrorInfo=getRetryErrorInfo(e);if(lastError=asSdkError(e),isRequest&&isStreamingPayload.isStreamingPayload(request))throw(context.logger instanceof smithyClient.NoOpLogger?console:context.logger)?.warn("An error was encountered in a non-retryable streaming request."),lastError;try{retryToken=await retryStrategy.refreshRetryTokenForRetry(retryToken,retryErrorInfo)}catch(refreshError){if(!lastError.$metadata)lastError.$metadata={};throw lastError.$metadata.attempts=attempts+1,lastError.$metadata.totalRetryDelay=totalRetryDelay,lastError}attempts=retryToken.getRetryCount();let delay=retryToken.getRetryDelay();totalRetryDelay+=delay,await new Promise((resolve)=>setTimeout(resolve,delay))}}else{if(retryStrategy=retryStrategy,retryStrategy?.mode)context.userAgent=[...context.userAgent||[],["cfg/retry-mode",retryStrategy.mode]];return retryStrategy.retry(next,args)}},isRetryStrategyV2=(retryStrategy)=>typeof retryStrategy.acquireInitialRetryToken<"u"&&typeof retryStrategy.refreshRetryTokenForRetry<"u"&&typeof retryStrategy.recordSuccess<"u",getRetryErrorInfo=(error)=>{let errorInfo={error,errorType:getRetryErrorType(error)},retryAfterHint=getRetryAfterHint(error.$response);if(retryAfterHint)errorInfo.retryAfterHint=retryAfterHint;return errorInfo},getRetryErrorType=(error)=>{if(serviceErrorClassification.isThrottlingError(error))return"THROTTLING";if(serviceErrorClassification.isTransientError(error))return"TRANSIENT";if(serviceErrorClassification.isServerError(error))return"SERVER_ERROR";return"CLIENT_ERROR"},retryMiddlewareOptions={name:"retryMiddleware",tags:["RETRY"],step:"finalizeRequest",priority:"high",override:!0},getRetryPlugin=(options)=>({applyToStack:(clientStack)=>{clientStack.add(retryMiddleware(options),retryMiddlewareOptions)}}),getRetryAfterHint=(response)=>{if(!protocolHttp.HttpResponse.isInstance(response))return;let retryAfterHeaderName=Object.keys(response.headers).find((key)=>key.toLowerCase()==="retry-after");if(!retryAfterHeaderName)return;let retryAfter=response.headers[retryAfterHeaderName],retryAfterSeconds=Number(retryAfter);if(!Number.isNaN(retryAfterSeconds))return new Date(retryAfterSeconds*1000);return new Date(retryAfter)};exports.AdaptiveRetryStrategy=AdaptiveRetryStrategy;exports.CONFIG_MAX_ATTEMPTS=CONFIG_MAX_ATTEMPTS;exports.CONFIG_RETRY_MODE=CONFIG_RETRY_MODE;exports.ENV_MAX_ATTEMPTS=ENV_MAX_ATTEMPTS;exports.ENV_RETRY_MODE=ENV_RETRY_MODE;exports.NODE_MAX_ATTEMPT_CONFIG_OPTIONS=NODE_MAX_ATTEMPT_CONFIG_OPTIONS;exports.NODE_RETRY_MODE_CONFIG_OPTIONS=NODE_RETRY_MODE_CONFIG_OPTIONS;exports.StandardRetryStrategy=StandardRetryStrategy;exports.defaultDelayDecider=defaultDelayDecider;exports.defaultRetryDecider=defaultRetryDecider;exports.getOmitRetryHeadersPlugin=getOmitRetryHeadersPlugin;exports.getRetryAfterHint=getRetryAfterHint;exports.getRetryPlugin=getRetryPlugin;exports.omitRetryHeadersMiddleware=omitRetryHeadersMiddleware;exports.omitRetryHeadersMiddlewareOptions=omitRetryHeadersMiddlewareOptions;exports.resolveRetryConfig=resolveRetryConfig;exports.retryMiddleware=retryMiddleware;exports.retryMiddlewareOptions=retryMiddlewareOptions});var import_client,import_property_provider,ENV_KEY="AWS_ACCESS_KEY_ID",ENV_SECRET="AWS_SECRET_ACCESS_KEY",ENV_SESSION="AWS_SESSION_TOKEN",ENV_EXPIRATION="AWS_CREDENTIAL_EXPIRATION",ENV_CREDENTIAL_SCOPE="AWS_CREDENTIAL_SCOPE",ENV_ACCOUNT_ID="AWS_ACCOUNT_ID",fromEnv=(init)=>async()=>{init?.logger?.debug("@aws-sdk/credential-provider-env - fromEnv");let accessKeyId=process.env[ENV_KEY],secretAccessKey=process.env[ENV_SECRET],sessionToken=process.env[ENV_SESSION],expiry=process.env[ENV_EXPIRATION],credentialScope=process.env[ENV_CREDENTIAL_SCOPE],accountId=process.env[ENV_ACCOUNT_ID];if(accessKeyId&&secretAccessKey){let credentials={accessKeyId,secretAccessKey,...sessionToken&&{sessionToken},...expiry&&{expiration:new Date(expiry)},...credentialScope&&{credentialScope},...accountId&&{accountId}};return import_client.setCredentialFeature(credentials,"CREDENTIALS_ENV_VARS","g"),credentials}throw new import_property_provider.CredentialsProviderError("Unable to find environment variable credentials.",{logger:init?.logger})};var init_fromEnv=__esm(()=>{import_client=__toESM(require_client(),1),import_property_provider=__toESM(require_dist_cjs17(),1)});var exports_dist_es={};__export(exports_dist_es,{fromEnv:()=>fromEnv,ENV_SESSION:()=>ENV_SESSION,ENV_SECRET:()=>ENV_SECRET,ENV_KEY:()=>ENV_KEY,ENV_EXPIRATION:()=>ENV_EXPIRATION,ENV_CREDENTIAL_SCOPE:()=>ENV_CREDENTIAL_SCOPE,ENV_ACCOUNT_ID:()=>ENV_ACCOUNT_ID});var init_dist_es=__esm(()=>{init_fromEnv()});import{Buffer as Buffer3}from"buffer";import{request}from"http";function httpRequest(options){return new Promise((resolve,reject)=>{let req=request({method:"GET",...options,hostname:options.hostname?.replace(/^\[(.+)\]$/,"$1")});req.on("error",(err)=>{reject(Object.assign(new import_property_provider2.ProviderError("Unable to connect to instance metadata service"),err)),req.destroy()}),req.on("timeout",()=>{reject(new import_property_provider2.ProviderError("TimeoutError from instance metadata service")),req.destroy()}),req.on("response",(res)=>{let{statusCode=400}=res;if(statusCode<200||300<=statusCode)reject(Object.assign(new import_property_provider2.ProviderError("Error response received from instance metadata service"),{statusCode})),req.destroy();let chunks=[];res.on("data",(chunk)=>{chunks.push(chunk)}),res.on("end",()=>{resolve(Buffer3.concat(chunks)),req.destroy()})}),req.end()})}var import_property_provider2;var init_httpRequest=__esm(()=>{import_property_provider2=__toESM(require_dist_cjs17(),1)});var isImdsCredentials=(arg)=>Boolean(arg)&&typeof arg==="object"&&typeof arg.AccessKeyId==="string"&&typeof arg.SecretAccessKey==="string"&&typeof arg.Token==="string"&&typeof arg.Expiration==="string",fromImdsCredentials=(creds)=>({accessKeyId:creds.AccessKeyId,secretAccessKey:creds.SecretAccessKey,sessionToken:creds.Token,expiration:new Date(creds.Expiration),...creds.AccountId&&{accountId:creds.AccountId}});var DEFAULT_TIMEOUT=1000,DEFAULT_MAX_RETRIES=0,providerConfigFromInit=({maxRetries=0,timeout=1000})=>({maxRetries,timeout});var retry=(toRetry,maxRetries)=>{let promise=toRetry();for(let i=0;i<maxRetries;i++)promise=promise.catch(toRetry);return promise};import{parse as parse4}from"url";var import_property_provider3,ENV_CMDS_FULL_URI="AWS_CONTAINER_CREDENTIALS_FULL_URI",ENV_CMDS_RELATIVE_URI="AWS_CONTAINER_CREDENTIALS_RELATIVE_URI",ENV_CMDS_AUTH_TOKEN="AWS_CONTAINER_AUTHORIZATION_TOKEN",fromContainerMetadata=(init={})=>{let{timeout,maxRetries}=providerConfigFromInit(init);return()=>retry(async()=>{let requestOptions=await getCmdsUri({logger:init.logger}),credsResponse=JSON.parse(await requestFromEcsImds(timeout,requestOptions));if(!isImdsCredentials(credsResponse))throw new import_property_provider3.CredentialsProviderError("Invalid response received from instance metadata service.",{logger:init.logger});return fromImdsCredentials(credsResponse)},maxRetries)},requestFromEcsImds=async(timeout,options)=>{if(process.env[ENV_CMDS_AUTH_TOKEN])options.headers={...options.headers,Authorization:process.env[ENV_CMDS_AUTH_TOKEN]};return(await httpRequest({...options,timeout})).toString()},CMDS_IP="169.254.170.2",GREENGRASS_HOSTS,GREENGRASS_PROTOCOLS,getCmdsUri=async({logger})=>{if(process.env[ENV_CMDS_RELATIVE_URI])return{hostname:CMDS_IP,path:process.env[ENV_CMDS_RELATIVE_URI]};if(process.env[ENV_CMDS_FULL_URI]){let parsed=parse4(process.env[ENV_CMDS_FULL_URI]);if(!parsed.hostname||!(parsed.hostname in GREENGRASS_HOSTS))throw new import_property_provider3.CredentialsProviderError(`${parsed.hostname} is not a valid container metadata service hostname`,{tryNextLink:!1,logger});if(!parsed.protocol||!(parsed.protocol in GREENGRASS_PROTOCOLS))throw new import_property_provider3.CredentialsProviderError(`${parsed.protocol} is not a valid container metadata service protocol`,{tryNextLink:!1,logger});return{...parsed,port:parsed.port?parseInt(parsed.port,10):void 0}}throw new import_property_provider3.CredentialsProviderError(`The container metadata credential provider cannot be used unless the ${ENV_CMDS_RELATIVE_URI} or ${ENV_CMDS_FULL_URI} environment variable is set`,{tryNextLink:!1,logger})};var init_fromContainerMetadata=__esm(()=>{init_httpRequest();import_property_provider3=__toESM(require_dist_cjs17(),1),GREENGRASS_HOSTS={localhost:!0,"127.0.0.1":!0},GREENGRASS_PROTOCOLS={"http:":!0,"https:":!0}});var import_property_provider4,InstanceMetadataV1FallbackError;var init_InstanceMetadataV1FallbackError=__esm(()=>{import_property_provider4=__toESM(require_dist_cjs17(),1);InstanceMetadataV1FallbackError=class InstanceMetadataV1FallbackError extends import_property_provider4.CredentialsProviderError{tryNextLink;name="InstanceMetadataV1FallbackError";constructor(message,tryNextLink=!0){super(message,tryNextLink);this.tryNextLink=tryNextLink,Object.setPrototypeOf(this,InstanceMetadataV1FallbackError.prototype)}}});var Endpoint;var init_Endpoint=__esm(()=>{(function(Endpoint2){Endpoint2.IPv4="http://169.254.169.254",Endpoint2.IPv6="http://[fd00:ec2::254]"})(Endpoint||(Endpoint={}))});var ENDPOINT_CONFIG_OPTIONS;var init_EndpointConfigOptions=__esm(()=>{ENDPOINT_CONFIG_OPTIONS={environmentVariableSelector:(env3)=>env3.AWS_EC2_METADATA_SERVICE_ENDPOINT,configFileSelector:(profile)=>profile.ec2_metadata_service_endpoint,default:void 0}});var EndpointMode;var init_EndpointMode=__esm(()=>{(function(EndpointMode2){EndpointMode2.IPv4="IPv4",EndpointMode2.IPv6="IPv6"})(EndpointMode||(EndpointMode={}))});var ENV_ENDPOINT_MODE_NAME="AWS_EC2_METADATA_SERVICE_ENDPOINT_MODE",CONFIG_ENDPOINT_MODE_NAME="ec2_metadata_service_endpoint_mode",ENDPOINT_MODE_CONFIG_OPTIONS;var init_EndpointModeConfigOptions=__esm(()=>{init_EndpointMode();ENDPOINT_MODE_CONFIG_OPTIONS={environmentVariableSelector:(env3)=>env3[ENV_ENDPOINT_MODE_NAME],configFileSelector:(profile)=>profile[CONFIG_ENDPOINT_MODE_NAME],default:EndpointMode.IPv4}});var import_node_config_provider,import_url_parser,getInstanceMetadataEndpoint=async()=>import_url_parser.parseUrl(await getFromEndpointConfig()||await getFromEndpointModeConfig()),getFromEndpointConfig=async()=>import_node_config_provider.loadConfig(ENDPOINT_CONFIG_OPTIONS)(),getFromEndpointModeConfig=async()=>{let endpointMode=await import_node_config_provider.loadConfig(ENDPOINT_MODE_CONFIG_OPTIONS)();switch(endpointMode){case EndpointMode.IPv4:return Endpoint.IPv4;case EndpointMode.IPv6:return Endpoint.IPv6;default:throw Error(`Unsupported endpoint mode: ${endpointMode}. Select from ${Object.values(EndpointMode)}`)}};var init_getInstanceMetadataEndpoint=__esm(()=>{init_Endpoint();init_EndpointConfigOptions();init_EndpointMode();init_EndpointModeConfigOptions();import_node_config_provider=__toESM(require_dist_cjs36(),1),import_url_parser=__toESM(require_dist_cjs30(),1)});var getExtendedInstanceMetadataCredentials=(credentials,logger)=>{let refreshInterval=300+Math.floor(Math.random()*300),newExpiration=new Date(Date.now()+refreshInterval*1000);logger.warn(`Attempting credential expiration extension due to a credential service availability issue. A refresh of these credentials will be attempted after ${new Date(newExpiration)}.
For more information, please visit: https://docs.aws.amazon.com/sdkref/latest/guide/feature-static-credentials.html`);let originalExpiration=credentials.originalExpiration??credentials.expiration;return{...credentials,...originalExpiration?{originalExpiration}:{},expiration:newExpiration}};var staticStabilityProvider=(provider,options={})=>{let logger=options?.logger||console,pastCredentials;return async()=>{let credentials;try{if(credentials=await provider(),credentials.expiration&&credentials.expiration.getTime()<Date.now())credentials=getExtendedInstanceMetadataCredentials(credentials,logger)}catch(e){if(pastCredentials)logger.warn("Credential renew failed: ",e),credentials=getExtendedInstanceMetadataCredentials(pastCredentials,logger);else throw e}return pastCredentials=credentials,credentials}};var init_staticStabilityProvider=()=>{};var import_node_config_provider2,import_property_provider5,IMDS_PATH="/latest/meta-data/iam/security-credentials/",IMDS_TOKEN_PATH="/latest/api/token",AWS_EC2_METADATA_V1_DISABLED="AWS_EC2_METADATA_V1_DISABLED",PROFILE_AWS_EC2_METADATA_V1_DISABLED="ec2_metadata_v1_disabled",X_AWS_EC2_METADATA_TOKEN="x-aws-ec2-metadata-token",fromInstanceMetadata=(init={})=>staticStabilityProvider(getInstanceMetadataProvider(init),{logger:init.logger}),getInstanceMetadataProvider=(init={})=>{let disableFetchToken=!1,{logger,profile}=init,{timeout,maxRetries}=providerConfigFromInit(init),getCredentials=async(maxRetries2,options)=>{if(disableFetchToken||options.headers?.[X_AWS_EC2_METADATA_TOKEN]==null){let fallbackBlockedFromProfile=!1,fallbackBlockedFromProcessEnv=!1,configValue=await import_node_config_provider2.loadConfig({environmentVariableSelector:(env3)=>{let envValue=env3[AWS_EC2_METADATA_V1_DISABLED];if(fallbackBlockedFromProcessEnv=!!envValue&&envValue!=="false",envValue===void 0)throw new import_property_provider5.CredentialsProviderError(`${AWS_EC2_METADATA_V1_DISABLED} not set in env, checking config file next.`,{logger:init.logger});return fallbackBlockedFromProcessEnv},configFileSelector:(profile2)=>{let profileValue=profile2[PROFILE_AWS_EC2_METADATA_V1_DISABLED];return fallbackBlockedFromProfile=!!profileValue&&profileValue!=="false",fallbackBlockedFromProfile},default:!1},{profile})();if(init.ec2MetadataV1Disabled||configValue){let causes=[];if(init.ec2MetadataV1Disabled)causes.push("credential provider initialization (runtime option ec2MetadataV1Disabled)");if(fallbackBlockedFromProfile)causes.push(`config file profile (${PROFILE_AWS_EC2_METADATA_V1_DISABLED})`);if(fallbackBlockedFromProcessEnv)causes.push(`process environment variable (${AWS_EC2_METADATA_V1_DISABLED})`);throw new InstanceMetadataV1FallbackError(`AWS EC2 Metadata v1 fallback has been blocked by AWS SDK configuration in the following: [${causes.join(", ")}].`)}}let imdsProfile=(await retry(async()=>{let profile2;try{profile2=await getProfile(options)}catch(err){if(err.statusCode===401)disableFetchToken=!1;throw err}return profile2},maxRetries2)).trim();return retry(async()=>{let creds;try{creds=await getCredentialsFromProfile(imdsProfile,options,init)}catch(err){if(err.statusCode===401)disableFetchToken=!1;throw err}return creds},maxRetries2)};return async()=>{let endpoint=await getInstanceMetadataEndpoint();if(disableFetchToken)return logger?.debug("AWS SDK Instance Metadata","using v1 fallback (no token fetch)"),getCredentials(maxRetries,{...endpoint,timeout});else{let token;try{token=(await getMetadataToken({...endpoint,timeout})).toString()}catch(error){if(error?.statusCode===400)throw Object.assign(error,{message:"EC2 Metadata token request returned error"});else if(error.message==="TimeoutError"||[403,404,405].includes(error.statusCode))disableFetchToken=!0;return logger?.debug("AWS SDK Instance Metadata","using v1 fallback (initial)"),getCredentials(maxRetries,{...endpoint,timeout})}return getCredentials(maxRetries,{...endpoint,headers:{[X_AWS_EC2_METADATA_TOKEN]:token},timeout})}}},getMetadataToken=async(options)=>httpRequest({...options,path:IMDS_TOKEN_PATH,method:"PUT",headers:{"x-aws-ec2-metadata-token-ttl-seconds":"21600"}}),getProfile=async(options)=>(await httpRequest({...options,path:IMDS_PATH})).toString(),getCredentialsFromProfile=async(profile,options,init)=>{let credentialsResponse=JSON.parse((await httpRequest({...options,path:IMDS_PATH+profile})).toString());if(!isImdsCredentials(credentialsResponse))throw new import_property_provider5.CredentialsProviderError("Invalid response received from instance metadata service.",{logger:init.logger});return fromImdsCredentials(credentialsResponse)};var init_fromInstanceMetadata=__esm(()=>{init_InstanceMetadataV1FallbackError();init_httpRequest();init_getInstanceMetadataEndpoint();init_staticStabilityProvider();import_node_config_provider2=__toESM(require_dist_cjs36(),1),import_property_provider5=__toESM(require_dist_cjs17(),1)});var init_types=()=>{};var exports_dist_es2={};__export(exports_dist_es2,{providerConfigFromInit:()=>providerConfigFromInit,httpRequest:()=>httpRequest,getInstanceMetadataEndpoint:()=>getInstanceMetadataEndpoint,fromInstanceMetadata:()=>fromInstanceMetadata,fromContainerMetadata:()=>fromContainerMetadata,Endpoint:()=>Endpoint,ENV_CMDS_RELATIVE_URI:()=>ENV_CMDS_RELATIVE_URI,ENV_CMDS_FULL_URI:()=>ENV_CMDS_FULL_URI,ENV_CMDS_AUTH_TOKEN:()=>ENV_CMDS_AUTH_TOKEN,DEFAULT_TIMEOUT:()=>DEFAULT_TIMEOUT,DEFAULT_MAX_RETRIES:()=>DEFAULT_MAX_RETRIES});var init_dist_es2=__esm(()=>{init_httpRequest();init_getInstanceMetadataEndpoint();init_Endpoint();init_fromContainerMetadata();init_fromInstanceMetadata();init_types()});var import_property_provider6,ECS_CONTAINER_HOST="169.254.170.2",EKS_CONTAINER_HOST_IPv4="169.254.170.23",EKS_CONTAINER_HOST_IPv6="[fd00:ec2::23]",checkUrl=(url,logger)=>{if(url.protocol==="https:")return;if(url.hostname===ECS_CONTAINER_HOST||url.hostname===EKS_CONTAINER_HOST_IPv4||url.hostname===EKS_CONTAINER_HOST_IPv6)return;if(url.hostname.includes("[")){if(url.hostname==="[::1]"||url.hostname==="[0000:0000:0000:0000:0000:0000:0000:0001]")return}else{if(url.hostname==="localhost")return;let ipComponents=url.hostname.split("."),inRange=(component)=>{let num=parseInt(component,10);return 0<=num&&num<=255};if(ipComponents[0]==="127"&&inRange(ipComponents[1])&&inRange(ipComponents[2])&&inRange(ipComponents[3])&&ipComponents.length===4)return}throw new import_property_provider6.CredentialsProviderError(`URL not accepted. It must either be HTTPS or match one of the following:
  - loopback CIDR 127.0.0.0/8 or [::1/128]
  - ECS container host 169.254.170.2
  - EKS container host 169.254.170.23 or [fd00:ec2::23]`,{logger})};var init_checkUrl=__esm(()=>{import_property_provider6=__toESM(require_dist_cjs17(),1)});function createGetRequest(url){return new import_protocol_http9.HttpRequest({protocol:url.protocol,hostname:url.hostname,port:Number(url.port),path:url.pathname,query:Array.from(url.searchParams.entries()).reduce((acc,[k2,v])=>{return acc[k2]=v,acc},{}),fragment:url.hash})}async function getCredentials(response,logger){let str=await import_util_stream4.sdkStreamMixin(response.body).transformToString();if(response.statusCode===200){let parsed=JSON.parse(str);if(typeof parsed.AccessKeyId!=="string"||typeof parsed.SecretAccessKey!=="string"||typeof parsed.Token!=="string"||typeof parsed.Expiration!=="string")throw new import_property_provider7.CredentialsProviderError("HTTP credential provider response not of the required format, an object matching: { AccessKeyId: string, SecretAccessKey: string, Token: string, Expiration: string(rfc3339) }",{logger});return{accessKeyId:parsed.AccessKeyId,secretAccessKey:parsed.SecretAccessKey,sessionToken:parsed.Token,expiration:import_smithy_client5.parseRfc3339DateTime(parsed.Expiration)}}if(response.statusCode>=400&&response.statusCode<500){let parsedBody={};try{parsedBody=JSON.parse(str)}catch(e){}throw Object.assign(new import_property_provider7.CredentialsProviderError(`Server responded with status: ${response.statusCode}`,{logger}),{Code:parsedBody.Code,Message:parsedBody.Message})}throw new import_property_provider7.CredentialsProviderError(`Server responded with status: ${response.statusCode}`,{logger})}var import_property_provider7,import_protocol_http9,import_smithy_client5,import_util_stream4;var init_requestHelpers=__esm(()=>{import_property_provider7=__toESM(require_dist_cjs17(),1),import_protocol_http9=__toESM(require_dist_cjs2(),1),import_smithy_client5=__toESM(require_dist_cjs21(),1),import_util_stream4=__toESM(require_dist_cjs14(),1)});var retryWrapper=(toRetry,maxRetries,delayMs)=>{return async()=>{for(let i=0;i<maxRetries;++i)try{return await toRetry()}catch(e){await new Promise((resolve)=>setTimeout(resolve,delayMs))}return await toRetry()}};import fs2 from"fs/promises";var import_client2,import_node_http_handler,import_property_provider8,AWS_CONTAINER_CREDENTIALS_RELATIVE_URI="AWS_CONTAINER_CREDENTIALS_RELATIVE_URI",DEFAULT_LINK_LOCAL_HOST="http://169.254.170.2",AWS_CONTAINER_CREDENTIALS_FULL_URI="AWS_CONTAINER_CREDENTIALS_FULL_URI",AWS_CONTAINER_AUTHORIZATION_TOKEN_FILE="AWS_CONTAINER_AUTHORIZATION_TOKEN_FILE",AWS_CONTAINER_AUTHORIZATION_TOKEN="AWS_CONTAINER_AUTHORIZATION_TOKEN",fromHttp=(options={})=>{options.logger?.debug("@aws-sdk/credential-provider-http - fromHttp");let host,relative=options.awsContainerCredentialsRelativeUri??process.env[AWS_CONTAINER_CREDENTIALS_RELATIVE_URI],full=options.awsContainerCredentialsFullUri??process.env[AWS_CONTAINER_CREDENTIALS_FULL_URI],token=options.awsContainerAuthorizationToken??process.env[AWS_CONTAINER_AUTHORIZATION_TOKEN],tokenFile=options.awsContainerAuthorizationTokenFile??process.env[AWS_CONTAINER_AUTHORIZATION_TOKEN_FILE],warn=options.logger?.constructor?.name==="NoOpLogger"||!options.logger?.warn?console.warn:options.logger.warn.bind(options.logger);if(relative&&full)warn("@aws-sdk/credential-provider-http: you have set both awsContainerCredentialsRelativeUri and awsContainerCredentialsFullUri."),warn("awsContainerCredentialsFullUri will take precedence.");if(token&&tokenFile)warn("@aws-sdk/credential-provider-http: you have set both awsContainerAuthorizationToken and awsContainerAuthorizationTokenFile."),warn("awsContainerAuthorizationToken will take precedence.");if(full)host=full;else if(relative)host=`${DEFAULT_LINK_LOCAL_HOST}${relative}`;else throw new import_property_provider8.CredentialsProviderError(`No HTTP credential provider host provided.
Set AWS_CONTAINER_CREDENTIALS_FULL_URI or AWS_CONTAINER_CREDENTIALS_RELATIVE_URI.`,{logger:options.logger});let url=new URL(host);checkUrl(url,options.logger);let requestHandler=import_node_http_handler.NodeHttpHandler.create({requestTimeout:options.timeout??1000,connectionTimeout:options.timeout??1000});return retryWrapper(async()=>{let request2=createGetRequest(url);if(token)request2.headers.Authorization=token;else if(tokenFile)request2.headers.Authorization=(await fs2.readFile(tokenFile)).toString();try{let result2=await requestHandler.handle(request2);return getCredentials(result2.response).then((creds)=>import_client2.setCredentialFeature(creds,"CREDENTIALS_HTTP","z"))}catch(e){throw new import_property_provider8.CredentialsProviderError(String(e),{logger:options.logger})}},options.maxRetries??3,options.timeout??1000)};var init_fromHttp=__esm(()=>{init_checkUrl();init_requestHelpers();import_client2=__toESM(require_client(),1),import_node_http_handler=__toESM(require_dist_cjs11(),1),import_property_provider8=__toESM(require_dist_cjs17(),1)});var exports_dist_es3={};__export(exports_dist_es3,{fromHttp:()=>fromHttp});var init_dist_es3=__esm(()=>{init_fromHttp()});var isSsoProfile=(arg)=>arg&&(typeof arg.sso_start_url==="string"||typeof arg.sso_account_id==="string"||typeof arg.sso_session==="string"||typeof arg.sso_region==="string"||typeof arg.sso_role_name==="string");var init_fromEnvSigningName=()=>{};var EXPIRE_WINDOW_MS=300000,REFRESH_MESSAGE="To refresh this SSO session run 'aws sso login' with the corresponding profile.";var require_httpAuthSchemeProvider=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.resolveHttpAuthSchemeConfig=exports.defaultSSOOIDCHttpAuthSchemeProvider=exports.defaultSSOOIDCHttpAuthSchemeParametersProvider=void 0;var core_1=require_dist_cjs23(),util_middleware_1=require_dist_cjs3(),defaultSSOOIDCHttpAuthSchemeParametersProvider=async(config,context,input)=>{return{operation:(0,util_middleware_1.getSmithyContext)(context).operation,region:await(0,util_middleware_1.normalizeProvider)(config.region)()||(()=>{throw Error("expected `region` to be configured for `aws.auth#sigv4`")})()}};exports.defaultSSOOIDCHttpAuthSchemeParametersProvider=defaultSSOOIDCHttpAuthSchemeParametersProvider;function createAwsAuthSigv4HttpAuthOption2(authParameters){return{schemeId:"aws.auth#sigv4",signingProperties:{name:"sso-oauth",region:authParameters.region},propertiesExtractor:(config,context)=>({signingProperties:{config,context}})}}function createSmithyApiNoAuthHttpAuthOption(authParameters){return{schemeId:"smithy.api#noAuth"}}var defaultSSOOIDCHttpAuthSchemeProvider=(authParameters)=>{let options=[];switch(authParameters.operation){case"CreateToken":{options.push(createSmithyApiNoAuthHttpAuthOption(authParameters));break}default:options.push(createAwsAuthSigv4HttpAuthOption2(authParameters))}return options};exports.defaultSSOOIDCHttpAuthSchemeProvider=defaultSSOOIDCHttpAuthSchemeProvider;var resolveHttpAuthSchemeConfig2=(config)=>{let config_0=(0,core_1.resolveAwsSdkSigV4Config)(config);return Object.assign(config_0,{authSchemePreference:(0,util_middleware_1.normalizeProvider)(config.authSchemePreference??[])})};exports.resolveHttpAuthSchemeConfig=resolveHttpAuthSchemeConfig2});var require_package2=__commonJS((exports,module)=>{module.exports={name:"@aws-sdk/nested-clients",version:"3.988.0",description:"Nested clients for AWS SDK packages.",main:"./dist-cjs/index.js",module:"./dist-es/index.js",types:"./dist-types/index.d.ts",scripts:{build:"yarn lint && concurrently 'yarn:build:types' 'yarn:build:es' && yarn build:cjs","build:cjs":"node ../../scripts/compilation/inline nested-clients","build:es":"tsc -p tsconfig.es.json","build:include:deps":'yarn g:turbo run build -F="$npm_package_name"',"build:types":"tsc -p tsconfig.types.json","build:types:downlevel":"downlevel-dts dist-types dist-types/ts3.4",clean:"premove dist-cjs dist-es dist-types tsconfig.cjs.tsbuildinfo tsconfig.es.tsbuildinfo tsconfig.types.tsbuildinfo",lint:"node ../../scripts/validation/submodules-linter.js --pkg nested-clients",test:"yarn g:vitest run","test:watch":"yarn g:vitest watch"},engines:{node:">=20.0.0"},sideEffects:!1,author:{name:"AWS SDK for JavaScript Team",url:"https://aws.amazon.com/javascript/"},license:"Apache-2.0",dependencies:{"@aws-crypto/sha256-browser":"5.2.0","@aws-crypto/sha256-js":"5.2.0","@aws-sdk/core":"^3.973.8","@aws-sdk/middleware-host-header":"^3.972.3","@aws-sdk/middleware-logger":"^3.972.3","@aws-sdk/middleware-recursion-detection":"^3.972.3","@aws-sdk/middleware-user-agent":"^3.972.8","@aws-sdk/region-config-resolver":"^3.972.3","@aws-sdk/types":"^3.973.1","@aws-sdk/util-endpoints":"3.988.0","@aws-sdk/util-user-agent-browser":"^3.972.3","@aws-sdk/util-user-agent-node":"^3.972.6","@smithy/config-resolver":"^4.4.6","@smithy/core":"^3.23.0","@smithy/fetch-http-handler":"^5.3.9","@smithy/hash-node":"^4.2.8","@smithy/invalid-dependency":"^4.2.8","@smithy/middleware-content-length":"^4.2.8","@smithy/middleware-endpoint":"^4.4.14","@smithy/middleware-retry":"^4.4.31","@smithy/middleware-serde":"^4.2.9","@smithy/middleware-stack":"^4.2.8","@smithy/node-config-provider":"^4.3.8","@smithy/node-http-handler":"^4.4.10","@smithy/protocol-http":"^5.3.8","@smithy/smithy-client":"^4.11.3","@smithy/types":"^4.12.0","@smithy/url-parser":"^4.2.8","@smithy/util-base64":"^4.3.0","@smithy/util-body-length-browser":"^4.2.0","@smithy/util-body-length-node":"^4.2.1","@smithy/util-defaults-mode-browser":"^4.3.30","@smithy/util-defaults-mode-node":"^4.2.33","@smithy/util-endpoints":"^3.2.8","@smithy/util-middleware":"^4.2.8","@smithy/util-retry":"^4.2.8","@smithy/util-utf8":"^4.2.0",tslib:"^2.6.2"},devDependencies:{concurrently:"7.0.0","downlevel-dts":"0.10.1",premove:"4.0.0",typescript:"~5.8.3"},typesVersions:{"<4.0":{"dist-types/*":["dist-types/ts3.4/*"]}},files:["./signin.d.ts","./signin.js","./sso-oidc.d.ts","./sso-oidc.js","./sts.d.ts","./sts.js","dist-*/**"],browser:{"./dist-es/submodules/signin/runtimeConfig":"./dist-es/submodules/signin/runtimeConfig.browser","./dist-es/submodules/sso-oidc/runtimeConfig":"./dist-es/submodules/sso-oidc/runtimeConfig.browser","./dist-es/submodules/sts/runtimeConfig":"./dist-es/submodules/sts/runtimeConfig.browser"},"react-native":{},homepage:"https://github.com/aws/aws-sdk-js-v3/tree/main/packages/nested-clients",repository:{type:"git",url:"https://github.com/aws/aws-sdk-js-v3.git",directory:"packages/nested-clients"},exports:{"./package.json":"./package.json","./sso-oidc":{types:"./dist-types/submodules/sso-oidc/index.d.ts",module:"./dist-es/submodules/sso-oidc/index.js",node:"./dist-cjs/submodules/sso-oidc/index.js",import:"./dist-es/submodules/sso-oidc/index.js",require:"./dist-cjs/submodules/sso-oidc/index.js"},"./sts":{types:"./dist-types/submodules/sts/index.d.ts",module:"./dist-es/submodules/sts/index.js",node:"./dist-cjs/submodules/sts/index.js",import:"./dist-es/submodules/sts/index.js",require:"./dist-cjs/submodules/sts/index.js"},"./signin":{types:"./dist-types/submodules/signin/index.d.ts",module:"./dist-es/submodules/signin/index.js",node:"./dist-cjs/submodules/signin/index.js",import:"./dist-es/submodules/signin/index.js",require:"./dist-cjs/submodules/signin/index.js"}}}});var require_dist_cjs41=__commonJS((exports)=>{var os2=__require("os"),process2=__require("process"),middlewareUserAgent=require_dist_cjs32(),crtAvailability={isCrtAvailable:!1},isCrtAvailable=()=>{if(crtAvailability.isCrtAvailable)return["md/crt-avail"];return null},createDefaultUserAgentProvider=({serviceId,clientVersion})=>{return async(config)=>{let sections=[["aws-sdk-js",clientVersion],["ua","2.1"],[`os/${os2.platform()}`,os2.release()],["lang/js"],["md/nodejs",`${process2.versions.node}`]],crtAvailable=isCrtAvailable();if(crtAvailable)sections.push(crtAvailable);if(serviceId)sections.push([`api/${serviceId}`,clientVersion]);if(process2.env.AWS_EXECUTION_ENV)sections.push([`exec-env/${process2.env.AWS_EXECUTION_ENV}`]);let appId=await config?.userAgentAppId?.();return appId?[...sections,[`app/${appId}`]]:[...sections]}},defaultUserAgent=createDefaultUserAgentProvider,UA_APP_ID_ENV_NAME="AWS_SDK_UA_APP_ID",UA_APP_ID_INI_NAME="sdk_ua_app_id",UA_APP_ID_INI_NAME_DEPRECATED="sdk-ua-app-id",NODE_APP_ID_CONFIG_OPTIONS={environmentVariableSelector:(env3)=>env3[UA_APP_ID_ENV_NAME],configFileSelector:(profile)=>profile[UA_APP_ID_INI_NAME]??profile[UA_APP_ID_INI_NAME_DEPRECATED],default:middlewareUserAgent.DEFAULT_UA_APP_ID};exports.NODE_APP_ID_CONFIG_OPTIONS=NODE_APP_ID_CONFIG_OPTIONS;exports.UA_APP_ID_ENV_NAME=UA_APP_ID_ENV_NAME;exports.UA_APP_ID_INI_NAME=UA_APP_ID_INI_NAME;exports.createDefaultUserAgentProvider=createDefaultUserAgentProvider;exports.crtAvailability=crtAvailability;exports.defaultUserAgent=defaultUserAgent});var require_dist_cjs42=__commonJS((exports)=>{var utilBufferFrom=require_dist_cjs6(),utilUtf8=require_dist_cjs7(),buffer2=__require("buffer"),crypto3=__require("crypto");class Hash2{algorithmIdentifier;secret;hash;constructor(algorithmIdentifier,secret){this.algorithmIdentifier=algorithmIdentifier,this.secret=secret,this.reset()}update(toHash,encoding){this.hash.update(utilUtf8.toUint8Array(castSourceData(toHash,encoding)))}digest(){return Promise.resolve(this.hash.digest())}reset(){this.hash=this.secret?crypto3.createHmac(this.algorithmIdentifier,castSourceData(this.secret)):crypto3.createHash(this.algorithmIdentifier)}}function castSourceData(toCast,encoding){if(buffer2.Buffer.isBuffer(toCast))return toCast;if(typeof toCast==="string")return utilBufferFrom.fromString(toCast,encoding);if(ArrayBuffer.isView(toCast))return utilBufferFrom.fromArrayBuffer(toCast.buffer,toCast.byteOffset,toCast.byteLength);return utilBufferFrom.fromArrayBuffer(toCast)}exports.Hash=Hash2});var require_dist_cjs43=__commonJS((exports)=>{var node_fs=__require("fs"),calculateBodyLength=(body)=>{if(!body)return 0;if(typeof body==="string")return Buffer.byteLength(body);else if(typeof body.byteLength==="number")return body.byteLength;else if(typeof body.size==="number")return body.size;else if(typeof body.start==="number"&&typeof body.end==="number")return body.end+1-body.start;else if(body instanceof node_fs.ReadStream){if(body.path!=null)return node_fs.lstatSync(body.path).size;else if(typeof body.fd==="number")return node_fs.fstatSync(body.fd).size}throw Error(`Body Length computation failed for ${body}`)};exports.calculateBodyLength=calculateBodyLength});var require_dist_cjs44=__commonJS((exports)=>{var configResolver=require_dist_cjs33(),nodeConfigProvider=require_dist_cjs36(),propertyProvider=require_dist_cjs17(),AWS_EXECUTION_ENV="AWS_EXECUTION_ENV",AWS_REGION_ENV="AWS_REGION",AWS_DEFAULT_REGION_ENV="AWS_DEFAULT_REGION",ENV_IMDS_DISABLED2="AWS_EC2_METADATA_DISABLED",DEFAULTS_MODE_OPTIONS=["in-region","cross-region","mobile","standard","legacy"],IMDS_REGION_PATH="/latest/meta-data/placement/region",AWS_DEFAULTS_MODE_ENV="AWS_DEFAULTS_MODE",AWS_DEFAULTS_MODE_CONFIG="defaults_mode",NODE_DEFAULTS_MODE_CONFIG_OPTIONS={environmentVariableSelector:(env3)=>{return env3[AWS_DEFAULTS_MODE_ENV]},configFileSelector:(profile)=>{return profile[AWS_DEFAULTS_MODE_CONFIG]},default:"legacy"},resolveDefaultsModeConfig=({region=nodeConfigProvider.loadConfig(configResolver.NODE_REGION_CONFIG_OPTIONS),defaultsMode=nodeConfigProvider.loadConfig(NODE_DEFAULTS_MODE_CONFIG_OPTIONS)}={})=>propertyProvider.memoize(async()=>{let mode=typeof defaultsMode==="function"?await defaultsMode():defaultsMode;switch(mode?.toLowerCase()){case"auto":return resolveNodeDefaultsModeAuto(region);case"in-region":case"cross-region":case"mobile":case"standard":case"legacy":return Promise.resolve(mode?.toLocaleLowerCase());case void 0:return Promise.resolve("legacy");default:throw Error(`Invalid parameter for "defaultsMode", expect ${DEFAULTS_MODE_OPTIONS.join(", ")}, got ${mode}`)}}),resolveNodeDefaultsModeAuto=async(clientRegion)=>{if(clientRegion){let resolvedRegion=typeof clientRegion==="function"?await clientRegion():clientRegion,inferredRegion=await inferPhysicalRegion();if(!inferredRegion)return"standard";if(resolvedRegion===inferredRegion)return"in-region";else return"cross-region"}return"standard"},inferPhysicalRegion=async()=>{if(process.env[AWS_EXECUTION_ENV]&&(process.env[AWS_REGION_ENV]||process.env[AWS_DEFAULT_REGION_ENV]))return process.env[AWS_REGION_ENV]??process.env[AWS_DEFAULT_REGION_ENV];if(!process.env[ENV_IMDS_DISABLED2])try{let{getInstanceMetadataEndpoint:getInstanceMetadataEndpoint2,httpRequest:httpRequest2}=await Promise.resolve().then(() => (init_dist_es2(),exports_dist_es2)),endpoint=await getInstanceMetadataEndpoint2();return(await httpRequest2({...endpoint,path:IMDS_REGION_PATH})).toString()}catch(e){}};exports.resolveDefaultsModeConfig=resolveDefaultsModeConfig});var require_protocols2=__commonJS((exports)=>{var cbor=require_cbor(),schema=require_schema(),smithyClient=require_dist_cjs21(),protocols=require_protocols(),serde=require_serde(),utilBase64=require_dist_cjs8(),utilUtf8=require_dist_cjs7(),xmlBuilder=require_dist_cjs22();class ProtocolLib{queryCompat;constructor(queryCompat=!1){this.queryCompat=queryCompat}resolveRestContentType(defaultContentType,inputSchema){let members=inputSchema.getMemberSchemas(),httpPayloadMember=Object.values(members).find((m2)=>{return!!m2.getMergedTraits().httpPayload});if(httpPayloadMember){let mediaType=httpPayloadMember.getMergedTraits().mediaType;if(mediaType)return mediaType;else if(httpPayloadMember.isStringSchema())return"text/plain";else if(httpPayloadMember.isBlobSchema())return"application/octet-stream";else return defaultContentType}else if(!inputSchema.isUnitSchema()){if(Object.values(members).find((m2)=>{let{httpQuery,httpQueryParams,httpHeader,httpLabel,httpPrefixHeaders}=m2.getMergedTraits();return!httpQuery&&!httpQueryParams&&!httpHeader&&!httpLabel&&httpPrefixHeaders===void 0}))return defaultContentType}}async getErrorSchemaOrThrowBaseException(errorIdentifier,defaultNamespace,response,dataObject,metadata,getErrorSchema){let namespace=defaultNamespace,errorName=errorIdentifier;if(errorIdentifier.includes("#"))[namespace,errorName]=errorIdentifier.split("#");let errorMetadata={$metadata:metadata,$fault:response.statusCode<500?"client":"server"},registry=schema.TypeRegistry.for(namespace);try{return{errorSchema:getErrorSchema?.(registry,errorName)??registry.getSchema(errorIdentifier),errorMetadata}}catch(e){dataObject.message=dataObject.message??dataObject.Message??"UnknownError";let synthetic=schema.TypeRegistry.for("smithy.ts.sdk.synthetic."+namespace),baseExceptionSchema=synthetic.getBaseException();if(baseExceptionSchema){let ErrorCtor=synthetic.getErrorCtor(baseExceptionSchema)??Error;throw this.decorateServiceException(Object.assign(new ErrorCtor({name:errorName}),errorMetadata),dataObject)}throw this.decorateServiceException(Object.assign(Error(errorName),errorMetadata),dataObject)}}decorateServiceException(exception,additions={}){if(this.queryCompat){let msg=exception.Message??additions.Message,error=smithyClient.decorateServiceException(exception,additions);if(msg)error.message=msg;error.Error={...error.Error,Type:error.Error.Type,Code:error.Error.Code,Message:error.Error.message??error.Error.Message??msg};let reqId=error.$metadata.requestId;if(reqId)error.RequestId=reqId;return error}return smithyClient.decorateServiceException(exception,additions)}setQueryCompatError(output,response){let queryErrorHeader=response.headers?.["x-amzn-query-error"];if(output!==void 0&&queryErrorHeader!=null){let[Code,Type3]=queryErrorHeader.split(";"),entries=Object.entries(output),Error2={Code,Type:Type3};Object.assign(output,Error2);for(let[k2,v]of entries)Error2[k2==="message"?"Message":k2]=v;delete Error2.__type,output.Error=Error2}}queryCompatOutput(queryCompatErrorData,errorData){if(queryCompatErrorData.Error)errorData.Error=queryCompatErrorData.Error;if(queryCompatErrorData.Type)errorData.Type=queryCompatErrorData.Type;if(queryCompatErrorData.Code)errorData.Code=queryCompatErrorData.Code}findQueryCompatibleError(registry,errorName){try{return registry.getSchema(errorName)}catch(e){return registry.find((schema$1)=>schema.NormalizedSchema.of(schema$1).getMergedTraits().awsQueryError?.[0]===errorName)}}}class AwsSmithyRpcV2CborProtocol extends cbor.SmithyRpcV2CborProtocol{awsQueryCompatible;mixin;constructor({defaultNamespace,awsQueryCompatible}){super({defaultNamespace});this.awsQueryCompatible=!!awsQueryCompatible,this.mixin=new ProtocolLib(this.awsQueryCompatible)}async serializeRequest(operationSchema,input,context){let request2=await super.serializeRequest(operationSchema,input,context);if(this.awsQueryCompatible)request2.headers["x-amzn-query-mode"]="true";return request2}async handleError(operationSchema,context,response,dataObject,metadata){if(this.awsQueryCompatible)this.mixin.setQueryCompatError(dataObject,response);let errorName=(()=>{let compatHeader=response.headers["x-amzn-query-error"];if(compatHeader&&this.awsQueryCompatible)return compatHeader.split(";")[0];return cbor.loadSmithyRpcV2CborErrorCode(response,dataObject)??"Unknown"})(),{errorSchema,errorMetadata}=await this.mixin.getErrorSchemaOrThrowBaseException(errorName,this.options.defaultNamespace,response,dataObject,metadata,this.awsQueryCompatible?this.mixin.findQueryCompatibleError:void 0),ns=schema.NormalizedSchema.of(errorSchema),message=dataObject.message??dataObject.Message??"Unknown",exception=new(schema.TypeRegistry.for(errorSchema[1]).getErrorCtor(errorSchema)??Error)(message),output={};for(let[name,member]of ns.structIterator())if(dataObject[name]!=null)output[name]=this.deserializer.readValue(member,dataObject[name]);if(this.awsQueryCompatible)this.mixin.queryCompatOutput(dataObject,output);throw this.mixin.decorateServiceException(Object.assign(exception,errorMetadata,{$fault:ns.getMergedTraits().error,message},output),dataObject)}}var _toStr=(val)=>{if(val==null)return val;if(typeof val==="number"||typeof val==="bigint"){let warning=Error(`Received number ${val} where a string was expected.`);return warning.name="Warning",console.warn(warning),String(val)}if(typeof val==="boolean"){let warning=Error(`Received boolean ${val} where a string was expected.`);return warning.name="Warning",console.warn(warning),String(val)}return val},_toBool=(val)=>{if(val==null)return val;if(typeof val==="string"){let lowercase=val.toLowerCase();if(val!==""&&lowercase!=="false"&&lowercase!=="true"){let warning=Error(`Received string "${val}" where a boolean was expected.`);warning.name="Warning",console.warn(warning)}return val!==""&&lowercase!=="false"}return val},_toNum=(val)=>{if(val==null)return val;if(typeof val==="string"){let num=Number(val);if(num.toString()!==val){let warning=Error(`Received string "${val}" where a number was expected.`);return warning.name="Warning",console.warn(warning),val}return num}return val};class SerdeContextConfig{serdeContext;setSerdeContext(serdeContext){this.serdeContext=serdeContext}}class UnionSerde{from;to;keys;constructor(from,to){this.from=from,this.to=to,this.keys=new Set(Object.keys(this.from).filter((k2)=>k2!=="__type"))}mark(key){this.keys.delete(key)}hasUnknown(){return this.keys.size===1&&Object.keys(this.to).length===0}writeUnknown(){if(this.hasUnknown()){let k2=this.keys.values().next().value,v=this.from[k2];this.to.$unknown=[k2,v]}}}function jsonReviver(key,value,context){if(context?.source){let numericString=context.source;if(typeof value==="number"){if(value>Number.MAX_SAFE_INTEGER||value<Number.MIN_SAFE_INTEGER||numericString!==String(value))if(numericString.includes("."))return new serde.NumericValue(numericString,"bigDecimal");else return BigInt(numericString)}}return value}var collectBodyString=(streamBody,context)=>smithyClient.collectBody(streamBody,context).then((body)=>(context?.utf8Encoder??utilUtf8.toUtf8)(body)),parseJsonBody=(streamBody,context)=>collectBodyString(streamBody,context).then((encoded)=>{if(encoded.length)try{return JSON.parse(encoded)}catch(e){if(e?.name==="SyntaxError")Object.defineProperty(e,"$responseBodyText",{value:encoded});throw e}return{}}),parseJsonErrorBody=async(errorBody,context)=>{let value=await parseJsonBody(errorBody,context);return value.message=value.message??value.Message,value},loadRestJsonErrorCode=(output,data)=>{let findKey=(object,key)=>Object.keys(object).find((k2)=>k2.toLowerCase()===key.toLowerCase()),sanitizeErrorCode=(rawValue)=>{let cleanValue=rawValue;if(typeof cleanValue==="number")cleanValue=cleanValue.toString();if(cleanValue.indexOf(",")>=0)cleanValue=cleanValue.split(",")[0];if(cleanValue.indexOf(":")>=0)cleanValue=cleanValue.split(":")[0];if(cleanValue.indexOf("#")>=0)cleanValue=cleanValue.split("#")[1];return cleanValue},headerKey=findKey(output.headers,"x-amzn-errortype");if(headerKey!==void 0)return sanitizeErrorCode(output.headers[headerKey]);if(data&&typeof data==="object"){let codeKey=findKey(data,"code");if(codeKey&&data[codeKey]!==void 0)return sanitizeErrorCode(data[codeKey]);if(data.__type!==void 0)return sanitizeErrorCode(data.__type)}};class JsonShapeDeserializer extends SerdeContextConfig{settings;constructor(settings){super();this.settings=settings}async read(schema2,data){return this._read(schema2,typeof data==="string"?JSON.parse(data,jsonReviver):await parseJsonBody(data,this.serdeContext))}readObject(schema2,data){return this._read(schema2,data)}_read(schema$1,value){let isObject3=value!==null&&typeof value==="object",ns=schema.NormalizedSchema.of(schema$1);if(isObject3){if(ns.isStructSchema()){let record=value,union2=ns.isUnionSchema(),out={},nameMap=void 0,{jsonName}=this.settings;if(jsonName)nameMap={};let unionSerde;if(union2)unionSerde=new UnionSerde(record,out);for(let[memberName,memberSchema]of ns.structIterator()){let fromKey=memberName;if(jsonName)fromKey=memberSchema.getMergedTraits().jsonName??fromKey,nameMap[fromKey]=memberName;if(union2)unionSerde.mark(fromKey);if(record[fromKey]!=null)out[memberName]=this._read(memberSchema,record[fromKey])}if(union2)unionSerde.writeUnknown();else if(typeof record.__type==="string")for(let[k2,v]of Object.entries(record)){let t8=jsonName?nameMap[k2]??k2:k2;if(!(t8 in out))out[t8]=v}return out}if(Array.isArray(value)&&ns.isListSchema()){let listMember=ns.getValueSchema(),out=[],sparse=!!ns.getMergedTraits().sparse;for(let item of value)if(sparse||item!=null)out.push(this._read(listMember,item));return out}if(ns.isMapSchema()){let mapMember=ns.getValueSchema(),out={},sparse=!!ns.getMergedTraits().sparse;for(let[_k,_v]of Object.entries(value))if(sparse||_v!=null)out[_k]=this._read(mapMember,_v);return out}}if(ns.isBlobSchema()&&typeof value==="string")return utilBase64.fromBase64(value);let mediaType=ns.getMergedTraits().mediaType;if(ns.isStringSchema()&&typeof value==="string"&&mediaType){if(mediaType==="application/json"||mediaType.endsWith("+json"))return serde.LazyJsonString.from(value);return value}if(ns.isTimestampSchema()&&value!=null)switch(protocols.determineTimestampFormat(ns,this.settings)){case 5:return serde.parseRfc3339DateTimeWithOffset(value);case 6:return serde.parseRfc7231DateTime(value);case 7:return serde.parseEpochTimestamp(value);default:return console.warn("Missing timestamp format, parsing value with Date constructor:",value),new Date(value)}if(ns.isBigIntegerSchema()&&(typeof value==="number"||typeof value==="string"))return BigInt(value);if(ns.isBigDecimalSchema()&&value!=null){if(value instanceof serde.NumericValue)return value;let untyped=value;if(untyped.type==="bigDecimal"&&"string"in untyped)return new serde.NumericValue(untyped.string,untyped.type);return new serde.NumericValue(String(value),"bigDecimal")}if(ns.isNumericSchema()&&typeof value==="string"){switch(value){case"Infinity":return 1/0;case"-Infinity":return-1/0;case"NaN":return NaN}return value}if(ns.isDocumentSchema())if(isObject3){let out=Array.isArray(value)?[]:{};for(let[k2,v]of Object.entries(value))if(v instanceof serde.NumericValue)out[k2]=v;else out[k2]=this._read(ns,v);return out}else return structuredClone(value);return value}}var NUMERIC_CONTROL_CHAR=String.fromCharCode(925);class JsonReplacer{values=new Map;counter=0;stage=0;createReplacer(){if(this.stage===1)throw Error("@aws-sdk/core/protocols - JsonReplacer already created.");if(this.stage===2)throw Error("@aws-sdk/core/protocols - JsonReplacer exhausted.");return this.stage=1,(key,value)=>{if(value instanceof serde.NumericValue){let v=`${NUMERIC_CONTROL_CHAR+"nv"+this.counter++}_`+value.string;return this.values.set(`"${v}"`,value.string),v}if(typeof value==="bigint"){let s=value.toString(),v=`${NUMERIC_CONTROL_CHAR+"b"+this.counter++}_`+s;return this.values.set(`"${v}"`,s),v}return value}}replaceInJson(json2){if(this.stage===0)throw Error("@aws-sdk/core/protocols - JsonReplacer not created yet.");if(this.stage===2)throw Error("@aws-sdk/core/protocols - JsonReplacer exhausted.");if(this.stage=2,this.counter===0)return json2;for(let[key,value]of this.values)json2=json2.replace(key,value);return json2}}class JsonShapeSerializer extends SerdeContextConfig{settings;buffer;useReplacer=!1;rootSchema;constructor(settings){super();this.settings=settings}write(schema$1,value){this.rootSchema=schema.NormalizedSchema.of(schema$1),this.buffer=this._write(this.rootSchema,value)}writeDiscriminatedDocument(schema$1,value){if(this.write(schema$1,value),typeof this.buffer==="object")this.buffer.__type=schema.NormalizedSchema.of(schema$1).getName(!0)}flush(){let{rootSchema,useReplacer}=this;if(this.rootSchema=void 0,this.useReplacer=!1,rootSchema?.isStructSchema()||rootSchema?.isDocumentSchema()){if(!useReplacer)return JSON.stringify(this.buffer);let replacer=new JsonReplacer;return replacer.replaceInJson(JSON.stringify(this.buffer,replacer.createReplacer(),0))}return this.buffer}_write(schema$1,value,container){let isObject3=value!==null&&typeof value==="object",ns=schema.NormalizedSchema.of(schema$1);if(isObject3){if(ns.isStructSchema()){let record=value,out={},{jsonName}=this.settings,nameMap=void 0;if(jsonName)nameMap={};for(let[memberName,memberSchema]of ns.structIterator()){let serializableValue=this._write(memberSchema,record[memberName],ns);if(serializableValue!==void 0){let targetKey=memberName;if(jsonName)targetKey=memberSchema.getMergedTraits().jsonName??memberName,nameMap[memberName]=targetKey;out[targetKey]=serializableValue}}if(ns.isUnionSchema()&&Object.keys(out).length===0){let{$unknown}=record;if(Array.isArray($unknown)){let[k2,v]=$unknown;out[k2]=this._write(15,v)}}else if(typeof record.__type==="string")for(let[k2,v]of Object.entries(record)){let targetKey=jsonName?nameMap[k2]??k2:k2;if(!(targetKey in out))out[targetKey]=this._write(15,v)}return out}if(Array.isArray(value)&&ns.isListSchema()){let listMember=ns.getValueSchema(),out=[],sparse=!!ns.getMergedTraits().sparse;for(let item of value)if(sparse||item!=null)out.push(this._write(listMember,item));return out}if(ns.isMapSchema()){let mapMember=ns.getValueSchema(),out={},sparse=!!ns.getMergedTraits().sparse;for(let[_k,_v]of Object.entries(value))if(sparse||_v!=null)out[_k]=this._write(mapMember,_v);return out}if(value instanceof Uint8Array&&(ns.isBlobSchema()||ns.isDocumentSchema())){if(ns===this.rootSchema)return value;return(this.serdeContext?.base64Encoder??utilBase64.toBase64)(value)}if(value instanceof Date&&(ns.isTimestampSchema()||ns.isDocumentSchema()))switch(protocols.determineTimestampFormat(ns,this.settings)){case 5:return value.toISOString().replace(".000Z","Z");case 6:return serde.dateToUtcString(value);case 7:return value.getTime()/1000;default:return console.warn("Missing timestamp format, using epoch seconds",value),value.getTime()/1000}if(value instanceof serde.NumericValue)this.useReplacer=!0}if(value===null&&container?.isStructSchema())return;if(ns.isStringSchema()){if(typeof value>"u"&&ns.isIdempotencyToken())return serde.generateIdempotencyToken();let mediaType=ns.getMergedTraits().mediaType;if(value!=null&&mediaType){if(mediaType==="application/json"||mediaType.endsWith("+json"))return serde.LazyJsonString.from(value)}return value}if(typeof value==="number"&&ns.isNumericSchema()){if(Math.abs(value)===1/0||isNaN(value))return String(value);return value}if(typeof value==="string"&&ns.isBlobSchema()){if(ns===this.rootSchema)return value;return(this.serdeContext?.base64Encoder??utilBase64.toBase64)(value)}if(typeof value==="bigint")this.useReplacer=!0;if(ns.isDocumentSchema())if(isObject3){let out=Array.isArray(value)?[]:{};for(let[k2,v]of Object.entries(value))if(v instanceof serde.NumericValue)this.useReplacer=!0,out[k2]=v;else out[k2]=this._write(ns,v);return out}else return structuredClone(value);return value}}class JsonCodec extends SerdeContextConfig{settings;constructor(settings){super();this.settings=settings}createSerializer(){let serializer=new JsonShapeSerializer(this.settings);return serializer.setSerdeContext(this.serdeContext),serializer}createDeserializer(){let deserializer=new JsonShapeDeserializer(this.settings);return deserializer.setSerdeContext(this.serdeContext),deserializer}}class AwsJsonRpcProtocol extends protocols.RpcProtocol{serializer;deserializer;serviceTarget;codec;mixin;awsQueryCompatible;constructor({defaultNamespace,serviceTarget,awsQueryCompatible,jsonCodec}){super({defaultNamespace});this.serviceTarget=serviceTarget,this.codec=jsonCodec??new JsonCodec({timestampFormat:{useTrait:!0,default:7},jsonName:!1}),this.serializer=this.codec.createSerializer(),this.deserializer=this.codec.createDeserializer(),this.awsQueryCompatible=!!awsQueryCompatible,this.mixin=new ProtocolLib(this.awsQueryCompatible)}async serializeRequest(operationSchema,input,context){let request2=await super.serializeRequest(operationSchema,input,context);if(!request2.path.endsWith("/"))request2.path+="/";if(Object.assign(request2.headers,{"content-type":`application/x-amz-json-${this.getJsonRpcVersion()}`,"x-amz-target":`${this.serviceTarget}.${operationSchema.name}`}),this.awsQueryCompatible)request2.headers["x-amzn-query-mode"]="true";if(schema.deref(operationSchema.input)==="unit"||!request2.body)request2.body="{}";return request2}getPayloadCodec(){return this.codec}async handleError(operationSchema,context,response,dataObject,metadata){if(this.awsQueryCompatible)this.mixin.setQueryCompatError(dataObject,response);let errorIdentifier=loadRestJsonErrorCode(response,dataObject)??"Unknown",{errorSchema,errorMetadata}=await this.mixin.getErrorSchemaOrThrowBaseException(errorIdentifier,this.options.defaultNamespace,response,dataObject,metadata,this.awsQueryCompatible?this.mixin.findQueryCompatibleError:void 0),ns=schema.NormalizedSchema.of(errorSchema),message=dataObject.message??dataObject.Message??"Unknown",exception=new(schema.TypeRegistry.for(errorSchema[1]).getErrorCtor(errorSchema)??Error)(message),output={};for(let[name,member]of ns.structIterator())if(dataObject[name]!=null)output[name]=this.codec.createDeserializer().readObject(member,dataObject[name]);if(this.awsQueryCompatible)this.mixin.queryCompatOutput(dataObject,output);throw this.mixin.decorateServiceException(Object.assign(exception,errorMetadata,{$fault:ns.getMergedTraits().error,message},output),dataObject)}}class AwsJson1_0Protocol extends AwsJsonRpcProtocol{constructor({defaultNamespace,serviceTarget,awsQueryCompatible,jsonCodec}){super({defaultNamespace,serviceTarget,awsQueryCompatible,jsonCodec})}getShapeId(){return"aws.protocols#awsJson1_0"}getJsonRpcVersion(){return"1.0"}getDefaultContentType(){return"application/x-amz-json-1.0"}}class AwsJson1_1Protocol extends AwsJsonRpcProtocol{constructor({defaultNamespace,serviceTarget,awsQueryCompatible,jsonCodec}){super({defaultNamespace,serviceTarget,awsQueryCompatible,jsonCodec})}getShapeId(){return"aws.protocols#awsJson1_1"}getJsonRpcVersion(){return"1.1"}getDefaultContentType(){return"application/x-amz-json-1.1"}}class AwsRestJsonProtocol extends protocols.HttpBindingProtocol{serializer;deserializer;codec;mixin=new ProtocolLib;constructor({defaultNamespace}){super({defaultNamespace});let settings={timestampFormat:{useTrait:!0,default:7},httpBindings:!0,jsonName:!0};this.codec=new JsonCodec(settings),this.serializer=new protocols.HttpInterceptingShapeSerializer(this.codec.createSerializer(),settings),this.deserializer=new protocols.HttpInterceptingShapeDeserializer(this.codec.createDeserializer(),settings)}getShapeId(){return"aws.protocols#restJson1"}getPayloadCodec(){return this.codec}setSerdeContext(serdeContext){this.codec.setSerdeContext(serdeContext),super.setSerdeContext(serdeContext)}async serializeRequest(operationSchema,input,context){let request2=await super.serializeRequest(operationSchema,input,context),inputSchema=schema.NormalizedSchema.of(operationSchema.input);if(!request2.headers["content-type"]){let contentType=this.mixin.resolveRestContentType(this.getDefaultContentType(),inputSchema);if(contentType)request2.headers["content-type"]=contentType}if(request2.body==null&&request2.headers["content-type"]===this.getDefaultContentType())request2.body="{}";return request2}async deserializeResponse(operationSchema,context,response){let output=await super.deserializeResponse(operationSchema,context,response),outputSchema=schema.NormalizedSchema.of(operationSchema.output);for(let[name,member]of outputSchema.structIterator())if(member.getMemberTraits().httpPayload&&!(name in output))output[name]=null;return output}async handleError(operationSchema,context,response,dataObject,metadata){let errorIdentifier=loadRestJsonErrorCode(response,dataObject)??"Unknown",{errorSchema,errorMetadata}=await this.mixin.getErrorSchemaOrThrowBaseException(errorIdentifier,this.options.defaultNamespace,response,dataObject,metadata),ns=schema.NormalizedSchema.of(errorSchema),message=dataObject.message??dataObject.Message??"Unknown",exception=new(schema.TypeRegistry.for(errorSchema[1]).getErrorCtor(errorSchema)??Error)(message);await this.deserializeHttpMessage(errorSchema,context,response,dataObject);let output={};for(let[name,member]of ns.structIterator()){let target=member.getMergedTraits().jsonName??name;output[name]=this.codec.createDeserializer().readObject(member,dataObject[target])}throw this.mixin.decorateServiceException(Object.assign(exception,errorMetadata,{$fault:ns.getMergedTraits().error,message},output),dataObject)}getDefaultContentType(){return"application/json"}}var awsExpectUnion=(value)=>{if(value==null)return;if(typeof value==="object"&&"__type"in value)delete value.__type;return smithyClient.expectUnion(value)};class XmlShapeDeserializer extends SerdeContextConfig{settings;stringDeserializer;constructor(settings){super();this.settings=settings,this.stringDeserializer=new protocols.FromStringShapeDeserializer(settings)}setSerdeContext(serdeContext){this.serdeContext=serdeContext,this.stringDeserializer.setSerdeContext(serdeContext)}read(schema$1,bytes,key){let ns=schema.NormalizedSchema.of(schema$1),memberSchemas=ns.getMemberSchemas();if(ns.isStructSchema()&&ns.isMemberSchema()&&!!Object.values(memberSchemas).find((memberNs)=>{return!!memberNs.getMemberTraits().eventPayload})){let output={},memberName=Object.keys(memberSchemas)[0];if(memberSchemas[memberName].isBlobSchema())output[memberName]=bytes;else output[memberName]=this.read(memberSchemas[memberName],bytes);return output}let xmlString=(this.serdeContext?.utf8Encoder??utilUtf8.toUtf8)(bytes),parsedObject=this.parseXml(xmlString);return this.readSchema(schema$1,key?parsedObject[key]:parsedObject)}readSchema(_schema,value){let ns=schema.NormalizedSchema.of(_schema);if(ns.isUnitSchema())return;let traits=ns.getMergedTraits();if(ns.isListSchema()&&!Array.isArray(value))return this.readSchema(ns,[value]);if(value==null)return value;if(typeof value==="object"){let sparse=!!traits.sparse,flat=!!traits.xmlFlattened;if(ns.isListSchema()){let listValue=ns.getValueSchema(),buffer3=[],sourceKey=listValue.getMergedTraits().xmlName??"member",source=flat?value:(value[0]??value)[sourceKey],sourceArray=Array.isArray(source)?source:[source];for(let v of sourceArray)if(v!=null||sparse)buffer3.push(this.readSchema(listValue,v));return buffer3}let buffer2={};if(ns.isMapSchema()){let keyNs=ns.getKeySchema(),memberNs=ns.getValueSchema(),entries;if(flat)entries=Array.isArray(value)?value:[value];else entries=Array.isArray(value.entry)?value.entry:[value.entry];let keyProperty=keyNs.getMergedTraits().xmlName??"key",valueProperty=memberNs.getMergedTraits().xmlName??"value";for(let entry of entries){let key=entry[keyProperty],value2=entry[valueProperty];if(value2!=null||sparse)buffer2[key]=this.readSchema(memberNs,value2)}return buffer2}if(ns.isStructSchema()){let union2=ns.isUnionSchema(),unionSerde;if(union2)unionSerde=new UnionSerde(value,buffer2);for(let[memberName,memberSchema]of ns.structIterator()){let memberTraits=memberSchema.getMergedTraits(),xmlObjectKey=!memberTraits.httpPayload?memberSchema.getMemberTraits().xmlName??memberName:memberTraits.xmlName??memberSchema.getName();if(union2)unionSerde.mark(xmlObjectKey);if(value[xmlObjectKey]!=null)buffer2[memberName]=this.readSchema(memberSchema,value[xmlObjectKey])}if(union2)unionSerde.writeUnknown();return buffer2}if(ns.isDocumentSchema())return value;throw Error(`@aws-sdk/core/protocols - xml deserializer unhandled schema type for ${ns.getName(!0)}`)}if(ns.isListSchema())return[];if(ns.isMapSchema()||ns.isStructSchema())return{};return this.stringDeserializer.read(ns,value)}parseXml(xml){if(xml.length){let parsedObj;try{parsedObj=xmlBuilder.parseXML(xml)}catch(e){if(e&&typeof e==="object")Object.defineProperty(e,"$responseBodyText",{value:xml});throw e}let textNodeName="#text",key=Object.keys(parsedObj)[0],parsedObjToReturn=parsedObj[key];if(parsedObjToReturn[textNodeName])parsedObjToReturn[key]=parsedObjToReturn[textNodeName],delete parsedObjToReturn[textNodeName];return smithyClient.getValueFromTextNode(parsedObjToReturn)}return{}}}class QueryShapeSerializer extends SerdeContextConfig{settings;buffer;constructor(settings){super();this.settings=settings}write(schema$1,value,prefix=""){if(this.buffer===void 0)this.buffer="";let ns=schema.NormalizedSchema.of(schema$1);if(prefix&&!prefix.endsWith("."))prefix+=".";if(ns.isBlobSchema()){if(typeof value==="string"||value instanceof Uint8Array)this.writeKey(prefix),this.writeValue((this.serdeContext?.base64Encoder??utilBase64.toBase64)(value))}else if(ns.isBooleanSchema()||ns.isNumericSchema()||ns.isStringSchema()){if(value!=null)this.writeKey(prefix),this.writeValue(String(value));else if(ns.isIdempotencyToken())this.writeKey(prefix),this.writeValue(serde.generateIdempotencyToken())}else if(ns.isBigIntegerSchema()){if(value!=null)this.writeKey(prefix),this.writeValue(String(value))}else if(ns.isBigDecimalSchema()){if(value!=null)this.writeKey(prefix),this.writeValue(value instanceof serde.NumericValue?value.string:String(value))}else if(ns.isTimestampSchema()){if(value instanceof Date)switch(this.writeKey(prefix),protocols.determineTimestampFormat(ns,this.settings)){case 5:this.writeValue(value.toISOString().replace(".000Z","Z"));break;case 6:this.writeValue(smithyClient.dateToUtcString(value));break;case 7:this.writeValue(String(value.getTime()/1000));break}}else if(ns.isDocumentSchema())if(Array.isArray(value))this.write(79,value,prefix);else if(value instanceof Date)this.write(4,value,prefix);else if(value instanceof Uint8Array)this.write(21,value,prefix);else if(value&&typeof value==="object")this.write(143,value,prefix);else this.writeKey(prefix),this.writeValue(String(value));else if(ns.isListSchema()){if(Array.isArray(value))if(value.length===0){if(this.settings.serializeEmptyLists)this.writeKey(prefix),this.writeValue("")}else{let member=ns.getValueSchema(),flat=this.settings.flattenLists||ns.getMergedTraits().xmlFlattened,i=1;for(let item of value){if(item==null)continue;let suffix=this.getKey("member",member.getMergedTraits().xmlName),key=flat?`${prefix}${i}`:`${prefix}${suffix}.${i}`;this.write(member,item,key),++i}}}else if(ns.isMapSchema()){if(value&&typeof value==="object"){let keySchema=ns.getKeySchema(),memberSchema=ns.getValueSchema(),flat=ns.getMergedTraits().xmlFlattened,i=1;for(let[k2,v]of Object.entries(value)){if(v==null)continue;let keySuffix=this.getKey("key",keySchema.getMergedTraits().xmlName),key=flat?`${prefix}${i}.${keySuffix}`:`${prefix}entry.${i}.${keySuffix}`,valueSuffix=this.getKey("value",memberSchema.getMergedTraits().xmlName),valueKey=flat?`${prefix}${i}.${valueSuffix}`:`${prefix}entry.${i}.${valueSuffix}`;this.write(keySchema,k2,key),this.write(memberSchema,v,valueKey),++i}}}else if(ns.isStructSchema()){if(value&&typeof value==="object"){let didWriteMember=!1;for(let[memberName,member]of ns.structIterator()){if(value[memberName]==null&&!member.isIdempotencyToken())continue;let suffix=this.getKey(memberName,member.getMergedTraits().xmlName),key=`${prefix}${suffix}`;this.write(member,value[memberName],key),didWriteMember=!0}if(!didWriteMember&&ns.isUnionSchema()){let{$unknown}=value;if(Array.isArray($unknown)){let[k2,v]=$unknown,key=`${prefix}${k2}`;this.write(15,v,key)}}}}else if(ns.isUnitSchema());else throw Error(`@aws-sdk/core/protocols - QuerySerializer unrecognized schema type ${ns.getName(!0)}`)}flush(){if(this.buffer===void 0)throw Error("@aws-sdk/core/protocols - QuerySerializer cannot flush with nothing written to buffer.");let str=this.buffer;return delete this.buffer,str}getKey(memberName,xmlName){let key=xmlName??memberName;if(this.settings.capitalizeKeys)return key[0].toUpperCase()+key.slice(1);return key}writeKey(key){if(key.endsWith("."))key=key.slice(0,key.length-1);this.buffer+=`&${protocols.extendedEncodeURIComponent(key)}=`}writeValue(value){this.buffer+=protocols.extendedEncodeURIComponent(value)}}class AwsQueryProtocol extends protocols.RpcProtocol{options;serializer;deserializer;mixin=new ProtocolLib;constructor(options){super({defaultNamespace:options.defaultNamespace});this.options=options;let settings={timestampFormat:{useTrait:!0,default:5},httpBindings:!1,xmlNamespace:options.xmlNamespace,serviceNamespace:options.defaultNamespace,serializeEmptyLists:!0};this.serializer=new QueryShapeSerializer(settings),this.deserializer=new XmlShapeDeserializer(settings)}getShapeId(){return"aws.protocols#awsQuery"}setSerdeContext(serdeContext){this.serializer.setSerdeContext(serdeContext),this.deserializer.setSerdeContext(serdeContext)}getPayloadCodec(){throw Error("AWSQuery protocol has no payload codec.")}async serializeRequest(operationSchema,input,context){let request2=await super.serializeRequest(operationSchema,input,context);if(!request2.path.endsWith("/"))request2.path+="/";if(Object.assign(request2.headers,{"content-type":"application/x-www-form-urlencoded"}),schema.deref(operationSchema.input)==="unit"||!request2.body)request2.body="";let action=operationSchema.name.split("#")[1]??operationSchema.name;if(request2.body=`Action=${action}&Version=${this.options.version}`+request2.body,request2.body.endsWith("&"))request2.body=request2.body.slice(-1);return request2}async deserializeResponse(operationSchema,context,response){let deserializer=this.deserializer,ns=schema.NormalizedSchema.of(operationSchema.output),dataObject={};if(response.statusCode>=300){let bytes2=await protocols.collectBody(response.body,context);if(bytes2.byteLength>0)Object.assign(dataObject,await deserializer.read(15,bytes2));await this.handleError(operationSchema,context,response,dataObject,this.deserializeMetadata(response))}for(let header in response.headers){let value=response.headers[header];delete response.headers[header],response.headers[header.toLowerCase()]=value}let shortName=operationSchema.name.split("#")[1]??operationSchema.name,awsQueryResultKey=ns.isStructSchema()&&this.useNestedResult()?shortName+"Result":void 0,bytes=await protocols.collectBody(response.body,context);if(bytes.byteLength>0)Object.assign(dataObject,await deserializer.read(ns,bytes,awsQueryResultKey));return{$metadata:this.deserializeMetadata(response),...dataObject}}useNestedResult(){return!0}async handleError(operationSchema,context,response,dataObject,metadata){let errorIdentifier=this.loadQueryErrorCode(response,dataObject)??"Unknown",errorData=this.loadQueryError(dataObject),message=this.loadQueryErrorMessage(dataObject);errorData.message=message,errorData.Error={Type:errorData.Type,Code:errorData.Code,Message:message};let{errorSchema,errorMetadata}=await this.mixin.getErrorSchemaOrThrowBaseException(errorIdentifier,this.options.defaultNamespace,response,errorData,metadata,this.mixin.findQueryCompatibleError),ns=schema.NormalizedSchema.of(errorSchema),exception=new(schema.TypeRegistry.for(errorSchema[1]).getErrorCtor(errorSchema)??Error)(message),output={Type:errorData.Error.Type,Code:errorData.Error.Code,Error:errorData.Error};for(let[name,member]of ns.structIterator()){let target=member.getMergedTraits().xmlName??name,value=errorData[target]??dataObject[target];output[name]=this.deserializer.readSchema(member,value)}throw this.mixin.decorateServiceException(Object.assign(exception,errorMetadata,{$fault:ns.getMergedTraits().error,message},output),dataObject)}loadQueryErrorCode(output,data){let code=(data.Errors?.[0]?.Error??data.Errors?.Error??data.Error)?.Code;if(code!==void 0)return code;if(output.statusCode==404)return"NotFound"}loadQueryError(data){return data.Errors?.[0]?.Error??data.Errors?.Error??data.Error}loadQueryErrorMessage(data){let errorData=this.loadQueryError(data);return errorData?.message??errorData?.Message??data.message??data.Message??"Unknown"}getDefaultContentType(){return"application/x-www-form-urlencoded"}}class AwsEc2QueryProtocol extends AwsQueryProtocol{options;constructor(options){super(options);this.options=options;let ec2Settings={capitalizeKeys:!0,flattenLists:!0,serializeEmptyLists:!1};Object.assign(this.serializer.settings,ec2Settings)}useNestedResult(){return!1}}var parseXmlBody=(streamBody,context)=>collectBodyString(streamBody,context).then((encoded)=>{if(encoded.length){let parsedObj;try{parsedObj=xmlBuilder.parseXML(encoded)}catch(e){if(e&&typeof e==="object")Object.defineProperty(e,"$responseBodyText",{value:encoded});throw e}let textNodeName="#text",key=Object.keys(parsedObj)[0],parsedObjToReturn=parsedObj[key];if(parsedObjToReturn[textNodeName])parsedObjToReturn[key]=parsedObjToReturn[textNodeName],delete parsedObjToReturn[textNodeName];return smithyClient.getValueFromTextNode(parsedObjToReturn)}return{}}),parseXmlErrorBody=async(errorBody,context)=>{let value=await parseXmlBody(errorBody,context);if(value.Error)value.Error.message=value.Error.message??value.Error.Message;return value},loadRestXmlErrorCode=(output,data)=>{if(data?.Error?.Code!==void 0)return data.Error.Code;if(data?.Code!==void 0)return data.Code;if(output.statusCode==404)return"NotFound"};class XmlShapeSerializer extends SerdeContextConfig{settings;stringBuffer;byteBuffer;buffer;constructor(settings){super();this.settings=settings}write(schema$1,value){let ns=schema.NormalizedSchema.of(schema$1);if(ns.isStringSchema()&&typeof value==="string")this.stringBuffer=value;else if(ns.isBlobSchema())this.byteBuffer="byteLength"in value?value:(this.serdeContext?.base64Decoder??utilBase64.fromBase64)(value);else{this.buffer=this.writeStruct(ns,value,void 0);let traits=ns.getMergedTraits();if(traits.httpPayload&&!traits.xmlName)this.buffer.withName(ns.getName())}}flush(){if(this.byteBuffer!==void 0){let bytes=this.byteBuffer;return delete this.byteBuffer,bytes}if(this.stringBuffer!==void 0){let str=this.stringBuffer;return delete this.stringBuffer,str}let buffer2=this.buffer;if(this.settings.xmlNamespace){if(!buffer2?.attributes?.xmlns)buffer2.addAttribute("xmlns",this.settings.xmlNamespace)}return delete this.buffer,buffer2.toString()}writeStruct(ns,value,parentXmlns){let traits=ns.getMergedTraits(),name=ns.isMemberSchema()&&!traits.httpPayload?ns.getMemberTraits().xmlName??ns.getMemberName():traits.xmlName??ns.getName();if(!name||!ns.isStructSchema())throw Error(`@aws-sdk/core/protocols - xml serializer, cannot write struct with empty name or non-struct, schema=${ns.getName(!0)}.`);let structXmlNode=xmlBuilder.XmlNode.of(name),[xmlnsAttr,xmlns]=this.getXmlnsAttribute(ns,parentXmlns);for(let[memberName,memberSchema]of ns.structIterator()){let val=value[memberName];if(val!=null||memberSchema.isIdempotencyToken()){if(memberSchema.getMergedTraits().xmlAttribute){structXmlNode.addAttribute(memberSchema.getMergedTraits().xmlName??memberName,this.writeSimple(memberSchema,val));continue}if(memberSchema.isListSchema())this.writeList(memberSchema,val,structXmlNode,xmlns);else if(memberSchema.isMapSchema())this.writeMap(memberSchema,val,structXmlNode,xmlns);else if(memberSchema.isStructSchema())structXmlNode.addChildNode(this.writeStruct(memberSchema,val,xmlns));else{let memberNode=xmlBuilder.XmlNode.of(memberSchema.getMergedTraits().xmlName??memberSchema.getMemberName());this.writeSimpleInto(memberSchema,val,memberNode,xmlns),structXmlNode.addChildNode(memberNode)}}}let{$unknown}=value;if($unknown&&ns.isUnionSchema()&&Array.isArray($unknown)&&Object.keys(value).length===1){let[k2,v]=$unknown,node=xmlBuilder.XmlNode.of(k2);if(typeof v!=="string")if(value instanceof xmlBuilder.XmlNode||value instanceof xmlBuilder.XmlText)structXmlNode.addChildNode(value);else throw Error("@aws-sdk - $unknown union member in XML requires value of type string, @aws-sdk/xml-builder::XmlNode or XmlText.");this.writeSimpleInto(0,v,node,xmlns),structXmlNode.addChildNode(node)}if(xmlns)structXmlNode.addAttribute(xmlnsAttr,xmlns);return structXmlNode}writeList(listMember,array,container,parentXmlns){if(!listMember.isMemberSchema())throw Error(`@aws-sdk/core/protocols - xml serializer, cannot write non-member list: ${listMember.getName(!0)}`);let listTraits=listMember.getMergedTraits(),listValueSchema=listMember.getValueSchema(),listValueTraits=listValueSchema.getMergedTraits(),sparse=!!listValueTraits.sparse,flat=!!listTraits.xmlFlattened,[xmlnsAttr,xmlns]=this.getXmlnsAttribute(listMember,parentXmlns),writeItem=(container2,value)=>{if(listValueSchema.isListSchema())this.writeList(listValueSchema,Array.isArray(value)?value:[value],container2,xmlns);else if(listValueSchema.isMapSchema())this.writeMap(listValueSchema,value,container2,xmlns);else if(listValueSchema.isStructSchema()){let struct=this.writeStruct(listValueSchema,value,xmlns);container2.addChildNode(struct.withName(flat?listTraits.xmlName??listMember.getMemberName():listValueTraits.xmlName??"member"))}else{let listItemNode=xmlBuilder.XmlNode.of(flat?listTraits.xmlName??listMember.getMemberName():listValueTraits.xmlName??"member");this.writeSimpleInto(listValueSchema,value,listItemNode,xmlns),container2.addChildNode(listItemNode)}};if(flat){for(let value of array)if(sparse||value!=null)writeItem(container,value)}else{let listNode=xmlBuilder.XmlNode.of(listTraits.xmlName??listMember.getMemberName());if(xmlns)listNode.addAttribute(xmlnsAttr,xmlns);for(let value of array)if(sparse||value!=null)writeItem(listNode,value);container.addChildNode(listNode)}}writeMap(mapMember,map3,container,parentXmlns,containerIsMap=!1){if(!mapMember.isMemberSchema())throw Error(`@aws-sdk/core/protocols - xml serializer, cannot write non-member map: ${mapMember.getName(!0)}`);let mapTraits=mapMember.getMergedTraits(),mapKeySchema=mapMember.getKeySchema(),keyTag=mapKeySchema.getMergedTraits().xmlName??"key",mapValueSchema=mapMember.getValueSchema(),mapValueTraits=mapValueSchema.getMergedTraits(),valueTag=mapValueTraits.xmlName??"value",sparse=!!mapValueTraits.sparse,flat=!!mapTraits.xmlFlattened,[xmlnsAttr,xmlns]=this.getXmlnsAttribute(mapMember,parentXmlns),addKeyValue=(entry,key,val)=>{let keyNode=xmlBuilder.XmlNode.of(keyTag,key),[keyXmlnsAttr,keyXmlns]=this.getXmlnsAttribute(mapKeySchema,xmlns);if(keyXmlns)keyNode.addAttribute(keyXmlnsAttr,keyXmlns);entry.addChildNode(keyNode);let valueNode=xmlBuilder.XmlNode.of(valueTag);if(mapValueSchema.isListSchema())this.writeList(mapValueSchema,val,valueNode,xmlns);else if(mapValueSchema.isMapSchema())this.writeMap(mapValueSchema,val,valueNode,xmlns,!0);else if(mapValueSchema.isStructSchema())valueNode=this.writeStruct(mapValueSchema,val,xmlns);else this.writeSimpleInto(mapValueSchema,val,valueNode,xmlns);entry.addChildNode(valueNode)};if(flat){for(let[key,val]of Object.entries(map3))if(sparse||val!=null){let entry=xmlBuilder.XmlNode.of(mapTraits.xmlName??mapMember.getMemberName());addKeyValue(entry,key,val),container.addChildNode(entry)}}else{let mapNode;if(!containerIsMap){if(mapNode=xmlBuilder.XmlNode.of(mapTraits.xmlName??mapMember.getMemberName()),xmlns)mapNode.addAttribute(xmlnsAttr,xmlns);container.addChildNode(mapNode)}for(let[key,val]of Object.entries(map3))if(sparse||val!=null){let entry=xmlBuilder.XmlNode.of("entry");addKeyValue(entry,key,val),(containerIsMap?container:mapNode).addChildNode(entry)}}}writeSimple(_schema,value){if(value===null)throw Error("@aws-sdk/core/protocols - (XML serializer) cannot write null value.");let ns=schema.NormalizedSchema.of(_schema),nodeContents=null;if(value&&typeof value==="object")if(ns.isBlobSchema())nodeContents=(this.serdeContext?.base64Encoder??utilBase64.toBase64)(value);else if(ns.isTimestampSchema()&&value instanceof Date)switch(protocols.determineTimestampFormat(ns,this.settings)){case 5:nodeContents=value.toISOString().replace(".000Z","Z");break;case 6:nodeContents=smithyClient.dateToUtcString(value);break;case 7:nodeContents=String(value.getTime()/1000);break;default:console.warn("Missing timestamp format, using http date",value),nodeContents=smithyClient.dateToUtcString(value);break}else if(ns.isBigDecimalSchema()&&value){if(value instanceof serde.NumericValue)return value.string;return String(value)}else if(ns.isMapSchema()||ns.isListSchema())throw Error("@aws-sdk/core/protocols - xml serializer, cannot call _write() on List/Map schema, call writeList or writeMap() instead.");else throw Error(`@aws-sdk/core/protocols - xml serializer, unhandled schema type for object value and schema: ${ns.getName(!0)}`);if(ns.isBooleanSchema()||ns.isNumericSchema()||ns.isBigIntegerSchema()||ns.isBigDecimalSchema())nodeContents=String(value);if(ns.isStringSchema())if(value===void 0&&ns.isIdempotencyToken())nodeContents=serde.generateIdempotencyToken();else nodeContents=String(value);if(nodeContents===null)throw Error(`Unhandled schema-value pair ${ns.getName(!0)}=${value}`);return nodeContents}writeSimpleInto(_schema,value,into,parentXmlns){let nodeContents=this.writeSimple(_schema,value),ns=schema.NormalizedSchema.of(_schema),content=new xmlBuilder.XmlText(nodeContents),[xmlnsAttr,xmlns]=this.getXmlnsAttribute(ns,parentXmlns);if(xmlns)into.addAttribute(xmlnsAttr,xmlns);into.addChildNode(content)}getXmlnsAttribute(ns,parentXmlns){let traits=ns.getMergedTraits(),[prefix,xmlns]=traits.xmlNamespace??[];if(xmlns&&xmlns!==parentXmlns)return[prefix?`xmlns:${prefix}`:"xmlns",xmlns];return[void 0,void 0]}}class XmlCodec extends SerdeContextConfig{settings;constructor(settings){super();this.settings=settings}createSerializer(){let serializer=new XmlShapeSerializer(this.settings);return serializer.setSerdeContext(this.serdeContext),serializer}createDeserializer(){let deserializer=new XmlShapeDeserializer(this.settings);return deserializer.setSerdeContext(this.serdeContext),deserializer}}class AwsRestXmlProtocol extends protocols.HttpBindingProtocol{codec;serializer;deserializer;mixin=new ProtocolLib;constructor(options){super(options);let settings={timestampFormat:{useTrait:!0,default:5},httpBindings:!0,xmlNamespace:options.xmlNamespace,serviceNamespace:options.defaultNamespace};this.codec=new XmlCodec(settings),this.serializer=new protocols.HttpInterceptingShapeSerializer(this.codec.createSerializer(),settings),this.deserializer=new protocols.HttpInterceptingShapeDeserializer(this.codec.createDeserializer(),settings)}getPayloadCodec(){return this.codec}getShapeId(){return"aws.protocols#restXml"}async serializeRequest(operationSchema,input,context){let request2=await super.serializeRequest(operationSchema,input,context),inputSchema=schema.NormalizedSchema.of(operationSchema.input);if(!request2.headers["content-type"]){let contentType=this.mixin.resolveRestContentType(this.getDefaultContentType(),inputSchema);if(contentType)request2.headers["content-type"]=contentType}if(typeof request2.body==="string"&&request2.headers["content-type"]===this.getDefaultContentType()&&!request2.body.startsWith("<?xml ")&&!this.hasUnstructuredPayloadBinding(inputSchema))request2.body='<?xml version="1.0" encoding="UTF-8"?>'+request2.body;return request2}async deserializeResponse(operationSchema,context,response){return super.deserializeResponse(operationSchema,context,response)}async handleError(operationSchema,context,response,dataObject,metadata){let errorIdentifier=loadRestXmlErrorCode(response,dataObject)??"Unknown";if(dataObject.Error&&typeof dataObject.Error==="object"){for(let key of Object.keys(dataObject.Error))if(dataObject[key]=dataObject.Error[key],key.toLowerCase()==="message")dataObject.message=dataObject.Error[key]}if(dataObject.RequestId&&!metadata.requestId)metadata.requestId=dataObject.RequestId;let{errorSchema,errorMetadata}=await this.mixin.getErrorSchemaOrThrowBaseException(errorIdentifier,this.options.defaultNamespace,response,dataObject,metadata),ns=schema.NormalizedSchema.of(errorSchema),message=dataObject.Error?.message??dataObject.Error?.Message??dataObject.message??dataObject.Message??"Unknown",exception=new(schema.TypeRegistry.for(errorSchema[1]).getErrorCtor(errorSchema)??Error)(message);await this.deserializeHttpMessage(errorSchema,context,response,dataObject);let output={};for(let[name,member]of ns.structIterator()){let target=member.getMergedTraits().xmlName??name,value=dataObject.Error?.[target]??dataObject[target];output[name]=this.codec.createDeserializer().readSchema(member,value)}throw this.mixin.decorateServiceException(Object.assign(exception,errorMetadata,{$fault:ns.getMergedTraits().error,message},output),dataObject)}getDefaultContentType(){return"application/xml"}hasUnstructuredPayloadBinding(ns){for(let[,member]of ns.structIterator())if(member.getMergedTraits().httpPayload)return!(member.isStructSchema()||member.isMapSchema()||member.isListSchema());return!1}}exports.AwsEc2QueryProtocol=AwsEc2QueryProtocol;exports.AwsJson1_0Protocol=AwsJson1_0Protocol;exports.AwsJson1_1Protocol=AwsJson1_1Protocol;exports.AwsJsonRpcProtocol=AwsJsonRpcProtocol;exports.AwsQueryProtocol=AwsQueryProtocol;exports.AwsRestJsonProtocol=AwsRestJsonProtocol;exports.AwsRestXmlProtocol=AwsRestXmlProtocol;exports.AwsSmithyRpcV2CborProtocol=AwsSmithyRpcV2CborProtocol;exports.JsonCodec=JsonCodec;exports.JsonShapeDeserializer=JsonShapeDeserializer;exports.JsonShapeSerializer=JsonShapeSerializer;exports.XmlCodec=XmlCodec;exports.XmlShapeDeserializer=XmlShapeDeserializer;exports.XmlShapeSerializer=XmlShapeSerializer;exports._toBool=_toBool;exports._toNum=_toNum;exports._toStr=_toStr;exports.awsExpectUnion=awsExpectUnion;exports.loadRestJsonErrorCode=loadRestJsonErrorCode;exports.loadRestXmlErrorCode=loadRestXmlErrorCode;exports.parseJsonBody=parseJsonBody;exports.parseJsonErrorBody=parseJsonErrorBody;exports.parseXmlBody=parseXmlBody;exports.parseXmlErrorBody=parseXmlErrorBody});var require_ruleset=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.ruleSet=void 0;var u="required",v="fn",w="argv",x="ref",a12=!0,b2="isSet",c="booleanEquals",d="error",e="endpoint",f="tree",g="PartitionResult",h="getAttr",i={[u]:!1,type:"string"},j={[u]:!0,default:!1,type:"boolean"},k2={[x]:"Endpoint"},l2={[v]:c,[w]:[{[x]:"UseFIPS"},!0]},m2={[v]:c,[w]:[{[x]:"UseDualStack"},!0]},n2={},o={[v]:h,[w]:[{[x]:g},"supportsFIPS"]},p={[x]:g},q={[v]:c,[w]:[!0,{[v]:h,[w]:[p,"supportsDualStack"]}]},r2=[l2],s=[m2],t8=[{[x]:"Region"}],_data2={version:"1.0",parameters:{Region:i,UseDualStack:j,UseFIPS:j,Endpoint:i},rules:[{conditions:[{[v]:b2,[w]:[k2]}],rules:[{conditions:r2,error:"Invalid Configuration: FIPS and custom endpoint are not supported",type:d},{conditions:s,error:"Invalid Configuration: Dualstack and custom endpoint are not supported",type:d},{endpoint:{url:k2,properties:n2,headers:n2},type:e}],type:f},{conditions:[{[v]:b2,[w]:t8}],rules:[{conditions:[{[v]:"aws.partition",[w]:t8,assign:g}],rules:[{conditions:[l2,m2],rules:[{conditions:[{[v]:c,[w]:[a12,o]},q],rules:[{endpoint:{url:"https://oidc-fips.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:n2,headers:n2},type:e}],type:f},{error:"FIPS and DualStack are enabled, but this partition does not support one or both",type:d}],type:f},{conditions:r2,rules:[{conditions:[{[v]:c,[w]:[o,a12]}],rules:[{conditions:[{[v]:"stringEquals",[w]:[{[v]:h,[w]:[p,"name"]},"aws-us-gov"]}],endpoint:{url:"https://oidc.{Region}.amazonaws.com",properties:n2,headers:n2},type:e},{endpoint:{url:"https://oidc-fips.{Region}.{PartitionResult#dnsSuffix}",properties:n2,headers:n2},type:e}],type:f},{error:"FIPS is enabled but this partition does not support FIPS",type:d}],type:f},{conditions:s,rules:[{conditions:[q],rules:[{endpoint:{url:"https://oidc.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:n2,headers:n2},type:e}],type:f},{error:"DualStack is enabled but this partition does not support DualStack",type:d}],type:f},{endpoint:{url:"https://oidc.{Region}.{PartitionResult#dnsSuffix}",properties:n2,headers:n2},type:e}],type:f}],type:f},{error:"Invalid Configuration: Missing Region",type:d}]};exports.ruleSet=_data2});var require_endpointResolver=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.defaultEndpointResolver=void 0;var util_endpoints_1=require_dist_cjs31(),util_endpoints_2=require_dist_cjs28(),ruleset_1=require_ruleset(),cache3=new util_endpoints_2.EndpointCache({size:50,params:["Endpoint","Region","UseDualStack","UseFIPS"]}),defaultEndpointResolver2=(endpointParams,context={})=>{return cache3.get(endpointParams,()=>(0,util_endpoints_2.resolveEndpoint)(ruleset_1.ruleSet,{endpointParams,logger:context.logger}))};exports.defaultEndpointResolver=defaultEndpointResolver2;util_endpoints_2.customEndpointFunctions.aws=util_endpoints_1.awsEndpointFunctions});var require_SSOOIDCServiceException=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.SSOOIDCServiceException=exports.__ServiceException=void 0;var smithy_client_1=require_dist_cjs21();Object.defineProperty(exports,"__ServiceException",{enumerable:!0,get:function(){return smithy_client_1.ServiceException}});class SSOOIDCServiceException extends smithy_client_1.ServiceException{constructor(options){super(options);Object.setPrototypeOf(this,SSOOIDCServiceException.prototype)}}exports.SSOOIDCServiceException=SSOOIDCServiceException});var require_errors=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.UnsupportedGrantTypeException=exports.UnauthorizedClientException=exports.SlowDownException=exports.InvalidScopeException=exports.InvalidRequestException=exports.InvalidGrantException=exports.InvalidClientException=exports.InternalServerException=exports.ExpiredTokenException=exports.AuthorizationPendingException=exports.AccessDeniedException=void 0;var SSOOIDCServiceException_1=require_SSOOIDCServiceException();class AccessDeniedException extends SSOOIDCServiceException_1.SSOOIDCServiceException{name="AccessDeniedException";$fault="client";error;reason;error_description;constructor(opts){super({name:"AccessDeniedException",$fault:"client",...opts});Object.setPrototypeOf(this,AccessDeniedException.prototype),this.error=opts.error,this.reason=opts.reason,this.error_description=opts.error_description}}exports.AccessDeniedException=AccessDeniedException;class AuthorizationPendingException extends SSOOIDCServiceException_1.SSOOIDCServiceException{name="AuthorizationPendingException";$fault="client";error;error_description;constructor(opts){super({name:"AuthorizationPendingException",$fault:"client",...opts});Object.setPrototypeOf(this,AuthorizationPendingException.prototype),this.error=opts.error,this.error_description=opts.error_description}}exports.AuthorizationPendingException=AuthorizationPendingException;class ExpiredTokenException extends SSOOIDCServiceException_1.SSOOIDCServiceException{name="ExpiredTokenException";$fault="client";error;error_description;constructor(opts){super({name:"ExpiredTokenException",$fault:"client",...opts});Object.setPrototypeOf(this,ExpiredTokenException.prototype),this.error=opts.error,this.error_description=opts.error_description}}exports.ExpiredTokenException=ExpiredTokenException;class InternalServerException extends SSOOIDCServiceException_1.SSOOIDCServiceException{name="InternalServerException";$fault="server";error;error_description;constructor(opts){super({name:"InternalServerException",$fault:"server",...opts});Object.setPrototypeOf(this,InternalServerException.prototype),this.error=opts.error,this.error_description=opts.error_description}}exports.InternalServerException=InternalServerException;class InvalidClientException extends SSOOIDCServiceException_1.SSOOIDCServiceException{name="InvalidClientException";$fault="client";error;error_description;constructor(opts){super({name:"InvalidClientException",$fault:"client",...opts});Object.setPrototypeOf(this,InvalidClientException.prototype),this.error=opts.error,this.error_description=opts.error_description}}exports.InvalidClientException=InvalidClientException;class InvalidGrantException extends SSOOIDCServiceException_1.SSOOIDCServiceException{name="InvalidGrantException";$fault="client";error;error_description;constructor(opts){super({name:"InvalidGrantException",$fault:"client",...opts});Object.setPrototypeOf(this,InvalidGrantException.prototype),this.error=opts.error,this.error_description=opts.error_description}}exports.InvalidGrantException=InvalidGrantException;class InvalidRequestException extends SSOOIDCServiceException_1.SSOOIDCServiceException{name="InvalidRequestException";$fault="client";error;reason;error_description;constructor(opts){super({name:"InvalidRequestException",$fault:"client",...opts});Object.setPrototypeOf(this,InvalidRequestException.prototype),this.error=opts.error,this.reason=opts.reason,this.error_description=opts.error_description}}exports.InvalidRequestException=InvalidRequestException;class InvalidScopeException extends SSOOIDCServiceException_1.SSOOIDCServiceException{name="InvalidScopeException";$fault="client";error;error_description;constructor(opts){super({name:"InvalidScopeException",$fault:"client",...opts});Object.setPrototypeOf(this,InvalidScopeException.prototype),this.error=opts.error,this.error_description=opts.error_description}}exports.InvalidScopeException=InvalidScopeException;class SlowDownException extends SSOOIDCServiceException_1.SSOOIDCServiceException{name="SlowDownException";$fault="client";error;error_description;constructor(opts){super({name:"SlowDownException",$fault:"client",...opts});Object.setPrototypeOf(this,SlowDownException.prototype),this.error=opts.error,this.error_description=opts.error_description}}exports.SlowDownException=SlowDownException;class UnauthorizedClientException extends SSOOIDCServiceException_1.SSOOIDCServiceException{name="UnauthorizedClientException";$fault="client";error;error_description;constructor(opts){super({name:"UnauthorizedClientException",$fault:"client",...opts});Object.setPrototypeOf(this,UnauthorizedClientException.prototype),this.error=opts.error,this.error_description=opts.error_description}}exports.UnauthorizedClientException=UnauthorizedClientException;class UnsupportedGrantTypeException extends SSOOIDCServiceException_1.SSOOIDCServiceException{name="UnsupportedGrantTypeException";$fault="client";error;error_description;constructor(opts){super({name:"UnsupportedGrantTypeException",$fault:"client",...opts});Object.setPrototypeOf(this,UnsupportedGrantTypeException.prototype),this.error=opts.error,this.error_description=opts.error_description}}exports.UnsupportedGrantTypeException=UnsupportedGrantTypeException});var require_schemas_0=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.CreateToken$=exports.CreateTokenResponse$=exports.CreateTokenRequest$=exports.errorTypeRegistries=exports.UnsupportedGrantTypeException$=exports.UnauthorizedClientException$=exports.SlowDownException$=exports.InvalidScopeException$=exports.InvalidRequestException$=exports.InvalidGrantException$=exports.InvalidClientException$=exports.InternalServerException$=exports.ExpiredTokenException$=exports.AuthorizationPendingException$=exports.AccessDeniedException$=exports.SSOOIDCServiceException$=void 0;var _ADE="AccessDeniedException",_APE="AuthorizationPendingException",_AT="AccessToken",_CS="ClientSecret",_CT="CreateToken",_CTR="CreateTokenRequest",_CTRr="CreateTokenResponse",_CV="CodeVerifier",_ETE="ExpiredTokenException",_ICE="InvalidClientException",_IGE="InvalidGrantException",_IRE="InvalidRequestException",_ISE="InternalServerException",_ISEn="InvalidScopeException",_IT="IdToken",_RT="RefreshToken",_SDE="SlowDownException",_UCE="UnauthorizedClientException",_UGTE="UnsupportedGrantTypeException",_aT="accessToken",_c="client",_cI="clientId",_cS="clientSecret",_cV="codeVerifier",_co="code",_dC="deviceCode",_e="error",_eI="expiresIn",_ed="error_description",_gT="grantType",_h="http",_hE="httpError",_iT="idToken",_r="reason",_rT="refreshToken",_rU="redirectUri",_s="smithy.ts.sdk.synthetic.com.amazonaws.ssooidc",_sc="scope",_se="server",_tT="tokenType",n0="com.amazonaws.ssooidc",schema_1=require_schema(),errors_1=require_errors(),SSOOIDCServiceException_1=require_SSOOIDCServiceException(),_s_registry2=schema_1.TypeRegistry.for(_s);exports.SSOOIDCServiceException$=[-3,_s,"SSOOIDCServiceException",0,[],[]];_s_registry2.registerError(exports.SSOOIDCServiceException$,SSOOIDCServiceException_1.SSOOIDCServiceException);var n0_registry2=schema_1.TypeRegistry.for(n0);exports.AccessDeniedException$=[-3,n0,_ADE,{[_e]:_c,[_hE]:400},[_e,_r,_ed],[0,0,0]];n0_registry2.registerError(exports.AccessDeniedException$,errors_1.AccessDeniedException);exports.AuthorizationPendingException$=[-3,n0,_APE,{[_e]:_c,[_hE]:400},[_e,_ed],[0,0]];n0_registry2.registerError(exports.AuthorizationPendingException$,errors_1.AuthorizationPendingException);exports.ExpiredTokenException$=[-3,n0,_ETE,{[_e]:_c,[_hE]:400},[_e,_ed],[0,0]];n0_registry2.registerError(exports.ExpiredTokenException$,errors_1.ExpiredTokenException);exports.InternalServerException$=[-3,n0,_ISE,{[_e]:_se,[_hE]:500},[_e,_ed],[0,0]];n0_registry2.registerError(exports.InternalServerException$,errors_1.InternalServerException);exports.InvalidClientException$=[-3,n0,_ICE,{[_e]:_c,[_hE]:401},[_e,_ed],[0,0]];n0_registry2.registerError(exports.InvalidClientException$,errors_1.InvalidClientException);exports.InvalidGrantException$=[-3,n0,_IGE,{[_e]:_c,[_hE]:400},[_e,_ed],[0,0]];n0_registry2.registerError(exports.InvalidGrantException$,errors_1.InvalidGrantException);exports.InvalidRequestException$=[-3,n0,_IRE,{[_e]:_c,[_hE]:400},[_e,_r,_ed],[0,0,0]];n0_registry2.registerError(exports.InvalidRequestException$,errors_1.InvalidRequestException);exports.InvalidScopeException$=[-3,n0,_ISEn,{[_e]:_c,[_hE]:400},[_e,_ed],[0,0]];n0_registry2.registerError(exports.InvalidScopeException$,errors_1.InvalidScopeException);exports.SlowDownException$=[-3,n0,_SDE,{[_e]:_c,[_hE]:400},[_e,_ed],[0,0]];n0_registry2.registerError(exports.SlowDownException$,errors_1.SlowDownException);exports.UnauthorizedClientException$=[-3,n0,_UCE,{[_e]:_c,[_hE]:400},[_e,_ed],[0,0]];n0_registry2.registerError(exports.UnauthorizedClientException$,errors_1.UnauthorizedClientException);exports.UnsupportedGrantTypeException$=[-3,n0,_UGTE,{[_e]:_c,[_hE]:400},[_e,_ed],[0,0]];n0_registry2.registerError(exports.UnsupportedGrantTypeException$,errors_1.UnsupportedGrantTypeException);exports.errorTypeRegistries=[_s_registry2,n0_registry2];var AccessToken=[0,n0,_AT,8,0],ClientSecret=[0,n0,_CS,8,0],CodeVerifier=[0,n0,_CV,8,0],IdToken=[0,n0,_IT,8,0],RefreshToken=[0,n0,_RT,8,0];exports.CreateTokenRequest$=[3,n0,_CTR,0,[_cI,_cS,_gT,_dC,_co,_rT,_sc,_rU,_cV],[0,[()=>ClientSecret,0],0,0,0,[()=>RefreshToken,0],64,0,[()=>CodeVerifier,0]],3];exports.CreateTokenResponse$=[3,n0,_CTRr,0,[_aT,_tT,_eI,_rT,_iT],[[()=>AccessToken,0],0,1,[()=>RefreshToken,0],[()=>IdToken,0]]];exports.CreateToken$=[9,n0,_CT,{[_h]:["POST","/token",200]},()=>exports.CreateTokenRequest$,()=>exports.CreateTokenResponse$]});var require_runtimeConfig_shared=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.getRuntimeConfig=void 0;var core_1=require_dist_cjs23(),protocols_1=require_protocols2(),core_2=require_dist_cjs16(),smithy_client_1=require_dist_cjs21(),url_parser_1=require_dist_cjs30(),util_base64_1=require_dist_cjs8(),util_utf8_1=require_dist_cjs7(),httpAuthSchemeProvider_1=require_httpAuthSchemeProvider(),endpointResolver_1=require_endpointResolver(),schemas_0_1=require_schemas_0(),getRuntimeConfig=(config)=>{return{apiVersion:"2019-06-10",base64Decoder:config?.base64Decoder??util_base64_1.fromBase64,base64Encoder:config?.base64Encoder??util_base64_1.toBase64,disableHostPrefix:config?.disableHostPrefix??!1,endpointProvider:config?.endpointProvider??endpointResolver_1.defaultEndpointResolver,extensions:config?.extensions??[],httpAuthSchemeProvider:config?.httpAuthSchemeProvider??httpAuthSchemeProvider_1.defaultSSOOIDCHttpAuthSchemeProvider,httpAuthSchemes:config?.httpAuthSchemes??[{schemeId:"aws.auth#sigv4",identityProvider:(ipc)=>ipc.getIdentityProvider("aws.auth#sigv4"),signer:new core_1.AwsSdkSigV4Signer},{schemeId:"smithy.api#noAuth",identityProvider:(ipc)=>ipc.getIdentityProvider("smithy.api#noAuth")||(async()=>({})),signer:new core_2.NoAuthSigner}],logger:config?.logger??new smithy_client_1.NoOpLogger,protocol:config?.protocol??protocols_1.AwsRestJsonProtocol,protocolSettings:config?.protocolSettings??{defaultNamespace:"com.amazonaws.ssooidc",errorTypeRegistries:schemas_0_1.errorTypeRegistries,version:"2019-06-10",serviceTarget:"AWSSSOOIDCService"},serviceId:config?.serviceId??"SSO OIDC",urlParser:config?.urlParser??url_parser_1.parseUrl,utf8Decoder:config?.utf8Decoder??util_utf8_1.fromUtf8,utf8Encoder:config?.utf8Encoder??util_utf8_1.toUtf8}};exports.getRuntimeConfig=getRuntimeConfig});var require_runtimeConfig=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.getRuntimeConfig=void 0;var tslib_1=require_tslib(),package_json_1=tslib_1.__importDefault(require_package2()),core_1=require_dist_cjs23(),util_user_agent_node_1=require_dist_cjs41(),config_resolver_1=require_dist_cjs33(),hash_node_1=require_dist_cjs42(),middleware_retry_1=require_dist_cjs40(),node_config_provider_1=require_dist_cjs36(),node_http_handler_1=require_dist_cjs11(),smithy_client_1=require_dist_cjs21(),util_body_length_node_1=require_dist_cjs43(),util_defaults_mode_node_1=require_dist_cjs44(),util_retry_1=require_dist_cjs39(),runtimeConfig_shared_1=require_runtimeConfig_shared(),getRuntimeConfig=(config)=>{(0,smithy_client_1.emitWarningIfUnsupportedVersion)(process.version);let defaultsMode=(0,util_defaults_mode_node_1.resolveDefaultsModeConfig)(config),defaultConfigProvider=()=>defaultsMode().then(smithy_client_1.loadConfigsForDefaultMode),clientSharedValues=(0,runtimeConfig_shared_1.getRuntimeConfig)(config);(0,core_1.emitWarningIfUnsupportedVersion)(process.version);let loaderConfig={profile:config?.profile,logger:clientSharedValues.logger};return{...clientSharedValues,...config,runtime:"node",defaultsMode,authSchemePreference:config?.authSchemePreference??(0,node_config_provider_1.loadConfig)(core_1.NODE_AUTH_SCHEME_PREFERENCE_OPTIONS,loaderConfig),bodyLengthChecker:config?.bodyLengthChecker??util_body_length_node_1.calculateBodyLength,defaultUserAgentProvider:config?.defaultUserAgentProvider??(0,util_user_agent_node_1.createDefaultUserAgentProvider)({serviceId:clientSharedValues.serviceId,clientVersion:package_json_1.default.version}),maxAttempts:config?.maxAttempts??(0,node_config_provider_1.loadConfig)(middleware_retry_1.NODE_MAX_ATTEMPT_CONFIG_OPTIONS,config),region:config?.region??(0,node_config_provider_1.loadConfig)(config_resolver_1.NODE_REGION_CONFIG_OPTIONS,{...config_resolver_1.NODE_REGION_CONFIG_FILE_OPTIONS,...loaderConfig}),requestHandler:node_http_handler_1.NodeHttpHandler.create(config?.requestHandler??defaultConfigProvider),retryMode:config?.retryMode??(0,node_config_provider_1.loadConfig)({...middleware_retry_1.NODE_RETRY_MODE_CONFIG_OPTIONS,default:async()=>(await defaultConfigProvider()).retryMode||util_retry_1.DEFAULT_RETRY_MODE},config),sha256:config?.sha256??hash_node_1.Hash.bind(null,"sha256"),streamCollector:config?.streamCollector??node_http_handler_1.streamCollector,useDualstackEndpoint:config?.useDualstackEndpoint??(0,node_config_provider_1.loadConfig)(config_resolver_1.NODE_USE_DUALSTACK_ENDPOINT_CONFIG_OPTIONS,loaderConfig),useFipsEndpoint:config?.useFipsEndpoint??(0,node_config_provider_1.loadConfig)(config_resolver_1.NODE_USE_FIPS_ENDPOINT_CONFIG_OPTIONS,loaderConfig),userAgentAppId:config?.userAgentAppId??(0,node_config_provider_1.loadConfig)(util_user_agent_node_1.NODE_APP_ID_CONFIG_OPTIONS,loaderConfig)}};exports.getRuntimeConfig=getRuntimeConfig});var require_stsRegionDefaultResolver=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.warning=void 0;exports.stsRegionDefaultResolver=stsRegionDefaultResolver;var config_resolver_1=require_dist_cjs33(),node_config_provider_1=require_dist_cjs36();function stsRegionDefaultResolver(loaderConfig={}){return(0,node_config_provider_1.loadConfig)({...config_resolver_1.NODE_REGION_CONFIG_OPTIONS,async default(){if(!exports.warning.silence)console.warn("@aws-sdk - WARN - default STS region of us-east-1 used. See @aws-sdk/credential-providers README and set a region explicitly.");return"us-east-1"}},{...config_resolver_1.NODE_REGION_CONFIG_FILE_OPTIONS,...loaderConfig})}exports.warning={silence:!1}});var require_dist_cjs45=__commonJS((exports)=>{var stsRegionDefaultResolver=require_stsRegionDefaultResolver(),configResolver=require_dist_cjs33(),getAwsRegionExtensionConfiguration=(runtimeConfig)=>{return{setRegion(region){runtimeConfig.region=region},region(){return runtimeConfig.region}}},resolveAwsRegionExtensionConfiguration=(awsRegionExtensionConfiguration)=>{return{region:awsRegionExtensionConfiguration.region()}};Object.defineProperty(exports,"NODE_REGION_CONFIG_FILE_OPTIONS",{enumerable:!0,get:function(){return configResolver.NODE_REGION_CONFIG_FILE_OPTIONS}});Object.defineProperty(exports,"NODE_REGION_CONFIG_OPTIONS",{enumerable:!0,get:function(){return configResolver.NODE_REGION_CONFIG_OPTIONS}});Object.defineProperty(exports,"REGION_ENV_NAME",{enumerable:!0,get:function(){return configResolver.REGION_ENV_NAME}});Object.defineProperty(exports,"REGION_INI_NAME",{enumerable:!0,get:function(){return configResolver.REGION_INI_NAME}});Object.defineProperty(exports,"resolveRegionConfig",{enumerable:!0,get:function(){return configResolver.resolveRegionConfig}});exports.getAwsRegionExtensionConfiguration=getAwsRegionExtensionConfiguration;exports.resolveAwsRegionExtensionConfiguration=resolveAwsRegionExtensionConfiguration;Object.keys(stsRegionDefaultResolver).forEach(function(k2){if(k2!=="default"&&!Object.prototype.hasOwnProperty.call(exports,k2))Object.defineProperty(exports,k2,{enumerable:!0,get:function(){return stsRegionDefaultResolver[k2]}})})});var require_sso_oidc=__commonJS((exports)=>{var middlewareHostHeader=require_dist_cjs24(),middlewareLogger=require_dist_cjs25(),middlewareRecursionDetection=require_dist_cjs26(),middlewareUserAgent=require_dist_cjs32(),configResolver=require_dist_cjs33(),core2=require_dist_cjs16(),schema=require_schema(),middlewareContentLength=require_dist_cjs34(),middlewareEndpoint=require_dist_cjs37(),middlewareRetry=require_dist_cjs40(),smithyClient=require_dist_cjs21(),httpAuthSchemeProvider=require_httpAuthSchemeProvider(),runtimeConfig=require_runtimeConfig(),regionConfigResolver=require_dist_cjs45(),protocolHttp=require_dist_cjs2(),schemas_0=require_schemas_0(),errors2=require_errors(),SSOOIDCServiceException=require_SSOOIDCServiceException(),resolveClientEndpointParameters2=(options)=>{return Object.assign(options,{useDualstackEndpoint:options.useDualstackEndpoint??!1,useFipsEndpoint:options.useFipsEndpoint??!1,defaultSigningName:"sso-oauth"})},commonParams2={UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}},getHttpAuthExtensionConfiguration=(runtimeConfig2)=>{let{httpAuthSchemes:_httpAuthSchemes,httpAuthSchemeProvider:_httpAuthSchemeProvider,credentials:_credentials}=runtimeConfig2;return{setHttpAuthScheme(httpAuthScheme){let index2=_httpAuthSchemes.findIndex((scheme)=>scheme.schemeId===httpAuthScheme.schemeId);if(index2===-1)_httpAuthSchemes.push(httpAuthScheme);else _httpAuthSchemes.splice(index2,1,httpAuthScheme)},httpAuthSchemes(){return _httpAuthSchemes},setHttpAuthSchemeProvider(httpAuthSchemeProvider2){_httpAuthSchemeProvider=httpAuthSchemeProvider2},httpAuthSchemeProvider(){return _httpAuthSchemeProvider},setCredentials(credentials){_credentials=credentials},credentials(){return _credentials}}},resolveHttpAuthRuntimeConfig=(config)=>{return{httpAuthSchemes:config.httpAuthSchemes(),httpAuthSchemeProvider:config.httpAuthSchemeProvider(),credentials:config.credentials()}},resolveRuntimeExtensions=(runtimeConfig2,extensions2)=>{let extensionConfiguration=Object.assign(regionConfigResolver.getAwsRegionExtensionConfiguration(runtimeConfig2),smithyClient.getDefaultExtensionConfiguration(runtimeConfig2),protocolHttp.getHttpHandlerExtensionConfiguration(runtimeConfig2),getHttpAuthExtensionConfiguration(runtimeConfig2));return extensions2.forEach((extension)=>extension.configure(extensionConfiguration)),Object.assign(runtimeConfig2,regionConfigResolver.resolveAwsRegionExtensionConfiguration(extensionConfiguration),smithyClient.resolveDefaultRuntimeConfig(extensionConfiguration),protocolHttp.resolveHttpHandlerRuntimeConfig(extensionConfiguration),resolveHttpAuthRuntimeConfig(extensionConfiguration))};class SSOOIDCClient extends smithyClient.Client{config;constructor(...[configuration]){let _config_0=runtimeConfig.getRuntimeConfig(configuration||{});super(_config_0);this.initConfig=_config_0;let _config_1=resolveClientEndpointParameters2(_config_0),_config_2=middlewareUserAgent.resolveUserAgentConfig(_config_1),_config_3=middlewareRetry.resolveRetryConfig(_config_2),_config_4=configResolver.resolveRegionConfig(_config_3),_config_5=middlewareHostHeader.resolveHostHeaderConfig(_config_4),_config_6=middlewareEndpoint.resolveEndpointConfig(_config_5),_config_7=httpAuthSchemeProvider.resolveHttpAuthSchemeConfig(_config_6),_config_8=resolveRuntimeExtensions(_config_7,configuration?.extensions||[]);this.config=_config_8,this.middlewareStack.use(schema.getSchemaSerdePlugin(this.config)),this.middlewareStack.use(middlewareUserAgent.getUserAgentPlugin(this.config)),this.middlewareStack.use(middlewareRetry.getRetryPlugin(this.config)),this.middlewareStack.use(middlewareContentLength.getContentLengthPlugin(this.config)),this.middlewareStack.use(middlewareHostHeader.getHostHeaderPlugin(this.config)),this.middlewareStack.use(middlewareLogger.getLoggerPlugin(this.config)),this.middlewareStack.use(middlewareRecursionDetection.getRecursionDetectionPlugin(this.config)),this.middlewareStack.use(core2.getHttpAuthSchemeEndpointRuleSetPlugin(this.config,{httpAuthSchemeParametersProvider:httpAuthSchemeProvider.defaultSSOOIDCHttpAuthSchemeParametersProvider,identityProviderConfigProvider:async(config)=>new core2.DefaultIdentityProviderConfig({"aws.auth#sigv4":config.credentials})})),this.middlewareStack.use(core2.getHttpSigningPlugin(this.config))}destroy(){super.destroy()}}class CreateTokenCommand extends smithyClient.Command.classBuilder().ep(commonParams2).m(function(Command,cs,config,o){return[middlewareEndpoint.getEndpointPlugin(config,Command.getEndpointParameterInstructions())]}).s("AWSSSOOIDCService","CreateToken",{}).n("SSOOIDCClient","CreateTokenCommand").sc(schemas_0.CreateToken$).build(){}var commands={CreateTokenCommand};class SSOOIDC extends SSOOIDCClient{}smithyClient.createAggregatedClient(commands,SSOOIDC);var AccessDeniedExceptionReason={KMS_ACCESS_DENIED:"KMS_AccessDeniedException"},InvalidRequestExceptionReason={KMS_DISABLED_KEY:"KMS_DisabledException",KMS_INVALID_KEY_USAGE:"KMS_InvalidKeyUsageException",KMS_INVALID_STATE:"KMS_InvalidStateException",KMS_KEY_NOT_FOUND:"KMS_NotFoundException"};Object.defineProperty(exports,"$Command",{enumerable:!0,get:function(){return smithyClient.Command}});Object.defineProperty(exports,"__Client",{enumerable:!0,get:function(){return smithyClient.Client}});Object.defineProperty(exports,"SSOOIDCServiceException",{enumerable:!0,get:function(){return SSOOIDCServiceException.SSOOIDCServiceException}});exports.AccessDeniedExceptionReason=AccessDeniedExceptionReason;exports.CreateTokenCommand=CreateTokenCommand;exports.InvalidRequestExceptionReason=InvalidRequestExceptionReason;exports.SSOOIDC=SSOOIDC;exports.SSOOIDCClient=SSOOIDCClient;Object.keys(schemas_0).forEach(function(k2){if(k2!=="default"&&!Object.prototype.hasOwnProperty.call(exports,k2))Object.defineProperty(exports,k2,{enumerable:!0,get:function(){return schemas_0[k2]}})});Object.keys(errors2).forEach(function(k2){if(k2!=="default"&&!Object.prototype.hasOwnProperty.call(exports,k2))Object.defineProperty(exports,k2,{enumerable:!0,get:function(){return errors2[k2]}})})});var getSsoOidcClient=async(ssoRegion,init={},callerClientConfig)=>{let{SSOOIDCClient}=await Promise.resolve().then(() => __toESM(require_sso_oidc(),1)),coalesce=(prop)=>init.clientConfig?.[prop]??init.parentClientConfig?.[prop]??callerClientConfig?.[prop];return new SSOOIDCClient(Object.assign({},init.clientConfig??{},{region:ssoRegion??init.clientConfig?.region,logger:coalesce("logger"),userAgentAppId:coalesce("userAgentAppId")}))};var getNewSsoOidcToken=async(ssoToken,ssoRegion,init={},callerClientConfig)=>{let{CreateTokenCommand}=await Promise.resolve().then(() => __toESM(require_sso_oidc(),1));return(await getSsoOidcClient(ssoRegion,init,callerClientConfig)).send(new CreateTokenCommand({clientId:ssoToken.clientId,clientSecret:ssoToken.clientSecret,refreshToken:ssoToken.refreshToken,grantType:"refresh_token"}))};var init_getNewSsoOidcToken=()=>{};var import_property_provider10,validateTokenExpiry=(token)=>{if(token.expiration&&token.expiration.getTime()<Date.now())throw new import_property_provider10.TokenProviderError(`Token is expired. ${REFRESH_MESSAGE}`,!1)};var init_validateTokenExpiry=__esm(()=>{import_property_provider10=__toESM(require_dist_cjs17(),1)});var import_property_provider11,validateTokenKey=(key,value,forRefresh=!1)=>{if(typeof value>"u")throw new import_property_provider11.TokenProviderError(`Value not present for '${key}' in SSO Token${forRefresh?". Cannot refresh":""}. ${REFRESH_MESSAGE}`,!1)};var init_validateTokenKey=__esm(()=>{import_property_provider11=__toESM(require_dist_cjs17(),1)});import{promises as fsPromises}from"fs";var import_shared_ini_file_loader,writeFile,writeSSOTokenToFile=(id,ssoToken)=>{let tokenFilepath=import_shared_ini_file_loader.getSSOTokenFilepath(id),tokenString=JSON.stringify(ssoToken,null,2);return writeFile(tokenFilepath,tokenString)};var init_writeSSOTokenToFile=__esm(()=>{import_shared_ini_file_loader=__toESM(require_dist_cjs35(),1),{writeFile}=fsPromises});var import_property_provider12,import_shared_ini_file_loader2,lastRefreshAttemptTime,fromSso=(init={})=>async({callerClientConfig}={})=>{init.logger?.debug("@aws-sdk/token-providers - fromSso");let profiles=await import_shared_ini_file_loader2.parseKnownFiles(init),profileName=import_shared_ini_file_loader2.getProfileName({profile:init.profile??callerClientConfig?.profile}),profile=profiles[profileName];if(!profile)throw new import_property_provider12.TokenProviderError(`Profile '${profileName}' could not be found in shared credentials file.`,!1);else if(!profile.sso_session)throw new import_property_provider12.TokenProviderError(`Profile '${profileName}' is missing required property 'sso_session'.`);let ssoSessionName=profile.sso_session,ssoSession=(await import_shared_ini_file_loader2.loadSsoSessionData(init))[ssoSessionName];if(!ssoSession)throw new import_property_provider12.TokenProviderError(`Sso session '${ssoSessionName}' could not be found in shared credentials file.`,!1);for(let ssoSessionRequiredKey of["sso_start_url","sso_region"])if(!ssoSession[ssoSessionRequiredKey])throw new import_property_provider12.TokenProviderError(`Sso session '${ssoSessionName}' is missing required property '${ssoSessionRequiredKey}'.`,!1);let{sso_start_url:ssoStartUrl,sso_region:ssoRegion}=ssoSession,ssoToken;try{ssoToken=await import_shared_ini_file_loader2.getSSOTokenFromFile(ssoSessionName)}catch(e){throw new import_property_provider12.TokenProviderError(`The SSO session token associated with profile=${profileName} was not found or is invalid. ${REFRESH_MESSAGE}`,!1)}validateTokenKey("accessToken",ssoToken.accessToken),validateTokenKey("expiresAt",ssoToken.expiresAt);let{accessToken,expiresAt}=ssoToken,existingToken={token:accessToken,expiration:new Date(expiresAt)};if(existingToken.expiration.getTime()-Date.now()>EXPIRE_WINDOW_MS)return existingToken;if(Date.now()-lastRefreshAttemptTime.getTime()<30000)return validateTokenExpiry(existingToken),existingToken;validateTokenKey("clientId",ssoToken.clientId,!0),validateTokenKey("clientSecret",ssoToken.clientSecret,!0),validateTokenKey("refreshToken",ssoToken.refreshToken,!0);try{lastRefreshAttemptTime.setTime(Date.now());let newSsoOidcToken=await getNewSsoOidcToken(ssoToken,ssoRegion,init,callerClientConfig);validateTokenKey("accessToken",newSsoOidcToken.accessToken),validateTokenKey("expiresIn",newSsoOidcToken.expiresIn);let newTokenExpiration=new Date(Date.now()+newSsoOidcToken.expiresIn*1000);try{await writeSSOTokenToFile(ssoSessionName,{...ssoToken,accessToken:newSsoOidcToken.accessToken,expiresAt:newTokenExpiration.toISOString(),refreshToken:newSsoOidcToken.refreshToken})}catch(error){}return{token:newSsoOidcToken.accessToken,expiration:newTokenExpiration}}catch(error){return validateTokenExpiry(existingToken),existingToken}};var init_fromSso=__esm(()=>{init_getNewSsoOidcToken();init_validateTokenExpiry();init_validateTokenKey();init_writeSSOTokenToFile();import_property_provider12=__toESM(require_dist_cjs17(),1),import_shared_ini_file_loader2=__toESM(require_dist_cjs35(),1),lastRefreshAttemptTime=new Date(0)});var init_fromStatic=()=>{};var init_nodeProvider=()=>{};var init_dist_es4=__esm(()=>{init_fromEnvSigningName();init_fromSso();init_fromStatic();init_nodeProvider()});function createAwsAuthSigv4HttpAuthOption2(authParameters){return{schemeId:"aws.auth#sigv4",signingProperties:{name:"awsssoportal",region:authParameters.region},propertiesExtractor:(config,context)=>({signingProperties:{config,context}})}}function createSmithyApiNoAuthHttpAuthOption(authParameters){return{schemeId:"smithy.api#noAuth"}}var import_core11,import_util_middleware4,defaultSSOHttpAuthSchemeParametersProvider=async(config,context,input)=>{return{operation:import_util_middleware4.getSmithyContext(context).operation,region:await import_util_middleware4.normalizeProvider(config.region)()||(()=>{throw Error("expected `region` to be configured for `aws.auth#sigv4`")})()}},defaultSSOHttpAuthSchemeProvider=(authParameters)=>{let options=[];switch(authParameters.operation){case"GetRoleCredentials":{options.push(createSmithyApiNoAuthHttpAuthOption(authParameters));break}case"ListAccountRoles":{options.push(createSmithyApiNoAuthHttpAuthOption(authParameters));break}case"ListAccounts":{options.push(createSmithyApiNoAuthHttpAuthOption(authParameters));break}case"Logout":{options.push(createSmithyApiNoAuthHttpAuthOption(authParameters));break}default:options.push(createAwsAuthSigv4HttpAuthOption2(authParameters))}return options},resolveHttpAuthSchemeConfig2=(config)=>{let config_0=import_core11.resolveAwsSdkSigV4Config(config);return Object.assign(config_0,{authSchemePreference:import_util_middleware4.normalizeProvider(config.authSchemePreference??[])})};var init_httpAuthSchemeProvider=__esm(()=>{import_core11=__toESM(require_dist_cjs23(),1),import_util_middleware4=__toESM(require_dist_cjs3(),1)});var resolveClientEndpointParameters2=(options)=>{return Object.assign(options,{useDualstackEndpoint:options.useDualstackEndpoint??!1,useFipsEndpoint:options.useFipsEndpoint??!1,defaultSigningName:"awsssoportal"})},commonParams2;var init_EndpointParameters=__esm(()=>{commonParams2={UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}}});var package_default2;var init_package=__esm(()=>{package_default2={name:"@aws-sdk/client-sso",description:"AWS SDK for JavaScript Sso Client for Node.js, Browser and React Native",version:"3.988.0",scripts:{build:"concurrently 'yarn:build:types' 'yarn:build:es' && yarn build:cjs","build:cjs":"node ../../scripts/compilation/inline client-sso","build:es":"tsc -p tsconfig.es.json","build:include:deps":'yarn g:turbo run build -F="$npm_package_name"',"build:types":"tsc -p tsconfig.types.json","build:types:downlevel":"downlevel-dts dist-types dist-types/ts3.4",clean:"premove dist-cjs dist-es dist-types tsconfig.cjs.tsbuildinfo tsconfig.es.tsbuildinfo tsconfig.types.tsbuildinfo","extract:docs":"api-extractor run --local","generate:client":"node ../../scripts/generate-clients/single-service --solo sso","test:index":"tsc --noEmit ./test/index-types.ts && node ./test/index-objects.spec.mjs"},main:"./dist-cjs/index.js",types:"./dist-types/index.d.ts",module:"./dist-es/index.js",sideEffects:!1,dependencies:{"@aws-crypto/sha256-browser":"5.2.0","@aws-crypto/sha256-js":"5.2.0","@aws-sdk/core":"^3.973.8","@aws-sdk/middleware-host-header":"^3.972.3","@aws-sdk/middleware-logger":"^3.972.3","@aws-sdk/middleware-recursion-detection":"^3.972.3","@aws-sdk/middleware-user-agent":"^3.972.8","@aws-sdk/region-config-resolver":"^3.972.3","@aws-sdk/types":"^3.973.1","@aws-sdk/util-endpoints":"3.988.0","@aws-sdk/util-user-agent-browser":"^3.972.3","@aws-sdk/util-user-agent-node":"^3.972.6","@smithy/config-resolver":"^4.4.6","@smithy/core":"^3.23.0","@smithy/fetch-http-handler":"^5.3.9","@smithy/hash-node":"^4.2.8","@smithy/invalid-dependency":"^4.2.8","@smithy/middleware-content-length":"^4.2.8","@smithy/middleware-endpoint":"^4.4.14","@smithy/middleware-retry":"^4.4.31","@smithy/middleware-serde":"^4.2.9","@smithy/middleware-stack":"^4.2.8","@smithy/node-config-provider":"^4.3.8","@smithy/node-http-handler":"^4.4.10","@smithy/protocol-http":"^5.3.8","@smithy/smithy-client":"^4.11.3","@smithy/types":"^4.12.0","@smithy/url-parser":"^4.2.8","@smithy/util-base64":"^4.3.0","@smithy/util-body-length-browser":"^4.2.0","@smithy/util-body-length-node":"^4.2.1","@smithy/util-defaults-mode-browser":"^4.3.30","@smithy/util-defaults-mode-node":"^4.2.33","@smithy/util-endpoints":"^3.2.8","@smithy/util-middleware":"^4.2.8","@smithy/util-retry":"^4.2.8","@smithy/util-utf8":"^4.2.0",tslib:"^2.6.2"},devDependencies:{"@tsconfig/node20":"20.1.8","@types/node":"^20.14.8",concurrently:"7.0.0","downlevel-dts":"0.10.1",premove:"4.0.0",typescript:"~5.8.3"},engines:{node:">=20.0.0"},typesVersions:{"<4.0":{"dist-types/*":["dist-types/ts3.4/*"]}},files:["dist-*/**"],author:{name:"AWS SDK for JavaScript Team",url:"https://aws.amazon.com/javascript/"},license:"Apache-2.0",browser:{"./dist-es/runtimeConfig":"./dist-es/runtimeConfig.browser"},"react-native":{"./dist-es/runtimeConfig":"./dist-es/runtimeConfig.native"},homepage:"https://github.com/aws/aws-sdk-js-v3/tree/main/clients/client-sso",repository:{type:"git",url:"https://github.com/aws/aws-sdk-js-v3.git",directory:"clients/client-sso"}}});var i,j,k2,l2,m2,n2,o,p,q,r2,s,t8,_data2,ruleSet2;var init_ruleset=__esm(()=>{i={["required"]:!1,type:"string"},j={["required"]:!0,default:!1,type:"boolean"},k2={["ref"]:"Endpoint"},l2={["fn"]:"booleanEquals",["argv"]:[{["ref"]:"UseFIPS"},!0]},m2={["fn"]:"booleanEquals",["argv"]:[{["ref"]:"UseDualStack"},!0]},n2={},o={["fn"]:"getAttr",["argv"]:[{["ref"]:"PartitionResult"},"supportsFIPS"]},p={["ref"]:"PartitionResult"},q={["fn"]:"booleanEquals",["argv"]:[!0,{["fn"]:"getAttr",["argv"]:[p,"supportsDualStack"]}]},r2=[l2],s=[m2],t8=[{["ref"]:"Region"}],_data2={version:"1.0",parameters:{Region:i,UseDualStack:j,UseFIPS:j,Endpoint:i},rules:[{conditions:[{["fn"]:"isSet",["argv"]:[k2]}],rules:[{conditions:r2,error:"Invalid Configuration: FIPS and custom endpoint are not supported",type:"error"},{conditions:s,error:"Invalid Configuration: Dualstack and custom endpoint are not supported",type:"error"},{endpoint:{url:k2,properties:n2,headers:n2},type:"endpoint"}],type:"tree"},{conditions:[{["fn"]:"isSet",["argv"]:t8}],rules:[{conditions:[{["fn"]:"aws.partition",["argv"]:t8,assign:"PartitionResult"}],rules:[{conditions:[l2,m2],rules:[{conditions:[{["fn"]:"booleanEquals",["argv"]:[!0,o]},q],rules:[{endpoint:{url:"https://portal.sso-fips.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:n2,headers:n2},type:"endpoint"}],type:"tree"},{error:"FIPS and DualStack are enabled, but this partition does not support one or both",type:"error"}],type:"tree"},{conditions:r2,rules:[{conditions:[{["fn"]:"booleanEquals",["argv"]:[o,!0]}],rules:[{conditions:[{["fn"]:"stringEquals",["argv"]:[{["fn"]:"getAttr",["argv"]:[p,"name"]},"aws-us-gov"]}],endpoint:{url:"https://portal.sso.{Region}.amazonaws.com",properties:n2,headers:n2},type:"endpoint"},{endpoint:{url:"https://portal.sso-fips.{Region}.{PartitionResult#dnsSuffix}",properties:n2,headers:n2},type:"endpoint"}],type:"tree"},{error:"FIPS is enabled but this partition does not support FIPS",type:"error"}],type:"tree"},{conditions:s,rules:[{conditions:[q],rules:[{endpoint:{url:"https://portal.sso.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:n2,headers:n2},type:"endpoint"}],type:"tree"},{error:"DualStack is enabled but this partition does not support DualStack",type:"error"}],type:"tree"},{endpoint:{url:"https://portal.sso.{Region}.{PartitionResult#dnsSuffix}",properties:n2,headers:n2},type:"endpoint"}],type:"tree"}],type:"tree"},{error:"Invalid Configuration: Missing Region",type:"error"}]},ruleSet2=_data2});var import_util_endpoints3,import_util_endpoints4,cache3,defaultEndpointResolver2=(endpointParams,context={})=>{return cache3.get(endpointParams,()=>import_util_endpoints4.resolveEndpoint(ruleSet2,{endpointParams,logger:context.logger}))};var init_endpointResolver=__esm(()=>{init_ruleset();import_util_endpoints3=__toESM(require_dist_cjs31(),1),import_util_endpoints4=__toESM(require_dist_cjs28(),1),cache3=new import_util_endpoints4.EndpointCache({size:50,params:["Endpoint","Region","UseDualStack","UseFIPS"]});import_util_endpoints4.customEndpointFunctions.aws=import_util_endpoints3.awsEndpointFunctions});var import_smithy_client6,SSOServiceException;var init_SSOServiceException=__esm(()=>{import_smithy_client6=__toESM(require_dist_cjs21(),1);SSOServiceException=class SSOServiceException extends import_smithy_client6.ServiceException{constructor(options){super(options);Object.setPrototypeOf(this,SSOServiceException.prototype)}}});var InvalidRequestException,ResourceNotFoundException,TooManyRequestsException,UnauthorizedException;var init_errors=__esm(()=>{init_SSOServiceException();InvalidRequestException=class InvalidRequestException extends SSOServiceException{name="InvalidRequestException";$fault="client";constructor(opts){super({name:"InvalidRequestException",$fault:"client",...opts});Object.setPrototypeOf(this,InvalidRequestException.prototype)}};ResourceNotFoundException=class ResourceNotFoundException extends SSOServiceException{name="ResourceNotFoundException";$fault="client";constructor(opts){super({name:"ResourceNotFoundException",$fault:"client",...opts});Object.setPrototypeOf(this,ResourceNotFoundException.prototype)}};TooManyRequestsException=class TooManyRequestsException extends SSOServiceException{name="TooManyRequestsException";$fault="client";constructor(opts){super({name:"TooManyRequestsException",$fault:"client",...opts});Object.setPrototypeOf(this,TooManyRequestsException.prototype)}};UnauthorizedException=class UnauthorizedException extends SSOServiceException{name="UnauthorizedException";$fault="client";constructor(opts){super({name:"UnauthorizedException",$fault:"client",...opts});Object.setPrototypeOf(this,UnauthorizedException.prototype)}}});var import_schema8,_s_registry2,SSOServiceException$,n0_registry2,InvalidRequestException$,ResourceNotFoundException$,TooManyRequestsException$,UnauthorizedException$,errorTypeRegistries2,AccessTokenType,SecretAccessKeyType,SessionTokenType,AccountInfo$,GetRoleCredentialsRequest$,GetRoleCredentialsResponse$,ListAccountRolesRequest$,ListAccountRolesResponse$,ListAccountsRequest$,ListAccountsResponse$,LogoutRequest$,RoleCredentials$,RoleInfo$,__Unit="unit",AccountListType,RoleListType,GetRoleCredentials$,ListAccountRoles$,ListAccounts$,Logout$;var init_schemas_0=__esm(()=>{init_errors();init_SSOServiceException();import_schema8=__toESM(require_schema(),1),_s_registry2=import_schema8.TypeRegistry.for("smithy.ts.sdk.synthetic.com.amazonaws.sso"),SSOServiceException$=[-3,"smithy.ts.sdk.synthetic.com.amazonaws.sso","SSOServiceException",0,[],[]];_s_registry2.registerError(SSOServiceException$,SSOServiceException);n0_registry2=import_schema8.TypeRegistry.for("com.amazonaws.sso"),InvalidRequestException$=[-3,"com.amazonaws.sso","InvalidRequestException",{["error"]:"client",["httpError"]:400},["message"],[0]];n0_registry2.registerError(InvalidRequestException$,InvalidRequestException);ResourceNotFoundException$=[-3,"com.amazonaws.sso","ResourceNotFoundException",{["error"]:"client",["httpError"]:404},["message"],[0]];n0_registry2.registerError(ResourceNotFoundException$,ResourceNotFoundException);TooManyRequestsException$=[-3,"com.amazonaws.sso","TooManyRequestsException",{["error"]:"client",["httpError"]:429},["message"],[0]];n0_registry2.registerError(TooManyRequestsException$,TooManyRequestsException);UnauthorizedException$=[-3,"com.amazonaws.sso","UnauthorizedException",{["error"]:"client",["httpError"]:401},["message"],[0]];n0_registry2.registerError(UnauthorizedException$,UnauthorizedException);errorTypeRegistries2=[_s_registry2,n0_registry2],AccessTokenType=[0,"com.amazonaws.sso","AccessTokenType",8,0],SecretAccessKeyType=[0,"com.amazonaws.sso","SecretAccessKeyType",8,0],SessionTokenType=[0,"com.amazonaws.sso","SessionTokenType",8,0],AccountInfo$=[3,"com.amazonaws.sso","AccountInfo",0,["accountId","accountName","emailAddress"],[0,0,0]],GetRoleCredentialsRequest$=[3,"com.amazonaws.sso","GetRoleCredentialsRequest",0,["roleName","accountId","accessToken"],[[0,{["httpQuery"]:"role_name"}],[0,{["httpQuery"]:"account_id"}],[()=>AccessTokenType,{["httpHeader"]:"x-amz-sso_bearer_token"}]],3],GetRoleCredentialsResponse$=[3,"com.amazonaws.sso","GetRoleCredentialsResponse",0,["roleCredentials"],[[()=>RoleCredentials$,0]]],ListAccountRolesRequest$=[3,"com.amazonaws.sso","ListAccountRolesRequest",0,["accessToken","accountId","nextToken","maxResults"],[[()=>AccessTokenType,{["httpHeader"]:"x-amz-sso_bearer_token"}],[0,{["httpQuery"]:"account_id"}],[0,{["httpQuery"]:"next_token"}],[1,{["httpQuery"]:"max_result"}]],2],ListAccountRolesResponse$=[3,"com.amazonaws.sso","ListAccountRolesResponse",0,["nextToken","roleList"],[0,()=>RoleListType]],ListAccountsRequest$=[3,"com.amazonaws.sso","ListAccountsRequest",0,["accessToken","nextToken","maxResults"],[[()=>AccessTokenType,{["httpHeader"]:"x-amz-sso_bearer_token"}],[0,{["httpQuery"]:"next_token"}],[1,{["httpQuery"]:"max_result"}]],1],ListAccountsResponse$=[3,"com.amazonaws.sso","ListAccountsResponse",0,["nextToken","accountList"],[0,()=>AccountListType]],LogoutRequest$=[3,"com.amazonaws.sso","LogoutRequest",0,["accessToken"],[[()=>AccessTokenType,{["httpHeader"]:"x-amz-sso_bearer_token"}]],1],RoleCredentials$=[3,"com.amazonaws.sso","RoleCredentials",0,["accessKeyId","secretAccessKey","sessionToken","expiration"],[0,[()=>SecretAccessKeyType,0],[()=>SessionTokenType,0],1]],RoleInfo$=[3,"com.amazonaws.sso","RoleInfo",0,["roleName","accountId"],[0,0]],AccountListType=[1,"com.amazonaws.sso","AccountListType",0,()=>AccountInfo$],RoleListType=[1,"com.amazonaws.sso","RoleListType",0,()=>RoleInfo$],GetRoleCredentials$=[9,"com.amazonaws.sso","GetRoleCredentials",{["http"]:["GET","/federation/credentials",200]},()=>GetRoleCredentialsRequest$,()=>GetRoleCredentialsResponse$],ListAccountRoles$=[9,"com.amazonaws.sso","ListAccountRoles",{["http"]:["GET","/assignment/roles",200]},()=>ListAccountRolesRequest$,()=>ListAccountRolesResponse$],ListAccounts$=[9,"com.amazonaws.sso","ListAccounts",{["http"]:["GET","/assignment/accounts",200]},()=>ListAccountsRequest$,()=>ListAccountsResponse$],Logout$=[9,"com.amazonaws.sso","Logout",{["http"]:["POST","/logout",200]},()=>LogoutRequest$,()=>__Unit]});var import_core12,import_protocols,import_core13,import_smithy_client7,import_url_parser2,import_util_base64,import_util_utf83,getRuntimeConfig=(config)=>{return{apiVersion:"2019-06-10",base64Decoder:config?.base64Decoder??import_util_base64.fromBase64,base64Encoder:config?.base64Encoder??import_util_base64.toBase64,disableHostPrefix:config?.disableHostPrefix??!1,endpointProvider:config?.endpointProvider??defaultEndpointResolver2,extensions:config?.extensions??[],httpAuthSchemeProvider:config?.httpAuthSchemeProvider??defaultSSOHttpAuthSchemeProvider,httpAuthSchemes:config?.httpAuthSchemes??[{schemeId:"aws.auth#sigv4",identityProvider:(ipc)=>ipc.getIdentityProvider("aws.auth#sigv4"),signer:new import_core12.AwsSdkSigV4Signer},{schemeId:"smithy.api#noAuth",identityProvider:(ipc)=>ipc.getIdentityProvider("smithy.api#noAuth")||(async()=>({})),signer:new import_core13.NoAuthSigner}],logger:config?.logger??new import_smithy_client7.NoOpLogger,protocol:config?.protocol??import_protocols.AwsRestJsonProtocol,protocolSettings:config?.protocolSettings??{defaultNamespace:"com.amazonaws.sso",errorTypeRegistries:errorTypeRegistries2,version:"2019-06-10",serviceTarget:"SWBPortalService"},serviceId:config?.serviceId??"SSO",urlParser:config?.urlParser??import_url_parser2.parseUrl,utf8Decoder:config?.utf8Decoder??import_util_utf83.fromUtf8,utf8Encoder:config?.utf8Encoder??import_util_utf83.toUtf8}};var init_runtimeConfig_shared=__esm(()=>{init_httpAuthSchemeProvider();init_endpointResolver();init_schemas_0();import_core12=__toESM(require_dist_cjs23(),1),import_protocols=__toESM(require_protocols2(),1),import_core13=__toESM(require_dist_cjs16(),1),import_smithy_client7=__toESM(require_dist_cjs21(),1),import_url_parser2=__toESM(require_dist_cjs30(),1),import_util_base64=__toESM(require_dist_cjs8(),1),import_util_utf83=__toESM(require_dist_cjs7(),1)});var import_core14,import_util_user_agent_node,import_config_resolver,import_hash_node,import_middleware_retry,import_node_config_provider3,import_node_http_handler2,import_smithy_client8,import_util_body_length_node,import_util_defaults_mode_node,import_util_retry,getRuntimeConfig2=(config)=>{import_smithy_client8.emitWarningIfUnsupportedVersion(process.version);let defaultsMode=import_util_defaults_mode_node.resolveDefaultsModeConfig(config),defaultConfigProvider=()=>defaultsMode().then(import_smithy_client8.loadConfigsForDefaultMode),clientSharedValues=getRuntimeConfig(config);import_core14.emitWarningIfUnsupportedVersion(process.version);let loaderConfig={profile:config?.profile,logger:clientSharedValues.logger};return{...clientSharedValues,...config,runtime:"node",defaultsMode,authSchemePreference:config?.authSchemePreference??import_node_config_provider3.loadConfig(import_core14.NODE_AUTH_SCHEME_PREFERENCE_OPTIONS,loaderConfig),bodyLengthChecker:config?.bodyLengthChecker??import_util_body_length_node.calculateBodyLength,defaultUserAgentProvider:config?.defaultUserAgentProvider??import_util_user_agent_node.createDefaultUserAgentProvider({serviceId:clientSharedValues.serviceId,clientVersion:package_default2.version}),maxAttempts:config?.maxAttempts??import_node_config_provider3.loadConfig(import_middleware_retry.NODE_MAX_ATTEMPT_CONFIG_OPTIONS,config),region:config?.region??import_node_config_provider3.loadConfig(import_config_resolver.NODE_REGION_CONFIG_OPTIONS,{...import_config_resolver.NODE_REGION_CONFIG_FILE_OPTIONS,...loaderConfig}),requestHandler:import_node_http_handler2.NodeHttpHandler.create(config?.requestHandler??defaultConfigProvider),retryMode:config?.retryMode??import_node_config_provider3.loadConfig({...import_middleware_retry.NODE_RETRY_MODE_CONFIG_OPTIONS,default:async()=>(await defaultConfigProvider()).retryMode||import_util_retry.DEFAULT_RETRY_MODE},config),sha256:config?.sha256??import_hash_node.Hash.bind(null,"sha256"),streamCollector:config?.streamCollector??import_node_http_handler2.streamCollector,useDualstackEndpoint:config?.useDualstackEndpoint??import_node_config_provider3.loadConfig(import_config_resolver.NODE_USE_DUALSTACK_ENDPOINT_CONFIG_OPTIONS,loaderConfig),useFipsEndpoint:config?.useFipsEndpoint??import_node_config_provider3.loadConfig(import_config_resolver.NODE_USE_FIPS_ENDPOINT_CONFIG_OPTIONS,loaderConfig),userAgentAppId:config?.userAgentAppId??import_node_config_provider3.loadConfig(import_util_user_agent_node.NODE_APP_ID_CONFIG_OPTIONS,loaderConfig)}};var init_runtimeConfig=__esm(()=>{init_package();init_runtimeConfig_shared();import_core14=__toESM(require_dist_cjs23(),1),import_util_user_agent_node=__toESM(require_dist_cjs41(),1),import_config_resolver=__toESM(require_dist_cjs33(),1),import_hash_node=__toESM(require_dist_cjs42(),1),import_middleware_retry=__toESM(require_dist_cjs40(),1),import_node_config_provider3=__toESM(require_dist_cjs36(),1),import_node_http_handler2=__toESM(require_dist_cjs11(),1),import_smithy_client8=__toESM(require_dist_cjs21(),1),import_util_body_length_node=__toESM(require_dist_cjs43(),1),import_util_defaults_mode_node=__toESM(require_dist_cjs44(),1),import_util_retry=__toESM(require_dist_cjs39(),1)});var getHttpAuthExtensionConfiguration=(runtimeConfig)=>{let{httpAuthSchemes:_httpAuthSchemes,httpAuthSchemeProvider:_httpAuthSchemeProvider,credentials:_credentials}=runtimeConfig;return{setHttpAuthScheme(httpAuthScheme){let index2=_httpAuthSchemes.findIndex((scheme)=>scheme.schemeId===httpAuthScheme.schemeId);if(index2===-1)_httpAuthSchemes.push(httpAuthScheme);else _httpAuthSchemes.splice(index2,1,httpAuthScheme)},httpAuthSchemes(){return _httpAuthSchemes},setHttpAuthSchemeProvider(httpAuthSchemeProvider){_httpAuthSchemeProvider=httpAuthSchemeProvider},httpAuthSchemeProvider(){return _httpAuthSchemeProvider},setCredentials(credentials){_credentials=credentials},credentials(){return _credentials}}},resolveHttpAuthRuntimeConfig=(config)=>{return{httpAuthSchemes:config.httpAuthSchemes(),httpAuthSchemeProvider:config.httpAuthSchemeProvider(),credentials:config.credentials()}};var import_region_config_resolver,import_protocol_http10,import_smithy_client9,resolveRuntimeExtensions=(runtimeConfig,extensions2)=>{let extensionConfiguration=Object.assign(import_region_config_resolver.getAwsRegionExtensionConfiguration(runtimeConfig),import_smithy_client9.getDefaultExtensionConfiguration(runtimeConfig),import_protocol_http10.getHttpHandlerExtensionConfiguration(runtimeConfig),getHttpAuthExtensionConfiguration(runtimeConfig));return extensions2.forEach((extension)=>extension.configure(extensionConfiguration)),Object.assign(runtimeConfig,import_region_config_resolver.resolveAwsRegionExtensionConfiguration(extensionConfiguration),import_smithy_client9.resolveDefaultRuntimeConfig(extensionConfiguration),import_protocol_http10.resolveHttpHandlerRuntimeConfig(extensionConfiguration),resolveHttpAuthRuntimeConfig(extensionConfiguration))};var init_runtimeExtensions=__esm(()=>{import_region_config_resolver=__toESM(require_dist_cjs45(),1),import_protocol_http10=__toESM(require_dist_cjs2(),1),import_smithy_client9=__toESM(require_dist_cjs21(),1)});var import_middleware_host_header,import_middleware_logger,import_middleware_recursion_detection,import_middleware_user_agent,import_config_resolver2,import_core15,import_schema9,import_middleware_content_length,import_middleware_endpoint3,import_middleware_retry2,import_smithy_client10,SSOClient;var init_SSOClient=__esm(()=>{init_httpAuthSchemeProvider();init_EndpointParameters();init_runtimeConfig();init_runtimeExtensions();import_middleware_host_header=__toESM(require_dist_cjs24(),1),import_middleware_logger=__toESM(require_dist_cjs25(),1),import_middleware_recursion_detection=__toESM(require_dist_cjs26(),1),import_middleware_user_agent=__toESM(require_dist_cjs32(),1),import_config_resolver2=__toESM(require_dist_cjs33(),1),import_core15=__toESM(require_dist_cjs16(),1),import_schema9=__toESM(require_schema(),1),import_middleware_content_length=__toESM(require_dist_cjs34(),1),import_middleware_endpoint3=__toESM(require_dist_cjs37(),1),import_middleware_retry2=__toESM(require_dist_cjs40(),1),import_smithy_client10=__toESM(require_dist_cjs21(),1);SSOClient=class SSOClient extends import_smithy_client10.Client{config;constructor(...[configuration]){let _config_0=getRuntimeConfig2(configuration||{});super(_config_0);this.initConfig=_config_0;let _config_1=resolveClientEndpointParameters2(_config_0),_config_2=import_middleware_user_agent.resolveUserAgentConfig(_config_1),_config_3=import_middleware_retry2.resolveRetryConfig(_config_2),_config_4=import_config_resolver2.resolveRegionConfig(_config_3),_config_5=import_middleware_host_header.resolveHostHeaderConfig(_config_4),_config_6=import_middleware_endpoint3.resolveEndpointConfig(_config_5),_config_7=resolveHttpAuthSchemeConfig2(_config_6),_config_8=resolveRuntimeExtensions(_config_7,configuration?.extensions||[]);this.config=_config_8,this.middlewareStack.use(import_schema9.getSchemaSerdePlugin(this.config)),this.middlewareStack.use(import_middleware_user_agent.getUserAgentPlugin(this.config)),this.middlewareStack.use(import_middleware_retry2.getRetryPlugin(this.config)),this.middlewareStack.use(import_middleware_content_length.getContentLengthPlugin(this.config)),this.middlewareStack.use(import_middleware_host_header.getHostHeaderPlugin(this.config)),this.middlewareStack.use(import_middleware_logger.getLoggerPlugin(this.config)),this.middlewareStack.use(import_middleware_recursion_detection.getRecursionDetectionPlugin(this.config)),this.middlewareStack.use(import_core15.getHttpAuthSchemeEndpointRuleSetPlugin(this.config,{httpAuthSchemeParametersProvider:defaultSSOHttpAuthSchemeParametersProvider,identityProviderConfigProvider:async(config)=>new import_core15.DefaultIdentityProviderConfig({"aws.auth#sigv4":config.credentials})})),this.middlewareStack.use(import_core15.getHttpSigningPlugin(this.config))}destroy(){super.destroy()}}});var import_middleware_endpoint4,import_smithy_client11,GetRoleCredentialsCommand;var init_GetRoleCredentialsCommand=__esm(()=>{init_EndpointParameters();init_schemas_0();import_middleware_endpoint4=__toESM(require_dist_cjs37(),1),import_smithy_client11=__toESM(require_dist_cjs21(),1);GetRoleCredentialsCommand=class GetRoleCredentialsCommand extends import_smithy_client11.Command.classBuilder().ep(commonParams2).m(function(Command,cs,config,o2){return[import_middleware_endpoint4.getEndpointPlugin(config,Command.getEndpointParameterInstructions())]}).s("SWBPortalService","GetRoleCredentials",{}).n("SSOClient","GetRoleCredentialsCommand").sc(GetRoleCredentials$).build(){}});var import_middleware_endpoint5,import_smithy_client12,ListAccountRolesCommand;var init_ListAccountRolesCommand=__esm(()=>{init_EndpointParameters();init_schemas_0();import_middleware_endpoint5=__toESM(require_dist_cjs37(),1),import_smithy_client12=__toESM(require_dist_cjs21(),1);ListAccountRolesCommand=class ListAccountRolesCommand extends import_smithy_client12.Command.classBuilder().ep(commonParams2).m(function(Command,cs,config,o2){return[import_middleware_endpoint5.getEndpointPlugin(config,Command.getEndpointParameterInstructions())]}).s("SWBPortalService","ListAccountRoles",{}).n("SSOClient","ListAccountRolesCommand").sc(ListAccountRoles$).build(){}});var import_middleware_endpoint6,import_smithy_client13,ListAccountsCommand;var init_ListAccountsCommand=__esm(()=>{init_EndpointParameters();init_schemas_0();import_middleware_endpoint6=__toESM(require_dist_cjs37(),1),import_smithy_client13=__toESM(require_dist_cjs21(),1);ListAccountsCommand=class ListAccountsCommand extends import_smithy_client13.Command.classBuilder().ep(commonParams2).m(function(Command,cs,config,o2){return[import_middleware_endpoint6.getEndpointPlugin(config,Command.getEndpointParameterInstructions())]}).s("SWBPortalService","ListAccounts",{}).n("SSOClient","ListAccountsCommand").sc(ListAccounts$).build(){}});var import_middleware_endpoint7,import_smithy_client14,LogoutCommand;var init_LogoutCommand=__esm(()=>{init_EndpointParameters();init_schemas_0();import_middleware_endpoint7=__toESM(require_dist_cjs37(),1),import_smithy_client14=__toESM(require_dist_cjs21(),1);LogoutCommand=class LogoutCommand extends import_smithy_client14.Command.classBuilder().ep(commonParams2).m(function(Command,cs,config,o2){return[import_middleware_endpoint7.getEndpointPlugin(config,Command.getEndpointParameterInstructions())]}).s("SWBPortalService","Logout",{}).n("SSOClient","LogoutCommand").sc(Logout$).build(){}});var import_core16,paginateListAccountRoles;var init_ListAccountRolesPaginator=__esm(()=>{init_ListAccountRolesCommand();init_SSOClient();import_core16=__toESM(require_dist_cjs16(),1),paginateListAccountRoles=import_core16.createPaginator(SSOClient,ListAccountRolesCommand,"nextToken","nextToken","maxResults")});var import_core17,paginateListAccounts;var init_ListAccountsPaginator=__esm(()=>{init_ListAccountsCommand();init_SSOClient();import_core17=__toESM(require_dist_cjs16(),1),paginateListAccounts=import_core17.createPaginator(SSOClient,ListAccountsCommand,"nextToken","nextToken","maxResults")});var import_smithy_client15,commands,paginators,SSO;var init_SSO=__esm(()=>{init_GetRoleCredentialsCommand();init_ListAccountRolesCommand();init_ListAccountsCommand();init_LogoutCommand();init_ListAccountRolesPaginator();init_ListAccountsPaginator();init_SSOClient();import_smithy_client15=__toESM(require_dist_cjs21(),1),commands={GetRoleCredentialsCommand,ListAccountRolesCommand,ListAccountsCommand,LogoutCommand},paginators={paginateListAccountRoles,paginateListAccounts};SSO=class SSO extends SSOClient{};import_smithy_client15.createAggregatedClient(commands,SSO,{paginators})});var init_commands=__esm(()=>{init_GetRoleCredentialsCommand();init_ListAccountRolesCommand();init_ListAccountsCommand();init_LogoutCommand()});var init_Interfaces=()=>{};var init_pagination=__esm(()=>{init_Interfaces();init_ListAccountRolesPaginator();init_ListAccountsPaginator()});var init_models_0=()=>{};var init_dist_es5=__esm(()=>{init_SSOClient();init_SSO();init_commands();init_schemas_0();init_pagination();init_errors();init_models_0()});var exports_loadSso={};__export(exports_loadSso,{SSOClient:()=>SSOClient,GetRoleCredentialsCommand:()=>GetRoleCredentialsCommand});var init_loadSso=__esm(()=>{init_dist_es5()});var import_client3,import_property_provider13,import_shared_ini_file_loader3,SHOULD_FAIL_CREDENTIAL_CHAIN=!1,resolveSSOCredentials=async({ssoStartUrl,ssoSession,ssoAccountId,ssoRegion,ssoRoleName,ssoClient,clientConfig,parentClientConfig,callerClientConfig,profile,filepath,configFilepath,ignoreCache,logger})=>{let token,refreshMessage="To refresh this SSO session run aws sso login with the corresponding profile.";if(ssoSession)try{let _token=await fromSso({profile,filepath,configFilepath,ignoreCache})();token={accessToken:_token.token,expiresAt:new Date(_token.expiration).toISOString()}}catch(e){throw new import_property_provider13.CredentialsProviderError(e.message,{tryNextLink:SHOULD_FAIL_CREDENTIAL_CHAIN,logger})}else try{token=await import_shared_ini_file_loader3.getSSOTokenFromFile(ssoStartUrl)}catch(e){throw new import_property_provider13.CredentialsProviderError("The SSO session associated with this profile is invalid. To refresh this SSO session run aws sso login with the corresponding profile.",{tryNextLink:SHOULD_FAIL_CREDENTIAL_CHAIN,logger})}if(new Date(token.expiresAt).getTime()-Date.now()<=0)throw new import_property_provider13.CredentialsProviderError("The SSO session associated with this profile has expired. To refresh this SSO session run aws sso login with the corresponding profile.",{tryNextLink:SHOULD_FAIL_CREDENTIAL_CHAIN,logger});let{accessToken}=token,{SSOClient:SSOClient3,GetRoleCredentialsCommand:GetRoleCredentialsCommand3}=await Promise.resolve().then(() => (init_loadSso(),exports_loadSso)),sso=ssoClient||new SSOClient3(Object.assign({},clientConfig??{},{logger:clientConfig?.logger??callerClientConfig?.logger??parentClientConfig?.logger,region:clientConfig?.region??ssoRegion,userAgentAppId:clientConfig?.userAgentAppId??callerClientConfig?.userAgentAppId??parentClientConfig?.userAgentAppId})),ssoResp;try{ssoResp=await sso.send(new GetRoleCredentialsCommand3({accountId:ssoAccountId,roleName:ssoRoleName,accessToken}))}catch(e){throw new import_property_provider13.CredentialsProviderError(e,{tryNextLink:SHOULD_FAIL_CREDENTIAL_CHAIN,logger})}let{roleCredentials:{accessKeyId,secretAccessKey,sessionToken,expiration,credentialScope,accountId}={}}=ssoResp;if(!accessKeyId||!secretAccessKey||!sessionToken||!expiration)throw new import_property_provider13.CredentialsProviderError("SSO returns an invalid temporary credential.",{tryNextLink:SHOULD_FAIL_CREDENTIAL_CHAIN,logger});let credentials={accessKeyId,secretAccessKey,sessionToken,expiration:new Date(expiration),...credentialScope&&{credentialScope},...accountId&&{accountId}};if(ssoSession)import_client3.setCredentialFeature(credentials,"CREDENTIALS_SSO","s");else import_client3.setCredentialFeature(credentials,"CREDENTIALS_SSO_LEGACY","u");return credentials};var init_resolveSSOCredentials=__esm(()=>{init_dist_es4();import_client3=__toESM(require_client(),1),import_property_provider13=__toESM(require_dist_cjs17(),1),import_shared_ini_file_loader3=__toESM(require_dist_cjs35(),1)});var import_property_provider14,validateSsoProfile=(profile,logger)=>{let{sso_start_url,sso_account_id,sso_region,sso_role_name}=profile;if(!sso_start_url||!sso_account_id||!sso_region||!sso_role_name)throw new import_property_provider14.CredentialsProviderError(`Profile is configured with invalid SSO credentials. Required parameters "sso_account_id", "sso_region", "sso_role_name", "sso_start_url". Got ${Object.keys(profile).join(", ")}
Reference: https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-sso.html`,{tryNextLink:!1,logger});return profile};var init_validateSsoProfile=__esm(()=>{import_property_provider14=__toESM(require_dist_cjs17(),1)});var import_property_provider15,import_shared_ini_file_loader4,fromSSO=(init={})=>async({callerClientConfig}={})=>{init.logger?.debug("@aws-sdk/credential-provider-sso - fromSSO");let{ssoStartUrl,ssoAccountId,ssoRegion,ssoRoleName,ssoSession}=init,{ssoClient}=init,profileName=import_shared_ini_file_loader4.getProfileName({profile:init.profile??callerClientConfig?.profile});if(!ssoStartUrl&&!ssoAccountId&&!ssoRegion&&!ssoRoleName&&!ssoSession){let profile=(await import_shared_ini_file_loader4.parseKnownFiles(init))[profileName];if(!profile)throw new import_property_provider15.CredentialsProviderError(`Profile ${profileName} was not found.`,{logger:init.logger});if(!isSsoProfile(profile))throw new import_property_provider15.CredentialsProviderError(`Profile ${profileName} is not configured with SSO credentials.`,{logger:init.logger});if(profile?.sso_session){let session=(await import_shared_ini_file_loader4.loadSsoSessionData(init))[profile.sso_session],conflictMsg=` configurations in profile ${profileName} and sso-session ${profile.sso_session}`;if(ssoRegion&&ssoRegion!==session.sso_region)throw new import_property_provider15.CredentialsProviderError("Conflicting SSO region"+conflictMsg,{tryNextLink:!1,logger:init.logger});if(ssoStartUrl&&ssoStartUrl!==session.sso_start_url)throw new import_property_provider15.CredentialsProviderError("Conflicting SSO start_url"+conflictMsg,{tryNextLink:!1,logger:init.logger});profile.sso_region=session.sso_region,profile.sso_start_url=session.sso_start_url}let{sso_start_url,sso_account_id,sso_region,sso_role_name,sso_session}=validateSsoProfile(profile,init.logger);return resolveSSOCredentials({ssoStartUrl:sso_start_url,ssoSession:sso_session,ssoAccountId:sso_account_id,ssoRegion:sso_region,ssoRoleName:sso_role_name,ssoClient,clientConfig:init.clientConfig,parentClientConfig:init.parentClientConfig,callerClientConfig:init.callerClientConfig,profile:profileName,filepath:init.filepath,configFilepath:init.configFilepath,ignoreCache:init.ignoreCache,logger:init.logger})}else if(!ssoStartUrl||!ssoAccountId||!ssoRegion||!ssoRoleName)throw new import_property_provider15.CredentialsProviderError('Incomplete configuration. The fromSSO() argument hash must include "ssoStartUrl", "ssoAccountId", "ssoRegion", "ssoRoleName"',{tryNextLink:!1,logger:init.logger});else return resolveSSOCredentials({ssoStartUrl,ssoSession,ssoAccountId,ssoRegion,ssoRoleName,ssoClient,clientConfig:init.clientConfig,parentClientConfig:init.parentClientConfig,callerClientConfig:init.callerClientConfig,profile:profileName,filepath:init.filepath,configFilepath:init.configFilepath,ignoreCache:init.ignoreCache,logger:init.logger})};var init_fromSSO=__esm(()=>{init_resolveSSOCredentials();init_validateSsoProfile();import_property_provider15=__toESM(require_dist_cjs17(),1),import_shared_ini_file_loader4=__toESM(require_dist_cjs35(),1)});var init_types2=()=>{};var exports_dist_es4={};__export(exports_dist_es4,{validateSsoProfile:()=>validateSsoProfile,isSsoProfile:()=>isSsoProfile,fromSSO:()=>fromSSO});var init_dist_es6=__esm(()=>{init_fromSSO();init_types2();init_validateSsoProfile()});var import_client4,import_property_provider16,resolveCredentialSource=(credentialSource,profileName,logger)=>{let sourceProvidersMap={EcsContainer:async(options)=>{let{fromHttp:fromHttp2}=await Promise.resolve().then(() => (init_dist_es3(),exports_dist_es3)),{fromContainerMetadata:fromContainerMetadata3}=await Promise.resolve().then(() => (init_dist_es2(),exports_dist_es2));return logger?.debug("@aws-sdk/credential-provider-ini - credential_source is EcsContainer"),async()=>import_property_provider16.chain(fromHttp2(options??{}),fromContainerMetadata3(options))().then(setNamedProvider)},Ec2InstanceMetadata:async(options)=>{logger?.debug("@aws-sdk/credential-provider-ini - credential_source is Ec2InstanceMetadata");let{fromInstanceMetadata:fromInstanceMetadata3}=await Promise.resolve().then(() => (init_dist_es2(),exports_dist_es2));return async()=>fromInstanceMetadata3(options)().then(setNamedProvider)},Environment:async(options)=>{logger?.debug("@aws-sdk/credential-provider-ini - credential_source is Environment");let{fromEnv:fromEnv3}=await Promise.resolve().then(() => (init_dist_es(),exports_dist_es));return async()=>fromEnv3(options)().then(setNamedProvider)}};if(credentialSource in sourceProvidersMap)return sourceProvidersMap[credentialSource];else throw new import_property_provider16.CredentialsProviderError(`Unsupported credential source in profile ${profileName}. Got ${credentialSource}, expected EcsContainer or Ec2InstanceMetadata or Environment.`,{logger})},setNamedProvider=(creds)=>import_client4.setCredentialFeature(creds,"CREDENTIALS_PROFILE_NAMED_PROVIDER","p");var init_resolveCredentialSource=__esm(()=>{import_client4=__toESM(require_client(),1),import_property_provider16=__toESM(require_dist_cjs17(),1)});var require_httpAuthSchemeProvider2=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.resolveHttpAuthSchemeConfig=exports.resolveStsAuthConfig=exports.defaultSTSHttpAuthSchemeProvider=exports.defaultSTSHttpAuthSchemeParametersProvider=void 0;var core_1=require_dist_cjs23(),util_middleware_1=require_dist_cjs3(),STSClient_1=require_STSClient(),defaultSTSHttpAuthSchemeParametersProvider=async(config,context,input)=>{return{operation:(0,util_middleware_1.getSmithyContext)(context).operation,region:await(0,util_middleware_1.normalizeProvider)(config.region)()||(()=>{throw Error("expected `region` to be configured for `aws.auth#sigv4`")})()}};exports.defaultSTSHttpAuthSchemeParametersProvider=defaultSTSHttpAuthSchemeParametersProvider;function createAwsAuthSigv4HttpAuthOption3(authParameters){return{schemeId:"aws.auth#sigv4",signingProperties:{name:"sts",region:authParameters.region},propertiesExtractor:(config,context)=>({signingProperties:{config,context}})}}function createSmithyApiNoAuthHttpAuthOption2(authParameters){return{schemeId:"smithy.api#noAuth"}}var defaultSTSHttpAuthSchemeProvider=(authParameters)=>{let options=[];switch(authParameters.operation){case"AssumeRoleWithWebIdentity":{options.push(createSmithyApiNoAuthHttpAuthOption2(authParameters));break}default:options.push(createAwsAuthSigv4HttpAuthOption3(authParameters))}return options};exports.defaultSTSHttpAuthSchemeProvider=defaultSTSHttpAuthSchemeProvider;var resolveStsAuthConfig=(input)=>Object.assign(input,{stsClientCtor:STSClient_1.STSClient});exports.resolveStsAuthConfig=resolveStsAuthConfig;var resolveHttpAuthSchemeConfig3=(config)=>{let config_0=exports.resolveStsAuthConfig(config),config_1=(0,core_1.resolveAwsSdkSigV4Config)(config_0);return Object.assign(config_1,{authSchemePreference:(0,util_middleware_1.normalizeProvider)(config.authSchemePreference??[])})};exports.resolveHttpAuthSchemeConfig=resolveHttpAuthSchemeConfig3});var require_EndpointParameters=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.commonParams=exports.resolveClientEndpointParameters=void 0;var resolveClientEndpointParameters3=(options)=>{return Object.assign(options,{useDualstackEndpoint:options.useDualstackEndpoint??!1,useFipsEndpoint:options.useFipsEndpoint??!1,useGlobalEndpoint:options.useGlobalEndpoint??!1,defaultSigningName:"sts"})};exports.resolveClientEndpointParameters=resolveClientEndpointParameters3;exports.commonParams={UseGlobalEndpoint:{type:"builtInParams",name:"useGlobalEndpoint"},UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}}});var require_ruleset2=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.ruleSet=void 0;var F="required",G="type",H="fn",I="argv",J="ref",a12=!1,b2=!0,c="booleanEquals",d="stringEquals",e="sigv4",f="sts",g="us-east-1",h="endpoint",i2="https://sts.{Region}.{PartitionResult#dnsSuffix}",j2="tree",k3="error",l3="getAttr",m3={[F]:!1,[G]:"string"},n3={[F]:!0,default:!1,[G]:"boolean"},o2={[J]:"Endpoint"},p2={[H]:"isSet",[I]:[{[J]:"Region"}]},q2={[J]:"Region"},r3={[H]:"aws.partition",[I]:[q2],assign:"PartitionResult"},s2={[J]:"UseFIPS"},t9={[J]:"UseDualStack"},u={url:"https://sts.amazonaws.com",properties:{authSchemes:[{name:e,signingName:f,signingRegion:g}]},headers:{}},v={},w={conditions:[{[H]:d,[I]:[q2,"aws-global"]}],[h]:u,[G]:h},x={[H]:c,[I]:[s2,!0]},y={[H]:c,[I]:[t9,!0]},z={[H]:l3,[I]:[{[J]:"PartitionResult"},"supportsFIPS"]},A={[J]:"PartitionResult"},B={[H]:c,[I]:[!0,{[H]:l3,[I]:[A,"supportsDualStack"]}]},C=[{[H]:"isSet",[I]:[o2]}],D=[x],E=[y],_data3={version:"1.0",parameters:{Region:m3,UseDualStack:n3,UseFIPS:n3,Endpoint:m3,UseGlobalEndpoint:n3},rules:[{conditions:[{[H]:c,[I]:[{[J]:"UseGlobalEndpoint"},b2]},{[H]:"not",[I]:C},p2,r3,{[H]:c,[I]:[s2,a12]},{[H]:c,[I]:[t9,a12]}],rules:[{conditions:[{[H]:d,[I]:[q2,"ap-northeast-1"]}],endpoint:u,[G]:h},{conditions:[{[H]:d,[I]:[q2,"ap-south-1"]}],endpoint:u,[G]:h},{conditions:[{[H]:d,[I]:[q2,"ap-southeast-1"]}],endpoint:u,[G]:h},{conditions:[{[H]:d,[I]:[q2,"ap-southeast-2"]}],endpoint:u,[G]:h},w,{conditions:[{[H]:d,[I]:[q2,"ca-central-1"]}],endpoint:u,[G]:h},{conditions:[{[H]:d,[I]:[q2,"eu-central-1"]}],endpoint:u,[G]:h},{conditions:[{[H]:d,[I]:[q2,"eu-north-1"]}],endpoint:u,[G]:h},{conditions:[{[H]:d,[I]:[q2,"eu-west-1"]}],endpoint:u,[G]:h},{conditions:[{[H]:d,[I]:[q2,"eu-west-2"]}],endpoint:u,[G]:h},{conditions:[{[H]:d,[I]:[q2,"eu-west-3"]}],endpoint:u,[G]:h},{conditions:[{[H]:d,[I]:[q2,"sa-east-1"]}],endpoint:u,[G]:h},{conditions:[{[H]:d,[I]:[q2,g]}],endpoint:u,[G]:h},{conditions:[{[H]:d,[I]:[q2,"us-east-2"]}],endpoint:u,[G]:h},{conditions:[{[H]:d,[I]:[q2,"us-west-1"]}],endpoint:u,[G]:h},{conditions:[{[H]:d,[I]:[q2,"us-west-2"]}],endpoint:u,[G]:h},{endpoint:{url:i2,properties:{authSchemes:[{name:e,signingName:f,signingRegion:"{Region}"}]},headers:v},[G]:h}],[G]:j2},{conditions:C,rules:[{conditions:D,error:"Invalid Configuration: FIPS and custom endpoint are not supported",[G]:k3},{conditions:E,error:"Invalid Configuration: Dualstack and custom endpoint are not supported",[G]:k3},{endpoint:{url:o2,properties:v,headers:v},[G]:h}],[G]:j2},{conditions:[p2],rules:[{conditions:[r3],rules:[{conditions:[x,y],rules:[{conditions:[{[H]:c,[I]:[b2,z]},B],rules:[{endpoint:{url:"https://sts-fips.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:v,headers:v},[G]:h}],[G]:j2},{error:"FIPS and DualStack are enabled, but this partition does not support one or both",[G]:k3}],[G]:j2},{conditions:D,rules:[{conditions:[{[H]:c,[I]:[z,b2]}],rules:[{conditions:[{[H]:d,[I]:[{[H]:l3,[I]:[A,"name"]},"aws-us-gov"]}],endpoint:{url:"https://sts.{Region}.amazonaws.com",properties:v,headers:v},[G]:h},{endpoint:{url:"https://sts-fips.{Region}.{PartitionResult#dnsSuffix}",properties:v,headers:v},[G]:h}],[G]:j2},{error:"FIPS is enabled but this partition does not support FIPS",[G]:k3}],[G]:j2},{conditions:E,rules:[{conditions:[B],rules:[{endpoint:{url:"https://sts.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:v,headers:v},[G]:h}],[G]:j2},{error:"DualStack is enabled but this partition does not support DualStack",[G]:k3}],[G]:j2},w,{endpoint:{url:i2,properties:v,headers:v},[G]:h}],[G]:j2}],[G]:j2},{error:"Invalid Configuration: Missing Region",[G]:k3}]};exports.ruleSet=_data3});var require_endpointResolver2=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.defaultEndpointResolver=void 0;var util_endpoints_1=require_dist_cjs31(),util_endpoints_2=require_dist_cjs28(),ruleset_1=require_ruleset2(),cache4=new util_endpoints_2.EndpointCache({size:50,params:["Endpoint","Region","UseDualStack","UseFIPS","UseGlobalEndpoint"]}),defaultEndpointResolver3=(endpointParams,context={})=>{return cache4.get(endpointParams,()=>(0,util_endpoints_2.resolveEndpoint)(ruleset_1.ruleSet,{endpointParams,logger:context.logger}))};exports.defaultEndpointResolver=defaultEndpointResolver3;util_endpoints_2.customEndpointFunctions.aws=util_endpoints_1.awsEndpointFunctions});var require_STSServiceException=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.STSServiceException=exports.__ServiceException=void 0;var smithy_client_1=require_dist_cjs21();Object.defineProperty(exports,"__ServiceException",{enumerable:!0,get:function(){return smithy_client_1.ServiceException}});class STSServiceException extends smithy_client_1.ServiceException{constructor(options){super(options);Object.setPrototypeOf(this,STSServiceException.prototype)}}exports.STSServiceException=STSServiceException});var require_errors2=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.IDPCommunicationErrorException=exports.InvalidIdentityTokenException=exports.IDPRejectedClaimException=exports.RegionDisabledException=exports.PackedPolicyTooLargeException=exports.MalformedPolicyDocumentException=exports.ExpiredTokenException=void 0;var STSServiceException_1=require_STSServiceException();class ExpiredTokenException extends STSServiceException_1.STSServiceException{name="ExpiredTokenException";$fault="client";constructor(opts){super({name:"ExpiredTokenException",$fault:"client",...opts});Object.setPrototypeOf(this,ExpiredTokenException.prototype)}}exports.ExpiredTokenException=ExpiredTokenException;class MalformedPolicyDocumentException extends STSServiceException_1.STSServiceException{name="MalformedPolicyDocumentException";$fault="client";constructor(opts){super({name:"MalformedPolicyDocumentException",$fault:"client",...opts});Object.setPrototypeOf(this,MalformedPolicyDocumentException.prototype)}}exports.MalformedPolicyDocumentException=MalformedPolicyDocumentException;class PackedPolicyTooLargeException extends STSServiceException_1.STSServiceException{name="PackedPolicyTooLargeException";$fault="client";constructor(opts){super({name:"PackedPolicyTooLargeException",$fault:"client",...opts});Object.setPrototypeOf(this,PackedPolicyTooLargeException.prototype)}}exports.PackedPolicyTooLargeException=PackedPolicyTooLargeException;class RegionDisabledException extends STSServiceException_1.STSServiceException{name="RegionDisabledException";$fault="client";constructor(opts){super({name:"RegionDisabledException",$fault:"client",...opts});Object.setPrototypeOf(this,RegionDisabledException.prototype)}}exports.RegionDisabledException=RegionDisabledException;class IDPRejectedClaimException extends STSServiceException_1.STSServiceException{name="IDPRejectedClaimException";$fault="client";constructor(opts){super({name:"IDPRejectedClaimException",$fault:"client",...opts});Object.setPrototypeOf(this,IDPRejectedClaimException.prototype)}}exports.IDPRejectedClaimException=IDPRejectedClaimException;class InvalidIdentityTokenException extends STSServiceException_1.STSServiceException{name="InvalidIdentityTokenException";$fault="client";constructor(opts){super({name:"InvalidIdentityTokenException",$fault:"client",...opts});Object.setPrototypeOf(this,InvalidIdentityTokenException.prototype)}}exports.InvalidIdentityTokenException=InvalidIdentityTokenException;class IDPCommunicationErrorException extends STSServiceException_1.STSServiceException{name="IDPCommunicationErrorException";$fault="client";constructor(opts){super({name:"IDPCommunicationErrorException",$fault:"client",...opts});Object.setPrototypeOf(this,IDPCommunicationErrorException.prototype)}}exports.IDPCommunicationErrorException=IDPCommunicationErrorException});var require_schemas_02=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.AssumeRoleWithWebIdentity$=exports.AssumeRole$=exports.Tag$=exports.ProvidedContext$=exports.PolicyDescriptorType$=exports.Credentials$=exports.AssumeRoleWithWebIdentityResponse$=exports.AssumeRoleWithWebIdentityRequest$=exports.AssumeRoleResponse$=exports.AssumeRoleRequest$=exports.AssumedRoleUser$=exports.errorTypeRegistries=exports.RegionDisabledException$=exports.PackedPolicyTooLargeException$=exports.MalformedPolicyDocumentException$=exports.InvalidIdentityTokenException$=exports.IDPRejectedClaimException$=exports.IDPCommunicationErrorException$=exports.ExpiredTokenException$=exports.STSServiceException$=void 0;var _A="Arn",_AKI="AccessKeyId",_AR="AssumeRole",_ARI="AssumedRoleId",_ARR="AssumeRoleRequest",_ARRs="AssumeRoleResponse",_ARU="AssumedRoleUser",_ARWWI="AssumeRoleWithWebIdentity",_ARWWIR="AssumeRoleWithWebIdentityRequest",_ARWWIRs="AssumeRoleWithWebIdentityResponse",_Au="Audience",_C="Credentials",_CA="ContextAssertion",_DS="DurationSeconds",_E="Expiration",_EI="ExternalId",_ETE="ExpiredTokenException",_IDPCEE="IDPCommunicationErrorException",_IDPRCE="IDPRejectedClaimException",_IITE="InvalidIdentityTokenException",_K="Key",_MPDE="MalformedPolicyDocumentException",_P="Policy",_PA="PolicyArns",_PAr="ProviderArn",_PC="ProvidedContexts",_PCLT="ProvidedContextsListType",_PCr="ProvidedContext",_PDT="PolicyDescriptorType",_PI="ProviderId",_PPS="PackedPolicySize",_PPTLE="PackedPolicyTooLargeException",_Pr="Provider",_RA="RoleArn",_RDE="RegionDisabledException",_RSN="RoleSessionName",_SAK="SecretAccessKey",_SFWIT="SubjectFromWebIdentityToken",_SI="SourceIdentity",_SN="SerialNumber",_ST="SessionToken",_T="Tags",_TC="TokenCode",_TTK="TransitiveTagKeys",_Ta="Tag",_V="Value",_WIT="WebIdentityToken",_a="arn",_aKST="accessKeySecretType",_aQE="awsQueryError",_c="client",_cTT="clientTokenType",_e="error",_hE="httpError",_m="message",_pDLT="policyDescriptorListType",_s="smithy.ts.sdk.synthetic.com.amazonaws.sts",_tLT="tagListType",n0="com.amazonaws.sts",schema_1=require_schema(),errors_1=require_errors2(),STSServiceException_1=require_STSServiceException(),_s_registry3=schema_1.TypeRegistry.for(_s);exports.STSServiceException$=[-3,_s,"STSServiceException",0,[],[]];_s_registry3.registerError(exports.STSServiceException$,STSServiceException_1.STSServiceException);var n0_registry3=schema_1.TypeRegistry.for(n0);exports.ExpiredTokenException$=[-3,n0,_ETE,{[_aQE]:["ExpiredTokenException",400],[_e]:_c,[_hE]:400},[_m],[0]];n0_registry3.registerError(exports.ExpiredTokenException$,errors_1.ExpiredTokenException);exports.IDPCommunicationErrorException$=[-3,n0,_IDPCEE,{[_aQE]:["IDPCommunicationError",400],[_e]:_c,[_hE]:400},[_m],[0]];n0_registry3.registerError(exports.IDPCommunicationErrorException$,errors_1.IDPCommunicationErrorException);exports.IDPRejectedClaimException$=[-3,n0,_IDPRCE,{[_aQE]:["IDPRejectedClaim",403],[_e]:_c,[_hE]:403},[_m],[0]];n0_registry3.registerError(exports.IDPRejectedClaimException$,errors_1.IDPRejectedClaimException);exports.InvalidIdentityTokenException$=[-3,n0,_IITE,{[_aQE]:["InvalidIdentityToken",400],[_e]:_c,[_hE]:400},[_m],[0]];n0_registry3.registerError(exports.InvalidIdentityTokenException$,errors_1.InvalidIdentityTokenException);exports.MalformedPolicyDocumentException$=[-3,n0,_MPDE,{[_aQE]:["MalformedPolicyDocument",400],[_e]:_c,[_hE]:400},[_m],[0]];n0_registry3.registerError(exports.MalformedPolicyDocumentException$,errors_1.MalformedPolicyDocumentException);exports.PackedPolicyTooLargeException$=[-3,n0,_PPTLE,{[_aQE]:["PackedPolicyTooLarge",400],[_e]:_c,[_hE]:400},[_m],[0]];n0_registry3.registerError(exports.PackedPolicyTooLargeException$,errors_1.PackedPolicyTooLargeException);exports.RegionDisabledException$=[-3,n0,_RDE,{[_aQE]:["RegionDisabledException",403],[_e]:_c,[_hE]:403},[_m],[0]];n0_registry3.registerError(exports.RegionDisabledException$,errors_1.RegionDisabledException);exports.errorTypeRegistries=[_s_registry3,n0_registry3];var accessKeySecretType=[0,n0,_aKST,8,0],clientTokenType=[0,n0,_cTT,8,0];exports.AssumedRoleUser$=[3,n0,_ARU,0,[_ARI,_A],[0,0],2];exports.AssumeRoleRequest$=[3,n0,_ARR,0,[_RA,_RSN,_PA,_P,_DS,_T,_TTK,_EI,_SN,_TC,_SI,_PC],[0,0,()=>policyDescriptorListType,0,1,()=>tagListType,64,0,0,0,0,()=>ProvidedContextsListType],2];exports.AssumeRoleResponse$=[3,n0,_ARRs,0,[_C,_ARU,_PPS,_SI],[[()=>exports.Credentials$,0],()=>exports.AssumedRoleUser$,1,0]];exports.AssumeRoleWithWebIdentityRequest$=[3,n0,_ARWWIR,0,[_RA,_RSN,_WIT,_PI,_PA,_P,_DS],[0,0,[()=>clientTokenType,0],0,()=>policyDescriptorListType,0,1],3];exports.AssumeRoleWithWebIdentityResponse$=[3,n0,_ARWWIRs,0,[_C,_SFWIT,_ARU,_PPS,_Pr,_Au,_SI],[[()=>exports.Credentials$,0],0,()=>exports.AssumedRoleUser$,1,0,0,0]];exports.Credentials$=[3,n0,_C,0,[_AKI,_SAK,_ST,_E],[0,[()=>accessKeySecretType,0],0,4],4];exports.PolicyDescriptorType$=[3,n0,_PDT,0,[_a],[0]];exports.ProvidedContext$=[3,n0,_PCr,0,[_PAr,_CA],[0,0]];exports.Tag$=[3,n0,_Ta,0,[_K,_V],[0,0],2];var policyDescriptorListType=[1,n0,_pDLT,0,()=>exports.PolicyDescriptorType$],ProvidedContextsListType=[1,n0,_PCLT,0,()=>exports.ProvidedContext$],tagListType=[1,n0,_tLT,0,()=>exports.Tag$];exports.AssumeRole$=[9,n0,_AR,0,()=>exports.AssumeRoleRequest$,()=>exports.AssumeRoleResponse$];exports.AssumeRoleWithWebIdentity$=[9,n0,_ARWWI,0,()=>exports.AssumeRoleWithWebIdentityRequest$,()=>exports.AssumeRoleWithWebIdentityResponse$]});var require_runtimeConfig_shared2=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.getRuntimeConfig=void 0;var core_1=require_dist_cjs23(),protocols_1=require_protocols2(),core_2=require_dist_cjs16(),smithy_client_1=require_dist_cjs21(),url_parser_1=require_dist_cjs30(),util_base64_1=require_dist_cjs8(),util_utf8_1=require_dist_cjs7(),httpAuthSchemeProvider_1=require_httpAuthSchemeProvider2(),endpointResolver_1=require_endpointResolver2(),schemas_0_1=require_schemas_02(),getRuntimeConfig3=(config)=>{return{apiVersion:"2011-06-15",base64Decoder:config?.base64Decoder??util_base64_1.fromBase64,base64Encoder:config?.base64Encoder??util_base64_1.toBase64,disableHostPrefix:config?.disableHostPrefix??!1,endpointProvider:config?.endpointProvider??endpointResolver_1.defaultEndpointResolver,extensions:config?.extensions??[],httpAuthSchemeProvider:config?.httpAuthSchemeProvider??httpAuthSchemeProvider_1.defaultSTSHttpAuthSchemeProvider,httpAuthSchemes:config?.httpAuthSchemes??[{schemeId:"aws.auth#sigv4",identityProvider:(ipc)=>ipc.getIdentityProvider("aws.auth#sigv4"),signer:new core_1.AwsSdkSigV4Signer},{schemeId:"smithy.api#noAuth",identityProvider:(ipc)=>ipc.getIdentityProvider("smithy.api#noAuth")||(async()=>({})),signer:new core_2.NoAuthSigner}],logger:config?.logger??new smithy_client_1.NoOpLogger,protocol:config?.protocol??protocols_1.AwsQueryProtocol,protocolSettings:config?.protocolSettings??{defaultNamespace:"com.amazonaws.sts",errorTypeRegistries:schemas_0_1.errorTypeRegistries,xmlNamespace:"https://sts.amazonaws.com/doc/2011-06-15/",version:"2011-06-15",serviceTarget:"AWSSecurityTokenServiceV20110615"},serviceId:config?.serviceId??"STS",urlParser:config?.urlParser??url_parser_1.parseUrl,utf8Decoder:config?.utf8Decoder??util_utf8_1.fromUtf8,utf8Encoder:config?.utf8Encoder??util_utf8_1.toUtf8}};exports.getRuntimeConfig=getRuntimeConfig3});var require_runtimeConfig2=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.getRuntimeConfig=void 0;var tslib_1=require_tslib(),package_json_1=tslib_1.__importDefault(require_package2()),core_1=require_dist_cjs23(),util_user_agent_node_1=require_dist_cjs41(),config_resolver_1=require_dist_cjs33(),core_2=require_dist_cjs16(),hash_node_1=require_dist_cjs42(),middleware_retry_1=require_dist_cjs40(),node_config_provider_1=require_dist_cjs36(),node_http_handler_1=require_dist_cjs11(),smithy_client_1=require_dist_cjs21(),util_body_length_node_1=require_dist_cjs43(),util_defaults_mode_node_1=require_dist_cjs44(),util_retry_1=require_dist_cjs39(),runtimeConfig_shared_1=require_runtimeConfig_shared2(),getRuntimeConfig3=(config)=>{(0,smithy_client_1.emitWarningIfUnsupportedVersion)(process.version);let defaultsMode=(0,util_defaults_mode_node_1.resolveDefaultsModeConfig)(config),defaultConfigProvider=()=>defaultsMode().then(smithy_client_1.loadConfigsForDefaultMode),clientSharedValues=(0,runtimeConfig_shared_1.getRuntimeConfig)(config);(0,core_1.emitWarningIfUnsupportedVersion)(process.version);let loaderConfig={profile:config?.profile,logger:clientSharedValues.logger};return{...clientSharedValues,...config,runtime:"node",defaultsMode,authSchemePreference:config?.authSchemePreference??(0,node_config_provider_1.loadConfig)(core_1.NODE_AUTH_SCHEME_PREFERENCE_OPTIONS,loaderConfig),bodyLengthChecker:config?.bodyLengthChecker??util_body_length_node_1.calculateBodyLength,defaultUserAgentProvider:config?.defaultUserAgentProvider??(0,util_user_agent_node_1.createDefaultUserAgentProvider)({serviceId:clientSharedValues.serviceId,clientVersion:package_json_1.default.version}),httpAuthSchemes:config?.httpAuthSchemes??[{schemeId:"aws.auth#sigv4",identityProvider:(ipc)=>ipc.getIdentityProvider("aws.auth#sigv4")||(async(idProps)=>await config.credentialDefaultProvider(idProps?.__config||{})()),signer:new core_1.AwsSdkSigV4Signer},{schemeId:"smithy.api#noAuth",identityProvider:(ipc)=>ipc.getIdentityProvider("smithy.api#noAuth")||(async()=>({})),signer:new core_2.NoAuthSigner}],maxAttempts:config?.maxAttempts??(0,node_config_provider_1.loadConfig)(middleware_retry_1.NODE_MAX_ATTEMPT_CONFIG_OPTIONS,config),region:config?.region??(0,node_config_provider_1.loadConfig)(config_resolver_1.NODE_REGION_CONFIG_OPTIONS,{...config_resolver_1.NODE_REGION_CONFIG_FILE_OPTIONS,...loaderConfig}),requestHandler:node_http_handler_1.NodeHttpHandler.create(config?.requestHandler??defaultConfigProvider),retryMode:config?.retryMode??(0,node_config_provider_1.loadConfig)({...middleware_retry_1.NODE_RETRY_MODE_CONFIG_OPTIONS,default:async()=>(await defaultConfigProvider()).retryMode||util_retry_1.DEFAULT_RETRY_MODE},config),sha256:config?.sha256??hash_node_1.Hash.bind(null,"sha256"),streamCollector:config?.streamCollector??node_http_handler_1.streamCollector,useDualstackEndpoint:config?.useDualstackEndpoint??(0,node_config_provider_1.loadConfig)(config_resolver_1.NODE_USE_DUALSTACK_ENDPOINT_CONFIG_OPTIONS,loaderConfig),useFipsEndpoint:config?.useFipsEndpoint??(0,node_config_provider_1.loadConfig)(config_resolver_1.NODE_USE_FIPS_ENDPOINT_CONFIG_OPTIONS,loaderConfig),userAgentAppId:config?.userAgentAppId??(0,node_config_provider_1.loadConfig)(util_user_agent_node_1.NODE_APP_ID_CONFIG_OPTIONS,loaderConfig)}};exports.getRuntimeConfig=getRuntimeConfig3});var require_httpAuthExtensionConfiguration=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.resolveHttpAuthRuntimeConfig=exports.getHttpAuthExtensionConfiguration=void 0;var getHttpAuthExtensionConfiguration2=(runtimeConfig)=>{let{httpAuthSchemes:_httpAuthSchemes,httpAuthSchemeProvider:_httpAuthSchemeProvider,credentials:_credentials}=runtimeConfig;return{setHttpAuthScheme(httpAuthScheme){let index2=_httpAuthSchemes.findIndex((scheme)=>scheme.schemeId===httpAuthScheme.schemeId);if(index2===-1)_httpAuthSchemes.push(httpAuthScheme);else _httpAuthSchemes.splice(index2,1,httpAuthScheme)},httpAuthSchemes(){return _httpAuthSchemes},setHttpAuthSchemeProvider(httpAuthSchemeProvider){_httpAuthSchemeProvider=httpAuthSchemeProvider},httpAuthSchemeProvider(){return _httpAuthSchemeProvider},setCredentials(credentials){_credentials=credentials},credentials(){return _credentials}}};exports.getHttpAuthExtensionConfiguration=getHttpAuthExtensionConfiguration2;var resolveHttpAuthRuntimeConfig2=(config)=>{return{httpAuthSchemes:config.httpAuthSchemes(),httpAuthSchemeProvider:config.httpAuthSchemeProvider(),credentials:config.credentials()}};exports.resolveHttpAuthRuntimeConfig=resolveHttpAuthRuntimeConfig2});var require_runtimeExtensions=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.resolveRuntimeExtensions=void 0;var region_config_resolver_1=require_dist_cjs45(),protocol_http_1=require_dist_cjs2(),smithy_client_1=require_dist_cjs21(),httpAuthExtensionConfiguration_1=require_httpAuthExtensionConfiguration(),resolveRuntimeExtensions2=(runtimeConfig,extensions2)=>{let extensionConfiguration=Object.assign((0,region_config_resolver_1.getAwsRegionExtensionConfiguration)(runtimeConfig),(0,smithy_client_1.getDefaultExtensionConfiguration)(runtimeConfig),(0,protocol_http_1.getHttpHandlerExtensionConfiguration)(runtimeConfig),(0,httpAuthExtensionConfiguration_1.getHttpAuthExtensionConfiguration)(runtimeConfig));return extensions2.forEach((extension)=>extension.configure(extensionConfiguration)),Object.assign(runtimeConfig,(0,region_config_resolver_1.resolveAwsRegionExtensionConfiguration)(extensionConfiguration),(0,smithy_client_1.resolveDefaultRuntimeConfig)(extensionConfiguration),(0,protocol_http_1.resolveHttpHandlerRuntimeConfig)(extensionConfiguration),(0,httpAuthExtensionConfiguration_1.resolveHttpAuthRuntimeConfig)(extensionConfiguration))};exports.resolveRuntimeExtensions=resolveRuntimeExtensions2});var require_STSClient=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.STSClient=exports.__Client=void 0;var middleware_host_header_1=require_dist_cjs24(),middleware_logger_1=require_dist_cjs25(),middleware_recursion_detection_1=require_dist_cjs26(),middleware_user_agent_1=require_dist_cjs32(),config_resolver_1=require_dist_cjs33(),core_1=require_dist_cjs16(),schema_1=require_schema(),middleware_content_length_1=require_dist_cjs34(),middleware_endpoint_1=require_dist_cjs37(),middleware_retry_1=require_dist_cjs40(),smithy_client_1=require_dist_cjs21();Object.defineProperty(exports,"__Client",{enumerable:!0,get:function(){return smithy_client_1.Client}});var httpAuthSchemeProvider_1=require_httpAuthSchemeProvider2(),EndpointParameters_1=require_EndpointParameters(),runtimeConfig_1=require_runtimeConfig2(),runtimeExtensions_1=require_runtimeExtensions();class STSClient extends smithy_client_1.Client{config;constructor(...[configuration]){let _config_0=(0,runtimeConfig_1.getRuntimeConfig)(configuration||{});super(_config_0);this.initConfig=_config_0;let _config_1=(0,EndpointParameters_1.resolveClientEndpointParameters)(_config_0),_config_2=(0,middleware_user_agent_1.resolveUserAgentConfig)(_config_1),_config_3=(0,middleware_retry_1.resolveRetryConfig)(_config_2),_config_4=(0,config_resolver_1.resolveRegionConfig)(_config_3),_config_5=(0,middleware_host_header_1.resolveHostHeaderConfig)(_config_4),_config_6=(0,middleware_endpoint_1.resolveEndpointConfig)(_config_5),_config_7=(0,httpAuthSchemeProvider_1.resolveHttpAuthSchemeConfig)(_config_6),_config_8=(0,runtimeExtensions_1.resolveRuntimeExtensions)(_config_7,configuration?.extensions||[]);this.config=_config_8,this.middlewareStack.use((0,schema_1.getSchemaSerdePlugin)(this.config)),this.middlewareStack.use((0,middleware_user_agent_1.getUserAgentPlugin)(this.config)),this.middlewareStack.use((0,middleware_retry_1.getRetryPlugin)(this.config)),this.middlewareStack.use((0,middleware_content_length_1.getContentLengthPlugin)(this.config)),this.middlewareStack.use((0,middleware_host_header_1.getHostHeaderPlugin)(this.config)),this.middlewareStack.use((0,middleware_logger_1.getLoggerPlugin)(this.config)),this.middlewareStack.use((0,middleware_recursion_detection_1.getRecursionDetectionPlugin)(this.config)),this.middlewareStack.use((0,core_1.getHttpAuthSchemeEndpointRuleSetPlugin)(this.config,{httpAuthSchemeParametersProvider:httpAuthSchemeProvider_1.defaultSTSHttpAuthSchemeParametersProvider,identityProviderConfigProvider:async(config)=>new core_1.DefaultIdentityProviderConfig({"aws.auth#sigv4":config.credentials})})),this.middlewareStack.use((0,core_1.getHttpSigningPlugin)(this.config))}destroy(){super.destroy()}}exports.STSClient=STSClient});var require_sts=__commonJS((exports)=>{var STSClient=require_STSClient(),smithyClient=require_dist_cjs21(),middlewareEndpoint=require_dist_cjs37(),EndpointParameters=require_EndpointParameters(),schemas_02=require_schemas_02(),errors3=require_errors2(),client=require_client(),regionConfigResolver=require_dist_cjs45(),STSServiceException=require_STSServiceException();class AssumeRoleCommand extends smithyClient.Command.classBuilder().ep(EndpointParameters.commonParams).m(function(Command,cs,config,o2){return[middlewareEndpoint.getEndpointPlugin(config,Command.getEndpointParameterInstructions())]}).s("AWSSecurityTokenServiceV20110615","AssumeRole",{}).n("STSClient","AssumeRoleCommand").sc(schemas_02.AssumeRole$).build(){}class AssumeRoleWithWebIdentityCommand extends smithyClient.Command.classBuilder().ep(EndpointParameters.commonParams).m(function(Command,cs,config,o2){return[middlewareEndpoint.getEndpointPlugin(config,Command.getEndpointParameterInstructions())]}).s("AWSSecurityTokenServiceV20110615","AssumeRoleWithWebIdentity",{}).n("STSClient","AssumeRoleWithWebIdentityCommand").sc(schemas_02.AssumeRoleWithWebIdentity$).build(){}var commands3={AssumeRoleCommand,AssumeRoleWithWebIdentityCommand};class STS extends STSClient.STSClient{}smithyClient.createAggregatedClient(commands3,STS);var getAccountIdFromAssumedRoleUser=(assumedRoleUser)=>{if(typeof assumedRoleUser?.Arn==="string"){let arnComponents=assumedRoleUser.Arn.split(":");if(arnComponents.length>4&&arnComponents[4]!=="")return arnComponents[4]}return},resolveRegion=async(_region,_parentRegion,credentialProviderLogger,loaderConfig={})=>{let region=typeof _region==="function"?await _region():_region,parentRegion=typeof _parentRegion==="function"?await _parentRegion():_parentRegion,stsDefaultRegion="",resolvedRegion=region??parentRegion??(stsDefaultRegion=await regionConfigResolver.stsRegionDefaultResolver(loaderConfig)());return credentialProviderLogger?.debug?.("@aws-sdk/client-sts::resolveRegion","accepting first of:",`${region} (credential provider clientConfig)`,`${parentRegion} (contextual client)`,`${stsDefaultRegion} (STS default: AWS_REGION, profile region, or us-east-1)`),resolvedRegion},getDefaultRoleAssumer$1=(stsOptions,STSClient2)=>{let stsClient,closureSourceCreds;return async(sourceCreds,params)=>{if(closureSourceCreds=sourceCreds,!stsClient){let{logger=stsOptions?.parentClientConfig?.logger,profile=stsOptions?.parentClientConfig?.profile,region,requestHandler=stsOptions?.parentClientConfig?.requestHandler,credentialProviderLogger,userAgentAppId=stsOptions?.parentClientConfig?.userAgentAppId}=stsOptions,resolvedRegion=await resolveRegion(region,stsOptions?.parentClientConfig?.region,credentialProviderLogger,{logger,profile}),isCompatibleRequestHandler=!isH2(requestHandler);stsClient=new STSClient2({...stsOptions,userAgentAppId,profile,credentialDefaultProvider:()=>async()=>closureSourceCreds,region:resolvedRegion,requestHandler:isCompatibleRequestHandler?requestHandler:void 0,logger})}let{Credentials,AssumedRoleUser}=await stsClient.send(new AssumeRoleCommand(params));if(!Credentials||!Credentials.AccessKeyId||!Credentials.SecretAccessKey)throw Error(`Invalid response from STS.assumeRole call with role ${params.RoleArn}`);let accountId=getAccountIdFromAssumedRoleUser(AssumedRoleUser),credentials={accessKeyId:Credentials.AccessKeyId,secretAccessKey:Credentials.SecretAccessKey,sessionToken:Credentials.SessionToken,expiration:Credentials.Expiration,...Credentials.CredentialScope&&{credentialScope:Credentials.CredentialScope},...accountId&&{accountId}};return client.setCredentialFeature(credentials,"CREDENTIALS_STS_ASSUME_ROLE","i"),credentials}},getDefaultRoleAssumerWithWebIdentity$1=(stsOptions,STSClient2)=>{let stsClient;return async(params)=>{if(!stsClient){let{logger=stsOptions?.parentClientConfig?.logger,profile=stsOptions?.parentClientConfig?.profile,region,requestHandler=stsOptions?.parentClientConfig?.requestHandler,credentialProviderLogger,userAgentAppId=stsOptions?.parentClientConfig?.userAgentAppId}=stsOptions,resolvedRegion=await resolveRegion(region,stsOptions?.parentClientConfig?.region,credentialProviderLogger,{logger,profile}),isCompatibleRequestHandler=!isH2(requestHandler);stsClient=new STSClient2({...stsOptions,userAgentAppId,profile,region:resolvedRegion,requestHandler:isCompatibleRequestHandler?requestHandler:void 0,logger})}let{Credentials,AssumedRoleUser}=await stsClient.send(new AssumeRoleWithWebIdentityCommand(params));if(!Credentials||!Credentials.AccessKeyId||!Credentials.SecretAccessKey)throw Error(`Invalid response from STS.assumeRoleWithWebIdentity call with role ${params.RoleArn}`);let accountId=getAccountIdFromAssumedRoleUser(AssumedRoleUser),credentials={accessKeyId:Credentials.AccessKeyId,secretAccessKey:Credentials.SecretAccessKey,sessionToken:Credentials.SessionToken,expiration:Credentials.Expiration,...Credentials.CredentialScope&&{credentialScope:Credentials.CredentialScope},...accountId&&{accountId}};if(accountId)client.setCredentialFeature(credentials,"RESOLVED_ACCOUNT_ID","T");return client.setCredentialFeature(credentials,"CREDENTIALS_STS_ASSUME_ROLE_WEB_ID","k"),credentials}},isH2=(requestHandler)=>{return requestHandler?.metadata?.handlerProtocol==="h2"},getCustomizableStsClientCtor=(baseCtor,customizations)=>{if(!customizations)return baseCtor;else return class extends baseCtor{constructor(config){super(config);for(let customization of customizations)this.middlewareStack.use(customization)}}},getDefaultRoleAssumer=(stsOptions={},stsPlugins)=>getDefaultRoleAssumer$1(stsOptions,getCustomizableStsClientCtor(STSClient.STSClient,stsPlugins)),getDefaultRoleAssumerWithWebIdentity=(stsOptions={},stsPlugins)=>getDefaultRoleAssumerWithWebIdentity$1(stsOptions,getCustomizableStsClientCtor(STSClient.STSClient,stsPlugins)),decorateDefaultCredentialProvider=(provider)=>(input)=>provider({roleAssumer:getDefaultRoleAssumer(input),roleAssumerWithWebIdentity:getDefaultRoleAssumerWithWebIdentity(input),...input});Object.defineProperty(exports,"$Command",{enumerable:!0,get:function(){return smithyClient.Command}});Object.defineProperty(exports,"STSServiceException",{enumerable:!0,get:function(){return STSServiceException.STSServiceException}});exports.AssumeRoleCommand=AssumeRoleCommand;exports.AssumeRoleWithWebIdentityCommand=AssumeRoleWithWebIdentityCommand;exports.STS=STS;exports.decorateDefaultCredentialProvider=decorateDefaultCredentialProvider;exports.getDefaultRoleAssumer=getDefaultRoleAssumer;exports.getDefaultRoleAssumerWithWebIdentity=getDefaultRoleAssumerWithWebIdentity;Object.keys(STSClient).forEach(function(k3){if(k3!=="default"&&!Object.prototype.hasOwnProperty.call(exports,k3))Object.defineProperty(exports,k3,{enumerable:!0,get:function(){return STSClient[k3]}})});Object.keys(schemas_02).forEach(function(k3){if(k3!=="default"&&!Object.prototype.hasOwnProperty.call(exports,k3))Object.defineProperty(exports,k3,{enumerable:!0,get:function(){return schemas_02[k3]}})});Object.keys(errors3).forEach(function(k3){if(k3!=="default"&&!Object.prototype.hasOwnProperty.call(exports,k3))Object.defineProperty(exports,k3,{enumerable:!0,get:function(){return errors3[k3]}})})});var import_client5,import_property_provider17,import_shared_ini_file_loader5,isAssumeRoleProfile=(arg,{profile="default",logger}={})=>{return Boolean(arg)&&typeof arg==="object"&&typeof arg.role_arn==="string"&&["undefined","string"].indexOf(typeof arg.role_session_name)>-1&&["undefined","string"].indexOf(typeof arg.external_id)>-1&&["undefined","string"].indexOf(typeof arg.mfa_serial)>-1&&(isAssumeRoleWithSourceProfile(arg,{profile,logger})||isCredentialSourceProfile(arg,{profile,logger}))},isAssumeRoleWithSourceProfile=(arg,{profile,logger})=>{let withSourceProfile=typeof arg.source_profile==="string"&&typeof arg.credential_source>"u";if(withSourceProfile)logger?.debug?.(`    ${profile} isAssumeRoleWithSourceProfile source_profile=${arg.source_profile}`);return withSourceProfile},isCredentialSourceProfile=(arg,{profile,logger})=>{let withProviderProfile=typeof arg.credential_source==="string"&&typeof arg.source_profile>"u";if(withProviderProfile)logger?.debug?.(`    ${profile} isCredentialSourceProfile credential_source=${arg.credential_source}`);return withProviderProfile},resolveAssumeRoleCredentials=async(profileName,profiles,options,callerClientConfig,visitedProfiles={},resolveProfileData)=>{options.logger?.debug("@aws-sdk/credential-provider-ini - resolveAssumeRoleCredentials (STS)");let profileData=profiles[profileName],{source_profile,region}=profileData;if(!options.roleAssumer){let{getDefaultRoleAssumer}=await Promise.resolve().then(() => __toESM(require_sts(),1));options.roleAssumer=getDefaultRoleAssumer({...options.clientConfig,credentialProviderLogger:options.logger,parentClientConfig:{...callerClientConfig,...options?.parentClientConfig,region:region??options?.parentClientConfig?.region??callerClientConfig?.region}},options.clientPlugins)}if(source_profile&&source_profile in visitedProfiles)throw new import_property_provider17.CredentialsProviderError(`Detected a cycle attempting to resolve credentials for profile ${import_shared_ini_file_loader5.getProfileName(options)}. Profiles visited: `+Object.keys(visitedProfiles).join(", "),{logger:options.logger});options.logger?.debug(`@aws-sdk/credential-provider-ini - finding credential resolver using ${source_profile?`source_profile=[${source_profile}]`:`profile=[${profileName}]`}`);let sourceCredsProvider=source_profile?resolveProfileData(source_profile,profiles,options,callerClientConfig,{...visitedProfiles,[source_profile]:!0},isCredentialSourceWithoutRoleArn(profiles[source_profile]??{})):(await resolveCredentialSource(profileData.credential_source,profileName,options.logger)(options))();if(isCredentialSourceWithoutRoleArn(profileData))return sourceCredsProvider.then((creds)=>import_client5.setCredentialFeature(creds,"CREDENTIALS_PROFILE_SOURCE_PROFILE","o"));else{let params={RoleArn:profileData.role_arn,RoleSessionName:profileData.role_session_name||`aws-sdk-js-${Date.now()}`,ExternalId:profileData.external_id,DurationSeconds:parseInt(profileData.duration_seconds||"3600",10)},{mfa_serial}=profileData;if(mfa_serial){if(!options.mfaCodeProvider)throw new import_property_provider17.CredentialsProviderError(`Profile ${profileName} requires multi-factor authentication, but no MFA code callback was provided.`,{logger:options.logger,tryNextLink:!1});params.SerialNumber=mfa_serial,params.TokenCode=await options.mfaCodeProvider(mfa_serial)}let sourceCreds=await sourceCredsProvider;return options.roleAssumer(sourceCreds,params).then((creds)=>import_client5.setCredentialFeature(creds,"CREDENTIALS_PROFILE_SOURCE_PROFILE","o"))}},isCredentialSourceWithoutRoleArn=(section)=>{return!section.role_arn&&!!section.credential_source};var init_resolveAssumeRoleCredentials=__esm(()=>{init_resolveCredentialSource();import_client5=__toESM(require_client(),1),import_property_provider17=__toESM(require_dist_cjs17(),1),import_shared_ini_file_loader5=__toESM(require_dist_cjs35(),1)});var require_httpAuthSchemeProvider3=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.resolveHttpAuthSchemeConfig=exports.defaultSigninHttpAuthSchemeProvider=exports.defaultSigninHttpAuthSchemeParametersProvider=void 0;var core_1=require_dist_cjs23(),util_middleware_1=require_dist_cjs3(),defaultSigninHttpAuthSchemeParametersProvider=async(config,context,input)=>{return{operation:(0,util_middleware_1.getSmithyContext)(context).operation,region:await(0,util_middleware_1.normalizeProvider)(config.region)()||(()=>{throw Error("expected `region` to be configured for `aws.auth#sigv4`")})()}};exports.defaultSigninHttpAuthSchemeParametersProvider=defaultSigninHttpAuthSchemeParametersProvider;function createAwsAuthSigv4HttpAuthOption3(authParameters){return{schemeId:"aws.auth#sigv4",signingProperties:{name:"signin",region:authParameters.region},propertiesExtractor:(config,context)=>({signingProperties:{config,context}})}}function createSmithyApiNoAuthHttpAuthOption2(authParameters){return{schemeId:"smithy.api#noAuth"}}var defaultSigninHttpAuthSchemeProvider=(authParameters)=>{let options=[];switch(authParameters.operation){case"CreateOAuth2Token":{options.push(createSmithyApiNoAuthHttpAuthOption2(authParameters));break}default:options.push(createAwsAuthSigv4HttpAuthOption3(authParameters))}return options};exports.defaultSigninHttpAuthSchemeProvider=defaultSigninHttpAuthSchemeProvider;var resolveHttpAuthSchemeConfig3=(config)=>{let config_0=(0,core_1.resolveAwsSdkSigV4Config)(config);return Object.assign(config_0,{authSchemePreference:(0,util_middleware_1.normalizeProvider)(config.authSchemePreference??[])})};exports.resolveHttpAuthSchemeConfig=resolveHttpAuthSchemeConfig3});var require_ruleset3=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.ruleSet=void 0;var u="required",v="fn",w="argv",x="ref",a12=!0,b2="isSet",c="booleanEquals",d="error",e="endpoint",f="tree",g="PartitionResult",h="stringEquals",i2={[u]:!0,default:!1,type:"boolean"},j2={[u]:!1,type:"string"},k3={[x]:"Endpoint"},l3={[v]:c,[w]:[{[x]:"UseFIPS"},!0]},m3={[v]:c,[w]:[{[x]:"UseDualStack"},!0]},n3={},o2={[v]:"getAttr",[w]:[{[x]:g},"name"]},p2={[v]:c,[w]:[{[x]:"UseFIPS"},!1]},q2={[v]:c,[w]:[{[x]:"UseDualStack"},!1]},r3={[v]:"getAttr",[w]:[{[x]:g},"supportsFIPS"]},s2={[v]:c,[w]:[!0,{[v]:"getAttr",[w]:[{[x]:g},"supportsDualStack"]}]},t9=[{[x]:"Region"}],_data3={version:"1.0",parameters:{UseDualStack:i2,UseFIPS:i2,Endpoint:j2,Region:j2},rules:[{conditions:[{[v]:b2,[w]:[k3]}],rules:[{conditions:[l3],error:"Invalid Configuration: FIPS and custom endpoint are not supported",type:d},{rules:[{conditions:[m3],error:"Invalid Configuration: Dualstack and custom endpoint are not supported",type:d},{endpoint:{url:k3,properties:n3,headers:n3},type:e}],type:f}],type:f},{rules:[{conditions:[{[v]:b2,[w]:t9}],rules:[{conditions:[{[v]:"aws.partition",[w]:t9,assign:g}],rules:[{conditions:[{[v]:h,[w]:[o2,"aws"]},p2,q2],endpoint:{url:"https://{Region}.signin.aws.amazon.com",properties:n3,headers:n3},type:e},{conditions:[{[v]:h,[w]:[o2,"aws-cn"]},p2,q2],endpoint:{url:"https://{Region}.signin.amazonaws.cn",properties:n3,headers:n3},type:e},{conditions:[{[v]:h,[w]:[o2,"aws-us-gov"]},p2,q2],endpoint:{url:"https://{Region}.signin.amazonaws-us-gov.com",properties:n3,headers:n3},type:e},{conditions:[l3,m3],rules:[{conditions:[{[v]:c,[w]:[a12,r3]},s2],rules:[{endpoint:{url:"https://signin-fips.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:n3,headers:n3},type:e}],type:f},{error:"FIPS and DualStack are enabled, but this partition does not support one or both",type:d}],type:f},{conditions:[l3,q2],rules:[{conditions:[{[v]:c,[w]:[r3,a12]}],rules:[{endpoint:{url:"https://signin-fips.{Region}.{PartitionResult#dnsSuffix}",properties:n3,headers:n3},type:e}],type:f},{error:"FIPS is enabled but this partition does not support FIPS",type:d}],type:f},{conditions:[p2,m3],rules:[{conditions:[s2],rules:[{endpoint:{url:"https://signin.{Region}.{PartitionResult#dualStackDnsSuffix}",properties:n3,headers:n3},type:e}],type:f},{error:"DualStack is enabled but this partition does not support DualStack",type:d}],type:f},{endpoint:{url:"https://signin.{Region}.{PartitionResult#dnsSuffix}",properties:n3,headers:n3},type:e}],type:f}],type:f},{error:"Invalid Configuration: Missing Region",type:d}],type:f}]};exports.ruleSet=_data3});var require_endpointResolver3=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.defaultEndpointResolver=void 0;var util_endpoints_1=require_dist_cjs31(),util_endpoints_2=require_dist_cjs28(),ruleset_1=require_ruleset3(),cache4=new util_endpoints_2.EndpointCache({size:50,params:["Endpoint","Region","UseDualStack","UseFIPS"]}),defaultEndpointResolver3=(endpointParams,context={})=>{return cache4.get(endpointParams,()=>(0,util_endpoints_2.resolveEndpoint)(ruleset_1.ruleSet,{endpointParams,logger:context.logger}))};exports.defaultEndpointResolver=defaultEndpointResolver3;util_endpoints_2.customEndpointFunctions.aws=util_endpoints_1.awsEndpointFunctions});var require_SigninServiceException=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.SigninServiceException=exports.__ServiceException=void 0;var smithy_client_1=require_dist_cjs21();Object.defineProperty(exports,"__ServiceException",{enumerable:!0,get:function(){return smithy_client_1.ServiceException}});class SigninServiceException extends smithy_client_1.ServiceException{constructor(options){super(options);Object.setPrototypeOf(this,SigninServiceException.prototype)}}exports.SigninServiceException=SigninServiceException});var require_errors3=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.ValidationException=exports.TooManyRequestsError=exports.InternalServerException=exports.AccessDeniedException=void 0;var SigninServiceException_1=require_SigninServiceException();class AccessDeniedException extends SigninServiceException_1.SigninServiceException{name="AccessDeniedException";$fault="client";error;constructor(opts){super({name:"AccessDeniedException",$fault:"client",...opts});Object.setPrototypeOf(this,AccessDeniedException.prototype),this.error=opts.error}}exports.AccessDeniedException=AccessDeniedException;class InternalServerException extends SigninServiceException_1.SigninServiceException{name="InternalServerException";$fault="server";error;constructor(opts){super({name:"InternalServerException",$fault:"server",...opts});Object.setPrototypeOf(this,InternalServerException.prototype),this.error=opts.error}}exports.InternalServerException=InternalServerException;class TooManyRequestsError extends SigninServiceException_1.SigninServiceException{name="TooManyRequestsError";$fault="client";error;constructor(opts){super({name:"TooManyRequestsError",$fault:"client",...opts});Object.setPrototypeOf(this,TooManyRequestsError.prototype),this.error=opts.error}}exports.TooManyRequestsError=TooManyRequestsError;class ValidationException extends SigninServiceException_1.SigninServiceException{name="ValidationException";$fault="client";error;constructor(opts){super({name:"ValidationException",$fault:"client",...opts});Object.setPrototypeOf(this,ValidationException.prototype),this.error=opts.error}}exports.ValidationException=ValidationException});var require_schemas_03=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.CreateOAuth2Token$=exports.CreateOAuth2TokenResponseBody$=exports.CreateOAuth2TokenResponse$=exports.CreateOAuth2TokenRequestBody$=exports.CreateOAuth2TokenRequest$=exports.AccessToken$=exports.errorTypeRegistries=exports.ValidationException$=exports.TooManyRequestsError$=exports.InternalServerException$=exports.AccessDeniedException$=exports.SigninServiceException$=void 0;var _ADE="AccessDeniedException",_AT="AccessToken",_COAT="CreateOAuth2Token",_COATR="CreateOAuth2TokenRequest",_COATRB="CreateOAuth2TokenRequestBody",_COATRBr="CreateOAuth2TokenResponseBody",_COATRr="CreateOAuth2TokenResponse",_ISE="InternalServerException",_RT="RefreshToken",_TMRE="TooManyRequestsError",_VE="ValidationException",_aKI="accessKeyId",_aT="accessToken",_c="client",_cI="clientId",_cV="codeVerifier",_co="code",_e="error",_eI="expiresIn",_gT="grantType",_h="http",_hE="httpError",_iT="idToken",_jN="jsonName",_m="message",_rT="refreshToken",_rU="redirectUri",_s="smithy.ts.sdk.synthetic.com.amazonaws.signin",_sAK="secretAccessKey",_sT="sessionToken",_se="server",_tI="tokenInput",_tO="tokenOutput",_tT="tokenType",n0="com.amazonaws.signin",schema_1=require_schema(),errors_1=require_errors3(),SigninServiceException_1=require_SigninServiceException(),_s_registry3=schema_1.TypeRegistry.for(_s);exports.SigninServiceException$=[-3,_s,"SigninServiceException",0,[],[]];_s_registry3.registerError(exports.SigninServiceException$,SigninServiceException_1.SigninServiceException);var n0_registry3=schema_1.TypeRegistry.for(n0);exports.AccessDeniedException$=[-3,n0,_ADE,{[_e]:_c},[_e,_m],[0,0],2];n0_registry3.registerError(exports.AccessDeniedException$,errors_1.AccessDeniedException);exports.InternalServerException$=[-3,n0,_ISE,{[_e]:_se,[_hE]:500},[_e,_m],[0,0],2];n0_registry3.registerError(exports.InternalServerException$,errors_1.InternalServerException);exports.TooManyRequestsError$=[-3,n0,_TMRE,{[_e]:_c,[_hE]:429},[_e,_m],[0,0],2];n0_registry3.registerError(exports.TooManyRequestsError$,errors_1.TooManyRequestsError);exports.ValidationException$=[-3,n0,_VE,{[_e]:_c,[_hE]:400},[_e,_m],[0,0],2];n0_registry3.registerError(exports.ValidationException$,errors_1.ValidationException);exports.errorTypeRegistries=[_s_registry3,n0_registry3];var RefreshToken=[0,n0,_RT,8,0];exports.AccessToken$=[3,n0,_AT,8,[_aKI,_sAK,_sT],[[0,{[_jN]:_aKI}],[0,{[_jN]:_sAK}],[0,{[_jN]:_sT}]],3];exports.CreateOAuth2TokenRequest$=[3,n0,_COATR,0,[_tI],[[()=>exports.CreateOAuth2TokenRequestBody$,16]],1];exports.CreateOAuth2TokenRequestBody$=[3,n0,_COATRB,0,[_cI,_gT,_co,_rU,_cV,_rT],[[0,{[_jN]:_cI}],[0,{[_jN]:_gT}],0,[0,{[_jN]:_rU}],[0,{[_jN]:_cV}],[()=>RefreshToken,{[_jN]:_rT}]],2];exports.CreateOAuth2TokenResponse$=[3,n0,_COATRr,0,[_tO],[[()=>exports.CreateOAuth2TokenResponseBody$,16]],1];exports.CreateOAuth2TokenResponseBody$=[3,n0,_COATRBr,0,[_aT,_tT,_eI,_rT,_iT],[[()=>exports.AccessToken$,{[_jN]:_aT}],[0,{[_jN]:_tT}],[1,{[_jN]:_eI}],[()=>RefreshToken,{[_jN]:_rT}],[0,{[_jN]:_iT}]],4];exports.CreateOAuth2Token$=[9,n0,_COAT,{[_h]:["POST","/v1/token",200]},()=>exports.CreateOAuth2TokenRequest$,()=>exports.CreateOAuth2TokenResponse$]});var require_runtimeConfig_shared3=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.getRuntimeConfig=void 0;var core_1=require_dist_cjs23(),protocols_1=require_protocols2(),core_2=require_dist_cjs16(),smithy_client_1=require_dist_cjs21(),url_parser_1=require_dist_cjs30(),util_base64_1=require_dist_cjs8(),util_utf8_1=require_dist_cjs7(),httpAuthSchemeProvider_1=require_httpAuthSchemeProvider3(),endpointResolver_1=require_endpointResolver3(),schemas_0_1=require_schemas_03(),getRuntimeConfig3=(config)=>{return{apiVersion:"2023-01-01",base64Decoder:config?.base64Decoder??util_base64_1.fromBase64,base64Encoder:config?.base64Encoder??util_base64_1.toBase64,disableHostPrefix:config?.disableHostPrefix??!1,endpointProvider:config?.endpointProvider??endpointResolver_1.defaultEndpointResolver,extensions:config?.extensions??[],httpAuthSchemeProvider:config?.httpAuthSchemeProvider??httpAuthSchemeProvider_1.defaultSigninHttpAuthSchemeProvider,httpAuthSchemes:config?.httpAuthSchemes??[{schemeId:"aws.auth#sigv4",identityProvider:(ipc)=>ipc.getIdentityProvider("aws.auth#sigv4"),signer:new core_1.AwsSdkSigV4Signer},{schemeId:"smithy.api#noAuth",identityProvider:(ipc)=>ipc.getIdentityProvider("smithy.api#noAuth")||(async()=>({})),signer:new core_2.NoAuthSigner}],logger:config?.logger??new smithy_client_1.NoOpLogger,protocol:config?.protocol??protocols_1.AwsRestJsonProtocol,protocolSettings:config?.protocolSettings??{defaultNamespace:"com.amazonaws.signin",errorTypeRegistries:schemas_0_1.errorTypeRegistries,version:"2023-01-01",serviceTarget:"Signin"},serviceId:config?.serviceId??"Signin",urlParser:config?.urlParser??url_parser_1.parseUrl,utf8Decoder:config?.utf8Decoder??util_utf8_1.fromUtf8,utf8Encoder:config?.utf8Encoder??util_utf8_1.toUtf8}};exports.getRuntimeConfig=getRuntimeConfig3});var require_runtimeConfig3=__commonJS((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0});exports.getRuntimeConfig=void 0;var tslib_1=require_tslib(),package_json_1=tslib_1.__importDefault(require_package2()),core_1=require_dist_cjs23(),util_user_agent_node_1=require_dist_cjs41(),config_resolver_1=require_dist_cjs33(),hash_node_1=require_dist_cjs42(),middleware_retry_1=require_dist_cjs40(),node_config_provider_1=require_dist_cjs36(),node_http_handler_1=require_dist_cjs11(),smithy_client_1=require_dist_cjs21(),util_body_length_node_1=require_dist_cjs43(),util_defaults_mode_node_1=require_dist_cjs44(),util_retry_1=require_dist_cjs39(),runtimeConfig_shared_1=require_runtimeConfig_shared3(),getRuntimeConfig3=(config)=>{(0,smithy_client_1.emitWarningIfUnsupportedVersion)(process.version);let defaultsMode=(0,util_defaults_mode_node_1.resolveDefaultsModeConfig)(config),defaultConfigProvider=()=>defaultsMode().then(smithy_client_1.loadConfigsForDefaultMode),clientSharedValues=(0,runtimeConfig_shared_1.getRuntimeConfig)(config);(0,core_1.emitWarningIfUnsupportedVersion)(process.version);let loaderConfig={profile:config?.profile,logger:clientSharedValues.logger};return{...clientSharedValues,...config,runtime:"node",defaultsMode,authSchemePreference:config?.authSchemePreference??(0,node_config_provider_1.loadConfig)(core_1.NODE_AUTH_SCHEME_PREFERENCE_OPTIONS,loaderConfig),bodyLengthChecker:config?.bodyLengthChecker??util_body_length_node_1.calculateBodyLength,defaultUserAgentProvider:config?.defaultUserAgentProvider??(0,util_user_agent_node_1.createDefaultUserAgentProvider)({serviceId:clientSharedValues.serviceId,clientVersion:package_json_1.default.version}),maxAttempts:config?.maxAttempts??(0,node_config_provider_1.loadConfig)(middleware_retry_1.NODE_MAX_ATTEMPT_CONFIG_OPTIONS,config),region:config?.region??(0,node_config_provider_1.loadConfig)(config_resolver_1.NODE_REGION_CONFIG_OPTIONS,{...config_resolver_1.NODE_REGION_CONFIG_FILE_OPTIONS,...loaderConfig}),requestHandler:node_http_handler_1.NodeHttpHandler.create(config?.requestHandler??defaultConfigProvider),retryMode:config?.retryMode??(0,node_config_provider_1.loadConfig)({...middleware_retry_1.NODE_RETRY_MODE_CONFIG_OPTIONS,default:async()=>(await defaultConfigProvider()).retryMode||util_retry_1.DEFAULT_RETRY_MODE},config),sha256:config?.sha256??hash_node_1.Hash.bind(null,"sha256"),streamCollector:config?.streamCollector??node_http_handler_1.streamCollector,useDualstackEndpoint:config?.useDualstackEndpoint??(0,node_config_provider_1.loadConfig)(config_resolver_1.NODE_USE_DUALSTACK_ENDPOINT_CONFIG_OPTIONS,loaderConfig),useFipsEndpoint:config?.useFipsEndpoint??(0,node_config_provider_1.loadConfig)(config_resolver_1.NODE_USE_FIPS_ENDPOINT_CONFIG_OPTIONS,loaderConfig),userAgentAppId:config?.userAgentAppId??(0,node_config_provider_1.loadConfig)(util_user_agent_node_1.NODE_APP_ID_CONFIG_OPTIONS,loaderConfig)}};exports.getRuntimeConfig=getRuntimeConfig3});var require_signin=__commonJS((exports)=>{var middlewareHostHeader=require_dist_cjs24(),middlewareLogger=require_dist_cjs25(),middlewareRecursionDetection=require_dist_cjs26(),middlewareUserAgent=require_dist_cjs32(),configResolver=require_dist_cjs33(),core2=require_dist_cjs16(),schema=require_schema(),middlewareContentLength=require_dist_cjs34(),middlewareEndpoint=require_dist_cjs37(),middlewareRetry=require_dist_cjs40(),smithyClient=require_dist_cjs21(),httpAuthSchemeProvider=require_httpAuthSchemeProvider3(),runtimeConfig=require_runtimeConfig3(),regionConfigResolver=require_dist_cjs45(),protocolHttp=require_dist_cjs2(),schemas_02=require_schemas_03(),errors3=require_errors3(),SigninServiceException=require_SigninServiceException(),resolveClientEndpointParameters3=(options)=>{return Object.assign(options,{useDualstackEndpoint:options.useDualstackEndpoint??!1,useFipsEndpoint:options.useFipsEndpoint??!1,defaultSigningName:"signin"})},commonParams3={UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}},getHttpAuthExtensionConfiguration2=(runtimeConfig2)=>{let{httpAuthSchemes:_httpAuthSchemes,httpAuthSchemeProvider:_httpAuthSchemeProvider,credentials:_credentials}=runtimeConfig2;return{setHttpAuthScheme(httpAuthScheme){let index2=_httpAuthSchemes.findIndex((scheme)=>scheme.schemeId===httpAuthScheme.schemeId);if(index2===-1)_httpAuthSchemes.push(httpAuthScheme);else _httpAuthSchemes.splice(index2,1,httpAuthScheme)},httpAuthSchemes(){return _httpAuthSchemes},setHttpAuthSchemeProvider(httpAuthSchemeProvider2){_httpAuthSchemeProvider=httpAuthSchemeProvider2},httpAuthSchemeProvider(){return _httpAuthSchemeProvider},setCredentials(credentials){_credentials=credentials},credentials(){return _credentials}}},resolveHttpAuthRuntimeConfig2=(config)=>{return{httpAuthSchemes:config.httpAuthSchemes(),httpAuthSchemeProvider:config.httpAuthSchemeProvider(),credentials:config.credentials()}},resolveRuntimeExtensions2=(runtimeConfig2,extensions2)=>{let extensionConfiguration=Object.assign(regionConfigResolver.getAwsRegionExtensionConfiguration(runtimeConfig2),smithyClient.getDefaultExtensionConfiguration(runtimeConfig2),protocolHttp.getHttpHandlerExtensionConfiguration(runtimeConfig2),getHttpAuthExtensionConfiguration2(runtimeConfig2));return extensions2.forEach((extension)=>extension.configure(extensionConfiguration)),Object.assign(runtimeConfig2,regionConfigResolver.resolveAwsRegionExtensionConfiguration(extensionConfiguration),smithyClient.resolveDefaultRuntimeConfig(extensionConfiguration),protocolHttp.resolveHttpHandlerRuntimeConfig(extensionConfiguration),resolveHttpAuthRuntimeConfig2(extensionConfiguration))};class SigninClient extends smithyClient.Client{config;constructor(...[configuration]){let _config_0=runtimeConfig.getRuntimeConfig(configuration||{});super(_config_0);this.initConfig=_config_0;let _config_1=resolveClientEndpointParameters3(_config_0),_config_2=middlewareUserAgent.resolveUserAgentConfig(_config_1),_config_3=middlewareRetry.resolveRetryConfig(_config_2),_config_4=configResolver.resolveRegionConfig(_config_3),_config_5=middlewareHostHeader.resolveHostHeaderConfig(_config_4),_config_6=middlewareEndpoint.resolveEndpointConfig(_config_5),_config_7=httpAuthSchemeProvider.resolveHttpAuthSchemeConfig(_config_6),_config_8=resolveRuntimeExtensions2(_config_7,configuration?.extensions||[]);this.config=_config_8,this.middlewareStack.use(schema.getSchemaSerdePlugin(this.config)),this.middlewareStack.use(middlewareUserAgent.getUserAgentPlugin(this.config)),this.middlewareStack.use(middlewareRetry.getRetryPlugin(this.config)),this.middlewareStack.use(middlewareContentLength.getContentLengthPlugin(this.config)),this.middlewareStack.use(middlewareHostHeader.getHostHeaderPlugin(this.config)),this.middlewareStack.use(middlewareLogger.getLoggerPlugin(this.config)),this.middlewareStack.use(middlewareRecursionDetection.getRecursionDetectionPlugin(this.config)),this.middlewareStack.use(core2.getHttpAuthSchemeEndpointRuleSetPlugin(this.config,{httpAuthSchemeParametersProvider:httpAuthSchemeProvider.defaultSigninHttpAuthSchemeParametersProvider,identityProviderConfigProvider:async(config)=>new core2.DefaultIdentityProviderConfig({"aws.auth#sigv4":config.credentials})})),this.middlewareStack.use(core2.getHttpSigningPlugin(this.config))}destroy(){super.destroy()}}class CreateOAuth2TokenCommand extends smithyClient.Command.classBuilder().ep(commonParams3).m(function(Command,cs,config,o2){return[middlewareEndpoint.getEndpointPlugin(config,Command.getEndpointParameterInstructions())]}).s("Signin","CreateOAuth2Token",{}).n("SigninClient","CreateOAuth2TokenCommand").sc(schemas_02.CreateOAuth2Token$).build(){}var commands3={CreateOAuth2TokenCommand};class Signin extends SigninClient{}smithyClient.createAggregatedClient(commands3,Signin);var OAuth2ErrorCode={AUTHCODE_EXPIRED:"AUTHCODE_EXPIRED",INSUFFICIENT_PERMISSIONS:"INSUFFICIENT_PERMISSIONS",INVALID_REQUEST:"INVALID_REQUEST",SERVER_ERROR:"server_error",TOKEN_EXPIRED:"TOKEN_EXPIRED",USER_CREDENTIALS_CHANGED:"USER_CREDENTIALS_CHANGED"};Object.defineProperty(exports,"$Command",{enumerable:!0,get:function(){return smithyClient.Command}});Object.defineProperty(exports,"__Client",{enumerable:!0,get:function(){return smithyClient.Client}});Object.defineProperty(exports,"SigninServiceException",{enumerable:!0,get:function(){return SigninServiceException.SigninServiceException}});exports.CreateOAuth2TokenCommand=CreateOAuth2TokenCommand;exports.OAuth2ErrorCode=OAuth2ErrorCode;exports.Signin=Signin;exports.SigninClient=SigninClient;Object.keys(schemas_02).forEach(function(k3){if(k3!=="default"&&!Object.prototype.hasOwnProperty.call(exports,k3))Object.defineProperty(exports,k3,{enumerable:!0,get:function(){return schemas_02[k3]}})});Object.keys(errors3).forEach(function(k3){if(k3!=="default"&&!Object.prototype.hasOwnProperty.call(exports,k3))Object.defineProperty(exports,k3,{enumerable:!0,get:function(){return errors3[k3]}})})});import{createHash,createPrivateKey,createPublicKey,sign}from"crypto";import{promises as fs3}from"fs";import{homedir}from"os";import{dirname,join}from"path";class LoginCredentialsFetcher{profileData;init;callerClientConfig;static REFRESH_THRESHOLD=300000;constructor(profileData,init,callerClientConfig){this.profileData=profileData,this.init=init,this.callerClientConfig=callerClientConfig}async loadCredentials(){let token=await this.loadToken();if(!token)throw new import_property_provider18.CredentialsProviderError(`Failed to load a token for session ${this.loginSession}, please re-authenticate using aws login`,{tryNextLink:!1,logger:this.logger});let accessToken=token.accessToken,now=Date.now();if(new Date(accessToken.expiresAt).getTime()-now<=LoginCredentialsFetcher.REFRESH_THRESHOLD)return this.refresh(token);return{accessKeyId:accessToken.accessKeyId,secretAccessKey:accessToken.secretAccessKey,sessionToken:accessToken.sessionToken,accountId:accessToken.accountId,expiration:new Date(accessToken.expiresAt)}}get logger(){return this.init?.logger}get loginSession(){return this.profileData.login_session}async refresh(token){let{SigninClient,CreateOAuth2TokenCommand}=await Promise.resolve().then(() => __toESM(require_signin(),1)),{logger,userAgentAppId}=this.callerClientConfig??{},requestHandler=((requestHandler2)=>{return requestHandler2?.metadata?.handlerProtocol==="h2"})(this.callerClientConfig?.requestHandler)?void 0:this.callerClientConfig?.requestHandler,region=this.profileData.region??await this.callerClientConfig?.region?.()??process.env.AWS_REGION,client=new SigninClient({credentials:{accessKeyId:"",secretAccessKey:""},region,requestHandler,logger,userAgentAppId,...this.init?.clientConfig});this.createDPoPInterceptor(client.middlewareStack);let commandInput={tokenInput:{clientId:token.clientId,refreshToken:token.refreshToken,grantType:"refresh_token"}};try{let response=await client.send(new CreateOAuth2TokenCommand(commandInput)),{accessKeyId,secretAccessKey,sessionToken}=response.tokenOutput?.accessToken??{},{refreshToken,expiresIn}=response.tokenOutput??{};if(!accessKeyId||!secretAccessKey||!sessionToken||!refreshToken)throw new import_property_provider18.CredentialsProviderError("Token refresh response missing required fields",{logger:this.logger,tryNextLink:!1});let expiresInMs=(expiresIn??900)*1000,expiration=new Date(Date.now()+expiresInMs),updatedToken={...token,accessToken:{...token.accessToken,accessKeyId,secretAccessKey,sessionToken,expiresAt:expiration.toISOString()},refreshToken};await this.saveToken(updatedToken);let newAccessToken=updatedToken.accessToken;return{accessKeyId:newAccessToken.accessKeyId,secretAccessKey:newAccessToken.secretAccessKey,sessionToken:newAccessToken.sessionToken,accountId:newAccessToken.accountId,expiration}}catch(error){if(error.name==="AccessDeniedException"){let errorType=error.error,message;switch(errorType){case"TOKEN_EXPIRED":message="Your session has expired. Please reauthenticate.";break;case"USER_CREDENTIALS_CHANGED":message="Unable to refresh credentials because of a change in your password. Please reauthenticate with your new password.";break;case"INSUFFICIENT_PERMISSIONS":message="Unable to refresh credentials due to insufficient permissions. You may be missing permission for the 'CreateOAuth2Token' action.";break;default:message=`Failed to refresh token: ${String(error)}. Please re-authenticate using \`aws login\``}throw new import_property_provider18.CredentialsProviderError(message,{logger:this.logger,tryNextLink:!1})}throw new import_property_provider18.CredentialsProviderError(`Failed to refresh token: ${String(error)}. Please re-authenticate using aws login`,{logger:this.logger})}}async loadToken(){let tokenFilePath=this.getTokenFilePath();try{let tokenData;try{tokenData=await import_shared_ini_file_loader6.readFile(tokenFilePath,{ignoreCache:this.init?.ignoreCache})}catch{tokenData=await fs3.readFile(tokenFilePath,"utf8")}let token=JSON.parse(tokenData),missingFields=["accessToken","clientId","refreshToken","dpopKey"].filter((k3)=>!token[k3]);if(!token.accessToken?.accountId)missingFields.push("accountId");if(missingFields.length>0)throw new import_property_provider18.CredentialsProviderError(`Token validation failed, missing fields: ${missingFields.join(", ")}`,{logger:this.logger,tryNextLink:!1});return token}catch(error){throw new import_property_provider18.CredentialsProviderError(`Failed to load token from ${tokenFilePath}: ${String(error)}`,{logger:this.logger,tryNextLink:!1})}}async saveToken(token){let tokenFilePath=this.getTokenFilePath(),directory=dirname(tokenFilePath);try{await fs3.mkdir(directory,{recursive:!0})}catch(error){}await fs3.writeFile(tokenFilePath,JSON.stringify(token,null,2),"utf8")}getTokenFilePath(){let directory=process.env.AWS_LOGIN_CACHE_DIRECTORY??join(homedir(),".aws","login","cache"),loginSessionBytes=Buffer.from(this.loginSession,"utf8"),loginSessionSha256=createHash("sha256").update(loginSessionBytes).digest("hex");return join(directory,`${loginSessionSha256}.json`)}derToRawSignature(derSignature){let offset=2;if(derSignature[offset]!==2)throw Error("Invalid DER signature");offset++;let rLength=derSignature[offset++],r3=derSignature.subarray(offset,offset+rLength);if(offset+=rLength,derSignature[offset]!==2)throw Error("Invalid DER signature");offset++;let sLength=derSignature[offset++],s2=derSignature.subarray(offset,offset+sLength);r3=r3[0]===0?r3.subarray(1):r3,s2=s2[0]===0?s2.subarray(1):s2;let rPadded=Buffer.concat([Buffer.alloc(32-r3.length),r3]),sPadded=Buffer.concat([Buffer.alloc(32-s2.length),s2]);return Buffer.concat([rPadded,sPadded])}createDPoPInterceptor(middlewareStack){middlewareStack.add((next)=>async(args)=>{if(import_protocol_http11.HttpRequest.isInstance(args.request)){let request2=args.request,actualEndpoint=`${request2.protocol}//${request2.hostname}${request2.port?`:${request2.port}`:""}${request2.path}`,dpop=await this.generateDpop(request2.method,actualEndpoint);request2.headers={...request2.headers,DPoP:dpop}}return next(args)},{step:"finalizeRequest",name:"dpopInterceptor",override:!0})}async generateDpop(method="POST",endpoint){let token=await this.loadToken();try{let privateKey=createPrivateKey({key:token.dpopKey,format:"pem",type:"sec1"}),publicDer=createPublicKey(privateKey).export({format:"der",type:"spki"}),pointStart=-1;for(let i2=0;i2<publicDer.length;i2++)if(publicDer[i2]===4){pointStart=i2;break}let x=publicDer.slice(pointStart+1,pointStart+33),y=publicDer.slice(pointStart+33,pointStart+65),header={alg:"ES256",typ:"dpop+jwt",jwk:{kty:"EC",crv:"P-256",x:x.toString("base64url"),y:y.toString("base64url")}},payload={jti:crypto.randomUUID(),htm:method,htu:endpoint,iat:Math.floor(Date.now()/1000)},headerB64=Buffer.from(JSON.stringify(header)).toString("base64url"),payloadB64=Buffer.from(JSON.stringify(payload)).toString("base64url"),message=`${headerB64}.${payloadB64}`,asn1Signature=sign("sha256",Buffer.from(message),privateKey),signatureB64=this.derToRawSignature(asn1Signature).toString("base64url");return`${message}.${signatureB64}`}catch(error){throw new import_property_provider18.CredentialsProviderError(`Failed to generate Dpop proof: ${error instanceof Error?error.message:String(error)}`,{logger:this.logger,tryNextLink:!1})}}}var import_property_provider18,import_protocol_http11,import_shared_ini_file_loader6;var init_LoginCredentialsFetcher=__esm(()=>{import_property_provider18=__toESM(require_dist_cjs17(),1),import_protocol_http11=__toESM(require_dist_cjs2(),1),import_shared_ini_file_loader6=__toESM(require_dist_cjs35(),1)});var import_client6,import_property_provider19,import_shared_ini_file_loader7,fromLoginCredentials=(init)=>async({callerClientConfig}={})=>{init?.logger?.debug?.("@aws-sdk/credential-providers - fromLoginCredentials");let profiles=await import_shared_ini_file_loader7.parseKnownFiles(init||{}),profileName=import_shared_ini_file_loader7.getProfileName({profile:init?.profile??callerClientConfig?.profile}),profile=profiles[profileName];if(!profile?.login_session)throw new import_property_provider19.CredentialsProviderError(`Profile ${profileName} does not contain login_session.`,{tryNextLink:!0,logger:init?.logger});let credentials=await new LoginCredentialsFetcher(profile,init,callerClientConfig).loadCredentials();return import_client6.setCredentialFeature(credentials,"CREDENTIALS_LOGIN","AD")};var init_fromLoginCredentials=__esm(()=>{init_LoginCredentialsFetcher();import_client6=__toESM(require_client(),1),import_property_provider19=__toESM(require_dist_cjs17(),1),import_shared_ini_file_loader7=__toESM(require_dist_cjs35(),1)});var init_types3=()=>{};var init_dist_es7=__esm(()=>{init_fromLoginCredentials();init_types3()});var import_client7,isLoginProfile=(data)=>{return Boolean(data&&data.login_session)},resolveLoginCredentials=async(profileName,options,callerClientConfig)=>{let credentials=await fromLoginCredentials({...options,profile:profileName})({callerClientConfig});return import_client7.setCredentialFeature(credentials,"CREDENTIALS_PROFILE_LOGIN","AC")};var init_resolveLoginCredentials=__esm(()=>{init_dist_es7();import_client7=__toESM(require_client(),1)});var import_client8,getValidatedProcessCredentials=(profileName,data,profiles)=>{if(data.Version!==1)throw Error(`Profile ${profileName} credential_process did not return Version 1.`);if(data.AccessKeyId===void 0||data.SecretAccessKey===void 0)throw Error(`Profile ${profileName} credential_process returned invalid credentials.`);if(data.Expiration){let currentTime=new Date;if(new Date(data.Expiration)<currentTime)throw Error(`Profile ${profileName} credential_process returned expired credentials.`)}let accountId=data.AccountId;if(!accountId&&profiles?.[profileName]?.aws_account_id)accountId=profiles[profileName].aws_account_id;let credentials={accessKeyId:data.AccessKeyId,secretAccessKey:data.SecretAccessKey,...data.SessionToken&&{sessionToken:data.SessionToken},...data.Expiration&&{expiration:new Date(data.Expiration)},...data.CredentialScope&&{credentialScope:data.CredentialScope},...accountId&&{accountId}};return import_client8.setCredentialFeature(credentials,"CREDENTIALS_PROCESS","w"),credentials};var init_getValidatedProcessCredentials=__esm(()=>{import_client8=__toESM(require_client(),1)});import{exec}from"child_process";import{promisify}from"util";var import_property_provider20,import_shared_ini_file_loader8,resolveProcessCredentials=async(profileName,profiles,logger)=>{let profile=profiles[profileName];if(profiles[profileName]){let credentialProcess=profile.credential_process;if(credentialProcess!==void 0){let execPromise=promisify(import_shared_ini_file_loader8.externalDataInterceptor?.getTokenRecord?.().exec??exec);try{let{stdout}=await execPromise(credentialProcess),data;try{data=JSON.parse(stdout.trim())}catch{throw Error(`Profile ${profileName} credential_process returned invalid JSON.`)}return getValidatedProcessCredentials(profileName,data,profiles)}catch(error){throw new import_property_provider20.CredentialsProviderError(error.message,{logger})}}else throw new import_property_provider20.CredentialsProviderError(`Profile ${profileName} did not contain credential_process.`,{logger})}else throw new import_property_provider20.CredentialsProviderError(`Profile ${profileName} could not be found in shared credentials file.`,{logger})};var init_resolveProcessCredentials=__esm(()=>{init_getValidatedProcessCredentials();import_property_provider20=__toESM(require_dist_cjs17(),1),import_shared_ini_file_loader8=__toESM(require_dist_cjs35(),1)});var import_shared_ini_file_loader9,fromProcess=(init={})=>async({callerClientConfig}={})=>{init.logger?.debug("@aws-sdk/credential-provider-process - fromProcess");let profiles=await import_shared_ini_file_loader9.parseKnownFiles(init);return resolveProcessCredentials(import_shared_ini_file_loader9.getProfileName({profile:init.profile??callerClientConfig?.profile}),profiles,init.logger)};var init_fromProcess=__esm(()=>{init_resolveProcessCredentials();import_shared_ini_file_loader9=__toESM(require_dist_cjs35(),1)});var exports_dist_es5={};__export(exports_dist_es5,{fromProcess:()=>fromProcess});var init_dist_es8=__esm(()=>{init_fromProcess()});var import_client9,isProcessProfile=(arg)=>Boolean(arg)&&typeof arg==="object"&&typeof arg.credential_process==="string",resolveProcessCredentials2=async(options,profile)=>Promise.resolve().then(() => (init_dist_es8(),exports_dist_es5)).then(({fromProcess:fromProcess3})=>fromProcess3({...options,profile})().then((creds)=>import_client9.setCredentialFeature(creds,"CREDENTIALS_PROFILE_PROCESS","v")));var init_resolveProcessCredentials2=__esm(()=>{import_client9=__toESM(require_client(),1)});var import_client10,resolveSsoCredentials=async(profile,profileData,options={},callerClientConfig)=>{let{fromSSO:fromSSO3}=await Promise.resolve().then(() => (init_dist_es6(),exports_dist_es4));return fromSSO3({profile,logger:options.logger,parentClientConfig:options.parentClientConfig,clientConfig:options.clientConfig})({callerClientConfig}).then((creds)=>{if(profileData.sso_session)return import_client10.setCredentialFeature(creds,"CREDENTIALS_PROFILE_SSO","r");else return import_client10.setCredentialFeature(creds,"CREDENTIALS_PROFILE_SSO_LEGACY","t")})},isSsoProfile3=(arg)=>arg&&(typeof arg.sso_start_url==="string"||typeof arg.sso_account_id==="string"||typeof arg.sso_session==="string"||typeof arg.sso_region==="string"||typeof arg.sso_role_name==="string");var init_resolveSsoCredentials=__esm(()=>{import_client10=__toESM(require_client(),1)});var import_client11,isStaticCredsProfile=(arg)=>Boolean(arg)&&typeof arg==="object"&&typeof arg.aws_access_key_id==="string"&&typeof arg.aws_secret_access_key==="string"&&["undefined","string"].indexOf(typeof arg.aws_session_token)>-1&&["undefined","string"].indexOf(typeof arg.aws_account_id)>-1,resolveStaticCredentials=async(profile,options)=>{options?.logger?.debug("@aws-sdk/credential-provider-ini - resolveStaticCredentials");let credentials={accessKeyId:profile.aws_access_key_id,secretAccessKey:profile.aws_secret_access_key,sessionToken:profile.aws_session_token,...profile.aws_credential_scope&&{credentialScope:profile.aws_credential_scope},...profile.aws_account_id&&{accountId:profile.aws_account_id}};return import_client11.setCredentialFeature(credentials,"CREDENTIALS_PROFILE","n")};var init_resolveStaticCredentials=__esm(()=>{import_client11=__toESM(require_client(),1)});var fromWebToken=(init)=>async(awsIdentityProperties)=>{init.logger?.debug("@aws-sdk/credential-provider-web-identity - fromWebToken");let{roleArn,roleSessionName,webIdentityToken,providerId,policyArns,policy,durationSeconds}=init,{roleAssumerWithWebIdentity}=init;if(!roleAssumerWithWebIdentity){let{getDefaultRoleAssumerWithWebIdentity}=await Promise.resolve().then(() => __toESM(require_sts(),1));roleAssumerWithWebIdentity=getDefaultRoleAssumerWithWebIdentity({...init.clientConfig,credentialProviderLogger:init.logger,parentClientConfig:{...awsIdentityProperties?.callerClientConfig,...init.parentClientConfig}},init.clientPlugins)}return roleAssumerWithWebIdentity({RoleArn:roleArn,RoleSessionName:roleSessionName??`aws-sdk-js-session-${Date.now()}`,WebIdentityToken:webIdentityToken,ProviderId:providerId,PolicyArns:policyArns,Policy:policy,DurationSeconds:durationSeconds})};import{readFileSync}from"fs";var import_client12,import_property_provider21,import_shared_ini_file_loader10,ENV_TOKEN_FILE="AWS_WEB_IDENTITY_TOKEN_FILE",ENV_ROLE_ARN="AWS_ROLE_ARN",ENV_ROLE_SESSION_NAME="AWS_ROLE_SESSION_NAME",fromTokenFile=(init={})=>async(awsIdentityProperties)=>{init.logger?.debug("@aws-sdk/credential-provider-web-identity - fromTokenFile");let webIdentityTokenFile=init?.webIdentityTokenFile??process.env[ENV_TOKEN_FILE],roleArn=init?.roleArn??process.env[ENV_ROLE_ARN],roleSessionName=init?.roleSessionName??process.env[ENV_ROLE_SESSION_NAME];if(!webIdentityTokenFile||!roleArn)throw new import_property_provider21.CredentialsProviderError("Web identity configuration not specified",{logger:init.logger});let credentials=await fromWebToken({...init,webIdentityToken:import_shared_ini_file_loader10.externalDataInterceptor?.getTokenRecord?.()[webIdentityTokenFile]??readFileSync(webIdentityTokenFile,{encoding:"ascii"}),roleArn,roleSessionName})(awsIdentityProperties);if(webIdentityTokenFile===process.env[ENV_TOKEN_FILE])import_client12.setCredentialFeature(credentials,"CREDENTIALS_ENV_VARS_STS_WEB_ID_TOKEN","h");return credentials};var init_fromTokenFile=__esm(()=>{import_client12=__toESM(require_client(),1),import_property_provider21=__toESM(require_dist_cjs17(),1),import_shared_ini_file_loader10=__toESM(require_dist_cjs35(),1)});var exports_dist_es6={};__export(exports_dist_es6,{fromWebToken:()=>fromWebToken,fromTokenFile:()=>fromTokenFile});var init_dist_es9=__esm(()=>{init_fromTokenFile()});var import_client13,isWebIdentityProfile=(arg)=>Boolean(arg)&&typeof arg==="object"&&typeof arg.web_identity_token_file==="string"&&typeof arg.role_arn==="string"&&["undefined","string"].indexOf(typeof arg.role_session_name)>-1,resolveWebIdentityCredentials=async(profile,options,callerClientConfig)=>Promise.resolve().then(() => (init_dist_es9(),exports_dist_es6)).then(({fromTokenFile:fromTokenFile3})=>fromTokenFile3({webIdentityTokenFile:profile.web_identity_token_file,roleArn:profile.role_arn,roleSessionName:profile.role_session_name,roleAssumerWithWebIdentity:options.roleAssumerWithWebIdentity,logger:options.logger,parentClientConfig:options.parentClientConfig})({callerClientConfig}).then((creds)=>import_client13.setCredentialFeature(creds,"CREDENTIALS_PROFILE_STS_WEB_ID_TOKEN","q")));var init_resolveWebIdentityCredentials=__esm(()=>{import_client13=__toESM(require_client(),1)});var import_property_provider22,resolveProfileData=async(profileName,profiles,options,callerClientConfig,visitedProfiles={},isAssumeRoleRecursiveCall=!1)=>{let data=profiles[profileName];if(Object.keys(visitedProfiles).length>0&&isStaticCredsProfile(data))return resolveStaticCredentials(data,options);if(isAssumeRoleRecursiveCall||isAssumeRoleProfile(data,{profile:profileName,logger:options.logger}))return resolveAssumeRoleCredentials(profileName,profiles,options,callerClientConfig,visitedProfiles,resolveProfileData);if(isStaticCredsProfile(data))return resolveStaticCredentials(data,options);if(isWebIdentityProfile(data))return resolveWebIdentityCredentials(data,options,callerClientConfig);if(isProcessProfile(data))return resolveProcessCredentials2(options,profileName);if(isSsoProfile3(data))return await resolveSsoCredentials(profileName,data,options,callerClientConfig);if(isLoginProfile(data))return resolveLoginCredentials(profileName,options,callerClientConfig);throw new import_property_provider22.CredentialsProviderError(`Could not resolve credentials using profile: [${profileName}] in configuration/credentials file(s).`,{logger:options.logger})};var init_resolveProfileData=__esm(()=>{init_resolveAssumeRoleCredentials();init_resolveLoginCredentials();init_resolveProcessCredentials2();init_resolveSsoCredentials();init_resolveStaticCredentials();init_resolveWebIdentityCredentials();import_property_provider22=__toESM(require_dist_cjs17(),1)});var import_shared_ini_file_loader11,fromIni=(init={})=>async({callerClientConfig}={})=>{init.logger?.debug("@aws-sdk/credential-provider-ini - fromIni");let profiles=await import_shared_ini_file_loader11.parseKnownFiles(init);return resolveProfileData(import_shared_ini_file_loader11.getProfileName({profile:init.profile??callerClientConfig?.profile}),profiles,init,callerClientConfig)};var init_fromIni=__esm(()=>{init_resolveProfileData();import_shared_ini_file_loader11=__toESM(require_dist_cjs35(),1)});var exports_dist_es7={};__export(exports_dist_es7,{fromIni:()=>fromIni});var init_dist_es10=__esm(()=>{init_fromIni()});var exports_value={};__export(exports_value,{IsUndefined:()=>IsUndefined,IsUint8Array:()=>IsUint8Array,IsSymbol:()=>IsSymbol,IsString:()=>IsString,IsRegExp:()=>IsRegExp,IsObject:()=>IsObject,IsNumber:()=>IsNumber,IsNull:()=>IsNull,IsIterator:()=>IsIterator,IsFunction:()=>IsFunction,IsDate:()=>IsDate,IsBoolean:()=>IsBoolean,IsBigInt:()=>IsBigInt,IsAsyncIterator:()=>IsAsyncIterator,IsArray:()=>IsArray,HasPropertyKey:()=>HasPropertyKey});function HasPropertyKey(value,key){return key in value}function IsAsyncIterator(value){return IsObject(value)&&!IsArray(value)&&!IsUint8Array(value)&&Symbol.asyncIterator in value}function IsArray(value){return Array.isArray(value)}function IsBigInt(value){return typeof value==="bigint"}function IsBoolean(value){return typeof value==="boolean"}function IsDate(value){return value instanceof globalThis.Date}function IsFunction(value){return typeof value==="function"}function IsIterator(value){return IsObject(value)&&!IsArray(value)&&!IsUint8Array(value)&&Symbol.iterator in value}function IsNull(value){return value===null}function IsNumber(value){return typeof value==="number"}function IsObject(value){return typeof value==="object"&&value!==null}function IsRegExp(value){return value instanceof globalThis.RegExp}function IsString(value){return typeof value==="string"}function IsSymbol(value){return typeof value==="symbol"}function IsUint8Array(value){return value instanceof globalThis.Uint8Array}function IsUndefined(value){return value===void 0}function ArrayType(value){return value.map((value2)=>Visit(value2))}function DateType(value){return new Date(value.getTime())}function Uint8ArrayType(value){return new Uint8Array(value)}function RegExpType(value){return new RegExp(value.source,value.flags)}function ObjectType(value){let result={};for(let key of Object.getOwnPropertyNames(value))result[key]=Visit(value[key]);for(let key of Object.getOwnPropertySymbols(value))result[key]=Visit(value[key]);return result}function Visit(value){return IsArray(value)?ArrayType(value):IsDate(value)?DateType(value):IsUint8Array(value)?Uint8ArrayType(value):IsRegExp(value)?RegExpType(value):IsObject(value)?ObjectType(value):value}function Clone(value){return Visit(value)}function CloneType(schema,options){return options===void 0?Clone(schema):Clone({...options,...schema})}function IsAsyncIterator2(value){return IsObject2(value)&&globalThis.Symbol.asyncIterator in value}function IsIterator2(value){return IsObject2(value)&&globalThis.Symbol.iterator in value}function IsStandardObject(value){return IsObject2(value)&&(globalThis.Object.getPrototypeOf(value)===Object.prototype||globalThis.Object.getPrototypeOf(value)===null)}function IsPromise(value){return value instanceof globalThis.Promise}function IsDate2(value){return value instanceof Date&&globalThis.Number.isFinite(value.getTime())}function IsMap(value){return value instanceof globalThis.Map}function IsSet(value){return value instanceof globalThis.Set}function IsTypedArray(value){return globalThis.ArrayBuffer.isView(value)}function IsUint8Array2(value){return value instanceof globalThis.Uint8Array}function HasPropertyKey2(value,key){return key in value}function IsObject2(value){return value!==null&&typeof value==="object"}function IsArray2(value){return globalThis.Array.isArray(value)&&!globalThis.ArrayBuffer.isView(value)}function IsUndefined2(value){return value===void 0}function IsNull2(value){return value===null}function IsBoolean2(value){return typeof value==="boolean"}function IsNumber2(value){return typeof value==="number"}function IsInteger(value){return globalThis.Number.isInteger(value)}function IsBigInt2(value){return typeof value==="bigint"}function IsString2(value){return typeof value==="string"}function IsFunction2(value){return typeof value==="function"}function IsSymbol2(value){return typeof value==="symbol"}function IsValueType(value){return IsBigInt2(value)||IsBoolean2(value)||IsNull2(value)||IsNumber2(value)||IsString2(value)||IsSymbol2(value)||IsUndefined2(value)}var TypeSystemPolicy;(function(TypeSystemPolicy2){TypeSystemPolicy2.InstanceMode="default",TypeSystemPolicy2.ExactOptionalPropertyTypes=!1,TypeSystemPolicy2.AllowArrayObject=!1,TypeSystemPolicy2.AllowNaN=!1,TypeSystemPolicy2.AllowNullVoid=!1;function IsExactOptionalProperty(value,key){return TypeSystemPolicy2.ExactOptionalPropertyTypes?key in value:value[key]!==void 0}TypeSystemPolicy2.IsExactOptionalProperty=IsExactOptionalProperty;function IsObjectLike(value){let isObject=IsObject2(value);return TypeSystemPolicy2.AllowArrayObject?isObject:isObject&&!IsArray2(value)}TypeSystemPolicy2.IsObjectLike=IsObjectLike;function IsRecordLike(value){return IsObjectLike(value)&&!(value instanceof Date)&&!(value instanceof Uint8Array)}TypeSystemPolicy2.IsRecordLike=IsRecordLike;function IsNumberLike(value){return TypeSystemPolicy2.AllowNaN?IsNumber2(value):Number.isFinite(value)}TypeSystemPolicy2.IsNumberLike=IsNumberLike;function IsVoidLike(value){let isUndefined=IsUndefined2(value);return TypeSystemPolicy2.AllowNullVoid?isUndefined||value===null:isUndefined}TypeSystemPolicy2.IsVoidLike=IsVoidLike})(TypeSystemPolicy||(TypeSystemPolicy={}));function ImmutableArray(value){return globalThis.Object.freeze(value).map((value2)=>Immutable(value2))}function ImmutableDate(value){return value}function ImmutableUint8Array(value){return value}function ImmutableRegExp(value){return value}function ImmutableObject(value){let result={};for(let key of Object.getOwnPropertyNames(value))result[key]=Immutable(value[key]);for(let key of Object.getOwnPropertySymbols(value))result[key]=Immutable(value[key]);return globalThis.Object.freeze(result)}function Immutable(value){return IsArray(value)?ImmutableArray(value):IsDate(value)?ImmutableDate(value):IsUint8Array(value)?ImmutableUint8Array(value):IsRegExp(value)?ImmutableRegExp(value):IsObject(value)?ImmutableObject(value):value}function CreateType(schema,options){let result=options!==void 0?{...options,...schema}:schema;switch(TypeSystemPolicy.InstanceMode){case"freeze":return Immutable(result);case"clone":return Clone(result);default:return result}}class TypeBoxError extends Error{constructor(message){super(message)}}var TransformKind=Symbol.for("TypeBox.Transform"),ReadonlyKind=Symbol.for("TypeBox.Readonly"),OptionalKind=Symbol.for("TypeBox.Optional"),Hint=Symbol.for("TypeBox.Hint"),Kind=Symbol.for("TypeBox.Kind");function IsReadonly(value){return IsObject(value)&&value[ReadonlyKind]==="Readonly"}function IsOptional(value){return IsObject(value)&&value[OptionalKind]==="Optional"}function IsAny(value){return IsKindOf(value,"Any")}function IsArgument(value){return IsKindOf(value,"Argument")}function IsArray3(value){return IsKindOf(value,"Array")}function IsAsyncIterator3(value){return IsKindOf(value,"AsyncIterator")}function IsBigInt3(value){return IsKindOf(value,"BigInt")}function IsBoolean3(value){return IsKindOf(value,"Boolean")}function IsComputed(value){return IsKindOf(value,"Computed")}function IsConstructor(value){return IsKindOf(value,"Constructor")}function IsDate3(value){return IsKindOf(value,"Date")}function IsFunction3(value){return IsKindOf(value,"Function")}function IsInteger2(value){return IsKindOf(value,"Integer")}function IsIntersect(value){return IsKindOf(value,"Intersect")}function IsIterator3(value){return IsKindOf(value,"Iterator")}function IsKindOf(value,kind){return IsObject(value)&&Kind in value&&value[Kind]===kind}function IsLiteralValue(value){return IsBoolean(value)||IsNumber(value)||IsString(value)}function IsLiteral(value){return IsKindOf(value,"Literal")}function IsMappedKey(value){return IsKindOf(value,"MappedKey")}function IsMappedResult(value){return IsKindOf(value,"MappedResult")}function IsNever(value){return IsKindOf(value,"Never")}function IsNot(value){return IsKindOf(value,"Not")}function IsNull3(value){return IsKindOf(value,"Null")}function IsNumber3(value){return IsKindOf(value,"Number")}function IsObject3(value){return IsKindOf(value,"Object")}function IsPromise2(value){return IsKindOf(value,"Promise")}function IsRecord(value){return IsKindOf(value,"Record")}function IsRef(value){return IsKindOf(value,"Ref")}function IsRegExp2(value){return IsKindOf(value,"RegExp")}function IsString3(value){return IsKindOf(value,"String")}function IsSymbol3(value){return IsKindOf(value,"Symbol")}function IsTemplateLiteral(value){return IsKindOf(value,"TemplateLiteral")}function IsThis(value){return IsKindOf(value,"This")}function IsTransform(value){return IsObject(value)&&TransformKind in value}function IsTuple(value){return IsKindOf(value,"Tuple")}function IsUndefined3(value){return IsKindOf(value,"Undefined")}function IsUnion(value){return IsKindOf(value,"Union")}function IsUint8Array3(value){return IsKindOf(value,"Uint8Array")}function IsUnknown(value){return IsKindOf(value,"Unknown")}function IsUnsafe(value){return IsKindOf(value,"Unsafe")}function IsVoid(value){return IsKindOf(value,"Void")}function IsKind(value){return IsObject(value)&&Kind in value&&IsString(value[Kind])}function IsSchema(value){return IsAny(value)||IsArgument(value)||IsArray3(value)||IsBoolean3(value)||IsBigInt3(value)||IsAsyncIterator3(value)||IsComputed(value)||IsConstructor(value)||IsDate3(value)||IsFunction3(value)||IsInteger2(value)||IsIntersect(value)||IsIterator3(value)||IsLiteral(value)||IsMappedKey(value)||IsMappedResult(value)||IsNever(value)||IsNot(value)||IsNull3(value)||IsNumber3(value)||IsObject3(value)||IsPromise2(value)||IsRecord(value)||IsRef(value)||IsRegExp2(value)||IsString3(value)||IsSymbol3(value)||IsTemplateLiteral(value)||IsThis(value)||IsTuple(value)||IsUndefined3(value)||IsUnion(value)||IsUint8Array3(value)||IsUnknown(value)||IsUnsafe(value)||IsVoid(value)||IsKind(value)}var exports_type={};__export(exports_type,{TypeGuardUnknownTypeError:()=>TypeGuardUnknownTypeError,IsVoid:()=>IsVoid2,IsUnsafe:()=>IsUnsafe2,IsUnknown:()=>IsUnknown2,IsUnionLiteral:()=>IsUnionLiteral,IsUnion:()=>IsUnion2,IsUndefined:()=>IsUndefined4,IsUint8Array:()=>IsUint8Array4,IsTuple:()=>IsTuple2,IsTransform:()=>IsTransform2,IsThis:()=>IsThis2,IsTemplateLiteral:()=>IsTemplateLiteral2,IsSymbol:()=>IsSymbol4,IsString:()=>IsString4,IsSchema:()=>IsSchema2,IsRegExp:()=>IsRegExp3,IsRef:()=>IsRef2,IsRecursive:()=>IsRecursive,IsRecord:()=>IsRecord2,IsReadonly:()=>IsReadonly2,IsProperties:()=>IsProperties,IsPromise:()=>IsPromise3,IsOptional:()=>IsOptional2,IsObject:()=>IsObject4,IsNumber:()=>IsNumber4,IsNull:()=>IsNull4,IsNot:()=>IsNot2,IsNever:()=>IsNever2,IsMappedResult:()=>IsMappedResult2,IsMappedKey:()=>IsMappedKey2,IsLiteralValue:()=>IsLiteralValue2,IsLiteralString:()=>IsLiteralString,IsLiteralNumber:()=>IsLiteralNumber,IsLiteralBoolean:()=>IsLiteralBoolean,IsLiteral:()=>IsLiteral2,IsKindOf:()=>IsKindOf2,IsKind:()=>IsKind2,IsIterator:()=>IsIterator4,IsIntersect:()=>IsIntersect2,IsInteger:()=>IsInteger3,IsImport:()=>IsImport,IsFunction:()=>IsFunction4,IsDate:()=>IsDate4,IsConstructor:()=>IsConstructor2,IsComputed:()=>IsComputed2,IsBoolean:()=>IsBoolean4,IsBigInt:()=>IsBigInt4,IsAsyncIterator:()=>IsAsyncIterator4,IsArray:()=>IsArray4,IsArgument:()=>IsArgument2,IsAny:()=>IsAny2});class TypeGuardUnknownTypeError extends TypeBoxError{}var KnownTypes=["Argument","Any","Array","AsyncIterator","BigInt","Boolean","Computed","Constructor","Date","Enum","Function","Integer","Intersect","Iterator","Literal","MappedKey","MappedResult","Not","Null","Number","Object","Promise","Record","Ref","RegExp","String","Symbol","TemplateLiteral","This","Tuple","Undefined","Union","Uint8Array","Unknown","Void"];function IsPattern(value){try{return new RegExp(value),!0}catch{return!1}}function IsControlCharacterFree(value){if(!IsString(value))return!1;for(let i=0;i<value.length;i++){let code=value.charCodeAt(i);if(code>=7&&code<=13||code===27||code===127)return!1}return!0}function IsAdditionalProperties(value){return IsOptionalBoolean(value)||IsSchema2(value)}function IsOptionalBigInt(value){return IsUndefined(value)||IsBigInt(value)}function IsOptionalNumber(value){return IsUndefined(value)||IsNumber(value)}function IsOptionalBoolean(value){return IsUndefined(value)||IsBoolean(value)}function IsOptionalString(value){return IsUndefined(value)||IsString(value)}function IsOptionalPattern(value){return IsUndefined(value)||IsString(value)&&IsControlCharacterFree(value)&&IsPattern(value)}function IsOptionalFormat(value){return IsUndefined(value)||IsString(value)&&IsControlCharacterFree(value)}function IsOptionalSchema(value){return IsUndefined(value)||IsSchema2(value)}function IsReadonly2(value){return IsObject(value)&&value[ReadonlyKind]==="Readonly"}function IsOptional2(value){return IsObject(value)&&value[OptionalKind]==="Optional"}function IsAny2(value){return IsKindOf2(value,"Any")&&IsOptionalString(value.$id)}function IsArgument2(value){return IsKindOf2(value,"Argument")&&IsNumber(value.index)}function IsArray4(value){return IsKindOf2(value,"Array")&&value.type==="array"&&IsOptionalString(value.$id)&&IsSchema2(value.items)&&IsOptionalNumber(value.minItems)&&IsOptionalNumber(value.maxItems)&&IsOptionalBoolean(value.uniqueItems)&&IsOptionalSchema(value.contains)&&IsOptionalNumber(value.minContains)&&IsOptionalNumber(value.maxContains)}function IsAsyncIterator4(value){return IsKindOf2(value,"AsyncIterator")&&value.type==="AsyncIterator"&&IsOptionalString(value.$id)&&IsSchema2(value.items)}function IsBigInt4(value){return IsKindOf2(value,"BigInt")&&value.type==="bigint"&&IsOptionalString(value.$id)&&IsOptionalBigInt(value.exclusiveMaximum)&&IsOptionalBigInt(value.exclusiveMinimum)&&IsOptionalBigInt(value.maximum)&&IsOptionalBigInt(value.minimum)&&IsOptionalBigInt(value.multipleOf)}function IsBoolean4(value){return IsKindOf2(value,"Boolean")&&value.type==="boolean"&&IsOptionalString(value.$id)}function IsComputed2(value){return IsKindOf2(value,"Computed")&&IsString(value.target)&&IsArray(value.parameters)&&value.parameters.every((schema)=>IsSchema2(schema))}function IsConstructor2(value){return IsKindOf2(value,"Constructor")&&value.type==="Constructor"&&IsOptionalString(value.$id)&&IsArray(value.parameters)&&value.parameters.every((schema)=>IsSchema2(schema))&&IsSchema2(value.returns)}function IsDate4(value){return IsKindOf2(value,"Date")&&value.type==="Date"&&IsOptionalString(value.$id)&&IsOptionalNumber(value.exclusiveMaximumTimestamp)&&IsOptionalNumber(value.exclusiveMinimumTimestamp)&&IsOptionalNumber(value.maximumTimestamp)&&IsOptionalNumber(value.minimumTimestamp)&&IsOptionalNumber(value.multipleOfTimestamp)}function IsFunction4(value){return IsKindOf2(value,"Function")&&value.type==="Function"&&IsOptionalString(value.$id)&&IsArray(value.parameters)&&value.parameters.every((schema)=>IsSchema2(schema))&&IsSchema2(value.returns)}function IsImport(value){return IsKindOf2(value,"Import")&&HasPropertyKey(value,"$defs")&&IsObject(value.$defs)&&IsProperties(value.$defs)&&HasPropertyKey(value,"$ref")&&IsString(value.$ref)&&value.$ref in value.$defs}function IsInteger3(value){return IsKindOf2(value,"Integer")&&value.type==="integer"&&IsOptionalString(value.$id)&&IsOptionalNumber(value.exclusiveMaximum)&&IsOptionalNumber(value.exclusiveMinimum)&&IsOptionalNumber(value.maximum)&&IsOptionalNumber(value.minimum)&&IsOptionalNumber(value.multipleOf)}function IsProperties(value){return IsObject(value)&&Object.entries(value).every(([key,schema])=>IsControlCharacterFree(key)&&IsSchema2(schema))}function IsIntersect2(value){return IsKindOf2(value,"Intersect")&&(IsString(value.type)&&value.type!=="object"?!1:!0)&&IsArray(value.allOf)&&value.allOf.every((schema)=>IsSchema2(schema)&&!IsTransform2(schema))&&IsOptionalString(value.type)&&(IsOptionalBoolean(value.unevaluatedProperties)||IsOptionalSchema(value.unevaluatedProperties))&&IsOptionalString(value.$id)}function IsIterator4(value){return IsKindOf2(value,"Iterator")&&value.type==="Iterator"&&IsOptionalString(value.$id)&&IsSchema2(value.items)}function IsKindOf2(value,kind){return IsObject(value)&&Kind in value&&value[Kind]===kind}function IsLiteralString(value){return IsLiteral2(value)&&IsString(value.const)}function IsLiteralNumber(value){return IsLiteral2(value)&&IsNumber(value.const)}function IsLiteralBoolean(value){return IsLiteral2(value)&&IsBoolean(value.const)}function IsLiteral2(value){return IsKindOf2(value,"Literal")&&IsOptionalString(value.$id)&&IsLiteralValue2(value.const)}function IsLiteralValue2(value){return IsBoolean(value)||IsNumber(value)||IsString(value)}function IsMappedKey2(value){return IsKindOf2(value,"MappedKey")&&IsArray(value.keys)&&value.keys.every((key)=>IsNumber(key)||IsString(key))}function IsMappedResult2(value){return IsKindOf2(value,"MappedResult")&&IsProperties(value.properties)}function IsNever2(value){return IsKindOf2(value,"Never")&&IsObject(value.not)&&Object.getOwnPropertyNames(value.not).length===0}function IsNot2(value){return IsKindOf2(value,"Not")&&IsSchema2(value.not)}function IsNull4(value){return IsKindOf2(value,"Null")&&value.type==="null"&&IsOptionalString(value.$id)}function IsNumber4(value){return IsKindOf2(value,"Number")&&value.type==="number"&&IsOptionalString(value.$id)&&IsOptionalNumber(value.exclusiveMaximum)&&IsOptionalNumber(value.exclusiveMinimum)&&IsOptionalNumber(value.maximum)&&IsOptionalNumber(value.minimum)&&IsOptionalNumber(value.multipleOf)}function IsObject4(value){return IsKindOf2(value,"Object")&&value.type==="object"&&IsOptionalString(value.$id)&&IsProperties(value.properties)&&IsAdditionalProperties(value.additionalProperties)&&IsOptionalNumber(value.minProperties)&&IsOptionalNumber(value.maxProperties)}function IsPromise3(value){return IsKindOf2(value,"Promise")&&value.type==="Promise"&&IsOptionalString(value.$id)&&IsSchema2(value.item)}function IsRecord2(value){return IsKindOf2(value,"Record")&&value.type==="object"&&IsOptionalString(value.$id)&&IsAdditionalProperties(value.additionalProperties)&&IsObject(value.patternProperties)&&((schema)=>{let keys=Object.getOwnPropertyNames(schema.patternProperties);return keys.length===1&&IsPattern(keys[0])&&IsObject(schema.patternProperties)&&IsSchema2(schema.patternProperties[keys[0]])})(value)}function IsRecursive(value){return IsObject(value)&&Hint in value&&value[Hint]==="Recursive"}function IsRef2(value){return IsKindOf2(value,"Ref")&&IsOptionalString(value.$id)&&IsString(value.$ref)}function IsRegExp3(value){return IsKindOf2(value,"RegExp")&&IsOptionalString(value.$id)&&IsString(value.source)&&IsString(value.flags)&&IsOptionalNumber(value.maxLength)&&IsOptionalNumber(value.minLength)}function IsString4(value){return IsKindOf2(value,"String")&&value.type==="string"&&IsOptionalString(value.$id)&&IsOptionalNumber(value.minLength)&&IsOptionalNumber(value.maxLength)&&IsOptionalPattern(value.pattern)&&IsOptionalFormat(value.format)}function IsSymbol4(value){return IsKindOf2(value,"Symbol")&&value.type==="symbol"&&IsOptionalString(value.$id)}function IsTemplateLiteral2(value){return IsKindOf2(value,"TemplateLiteral")&&value.type==="string"&&IsString(value.pattern)&&value.pattern[0]==="^"&&value.pattern[value.pattern.length-1]==="$"}function IsThis2(value){return IsKindOf2(value,"This")&&IsOptionalString(value.$id)&&IsString(value.$ref)}function IsTransform2(value){return IsObject(value)&&TransformKind in value}function IsTuple2(value){return IsKindOf2(value,"Tuple")&&value.type==="array"&&IsOptionalString(value.$id)&&IsNumber(value.minItems)&&IsNumber(value.maxItems)&&value.minItems===value.maxItems&&(IsUndefined(value.items)&&IsUndefined(value.additionalItems)&&value.minItems===0||IsArray(value.items)&&value.items.every((schema)=>IsSchema2(schema)))}function IsUndefined4(value){return IsKindOf2(value,"Undefined")&&value.type==="undefined"&&IsOptionalString(value.$id)}function IsUnionLiteral(value){return IsUnion2(value)&&value.anyOf.every((schema)=>IsLiteralString(schema)||IsLiteralNumber(schema))}function IsUnion2(value){return IsKindOf2(value,"Union")&&IsOptionalString(value.$id)&&IsObject(value)&&IsArray(value.anyOf)&&value.anyOf.every((schema)=>IsSchema2(schema))}function IsUint8Array4(value){return IsKindOf2(value,"Uint8Array")&&value.type==="Uint8Array"&&IsOptionalString(value.$id)&&IsOptionalNumber(value.minByteLength)&&IsOptionalNumber(value.maxByteLength)}function IsUnknown2(value){return IsKindOf2(value,"Unknown")&&IsOptionalString(value.$id)}function IsUnsafe2(value){return IsKindOf2(value,"Unsafe")}function IsVoid2(value){return IsKindOf2(value,"Void")&&value.type==="void"&&IsOptionalString(value.$id)}function IsKind2(value){return IsObject(value)&&Kind in value&&IsString(value[Kind])&&!KnownTypes.includes(value[Kind])}function IsSchema2(value){return IsObject(value)&&(IsAny2(value)||IsArgument2(value)||IsArray4(value)||IsBoolean4(value)||IsBigInt4(value)||IsAsyncIterator4(value)||IsComputed2(value)||IsConstructor2(value)||IsDate4(value)||IsFunction4(value)||IsInteger3(value)||IsIntersect2(value)||IsIterator4(value)||IsLiteral2(value)||IsMappedKey2(value)||IsMappedResult2(value)||IsNever2(value)||IsNot2(value)||IsNull4(value)||IsNumber4(value)||IsObject4(value)||IsPromise3(value)||IsRecord2(value)||IsRef2(value)||IsRegExp3(value)||IsString4(value)||IsSymbol4(value)||IsTemplateLiteral2(value)||IsThis2(value)||IsTuple2(value)||IsUndefined4(value)||IsUnion2(value)||IsUint8Array4(value)||IsUnknown2(value)||IsUnsafe2(value)||IsVoid2(value)||IsKind2(value))}var PatternBoolean="(true|false)",PatternNumber="(0|[1-9][0-9]*)",PatternString="(.*)";var PatternNumberExact="^(0|[1-9][0-9]*)$",PatternStringExact="^(.*)$",PatternNeverExact="^(?!.*)$";var exports_format={};__export(exports_format,{Set:()=>Set2,Has:()=>Has,Get:()=>Get,Entries:()=>Entries,Delete:()=>Delete,Clear:()=>Clear});var map=new Map;function Entries(){return new Map(map)}function Clear(){return map.clear()}function Delete(format){return map.delete(format)}function Has(format){return map.has(format)}function Set2(format,func){map.set(format,func)}function Get(format){return map.get(format)}var exports_type2={};__export(exports_type2,{Set:()=>Set3,Has:()=>Has2,Get:()=>Get2,Entries:()=>Entries2,Delete:()=>Delete2,Clear:()=>Clear2});var map2=new Map;function Entries2(){return new Map(map2)}function Clear2(){return map2.clear()}function Delete2(kind){return map2.delete(kind)}function Has2(kind){return map2.has(kind)}function Set3(kind,func){map2.set(kind,func)}function Get2(kind){return map2.get(kind)}function SetIncludes(T,S){return T.includes(S)}function SetDistinct(T){return[...new Set(T)]}function SetIntersect(T,S){return T.filter((L)=>S.includes(L))}function SetIntersectManyResolve(T,Init){return T.reduce((Acc,L)=>{return SetIntersect(Acc,L)},Init)}function SetIntersectMany(T){return T.length===1?T[0]:T.length>1?SetIntersectManyResolve(T.slice(1),T[0]):[]}function SetUnionMany(T){let Acc=[];for(let L of T)Acc.push(...L);return Acc}function Any(options){return CreateType({[Kind]:"Any"},options)}function Array2(items,options){return CreateType({[Kind]:"Array",type:"array",items},options)}function Argument(index){return CreateType({[Kind]:"Argument",index})}function AsyncIterator2(items,options){return CreateType({[Kind]:"AsyncIterator",type:"AsyncIterator",items},options)}function Computed(target,parameters,options){return CreateType({[Kind]:"Computed",target,parameters},options)}function DiscardKey(value,key){let{[key]:_,...rest}=value;return rest}function Discard(value,keys){return keys.reduce((acc,key)=>DiscardKey(acc,key),value)}function Never(options){return CreateType({[Kind]:"Never",not:{}},options)}function MappedResult(properties){return CreateType({[Kind]:"MappedResult",properties})}function Constructor(parameters,returns,options){return CreateType({[Kind]:"Constructor",type:"Constructor",parameters,returns},options)}function Function2(parameters,returns,options){return CreateType({[Kind]:"Function",type:"Function",parameters,returns},options)}function UnionCreate(T,options){return CreateType({[Kind]:"Union",anyOf:T},options)}function IsUnionOptional(types){return types.some((type)=>IsOptional(type))}function RemoveOptionalFromRest(types){return types.map((left)=>IsOptional(left)?RemoveOptionalFromType(left):left)}function RemoveOptionalFromType(T){return Discard(T,[OptionalKind])}function ResolveUnion(types,options){return IsUnionOptional(types)?Optional(UnionCreate(RemoveOptionalFromRest(types),options)):UnionCreate(RemoveOptionalFromRest(types),options)}function UnionEvaluated(T,options){return T.length===1?CreateType(T[0],options):T.length===0?Never(options):ResolveUnion(T,options)}function Union(types,options){return types.length===0?Never(options):types.length===1?CreateType(types[0],options):UnionCreate(types,options)}class TemplateLiteralParserError extends TypeBoxError{}function Unescape(pattern){return pattern.replace(/\\\$/g,"$").replace(/\\\*/g,"*").replace(/\\\^/g,"^").replace(/\\\|/g,"|").replace(/\\\(/g,"(").replace(/\\\)/g,")")}function IsNonEscaped(pattern,index,char){return pattern[index]===char&&pattern.charCodeAt(index-1)!==92}function IsOpenParen(pattern,index){return IsNonEscaped(pattern,index,"(")}function IsCloseParen(pattern,index){return IsNonEscaped(pattern,index,")")}function IsSeparator(pattern,index){return IsNonEscaped(pattern,index,"|")}function IsGroup(pattern){if(!(IsOpenParen(pattern,0)&&IsCloseParen(pattern,pattern.length-1)))return!1;let count=0;for(let index=0;index<pattern.length;index++){if(IsOpenParen(pattern,index))count+=1;if(IsCloseParen(pattern,index))count-=1;if(count===0&&index!==pattern.length-1)return!1}return!0}function InGroup(pattern){return pattern.slice(1,pattern.length-1)}function IsPrecedenceOr(pattern){let count=0;for(let index=0;index<pattern.length;index++){if(IsOpenParen(pattern,index))count+=1;if(IsCloseParen(pattern,index))count-=1;if(IsSeparator(pattern,index)&&count===0)return!0}return!1}function IsPrecedenceAnd(pattern){for(let index=0;index<pattern.length;index++)if(IsOpenParen(pattern,index))return!0;return!1}function Or(pattern){let[count,start]=[0,0],expressions=[];for(let index=0;index<pattern.length;index++){if(IsOpenParen(pattern,index))count+=1;if(IsCloseParen(pattern,index))count-=1;if(IsSeparator(pattern,index)&&count===0){let range2=pattern.slice(start,index);if(range2.length>0)expressions.push(TemplateLiteralParse(range2));start=index+1}}let range=pattern.slice(start);if(range.length>0)expressions.push(TemplateLiteralParse(range));if(expressions.length===0)return{type:"const",const:""};if(expressions.length===1)return expressions[0];return{type:"or",expr:expressions}}function And(pattern){function Group(value,index){if(!IsOpenParen(value,index))throw new TemplateLiteralParserError("TemplateLiteralParser: Index must point to open parens");let count=0;for(let scan=index;scan<value.length;scan++){if(IsOpenParen(value,scan))count+=1;if(IsCloseParen(value,scan))count-=1;if(count===0)return[index,scan]}throw new TemplateLiteralParserError("TemplateLiteralParser: Unclosed group parens in expression")}function Range(pattern2,index){for(let scan=index;scan<pattern2.length;scan++)if(IsOpenParen(pattern2,scan))return[index,scan];return[index,pattern2.length]}let expressions=[];for(let index=0;index<pattern.length;index++)if(IsOpenParen(pattern,index)){let[start,end]=Group(pattern,index),range=pattern.slice(start,end+1);expressions.push(TemplateLiteralParse(range)),index=end}else{let[start,end]=Range(pattern,index),range=pattern.slice(start,end);if(range.length>0)expressions.push(TemplateLiteralParse(range));index=end-1}return expressions.length===0?{type:"const",const:""}:expressions.length===1?expressions[0]:{type:"and",expr:expressions}}function TemplateLiteralParse(pattern){return IsGroup(pattern)?TemplateLiteralParse(InGroup(pattern)):IsPrecedenceOr(pattern)?Or(pattern):IsPrecedenceAnd(pattern)?And(pattern):{type:"const",const:Unescape(pattern)}}function TemplateLiteralParseExact(pattern){return TemplateLiteralParse(pattern.slice(1,pattern.length-1))}class TemplateLiteralFiniteError extends TypeBoxError{}function IsNumberExpression(expression){return expression.type==="or"&&expression.expr.length===2&&expression.expr[0].type==="const"&&expression.expr[0].const==="0"&&expression.expr[1].type==="const"&&expression.expr[1].const==="[1-9][0-9]*"}function IsBooleanExpression(expression){return expression.type==="or"&&expression.expr.length===2&&expression.expr[0].type==="const"&&expression.expr[0].const==="true"&&expression.expr[1].type==="const"&&expression.expr[1].const==="false"}function IsStringExpression(expression){return expression.type==="const"&&expression.const===".*"}function IsTemplateLiteralExpressionFinite(expression){return IsNumberExpression(expression)||IsStringExpression(expression)?!1:IsBooleanExpression(expression)?!0:expression.type==="and"?expression.expr.every((expr)=>IsTemplateLiteralExpressionFinite(expr)):expression.type==="or"?expression.expr.every((expr)=>IsTemplateLiteralExpressionFinite(expr)):expression.type==="const"?!0:(()=>{throw new TemplateLiteralFiniteError("Unknown expression type")})()}function IsTemplateLiteralFinite(schema){let expression=TemplateLiteralParseExact(schema.pattern);return IsTemplateLiteralExpressionFinite(expression)}class TemplateLiteralGenerateError extends TypeBoxError{}function*GenerateReduce(buffer){if(buffer.length===1)return yield*buffer[0];for(let left of buffer[0])for(let right of GenerateReduce(buffer.slice(1)))yield`${left}${right}`}function*GenerateAnd(expression){return yield*GenerateReduce(expression.expr.map((expr)=>[...TemplateLiteralExpressionGenerate(expr)]))}function*GenerateOr(expression){for(let expr of expression.expr)yield*TemplateLiteralExpressionGenerate(expr)}function*GenerateConst(expression){return yield expression.const}function*TemplateLiteralExpressionGenerate(expression){return expression.type==="and"?yield*GenerateAnd(expression):expression.type==="or"?yield*GenerateOr(expression):expression.type==="const"?yield*GenerateConst(expression):(()=>{throw new TemplateLiteralGenerateError("Unknown expression")})()}function TemplateLiteralGenerate(schema){let expression=TemplateLiteralParseExact(schema.pattern);return IsTemplateLiteralExpressionFinite(expression)?[...TemplateLiteralExpressionGenerate(expression)]:[]}function Literal(value,options){return CreateType({[Kind]:"Literal",const:value,type:typeof value},options)}function Boolean2(options){return CreateType({[Kind]:"Boolean",type:"boolean"},options)}function BigInt2(options){return CreateType({[Kind]:"BigInt",type:"bigint"},options)}function Number2(options){return CreateType({[Kind]:"Number",type:"number"},options)}function String2(options){return CreateType({[Kind]:"String",type:"string"},options)}function*FromUnion(syntax){let trim=syntax.trim().replace(/"|'/g,"");return trim==="boolean"?yield Boolean2():trim==="number"?yield Number2():trim==="bigint"?yield BigInt2():trim==="string"?yield String2():yield(()=>{let literals=trim.split("|").map((literal)=>Literal(literal.trim()));return literals.length===0?Never():literals.length===1?literals[0]:UnionEvaluated(literals)})()}function*FromTerminal(syntax){if(syntax[1]!=="{"){let L=Literal("$"),R=FromSyntax(syntax.slice(1));return yield*[L,...R]}for(let i=2;i<syntax.length;i++)if(syntax[i]==="}"){let L=FromUnion(syntax.slice(2,i)),R=FromSyntax(syntax.slice(i+1));return yield*[...L,...R]}yield Literal(syntax)}function*FromSyntax(syntax){for(let i=0;i<syntax.length;i++)if(syntax[i]==="$"){let L=Literal(syntax.slice(0,i)),R=FromTerminal(syntax.slice(i));return yield*[L,...R]}yield Literal(syntax)}function TemplateLiteralSyntax(syntax){return[...FromSyntax(syntax)]}class TemplateLiteralPatternError extends TypeBoxError{}function Escape(value){return value.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function Visit2(schema,acc){return IsTemplateLiteral(schema)?schema.pattern.slice(1,schema.pattern.length-1):IsUnion(schema)?`(${schema.anyOf.map((schema2)=>Visit2(schema2,acc)).join("|")})`:IsNumber3(schema)?`${acc}${PatternNumber}`:IsInteger2(schema)?`${acc}${PatternNumber}`:IsBigInt3(schema)?`${acc}${PatternNumber}`:IsString3(schema)?`${acc}${PatternString}`:IsLiteral(schema)?`${acc}${Escape(schema.const.toString())}`:IsBoolean3(schema)?`${acc}${PatternBoolean}`:(()=>{throw new TemplateLiteralPatternError(`Unexpected Kind '${schema[Kind]}'`)})()}function TemplateLiteralPattern(kinds){return`^${kinds.map((schema)=>Visit2(schema,"")).join("")}$`}function TemplateLiteralToUnion(schema){let L=TemplateLiteralGenerate(schema).map((S)=>Literal(S));return UnionEvaluated(L)}function TemplateLiteral(unresolved,options){let pattern=IsString(unresolved)?TemplateLiteralPattern(TemplateLiteralSyntax(unresolved)):TemplateLiteralPattern(unresolved);return CreateType({[Kind]:"TemplateLiteral",type:"string",pattern},options)}function FromTemplateLiteral(templateLiteral){return TemplateLiteralGenerate(templateLiteral).map((key)=>key.toString())}function FromUnion2(types){let result=[];for(let type of types)result.push(...IndexPropertyKeys(type));return result}function FromLiteral(literalValue){return[literalValue.toString()]}function IndexPropertyKeys(type){return[...new Set(IsTemplateLiteral(type)?FromTemplateLiteral(type):IsUnion(type)?FromUnion2(type.anyOf):IsLiteral(type)?FromLiteral(type.const):IsNumber3(type)?["[number]"]:IsInteger2(type)?["[number]"]:[])]}function FromProperties(type,properties,options){let result={};for(let K2 of Object.getOwnPropertyNames(properties))result[K2]=Index(type,IndexPropertyKeys(properties[K2]),options);return result}function FromMappedResult(type,mappedResult,options){return FromProperties(type,mappedResult.properties,options)}function IndexFromMappedResult(type,mappedResult,options){let properties=FromMappedResult(type,mappedResult,options);return MappedResult(properties)}function FromRest(types,key){return types.map((type)=>IndexFromPropertyKey(type,key))}function FromIntersectRest(types){return types.filter((type)=>!IsNever(type))}function FromIntersect(types,key){return IntersectEvaluated(FromIntersectRest(FromRest(types,key)))}function FromUnionRest(types){return types.some((L)=>IsNever(L))?[]:types}function FromUnion3(types,key){return UnionEvaluated(FromUnionRest(FromRest(types,key)))}function FromTuple(types,key){return key in types?types[key]:key==="[number]"?UnionEvaluated(types):Never()}function FromArray(type,key){return key==="[number]"?type:Never()}function FromProperty(properties,propertyKey){return propertyKey in properties?properties[propertyKey]:Never()}function IndexFromPropertyKey(type,propertyKey){return IsIntersect(type)?FromIntersect(type.allOf,propertyKey):IsUnion(type)?FromUnion3(type.anyOf,propertyKey):IsTuple(type)?FromTuple(type.items??[],propertyKey):IsArray3(type)?FromArray(type.items,propertyKey):IsObject3(type)?FromProperty(type.properties,propertyKey):Never()}function IndexFromPropertyKeys(type,propertyKeys){return propertyKeys.map((propertyKey)=>IndexFromPropertyKey(type,propertyKey))}function FromSchema(type,propertyKeys){return UnionEvaluated(IndexFromPropertyKeys(type,propertyKeys))}function Index(type,key,options){if(IsRef(type)||IsRef(key)){if(!IsSchema(type)||!IsSchema(key))throw new TypeBoxError("Index types using Ref parameters require both Type and Key to be of TSchema");return Computed("Index",[type,key])}if(IsMappedResult(key))return IndexFromMappedResult(type,key,options);if(IsMappedKey(key))return IndexFromMappedKey(type,key,options);return CreateType(IsSchema(key)?FromSchema(type,IndexPropertyKeys(key)):FromSchema(type,key),options)}function MappedIndexPropertyKey(type,key,options){return{[key]:Index(type,[key],Clone(options))}}function MappedIndexPropertyKeys(type,propertyKeys,options){return propertyKeys.reduce((result,left)=>{return{...result,...MappedIndexPropertyKey(type,left,options)}},{})}function MappedIndexProperties(type,mappedKey,options){return MappedIndexPropertyKeys(type,mappedKey.keys,options)}function IndexFromMappedKey(type,mappedKey,options){let properties=MappedIndexProperties(type,mappedKey,options);return MappedResult(properties)}function Iterator2(items,options){return CreateType({[Kind]:"Iterator",type:"Iterator",items},options)}function RequiredKeys(properties){let keys=[];for(let key in properties)if(!IsOptional(properties[key]))keys.push(key);return keys}function _Object(properties,options){let required=RequiredKeys(properties),schematic=required.length>0?{[Kind]:"Object",type:"object",properties,required}:{[Kind]:"Object",type:"object",properties};return CreateType(schematic,options)}var Object2=_Object;function Promise2(item,options){return CreateType({[Kind]:"Promise",type:"Promise",item},options)}function RemoveReadonly(schema){return CreateType(Discard(schema,[ReadonlyKind]))}function AddReadonly(schema){return CreateType({...schema,[ReadonlyKind]:"Readonly"})}function ReadonlyWithFlag(schema,F){return F===!1?RemoveReadonly(schema):AddReadonly(schema)}function Readonly(schema,enable){let F=enable??!0;return IsMappedResult(schema)?ReadonlyFromMappedResult(schema,F):ReadonlyWithFlag(schema,F)}function FromProperties2(K,F){let Acc={};for(let K2 of globalThis.Object.getOwnPropertyNames(K))Acc[K2]=Readonly(K[K2],F);return Acc}function FromMappedResult2(R,F){return FromProperties2(R.properties,F)}function ReadonlyFromMappedResult(R,F){let P=FromMappedResult2(R,F);return MappedResult(P)}function Tuple(types,options){return CreateType(types.length>0?{[Kind]:"Tuple",type:"array",items:types,additionalItems:!1,minItems:types.length,maxItems:types.length}:{[Kind]:"Tuple",type:"array",minItems:types.length,maxItems:types.length},options)}function FromMappedResult3(K,P){return K in P?FromSchemaType(K,P[K]):MappedResult(P)}function MappedKeyToKnownMappedResultProperties(K){return{[K]:Literal(K)}}function MappedKeyToUnknownMappedResultProperties(P){let Acc={};for(let L of P)Acc[L]=Literal(L);return Acc}function MappedKeyToMappedResultProperties(K,P){return SetIncludes(P,K)?MappedKeyToKnownMappedResultProperties(K):MappedKeyToUnknownMappedResultProperties(P)}function FromMappedKey(K,P){let R=MappedKeyToMappedResultProperties(K,P);return FromMappedResult3(K,R)}function FromRest2(K,T){return T.map((L)=>FromSchemaType(K,L))}function FromProperties3(K,T){let Acc={};for(let K2 of globalThis.Object.getOwnPropertyNames(T))Acc[K2]=FromSchemaType(K,T[K2]);return Acc}function FromSchemaType(K,T){let options={...T};return IsOptional(T)?Optional(FromSchemaType(K,Discard(T,[OptionalKind]))):IsReadonly(T)?Readonly(FromSchemaType(K,Discard(T,[ReadonlyKind]))):IsMappedResult(T)?FromMappedResult3(K,T.properties):IsMappedKey(T)?FromMappedKey(K,T.keys):IsConstructor(T)?Constructor(FromRest2(K,T.parameters),FromSchemaType(K,T.returns),options):IsFunction3(T)?Function2(FromRest2(K,T.parameters),FromSchemaType(K,T.returns),options):IsAsyncIterator3(T)?AsyncIterator2(FromSchemaType(K,T.items),options):IsIterator3(T)?Iterator2(FromSchemaType(K,T.items),options):IsIntersect(T)?Intersect(FromRest2(K,T.allOf),options):IsUnion(T)?Union(FromRest2(K,T.anyOf),options):IsTuple(T)?Tuple(FromRest2(K,T.items??[]),options):IsObject3(T)?Object2(FromProperties3(K,T.properties),options):IsArray3(T)?Array2(FromSchemaType(K,T.items),options):IsPromise2(T)?Promise2(FromSchemaType(K,T.item),options):T}function MappedFunctionReturnType(K,T){let Acc={};for(let L of K)Acc[L]=FromSchemaType(L,T);return Acc}function Mapped(key,map3,options){let K=IsSchema(key)?IndexPropertyKeys(key):key,RT=map3({[Kind]:"MappedKey",keys:K}),R=MappedFunctionReturnType(K,RT);return Object2(R,options)}function RemoveOptional(schema){return CreateType(Discard(schema,[OptionalKind]))}function AddOptional(schema){return CreateType({...schema,[OptionalKind]:"Optional"})}function OptionalWithFlag(schema,F){return F===!1?RemoveOptional(schema):AddOptional(schema)}function Optional(schema,enable){let F=enable??!0;return IsMappedResult(schema)?OptionalFromMappedResult(schema,F):OptionalWithFlag(schema,F)}function FromProperties4(P,F){let Acc={};for(let K2 of globalThis.Object.getOwnPropertyNames(P))Acc[K2]=Optional(P[K2],F);return Acc}function FromMappedResult4(R,F){return FromProperties4(R.properties,F)}function OptionalFromMappedResult(R,F){let P=FromMappedResult4(R,F);return MappedResult(P)}function IntersectCreate(T,options={}){let allObjects=T.every((schema)=>IsObject3(schema)),clonedUnevaluatedProperties=IsSchema(options.unevaluatedProperties)?{unevaluatedProperties:options.unevaluatedProperties}:{};return CreateType(options.unevaluatedProperties===!1||IsSchema(options.unevaluatedProperties)||allObjects?{...clonedUnevaluatedProperties,[Kind]:"Intersect",type:"object",allOf:T}:{...clonedUnevaluatedProperties,[Kind]:"Intersect",allOf:T},options)}function IsIntersectOptional(types){return types.every((left)=>IsOptional(left))}function RemoveOptionalFromType2(type){return Discard(type,[OptionalKind])}function RemoveOptionalFromRest2(types){return types.map((left)=>IsOptional(left)?RemoveOptionalFromType2(left):left)}function ResolveIntersect(types,options){return IsIntersectOptional(types)?Optional(IntersectCreate(RemoveOptionalFromRest2(types),options)):IntersectCreate(RemoveOptionalFromRest2(types),options)}function IntersectEvaluated(types,options={}){if(types.length===1)return CreateType(types[0],options);if(types.length===0)return Never(options);if(types.some((schema)=>IsTransform(schema)))throw Error("Cannot intersect transform types");return ResolveIntersect(types,options)}function Intersect(types,options){if(types.length===1)return CreateType(types[0],options);if(types.length===0)return Never(options);if(types.some((schema)=>IsTransform(schema)))throw Error("Cannot intersect transform types");return IntersectCreate(types,options)}function Ref(...args){let[$ref,options]=typeof args[0]==="string"?[args[0],args[1]]:[args[0].$id,args[1]];if(typeof $ref!=="string")throw new TypeBoxError("Ref: $ref must be a string");return CreateType({[Kind]:"Ref",$ref},options)}function FromComputed(target,parameters){return Computed("Awaited",[Computed(target,parameters)])}function FromRef($ref){return Computed("Awaited",[Ref($ref)])}function FromIntersect2(types){return Intersect(FromRest3(types))}function FromUnion4(types){return Union(FromRest3(types))}function FromPromise(type){return Awaited(type)}function FromRest3(types){return types.map((type)=>Awaited(type))}function Awaited(type,options){return CreateType(IsComputed(type)?FromComputed(type.target,type.parameters):IsIntersect(type)?FromIntersect2(type.allOf):IsUnion(type)?FromUnion4(type.anyOf):IsPromise2(type)?FromPromise(type.item):IsRef(type)?FromRef(type.$ref):type,options)}function FromRest4(types){let result=[];for(let L of types)result.push(KeyOfPropertyKeys(L));return result}function FromIntersect3(types){let propertyKeysArray=FromRest4(types);return SetUnionMany(propertyKeysArray)}function FromUnion5(types){let propertyKeysArray=FromRest4(types);return SetIntersectMany(propertyKeysArray)}function FromTuple2(types){return types.map((_,indexer)=>indexer.toString())}function FromArray2(_){return["[number]"]}function FromProperties5(T){return globalThis.Object.getOwnPropertyNames(T)}function FromPatternProperties(patternProperties){if(!includePatternProperties)return[];return globalThis.Object.getOwnPropertyNames(patternProperties).map((key)=>{return key[0]==="^"&&key[key.length-1]==="$"?key.slice(1,key.length-1):key})}function KeyOfPropertyKeys(type){return IsIntersect(type)?FromIntersect3(type.allOf):IsUnion(type)?FromUnion5(type.anyOf):IsTuple(type)?FromTuple2(type.items??[]):IsArray3(type)?FromArray2(type.items):IsObject3(type)?FromProperties5(type.properties):IsRecord(type)?FromPatternProperties(type.patternProperties):[]}var includePatternProperties=!1;function KeyOfPattern(schema){includePatternProperties=!0;let keys=KeyOfPropertyKeys(schema);return includePatternProperties=!1,`^(${keys.map((key)=>`(${key})`).join("|")})$`}function FromComputed2(target,parameters){return Computed("KeyOf",[Computed(target,parameters)])}function FromRef2($ref){return Computed("KeyOf",[Ref($ref)])}function KeyOfFromType(type,options){let propertyKeys=KeyOfPropertyKeys(type),propertyKeyTypes=KeyOfPropertyKeysToRest(propertyKeys),result=UnionEvaluated(propertyKeyTypes);return CreateType(result,options)}function KeyOfPropertyKeysToRest(propertyKeys){return propertyKeys.map((L)=>L==="[number]"?Number2():Literal(L))}function KeyOf(type,options){return IsComputed(type)?FromComputed2(type.target,type.parameters):IsRef(type)?FromRef2(type.$ref):IsMappedResult(type)?KeyOfFromMappedResult(type,options):KeyOfFromType(type,options)}function FromProperties6(properties,options){let result={};for(let K2 of globalThis.Object.getOwnPropertyNames(properties))result[K2]=KeyOf(properties[K2],Clone(options));return result}function FromMappedResult5(mappedResult,options){return FromProperties6(mappedResult.properties,options)}function KeyOfFromMappedResult(mappedResult,options){let properties=FromMappedResult5(mappedResult,options);return MappedResult(properties)}function KeyOfPropertyEntries(schema){let keys=KeyOfPropertyKeys(schema),schemas=IndexFromPropertyKeys(schema,keys);return keys.map((_,index)=>[keys[index],schemas[index]])}function CompositeKeys(T){let Acc=[];for(let L of T)Acc.push(...KeyOfPropertyKeys(L));return SetDistinct(Acc)}function FilterNever(T){return T.filter((L)=>!IsNever(L))}function CompositeProperty(T,K){let Acc=[];for(let L of T)Acc.push(...IndexFromPropertyKeys(L,[K]));return FilterNever(Acc)}function CompositeProperties(T,K){let Acc={};for(let L of K)Acc[L]=IntersectEvaluated(CompositeProperty(T,L));return Acc}function Composite(T,options){let K=CompositeKeys(T),P=CompositeProperties(T,K);return Object2(P,options)}function Date2(options){return CreateType({[Kind]:"Date",type:"Date"},options)}function Null(options){return CreateType({[Kind]:"Null",type:"null"},options)}function Symbol2(options){return CreateType({[Kind]:"Symbol",type:"symbol"},options)}function Undefined(options){return CreateType({[Kind]:"Undefined",type:"undefined"},options)}function Uint8Array2(options){return CreateType({[Kind]:"Uint8Array",type:"Uint8Array"},options)}function Unknown(options){return CreateType({[Kind]:"Unknown"},options)}function FromArray3(T){return T.map((L)=>FromValue(L,!1))}function FromProperties7(value){let Acc={};for(let K of globalThis.Object.getOwnPropertyNames(value))Acc[K]=Readonly(FromValue(value[K],!1));return Acc}function ConditionalReadonly(T,root){return root===!0?T:Readonly(T)}function FromValue(value,root){return IsAsyncIterator(value)?ConditionalReadonly(Any(),root):IsIterator(value)?ConditionalReadonly(Any(),root):IsArray(value)?Readonly(Tuple(FromArray3(value))):IsUint8Array(value)?Uint8Array2():IsDate(value)?Date2():IsObject(value)?ConditionalReadonly(Object2(FromProperties7(value)),root):IsFunction(value)?ConditionalReadonly(Function2([],Unknown()),root):IsUndefined(value)?Undefined():IsNull(value)?Null():IsSymbol(value)?Symbol2():IsBigInt(value)?BigInt2():IsNumber(value)?Literal(value):IsBoolean(value)?Literal(value):IsString(value)?Literal(value):Object2({})}function Const(T,options){return CreateType(FromValue(T,!0),options)}function ConstructorParameters(schema,options){return IsConstructor(schema)?Tuple(schema.parameters,options):Never(options)}function Enum(item,options){if(IsUndefined(item))throw Error("Enum undefined or empty");let values1=globalThis.Object.getOwnPropertyNames(item).filter((key)=>isNaN(key)).map((key)=>item[key]),anyOf=[...new Set(values1)].map((value)=>Literal(value));return Union(anyOf,{...options,[Hint]:"Enum"})}class ExtendsResolverError extends TypeBoxError{}var ExtendsResult;(function(ExtendsResult2){ExtendsResult2[ExtendsResult2.Union=0]="Union",ExtendsResult2[ExtendsResult2.True=1]="True",ExtendsResult2[ExtendsResult2.False=2]="False"})(ExtendsResult||(ExtendsResult={}));function IntoBooleanResult(result){return result===ExtendsResult.False?result:ExtendsResult.True}function Throw(message){throw new ExtendsResolverError(message)}function IsStructuralRight(right){return exports_type.IsNever(right)||exports_type.IsIntersect(right)||exports_type.IsUnion(right)||exports_type.IsUnknown(right)||exports_type.IsAny(right)}function StructuralRight(left,right){return exports_type.IsNever(right)?FromNeverRight(left,right):exports_type.IsIntersect(right)?FromIntersectRight(left,right):exports_type.IsUnion(right)?FromUnionRight(left,right):exports_type.IsUnknown(right)?FromUnknownRight(left,right):exports_type.IsAny(right)?FromAnyRight(left,right):Throw("StructuralRight")}function FromAnyRight(left,right){return ExtendsResult.True}function FromAny(left,right){return exports_type.IsIntersect(right)?FromIntersectRight(left,right):exports_type.IsUnion(right)&&right.anyOf.some((schema)=>exports_type.IsAny(schema)||exports_type.IsUnknown(schema))?ExtendsResult.True:exports_type.IsUnion(right)?ExtendsResult.Union:exports_type.IsUnknown(right)?ExtendsResult.True:exports_type.IsAny(right)?ExtendsResult.True:ExtendsResult.Union}function FromArrayRight(left,right){return exports_type.IsUnknown(left)?ExtendsResult.False:exports_type.IsAny(left)?ExtendsResult.Union:exports_type.IsNever(left)?ExtendsResult.True:ExtendsResult.False}function FromArray4(left,right){return exports_type.IsObject(right)&&IsObjectArrayLike(right)?ExtendsResult.True:IsStructuralRight(right)?StructuralRight(left,right):!exports_type.IsArray(right)?ExtendsResult.False:IntoBooleanResult(Visit3(left.items,right.items))}function FromAsyncIterator(left,right){return IsStructuralRight(right)?StructuralRight(left,right):!exports_type.IsAsyncIterator(right)?ExtendsResult.False:IntoBooleanResult(Visit3(left.items,right.items))}function FromBigInt(left,right){return IsStructuralRight(right)?StructuralRight(left,right):exports_type.IsObject(right)?FromObjectRight(left,right):exports_type.IsRecord(right)?FromRecordRight(left,right):exports_type.IsBigInt(right)?ExtendsResult.True:ExtendsResult.False}function FromBooleanRight(left,right){return exports_type.IsLiteralBoolean(left)?ExtendsResult.True:exports_type.IsBoolean(left)?ExtendsResult.True:ExtendsResult.False}function FromBoolean(left,right){return IsStructuralRight(right)?StructuralRight(left,right):exports_type.IsObject(right)?FromObjectRight(left,right):exports_type.IsRecord(right)?FromRecordRight(left,right):exports_type.IsBoolean(right)?ExtendsResult.True:ExtendsResult.False}function FromConstructor(left,right){return IsStructuralRight(right)?StructuralRight(left,right):exports_type.IsObject(right)?FromObjectRight(left,right):!exports_type.IsConstructor(right)?ExtendsResult.False:left.parameters.length>right.parameters.length?ExtendsResult.False:!left.parameters.every((schema,index)=>IntoBooleanResult(Visit3(right.parameters[index],schema))===ExtendsResult.True)?ExtendsResult.False:IntoBooleanResult(Visit3(left.returns,right.returns))}function FromDate(left,right){return IsStructuralRight(right)?StructuralRight(left,right):exports_type.IsObject(right)?FromObjectRight(left,right):exports_type.IsRecord(right)?FromRecordRight(left,right):exports_type.IsDate(right)?ExtendsResult.True:ExtendsResult.False}function FromFunction(left,right){return IsStructuralRight(right)?StructuralRight(left,right):exports_type.IsObject(right)?FromObjectRight(left,right):!exports_type.IsFunction(right)?ExtendsResult.False:left.parameters.length>right.parameters.length?ExtendsResult.False:!left.parameters.every((schema,index)=>IntoBooleanResult(Visit3(right.parameters[index],schema))===ExtendsResult.True)?ExtendsResult.False:IntoBooleanResult(Visit3(left.returns,right.returns))}function FromIntegerRight(left,right){return exports_type.IsLiteral(left)&&exports_value.IsNumber(left.const)?ExtendsResult.True:exports_type.IsNumber(left)||exports_type.IsInteger(left)?ExtendsResult.True:ExtendsResult.False}function FromInteger(left,right){return exports_type.IsInteger(right)||exports_type.IsNumber(right)?ExtendsResult.True:IsStructuralRight(right)?StructuralRight(left,right):exports_type.IsObject(right)?FromObjectRight(left,right):exports_type.IsRecord(right)?FromRecordRight(left,right):ExtendsResult.False}function FromIntersectRight(left,right){return right.allOf.every((schema)=>Visit3(left,schema)===ExtendsResult.True)?ExtendsResult.True:ExtendsResult.False}function FromIntersect4(left,right){return left.allOf.some((schema)=>Visit3(schema,right)===ExtendsResult.True)?ExtendsResult.True:ExtendsResult.False}function FromIterator(left,right){return IsStructuralRight(right)?StructuralRight(left,right):!exports_type.IsIterator(right)?ExtendsResult.False:IntoBooleanResult(Visit3(left.items,right.items))}function FromLiteral2(left,right){return exports_type.IsLiteral(right)&&right.const===left.const?ExtendsResult.True:IsStructuralRight(right)?StructuralRight(left,right):exports_type.IsObject(right)?FromObjectRight(left,right):exports_type.IsRecord(right)?FromRecordRight(left,right):exports_type.IsString(right)?FromStringRight(left,right):exports_type.IsNumber(right)?FromNumberRight(left,right):exports_type.IsInteger(right)?FromIntegerRight(left,right):exports_type.IsBoolean(right)?FromBooleanRight(left,right):ExtendsResult.False}function FromNeverRight(left,right){return ExtendsResult.False}function FromNever(left,right){return ExtendsResult.True}function UnwrapTNot(schema){let[current,depth]=[schema,0];while(!0){if(!exports_type.IsNot(current))break;current=current.not,depth+=1}return depth%2===0?current:Unknown()}function FromNot(left,right){return exports_type.IsNot(left)?Visit3(UnwrapTNot(left),right):exports_type.IsNot(right)?Visit3(left,UnwrapTNot(right)):Throw("Invalid fallthrough for Not")}function FromNull(left,right){return IsStructuralRight(right)?StructuralRight(left,right):exports_type.IsObject(right)?FromObjectRight(left,right):exports_type.IsRecord(right)?FromRecordRight(left,right):exports_type.IsNull(right)?ExtendsResult.True:ExtendsResult.False}function FromNumberRight(left,right){return exports_type.IsLiteralNumber(left)?ExtendsResult.True:exports_type.IsNumber(left)||exports_type.IsInteger(left)?ExtendsResult.True:ExtendsResult.False}function FromNumber(left,right){return IsStructuralRight(right)?StructuralRight(left,right):exports_type.IsObject(right)?FromObjectRight(left,right):exports_type.IsRecord(right)?FromRecordRight(left,right):exports_type.IsInteger(right)||exports_type.IsNumber(right)?ExtendsResult.True:ExtendsResult.False}function IsObjectPropertyCount(schema,count){return Object.getOwnPropertyNames(schema.properties).length===count}function IsObjectStringLike(schema){return IsObjectArrayLike(schema)}function IsObjectSymbolLike(schema){return IsObjectPropertyCount(schema,0)||IsObjectPropertyCount(schema,1)&&"description"in schema.properties&&exports_type.IsUnion(schema.properties.description)&&schema.properties.description.anyOf.length===2&&(exports_type.IsString(schema.properties.description.anyOf[0])&&exports_type.IsUndefined(schema.properties.description.anyOf[1])||exports_type.IsString(schema.properties.description.anyOf[1])&&exports_type.IsUndefined(schema.properties.description.anyOf[0]))}function IsObjectNumberLike(schema){return IsObjectPropertyCount(schema,0)}function IsObjectBooleanLike(schema){return IsObjectPropertyCount(schema,0)}function IsObjectBigIntLike(schema){return IsObjectPropertyCount(schema,0)}function IsObjectDateLike(schema){return IsObjectPropertyCount(schema,0)}function IsObjectUint8ArrayLike(schema){return IsObjectArrayLike(schema)}function IsObjectFunctionLike(schema){let length=Number2();return IsObjectPropertyCount(schema,0)||IsObjectPropertyCount(schema,1)&&"length"in schema.properties&&IntoBooleanResult(Visit3(schema.properties.length,length))===ExtendsResult.True}function IsObjectConstructorLike(schema){return IsObjectPropertyCount(schema,0)}function IsObjectArrayLike(schema){let length=Number2();return IsObjectPropertyCount(schema,0)||IsObjectPropertyCount(schema,1)&&"length"in schema.properties&&IntoBooleanResult(Visit3(schema.properties.length,length))===ExtendsResult.True}function IsObjectPromiseLike(schema){let then=Function2([Any()],Any());return IsObjectPropertyCount(schema,0)||IsObjectPropertyCount(schema,1)&&"then"in schema.properties&&IntoBooleanResult(Visit3(schema.properties.then,then))===ExtendsResult.True}function Property(left,right){return Visit3(left,right)===ExtendsResult.False?ExtendsResult.False:exports_type.IsOptional(left)&&!exports_type.IsOptional(right)?ExtendsResult.False:ExtendsResult.True}function FromObjectRight(left,right){return exports_type.IsUnknown(left)?ExtendsResult.False:exports_type.IsAny(left)?ExtendsResult.Union:exports_type.IsNever(left)||exports_type.IsLiteralString(left)&&IsObjectStringLike(right)||exports_type.IsLiteralNumber(left)&&IsObjectNumberLike(right)||exports_type.IsLiteralBoolean(left)&&IsObjectBooleanLike(right)||exports_type.IsSymbol(left)&&IsObjectSymbolLike(right)||exports_type.IsBigInt(left)&&IsObjectBigIntLike(right)||exports_type.IsString(left)&&IsObjectStringLike(right)||exports_type.IsSymbol(left)&&IsObjectSymbolLike(right)||exports_type.IsNumber(left)&&IsObjectNumberLike(right)||exports_type.IsInteger(left)&&IsObjectNumberLike(right)||exports_type.IsBoolean(left)&&IsObjectBooleanLike(right)||exports_type.IsUint8Array(left)&&IsObjectUint8ArrayLike(right)||exports_type.IsDate(left)&&IsObjectDateLike(right)||exports_type.IsConstructor(left)&&IsObjectConstructorLike(right)||exports_type.IsFunction(left)&&IsObjectFunctionLike(right)?ExtendsResult.True:exports_type.IsRecord(left)&&exports_type.IsString(RecordKey(left))?(()=>{return right[Hint]==="Record"?ExtendsResult.True:ExtendsResult.False})():exports_type.IsRecord(left)&&exports_type.IsNumber(RecordKey(left))?(()=>{return IsObjectPropertyCount(right,0)?ExtendsResult.True:ExtendsResult.False})():ExtendsResult.False}function FromObject(left,right){return IsStructuralRight(right)?StructuralRight(left,right):exports_type.IsRecord(right)?FromRecordRight(left,right):!exports_type.IsObject(right)?ExtendsResult.False:(()=>{for(let key of Object.getOwnPropertyNames(right.properties)){if(!(key in left.properties)&&!exports_type.IsOptional(right.properties[key]))return ExtendsResult.False;if(exports_type.IsOptional(right.properties[key]))return ExtendsResult.True;if(Property(left.properties[key],right.properties[key])===ExtendsResult.False)return ExtendsResult.False}return ExtendsResult.True})()}function FromPromise2(left,right){return IsStructuralRight(right)?StructuralRight(left,right):exports_type.IsObject(right)&&IsObjectPromiseLike(right)?ExtendsResult.True:!exports_type.IsPromise(right)?ExtendsResult.False:IntoBooleanResult(Visit3(left.item,right.item))}function RecordKey(schema){return PatternNumberExact in schema.patternProperties?Number2():(PatternStringExact in schema.patternProperties)?String2():Throw("Unknown record key pattern")}function RecordValue(schema){return PatternNumberExact in schema.patternProperties?schema.patternProperties[PatternNumberExact]:(PatternStringExact in schema.patternProperties)?schema.patternProperties[PatternStringExact]:Throw("Unable to get record value schema")}function FromRecordRight(left,right){let[Key,Value]=[RecordKey(right),RecordValue(right)];return exports_type.IsLiteralString(left)&&exports_type.IsNumber(Key)&&IntoBooleanResult(Visit3(left,Value))===ExtendsResult.True?ExtendsResult.True:exports_type.IsUint8Array(left)&&exports_type.IsNumber(Key)?Visit3(left,Value):exports_type.IsString(left)&&exports_type.IsNumber(Key)?Visit3(left,Value):exports_type.IsArray(left)&&exports_type.IsNumber(Key)?Visit3(left,Value):exports_type.IsObject(left)?(()=>{for(let key of Object.getOwnPropertyNames(left.properties))if(Property(Value,left.properties[key])===ExtendsResult.False)return ExtendsResult.False;return ExtendsResult.True})():ExtendsResult.False}function FromRecord(left,right){return IsStructuralRight(right)?StructuralRight(left,right):exports_type.IsObject(right)?FromObjectRight(left,right):!exports_type.IsRecord(right)?ExtendsResult.False:Visit3(RecordValue(left),RecordValue(right))}function FromRegExp(left,right){let L=exports_type.IsRegExp(left)?String2():left,R=exports_type.IsRegExp(right)?String2():right;return Visit3(L,R)}function FromStringRight(left,right){return exports_type.IsLiteral(left)&&exports_value.IsString(left.const)?ExtendsResult.True:exports_type.IsString(left)?ExtendsResult.True:ExtendsResult.False}function FromString(left,right){return IsStructuralRight(right)?StructuralRight(left,right):exports_type.IsObject(right)?FromObjectRight(left,right):exports_type.IsRecord(right)?FromRecordRight(left,right):exports_type.IsString(right)?ExtendsResult.True:ExtendsResult.False}function FromSymbol(left,right){return IsStructuralRight(right)?StructuralRight(left,right):exports_type.IsObject(right)?FromObjectRight(left,right):exports_type.IsRecord(right)?FromRecordRight(left,right):exports_type.IsSymbol(right)?ExtendsResult.True:ExtendsResult.False}function FromTemplateLiteral2(left,right){return exports_type.IsTemplateLiteral(left)?Visit3(TemplateLiteralToUnion(left),right):exports_type.IsTemplateLiteral(right)?Visit3(left,TemplateLiteralToUnion(right)):Throw("Invalid fallthrough for TemplateLiteral")}function IsArrayOfTuple(left,right){return exports_type.IsArray(right)&&left.items!==void 0&&left.items.every((schema)=>Visit3(schema,right.items)===ExtendsResult.True)}function FromTupleRight(left,right){return exports_type.IsNever(left)?ExtendsResult.True:exports_type.IsUnknown(left)?ExtendsResult.False:exports_type.IsAny(left)?ExtendsResult.Union:ExtendsResult.False}function FromTuple3(left,right){return IsStructuralRight(right)?StructuralRight(left,right):exports_type.IsObject(right)&&IsObjectArrayLike(right)?ExtendsResult.True:exports_type.IsArray(right)&&IsArrayOfTuple(left,right)?ExtendsResult.True:!exports_type.IsTuple(right)?ExtendsResult.False:exports_value.IsUndefined(left.items)&&!exports_value.IsUndefined(right.items)||!exports_value.IsUndefined(left.items)&&exports_value.IsUndefined(right.items)?ExtendsResult.False:exports_value.IsUndefined(left.items)&&!exports_value.IsUndefined(right.items)?ExtendsResult.True:left.items.every((schema,index)=>Visit3(schema,right.items[index])===ExtendsResult.True)?ExtendsResult.True:ExtendsResult.False}function FromUint8Array(left,right){return IsStructuralRight(right)?StructuralRight(left,right):exports_type.IsObject(right)?FromObjectRight(left,right):exports_type.IsRecord(right)?FromRecordRight(left,right):exports_type.IsUint8Array(right)?ExtendsResult.True:ExtendsResult.False}function FromUndefined(left,right){return IsStructuralRight(right)?StructuralRight(left,right):exports_type.IsObject(right)?FromObjectRight(left,right):exports_type.IsRecord(right)?FromRecordRight(left,right):exports_type.IsVoid(right)?FromVoidRight(left,right):exports_type.IsUndefined(right)?ExtendsResult.True:ExtendsResult.False}function FromUnionRight(left,right){return right.anyOf.some((schema)=>Visit3(left,schema)===ExtendsResult.True)?ExtendsResult.True:ExtendsResult.False}function FromUnion6(left,right){return left.anyOf.every((schema)=>Visit3(schema,right)===ExtendsResult.True)?ExtendsResult.True:ExtendsResult.False}function FromUnknownRight(left,right){return ExtendsResult.True}function FromUnknown(left,right){return exports_type.IsNever(right)?FromNeverRight(left,right):exports_type.IsIntersect(right)?FromIntersectRight(left,right):exports_type.IsUnion(right)?FromUnionRight(left,right):exports_type.IsAny(right)?FromAnyRight(left,right):exports_type.IsString(right)?FromStringRight(left,right):exports_type.IsNumber(right)?FromNumberRight(left,right):exports_type.IsInteger(right)?FromIntegerRight(left,right):exports_type.IsBoolean(right)?FromBooleanRight(left,right):exports_type.IsArray(right)?FromArrayRight(left,right):exports_type.IsTuple(right)?FromTupleRight(left,right):exports_type.IsObject(right)?FromObjectRight(left,right):exports_type.IsUnknown(right)?ExtendsResult.True:ExtendsResult.False}function FromVoidRight(left,right){return exports_type.IsUndefined(left)?ExtendsResult.True:exports_type.IsUndefined(left)?ExtendsResult.True:ExtendsResult.False}function FromVoid(left,right){return exports_type.IsIntersect(right)?FromIntersectRight(left,right):exports_type.IsUnion(right)?FromUnionRight(left,right):exports_type.IsUnknown(right)?FromUnknownRight(left,right):exports_type.IsAny(right)?FromAnyRight(left,right):exports_type.IsObject(right)?FromObjectRight(left,right):exports_type.IsVoid(right)?ExtendsResult.True:ExtendsResult.False}function Visit3(left,right){return exports_type.IsTemplateLiteral(left)||exports_type.IsTemplateLiteral(right)?FromTemplateLiteral2(left,right):exports_type.IsRegExp(left)||exports_type.IsRegExp(right)?FromRegExp(left,right):exports_type.IsNot(left)||exports_type.IsNot(right)?FromNot(left,right):exports_type.IsAny(left)?FromAny(left,right):exports_type.IsArray(left)?FromArray4(left,right):exports_type.IsBigInt(left)?FromBigInt(left,right):exports_type.IsBoolean(left)?FromBoolean(left,right):exports_type.IsAsyncIterator(left)?FromAsyncIterator(left,right):exports_type.IsConstructor(left)?FromConstructor(left,right):exports_type.IsDate(left)?FromDate(left,right):exports_type.IsFunction(left)?FromFunction(left,right):exports_type.IsInteger(left)?FromInteger(left,right):exports_type.IsIntersect(left)?FromIntersect4(left,right):exports_type.IsIterator(left)?FromIterator(left,right):exports_type.IsLiteral(left)?FromLiteral2(left,right):exports_type.IsNever(left)?FromNever(left,right):exports_type.IsNull(left)?FromNull(left,right):exports_type.IsNumber(left)?FromNumber(left,right):exports_type.IsObject(left)?FromObject(left,right):exports_type.IsRecord(left)?FromRecord(left,right):exports_type.IsString(left)?FromString(left,right):exports_type.IsSymbol(left)?FromSymbol(left,right):exports_type.IsTuple(left)?FromTuple3(left,right):exports_type.IsPromise(left)?FromPromise2(left,right):exports_type.IsUint8Array(left)?FromUint8Array(left,right):exports_type.IsUndefined(left)?FromUndefined(left,right):exports_type.IsUnion(left)?FromUnion6(left,right):exports_type.IsUnknown(left)?FromUnknown(left,right):exports_type.IsVoid(left)?FromVoid(left,right):Throw(`Unknown left type operand '${left[Kind]}'`)}function ExtendsCheck(left,right){return Visit3(left,right)}function FromProperties8(P,Right,True,False,options){let Acc={};for(let K2 of globalThis.Object.getOwnPropertyNames(P))Acc[K2]=Extends(P[K2],Right,True,False,Clone(options));return Acc}function FromMappedResult6(Left,Right,True,False,options){return FromProperties8(Left.properties,Right,True,False,options)}function ExtendsFromMappedResult(Left,Right,True,False,options){let P=FromMappedResult6(Left,Right,True,False,options);return MappedResult(P)}function ExtendsResolve(left,right,trueType,falseType){let R=ExtendsCheck(left,right);return R===ExtendsResult.Union?Union([trueType,falseType]):R===ExtendsResult.True?trueType:falseType}function Extends(L,R,T,F,options){return IsMappedResult(L)?ExtendsFromMappedResult(L,R,T,F,options):IsMappedKey(L)?CreateType(ExtendsFromMappedKey(L,R,T,F,options)):CreateType(ExtendsResolve(L,R,T,F),options)}function FromPropertyKey(K,U,L,R,options){return{[K]:Extends(Literal(K),U,L,R,Clone(options))}}function FromPropertyKeys(K,U,L,R,options){return K.reduce((Acc,LK)=>{return{...Acc,...FromPropertyKey(LK,U,L,R,options)}},{})}function FromMappedKey2(K,U,L,R,options){return FromPropertyKeys(K.keys,U,L,R,options)}function ExtendsFromMappedKey(T,U,L,R,options){let P=FromMappedKey2(T,U,L,R,options);return MappedResult(P)}function Intersect2(schema){return schema.allOf.every((schema2)=>ExtendsUndefinedCheck(schema2))}function Union2(schema){return schema.anyOf.some((schema2)=>ExtendsUndefinedCheck(schema2))}function Not(schema){return!ExtendsUndefinedCheck(schema.not)}function ExtendsUndefinedCheck(schema){return schema[Kind]==="Intersect"?Intersect2(schema):schema[Kind]==="Union"?Union2(schema):schema[Kind]==="Not"?Not(schema):schema[Kind]==="Undefined"?!0:!1}function ExcludeFromTemplateLiteral(L,R){return Exclude(TemplateLiteralToUnion(L),R)}function ExcludeRest(L,R){let excluded=L.filter((inner)=>ExtendsCheck(inner,R)===ExtendsResult.False);return excluded.length===1?excluded[0]:Union(excluded)}function Exclude(L,R,options={}){if(IsTemplateLiteral(L))return CreateType(ExcludeFromTemplateLiteral(L,R),options);if(IsMappedResult(L))return CreateType(ExcludeFromMappedResult(L,R),options);return CreateType(IsUnion(L)?ExcludeRest(L.anyOf,R):ExtendsCheck(L,R)!==ExtendsResult.False?Never():L,options)}function FromProperties9(P,U){let Acc={};for(let K2 of globalThis.Object.getOwnPropertyNames(P))Acc[K2]=Exclude(P[K2],U);return Acc}function FromMappedResult7(R,T){return FromProperties9(R.properties,T)}function ExcludeFromMappedResult(R,T){let P=FromMappedResult7(R,T);return MappedResult(P)}function ExtractFromTemplateLiteral(L,R){return Extract(TemplateLiteralToUnion(L),R)}function ExtractRest(L,R){let extracted=L.filter((inner)=>ExtendsCheck(inner,R)!==ExtendsResult.False);return extracted.length===1?extracted[0]:Union(extracted)}function Extract(L,R,options){if(IsTemplateLiteral(L))return CreateType(ExtractFromTemplateLiteral(L,R),options);if(IsMappedResult(L))return CreateType(ExtractFromMappedResult(L,R),options);return CreateType(IsUnion(L)?ExtractRest(L.anyOf,R):ExtendsCheck(L,R)!==ExtendsResult.False?L:Never(),options)}function FromProperties10(P,T){let Acc={};for(let K2 of globalThis.Object.getOwnPropertyNames(P))Acc[K2]=Extract(P[K2],T);return Acc}function FromMappedResult8(R,T){return FromProperties10(R.properties,T)}function ExtractFromMappedResult(R,T){let P=FromMappedResult8(R,T);return MappedResult(P)}function InstanceType(schema,options){return IsConstructor(schema)?CreateType(schema.returns,options):Never(options)}function ReadonlyOptional(schema){return Readonly(Optional(schema))}function RecordCreateFromPattern(pattern,T,options){return CreateType({[Kind]:"Record",type:"object",patternProperties:{[pattern]:T}},options)}function RecordCreateFromKeys(K,T,options){let result={};for(let K2 of K)result[K2]=T;return Object2(result,{...options,[Hint]:"Record"})}function FromTemplateLiteralKey(K,T,options){return IsTemplateLiteralFinite(K)?RecordCreateFromKeys(IndexPropertyKeys(K),T,options):RecordCreateFromPattern(K.pattern,T,options)}function FromUnionKey(key,type,options){return RecordCreateFromKeys(IndexPropertyKeys(Union(key)),type,options)}function FromLiteralKey(key,type,options){return RecordCreateFromKeys([key.toString()],type,options)}function FromRegExpKey(key,type,options){return RecordCreateFromPattern(key.source,type,options)}function FromStringKey(key,type,options){let pattern=IsUndefined(key.pattern)?PatternStringExact:key.pattern;return RecordCreateFromPattern(pattern,type,options)}function FromAnyKey(_,type,options){return RecordCreateFromPattern(PatternStringExact,type,options)}function FromNeverKey(_key,type,options){return RecordCreateFromPattern(PatternNeverExact,type,options)}function FromBooleanKey(_key,type,options){return Object2({true:type,false:type},options)}function FromIntegerKey(_key,type,options){return RecordCreateFromPattern(PatternNumberExact,type,options)}function FromNumberKey(_,type,options){return RecordCreateFromPattern(PatternNumberExact,type,options)}function Record(key,type,options={}){return IsUnion(key)?FromUnionKey(key.anyOf,type,options):IsTemplateLiteral(key)?FromTemplateLiteralKey(key,type,options):IsLiteral(key)?FromLiteralKey(key.const,type,options):IsBoolean3(key)?FromBooleanKey(key,type,options):IsInteger2(key)?FromIntegerKey(key,type,options):IsNumber3(key)?FromNumberKey(key,type,options):IsRegExp2(key)?FromRegExpKey(key,type,options):IsString3(key)?FromStringKey(key,type,options):IsAny(key)?FromAnyKey(key,type,options):IsNever(key)?FromNeverKey(key,type,options):Never(options)}function RecordPattern(record){return globalThis.Object.getOwnPropertyNames(record.patternProperties)[0]}function RecordKey2(type){let pattern=RecordPattern(type);return pattern===PatternStringExact?String2():pattern===PatternNumberExact?Number2():String2({pattern})}function RecordValue2(type){return type.patternProperties[RecordPattern(type)]}function FromConstructor2(args,type){return type.parameters=FromTypes(args,type.parameters),type.returns=FromType(args,type.returns),type}function FromFunction2(args,type){return type.parameters=FromTypes(args,type.parameters),type.returns=FromType(args,type.returns),type}function FromIntersect5(args,type){return type.allOf=FromTypes(args,type.allOf),type}function FromUnion7(args,type){return type.anyOf=FromTypes(args,type.anyOf),type}function FromTuple4(args,type){if(IsUndefined(type.items))return type;return type.items=FromTypes(args,type.items),type}function FromArray5(args,type){return type.items=FromType(args,type.items),type}function FromAsyncIterator2(args,type){return type.items=FromType(args,type.items),type}function FromIterator2(args,type){return type.items=FromType(args,type.items),type}function FromPromise3(args,type){return type.item=FromType(args,type.item),type}function FromObject2(args,type){let mappedProperties=FromProperties11(args,type.properties);return{...type,...Object2(mappedProperties)}}function FromRecord2(args,type){let mappedKey=FromType(args,RecordKey2(type)),mappedValue=FromType(args,RecordValue2(type)),result=Record(mappedKey,mappedValue);return{...type,...result}}function FromArgument(args,argument){return argument.index in args?args[argument.index]:Unknown()}function FromProperty2(args,type){let isReadonly=IsReadonly(type),isOptional=IsOptional(type),mapped=FromType(args,type);return isReadonly&&isOptional?ReadonlyOptional(mapped):isReadonly&&!isOptional?Readonly(mapped):!isReadonly&&isOptional?Optional(mapped):mapped}function FromProperties11(args,properties){return globalThis.Object.getOwnPropertyNames(properties).reduce((result,key)=>{return{...result,[key]:FromProperty2(args,properties[key])}},{})}function FromTypes(args,types){return types.map((type)=>FromType(args,type))}function FromType(args,type){return IsConstructor(type)?FromConstructor2(args,type):IsFunction3(type)?FromFunction2(args,type):IsIntersect(type)?FromIntersect5(args,type):IsUnion(type)?FromUnion7(args,type):IsTuple(type)?FromTuple4(args,type):IsArray3(type)?FromArray5(args,type):IsAsyncIterator3(type)?FromAsyncIterator2(args,type):IsIterator3(type)?FromIterator2(args,type):IsPromise2(type)?FromPromise3(args,type):IsObject3(type)?FromObject2(args,type):IsRecord(type)?FromRecord2(args,type):IsArgument(type)?FromArgument(args,type):type}function Instantiate(type,args){return FromType(args,CloneType(type))}function Integer(options){return CreateType({[Kind]:"Integer",type:"integer"},options)}function MappedIntrinsicPropertyKey(K,M,options){return{[K]:Intrinsic(Literal(K),M,Clone(options))}}function MappedIntrinsicPropertyKeys(K,M,options){return K.reduce((Acc,L)=>{return{...Acc,...MappedIntrinsicPropertyKey(L,M,options)}},{})}function MappedIntrinsicProperties(T,M,options){return MappedIntrinsicPropertyKeys(T.keys,M,options)}function IntrinsicFromMappedKey(T,M,options){let P=MappedIntrinsicProperties(T,M,options);return MappedResult(P)}function ApplyUncapitalize(value){let[first,rest]=[value.slice(0,1),value.slice(1)];return[first.toLowerCase(),rest].join("")}function ApplyCapitalize(value){let[first,rest]=[value.slice(0,1),value.slice(1)];return[first.toUpperCase(),rest].join("")}function ApplyUppercase(value){return value.toUpperCase()}function ApplyLowercase(value){return value.toLowerCase()}function FromTemplateLiteral3(schema,mode,options){let expression=TemplateLiteralParseExact(schema.pattern);if(!IsTemplateLiteralExpressionFinite(expression))return{...schema,pattern:FromLiteralValue(schema.pattern,mode)};let literals=[...TemplateLiteralExpressionGenerate(expression)].map((value)=>Literal(value)),mapped=FromRest5(literals,mode),union=Union(mapped);return TemplateLiteral([union],options)}function FromLiteralValue(value,mode){return typeof value==="string"?mode==="Uncapitalize"?ApplyUncapitalize(value):mode==="Capitalize"?ApplyCapitalize(value):mode==="Uppercase"?ApplyUppercase(value):mode==="Lowercase"?ApplyLowercase(value):value:value.toString()}function FromRest5(T,M){return T.map((L)=>Intrinsic(L,M))}function Intrinsic(schema,mode,options={}){return IsMappedKey(schema)?IntrinsicFromMappedKey(schema,mode,options):IsTemplateLiteral(schema)?FromTemplateLiteral3(schema,mode,options):IsUnion(schema)?Union(FromRest5(schema.anyOf,mode),options):IsLiteral(schema)?Literal(FromLiteralValue(schema.const,mode),options):CreateType(schema,options)}function Capitalize(T,options={}){return Intrinsic(T,"Capitalize",options)}function Lowercase(T,options={}){return Intrinsic(T,"Lowercase",options)}function Uncapitalize(T,options={}){return Intrinsic(T,"Uncapitalize",options)}function Uppercase(T,options={}){return Intrinsic(T,"Uppercase",options)}function FromProperties12(properties,propertyKeys,options){let result={};for(let K2 of globalThis.Object.getOwnPropertyNames(properties))result[K2]=Omit(properties[K2],propertyKeys,Clone(options));return result}function FromMappedResult9(mappedResult,propertyKeys,options){return FromProperties12(mappedResult.properties,propertyKeys,options)}function OmitFromMappedResult(mappedResult,propertyKeys,options){let properties=FromMappedResult9(mappedResult,propertyKeys,options);return MappedResult(properties)}function FromIntersect6(types,propertyKeys){return types.map((type)=>OmitResolve(type,propertyKeys))}function FromUnion8(types,propertyKeys){return types.map((type)=>OmitResolve(type,propertyKeys))}function FromProperty3(properties,key){let{[key]:_,...R}=properties;return R}function FromProperties13(properties,propertyKeys){return propertyKeys.reduce((T,K2)=>FromProperty3(T,K2),properties)}function FromObject3(properties,propertyKeys){let options=Discard(properties,[TransformKind,"$id","required","properties"]),omittedProperties=FromProperties13(properties.properties,propertyKeys);return Object2(omittedProperties,options)}function UnionFromPropertyKeys(propertyKeys){let result=propertyKeys.reduce((result2,key)=>IsLiteralValue(key)?[...result2,Literal(key)]:result2,[]);return Union(result)}function OmitResolve(properties,propertyKeys){return IsIntersect(properties)?Intersect(FromIntersect6(properties.allOf,propertyKeys)):IsUnion(properties)?Union(FromUnion8(properties.anyOf,propertyKeys)):IsObject3(properties)?FromObject3(properties,propertyKeys):Object2({})}function Omit(type,key,options){let typeKey=IsArray(key)?UnionFromPropertyKeys(key):key,propertyKeys=IsSchema(key)?IndexPropertyKeys(key):key,isTypeRef=IsRef(type),isKeyRef=IsRef(key);return IsMappedResult(type)?OmitFromMappedResult(type,propertyKeys,options):IsMappedKey(key)?OmitFromMappedKey(type,key,options):isTypeRef&&isKeyRef?Computed("Omit",[type,typeKey],options):!isTypeRef&&isKeyRef?Computed("Omit",[type,typeKey],options):isTypeRef&&!isKeyRef?Computed("Omit",[type,typeKey],options):CreateType({...OmitResolve(type,propertyKeys),...options})}function FromPropertyKey2(type,key,options){return{[key]:Omit(type,[key],Clone(options))}}function FromPropertyKeys2(type,propertyKeys,options){return propertyKeys.reduce((Acc,LK)=>{return{...Acc,...FromPropertyKey2(type,LK,options)}},{})}function FromMappedKey3(type,mappedKey,options){return FromPropertyKeys2(type,mappedKey.keys,options)}function OmitFromMappedKey(type,mappedKey,options){let properties=FromMappedKey3(type,mappedKey,options);return MappedResult(properties)}function FromProperties14(properties,propertyKeys,options){let result={};for(let K2 of globalThis.Object.getOwnPropertyNames(properties))result[K2]=Pick(properties[K2],propertyKeys,Clone(options));return result}function FromMappedResult10(mappedResult,propertyKeys,options){return FromProperties14(mappedResult.properties,propertyKeys,options)}function PickFromMappedResult(mappedResult,propertyKeys,options){let properties=FromMappedResult10(mappedResult,propertyKeys,options);return MappedResult(properties)}function FromIntersect7(types,propertyKeys){return types.map((type)=>PickResolve(type,propertyKeys))}function FromUnion9(types,propertyKeys){return types.map((type)=>PickResolve(type,propertyKeys))}function FromProperties15(properties,propertyKeys){let result={};for(let K2 of propertyKeys)if(K2 in properties)result[K2]=properties[K2];return result}function FromObject4(T,K){let options=Discard(T,[TransformKind,"$id","required","properties"]),properties=FromProperties15(T.properties,K);return Object2(properties,options)}function UnionFromPropertyKeys2(propertyKeys){let result=propertyKeys.reduce((result2,key)=>IsLiteralValue(key)?[...result2,Literal(key)]:result2,[]);return Union(result)}function PickResolve(properties,propertyKeys){return IsIntersect(properties)?Intersect(FromIntersect7(properties.allOf,propertyKeys)):IsUnion(properties)?Union(FromUnion9(properties.anyOf,propertyKeys)):IsObject3(properties)?FromObject4(properties,propertyKeys):Object2({})}function Pick(type,key,options){let typeKey=IsArray(key)?UnionFromPropertyKeys2(key):key,propertyKeys=IsSchema(key)?IndexPropertyKeys(key):key,isTypeRef=IsRef(type),isKeyRef=IsRef(key);return IsMappedResult(type)?PickFromMappedResult(type,propertyKeys,options):IsMappedKey(key)?PickFromMappedKey(type,key,options):isTypeRef&&isKeyRef?Computed("Pick",[type,typeKey],options):!isTypeRef&&isKeyRef?Computed("Pick",[type,typeKey],options):isTypeRef&&!isKeyRef?Computed("Pick",[type,typeKey],options):CreateType({...PickResolve(type,propertyKeys),...options})}function FromPropertyKey3(type,key,options){return{[key]:Pick(type,[key],Clone(options))}}function FromPropertyKeys3(type,propertyKeys,options){return propertyKeys.reduce((result,leftKey)=>{return{...result,...FromPropertyKey3(type,leftKey,options)}},{})}function FromMappedKey4(type,mappedKey,options){return FromPropertyKeys3(type,mappedKey.keys,options)}function PickFromMappedKey(type,mappedKey,options){let properties=FromMappedKey4(type,mappedKey,options);return MappedResult(properties)}function FromComputed3(target,parameters){return Computed("Partial",[Computed(target,parameters)])}function FromRef3($ref){return Computed("Partial",[Ref($ref)])}function FromProperties16(properties){let partialProperties={};for(let K of globalThis.Object.getOwnPropertyNames(properties))partialProperties[K]=Optional(properties[K]);return partialProperties}function FromObject5(type){let options=Discard(type,[TransformKind,"$id","required","properties"]),properties=FromProperties16(type.properties);return Object2(properties,options)}function FromRest6(types){return types.map((type)=>PartialResolve(type))}function PartialResolve(type){return IsComputed(type)?FromComputed3(type.target,type.parameters):IsRef(type)?FromRef3(type.$ref):IsIntersect(type)?Intersect(FromRest6(type.allOf)):IsUnion(type)?Union(FromRest6(type.anyOf)):IsObject3(type)?FromObject5(type):IsBigInt3(type)?type:IsBoolean3(type)?type:IsInteger2(type)?type:IsLiteral(type)?type:IsNull3(type)?type:IsNumber3(type)?type:IsString3(type)?type:IsSymbol3(type)?type:IsUndefined3(type)?type:Object2({})}function Partial(type,options){if(IsMappedResult(type))return PartialFromMappedResult(type,options);else return CreateType({...PartialResolve(type),...options})}function FromProperties17(K,options){let Acc={};for(let K2 of globalThis.Object.getOwnPropertyNames(K))Acc[K2]=Partial(K[K2],Clone(options));return Acc}function FromMappedResult11(R,options){return FromProperties17(R.properties,options)}function PartialFromMappedResult(R,options){let P=FromMappedResult11(R,options);return MappedResult(P)}function FromComputed4(target,parameters){return Computed("Required",[Computed(target,parameters)])}function FromRef4($ref){return Computed("Required",[Ref($ref)])}function FromProperties18(properties){let requiredProperties={};for(let K of globalThis.Object.getOwnPropertyNames(properties))requiredProperties[K]=Discard(properties[K],[OptionalKind]);return requiredProperties}function FromObject6(type){let options=Discard(type,[TransformKind,"$id","required","properties"]),properties=FromProperties18(type.properties);return Object2(properties,options)}function FromRest7(types){return types.map((type)=>RequiredResolve(type))}function RequiredResolve(type){return IsComputed(type)?FromComputed4(type.target,type.parameters):IsRef(type)?FromRef4(type.$ref):IsIntersect(type)?Intersect(FromRest7(type.allOf)):IsUnion(type)?Union(FromRest7(type.anyOf)):IsObject3(type)?FromObject6(type):IsBigInt3(type)?type:IsBoolean3(type)?type:IsInteger2(type)?type:IsLiteral(type)?type:IsNull3(type)?type:IsNumber3(type)?type:IsString3(type)?type:IsSymbol3(type)?type:IsUndefined3(type)?type:Object2({})}function Required(type,options){if(IsMappedResult(type))return RequiredFromMappedResult(type,options);else return CreateType({...RequiredResolve(type),...options})}function FromProperties19(P,options){let Acc={};for(let K2 of globalThis.Object.getOwnPropertyNames(P))Acc[K2]=Required(P[K2],options);return Acc}function FromMappedResult12(R,options){return FromProperties19(R.properties,options)}function RequiredFromMappedResult(R,options){let P=FromMappedResult12(R,options);return MappedResult(P)}function DereferenceParameters(moduleProperties,types){return types.map((type)=>{return IsRef(type)?Dereference(moduleProperties,type.$ref):FromType2(moduleProperties,type)})}function Dereference(moduleProperties,ref){return ref in moduleProperties?IsRef(moduleProperties[ref])?Dereference(moduleProperties,moduleProperties[ref].$ref):FromType2(moduleProperties,moduleProperties[ref]):Never()}function FromAwaited(parameters){return Awaited(parameters[0])}function FromIndex(parameters){return Index(parameters[0],parameters[1])}function FromKeyOf(parameters){return KeyOf(parameters[0])}function FromPartial(parameters){return Partial(parameters[0])}function FromOmit(parameters){return Omit(parameters[0],parameters[1])}function FromPick(parameters){return Pick(parameters[0],parameters[1])}function FromRequired(parameters){return Required(parameters[0])}function FromComputed5(moduleProperties,target,parameters){let dereferenced=DereferenceParameters(moduleProperties,parameters);return target==="Awaited"?FromAwaited(dereferenced):target==="Index"?FromIndex(dereferenced):target==="KeyOf"?FromKeyOf(dereferenced):target==="Partial"?FromPartial(dereferenced):target==="Omit"?FromOmit(dereferenced):target==="Pick"?FromPick(dereferenced):target==="Required"?FromRequired(dereferenced):Never()}function FromArray6(moduleProperties,type){return Array2(FromType2(moduleProperties,type))}function FromAsyncIterator3(moduleProperties,type){return AsyncIterator2(FromType2(moduleProperties,type))}function FromConstructor3(moduleProperties,parameters,instanceType){return Constructor(FromTypes2(moduleProperties,parameters),FromType2(moduleProperties,instanceType))}function FromFunction3(moduleProperties,parameters,returnType){return Function2(FromTypes2(moduleProperties,parameters),FromType2(moduleProperties,returnType))}function FromIntersect8(moduleProperties,types){return Intersect(FromTypes2(moduleProperties,types))}function FromIterator3(moduleProperties,type){return Iterator2(FromType2(moduleProperties,type))}function FromObject7(moduleProperties,properties){return Object2(globalThis.Object.keys(properties).reduce((result,key)=>{return{...result,[key]:FromType2(moduleProperties,properties[key])}},{}))}function FromRecord3(moduleProperties,type){let[value,pattern]=[FromType2(moduleProperties,RecordValue2(type)),RecordPattern(type)],result=CloneType(type);return result.patternProperties[pattern]=value,result}function FromTransform(moduleProperties,transform){return IsRef(transform)?{...Dereference(moduleProperties,transform.$ref),[TransformKind]:transform[TransformKind]}:transform}function FromTuple5(moduleProperties,types){return Tuple(FromTypes2(moduleProperties,types))}function FromUnion10(moduleProperties,types){return Union(FromTypes2(moduleProperties,types))}function FromTypes2(moduleProperties,types){return types.map((type)=>FromType2(moduleProperties,type))}function FromType2(moduleProperties,type){return IsOptional(type)?CreateType(FromType2(moduleProperties,Discard(type,[OptionalKind])),type):IsReadonly(type)?CreateType(FromType2(moduleProperties,Discard(type,[ReadonlyKind])),type):IsTransform(type)?CreateType(FromTransform(moduleProperties,type),type):IsArray3(type)?CreateType(FromArray6(moduleProperties,type.items),type):IsAsyncIterator3(type)?CreateType(FromAsyncIterator3(moduleProperties,type.items),type):IsComputed(type)?CreateType(FromComputed5(moduleProperties,type.target,type.parameters)):IsConstructor(type)?CreateType(FromConstructor3(moduleProperties,type.parameters,type.returns),type):IsFunction3(type)?CreateType(FromFunction3(moduleProperties,type.parameters,type.returns),type):IsIntersect(type)?CreateType(FromIntersect8(moduleProperties,type.allOf),type):IsIterator3(type)?CreateType(FromIterator3(moduleProperties,type.items),type):IsObject3(type)?CreateType(FromObject7(moduleProperties,type.properties),type):IsRecord(type)?CreateType(FromRecord3(moduleProperties,type)):IsTuple(type)?CreateType(FromTuple5(moduleProperties,type.items||[]),type):IsUnion(type)?CreateType(FromUnion10(moduleProperties,type.anyOf),type):type}function ComputeType(moduleProperties,key){return key in moduleProperties?FromType2(moduleProperties,moduleProperties[key]):Never()}function ComputeModuleProperties(moduleProperties){return globalThis.Object.getOwnPropertyNames(moduleProperties).reduce((result,key)=>{return{...result,[key]:ComputeType(moduleProperties,key)}},{})}class TModule{constructor($defs){let computed=ComputeModuleProperties($defs),identified=this.WithIdentifiers(computed);this.$defs=identified}Import(key,options){let $defs={...this.$defs,[key]:CreateType(this.$defs[key],options)};return CreateType({[Kind]:"Import",$defs,$ref:key})}WithIdentifiers($defs){return globalThis.Object.getOwnPropertyNames($defs).reduce((result,key)=>{return{...result,[key]:{...$defs[key],$id:key}}},{})}}function Module(properties){return new TModule(properties)}function Not2(type,options){return CreateType({[Kind]:"Not",not:type},options)}function Parameters(schema,options){return IsFunction3(schema)?Tuple(schema.parameters,options):Never()}var Ordinal=0;function Recursive(callback,options={}){if(IsUndefined(options.$id))options.$id=`T${Ordinal++}`;let thisType=CloneType(callback({[Kind]:"This",$ref:`${options.$id}`}));return thisType.$id=options.$id,CreateType({[Hint]:"Recursive",...thisType},options)}function RegExp2(unresolved,options){let expr=IsString(unresolved)?new globalThis.RegExp(unresolved):unresolved;return CreateType({[Kind]:"RegExp",type:"RegExp",source:expr.source,flags:expr.flags},options)}function RestResolve(T){return IsIntersect(T)?T.allOf:IsUnion(T)?T.anyOf:IsTuple(T)?T.items??[]:[]}function Rest(T){return RestResolve(T)}function ReturnType(schema,options){return IsFunction3(schema)?CreateType(schema.returns,options):Never(options)}class TransformDecodeBuilder{constructor(schema){this.schema=schema}Decode(decode){return new TransformEncodeBuilder(this.schema,decode)}}class TransformEncodeBuilder{constructor(schema,decode){this.schema=schema,this.decode=decode}EncodeTransform(encode,schema){let Codec={Encode:(value)=>schema[TransformKind].Encode(encode(value)),Decode:(value)=>this.decode(schema[TransformKind].Decode(value))};return{...schema,[TransformKind]:Codec}}EncodeSchema(encode,schema){let Codec={Decode:this.decode,Encode:encode};return{...schema,[TransformKind]:Codec}}Encode(encode){return IsTransform(this.schema)?this.EncodeTransform(encode,this.schema):this.EncodeSchema(encode,this.schema)}}function Transform(schema){return new TransformDecodeBuilder(schema)}function Unsafe(options={}){return CreateType({[Kind]:options[Kind]??"Unsafe"},options)}function Void(options){return CreateType({[Kind]:"Void",type:"void"},options)}var exports_type3={};__export(exports_type3,{Void:()=>Void,Uppercase:()=>Uppercase,Unsafe:()=>Unsafe,Unknown:()=>Unknown,Union:()=>Union,Undefined:()=>Undefined,Uncapitalize:()=>Uncapitalize,Uint8Array:()=>Uint8Array2,Tuple:()=>Tuple,Transform:()=>Transform,TemplateLiteral:()=>TemplateLiteral,Symbol:()=>Symbol2,String:()=>String2,ReturnType:()=>ReturnType,Rest:()=>Rest,Required:()=>Required,RegExp:()=>RegExp2,Ref:()=>Ref,Recursive:()=>Recursive,Record:()=>Record,ReadonlyOptional:()=>ReadonlyOptional,Readonly:()=>Readonly,Promise:()=>Promise2,Pick:()=>Pick,Partial:()=>Partial,Parameters:()=>Parameters,Optional:()=>Optional,Omit:()=>Omit,Object:()=>Object2,Number:()=>Number2,Null:()=>Null,Not:()=>Not2,Never:()=>Never,Module:()=>Module,Mapped:()=>Mapped,Lowercase:()=>Lowercase,Literal:()=>Literal,KeyOf:()=>KeyOf,Iterator:()=>Iterator2,Intersect:()=>Intersect,Integer:()=>Integer,Instantiate:()=>Instantiate,InstanceType:()=>InstanceType,Index:()=>Index,Function:()=>Function2,Extract:()=>Extract,Extends:()=>Extends,Exclude:()=>Exclude,Enum:()=>Enum,Date:()=>Date2,ConstructorParameters:()=>ConstructorParameters,Constructor:()=>Constructor,Const:()=>Const,Composite:()=>Composite,Capitalize:()=>Capitalize,Boolean:()=>Boolean2,BigInt:()=>BigInt2,Awaited:()=>Awaited,AsyncIterator:()=>AsyncIterator2,Array:()=>Array2,Argument:()=>Argument,Any:()=>Any});var Type=exports_type3;function DefaultErrorFunction(error){switch(error.errorType){case ValueErrorType.ArrayContains:return"Expected array to contain at least one matching value";case ValueErrorType.ArrayMaxContains:return`Expected array to contain no more than ${error.schema.maxContains} matching values`;case ValueErrorType.ArrayMinContains:return`Expected array to contain at least ${error.schema.minContains} matching values`;case ValueErrorType.ArrayMaxItems:return`Expected array length to be less or equal to ${error.schema.maxItems}`;case ValueErrorType.ArrayMinItems:return`Expected array length to be greater or equal to ${error.schema.minItems}`;case ValueErrorType.ArrayUniqueItems:return"Expected array elements to be unique";case ValueErrorType.Array:return"Expected array";case ValueErrorType.AsyncIterator:return"Expected AsyncIterator";case ValueErrorType.BigIntExclusiveMaximum:return`Expected bigint to be less than ${error.schema.exclusiveMaximum}`;case ValueErrorType.BigIntExclusiveMinimum:return`Expected bigint to be greater than ${error.schema.exclusiveMinimum}`;case ValueErrorType.BigIntMaximum:return`Expected bigint to be less or equal to ${error.schema.maximum}`;case ValueErrorType.BigIntMinimum:return`Expected bigint to be greater or equal to ${error.schema.minimum}`;case ValueErrorType.BigIntMultipleOf:return`Expected bigint to be a multiple of ${error.schema.multipleOf}`;case ValueErrorType.BigInt:return"Expected bigint";case ValueErrorType.Boolean:return"Expected boolean";case ValueErrorType.DateExclusiveMinimumTimestamp:return`Expected Date timestamp to be greater than ${error.schema.exclusiveMinimumTimestamp}`;case ValueErrorType.DateExclusiveMaximumTimestamp:return`Expected Date timestamp to be less than ${error.schema.exclusiveMaximumTimestamp}`;case ValueErrorType.DateMinimumTimestamp:return`Expected Date timestamp to be greater or equal to ${error.schema.minimumTimestamp}`;case ValueErrorType.DateMaximumTimestamp:return`Expected Date timestamp to be less or equal to ${error.schema.maximumTimestamp}`;case ValueErrorType.DateMultipleOfTimestamp:return`Expected Date timestamp to be a multiple of ${error.schema.multipleOfTimestamp}`;case ValueErrorType.Date:return"Expected Date";case ValueErrorType.Function:return"Expected function";case ValueErrorType.IntegerExclusiveMaximum:return`Expected integer to be less than ${error.schema.exclusiveMaximum}`;case ValueErrorType.IntegerExclusiveMinimum:return`Expected integer to be greater than ${error.schema.exclusiveMinimum}`;case ValueErrorType.IntegerMaximum:return`Expected integer to be less or equal to ${error.schema.maximum}`;case ValueErrorType.IntegerMinimum:return`Expected integer to be greater or equal to ${error.schema.minimum}`;case ValueErrorType.IntegerMultipleOf:return`Expected integer to be a multiple of ${error.schema.multipleOf}`;case ValueErrorType.Integer:return"Expected integer";case ValueErrorType.IntersectUnevaluatedProperties:return"Unexpected property";case ValueErrorType.Intersect:return"Expected all values to match";case ValueErrorType.Iterator:return"Expected Iterator";case ValueErrorType.Literal:return`Expected ${typeof error.schema.const==="string"?`'${error.schema.const}'`:error.schema.const}`;case ValueErrorType.Never:return"Never";case ValueErrorType.Not:return"Value should not match";case ValueErrorType.Null:return"Expected null";case ValueErrorType.NumberExclusiveMaximum:return`Expected number to be less than ${error.schema.exclusiveMaximum}`;case ValueErrorType.NumberExclusiveMinimum:return`Expected number to be greater than ${error.schema.exclusiveMinimum}`;case ValueErrorType.NumberMaximum:return`Expected number to be less or equal to ${error.schema.maximum}`;case ValueErrorType.NumberMinimum:return`Expected number to be greater or equal to ${error.schema.minimum}`;case ValueErrorType.NumberMultipleOf:return`Expected number to be a multiple of ${error.schema.multipleOf}`;case ValueErrorType.Number:return"Expected number";case ValueErrorType.Object:return"Expected object";case ValueErrorType.ObjectAdditionalProperties:return"Unexpected property";case ValueErrorType.ObjectMaxProperties:return`Expected object to have no more than ${error.schema.maxProperties} properties`;case ValueErrorType.ObjectMinProperties:return`Expected object to have at least ${error.schema.minProperties} properties`;case ValueErrorType.ObjectRequiredProperty:return"Expected required property";case ValueErrorType.Promise:return"Expected Promise";case ValueErrorType.RegExp:return"Expected string to match regular expression";case ValueErrorType.StringFormatUnknown:return`Unknown format '${error.schema.format}'`;case ValueErrorType.StringFormat:return`Expected string to match '${error.schema.format}' format`;case ValueErrorType.StringMaxLength:return`Expected string length less or equal to ${error.schema.maxLength}`;case ValueErrorType.StringMinLength:return`Expected string length greater or equal to ${error.schema.minLength}`;case ValueErrorType.StringPattern:return`Expected string to match '${error.schema.pattern}'`;case ValueErrorType.String:return"Expected string";case ValueErrorType.Symbol:return"Expected symbol";case ValueErrorType.TupleLength:return`Expected tuple to have ${error.schema.maxItems||0} elements`;case ValueErrorType.Tuple:return"Expected tuple";case ValueErrorType.Uint8ArrayMaxByteLength:return`Expected byte length less or equal to ${error.schema.maxByteLength}`;case ValueErrorType.Uint8ArrayMinByteLength:return`Expected byte length greater or equal to ${error.schema.minByteLength}`;case ValueErrorType.Uint8Array:return"Expected Uint8Array";case ValueErrorType.Undefined:return"Expected undefined";case ValueErrorType.Union:return"Expected union value";case ValueErrorType.Void:return"Expected void";case ValueErrorType.Kind:return`Expected kind '${error.schema[Kind]}'`;default:return"Unknown error type"}}var errorFunction=DefaultErrorFunction;function GetErrorFunction(){return errorFunction}class TypeDereferenceError extends TypeBoxError{constructor(schema){super(`Unable to dereference schema with $id '${schema.$ref}'`);this.schema=schema}}function Resolve(schema,references){let target=references.find((target2)=>target2.$id===schema.$ref);if(target===void 0)throw new TypeDereferenceError(schema);return Deref(target,references)}function Pushref(schema,references){if(!IsString2(schema.$id)||references.some((target)=>target.$id===schema.$id))return references;return references.push(schema),references}function Deref(schema,references){return schema[Kind]==="This"||schema[Kind]==="Ref"?Resolve(schema,references):schema}class ValueHashError extends TypeBoxError{constructor(value){super("Unable to hash value");this.value=value}}var ByteMarker;(function(ByteMarker2){ByteMarker2[ByteMarker2.Undefined=0]="Undefined",ByteMarker2[ByteMarker2.Null=1]="Null",ByteMarker2[ByteMarker2.Boolean=2]="Boolean",ByteMarker2[ByteMarker2.Number=3]="Number",ByteMarker2[ByteMarker2.String=4]="String",ByteMarker2[ByteMarker2.Object=5]="Object",ByteMarker2[ByteMarker2.Array=6]="Array",ByteMarker2[ByteMarker2.Date=7]="Date",ByteMarker2[ByteMarker2.Uint8Array=8]="Uint8Array",ByteMarker2[ByteMarker2.Symbol=9]="Symbol",ByteMarker2[ByteMarker2.BigInt=10]="BigInt"})(ByteMarker||(ByteMarker={}));var Accumulator=BigInt("14695981039346656037"),[Prime,Size]=[BigInt("1099511628211"),BigInt("18446744073709551616")],Bytes=Array.from({length:256}).map((_,i)=>BigInt(i)),F64=new Float64Array(1),F64In=new DataView(F64.buffer),F64Out=new Uint8Array(F64.buffer);function*NumberToBytes(value){let byteCount=value===0?1:Math.ceil(Math.floor(Math.log2(value)+1)/8);for(let i=0;i<byteCount;i++)yield value>>8*(byteCount-1-i)&255}function ArrayType2(value){FNV1A64(ByteMarker.Array);for(let item of value)Visit4(item)}function BooleanType(value){FNV1A64(ByteMarker.Boolean),FNV1A64(value?1:0)}function BigIntType(value){FNV1A64(ByteMarker.BigInt),F64In.setBigInt64(0,value);for(let byte of F64Out)FNV1A64(byte)}function DateType2(value){FNV1A64(ByteMarker.Date),Visit4(value.getTime())}function NullType(value){FNV1A64(ByteMarker.Null)}function NumberType(value){FNV1A64(ByteMarker.Number),F64In.setFloat64(0,value);for(let byte of F64Out)FNV1A64(byte)}function ObjectType2(value){FNV1A64(ByteMarker.Object);for(let key of globalThis.Object.getOwnPropertyNames(value).sort())Visit4(key),Visit4(value[key])}function StringType(value){FNV1A64(ByteMarker.String);for(let i=0;i<value.length;i++)for(let byte of NumberToBytes(value.charCodeAt(i)))FNV1A64(byte)}function SymbolType(value){FNV1A64(ByteMarker.Symbol),Visit4(value.description)}function Uint8ArrayType2(value){FNV1A64(ByteMarker.Uint8Array);for(let i=0;i<value.length;i++)FNV1A64(value[i])}function UndefinedType(value){return FNV1A64(ByteMarker.Undefined)}function Visit4(value){if(IsArray2(value))return ArrayType2(value);if(IsBoolean2(value))return BooleanType(value);if(IsBigInt2(value))return BigIntType(value);if(IsDate2(value))return DateType2(value);if(IsNull2(value))return NullType(value);if(IsNumber2(value))return NumberType(value);if(IsObject2(value))return ObjectType2(value);if(IsString2(value))return StringType(value);if(IsSymbol2(value))return SymbolType(value);if(IsUint8Array2(value))return Uint8ArrayType2(value);if(IsUndefined2(value))return UndefinedType(value);throw new ValueHashError(value)}function FNV1A64(byte){Accumulator=Accumulator^Bytes[byte],Accumulator=Accumulator*Prime%Size}function Hash(value){return Accumulator=BigInt("14695981039346656037"),Visit4(value),Accumulator}class ValueCheckUnknownTypeError extends TypeBoxError{constructor(schema){super("Unknown type");this.schema=schema}}function IsAnyOrUnknown(schema){return schema[Kind]==="Any"||schema[Kind]==="Unknown"}function IsDefined(value){return value!==void 0}function FromAny2(schema,references,value){return!0}function FromArgument2(schema,references,value){return!0}function FromArray7(schema,references,value){if(!IsArray2(value))return!1;if(IsDefined(schema.minItems)&&!(value.length>=schema.minItems))return!1;if(IsDefined(schema.maxItems)&&!(value.length<=schema.maxItems))return!1;if(!value.every((value2)=>Visit5(schema.items,references,value2)))return!1;if(schema.uniqueItems===!0&&!function(){let set2=new Set;for(let element of value){let hashed=Hash(element);if(set2.has(hashed))return!1;else set2.add(hashed)}return!0}())return!1;if(!(IsDefined(schema.contains)||IsNumber2(schema.minContains)||IsNumber2(schema.maxContains)))return!0;let containsSchema=IsDefined(schema.contains)?schema.contains:Never(),containsCount=value.reduce((acc,value2)=>Visit5(containsSchema,references,value2)?acc+1:acc,0);if(containsCount===0)return!1;if(IsNumber2(schema.minContains)&&containsCount<schema.minContains)return!1;if(IsNumber2(schema.maxContains)&&containsCount>schema.maxContains)return!1;return!0}function FromAsyncIterator4(schema,references,value){return IsAsyncIterator2(value)}function FromBigInt2(schema,references,value){if(!IsBigInt2(value))return!1;if(IsDefined(schema.exclusiveMaximum)&&!(value<schema.exclusiveMaximum))return!1;if(IsDefined(schema.exclusiveMinimum)&&!(value>schema.exclusiveMinimum))return!1;if(IsDefined(schema.maximum)&&!(value<=schema.maximum))return!1;if(IsDefined(schema.minimum)&&!(value>=schema.minimum))return!1;if(IsDefined(schema.multipleOf)&&value%schema.multipleOf!==BigInt(0))return!1;return!0}function FromBoolean2(schema,references,value){return IsBoolean2(value)}function FromConstructor4(schema,references,value){return Visit5(schema.returns,references,value.prototype)}function FromDate2(schema,references,value){if(!IsDate2(value))return!1;if(IsDefined(schema.exclusiveMaximumTimestamp)&&!(value.getTime()<schema.exclusiveMaximumTimestamp))return!1;if(IsDefined(schema.exclusiveMinimumTimestamp)&&!(value.getTime()>schema.exclusiveMinimumTimestamp))return!1;if(IsDefined(schema.maximumTimestamp)&&!(value.getTime()<=schema.maximumTimestamp))return!1;if(IsDefined(schema.minimumTimestamp)&&!(value.getTime()>=schema.minimumTimestamp))return!1;if(IsDefined(schema.multipleOfTimestamp)&&value.getTime()%schema.multipleOfTimestamp!==0)return!1;return!0}function FromFunction4(schema,references,value){return IsFunction2(value)}function FromImport(schema,references,value){let definitions=globalThis.Object.values(schema.$defs),target=schema.$defs[schema.$ref];return Visit5(target,[...references,...definitions],value)}function FromInteger2(schema,references,value){if(!IsInteger(value))return!1;if(IsDefined(schema.exclusiveMaximum)&&!(value<schema.exclusiveMaximum))return!1;if(IsDefined(schema.exclusiveMinimum)&&!(value>schema.exclusiveMinimum))return!1;if(IsDefined(schema.maximum)&&!(value<=schema.maximum))return!1;if(IsDefined(schema.minimum)&&!(value>=schema.minimum))return!1;if(IsDefined(schema.multipleOf)&&value%schema.multipleOf!==0)return!1;return!0}function FromIntersect9(schema,references,value){let check1=schema.allOf.every((schema2)=>Visit5(schema2,references,value));if(schema.unevaluatedProperties===!1){let keyPattern=new RegExp(KeyOfPattern(schema)),check2=Object.getOwnPropertyNames(value).every((key)=>keyPattern.test(key));return check1&&check2}else if(IsSchema(schema.unevaluatedProperties)){let keyCheck=new RegExp(KeyOfPattern(schema)),check2=Object.getOwnPropertyNames(value).every((key)=>keyCheck.test(key)||Visit5(schema.unevaluatedProperties,references,value[key]));return check1&&check2}else return check1}function FromIterator4(schema,references,value){return IsIterator2(value)}function FromLiteral3(schema,references,value){return value===schema.const}function FromNever2(schema,references,value){return!1}function FromNot2(schema,references,value){return!Visit5(schema.not,references,value)}function FromNull2(schema,references,value){return IsNull2(value)}function FromNumber2(schema,references,value){if(!TypeSystemPolicy.IsNumberLike(value))return!1;if(IsDefined(schema.exclusiveMaximum)&&!(value<schema.exclusiveMaximum))return!1;if(IsDefined(schema.exclusiveMinimum)&&!(value>schema.exclusiveMinimum))return!1;if(IsDefined(schema.minimum)&&!(value>=schema.minimum))return!1;if(IsDefined(schema.maximum)&&!(value<=schema.maximum))return!1;if(IsDefined(schema.multipleOf)&&value%schema.multipleOf!==0)return!1;return!0}function FromObject8(schema,references,value){if(!TypeSystemPolicy.IsObjectLike(value))return!1;if(IsDefined(schema.minProperties)&&!(Object.getOwnPropertyNames(value).length>=schema.minProperties))return!1;if(IsDefined(schema.maxProperties)&&!(Object.getOwnPropertyNames(value).length<=schema.maxProperties))return!1;let knownKeys=Object.getOwnPropertyNames(schema.properties);for(let knownKey of knownKeys){let property=schema.properties[knownKey];if(schema.required&&schema.required.includes(knownKey)){if(!Visit5(property,references,value[knownKey]))return!1;if((ExtendsUndefinedCheck(property)||IsAnyOrUnknown(property))&&!(knownKey in value))return!1}else if(TypeSystemPolicy.IsExactOptionalProperty(value,knownKey)&&!Visit5(property,references,value[knownKey]))return!1}if(schema.additionalProperties===!1){let valueKeys=Object.getOwnPropertyNames(value);if(schema.required&&schema.required.length===knownKeys.length&&valueKeys.length===knownKeys.length)return!0;else return valueKeys.every((valueKey)=>knownKeys.includes(valueKey))}else if(typeof schema.additionalProperties==="object")return Object.getOwnPropertyNames(value).every((key)=>knownKeys.includes(key)||Visit5(schema.additionalProperties,references,value[key]));else return!0}function FromPromise4(schema,references,value){return IsPromise(value)}function FromRecord4(schema,references,value){if(!TypeSystemPolicy.IsRecordLike(value))return!1;if(IsDefined(schema.minProperties)&&!(Object.getOwnPropertyNames(value).length>=schema.minProperties))return!1;if(IsDefined(schema.maxProperties)&&!(Object.getOwnPropertyNames(value).length<=schema.maxProperties))return!1;let[patternKey,patternSchema]=Object.entries(schema.patternProperties)[0],regex=new RegExp(patternKey),check1=Object.entries(value).every(([key,value2])=>{return regex.test(key)?Visit5(patternSchema,references,value2):!0}),check2=typeof schema.additionalProperties==="object"?Object.entries(value).every(([key,value2])=>{return!regex.test(key)?Visit5(schema.additionalProperties,references,value2):!0}):!0,check3=schema.additionalProperties===!1?Object.getOwnPropertyNames(value).every((key)=>{return regex.test(key)}):!0;return check1&&check2&&check3}function FromRef5(schema,references,value){return Visit5(Deref(schema,references),references,value)}function FromRegExp2(schema,references,value){let regex=new RegExp(schema.source,schema.flags);if(IsDefined(schema.minLength)){if(!(value.length>=schema.minLength))return!1}if(IsDefined(schema.maxLength)){if(!(value.length<=schema.maxLength))return!1}return regex.test(value)}function FromString2(schema,references,value){if(!IsString2(value))return!1;if(IsDefined(schema.minLength)){if(!(value.length>=schema.minLength))return!1}if(IsDefined(schema.maxLength)){if(!(value.length<=schema.maxLength))return!1}if(IsDefined(schema.pattern)){if(!new RegExp(schema.pattern).test(value))return!1}if(IsDefined(schema.format)){if(!exports_format.Has(schema.format))return!1;return exports_format.Get(schema.format)(value)}return!0}function FromSymbol2(schema,references,value){return IsSymbol2(value)}function FromTemplateLiteral4(schema,references,value){return IsString2(value)&&new RegExp(schema.pattern).test(value)}function FromThis(schema,references,value){return Visit5(Deref(schema,references),references,value)}function FromTuple6(schema,references,value){if(!IsArray2(value))return!1;if(schema.items===void 0&&value.length!==0)return!1;if(value.length!==schema.maxItems)return!1;if(!schema.items)return!0;for(let i=0;i<schema.items.length;i++)if(!Visit5(schema.items[i],references,value[i]))return!1;return!0}function FromUndefined2(schema,references,value){return IsUndefined2(value)}function FromUnion11(schema,references,value){return schema.anyOf.some((inner)=>Visit5(inner,references,value))}function FromUint8Array2(schema,references,value){if(!IsUint8Array2(value))return!1;if(IsDefined(schema.maxByteLength)&&!(value.length<=schema.maxByteLength))return!1;if(IsDefined(schema.minByteLength)&&!(value.length>=schema.minByteLength))return!1;return!0}function FromUnknown2(schema,references,value){return!0}function FromVoid2(schema,references,value){return TypeSystemPolicy.IsVoidLike(value)}function FromKind(schema,references,value){if(!exports_type2.Has(schema[Kind]))return!1;return exports_type2.Get(schema[Kind])(schema,value)}function Visit5(schema,references,value){let references_=IsDefined(schema.$id)?Pushref(schema,references):references,schema_=schema;switch(schema_[Kind]){case"Any":return FromAny2(schema_,references_,value);case"Argument":return FromArgument2(schema_,references_,value);case"Array":return FromArray7(schema_,references_,value);case"AsyncIterator":return FromAsyncIterator4(schema_,references_,value);case"BigInt":return FromBigInt2(schema_,references_,value);case"Boolean":return FromBoolean2(schema_,references_,value);case"Constructor":return FromConstructor4(schema_,references_,value);case"Date":return FromDate2(schema_,references_,value);case"Function":return FromFunction4(schema_,references_,value);case"Import":return FromImport(schema_,references_,value);case"Integer":return FromInteger2(schema_,references_,value);case"Intersect":return FromIntersect9(schema_,references_,value);case"Iterator":return FromIterator4(schema_,references_,value);case"Literal":return FromLiteral3(schema_,references_,value);case"Never":return FromNever2(schema_,references_,value);case"Not":return FromNot2(schema_,references_,value);case"Null":return FromNull2(schema_,references_,value);case"Number":return FromNumber2(schema_,references_,value);case"Object":return FromObject8(schema_,references_,value);case"Promise":return FromPromise4(schema_,references_,value);case"Record":return FromRecord4(schema_,references_,value);case"Ref":return FromRef5(schema_,references_,value);case"RegExp":return FromRegExp2(schema_,references_,value);case"String":return FromString2(schema_,references_,value);case"Symbol":return FromSymbol2(schema_,references_,value);case"TemplateLiteral":return FromTemplateLiteral4(schema_,references_,value);case"This":return FromThis(schema_,references_,value);case"Tuple":return FromTuple6(schema_,references_,value);case"Undefined":return FromUndefined2(schema_,references_,value);case"Union":return FromUnion11(schema_,references_,value);case"Uint8Array":return FromUint8Array2(schema_,references_,value);case"Unknown":return FromUnknown2(schema_,references_,value);case"Void":return FromVoid2(schema_,references_,value);default:if(!exports_type2.Has(schema_[Kind]))throw new ValueCheckUnknownTypeError(schema_);return FromKind(schema_,references_,value)}}function Check(...args){return args.length===3?Visit5(args[0],args[1],args[2]):Visit5(args[0],[],args[1])}var ValueErrorType;(function(ValueErrorType2){ValueErrorType2[ValueErrorType2.ArrayContains=0]="ArrayContains",ValueErrorType2[ValueErrorType2.ArrayMaxContains=1]="ArrayMaxContains",ValueErrorType2[ValueErrorType2.ArrayMaxItems=2]="ArrayMaxItems",ValueErrorType2[ValueErrorType2.ArrayMinContains=3]="ArrayMinContains",ValueErrorType2[ValueErrorType2.ArrayMinItems=4]="ArrayMinItems",ValueErrorType2[ValueErrorType2.ArrayUniqueItems=5]="ArrayUniqueItems",ValueErrorType2[ValueErrorType2.Array=6]="Array",ValueErrorType2[ValueErrorType2.AsyncIterator=7]="AsyncIterator",ValueErrorType2[ValueErrorType2.BigIntExclusiveMaximum=8]="BigIntExclusiveMaximum",ValueErrorType2[ValueErrorType2.BigIntExclusiveMinimum=9]="BigIntExclusiveMinimum",ValueErrorType2[ValueErrorType2.BigIntMaximum=10]="BigIntMaximum",ValueErrorType2[ValueErrorType2.BigIntMinimum=11]="BigIntMinimum",ValueErrorType2[ValueErrorType2.BigIntMultipleOf=12]="BigIntMultipleOf",ValueErrorType2[ValueErrorType2.BigInt=13]="BigInt",ValueErrorType2[ValueErrorType2.Boolean=14]="Boolean",ValueErrorType2[ValueErrorType2.DateExclusiveMaximumTimestamp=15]="DateExclusiveMaximumTimestamp",ValueErrorType2[ValueErrorType2.DateExclusiveMinimumTimestamp=16]="DateExclusiveMinimumTimestamp",ValueErrorType2[ValueErrorType2.DateMaximumTimestamp=17]="DateMaximumTimestamp",ValueErrorType2[ValueErrorType2.DateMinimumTimestamp=18]="DateMinimumTimestamp",ValueErrorType2[ValueErrorType2.DateMultipleOfTimestamp=19]="DateMultipleOfTimestamp",ValueErrorType2[ValueErrorType2.Date=20]="Date",ValueErrorType2[ValueErrorType2.Function=21]="Function",ValueErrorType2[ValueErrorType2.IntegerExclusiveMaximum=22]="IntegerExclusiveMaximum",ValueErrorType2[ValueErrorType2.IntegerExclusiveMinimum=23]="IntegerExclusiveMinimum",ValueErrorType2[ValueErrorType2.IntegerMaximum=24]="IntegerMaximum",ValueErrorType2[ValueErrorType2.IntegerMinimum=25]="IntegerMinimum",ValueErrorType2[ValueErrorType2.IntegerMultipleOf=26]="IntegerMultipleOf",ValueErrorType2[ValueErrorType2.Integer=27]="Integer",ValueErrorType2[ValueErrorType2.IntersectUnevaluatedProperties=28]="IntersectUnevaluatedProperties",ValueErrorType2[ValueErrorType2.Intersect=29]="Intersect",ValueErrorType2[ValueErrorType2.Iterator=30]="Iterator",ValueErrorType2[ValueErrorType2.Kind=31]="Kind",ValueErrorType2[ValueErrorType2.Literal=32]="Literal",ValueErrorType2[ValueErrorType2.Never=33]="Never",ValueErrorType2[ValueErrorType2.Not=34]="Not",ValueErrorType2[ValueErrorType2.Null=35]="Null",ValueErrorType2[ValueErrorType2.NumberExclusiveMaximum=36]="NumberExclusiveMaximum",ValueErrorType2[ValueErrorType2.NumberExclusiveMinimum=37]="NumberExclusiveMinimum",ValueErrorType2[ValueErrorType2.NumberMaximum=38]="NumberMaximum",ValueErrorType2[ValueErrorType2.NumberMinimum=39]="NumberMinimum",ValueErrorType2[ValueErrorType2.NumberMultipleOf=40]="NumberMultipleOf",ValueErrorType2[ValueErrorType2.Number=41]="Number",ValueErrorType2[ValueErrorType2.ObjectAdditionalProperties=42]="ObjectAdditionalProperties",ValueErrorType2[ValueErrorType2.ObjectMaxProperties=43]="ObjectMaxProperties",ValueErrorType2[ValueErrorType2.ObjectMinProperties=44]="ObjectMinProperties",ValueErrorType2[ValueErrorType2.ObjectRequiredProperty=45]="ObjectRequiredProperty",ValueErrorType2[ValueErrorType2.Object=46]="Object",ValueErrorType2[ValueErrorType2.Promise=47]="Promise",ValueErrorType2[ValueErrorType2.RegExp=48]="RegExp",ValueErrorType2[ValueErrorType2.StringFormatUnknown=49]="StringFormatUnknown",ValueErrorType2[ValueErrorType2.StringFormat=50]="StringFormat",ValueErrorType2[ValueErrorType2.StringMaxLength=51]="StringMaxLength",ValueErrorType2[ValueErrorType2.StringMinLength=52]="StringMinLength",ValueErrorType2[ValueErrorType2.StringPattern=53]="StringPattern",ValueErrorType2[ValueErrorType2.String=54]="String",ValueErrorType2[ValueErrorType2.Symbol=55]="Symbol",ValueErrorType2[ValueErrorType2.TupleLength=56]="TupleLength",ValueErrorType2[ValueErrorType2.Tuple=57]="Tuple",ValueErrorType2[ValueErrorType2.Uint8ArrayMaxByteLength=58]="Uint8ArrayMaxByteLength",ValueErrorType2[ValueErrorType2.Uint8ArrayMinByteLength=59]="Uint8ArrayMinByteLength",ValueErrorType2[ValueErrorType2.Uint8Array=60]="Uint8Array",ValueErrorType2[ValueErrorType2.Undefined=61]="Undefined",ValueErrorType2[ValueErrorType2.Union=62]="Union",ValueErrorType2[ValueErrorType2.Void=63]="Void"})(ValueErrorType||(ValueErrorType={}));class ValueErrorsUnknownTypeError extends TypeBoxError{constructor(schema){super("Unknown type");this.schema=schema}}function EscapeKey(key){return key.replace(/~/g,"~0").replace(/\//g,"~1")}function IsDefined2(value){return value!==void 0}class ValueErrorIterator{constructor(iterator){this.iterator=iterator}[Symbol.iterator](){return this.iterator}First(){let next=this.iterator.next();return next.done?void 0:next.value}}function Create(errorType,schema,path,value,errors=[]){return{type:errorType,schema,path,value,message:GetErrorFunction()({errorType,path,schema,value,errors}),errors}}function*FromAny3(schema,references,path,value){}function*FromArgument3(schema,references,path,value){}function*FromArray8(schema,references,path,value){if(!IsArray2(value))return yield Create(ValueErrorType.Array,schema,path,value);if(IsDefined2(schema.minItems)&&!(value.length>=schema.minItems))yield Create(ValueErrorType.ArrayMinItems,schema,path,value);if(IsDefined2(schema.maxItems)&&!(value.length<=schema.maxItems))yield Create(ValueErrorType.ArrayMaxItems,schema,path,value);for(let i=0;i<value.length;i++)yield*Visit6(schema.items,references,`${path}/${i}`,value[i]);if(schema.uniqueItems===!0&&!function(){let set2=new Set;for(let element of value){let hashed=Hash(element);if(set2.has(hashed))return!1;else set2.add(hashed)}return!0}())yield Create(ValueErrorType.ArrayUniqueItems,schema,path,value);if(!(IsDefined2(schema.contains)||IsDefined2(schema.minContains)||IsDefined2(schema.maxContains)))return;let containsSchema=IsDefined2(schema.contains)?schema.contains:Never(),containsCount=value.reduce((acc,value2,index)=>Visit6(containsSchema,references,`${path}${index}`,value2).next().done===!0?acc+1:acc,0);if(containsCount===0)yield Create(ValueErrorType.ArrayContains,schema,path,value);if(IsNumber2(schema.minContains)&&containsCount<schema.minContains)yield Create(ValueErrorType.ArrayMinContains,schema,path,value);if(IsNumber2(schema.maxContains)&&containsCount>schema.maxContains)yield Create(ValueErrorType.ArrayMaxContains,schema,path,value)}function*FromAsyncIterator5(schema,references,path,value){if(!IsAsyncIterator2(value))yield Create(ValueErrorType.AsyncIterator,schema,path,value)}function*FromBigInt3(schema,references,path,value){if(!IsBigInt2(value))return yield Create(ValueErrorType.BigInt,schema,path,value);if(IsDefined2(schema.exclusiveMaximum)&&!(value<schema.exclusiveMaximum))yield Create(ValueErrorType.BigIntExclusiveMaximum,schema,path,value);if(IsDefined2(schema.exclusiveMinimum)&&!(value>schema.exclusiveMinimum))yield Create(ValueErrorType.BigIntExclusiveMinimum,schema,path,value);if(IsDefined2(schema.maximum)&&!(value<=schema.maximum))yield Create(ValueErrorType.BigIntMaximum,schema,path,value);if(IsDefined2(schema.minimum)&&!(value>=schema.minimum))yield Create(ValueErrorType.BigIntMinimum,schema,path,value);if(IsDefined2(schema.multipleOf)&&value%schema.multipleOf!==BigInt(0))yield Create(ValueErrorType.BigIntMultipleOf,schema,path,value)}function*FromBoolean3(schema,references,path,value){if(!IsBoolean2(value))yield Create(ValueErrorType.Boolean,schema,path,value)}function*FromConstructor5(schema,references,path,value){yield*Visit6(schema.returns,references,path,value.prototype)}function*FromDate3(schema,references,path,value){if(!IsDate2(value))return yield Create(ValueErrorType.Date,schema,path,value);if(IsDefined2(schema.exclusiveMaximumTimestamp)&&!(value.getTime()<schema.exclusiveMaximumTimestamp))yield Create(ValueErrorType.DateExclusiveMaximumTimestamp,schema,path,value);if(IsDefined2(schema.exclusiveMinimumTimestamp)&&!(value.getTime()>schema.exclusiveMinimumTimestamp))yield Create(ValueErrorType.DateExclusiveMinimumTimestamp,schema,path,value);if(IsDefined2(schema.maximumTimestamp)&&!(value.getTime()<=schema.maximumTimestamp))yield Create(ValueErrorType.DateMaximumTimestamp,schema,path,value);if(IsDefined2(schema.minimumTimestamp)&&!(value.getTime()>=schema.minimumTimestamp))yield Create(ValueErrorType.DateMinimumTimestamp,schema,path,value);if(IsDefined2(schema.multipleOfTimestamp)&&value.getTime()%schema.multipleOfTimestamp!==0)yield Create(ValueErrorType.DateMultipleOfTimestamp,schema,path,value)}function*FromFunction5(schema,references,path,value){if(!IsFunction2(value))yield Create(ValueErrorType.Function,schema,path,value)}function*FromImport2(schema,references,path,value){let definitions=globalThis.Object.values(schema.$defs),target=schema.$defs[schema.$ref];yield*Visit6(target,[...references,...definitions],path,value)}function*FromInteger3(schema,references,path,value){if(!IsInteger(value))return yield Create(ValueErrorType.Integer,schema,path,value);if(IsDefined2(schema.exclusiveMaximum)&&!(value<schema.exclusiveMaximum))yield Create(ValueErrorType.IntegerExclusiveMaximum,schema,path,value);if(IsDefined2(schema.exclusiveMinimum)&&!(value>schema.exclusiveMinimum))yield Create(ValueErrorType.IntegerExclusiveMinimum,schema,path,value);if(IsDefined2(schema.maximum)&&!(value<=schema.maximum))yield Create(ValueErrorType.IntegerMaximum,schema,path,value);if(IsDefined2(schema.minimum)&&!(value>=schema.minimum))yield Create(ValueErrorType.IntegerMinimum,schema,path,value);if(IsDefined2(schema.multipleOf)&&value%schema.multipleOf!==0)yield Create(ValueErrorType.IntegerMultipleOf,schema,path,value)}function*FromIntersect10(schema,references,path,value){let hasError=!1;for(let inner of schema.allOf)for(let error of Visit6(inner,references,path,value))hasError=!0,yield error;if(hasError)return yield Create(ValueErrorType.Intersect,schema,path,value);if(schema.unevaluatedProperties===!1){let keyCheck=new RegExp(KeyOfPattern(schema));for(let valueKey of Object.getOwnPropertyNames(value))if(!keyCheck.test(valueKey))yield Create(ValueErrorType.IntersectUnevaluatedProperties,schema,`${path}/${valueKey}`,value)}if(typeof schema.unevaluatedProperties==="object"){let keyCheck=new RegExp(KeyOfPattern(schema));for(let valueKey of Object.getOwnPropertyNames(value))if(!keyCheck.test(valueKey)){let next=Visit6(schema.unevaluatedProperties,references,`${path}/${valueKey}`,value[valueKey]).next();if(!next.done)yield next.value}}}function*FromIterator5(schema,references,path,value){if(!IsIterator2(value))yield Create(ValueErrorType.Iterator,schema,path,value)}function*FromLiteral4(schema,references,path,value){if(value!==schema.const)yield Create(ValueErrorType.Literal,schema,path,value)}function*FromNever3(schema,references,path,value){yield Create(ValueErrorType.Never,schema,path,value)}function*FromNot3(schema,references,path,value){if(Visit6(schema.not,references,path,value).next().done===!0)yield Create(ValueErrorType.Not,schema,path,value)}function*FromNull3(schema,references,path,value){if(!IsNull2(value))yield Create(ValueErrorType.Null,schema,path,value)}function*FromNumber3(schema,references,path,value){if(!TypeSystemPolicy.IsNumberLike(value))return yield Create(ValueErrorType.Number,schema,path,value);if(IsDefined2(schema.exclusiveMaximum)&&!(value<schema.exclusiveMaximum))yield Create(ValueErrorType.NumberExclusiveMaximum,schema,path,value);if(IsDefined2(schema.exclusiveMinimum)&&!(value>schema.exclusiveMinimum))yield Create(ValueErrorType.NumberExclusiveMinimum,schema,path,value);if(IsDefined2(schema.maximum)&&!(value<=schema.maximum))yield Create(ValueErrorType.NumberMaximum,schema,path,value);if(IsDefined2(schema.minimum)&&!(value>=schema.minimum))yield Create(ValueErrorType.NumberMinimum,schema,path,value);if(IsDefined2(schema.multipleOf)&&value%schema.multipleOf!==0)yield Create(ValueErrorType.NumberMultipleOf,schema,path,value)}function*FromObject9(schema,references,path,value){if(!TypeSystemPolicy.IsObjectLike(value))return yield Create(ValueErrorType.Object,schema,path,value);if(IsDefined2(schema.minProperties)&&!(Object.getOwnPropertyNames(value).length>=schema.minProperties))yield Create(ValueErrorType.ObjectMinProperties,schema,path,value);if(IsDefined2(schema.maxProperties)&&!(Object.getOwnPropertyNames(value).length<=schema.maxProperties))yield Create(ValueErrorType.ObjectMaxProperties,schema,path,value);let requiredKeys=Array.isArray(schema.required)?schema.required:[],knownKeys=Object.getOwnPropertyNames(schema.properties),unknownKeys=Object.getOwnPropertyNames(value);for(let requiredKey of requiredKeys){if(unknownKeys.includes(requiredKey))continue;yield Create(ValueErrorType.ObjectRequiredProperty,schema.properties[requiredKey],`${path}/${EscapeKey(requiredKey)}`,void 0)}if(schema.additionalProperties===!1){for(let valueKey of unknownKeys)if(!knownKeys.includes(valueKey))yield Create(ValueErrorType.ObjectAdditionalProperties,schema,`${path}/${EscapeKey(valueKey)}`,value[valueKey])}if(typeof schema.additionalProperties==="object")for(let valueKey of unknownKeys){if(knownKeys.includes(valueKey))continue;yield*Visit6(schema.additionalProperties,references,`${path}/${EscapeKey(valueKey)}`,value[valueKey])}for(let knownKey of knownKeys){let property=schema.properties[knownKey];if(schema.required&&schema.required.includes(knownKey)){if(yield*Visit6(property,references,`${path}/${EscapeKey(knownKey)}`,value[knownKey]),ExtendsUndefinedCheck(schema)&&!(knownKey in value))yield Create(ValueErrorType.ObjectRequiredProperty,property,`${path}/${EscapeKey(knownKey)}`,void 0)}else if(TypeSystemPolicy.IsExactOptionalProperty(value,knownKey))yield*Visit6(property,references,`${path}/${EscapeKey(knownKey)}`,value[knownKey])}}function*FromPromise5(schema,references,path,value){if(!IsPromise(value))yield Create(ValueErrorType.Promise,schema,path,value)}function*FromRecord5(schema,references,path,value){if(!TypeSystemPolicy.IsRecordLike(value))return yield Create(ValueErrorType.Object,schema,path,value);if(IsDefined2(schema.minProperties)&&!(Object.getOwnPropertyNames(value).length>=schema.minProperties))yield Create(ValueErrorType.ObjectMinProperties,schema,path,value);if(IsDefined2(schema.maxProperties)&&!(Object.getOwnPropertyNames(value).length<=schema.maxProperties))yield Create(ValueErrorType.ObjectMaxProperties,schema,path,value);let[patternKey,patternSchema]=Object.entries(schema.patternProperties)[0],regex=new RegExp(patternKey);for(let[propertyKey,propertyValue]of Object.entries(value))if(regex.test(propertyKey))yield*Visit6(patternSchema,references,`${path}/${EscapeKey(propertyKey)}`,propertyValue);if(typeof schema.additionalProperties==="object"){for(let[propertyKey,propertyValue]of Object.entries(value))if(!regex.test(propertyKey))yield*Visit6(schema.additionalProperties,references,`${path}/${EscapeKey(propertyKey)}`,propertyValue)}if(schema.additionalProperties===!1)for(let[propertyKey,propertyValue]of Object.entries(value)){if(regex.test(propertyKey))continue;return yield Create(ValueErrorType.ObjectAdditionalProperties,schema,`${path}/${EscapeKey(propertyKey)}`,propertyValue)}}function*FromRef6(schema,references,path,value){yield*Visit6(Deref(schema,references),references,path,value)}function*FromRegExp3(schema,references,path,value){if(!IsString2(value))return yield Create(ValueErrorType.String,schema,path,value);if(IsDefined2(schema.minLength)&&!(value.length>=schema.minLength))yield Create(ValueErrorType.StringMinLength,schema,path,value);if(IsDefined2(schema.maxLength)&&!(value.length<=schema.maxLength))yield Create(ValueErrorType.StringMaxLength,schema,path,value);if(!new RegExp(schema.source,schema.flags).test(value))return yield Create(ValueErrorType.RegExp,schema,path,value)}function*FromString3(schema,references,path,value){if(!IsString2(value))return yield Create(ValueErrorType.String,schema,path,value);if(IsDefined2(schema.minLength)&&!(value.length>=schema.minLength))yield Create(ValueErrorType.StringMinLength,schema,path,value);if(IsDefined2(schema.maxLength)&&!(value.length<=schema.maxLength))yield Create(ValueErrorType.StringMaxLength,schema,path,value);if(IsString2(schema.pattern)){if(!new RegExp(schema.pattern).test(value))yield Create(ValueErrorType.StringPattern,schema,path,value)}if(IsString2(schema.format)){if(!exports_format.Has(schema.format))yield Create(ValueErrorType.StringFormatUnknown,schema,path,value);else if(!exports_format.Get(schema.format)(value))yield Create(ValueErrorType.StringFormat,schema,path,value)}}function*FromSymbol3(schema,references,path,value){if(!IsSymbol2(value))yield Create(ValueErrorType.Symbol,schema,path,value)}function*FromTemplateLiteral5(schema,references,path,value){if(!IsString2(value))return yield Create(ValueErrorType.String,schema,path,value);if(!new RegExp(schema.pattern).test(value))yield Create(ValueErrorType.StringPattern,schema,path,value)}function*FromThis2(schema,references,path,value){yield*Visit6(Deref(schema,references),references,path,value)}function*FromTuple7(schema,references,path,value){if(!IsArray2(value))return yield Create(ValueErrorType.Tuple,schema,path,value);if(schema.items===void 0&&value.length!==0)return yield Create(ValueErrorType.TupleLength,schema,path,value);if(value.length!==schema.maxItems)return yield Create(ValueErrorType.TupleLength,schema,path,value);if(!schema.items)return;for(let i=0;i<schema.items.length;i++)yield*Visit6(schema.items[i],references,`${path}/${i}`,value[i])}function*FromUndefined3(schema,references,path,value){if(!IsUndefined2(value))yield Create(ValueErrorType.Undefined,schema,path,value)}function*FromUnion12(schema,references,path,value){if(Check(schema,references,value))return;let errors=schema.anyOf.map((variant)=>new ValueErrorIterator(Visit6(variant,references,path,value)));yield Create(ValueErrorType.Union,schema,path,value,errors)}function*FromUint8Array3(schema,references,path,value){if(!IsUint8Array2(value))return yield Create(ValueErrorType.Uint8Array,schema,path,value);if(IsDefined2(schema.maxByteLength)&&!(value.length<=schema.maxByteLength))yield Create(ValueErrorType.Uint8ArrayMaxByteLength,schema,path,value);if(IsDefined2(schema.minByteLength)&&!(value.length>=schema.minByteLength))yield Create(ValueErrorType.Uint8ArrayMinByteLength,schema,path,value)}function*FromUnknown3(schema,references,path,value){}function*FromVoid3(schema,references,path,value){if(!TypeSystemPolicy.IsVoidLike(value))yield Create(ValueErrorType.Void,schema,path,value)}function*FromKind2(schema,references,path,value){if(!exports_type2.Get(schema[Kind])(schema,value))yield Create(ValueErrorType.Kind,schema,path,value)}function*Visit6(schema,references,path,value){let references_=IsDefined2(schema.$id)?[...references,schema]:references,schema_=schema;switch(schema_[Kind]){case"Any":return yield*FromAny3(schema_,references_,path,value);case"Argument":return yield*FromArgument3(schema_,references_,path,value);case"Array":return yield*FromArray8(schema_,references_,path,value);case"AsyncIterator":return yield*FromAsyncIterator5(schema_,references_,path,value);case"BigInt":return yield*FromBigInt3(schema_,references_,path,value);case"Boolean":return yield*FromBoolean3(schema_,references_,path,value);case"Constructor":return yield*FromConstructor5(schema_,references_,path,value);case"Date":return yield*FromDate3(schema_,references_,path,value);case"Function":return yield*FromFunction5(schema_,references_,path,value);case"Import":return yield*FromImport2(schema_,references_,path,value);case"Integer":return yield*FromInteger3(schema_,references_,path,value);case"Intersect":return yield*FromIntersect10(schema_,references_,path,value);case"Iterator":return yield*FromIterator5(schema_,references_,path,value);case"Literal":return yield*FromLiteral4(schema_,references_,path,value);case"Never":return yield*FromNever3(schema_,references_,path,value);case"Not":return yield*FromNot3(schema_,references_,path,value);case"Null":return yield*FromNull3(schema_,references_,path,value);case"Number":return yield*FromNumber3(schema_,references_,path,value);case"Object":return yield*FromObject9(schema_,references_,path,value);case"Promise":return yield*FromPromise5(schema_,references_,path,value);case"Record":return yield*FromRecord5(schema_,references_,path,value);case"Ref":return yield*FromRef6(schema_,references_,path,value);case"RegExp":return yield*FromRegExp3(schema_,references_,path,value);case"String":return yield*FromString3(schema_,references_,path,value);case"Symbol":return yield*FromSymbol3(schema_,references_,path,value);case"TemplateLiteral":return yield*FromTemplateLiteral5(schema_,references_,path,value);case"This":return yield*FromThis2(schema_,references_,path,value);case"Tuple":return yield*FromTuple7(schema_,references_,path,value);case"Undefined":return yield*FromUndefined3(schema_,references_,path,value);case"Union":return yield*FromUnion12(schema_,references_,path,value);case"Uint8Array":return yield*FromUint8Array3(schema_,references_,path,value);case"Unknown":return yield*FromUnknown3(schema_,references_,path,value);case"Void":return yield*FromVoid3(schema_,references_,path,value);default:if(!exports_type2.Has(schema_[Kind]))throw new ValueErrorsUnknownTypeError(schema);return yield*FromKind2(schema_,references_,path,value)}}function Errors(...args){let iterator=args.length===3?Visit6(args[0],args[1],"",args[2]):Visit6(args[0],[],"",args[1]);return new ValueErrorIterator(iterator)}var __classPrivateFieldSet=function(receiver,state,value,kind,f){if(kind==="m")throw TypeError("Private method is not writable");if(kind==="a"&&!f)throw TypeError("Private accessor was defined without a setter");if(typeof state==="function"?receiver!==state||!f:!state.has(receiver))throw TypeError("Cannot write private member to an object whose class did not declare it");return kind==="a"?f.call(receiver,value):f?f.value=value:state.set(receiver,value),value},__classPrivateFieldGet=function(receiver,state,kind,f){if(kind==="a"&&!f)throw TypeError("Private accessor was defined without a getter");if(typeof state==="function"?receiver!==state||!f:!state.has(receiver))throw TypeError("Cannot read private member from an object whose class did not declare it");return kind==="m"?f:kind==="a"?f.call(receiver):f?f.value:state.get(receiver)},_AssertError_instances,_AssertError_iterator,_AssertError_Iterator;class AssertError extends TypeBoxError{constructor(iterator){let error=iterator.First();super(error===void 0?"Invalid Value":error.message);_AssertError_instances.add(this),_AssertError_iterator.set(this,void 0),__classPrivateFieldSet(this,_AssertError_iterator,iterator,"f"),this.error=error}Errors(){return new ValueErrorIterator(__classPrivateFieldGet(this,_AssertError_instances,"m",_AssertError_Iterator).call(this))}}_AssertError_iterator=new WeakMap,_AssertError_instances=new WeakSet,_AssertError_Iterator=function*(){if(this.error)yield this.error;yield*__classPrivateFieldGet(this,_AssertError_iterator,"f")};function AssertValue(schema,references,value){if(Check(schema,references,value))return;throw new AssertError(Errors(schema,references,value))}function Assert(...args){return args.length===3?AssertValue(args[0],args[1],args[2]):AssertValue(args[0],[],args[1])}function FromObject10(value){let Acc={};for(let key of Object.getOwnPropertyNames(value))Acc[key]=Clone2(value[key]);for(let key of Object.getOwnPropertySymbols(value))Acc[key]=Clone2(value[key]);return Acc}function FromArray9(value){return value.map((element)=>Clone2(element))}function FromTypedArray(value){return value.slice()}function FromMap(value){return new Map(Clone2([...value.entries()]))}function FromSet(value){return new Set(Clone2([...value.entries()]))}function FromDate4(value){return new Date(value.toISOString())}function FromValue2(value){return value}function Clone2(value){if(IsArray2(value))return FromArray9(value);if(IsDate2(value))return FromDate4(value);if(IsTypedArray(value))return FromTypedArray(value);if(IsMap(value))return FromMap(value);if(IsSet(value))return FromSet(value);if(IsObject2(value))return FromObject10(value);if(IsValueType(value))return FromValue2(value);throw Error("ValueClone: Unable to clone value")}class ValueCreateError extends TypeBoxError{constructor(schema,message){super(message);this.schema=schema}}function FromDefault(value){return IsFunction2(value)?value():Clone2(value)}function FromAny4(schema,references){if(HasPropertyKey2(schema,"default"))return FromDefault(schema.default);else return{}}function FromArgument4(schema,references){return{}}function FromArray10(schema,references){if(schema.uniqueItems===!0&&!HasPropertyKey2(schema,"default"))throw new ValueCreateError(schema,"Array with the uniqueItems constraint requires a default value");else if("contains"in schema&&!HasPropertyKey2(schema,"default"))throw new ValueCreateError(schema,"Array with the contains constraint requires a default value");else if("default"in schema)return FromDefault(schema.default);else if(schema.minItems!==void 0)return Array.from({length:schema.minItems}).map((item)=>{return Visit7(schema.items,references)});else return[]}function FromAsyncIterator6(schema,references){if(HasPropertyKey2(schema,"default"))return FromDefault(schema.default);else return async function*(){}()}function FromBigInt4(schema,references){if(HasPropertyKey2(schema,"default"))return FromDefault(schema.default);else return BigInt(0)}function FromBoolean4(schema,references){if(HasPropertyKey2(schema,"default"))return FromDefault(schema.default);else return!1}function FromConstructor6(schema,references){if(HasPropertyKey2(schema,"default"))return FromDefault(schema.default);else{let value=Visit7(schema.returns,references);if(typeof value==="object"&&!Array.isArray(value))return class{constructor(){for(let[key,val]of Object.entries(value)){let self2=this;self2[key]=val}}};else return class{}}}function FromDate5(schema,references){if(HasPropertyKey2(schema,"default"))return FromDefault(schema.default);else if(schema.minimumTimestamp!==void 0)return new Date(schema.minimumTimestamp);else return new Date}function FromFunction6(schema,references){if(HasPropertyKey2(schema,"default"))return FromDefault(schema.default);else return()=>Visit7(schema.returns,references)}function FromImport3(schema,references){let definitions=globalThis.Object.values(schema.$defs),target=schema.$defs[schema.$ref];return Visit7(target,[...references,...definitions])}function FromInteger4(schema,references){if(HasPropertyKey2(schema,"default"))return FromDefault(schema.default);else if(schema.minimum!==void 0)return schema.minimum;else return 0}function FromIntersect11(schema,references){if(HasPropertyKey2(schema,"default"))return FromDefault(schema.default);else{let value=schema.allOf.reduce((acc,schema2)=>{let next=Visit7(schema2,references);return typeof next==="object"?{...acc,...next}:next},{});if(!Check(schema,references,value))throw new ValueCreateError(schema,"Intersect produced invalid value. Consider using a default value.");return value}}function FromIterator6(schema,references){if(HasPropertyKey2(schema,"default"))return FromDefault(schema.default);else return function*(){}()}function FromLiteral5(schema,references){if(HasPropertyKey2(schema,"default"))return FromDefault(schema.default);else return schema.const}function FromNever4(schema,references){if(HasPropertyKey2(schema,"default"))return FromDefault(schema.default);else throw new ValueCreateError(schema,"Never types cannot be created. Consider using a default value.")}function FromNot4(schema,references){if(HasPropertyKey2(schema,"default"))return FromDefault(schema.default);else throw new ValueCreateError(schema,"Not types must have a default value")}function FromNull4(schema,references){if(HasPropertyKey2(schema,"default"))return FromDefault(schema.default);else return null}function FromNumber4(schema,references){if(HasPropertyKey2(schema,"default"))return FromDefault(schema.default);else if(schema.minimum!==void 0)return schema.minimum;else return 0}function FromObject11(schema,references){if(HasPropertyKey2(schema,"default"))return FromDefault(schema.default);else{let required=new Set(schema.required),Acc={};for(let[key,subschema]of Object.entries(schema.properties)){if(!required.has(key))continue;Acc[key]=Visit7(subschema,references)}return Acc}}function FromPromise6(schema,references){if(HasPropertyKey2(schema,"default"))return FromDefault(schema.default);else return Promise.resolve(Visit7(schema.item,references))}function FromRecord6(schema,references){if(HasPropertyKey2(schema,"default"))return FromDefault(schema.default);else return{}}function FromRef7(schema,references){if(HasPropertyKey2(schema,"default"))return FromDefault(schema.default);else return Visit7(Deref(schema,references),references)}function FromRegExp4(schema,references){if(HasPropertyKey2(schema,"default"))return FromDefault(schema.default);else throw new ValueCreateError(schema,"RegExp types cannot be created. Consider using a default value.")}function FromString4(schema,references){if(schema.pattern!==void 0)if(!HasPropertyKey2(schema,"default"))throw new ValueCreateError(schema,"String types with patterns must specify a default value");else return FromDefault(schema.default);else if(schema.format!==void 0)if(!HasPropertyKey2(schema,"default"))throw new ValueCreateError(schema,"String types with formats must specify a default value");else return FromDefault(schema.default);else if(HasPropertyKey2(schema,"default"))return FromDefault(schema.default);else if(schema.minLength!==void 0)return Array.from({length:schema.minLength}).map(()=>" ").join("");else return""}function FromSymbol4(schema,references){if(HasPropertyKey2(schema,"default"))return FromDefault(schema.default);else if("value"in schema)return Symbol.for(schema.value);else return Symbol()}function FromTemplateLiteral6(schema,references){if(HasPropertyKey2(schema,"default"))return FromDefault(schema.default);if(!IsTemplateLiteralFinite(schema))throw new ValueCreateError(schema,"Can only create template literals that produce a finite variants. Consider using a default value.");return TemplateLiteralGenerate(schema)[0]}function FromThis3(schema,references){if(recursiveDepth++>recursiveMaxDepth)throw new ValueCreateError(schema,"Cannot create recursive type as it appears possibly infinite. Consider using a default.");if(HasPropertyKey2(schema,"default"))return FromDefault(schema.default);else return Visit7(Deref(schema,references),references)}function FromTuple8(schema,references){if(HasPropertyKey2(schema,"default"))return FromDefault(schema.default);if(schema.items===void 0)return[];else return Array.from({length:schema.minItems}).map((_,index)=>Visit7(schema.items[index],references))}function FromUndefined4(schema,references){if(HasPropertyKey2(schema,"default"))return FromDefault(schema.default);else return}function FromUnion13(schema,references){if(HasPropertyKey2(schema,"default"))return FromDefault(schema.default);else if(schema.anyOf.length===0)throw Error("ValueCreate.Union: Cannot create Union with zero variants");else return Visit7(schema.anyOf[0],references)}function FromUint8Array4(schema,references){if(HasPropertyKey2(schema,"default"))return FromDefault(schema.default);else if(schema.minByteLength!==void 0)return new Uint8Array(schema.minByteLength);else return new Uint8Array(0)}function FromUnknown4(schema,references){if(HasPropertyKey2(schema,"default"))return FromDefault(schema.default);else return{}}function FromVoid4(schema,references){if(HasPropertyKey2(schema,"default"))return FromDefault(schema.default);else return}function FromKind3(schema,references){if(HasPropertyKey2(schema,"default"))return FromDefault(schema.default);else throw Error("User defined types must specify a default value")}function Visit7(schema,references){let references_=Pushref(schema,references),schema_=schema;switch(schema_[Kind]){case"Any":return FromAny4(schema_,references_);case"Argument":return FromArgument4(schema_,references_);case"Array":return FromArray10(schema_,references_);case"AsyncIterator":return FromAsyncIterator6(schema_,references_);case"BigInt":return FromBigInt4(schema_,references_);case"Boolean":return FromBoolean4(schema_,references_);case"Constructor":return FromConstructor6(schema_,references_);case"Date":return FromDate5(schema_,references_);case"Function":return FromFunction6(schema_,references_);case"Import":return FromImport3(schema_,references_);case"Integer":return FromInteger4(schema_,references_);case"Intersect":return FromIntersect11(schema_,references_);case"Iterator":return FromIterator6(schema_,references_);case"Literal":return FromLiteral5(schema_,references_);case"Never":return FromNever4(schema_,references_);case"Not":return FromNot4(schema_,references_);case"Null":return FromNull4(schema_,references_);case"Number":return FromNumber4(schema_,references_);case"Object":return FromObject11(schema_,references_);case"Promise":return FromPromise6(schema_,references_);case"Record":return FromRecord6(schema_,references_);case"Ref":return FromRef7(schema_,references_);case"RegExp":return FromRegExp4(schema_,references_);case"String":return FromString4(schema_,references_);case"Symbol":return FromSymbol4(schema_,references_);case"TemplateLiteral":return FromTemplateLiteral6(schema_,references_);case"This":return FromThis3(schema_,references_);case"Tuple":return FromTuple8(schema_,references_);case"Undefined":return FromUndefined4(schema_,references_);case"Union":return FromUnion13(schema_,references_);case"Uint8Array":return FromUint8Array4(schema_,references_);case"Unknown":return FromUnknown4(schema_,references_);case"Void":return FromVoid4(schema_,references_);default:if(!exports_type2.Has(schema_[Kind]))throw new ValueCreateError(schema_,"Unknown type");return FromKind3(schema_,references_)}}var recursiveMaxDepth=512,recursiveDepth=0;function Create2(...args){return recursiveDepth=0,args.length===2?Visit7(args[0],args[1]):Visit7(args[0],[])}class ValueCastError extends TypeBoxError{constructor(schema,message){super(message);this.schema=schema}}function ScoreUnion(schema,references,value){if(schema[Kind]==="Object"&&typeof value==="object"&&!IsNull2(value)){let object=schema,keys=Object.getOwnPropertyNames(value);return Object.entries(object.properties).reduce((acc,[key,schema2])=>{let literal=schema2[Kind]==="Literal"&&schema2.const===value[key]?100:0,checks=Check(schema2,references,value[key])?10:0,exists=keys.includes(key)?1:0;return acc+(literal+checks+exists)},0)}else if(schema[Kind]==="Union"){let scores=schema.anyOf.map((schema2)=>Deref(schema2,references)).map((schema2)=>ScoreUnion(schema2,references,value));return Math.max(...scores)}else return Check(schema,references,value)?1:0}function SelectUnion(union,references,value){let schemas=union.anyOf.map((schema)=>Deref(schema,references)),[select,best]=[schemas[0],0];for(let schema of schemas){let score=ScoreUnion(schema,references,value);if(score>best)select=schema,best=score}return select}function CastUnion(union,references,value){if("default"in union)return typeof value==="function"?union.default:Clone2(union.default);else{let schema=SelectUnion(union,references,value);return Cast(schema,references,value)}}function DefaultClone(schema,references,value){return Check(schema,references,value)?Clone2(value):Create2(schema,references)}function Default(schema,references,value){return Check(schema,references,value)?value:Create2(schema,references)}function FromArray11(schema,references,value){if(Check(schema,references,value))return Clone2(value);let created=IsArray2(value)?Clone2(value):Create2(schema,references),minimum=IsNumber2(schema.minItems)&&created.length<schema.minItems?[...created,...Array.from({length:schema.minItems-created.length},()=>null)]:created,casted=(IsNumber2(schema.maxItems)&&minimum.length>schema.maxItems?minimum.slice(0,schema.maxItems):minimum).map((value2)=>Visit8(schema.items,references,value2));if(schema.uniqueItems!==!0)return casted;let unique=[...new Set(casted)];if(!Check(schema,references,unique))throw new ValueCastError(schema,"Array cast produced invalid data due to uniqueItems constraint");return unique}function FromConstructor7(schema,references,value){if(Check(schema,references,value))return Create2(schema,references);let required=new Set(schema.returns.required||[]),result=function(){};for(let[key,property]of Object.entries(schema.returns.properties)){if(!required.has(key)&&value.prototype[key]===void 0)continue;result.prototype[key]=Visit8(property,references,value.prototype[key])}return result}function FromImport4(schema,references,value){let definitions=globalThis.Object.values(schema.$defs),target=schema.$defs[schema.$ref];return Visit8(target,[...references,...definitions],value)}function IntersectAssign(correct,value){if(IsObject2(correct)&&!IsObject2(value)||!IsObject2(correct)&&IsObject2(value))return correct;if(!IsObject2(correct)||!IsObject2(value))return value;return globalThis.Object.getOwnPropertyNames(correct).reduce((result,key)=>{let property=key in value?IntersectAssign(correct[key],value[key]):correct[key];return{...result,[key]:property}},{})}function FromIntersect12(schema,references,value){if(Check(schema,references,value))return value;let correct=Create2(schema,references),assigned=IntersectAssign(correct,value);return Check(schema,references,assigned)?assigned:correct}function FromNever5(schema,references,value){throw new ValueCastError(schema,"Never types cannot be cast")}function FromObject12(schema,references,value){if(Check(schema,references,value))return value;if(value===null||typeof value!=="object")return Create2(schema,references);let required=new Set(schema.required||[]),result={};for(let[key,property]of Object.entries(schema.properties)){if(!required.has(key)&&value[key]===void 0)continue;result[key]=Visit8(property,references,value[key])}if(typeof schema.additionalProperties==="object"){let propertyNames=Object.getOwnPropertyNames(schema.properties);for(let propertyName of Object.getOwnPropertyNames(value)){if(propertyNames.includes(propertyName))continue;result[propertyName]=Visit8(schema.additionalProperties,references,value[propertyName])}}return result}function FromRecord7(schema,references,value){if(Check(schema,references,value))return Clone2(value);if(value===null||typeof value!=="object"||Array.isArray(value)||value instanceof Date)return Create2(schema,references);let subschemaPropertyName=Object.getOwnPropertyNames(schema.patternProperties)[0],subschema=schema.patternProperties[subschemaPropertyName],result={};for(let[propKey,propValue]of Object.entries(value))result[propKey]=Visit8(subschema,references,propValue);return result}function FromRef8(schema,references,value){return Visit8(Deref(schema,references),references,value)}function FromThis4(schema,references,value){return Visit8(Deref(schema,references),references,value)}function FromTuple9(schema,references,value){if(Check(schema,references,value))return Clone2(value);if(!IsArray2(value))return Create2(schema,references);if(schema.items===void 0)return[];return schema.items.map((schema2,index)=>Visit8(schema2,references,value[index]))}function FromUnion14(schema,references,value){return Check(schema,references,value)?Clone2(value):CastUnion(schema,references,value)}function Visit8(schema,references,value){let references_=IsString2(schema.$id)?Pushref(schema,references):references,schema_=schema;switch(schema[Kind]){case"Array":return FromArray11(schema_,references_,value);case"Constructor":return FromConstructor7(schema_,references_,value);case"Import":return FromImport4(schema_,references_,value);case"Intersect":return FromIntersect12(schema_,references_,value);case"Never":return FromNever5(schema_,references_,value);case"Object":return FromObject12(schema_,references_,value);case"Record":return FromRecord7(schema_,references_,value);case"Ref":return FromRef8(schema_,references_,value);case"This":return FromThis4(schema_,references_,value);case"Tuple":return FromTuple9(schema_,references_,value);case"Union":return FromUnion14(schema_,references_,value);case"Date":case"Symbol":case"Uint8Array":return DefaultClone(schema,references,value);default:return Default(schema_,references_,value)}}function Cast(...args){return args.length===3?Visit8(args[0],args[1],args[2]):Visit8(args[0],[],args[1])}function IsCheckable(schema){return IsKind(schema)&&schema[Kind]!=="Unsafe"}function FromArray12(schema,references,value){if(!IsArray2(value))return value;return value.map((value2)=>Visit9(schema.items,references,value2))}function FromImport5(schema,references,value){let definitions=globalThis.Object.values(schema.$defs),target=schema.$defs[schema.$ref];return Visit9(target,[...references,...definitions],value)}function FromIntersect13(schema,references,value){let unevaluatedProperties=schema.unevaluatedProperties,composite=schema.allOf.map((schema2)=>Visit9(schema2,references,Clone2(value))).reduce((acc,value2)=>IsObject2(value2)?{...acc,...value2}:value2,{});if(!IsObject2(value)||!IsObject2(composite)||!IsKind(unevaluatedProperties))return composite;let knownkeys=KeyOfPropertyKeys(schema);for(let key of Object.getOwnPropertyNames(value)){if(knownkeys.includes(key))continue;if(Check(unevaluatedProperties,references,value[key]))composite[key]=Visit9(unevaluatedProperties,references,value[key])}return composite}function FromObject13(schema,references,value){if(!IsObject2(value)||IsArray2(value))return value;let additionalProperties=schema.additionalProperties;for(let key of Object.getOwnPropertyNames(value)){if(HasPropertyKey2(schema.properties,key)){value[key]=Visit9(schema.properties[key],references,value[key]);continue}if(IsKind(additionalProperties)&&Check(additionalProperties,references,value[key])){value[key]=Visit9(additionalProperties,references,value[key]);continue}delete value[key]}return value}function FromRecord8(schema,references,value){if(!IsObject2(value))return value;let additionalProperties=schema.additionalProperties,propertyKeys=Object.getOwnPropertyNames(value),[propertyKey,propertySchema]=Object.entries(schema.patternProperties)[0],propertyKeyTest=new RegExp(propertyKey);for(let key of propertyKeys){if(propertyKeyTest.test(key)){value[key]=Visit9(propertySchema,references,value[key]);continue}if(IsKind(additionalProperties)&&Check(additionalProperties,references,value[key])){value[key]=Visit9(additionalProperties,references,value[key]);continue}delete value[key]}return value}function FromRef9(schema,references,value){return Visit9(Deref(schema,references),references,value)}function FromThis5(schema,references,value){return Visit9(Deref(schema,references),references,value)}function FromTuple10(schema,references,value){if(!IsArray2(value))return value;if(IsUndefined2(schema.items))return[];let length=Math.min(value.length,schema.items.length);for(let i=0;i<length;i++)value[i]=Visit9(schema.items[i],references,value[i]);return value.length>length?value.slice(0,length):value}function FromUnion15(schema,references,value){for(let inner of schema.anyOf)if(IsCheckable(inner)&&Check(inner,references,value))return Visit9(inner,references,value);return value}function Visit9(schema,references,value){let references_=IsString2(schema.$id)?Pushref(schema,references):references,schema_=schema;switch(schema_[Kind]){case"Array":return FromArray12(schema_,references_,value);case"Import":return FromImport5(schema_,references_,value);case"Intersect":return FromIntersect13(schema_,references_,value);case"Object":return FromObject13(schema_,references_,value);case"Record":return FromRecord8(schema_,references_,value);case"Ref":return FromRef9(schema_,references_,value);case"This":return FromThis5(schema_,references_,value);case"Tuple":return FromTuple10(schema_,references_,value);case"Union":return FromUnion15(schema_,references_,value);default:return value}}function Clean(...args){return args.length===3?Visit9(args[0],args[1],args[2]):Visit9(args[0],[],args[1])}function IsStringNumeric(value){return IsString2(value)&&!isNaN(value)&&!isNaN(parseFloat(value))}function IsValueToString(value){return IsBigInt2(value)||IsBoolean2(value)||IsNumber2(value)}function IsValueTrue(value){return value===!0||IsNumber2(value)&&value===1||IsBigInt2(value)&&value===BigInt("1")||IsString2(value)&&(value.toLowerCase()==="true"||value==="1")}function IsValueFalse(value){return value===!1||IsNumber2(value)&&(value===0||Object.is(value,-0))||IsBigInt2(value)&&value===BigInt("0")||IsString2(value)&&(value.toLowerCase()==="false"||value==="0"||value==="-0")}function IsTimeStringWithTimeZone(value){return IsString2(value)&&/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i.test(value)}function IsTimeStringWithoutTimeZone(value){return IsString2(value)&&/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)?$/i.test(value)}function IsDateTimeStringWithTimeZone(value){return IsString2(value)&&/^\d\d\d\d-[0-1]\d-[0-3]\dt(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i.test(value)}function IsDateTimeStringWithoutTimeZone(value){return IsString2(value)&&/^\d\d\d\d-[0-1]\d-[0-3]\dt(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)?$/i.test(value)}function IsDateString(value){return IsString2(value)&&/^\d\d\d\d-[0-1]\d-[0-3]\d$/i.test(value)}function TryConvertLiteralString(value,target){let conversion=TryConvertString(value);return conversion===target?conversion:value}function TryConvertLiteralNumber(value,target){let conversion=TryConvertNumber(value);return conversion===target?conversion:value}function TryConvertLiteralBoolean(value,target){let conversion=TryConvertBoolean(value);return conversion===target?conversion:value}function TryConvertLiteral(schema,value){return IsString2(schema.const)?TryConvertLiteralString(value,schema.const):IsNumber2(schema.const)?TryConvertLiteralNumber(value,schema.const):IsBoolean2(schema.const)?TryConvertLiteralBoolean(value,schema.const):value}function TryConvertBoolean(value){return IsValueTrue(value)?!0:IsValueFalse(value)?!1:value}function TryConvertBigInt(value){let truncateInteger=(value2)=>value2.split(".")[0];return IsStringNumeric(value)?BigInt(truncateInteger(value)):IsNumber2(value)?BigInt(Math.trunc(value)):IsValueFalse(value)?BigInt(0):IsValueTrue(value)?BigInt(1):value}function TryConvertString(value){return IsSymbol2(value)&&value.description!==void 0?value.description.toString():IsValueToString(value)?value.toString():value}function TryConvertNumber(value){return IsStringNumeric(value)?parseFloat(value):IsValueTrue(value)?1:IsValueFalse(value)?0:value}function TryConvertInteger(value){return IsStringNumeric(value)?parseInt(value):IsNumber2(value)?Math.trunc(value):IsValueTrue(value)?1:IsValueFalse(value)?0:value}function TryConvertNull(value){return IsString2(value)&&value.toLowerCase()==="null"?null:value}function TryConvertUndefined(value){return IsString2(value)&&value==="undefined"?void 0:value}function TryConvertDate(value){return IsDate2(value)?value:IsNumber2(value)?new Date(value):IsValueTrue(value)?new Date(1):IsValueFalse(value)?new Date(0):IsStringNumeric(value)?new Date(parseInt(value)):IsTimeStringWithoutTimeZone(value)?new Date(`1970-01-01T${value}.000Z`):IsTimeStringWithTimeZone(value)?new Date(`1970-01-01T${value}`):IsDateTimeStringWithoutTimeZone(value)?new Date(`${value}.000Z`):IsDateTimeStringWithTimeZone(value)?new Date(value):IsDateString(value)?new Date(`${value}T00:00:00.000Z`):value}function Default2(value){return value}function FromArray13(schema,references,value){return(IsArray2(value)?value:[value]).map((element)=>Visit10(schema.items,references,element))}function FromBigInt5(schema,references,value){return TryConvertBigInt(value)}function FromBoolean5(schema,references,value){return TryConvertBoolean(value)}function FromDate6(schema,references,value){return TryConvertDate(value)}function FromImport6(schema,references,value){let definitions=globalThis.Object.values(schema.$defs),target=schema.$defs[schema.$ref];return Visit10(target,[...references,...definitions],value)}function FromInteger5(schema,references,value){return TryConvertInteger(value)}function FromIntersect14(schema,references,value){return schema.allOf.reduce((value2,schema2)=>Visit10(schema2,references,value2),value)}function FromLiteral6(schema,references,value){return TryConvertLiteral(schema,value)}function FromNull5(schema,references,value){return TryConvertNull(value)}function FromNumber5(schema,references,value){return TryConvertNumber(value)}function FromObject14(schema,references,value){if(!IsObject2(value)||IsArray2(value))return value;for(let propertyKey of Object.getOwnPropertyNames(schema.properties)){if(!HasPropertyKey2(value,propertyKey))continue;value[propertyKey]=Visit10(schema.properties[propertyKey],references,value[propertyKey])}return value}function FromRecord9(schema,references,value){if(!(IsObject2(value)&&!IsArray2(value)))return value;let propertyKey=Object.getOwnPropertyNames(schema.patternProperties)[0],property=schema.patternProperties[propertyKey];for(let[propKey,propValue]of Object.entries(value))value[propKey]=Visit10(property,references,propValue);return value}function FromRef10(schema,references,value){return Visit10(Deref(schema,references),references,value)}function FromString5(schema,references,value){return TryConvertString(value)}function FromSymbol5(schema,references,value){return IsString2(value)||IsNumber2(value)?Symbol(value):value}function FromThis6(schema,references,value){return Visit10(Deref(schema,references),references,value)}function FromTuple11(schema,references,value){if(!(IsArray2(value)&&!IsUndefined2(schema.items)))return value;return value.map((value2,index)=>{return index<schema.items.length?Visit10(schema.items[index],references,value2):value2})}function FromUndefined5(schema,references,value){return TryConvertUndefined(value)}function FromUnion16(schema,references,value){for(let subschema of schema.anyOf)if(Check(subschema,references,value))return value;for(let subschema of schema.anyOf){let converted=Visit10(subschema,references,Clone2(value));if(!Check(subschema,references,converted))continue;return converted}return value}function Visit10(schema,references,value){let references_=Pushref(schema,references),schema_=schema;switch(schema[Kind]){case"Array":return FromArray13(schema_,references_,value);case"BigInt":return FromBigInt5(schema_,references_,value);case"Boolean":return FromBoolean5(schema_,references_,value);case"Date":return FromDate6(schema_,references_,value);case"Import":return FromImport6(schema_,references_,value);case"Integer":return FromInteger5(schema_,references_,value);case"Intersect":return FromIntersect14(schema_,references_,value);case"Literal":return FromLiteral6(schema_,references_,value);case"Null":return FromNull5(schema_,references_,value);case"Number":return FromNumber5(schema_,references_,value);case"Object":return FromObject14(schema_,references_,value);case"Record":return FromRecord9(schema_,references_,value);case"Ref":return FromRef10(schema_,references_,value);case"String":return FromString5(schema_,references_,value);case"Symbol":return FromSymbol5(schema_,references_,value);case"This":return FromThis6(schema_,references_,value);case"Tuple":return FromTuple11(schema_,references_,value);case"Undefined":return FromUndefined5(schema_,references_,value);case"Union":return FromUnion16(schema_,references_,value);default:return Default2(value)}}function Convert(...args){return args.length===3?Visit10(args[0],args[1],args[2]):Visit10(args[0],[],args[1])}class TransformDecodeCheckError extends TypeBoxError{constructor(schema,value,error){super("Unable to decode value as it does not match the expected schema");this.schema=schema,this.value=value,this.error=error}}class TransformDecodeError extends TypeBoxError{constructor(schema,path,value,error){super(error instanceof Error?error.message:"Unknown error");this.schema=schema,this.path=path,this.value=value,this.error=error}}function Default3(schema,path,value){try{return IsTransform(schema)?schema[TransformKind].Decode(value):value}catch(error){throw new TransformDecodeError(schema,path,value,error)}}function FromArray14(schema,references,path,value){return IsArray2(value)?Default3(schema,path,value.map((value2,index)=>Visit11(schema.items,references,`${path}/${index}`,value2))):Default3(schema,path,value)}function FromIntersect15(schema,references,path,value){if(!IsObject2(value)||IsValueType(value))return Default3(schema,path,value);let knownEntries=KeyOfPropertyEntries(schema),knownKeys=knownEntries.map((entry)=>entry[0]),knownProperties={...value};for(let[knownKey,knownSchema]of knownEntries)if(knownKey in knownProperties)knownProperties[knownKey]=Visit11(knownSchema,references,`${path}/${knownKey}`,knownProperties[knownKey]);if(!IsTransform(schema.unevaluatedProperties))return Default3(schema,path,knownProperties);let unknownKeys=Object.getOwnPropertyNames(knownProperties),unevaluatedProperties=schema.unevaluatedProperties,unknownProperties={...knownProperties};for(let key of unknownKeys)if(!knownKeys.includes(key))unknownProperties[key]=Default3(unevaluatedProperties,`${path}/${key}`,unknownProperties[key]);return Default3(schema,path,unknownProperties)}function FromImport7(schema,references,path,value){let additional=globalThis.Object.values(schema.$defs),target=schema.$defs[schema.$ref],result=Visit11(target,[...references,...additional],path,value);return Default3(schema,path,result)}function FromNot5(schema,references,path,value){return Default3(schema,path,Visit11(schema.not,references,path,value))}function FromObject15(schema,references,path,value){if(!IsObject2(value))return Default3(schema,path,value);let knownKeys=KeyOfPropertyKeys(schema),knownProperties={...value};for(let key of knownKeys){if(!HasPropertyKey2(knownProperties,key))continue;if(IsUndefined2(knownProperties[key])&&(!IsUndefined3(schema.properties[key])||TypeSystemPolicy.IsExactOptionalProperty(knownProperties,key)))continue;knownProperties[key]=Visit11(schema.properties[key],references,`${path}/${key}`,knownProperties[key])}if(!IsSchema(schema.additionalProperties))return Default3(schema,path,knownProperties);let unknownKeys=Object.getOwnPropertyNames(knownProperties),additionalProperties=schema.additionalProperties,unknownProperties={...knownProperties};for(let key of unknownKeys)if(!knownKeys.includes(key))unknownProperties[key]=Default3(additionalProperties,`${path}/${key}`,unknownProperties[key]);return Default3(schema,path,unknownProperties)}function FromRecord10(schema,references,path,value){if(!IsObject2(value))return Default3(schema,path,value);let pattern=Object.getOwnPropertyNames(schema.patternProperties)[0],knownKeys=new RegExp(pattern),knownProperties={...value};for(let key of Object.getOwnPropertyNames(value))if(knownKeys.test(key))knownProperties[key]=Visit11(schema.patternProperties[pattern],references,`${path}/${key}`,knownProperties[key]);if(!IsSchema(schema.additionalProperties))return Default3(schema,path,knownProperties);let unknownKeys=Object.getOwnPropertyNames(knownProperties),additionalProperties=schema.additionalProperties,unknownProperties={...knownProperties};for(let key of unknownKeys)if(!knownKeys.test(key))unknownProperties[key]=Default3(additionalProperties,`${path}/${key}`,unknownProperties[key]);return Default3(schema,path,unknownProperties)}function FromRef11(schema,references,path,value){let target=Deref(schema,references);return Default3(schema,path,Visit11(target,references,path,value))}function FromThis7(schema,references,path,value){let target=Deref(schema,references);return Default3(schema,path,Visit11(target,references,path,value))}function FromTuple12(schema,references,path,value){return IsArray2(value)&&IsArray2(schema.items)?Default3(schema,path,schema.items.map((schema2,index)=>Visit11(schema2,references,`${path}/${index}`,value[index]))):Default3(schema,path,value)}function FromUnion17(schema,references,path,value){for(let subschema of schema.anyOf){if(!Check(subschema,references,value))continue;let decoded=Visit11(subschema,references,path,value);return Default3(schema,path,decoded)}return Default3(schema,path,value)}function Visit11(schema,references,path,value){let references_=Pushref(schema,references),schema_=schema;switch(schema[Kind]){case"Array":return FromArray14(schema_,references_,path,value);case"Import":return FromImport7(schema_,references_,path,value);case"Intersect":return FromIntersect15(schema_,references_,path,value);case"Not":return FromNot5(schema_,references_,path,value);case"Object":return FromObject15(schema_,references_,path,value);case"Record":return FromRecord10(schema_,references_,path,value);case"Ref":return FromRef11(schema_,references_,path,value);case"Symbol":return Default3(schema_,path,value);case"This":return FromThis7(schema_,references_,path,value);case"Tuple":return FromTuple12(schema_,references_,path,value);case"Union":return FromUnion17(schema_,references_,path,value);default:return Default3(schema_,path,value)}}function TransformDecode(schema,references,value){return Visit11(schema,references,"",value)}class TransformEncodeCheckError extends TypeBoxError{constructor(schema,value,error){super("The encoded value does not match the expected schema");this.schema=schema,this.value=value,this.error=error}}class TransformEncodeError extends TypeBoxError{constructor(schema,path,value,error){super(`${error instanceof Error?error.message:"Unknown error"}`);this.schema=schema,this.path=path,this.value=value,this.error=error}}function Default4(schema,path,value){try{return IsTransform(schema)?schema[TransformKind].Encode(value):value}catch(error){throw new TransformEncodeError(schema,path,value,error)}}function FromArray15(schema,references,path,value){let defaulted=Default4(schema,path,value);return IsArray2(defaulted)?defaulted.map((value2,index)=>Visit12(schema.items,references,`${path}/${index}`,value2)):defaulted}function FromImport8(schema,references,path,value){let additional=globalThis.Object.values(schema.$defs),target=schema.$defs[schema.$ref],result=Default4(schema,path,value);return Visit12(target,[...references,...additional],path,result)}function FromIntersect16(schema,references,path,value){let defaulted=Default4(schema,path,value);if(!IsObject2(value)||IsValueType(value))return defaulted;let knownEntries=KeyOfPropertyEntries(schema),knownKeys=knownEntries.map((entry)=>entry[0]),knownProperties={...defaulted};for(let[knownKey,knownSchema]of knownEntries)if(knownKey in knownProperties)knownProperties[knownKey]=Visit12(knownSchema,references,`${path}/${knownKey}`,knownProperties[knownKey]);if(!IsTransform(schema.unevaluatedProperties))return knownProperties;let unknownKeys=Object.getOwnPropertyNames(knownProperties),unevaluatedProperties=schema.unevaluatedProperties,properties={...knownProperties};for(let key of unknownKeys)if(!knownKeys.includes(key))properties[key]=Default4(unevaluatedProperties,`${path}/${key}`,properties[key]);return properties}function FromNot6(schema,references,path,value){return Default4(schema.not,path,Default4(schema,path,value))}function FromObject16(schema,references,path,value){let defaulted=Default4(schema,path,value);if(!IsObject2(defaulted))return defaulted;let knownKeys=KeyOfPropertyKeys(schema),knownProperties={...defaulted};for(let key of knownKeys){if(!HasPropertyKey2(knownProperties,key))continue;if(IsUndefined2(knownProperties[key])&&(!IsUndefined3(schema.properties[key])||TypeSystemPolicy.IsExactOptionalProperty(knownProperties,key)))continue;knownProperties[key]=Visit12(schema.properties[key],references,`${path}/${key}`,knownProperties[key])}if(!IsSchema(schema.additionalProperties))return knownProperties;let unknownKeys=Object.getOwnPropertyNames(knownProperties),additionalProperties=schema.additionalProperties,properties={...knownProperties};for(let key of unknownKeys)if(!knownKeys.includes(key))properties[key]=Default4(additionalProperties,`${path}/${key}`,properties[key]);return properties}function FromRecord11(schema,references,path,value){let defaulted=Default4(schema,path,value);if(!IsObject2(value))return defaulted;let pattern=Object.getOwnPropertyNames(schema.patternProperties)[0],knownKeys=new RegExp(pattern),knownProperties={...defaulted};for(let key of Object.getOwnPropertyNames(value))if(knownKeys.test(key))knownProperties[key]=Visit12(schema.patternProperties[pattern],references,`${path}/${key}`,knownProperties[key]);if(!IsSchema(schema.additionalProperties))return knownProperties;let unknownKeys=Object.getOwnPropertyNames(knownProperties),additionalProperties=schema.additionalProperties,properties={...knownProperties};for(let key of unknownKeys)if(!knownKeys.test(key))properties[key]=Default4(additionalProperties,`${path}/${key}`,properties[key]);return properties}function FromRef12(schema,references,path,value){let target=Deref(schema,references),resolved=Visit12(target,references,path,value);return Default4(schema,path,resolved)}function FromThis8(schema,references,path,value){let target=Deref(schema,references),resolved=Visit12(target,references,path,value);return Default4(schema,path,resolved)}function FromTuple13(schema,references,path,value){let value1=Default4(schema,path,value);return IsArray2(schema.items)?schema.items.map((schema2,index)=>Visit12(schema2,references,`${path}/${index}`,value1[index])):[]}function FromUnion18(schema,references,path,value){for(let subschema of schema.anyOf){if(!Check(subschema,references,value))continue;let value1=Visit12(subschema,references,path,value);return Default4(schema,path,value1)}for(let subschema of schema.anyOf){let value1=Visit12(subschema,references,path,value);if(!Check(schema,references,value1))continue;return Default4(schema,path,value1)}return Default4(schema,path,value)}function Visit12(schema,references,path,value){let references_=Pushref(schema,references),schema_=schema;switch(schema[Kind]){case"Array":return FromArray15(schema_,references_,path,value);case"Import":return FromImport8(schema_,references_,path,value);case"Intersect":return FromIntersect16(schema_,references_,path,value);case"Not":return FromNot6(schema_,references_,path,value);case"Object":return FromObject16(schema_,references_,path,value);case"Record":return FromRecord11(schema_,references_,path,value);case"Ref":return FromRef12(schema_,references_,path,value);case"This":return FromThis8(schema_,references_,path,value);case"Tuple":return FromTuple13(schema_,references_,path,value);case"Union":return FromUnion18(schema_,references_,path,value);default:return Default4(schema_,path,value)}}function TransformEncode(schema,references,value){return Visit12(schema,references,"",value)}function FromArray16(schema,references){return IsTransform(schema)||Visit13(schema.items,references)}function FromAsyncIterator7(schema,references){return IsTransform(schema)||Visit13(schema.items,references)}function FromConstructor8(schema,references){return IsTransform(schema)||Visit13(schema.returns,references)||schema.parameters.some((schema2)=>Visit13(schema2,references))}function FromFunction7(schema,references){return IsTransform(schema)||Visit13(schema.returns,references)||schema.parameters.some((schema2)=>Visit13(schema2,references))}function FromIntersect17(schema,references){return IsTransform(schema)||IsTransform(schema.unevaluatedProperties)||schema.allOf.some((schema2)=>Visit13(schema2,references))}function FromImport9(schema,references){let additional=globalThis.Object.getOwnPropertyNames(schema.$defs).reduce((result,key)=>[...result,schema.$defs[key]],[]),target=schema.$defs[schema.$ref];return IsTransform(schema)||Visit13(target,[...additional,...references])}function FromIterator7(schema,references){return IsTransform(schema)||Visit13(schema.items,references)}function FromNot7(schema,references){return IsTransform(schema)||Visit13(schema.not,references)}function FromObject17(schema,references){return IsTransform(schema)||Object.values(schema.properties).some((schema2)=>Visit13(schema2,references))||IsSchema(schema.additionalProperties)&&Visit13(schema.additionalProperties,references)}function FromPromise7(schema,references){return IsTransform(schema)||Visit13(schema.item,references)}function FromRecord12(schema,references){let pattern=Object.getOwnPropertyNames(schema.patternProperties)[0],property=schema.patternProperties[pattern];return IsTransform(schema)||Visit13(property,references)||IsSchema(schema.additionalProperties)&&IsTransform(schema.additionalProperties)}function FromRef13(schema,references){if(IsTransform(schema))return!0;return Visit13(Deref(schema,references),references)}function FromThis9(schema,references){if(IsTransform(schema))return!0;return Visit13(Deref(schema,references),references)}function FromTuple14(schema,references){return IsTransform(schema)||!IsUndefined2(schema.items)&&schema.items.some((schema2)=>Visit13(schema2,references))}function FromUnion19(schema,references){return IsTransform(schema)||schema.anyOf.some((schema2)=>Visit13(schema2,references))}function Visit13(schema,references){let references_=Pushref(schema,references),schema_=schema;if(schema.$id&&visited.has(schema.$id))return!1;if(schema.$id)visited.add(schema.$id);switch(schema[Kind]){case"Array":return FromArray16(schema_,references_);case"AsyncIterator":return FromAsyncIterator7(schema_,references_);case"Constructor":return FromConstructor8(schema_,references_);case"Function":return FromFunction7(schema_,references_);case"Import":return FromImport9(schema_,references_);case"Intersect":return FromIntersect17(schema_,references_);case"Iterator":return FromIterator7(schema_,references_);case"Not":return FromNot7(schema_,references_);case"Object":return FromObject17(schema_,references_);case"Promise":return FromPromise7(schema_,references_);case"Record":return FromRecord12(schema_,references_);case"Ref":return FromRef13(schema_,references_);case"This":return FromThis9(schema_,references_);case"Tuple":return FromTuple14(schema_,references_);case"Union":return FromUnion19(schema_,references_);default:return IsTransform(schema)}}var visited=new Set;function HasTransform(schema,references){return visited.clear(),Visit13(schema,references)}function Decode(...args){let[schema,references,value]=args.length===3?[args[0],args[1],args[2]]:[args[0],[],args[1]];if(!Check(schema,references,value))throw new TransformDecodeCheckError(schema,value,Errors(schema,references,value).First());return HasTransform(schema,references)?TransformDecode(schema,references,value):value}function ValueOrDefault(schema,value){let defaultValue=HasPropertyKey2(schema,"default")?schema.default:void 0,clone=IsFunction2(defaultValue)?defaultValue():Clone2(defaultValue);return IsUndefined2(value)?clone:IsObject2(value)&&IsObject2(clone)?Object.assign(clone,value):value}function HasDefaultProperty(schema){return IsKind(schema)&&"default"in schema}function FromArray17(schema,references,value){if(IsArray2(value)){for(let i=0;i<value.length;i++)value[i]=Visit14(schema.items,references,value[i]);return value}let defaulted=ValueOrDefault(schema,value);if(!IsArray2(defaulted))return defaulted;for(let i=0;i<defaulted.length;i++)defaulted[i]=Visit14(schema.items,references,defaulted[i]);return defaulted}function FromDate7(schema,references,value){return IsDate2(value)?value:ValueOrDefault(schema,value)}function FromImport10(schema,references,value){let definitions=globalThis.Object.values(schema.$defs),target=schema.$defs[schema.$ref];return Visit14(target,[...references,...definitions],value)}function FromIntersect18(schema,references,value){let defaulted=ValueOrDefault(schema,value);return schema.allOf.reduce((acc,schema2)=>{let next=Visit14(schema2,references,defaulted);return IsObject2(next)?{...acc,...next}:next},{})}function FromObject18(schema,references,value){let defaulted=ValueOrDefault(schema,value);if(!IsObject2(defaulted))return defaulted;let knownPropertyKeys=Object.getOwnPropertyNames(schema.properties);for(let key of knownPropertyKeys){let propertyValue=Visit14(schema.properties[key],references,defaulted[key]);if(IsUndefined2(propertyValue))continue;defaulted[key]=Visit14(schema.properties[key],references,defaulted[key])}if(!HasDefaultProperty(schema.additionalProperties))return defaulted;for(let key of Object.getOwnPropertyNames(defaulted)){if(knownPropertyKeys.includes(key))continue;defaulted[key]=Visit14(schema.additionalProperties,references,defaulted[key])}return defaulted}function FromRecord13(schema,references,value){let defaulted=ValueOrDefault(schema,value);if(!IsObject2(defaulted))return defaulted;let additionalPropertiesSchema=schema.additionalProperties,[propertyKeyPattern,propertySchema]=Object.entries(schema.patternProperties)[0],knownPropertyKey=new RegExp(propertyKeyPattern);for(let key of Object.getOwnPropertyNames(defaulted)){if(!(knownPropertyKey.test(key)&&HasDefaultProperty(propertySchema)))continue;defaulted[key]=Visit14(propertySchema,references,defaulted[key])}if(!HasDefaultProperty(additionalPropertiesSchema))return defaulted;for(let key of Object.getOwnPropertyNames(defaulted)){if(knownPropertyKey.test(key))continue;defaulted[key]=Visit14(additionalPropertiesSchema,references,defaulted[key])}return defaulted}function FromRef14(schema,references,value){return Visit14(Deref(schema,references),references,ValueOrDefault(schema,value))}function FromThis10(schema,references,value){return Visit14(Deref(schema,references),references,value)}function FromTuple15(schema,references,value){let defaulted=ValueOrDefault(schema,value);if(!IsArray2(defaulted)||IsUndefined2(schema.items))return defaulted;let[items,max]=[schema.items,Math.max(schema.items.length,defaulted.length)];for(let i=0;i<max;i++)if(i<items.length)defaulted[i]=Visit14(items[i],references,defaulted[i]);return defaulted}function FromUnion20(schema,references,value){let defaulted=ValueOrDefault(schema,value);for(let inner of schema.anyOf){let result=Visit14(inner,references,Clone2(defaulted));if(Check(inner,references,result))return result}return defaulted}function Visit14(schema,references,value){let references_=Pushref(schema,references),schema_=schema;switch(schema_[Kind]){case"Array":return FromArray17(schema_,references_,value);case"Date":return FromDate7(schema_,references_,value);case"Import":return FromImport10(schema_,references_,value);case"Intersect":return FromIntersect18(schema_,references_,value);case"Object":return FromObject18(schema_,references_,value);case"Record":return FromRecord13(schema_,references_,value);case"Ref":return FromRef14(schema_,references_,value);case"This":return FromThis10(schema_,references_,value);case"Tuple":return FromTuple15(schema_,references_,value);case"Union":return FromUnion20(schema_,references_,value);default:return ValueOrDefault(schema_,value)}}function Default5(...args){return args.length===3?Visit14(args[0],args[1],args[2]):Visit14(args[0],[],args[1])}var exports_pointer={};__export(exports_pointer,{ValuePointerRootSetError:()=>ValuePointerRootSetError,ValuePointerRootDeleteError:()=>ValuePointerRootDeleteError,Set:()=>Set4,Has:()=>Has3,Get:()=>Get3,Format:()=>Format,Delete:()=>Delete3});class ValuePointerRootSetError extends TypeBoxError{constructor(value,path,update){super("Cannot set root value");this.value=value,this.path=path,this.update=update}}class ValuePointerRootDeleteError extends TypeBoxError{constructor(value,path){super("Cannot delete root value");this.value=value,this.path=path}}function Escape2(component){return component.indexOf("~")===-1?component:component.replace(/~1/g,"/").replace(/~0/g,"~")}function*Format(pointer){if(pointer==="")return;let[start,end]=[0,0];for(let i=0;i<pointer.length;i++)if(pointer.charAt(i)==="/")if(i===0)start=i+1;else end=i,yield Escape2(pointer.slice(start,end)),start=i+1;else end=i;yield Escape2(pointer.slice(start))}function Set4(value,pointer,update){if(pointer==="")throw new ValuePointerRootSetError(value,pointer,update);let[owner,next,key]=[null,value,""];for(let component of Format(pointer)){if(next[component]===void 0)next[component]={};owner=next,next=next[component],key=component}owner[key]=update}function Delete3(value,pointer){if(pointer==="")throw new ValuePointerRootDeleteError(value,pointer);let[owner,next,key]=[null,value,""];for(let component of Format(pointer)){if(next[component]===void 0||next[component]===null)return;owner=next,next=next[component],key=component}if(Array.isArray(owner)){let index=parseInt(key);owner.splice(index,1)}else delete owner[key]}function Has3(value,pointer){if(pointer==="")return!0;let[owner,next,key]=[null,value,""];for(let component of Format(pointer)){if(next[component]===void 0)return!1;owner=next,next=next[component],key=component}return Object.getOwnPropertyNames(owner).includes(key)}function Get3(value,pointer){if(pointer==="")return value;let current=value;for(let component of Format(pointer)){if(current[component]===void 0)return;current=current[component]}return current}function ObjectType3(left,right){if(!IsObject2(right))return!1;let leftKeys=[...Object.keys(left),...Object.getOwnPropertySymbols(left)],rightKeys=[...Object.keys(right),...Object.getOwnPropertySymbols(right)];if(leftKeys.length!==rightKeys.length)return!1;return leftKeys.every((key)=>Equal(left[key],right[key]))}function DateType3(left,right){return IsDate2(right)&&left.getTime()===right.getTime()}function ArrayType3(left,right){if(!IsArray2(right)||left.length!==right.length)return!1;return left.every((value,index)=>Equal(value,right[index]))}function TypedArrayType(left,right){if(!IsTypedArray(right)||left.length!==right.length||Object.getPrototypeOf(left).constructor.name!==Object.getPrototypeOf(right).constructor.name)return!1;return left.every((value,index)=>Equal(value,right[index]))}function ValueType(left,right){return left===right}function Equal(left,right){if(IsDate2(left))return DateType3(left,right);if(IsTypedArray(left))return TypedArrayType(left,right);if(IsArray2(left))return ArrayType3(left,right);if(IsObject2(left))return ObjectType3(left,right);if(IsValueType(left))return ValueType(left,right);throw Error("ValueEquals: Unable to compare value")}var Insert=Object2({type:Literal("insert"),path:String2(),value:Unknown()}),Update=Object2({type:Literal("update"),path:String2(),value:Unknown()}),Delete4=Object2({type:Literal("delete"),path:String2()}),Edit=Union([Insert,Update,Delete4]);class ValueDiffError extends TypeBoxError{constructor(value,message){super(message);this.value=value}}function CreateUpdate(path,value){return{type:"update",path,value}}function CreateInsert(path,value){return{type:"insert",path,value}}function CreateDelete(path){return{type:"delete",path}}function AssertDiffable(value){if(globalThis.Object.getOwnPropertySymbols(value).length>0)throw new ValueDiffError(value,"Cannot diff objects with symbols")}function*ObjectType4(path,current,next){if(AssertDiffable(current),AssertDiffable(next),!IsStandardObject(next))return yield CreateUpdate(path,next);let currentKeys=globalThis.Object.getOwnPropertyNames(current),nextKeys=globalThis.Object.getOwnPropertyNames(next);for(let key of nextKeys){if(HasPropertyKey2(current,key))continue;yield CreateInsert(`${path}/${key}`,next[key])}for(let key of currentKeys){if(!HasPropertyKey2(next,key))continue;if(Equal(current,next))continue;yield*Visit15(`${path}/${key}`,current[key],next[key])}for(let key of currentKeys){if(HasPropertyKey2(next,key))continue;yield CreateDelete(`${path}/${key}`)}}function*ArrayType4(path,current,next){if(!IsArray2(next))return yield CreateUpdate(path,next);for(let i=0;i<Math.min(current.length,next.length);i++)yield*Visit15(`${path}/${i}`,current[i],next[i]);for(let i=0;i<next.length;i++){if(i<current.length)continue;yield CreateInsert(`${path}/${i}`,next[i])}for(let i=current.length-1;i>=0;i--){if(i<next.length)continue;yield CreateDelete(`${path}/${i}`)}}function*TypedArrayType2(path,current,next){if(!IsTypedArray(next)||current.length!==next.length||globalThis.Object.getPrototypeOf(current).constructor.name!==globalThis.Object.getPrototypeOf(next).constructor.name)return yield CreateUpdate(path,next);for(let i=0;i<Math.min(current.length,next.length);i++)yield*Visit15(`${path}/${i}`,current[i],next[i])}function*ValueType2(path,current,next){if(current===next)return;yield CreateUpdate(path,next)}function*Visit15(path,current,next){if(IsStandardObject(current))return yield*ObjectType4(path,current,next);if(IsArray2(current))return yield*ArrayType4(path,current,next);if(IsTypedArray(current))return yield*TypedArrayType2(path,current,next);if(IsValueType(current))return yield*ValueType2(path,current,next);throw new ValueDiffError(current,"Unable to diff value")}function Diff(current,next){return[...Visit15("",current,next)]}function IsRootUpdate(edits){return edits.length>0&&edits[0].path===""&&edits[0].type==="update"}function IsIdentity(edits){return edits.length===0}function Patch(current,edits){if(IsRootUpdate(edits))return Clone2(edits[0].value);if(IsIdentity(edits))return Clone2(current);let clone=Clone2(current);for(let edit of edits)switch(edit.type){case"insert":{exports_pointer.Set(clone,edit.path,edit.value);break}case"update":{exports_pointer.Set(clone,edit.path,edit.value);break}case"delete":{exports_pointer.Delete(clone,edit.path);break}}return clone}function Encode(...args){let[schema,references,value]=args.length===3?[args[0],args[1],args[2]]:[args[0],[],args[1]],encoded=HasTransform(schema,references)?TransformEncode(schema,references,value):value;if(!Check(schema,references,encoded))throw new TransformEncodeCheckError(schema,encoded,Errors(schema,references,encoded).First());return encoded}function IsStandardObject2(value){return IsObject2(value)&&!IsArray2(value)}class ValueMutateError extends TypeBoxError{constructor(message){super(message)}}function ObjectType5(root,path,current,next){if(!IsStandardObject2(current))exports_pointer.Set(root,path,Clone2(next));else{let currentKeys=Object.getOwnPropertyNames(current),nextKeys=Object.getOwnPropertyNames(next);for(let currentKey of currentKeys)if(!nextKeys.includes(currentKey))delete current[currentKey];for(let nextKey of nextKeys)if(!currentKeys.includes(nextKey))current[nextKey]=null;for(let nextKey of nextKeys)Visit16(root,`${path}/${nextKey}`,current[nextKey],next[nextKey])}}function ArrayType5(root,path,current,next){if(!IsArray2(current))exports_pointer.Set(root,path,Clone2(next));else{for(let index=0;index<next.length;index++)Visit16(root,`${path}/${index}`,current[index],next[index]);current.splice(next.length)}}function TypedArrayType3(root,path,current,next){if(IsTypedArray(current)&&current.length===next.length)for(let i=0;i<current.length;i++)current[i]=next[i];else exports_pointer.Set(root,path,Clone2(next))}function ValueType3(root,path,current,next){if(current===next)return;exports_pointer.Set(root,path,next)}function Visit16(root,path,current,next){if(IsArray2(next))return ArrayType5(root,path,current,next);if(IsTypedArray(next))return TypedArrayType3(root,path,current,next);if(IsStandardObject2(next))return ObjectType5(root,path,current,next);if(IsValueType(next))return ValueType3(root,path,current,next)}function IsNonMutableValue(value){return IsTypedArray(value)||IsValueType(value)}function IsMismatchedValue(current,next){return IsStandardObject2(current)&&IsArray2(next)||IsArray2(current)&&IsStandardObject2(next)}function Mutate(current,next){if(IsNonMutableValue(current)||IsNonMutableValue(next))throw new ValueMutateError("Only object and array types can be mutated at the root level");if(IsMismatchedValue(current,next))throw new ValueMutateError("Cannot assign due type mismatch of assignable values");Visit16(current,"",current,next)}class ParseError extends TypeBoxError{constructor(message){super(message)}}var ParseRegistry;(function(ParseRegistry2){let registry=new Map([["Assert",(type,references,value)=>{return Assert(type,references,value),value}],["Cast",(type,references,value)=>Cast(type,references,value)],["Clean",(type,references,value)=>Clean(type,references,value)],["Clone",(_type,_references,value)=>Clone2(value)],["Convert",(type,references,value)=>Convert(type,references,value)],["Decode",(type,references,value)=>HasTransform(type,references)?TransformDecode(type,references,value):value],["Default",(type,references,value)=>Default5(type,references,value)],["Encode",(type,references,value)=>HasTransform(type,references)?TransformEncode(type,references,value):value]]);function Delete5(key){registry.delete(key)}ParseRegistry2.Delete=Delete5;function Set5(key,callback){registry.set(key,callback)}ParseRegistry2.Set=Set5;function Get4(key){return registry.get(key)}ParseRegistry2.Get=Get4})(ParseRegistry||(ParseRegistry={}));var ParseDefault=["Clone","Clean","Default","Convert","Assert","Decode"];function ParseValue(operations,type,references,value){return operations.reduce((value2,operationKey)=>{let operation=ParseRegistry.Get(operationKey);if(IsUndefined2(operation))throw new ParseError(`Unable to find Parse operation '${operationKey}'`);return operation(type,references,value2)},value)}function Parse(...args){let[operations,schema,references,value]=args.length===4?[args[0],args[1],args[2],args[3]]:args.length===3?IsArray2(args[0])?[args[0],args[1],[],args[2]]:[ParseDefault,args[0],args[1],args[2]]:args.length===2?[ParseDefault,args[0],[],args[1]]:(()=>{throw new ParseError("Invalid Arguments")})();return ParseValue(operations,schema,references,value)}var exports_value2={};__export(exports_value2,{ValueErrorIterator:()=>ValueErrorIterator,Patch:()=>Patch,Parse:()=>Parse,Mutate:()=>Mutate,Hash:()=>Hash,Errors:()=>Errors,Equal:()=>Equal,Encode:()=>Encode,Edit:()=>Edit,Diff:()=>Diff,Default:()=>Default5,Decode:()=>Decode,Create:()=>Create2,Convert:()=>Convert,Clone:()=>Clone2,Clean:()=>Clean,Check:()=>Check,Cast:()=>Cast,Assert:()=>Assert});class TypeCheck{constructor(schema,references,checkFunc,code){this.schema=schema,this.references=references,this.checkFunc=checkFunc,this.code=code,this.hasTransform=HasTransform(schema,references)}Code(){return this.code}Schema(){return this.schema}References(){return this.references}Errors(value){return Errors(this.schema,this.references,value)}Check(value){return this.checkFunc(value)}Decode(value){if(!this.checkFunc(value))throw new TransformDecodeCheckError(this.schema,value,this.Errors(value).First());return this.hasTransform?TransformDecode(this.schema,this.references,value):value}Encode(value){let encoded=this.hasTransform?TransformEncode(this.schema,this.references,value):value;if(!this.checkFunc(encoded))throw new TransformEncodeCheckError(this.schema,value,this.Errors(value).First());return encoded}}var Character;(function(Character2){function DollarSign(code){return code===36}Character2.DollarSign=DollarSign;function IsUnderscore(code){return code===95}Character2.IsUnderscore=IsUnderscore;function IsAlpha(code){return code>=65&&code<=90||code>=97&&code<=122}Character2.IsAlpha=IsAlpha;function IsNumeric(code){return code>=48&&code<=57}Character2.IsNumeric=IsNumeric})(Character||(Character={}));var MemberExpression;(function(MemberExpression2){function IsFirstCharacterNumeric(value){if(value.length===0)return!1;return Character.IsNumeric(value.charCodeAt(0))}function IsAccessor(value){if(IsFirstCharacterNumeric(value))return!1;for(let i=0;i<value.length;i++){let code=value.charCodeAt(i);if(!(Character.IsAlpha(code)||Character.IsNumeric(code)||Character.DollarSign(code)||Character.IsUnderscore(code)))return!1}return!0}function EscapeHyphen(key){return key.replace(/'/g,"\\'")}function Encode2(object,key){return IsAccessor(key)?`${object}.${key}`:`${object}['${EscapeHyphen(key)}']`}MemberExpression2.Encode=Encode2})(MemberExpression||(MemberExpression={}));var Identifier;(function(Identifier2){function Encode2($id){let buffer=[];for(let i=0;i<$id.length;i++){let code=$id.charCodeAt(i);if(Character.IsNumeric(code)||Character.IsAlpha(code))buffer.push($id.charAt(i));else buffer.push(`_${code}_`)}return buffer.join("").replace(/__/g,"_")}Identifier2.Encode=Encode2})(Identifier||(Identifier={}));var LiteralString;(function(LiteralString2){function Escape3(content){return content.replace(/'/g,"\\'")}LiteralString2.Escape=Escape3})(LiteralString||(LiteralString={}));class TypeCompilerUnknownTypeError extends TypeBoxError{constructor(schema){super("Unknown type");this.schema=schema}}class TypeCompilerTypeGuardError extends TypeBoxError{constructor(schema){super("Preflight validation check failed to guard for the given schema");this.schema=schema}}var Policy;(function(Policy2){function IsExactOptionalProperty(value,key,expression){return TypeSystemPolicy.ExactOptionalPropertyTypes?`('${key}' in ${value} ? ${expression} : true)`:`(${MemberExpression.Encode(value,key)} !== undefined ? ${expression} : true)`}Policy2.IsExactOptionalProperty=IsExactOptionalProperty;function IsObjectLike(value){return!TypeSystemPolicy.AllowArrayObject?`(typeof ${value} === 'object' && ${value} !== null && !Array.isArray(${value}))`:`(typeof ${value} === 'object' && ${value} !== null)`}Policy2.IsObjectLike=IsObjectLike;function IsRecordLike(value){return!TypeSystemPolicy.AllowArrayObject?`(typeof ${value} === 'object' && ${value} !== null && !Array.isArray(${value}) && !(${value} instanceof Date) && !(${value} instanceof Uint8Array))`:`(typeof ${value} === 'object' && ${value} !== null && !(${value} instanceof Date) && !(${value} instanceof Uint8Array))`}Policy2.IsRecordLike=IsRecordLike;function IsNumberLike(value){return TypeSystemPolicy.AllowNaN?`typeof ${value} === 'number'`:`Number.isFinite(${value})`}Policy2.IsNumberLike=IsNumberLike;function IsVoidLike(value){return TypeSystemPolicy.AllowNullVoid?`(${value} === undefined || ${value} === null)`:`${value} === undefined`}Policy2.IsVoidLike=IsVoidLike})(Policy||(Policy={}));var TypeCompiler;(function(TypeCompiler2){function IsAnyOrUnknown2(schema){return schema[Kind]==="Any"||schema[Kind]==="Unknown"}function*FromAny5(schema,references,value){yield"true"}function*FromArgument5(schema,references,value){yield"true"}function*FromArray18(schema,references,value){yield`Array.isArray(${value})`;let[parameter,accumulator]=[CreateParameter("value","any"),CreateParameter("acc","number")];if(IsNumber2(schema.maxItems))yield`${value}.length <= ${schema.maxItems}`;if(IsNumber2(schema.minItems))yield`${value}.length >= ${schema.minItems}`;let elementExpression=CreateExpression(schema.items,references,"value");if(yield`${value}.every((${parameter}) => ${elementExpression})`,IsSchema2(schema.contains)||IsNumber2(schema.minContains)||IsNumber2(schema.maxContains)){let containsSchema=IsSchema2(schema.contains)?schema.contains:Never(),checkExpression=CreateExpression(containsSchema,references,"value"),checkMinContains=IsNumber2(schema.minContains)?[`(count >= ${schema.minContains})`]:[],checkMaxContains=IsNumber2(schema.maxContains)?[`(count <= ${schema.maxContains})`]:[],checkCount=`const count = value.reduce((${accumulator}, ${parameter}) => ${checkExpression} ? acc + 1 : acc, 0)`,check2=["(count > 0)",...checkMinContains,...checkMaxContains].join(" && ");yield`((${parameter}) => { ${checkCount}; return ${check2}})(${value})`}if(schema.uniqueItems===!0)yield`((${parameter}) => { const set = new Set(); for(const element of value) { const hashed = hash(element); if(set.has(hashed)) { return false } else { set.add(hashed) } } return true } )(${value})`}function*FromAsyncIterator8(schema,references,value){yield`(typeof value === 'object' && Symbol.asyncIterator in ${value})`}function*FromBigInt6(schema,references,value){if(yield`(typeof ${value} === 'bigint')`,IsBigInt2(schema.exclusiveMaximum))yield`${value} < BigInt(${schema.exclusiveMaximum})`;if(IsBigInt2(schema.exclusiveMinimum))yield`${value} > BigInt(${schema.exclusiveMinimum})`;if(IsBigInt2(schema.maximum))yield`${value} <= BigInt(${schema.maximum})`;if(IsBigInt2(schema.minimum))yield`${value} >= BigInt(${schema.minimum})`;if(IsBigInt2(schema.multipleOf))yield`(${value} % BigInt(${schema.multipleOf})) === 0`}function*FromBoolean6(schema,references,value){yield`(typeof ${value} === 'boolean')`}function*FromConstructor9(schema,references,value){yield*Visit17(schema.returns,references,`${value}.prototype`)}function*FromDate8(schema,references,value){if(yield`(${value} instanceof Date) && Number.isFinite(${value}.getTime())`,IsNumber2(schema.exclusiveMaximumTimestamp))yield`${value}.getTime() < ${schema.exclusiveMaximumTimestamp}`;if(IsNumber2(schema.exclusiveMinimumTimestamp))yield`${value}.getTime() > ${schema.exclusiveMinimumTimestamp}`;if(IsNumber2(schema.maximumTimestamp))yield`${value}.getTime() <= ${schema.maximumTimestamp}`;if(IsNumber2(schema.minimumTimestamp))yield`${value}.getTime() >= ${schema.minimumTimestamp}`;if(IsNumber2(schema.multipleOfTimestamp))yield`(${value}.getTime() % ${schema.multipleOfTimestamp}) === 0`}function*FromFunction8(schema,references,value){yield`(typeof ${value} === 'function')`}function*FromImport11(schema,references,value){let members=globalThis.Object.getOwnPropertyNames(schema.$defs).reduce((result,key)=>{return[...result,schema.$defs[key]]},[]);yield*Visit17(Ref(schema.$ref),[...references,...members],value)}function*FromInteger6(schema,references,value){if(yield`Number.isInteger(${value})`,IsNumber2(schema.exclusiveMaximum))yield`${value} < ${schema.exclusiveMaximum}`;if(IsNumber2(schema.exclusiveMinimum))yield`${value} > ${schema.exclusiveMinimum}`;if(IsNumber2(schema.maximum))yield`${value} <= ${schema.maximum}`;if(IsNumber2(schema.minimum))yield`${value} >= ${schema.minimum}`;if(IsNumber2(schema.multipleOf))yield`(${value} % ${schema.multipleOf}) === 0`}function*FromIntersect19(schema,references,value){let check1=schema.allOf.map((schema2)=>CreateExpression(schema2,references,value)).join(" && ");if(schema.unevaluatedProperties===!1){let keyCheck=CreateVariable(`${new RegExp(KeyOfPattern(schema))};`),check2=`Object.getOwnPropertyNames(${value}).every(key => ${keyCheck}.test(key))`;yield`(${check1} && ${check2})`}else if(IsSchema2(schema.unevaluatedProperties)){let keyCheck=CreateVariable(`${new RegExp(KeyOfPattern(schema))};`),check2=`Object.getOwnPropertyNames(${value}).every(key => ${keyCheck}.test(key) || ${CreateExpression(schema.unevaluatedProperties,references,`${value}[key]`)})`;yield`(${check1} && ${check2})`}else yield`(${check1})`}function*FromIterator8(schema,references,value){yield`(typeof value === 'object' && Symbol.iterator in ${value})`}function*FromLiteral7(schema,references,value){if(typeof schema.const==="number"||typeof schema.const==="boolean")yield`(${value} === ${schema.const})`;else yield`(${value} === '${LiteralString.Escape(schema.const)}')`}function*FromNever6(schema,references,value){yield"false"}function*FromNot8(schema,references,value){yield`(!${CreateExpression(schema.not,references,value)})`}function*FromNull6(schema,references,value){yield`(${value} === null)`}function*FromNumber6(schema,references,value){if(yield Policy.IsNumberLike(value),IsNumber2(schema.exclusiveMaximum))yield`${value} < ${schema.exclusiveMaximum}`;if(IsNumber2(schema.exclusiveMinimum))yield`${value} > ${schema.exclusiveMinimum}`;if(IsNumber2(schema.maximum))yield`${value} <= ${schema.maximum}`;if(IsNumber2(schema.minimum))yield`${value} >= ${schema.minimum}`;if(IsNumber2(schema.multipleOf))yield`(${value} % ${schema.multipleOf}) === 0`}function*FromObject19(schema,references,value){if(yield Policy.IsObjectLike(value),IsNumber2(schema.minProperties))yield`Object.getOwnPropertyNames(${value}).length >= ${schema.minProperties}`;if(IsNumber2(schema.maxProperties))yield`Object.getOwnPropertyNames(${value}).length <= ${schema.maxProperties}`;let knownKeys=Object.getOwnPropertyNames(schema.properties);for(let knownKey of knownKeys){let memberExpression=MemberExpression.Encode(value,knownKey),property=schema.properties[knownKey];if(schema.required&&schema.required.includes(knownKey)){if(yield*Visit17(property,references,memberExpression),ExtendsUndefinedCheck(property)||IsAnyOrUnknown2(property))yield`('${knownKey}' in ${value})`}else{let expression=CreateExpression(property,references,memberExpression);yield Policy.IsExactOptionalProperty(value,knownKey,expression)}}if(schema.additionalProperties===!1)if(schema.required&&schema.required.length===knownKeys.length)yield`Object.getOwnPropertyNames(${value}).length === ${knownKeys.length}`;else{let keys=`[${knownKeys.map((key)=>`'${key}'`).join(", ")}]`;yield`Object.getOwnPropertyNames(${value}).every(key => ${keys}.includes(key))`}if(typeof schema.additionalProperties==="object"){let expression=CreateExpression(schema.additionalProperties,references,`${value}[key]`),keys=`[${knownKeys.map((key)=>`'${key}'`).join(", ")}]`;yield`(Object.getOwnPropertyNames(${value}).every(key => ${keys}.includes(key) || ${expression}))`}}function*FromPromise8(schema,references,value){yield`${value} instanceof Promise`}function*FromRecord14(schema,references,value){if(yield Policy.IsRecordLike(value),IsNumber2(schema.minProperties))yield`Object.getOwnPropertyNames(${value}).length >= ${schema.minProperties}`;if(IsNumber2(schema.maxProperties))yield`Object.getOwnPropertyNames(${value}).length <= ${schema.maxProperties}`;let[patternKey,patternSchema]=Object.entries(schema.patternProperties)[0],variable=CreateVariable(`${new RegExp(patternKey)}`),check1=CreateExpression(patternSchema,references,"value"),check2=IsSchema2(schema.additionalProperties)?CreateExpression(schema.additionalProperties,references,value):schema.additionalProperties===!1?"false":"true",expression=`(${variable}.test(key) ? ${check1} : ${check2})`;yield`(Object.entries(${value}).every(([key, value]) => ${expression}))`}function*FromRef15(schema,references,value){let target=Deref(schema,references);if(state.functions.has(schema.$ref))return yield`${CreateFunctionName(schema.$ref)}(${value})`;yield*Visit17(target,references,value)}function*FromRegExp5(schema,references,value){let variable=CreateVariable(`${new RegExp(schema.source,schema.flags)};`);if(yield`(typeof ${value} === 'string')`,IsNumber2(schema.maxLength))yield`${value}.length <= ${schema.maxLength}`;if(IsNumber2(schema.minLength))yield`${value}.length >= ${schema.minLength}`;yield`${variable}.test(${value})`}function*FromString6(schema,references,value){if(yield`(typeof ${value} === 'string')`,IsNumber2(schema.maxLength))yield`${value}.length <= ${schema.maxLength}`;if(IsNumber2(schema.minLength))yield`${value}.length >= ${schema.minLength}`;if(schema.pattern!==void 0)yield`${CreateVariable(`${new RegExp(schema.pattern)};`)}.test(${value})`;if(schema.format!==void 0)yield`format('${schema.format}', ${value})`}function*FromSymbol6(schema,references,value){yield`(typeof ${value} === 'symbol')`}function*FromTemplateLiteral7(schema,references,value){yield`(typeof ${value} === 'string')`,yield`${CreateVariable(`${new RegExp(schema.pattern)};`)}.test(${value})`}function*FromThis11(schema,references,value){yield`${CreateFunctionName(schema.$ref)}(${value})`}function*FromTuple16(schema,references,value){if(yield`Array.isArray(${value})`,schema.items===void 0)return yield`${value}.length === 0`;yield`(${value}.length === ${schema.maxItems})`;for(let i=0;i<schema.items.length;i++)yield`${CreateExpression(schema.items[i],references,`${value}[${i}]`)}`}function*FromUndefined6(schema,references,value){yield`${value} === undefined`}function*FromUnion21(schema,references,value){yield`(${schema.anyOf.map((schema2)=>CreateExpression(schema2,references,value)).join(" || ")})`}function*FromUint8Array5(schema,references,value){if(yield`${value} instanceof Uint8Array`,IsNumber2(schema.maxByteLength))yield`(${value}.length <= ${schema.maxByteLength})`;if(IsNumber2(schema.minByteLength))yield`(${value}.length >= ${schema.minByteLength})`}function*FromUnknown5(schema,references,value){yield"true"}function*FromVoid5(schema,references,value){yield Policy.IsVoidLike(value)}function*FromKind4(schema,references,value){let instance=state.instances.size;state.instances.set(instance,schema),yield`kind('${schema[Kind]}', ${instance}, ${value})`}function*Visit17(schema,references,value,useHoisting=!0){let references_=IsString2(schema.$id)?[...references,schema]:references,schema_=schema;if(useHoisting&&IsString2(schema.$id)){let functionName=CreateFunctionName(schema.$id);if(state.functions.has(functionName))return yield`${functionName}(${value})`;else{state.functions.set(functionName,"<deferred>");let functionCode=CreateFunction(functionName,schema,references,"value",!1);return state.functions.set(functionName,functionCode),yield`${functionName}(${value})`}}switch(schema_[Kind]){case"Any":return yield*FromAny5(schema_,references_,value);case"Argument":return yield*FromArgument5(schema_,references_,value);case"Array":return yield*FromArray18(schema_,references_,value);case"AsyncIterator":return yield*FromAsyncIterator8(schema_,references_,value);case"BigInt":return yield*FromBigInt6(schema_,references_,value);case"Boolean":return yield*FromBoolean6(schema_,references_,value);case"Constructor":return yield*FromConstructor9(schema_,references_,value);case"Date":return yield*FromDate8(schema_,references_,value);case"Function":return yield*FromFunction8(schema_,references_,value);case"Import":return yield*FromImport11(schema_,references_,value);case"Integer":return yield*FromInteger6(schema_,references_,value);case"Intersect":return yield*FromIntersect19(schema_,references_,value);case"Iterator":return yield*FromIterator8(schema_,references_,value);case"Literal":return yield*FromLiteral7(schema_,references_,value);case"Never":return yield*FromNever6(schema_,references_,value);case"Not":return yield*FromNot8(schema_,references_,value);case"Null":return yield*FromNull6(schema_,references_,value);case"Number":return yield*FromNumber6(schema_,references_,value);case"Object":return yield*FromObject19(schema_,references_,value);case"Promise":return yield*FromPromise8(schema_,references_,value);case"Record":return yield*FromRecord14(schema_,references_,value);case"Ref":return yield*FromRef15(schema_,references_,value);case"RegExp":return yield*FromRegExp5(schema_,references_,value);case"String":return yield*FromString6(schema_,references_,value);case"Symbol":return yield*FromSymbol6(schema_,references_,value);case"TemplateLiteral":return yield*FromTemplateLiteral7(schema_,references_,value);case"This":return yield*FromThis11(schema_,references_,value);case"Tuple":return yield*FromTuple16(schema_,references_,value);case"Undefined":return yield*FromUndefined6(schema_,references_,value);case"Union":return yield*FromUnion21(schema_,references_,value);case"Uint8Array":return yield*FromUint8Array5(schema_,references_,value);case"Unknown":return yield*FromUnknown5(schema_,references_,value);case"Void":return yield*FromVoid5(schema_,references_,value);default:if(!exports_type2.Has(schema_[Kind]))throw new TypeCompilerUnknownTypeError(schema);return yield*FromKind4(schema_,references_,value)}}let state={language:"javascript",functions:new Map,variables:new Map,instances:new Map};function CreateExpression(schema,references,value,useHoisting=!0){return`(${[...Visit17(schema,references,value,useHoisting)].join(" && ")})`}function CreateFunctionName($id){return`check_${Identifier.Encode($id)}`}function CreateVariable(expression){let variableName=`local_${state.variables.size}`;return state.variables.set(variableName,`const ${variableName} = ${expression}`),variableName}function CreateFunction(name,schema,references,value,useHoisting=!0){let[newline,pad]=[`
`,(length)=>"".padStart(length," ")],parameter=CreateParameter("value","any"),returns=CreateReturns("boolean"),expression=[...Visit17(schema,references,value,useHoisting)].map((expression2)=>`${pad(4)}${expression2}`).join(` &&${newline}`);return`function ${name}(${parameter})${returns} {${newline}${pad(2)}return (${newline}${expression}${newline}${pad(2)})
}`}function CreateParameter(name,type){let annotation=state.language==="typescript"?`: ${type}`:"";return`${name}${annotation}`}function CreateReturns(type){return state.language==="typescript"?`: ${type}`:""}function Build(schema,references,options){let functionCode=CreateFunction("check",schema,references,"value"),parameter=CreateParameter("value","any"),returns=CreateReturns("boolean"),functions=[...state.functions.values()],variables=[...state.variables.values()],checkFunction=IsString2(schema.$id)?`return function check(${parameter})${returns} {
  return ${CreateFunctionName(schema.$id)}(value)
}`:`return ${functionCode}`;return[...variables,...functions,checkFunction].join(`
`)}function Code(...args){let defaults={language:"javascript"},[schema,references,options]=args.length===2&&IsArray2(args[1])?[args[0],args[1],defaults]:args.length===2&&!IsArray2(args[1])?[args[0],[],args[1]]:args.length===3?[args[0],args[1],args[2]]:args.length===1?[args[0],[],defaults]:[null,[],defaults];if(state.language=options.language,state.variables.clear(),state.functions.clear(),state.instances.clear(),!IsSchema2(schema))throw new TypeCompilerTypeGuardError(schema);for(let schema2 of references)if(!IsSchema2(schema2))throw new TypeCompilerTypeGuardError(schema2);return Build(schema,references,options)}TypeCompiler2.Code=Code;function Compile(schema,references=[]){let generatedCode=Code(schema,references,{language:"javascript"}),compiledFunction=globalThis.Function("kind","format","hash",generatedCode),instances=new Map(state.instances);function typeRegistryFunction(kind,instance,value){if(!exports_type2.Has(kind)||!instances.has(instance))return!1;let checkFunc=exports_type2.Get(kind),schema2=instances.get(instance);return checkFunc(schema2,value)}function formatRegistryFunction(format,value){if(!exports_format.Has(format))return!1;return exports_format.Get(format)(value)}function hashFunction(value){return Hash(value)}let checkFunction=compiledFunction(typeRegistryFunction,formatRegistryFunction,hashFunction);return new TypeCheck(schema,references,checkFunction,generatedCode)}TypeCompiler2.Compile=Compile})(TypeCompiler||(TypeCompiler={}));var __create2=Object.create,{getPrototypeOf:__getProtoOf2,defineProperty:__defProp2,getOwnPropertyNames:__getOwnPropNames2}=Object,__hasOwnProp2=Object.prototype.hasOwnProperty,__toESM2=(mod,isNodeMode,target)=>{target=mod!=null?__create2(__getProtoOf2(mod)):{};let to=isNodeMode||!mod||!mod.__esModule?__defProp2(target,"default",{value:mod,enumerable:!0}):target;for(let key of __getOwnPropNames2(mod))if(!__hasOwnProp2.call(to,key))__defProp2(to,key,{get:()=>mod[key],enumerable:!0});return to},__commonJS2=(cb,mod)=>()=>(mod||cb((mod={exports:{}}).exports,mod),mod.exports);var require_fast_decode_uri_component=__commonJS2((exports,module)=>{var UTF8_ACCEPT=12,UTF8_REJECT=0,UTF8_DATA=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,7,7,7,7,7,7,7,7,7,7,7,7,8,7,7,10,9,9,9,11,4,4,4,4,4,4,4,4,4,4,4,0,0,0,0,0,0,0,0,0,0,0,0,12,0,0,0,0,24,36,48,60,72,84,96,0,12,12,12,0,0,0,0,0,0,0,0,0,0,0,24,0,0,0,0,0,0,0,0,0,24,24,24,0,0,0,0,0,0,0,0,0,24,24,0,0,0,0,0,0,0,0,0,0,48,48,48,0,0,0,0,0,0,0,0,0,0,48,48,0,0,0,0,0,0,0,0,0,48,0,0,0,0,0,0,0,0,0,0,127,63,63,63,0,31,15,15,15,7,7,7];function decodeURIComponent2(uri){var percentPosition=uri.indexOf("%");if(percentPosition===-1)return uri;var length=uri.length,decoded="",last=0,codepoint=0,startOfOctets=percentPosition,state=UTF8_ACCEPT;while(percentPosition>-1&&percentPosition<length){var high=hexCodeToInt(uri[percentPosition+1],4),low=hexCodeToInt(uri[percentPosition+2],0),byte=high|low,type=UTF8_DATA[byte];if(state=UTF8_DATA[256+state+type],codepoint=codepoint<<6|byte&UTF8_DATA[364+type],state===UTF8_ACCEPT)decoded+=uri.slice(last,startOfOctets),decoded+=codepoint<=65535?String.fromCharCode(codepoint):String.fromCharCode(55232+(codepoint>>10),56320+(codepoint&1023)),codepoint=0,last=percentPosition+3,percentPosition=startOfOctets=uri.indexOf("%",last);else if(state===UTF8_REJECT)return null;else{if(percentPosition+=3,percentPosition<length&&uri.charCodeAt(percentPosition)===37)continue;return null}}return decoded+uri.slice(last)}var HEX={"0":0,"1":1,"2":2,"3":3,"4":4,"5":5,"6":6,"7":7,"8":8,"9":9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15};function hexCodeToInt(c,shift){var i=HEX[c];return i===void 0?255:i<<shift}module.exports=decodeURIComponent2}),require_dist=__commonJS2((exports)=>{Object.defineProperty(exports,"__esModule",{value:!0}),exports.parseCookie=parseCookie,exports.parse=parseCookie,exports.stringifyCookie=stringifyCookie,exports.stringifySetCookie=stringifySetCookie,exports.serialize=stringifySetCookie,exports.parseSetCookie=parseSetCookie,exports.stringifySetCookie=stringifySetCookie,exports.serialize=stringifySetCookie;var cookieNameRegExp=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,cookieValueRegExp=/^[\u0021-\u003A\u003C-\u007E]*$/,domainValueRegExp=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,pathValueRegExp=/^[\u0020-\u003A\u003D-\u007E]*$/,maxAgeRegExp=/^-?\d+$/,__toString=Object.prototype.toString,NullObject=(()=>{let C=function(){};return C.prototype=Object.create(null),C})();function parseCookie(str,options){let obj=new NullObject,len=str.length;if(len<2)return obj;let dec=options?.decode||decode2,index=0;do{let eqIdx=eqIndex(str,index,len);if(eqIdx===-1)break;let endIdx=endIndex(str,index,len);if(eqIdx>endIdx){index=str.lastIndexOf(";",eqIdx-1)+1;continue}let key=valueSlice(str,index,eqIdx);if(obj[key]===void 0)obj[key]=dec(valueSlice(str,eqIdx+1,endIdx));index=endIdx+1}while(index<len);return obj}function stringifyCookie(cookie,options){let enc=options?.encode||encodeURIComponent,cookieStrings=[];for(let name of Object.keys(cookie)){let val=cookie[name];if(val===void 0)continue;if(!cookieNameRegExp.test(name))throw TypeError(`cookie name is invalid: ${name}`);let value=enc(val);if(!cookieValueRegExp.test(value))throw TypeError(`cookie val is invalid: ${val}`);cookieStrings.push(`${name}=${value}`)}return cookieStrings.join("; ")}function stringifySetCookie(_name,_val,_opts){let cookie=typeof _name==="object"?_name:{..._opts,name:_name,value:String(_val)},enc=(typeof _val==="object"?_val:_opts)?.encode||encodeURIComponent;if(!cookieNameRegExp.test(cookie.name))throw TypeError(`argument name is invalid: ${cookie.name}`);let value=cookie.value?enc(cookie.value):"";if(!cookieValueRegExp.test(value))throw TypeError(`argument val is invalid: ${cookie.value}`);let str=cookie.name+"="+value;if(cookie.maxAge!==void 0){if(!Number.isInteger(cookie.maxAge))throw TypeError(`option maxAge is invalid: ${cookie.maxAge}`);str+="; Max-Age="+cookie.maxAge}if(cookie.domain){if(!domainValueRegExp.test(cookie.domain))throw TypeError(`option domain is invalid: ${cookie.domain}`);str+="; Domain="+cookie.domain}if(cookie.path){if(!pathValueRegExp.test(cookie.path))throw TypeError(`option path is invalid: ${cookie.path}`);str+="; Path="+cookie.path}if(cookie.expires){if(!isDate(cookie.expires)||!Number.isFinite(cookie.expires.valueOf()))throw TypeError(`option expires is invalid: ${cookie.expires}`);str+="; Expires="+cookie.expires.toUTCString()}if(cookie.httpOnly)str+="; HttpOnly";if(cookie.secure)str+="; Secure";if(cookie.partitioned)str+="; Partitioned";if(cookie.priority)switch(typeof cookie.priority==="string"?cookie.priority.toLowerCase():void 0){case"low":str+="; Priority=Low";break;case"medium":str+="; Priority=Medium";break;case"high":str+="; Priority=High";break;default:throw TypeError(`option priority is invalid: ${cookie.priority}`)}if(cookie.sameSite)switch(typeof cookie.sameSite==="string"?cookie.sameSite.toLowerCase():cookie.sameSite){case!0:case"strict":str+="; SameSite=Strict";break;case"lax":str+="; SameSite=Lax";break;case"none":str+="; SameSite=None";break;default:throw TypeError(`option sameSite is invalid: ${cookie.sameSite}`)}return str}function parseSetCookie(str,options){let dec=options?.decode||decode2,len=str.length,endIdx=endIndex(str,0,len),eqIdx=eqIndex(str,0,endIdx),setCookie=eqIdx===-1?{name:"",value:dec(valueSlice(str,0,endIdx))}:{name:valueSlice(str,0,eqIdx),value:dec(valueSlice(str,eqIdx+1,endIdx))},index=endIdx+1;while(index<len){let endIdx2=endIndex(str,index,len),eqIdx2=eqIndex(str,index,endIdx2),attr=eqIdx2===-1?valueSlice(str,index,endIdx2):valueSlice(str,index,eqIdx2),val=eqIdx2===-1?void 0:valueSlice(str,eqIdx2+1,endIdx2);switch(attr.toLowerCase()){case"httponly":setCookie.httpOnly=!0;break;case"secure":setCookie.secure=!0;break;case"partitioned":setCookie.partitioned=!0;break;case"domain":setCookie.domain=val;break;case"path":setCookie.path=val;break;case"max-age":if(val&&maxAgeRegExp.test(val))setCookie.maxAge=Number(val);break;case"expires":if(!val)break;let date2=new Date(val);if(Number.isFinite(date2.valueOf()))setCookie.expires=date2;break;case"priority":if(!val)break;let priority=val.toLowerCase();if(priority==="low"||priority==="medium"||priority==="high")setCookie.priority=priority;break;case"samesite":if(!val)break;let sameSite=val.toLowerCase();if(sameSite==="lax"||sameSite==="strict"||sameSite==="none")setCookie.sameSite=sameSite;break}index=endIdx2+1}return setCookie}function endIndex(str,min,len){let index=str.indexOf(";",min);return index===-1?len:index}function eqIndex(str,min,max){let index=str.indexOf("=",min);return index<max?index:-1}function valueSlice(str,min,max){let start=min,end=max;do{let code=str.charCodeAt(start);if(code!==32&&code!==9)break}while(++start<end);while(end>start){let code=str.charCodeAt(end-1);if(code!==32&&code!==9)break;end--}return str.slice(start,end)}function decode2(str){if(str.indexOf("%")===-1)return str;try{return decodeURIComponent(str)}catch(e){return str}}function isDate(val){return __toString.call(val)==="[object Date]"}}),Y=(v,b)=>{let A=b?.length?{}:null;if(A)for(let Q of b)A[Q.part.charCodeAt(0)]=Q;return{part:v,store:null,inert:A,params:null,wildcardStore:null}},k=(v,b)=>({...v,part:b}),T=(v)=>({name:v,store:null,inert:null});class _{config;root={};history=[];deferred=[];constructor(v={}){if(this.config=v,v.lazy)this.find=this.lazyFind;if(v.onParam&&!Array.isArray(v.onParam))this.config.onParam=[this.config.onParam]}static regex={static:/:.+?(?=\/|$)/,params:/:.+?(?=\/|$)/g,optionalParams:/(\/:\w+\?)/g};lazyFind=(v,b)=>{if(!this.config.lazy)return this.find;return this.build(),this.find(v,b)};build(){if(!this.config.lazy)return;for(let[v,b,A]of this.deferred)this.add(v,b,A,{lazy:!1,ignoreHistory:!0});this.deferred=[],this.find=(v,b)=>{let A=this.root[v];if(!A)return null;return $(b,b.length,A,0,this.config.onParam)}}add(v,b,A,{ignoreError:Q=!1,ignoreHistory:O=!1,lazy:V=this.config.lazy}={}){if(V)return this.find=this.lazyFind,this.deferred.push([v,b,A]),A;if(typeof b!=="string")throw TypeError("Route path must be a string");if(b==="")b="/";else if(b[0]!=="/")b=`/${b}`;let X=b[b.length-1]==="*",J=b.match(_.regex.optionalParams);if(J){let F=b.replaceAll("?","");this.add(v,F,A,{ignoreError:Q,ignoreHistory:O,lazy:V});for(let B=0;B<J.length;B++){let D=b.replace(J[B],"");this.add(v,D,A,{ignoreError:!0,ignoreHistory:O,lazy:V})}return A}if(J)b=b.replaceAll("?","");if(this.history.find(([F,B,D])=>F===v&&B===b))return A;if(X||J&&b.charCodeAt(b.length-1)===63)b=b.slice(0,-1);if(!O)this.history.push([v,b,A]);let K=b.split(_.regex.static),G=b.match(_.regex.params)||[];if(K[K.length-1]==="")K.pop();let q;if(!this.root[v])q=this.root[v]=Y("/");else q=this.root[v];let U=0;for(let F=0;F<K.length;++F){let B=K[F];if(F>0){let D=G[U++].slice(1);if(q.params===null)q.params=T(D);else if(q.params.name!==D)if(Q)return A;else throw Error(`Cannot create route "${b}" with parameter "${D}" because a route already exists with a different parameter name ("${q.params.name}") in the same location`);let S=q.params;if(S.inert===null){q=S.inert=Y(B);continue}q=S.inert}for(let D=0;;){if(D===B.length){if(D<q.part.length){let S=k(q,q.part.slice(D));Object.assign(q,Y(B,[S]))}break}if(D===q.part.length){if(q.inert===null)q.inert={};let S=q.inert[B.charCodeAt(D)];if(S){q=S,B=B.slice(D),D=0;continue}let Z=Y(B.slice(D));q.inert[B.charCodeAt(D)]=Z,q=Z;break}if(B[D]!==q.part[D]){let S=k(q,q.part.slice(D)),Z=Y(B.slice(D));Object.assign(q,Y(q.part.slice(0,D),[S,Z])),q=Z;break}++D}}if(U<G.length){let B=G[U].slice(1);if(q.params===null)q.params=T(B);else if(q.params.name!==B)if(Q)return A;else throw Error(`Cannot create route "${b}" with parameter "${B}" because a route already exists with a different parameter name ("${q.params.name}") in the same location`);if(q.params.store===null)q.params.store=A;return q.params.store}if(X){if(q.wildcardStore===null)q.wildcardStore=A;return q.wildcardStore}if(q.store===null)q.store=A;return q.store}find(v,b){let A=this.root[v];if(!A)return null;return $(b,b.length,A,0,this.config.onParam)}}var $=(v,b,A,Q,O)=>{let V=A.part,X=V.length,J=Q+X;if(X>1){if(J>b)return null;if(X<15){for(let K=1,G=Q+1;K<X;++K,++G)if(V.charCodeAt(K)!==v.charCodeAt(G))return null}else if(v.slice(Q,J)!==V)return null}if(J===b){if(A.store!==null)return{store:A.store,params:{}};if(A.wildcardStore!==null)return{store:A.wildcardStore,params:{"*":""}};return null}if(A.inert!==null){let K=A.inert[v.charCodeAt(J)];if(K!==void 0){let G=$(v,b,K,J,O);if(G!==null)return G}}if(A.params!==null){let{store:K,name:G,inert:q}=A.params,U=v.indexOf("/",J);if(U!==J){if(U===-1||U>=b){if(K!==null){let F={};if(F[G]=v.substring(J,b),O)for(let B=0;B<O.length;B++){let D=O[B](F[G],G);if(D!==void 0)F[G]=D}return{store:K,params:F}}}else if(q!==null){let F=$(v,b,q,U,O);if(F!==null){if(F.params[G]=v.substring(J,U),O)for(let B=0;B<O.length;B++){let D=O[B](F.params[G],G);if(D!==void 0)F.params[G]=D}return F}}}}if(A.wildcardStore!==null)return{store:A.wildcardStore,params:{"*":v.substring(J,b)}};return null},import_fast_decode_uri_component4=__toESM2(require_fast_decode_uri_component(),1),isBun=typeof Bun<"u",mime={aac:"audio/aac",abw:"application/x-abiword",ai:"application/postscript",arc:"application/octet-stream",avi:"video/x-msvideo",azw:"application/vnd.amazon.ebook",bin:"application/octet-stream",bz:"application/x-bzip",bz2:"application/x-bzip2",csh:"application/x-csh",css:"text/css",csv:"text/csv",doc:"application/msword",dll:"application/octet-stream",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gif:"image/gif",htm:"text/html",html:"text/html",ico:"image/x-icon",ics:"text/calendar",jar:"application/java-archive",jpeg:"image/jpeg",jpg:"image/jpeg",js:"application/javascript",json:"application/json",mid:"audio/midi",midi:"audio/midi",mp2:"audio/mpeg",mp3:"audio/mpeg",mp4:"video/mp4",mpa:"video/mpeg",mpe:"video/mpeg",mpeg:"video/mpeg",mpkg:"application/vnd.apple.installer+xml",odp:"application/vnd.oasis.opendocument.presentation",ods:"application/vnd.oasis.opendocument.spreadsheet",odt:"application/vnd.oasis.opendocument.text",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",otf:"font/otf",png:"image/png",pdf:"application/pdf",ppt:"application/vnd.ms-powerpoint",rar:"application/x-rar-compressed",rtf:"application/rtf",sh:"application/x-sh",svg:"image/svg+xml",swf:"application/x-shockwave-flash",tar:"application/x-tar",tif:"image/tiff",tiff:"image/tiff",ts:"application/typescript",ttf:"font/ttf",txt:"text/plain",vsd:"application/vnd.visio",wav:"audio/x-wav",weba:"audio/webm",webm:"video/webm",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xlsx:"application/vnd.ms-excel",xlsx_OLD:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xml:"application/xml",xul:"application/vnd.mozilla.xul+xml",zip:"application/zip","3gp":"video/3gpp","3gp_DOES_NOT_CONTAIN_VIDEO":"audio/3gpp","3gp2":"video/3gpp2","3gp2_DOES_NOT_CONTAIN_VIDEO":"audio/3gpp2","7z":"application/x-7z-compressed"},getFileExtension=(path)=>{let index=path.lastIndexOf(".");if(index===-1)return"";return path.slice(index+1)};var createReadStream,stat;class ElysiaFile{path;value;stats;constructor(path){if(this.path=path,isBun)this.value=Bun.file(path);else{if(!createReadStream||!stat){if(typeof window<"u"){console.warn("Browser environment does not support file");return}let warnMissing=(name)=>console.warn(Error(`[elysia] \`file\` require \`fs${name?"."+name:""}\` ${name?.includes(".")?"module ":""}which is not available in this environment`));if(typeof process>"u"||typeof process.getBuiltinModule!=="function"){warnMissing();return}let fs=process.getBuiltinModule("fs");if(!fs){warnMissing();return}if(typeof fs.createReadStream!=="function"){warnMissing();return}if(typeof fs.promises?.stat!=="function"){warnMissing();return}createReadStream=fs.createReadStream,stat=fs.promises.stat}this.value=(()=>createReadStream(path))(),this.stats=stat(path)}}get type(){return mime[getFileExtension(this.path)]||"application/octet-stream"}get length(){if(isBun)return this.value.size;return this.stats?.then((x)=>x.size)??0}}var hasHeaderShorthand="toJSON"in new Headers,replaceUrlPath=(url,pathname)=>{let urlObject=new URL(url);return urlObject.pathname=pathname,urlObject.toString()},isClass=(v)=>typeof v==="function"&&/^\s*class\s+/.test(v.toString())||v.toString&&v.toString().startsWith("[object ")&&v.toString()!=="[object Object]"||isNotEmpty(Object.getPrototypeOf(v)),isObject=(item)=>item&&typeof item==="object"&&!Array.isArray(item),mergeDeep=(target,source,options)=>{let skipKeys=options?.skipKeys,override=options?.override??!0,mergeArray=options?.mergeArray??!1,seen=options?.seen??new WeakSet;if(!isObject(target)||!isObject(source))return target;if(seen.has(source))return target;seen.add(source);for(let[key,value]of Object.entries(source)){if(skipKeys?.includes(key)||["__proto__","constructor","prototype"].includes(key))continue;if(mergeArray&&Array.isArray(value)){target[key]=Array.isArray(target[key])?[...target[key],...value]:target[key]=value;continue}if(!isObject(value)||!(key in target)||isClass(value)){if((override||!(key in target))&&!Object.isFrozen(target))try{target[key]=value}catch{}continue}if(!Object.isFrozen(target[key]))try{target[key]=mergeDeep(target[key],value,{skipKeys,override,mergeArray,seen})}catch{}}return seen.delete(source),target},mergeCookie=(a,b)=>{let v=mergeDeep(Object.assign({},a),b,{skipKeys:["properties"],mergeArray:!1});if(v.properties)delete v.properties;return v},mergeObjectArray=(a,b)=>{if(!b)return a;let array=[],checksums=[];if(a){if(!Array.isArray(a))a=[a];for(let item of a)if(array.push(item),item.checksum)checksums.push(item.checksum)}if(b){if(!Array.isArray(b))b=[b];for(let item of b)if(!checksums.includes(item.checksum))array.push(item)}return array},primitiveHooks=["start","request","parse","transform","resolve","beforeHandle","afterHandle","mapResponse","afterResponse","trace","error","stop","body","headers","params","query","response","type","detail"],primitiveHookMap=primitiveHooks.reduce((acc,x)=>(acc[x]=!0,acc),{}),isRecordNumber=(x)=>typeof x==="object"&&Object.keys(x).every((x2)=>!isNaN(+x2)),mergeResponse=(a,b)=>{if(isRecordNumber(a)&&isRecordNumber(b))return Object.assign({},a,b);else if(a&&!isRecordNumber(a)&&isRecordNumber(b))return Object.assign({200:a},b);return b??a},mergeSchemaValidator=(a,b)=>{if(!a&&!b)return{body:void 0,headers:void 0,params:void 0,query:void 0,cookie:void 0,response:void 0};return{body:b?.body??a?.body,headers:b?.headers??a?.headers,params:b?.params??a?.params,query:b?.query??a?.query,cookie:b?.cookie??a?.cookie,response:mergeResponse(a?.response,b?.response)}},mergeHook=(a,b)=>{if(!b)return a??{};if(!a)return b??{};if(!Object.values(b).find((x)=>x!==void 0&&x!==null))return{...a};let hook={...a,...b,body:b.body??a.body,headers:b.headers??a.headers,params:b.params??a.params,query:b.query??a.query,cookie:b.cookie??a.cookie,response:mergeResponse(a.response,b.response),type:a.type||b.type,detail:mergeDeep(b.detail??{},a.detail??{}),parse:mergeObjectArray(a.parse,b.parse),transform:mergeObjectArray(a.transform,b.transform),beforeHandle:mergeObjectArray(mergeObjectArray(fnToContainer(a.resolve,"resolve"),a.beforeHandle),mergeObjectArray(fnToContainer(b.resolve,"resolve"),b.beforeHandle)),afterHandle:mergeObjectArray(a.afterHandle,b.afterHandle),mapResponse:mergeObjectArray(a.mapResponse,b.mapResponse),afterResponse:mergeObjectArray(a.afterResponse,b.afterResponse),trace:mergeObjectArray(a.trace,b.trace),error:mergeObjectArray(a.error,b.error),standaloneSchema:a.standaloneSchema||b.standaloneSchema?a.standaloneSchema&&!b.standaloneSchema?a.standaloneSchema:b.standaloneSchema&&!a.standaloneSchema?b.standaloneSchema:[...a.standaloneSchema??[],...b.standaloneSchema??[]]:void 0};if(hook.resolve)delete hook.resolve;return hook},lifeCycleToArray=(a)=>{if(a.parse&&!Array.isArray(a.parse))a.parse=[a.parse];if(a.transform&&!Array.isArray(a.transform))a.transform=[a.transform];if(a.afterHandle&&!Array.isArray(a.afterHandle))a.afterHandle=[a.afterHandle];if(a.mapResponse&&!Array.isArray(a.mapResponse))a.mapResponse=[a.mapResponse];if(a.afterResponse&&!Array.isArray(a.afterResponse))a.afterResponse=[a.afterResponse];if(a.trace&&!Array.isArray(a.trace))a.trace=[a.trace];if(a.error&&!Array.isArray(a.error))a.error=[a.error];let beforeHandle=[];if(a.resolve)beforeHandle=fnToContainer(Array.isArray(a.resolve)?a.resolve:[a.resolve],"resolve"),delete a.resolve;if(a.beforeHandle)if(beforeHandle.length)beforeHandle=beforeHandle.concat(Array.isArray(a.beforeHandle)?a.beforeHandle:[a.beforeHandle]);else beforeHandle=Array.isArray(a.beforeHandle)?a.beforeHandle:[a.beforeHandle];if(beforeHandle.length)a.beforeHandle=beforeHandle;return a},isBun2=typeof Bun<"u",hasBunHash=isBun2&&typeof Bun.hash==="function",hasSetImmediate=typeof setImmediate==="function",checksum=(s)=>{let h=9;for(let i=0;i<s.length;)h=Math.imul(h^s.charCodeAt(i++),387420489);return h=h^h>>>9},injectChecksum=(checksum2,x)=>{if(!x)return;if(!Array.isArray(x)){let fn=x;if(checksum2&&!fn.checksum)fn.checksum=checksum2;if(fn.scope==="scoped")fn.scope="local";return fn}let fns=[...x];for(let fn of fns){if(checksum2&&!fn.checksum)fn.checksum=checksum2;if(fn.scope==="scoped")fn.scope="local"}return fns},mergeLifeCycle=(a,b,checksum2)=>{return{start:mergeObjectArray(a.start,injectChecksum(checksum2,b?.start)),request:mergeObjectArray(a.request,injectChecksum(checksum2,b?.request)),parse:mergeObjectArray(a.parse,injectChecksum(checksum2,b?.parse)),transform:mergeObjectArray(a.transform,injectChecksum(checksum2,b?.transform)),beforeHandle:mergeObjectArray(mergeObjectArray(fnToContainer(a.resolve,"resolve"),a.beforeHandle),injectChecksum(checksum2,mergeObjectArray(fnToContainer(b?.resolve,"resolve"),b?.beforeHandle))),afterHandle:mergeObjectArray(a.afterHandle,injectChecksum(checksum2,b?.afterHandle)),mapResponse:mergeObjectArray(a.mapResponse,injectChecksum(checksum2,b?.mapResponse)),afterResponse:mergeObjectArray(a.afterResponse,injectChecksum(checksum2,b?.afterResponse)),trace:mergeObjectArray(a.trace,injectChecksum(checksum2,b?.trace)),error:mergeObjectArray(a.error,injectChecksum(checksum2,b?.error)),stop:mergeObjectArray(a.stop,injectChecksum(checksum2,b?.stop))}},asHookType=(fn,inject,{skipIfHasType=!1})=>{if(!fn)return fn;if(!Array.isArray(fn)){if(skipIfHasType)fn.scope??=inject;else fn.scope=inject;return fn}for(let x of fn)if(skipIfHasType)x.scope??=inject;else x.scope=inject;return fn},filterGlobal=(fn)=>{if(!fn)return fn;if(!Array.isArray(fn))switch(fn.scope){case"global":case"scoped":return{...fn};default:return{fn}}let array=[];for(let x of fn)switch(x.scope){case"global":case"scoped":array.push({...x});break}return array},filterGlobalHook=(hook)=>{return{...hook,type:hook?.type,detail:hook?.detail,parse:filterGlobal(hook?.parse),transform:filterGlobal(hook?.transform),beforeHandle:filterGlobal(hook?.beforeHandle),afterHandle:filterGlobal(hook?.afterHandle),mapResponse:filterGlobal(hook?.mapResponse),afterResponse:filterGlobal(hook?.afterResponse),error:filterGlobal(hook?.error),trace:filterGlobal(hook?.trace)}},StatusMap={Continue:100,"Switching Protocols":101,Processing:102,"Early Hints":103,OK:200,Created:201,Accepted:202,"Non-Authoritative Information":203,"No Content":204,"Reset Content":205,"Partial Content":206,"Multi-Status":207,"Already Reported":208,"Multiple Choices":300,"Moved Permanently":301,Found:302,"See Other":303,"Not Modified":304,"Temporary Redirect":307,"Permanent Redirect":308,"Bad Request":400,Unauthorized:401,"Payment Required":402,Forbidden:403,"Not Found":404,"Method Not Allowed":405,"Not Acceptable":406,"Proxy Authentication Required":407,"Request Timeout":408,Conflict:409,Gone:410,"Length Required":411,"Precondition Failed":412,"Payload Too Large":413,"URI Too Long":414,"Unsupported Media Type":415,"Range Not Satisfiable":416,"Expectation Failed":417,"I'm a teapot":418,"Enhance Your Calm":420,"Misdirected Request":421,"Unprocessable Content":422,Locked:423,"Failed Dependency":424,"Too Early":425,"Upgrade Required":426,"Precondition Required":428,"Too Many Requests":429,"Request Header Fields Too Large":431,"Unavailable For Legal Reasons":451,"Internal Server Error":500,"Not Implemented":501,"Bad Gateway":502,"Service Unavailable":503,"Gateway Timeout":504,"HTTP Version Not Supported":505,"Variant Also Negotiates":506,"Insufficient Storage":507,"Loop Detected":508,"Not Extended":510,"Network Authentication Required":511},InvertedStatusMap=Object.fromEntries(Object.entries(StatusMap).map(([k2,v])=>[v,k2]));function removeTrailingEquals(digest){let trimmedDigest=digest;while(trimmedDigest.endsWith("="))trimmedDigest=trimmedDigest.slice(0,-1);return trimmedDigest}var encoder=new TextEncoder,signCookie=async(val,secret)=>{if(typeof val==="object")val=JSON.stringify(val);else if(typeof val!=="string")val=val+"";if(secret===null)throw TypeError("Secret key must be provided.");let secretKey=await crypto.subtle.importKey("raw",encoder.encode(secret),{name:"HMAC",hash:"SHA-256"},!1,["sign"]),hmacBuffer=await crypto.subtle.sign("HMAC",secretKey,encoder.encode(val));return val+"."+removeTrailingEquals(Buffer.from(hmacBuffer).toString("base64"))},unsignCookie=async(input,secret)=>{if(typeof input!=="string")throw TypeError("Signed cookie string must be provided.");if(secret===null)throw TypeError("Secret key must be provided.");let tentativeValue=input.slice(0,input.lastIndexOf("."));return await signCookie(tentativeValue,secret)===input?tentativeValue:!1},insertStandaloneValidator=(hook,name,value)=>{if(!hook.standaloneValidator?.length||!Array.isArray(hook.standaloneValidator)){hook.standaloneValidator=[{[name]:value}];return}let last=hook.standaloneValidator[hook.standaloneValidator.length-1];if(name in last)hook.standaloneValidator.push({[name]:value});else last[name]=value},parseNumericString=(message)=>{if(typeof message==="number")return message;if(message.length<16){if(message.trim().length===0)return null;let length=Number(message);if(Number.isNaN(length))return null;return length}if(message.length===16){if(message.trim().length===0)return null;let number=Number(message);if(Number.isNaN(number)||number.toString()!==message)return null;return number}return null},isNumericString=(message)=>parseNumericString(message)!==null;class PromiseGroup{onError;onFinally;root=null;promises=[];constructor(onError=console.error,onFinally=()=>{}){this.onError=onError,this.onFinally=onFinally}get size(){return this.promises.length}add(promise){if(this.promises.push(promise),this.root||=this.drain(),this.promises.length===1)this.then(this.onFinally);return promise}async drain(){while(this.promises.length>0){try{await this.promises[0]}catch(error){this.onError(error)}this.promises.shift()}this.root=null}then(onfulfilled,onrejected){return(this.root??Promise.resolve()).then(onfulfilled,onrejected)}}var fnToContainer=(fn,subType)=>{if(!fn)return fn;if(!Array.isArray(fn)){if(typeof fn==="function"||typeof fn==="string")return subType?{fn,subType}:{fn};else if("fn"in fn)return fn}let fns=[];for(let x of fn)if(typeof x==="function"||typeof x==="string")fns.push(subType?{fn:x,subType}:{fn:x});else if("fn"in x)fns.push(x);return fns},localHookToLifeCycleStore=(a)=>{if(a.start)a.start=fnToContainer(a.start);if(a.request)a.request=fnToContainer(a.request);if(a.parse)a.parse=fnToContainer(a.parse);if(a.transform)a.transform=fnToContainer(a.transform);if(a.beforeHandle)a.beforeHandle=fnToContainer(a.beforeHandle);if(a.afterHandle)a.afterHandle=fnToContainer(a.afterHandle);if(a.mapResponse)a.mapResponse=fnToContainer(a.mapResponse);if(a.afterResponse)a.afterResponse=fnToContainer(a.afterResponse);if(a.trace)a.trace=fnToContainer(a.trace);if(a.error)a.error=fnToContainer(a.error);if(a.stop)a.stop=fnToContainer(a.stop);return a},lifeCycleToFn=(a)=>{let lifecycle=Object.create(null);if(a.start?.map)lifecycle.start=a.start.map((x)=>x.fn);if(a.request?.map)lifecycle.request=a.request.map((x)=>x.fn);if(a.parse?.map)lifecycle.parse=a.parse.map((x)=>x.fn);if(a.transform?.map)lifecycle.transform=a.transform.map((x)=>x.fn);if(a.beforeHandle?.map)lifecycle.beforeHandle=a.beforeHandle.map((x)=>x.fn);if(a.afterHandle?.map)lifecycle.afterHandle=a.afterHandle.map((x)=>x.fn);if(a.mapResponse?.map)lifecycle.mapResponse=a.mapResponse.map((x)=>x.fn);if(a.afterResponse?.map)lifecycle.afterResponse=a.afterResponse.map((x)=>x.fn);if(a.error?.map)lifecycle.error=a.error.map((x)=>x.fn);if(a.stop?.map)lifecycle.stop=a.stop.map((x)=>x.fn);if(a.trace?.map)lifecycle.trace=a.trace.map((x)=>x.fn);else lifecycle.trace=[];return lifecycle},cloneInference=(inference)=>({body:inference.body,cookie:inference.cookie,headers:inference.headers,query:inference.query,set:inference.set,server:inference.server,path:inference.path,route:inference.route,url:inference.url}),redirect=(url,status=302)=>Response.redirect(url,status),ELYSIA_FORM_DATA=Symbol("ElysiaFormData"),ELYSIA_REQUEST_ID=Symbol("ElysiaRequestId"),form=(items)=>{let formData=new FormData;if(formData[ELYSIA_FORM_DATA]={},items)for(let[key,value]of Object.entries(items)){if(Array.isArray(value)){formData[ELYSIA_FORM_DATA][key]=[];for(let v of value){if(value instanceof File)formData.append(key,value,value.name);else if(value instanceof ElysiaFile)formData.append(key,value.value,value.value?.name);else formData.append(key,value);formData[ELYSIA_FORM_DATA][key].push(value)}continue}if(value instanceof File)formData.append(key,value,value.name);else if(value instanceof ElysiaFile)formData.append(key,value.value,value.value?.name);else formData.append(key,value);formData[ELYSIA_FORM_DATA][key]=value}return formData},randomId=typeof crypto>"u"?()=>{let result="",characters="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",charactersLength=characters.length;for(let i=0;i<16;i++)result+=characters.charAt(Math.floor(Math.random()*charactersLength));return result}:()=>{let uuid=crypto.randomUUID();return uuid.slice(0,8)+uuid.slice(24,32)},deduplicateChecksum=(array)=>{if(!array.length)return[];let hashes=[];for(let i=0;i<array.length;i++){let item=array[i];if(item.checksum){if(hashes.includes(item.checksum))array.splice(i,1),i--;hashes.push(item.checksum)}}return array},promoteEvent=(events,as="scoped")=>{if(!events)return;if(as==="scoped"){for(let event of events)if("scope"in event&&event.scope==="local")event.scope="scoped";return}for(let event of events)if("scope"in event)event.scope="global"},getLoosePath=(path)=>{if(path.charCodeAt(path.length-1)===47)return path.slice(0,path.length-1);return path+"/"},isNotEmpty=(obj)=>{if(!obj)return!1;for(let _2 in obj)return!0;return!1},encodePath=(path,{dynamic=!1}={})=>{let encoded=encodeURIComponent(path).replace(/%2F/g,"/");if(dynamic)encoded=encoded.replace(/%3A/g,":").replace(/%3F/g,"?");return encoded},supportPerMethodInlineHandler=(()=>{if(typeof Bun>"u")return!0;if(Bun.semver?.satisfies?.(Bun.version,">=1.2.14"))return!0;return!1})();async function getResponseLength(response){if(response.bodyUsed||!response.body)return 0;let length=0,reader=response.body.getReader();while(!0){let{done,value}=await reader.read();if(done)break;length+=value.byteLength}return length}var emptySchema={headers:!0,cookie:!0,query:!0,params:!0,body:!0,response:!0},env=typeof Bun<"u"?Bun.env:typeof process<"u"?process?.env:void 0,ERROR_CODE=Symbol("ElysiaErrorCode"),isProduction=(env?.NODE_ENV??env?.ENV)==="production",emptyHttpStatus={101:void 0,204:void 0,205:void 0,304:void 0,307:void 0,308:void 0};class ElysiaCustomStatusResponse{code;response;constructor(code,response){let res=response??(code in InvertedStatusMap?InvertedStatusMap[code]:code);if(this.code=StatusMap[code]??code,code in emptyHttpStatus)this.response=void 0;else this.response=res}}var status=(code,response)=>new ElysiaCustomStatusResponse(code,response);class NotFoundError extends Error{code="NOT_FOUND";status=404;constructor(message){super(message??"NOT_FOUND")}}class ParseError2 extends Error{code="PARSE";status=400;constructor(cause){super("Bad Request",{cause})}}class InvalidCookieSignature extends Error{key;code="INVALID_COOKIE_SIGNATURE";status=400;constructor(key,message){super(message??`"${key}" has invalid cookie signature`);this.key=key}}var mapValueError=(error)=>{if(!error)return{summary:void 0};let{message,path,value,type}=error;if(Array.isArray(path))path=path[0];let property=typeof path==="string"?path.slice(1).replaceAll("/","."):"unknown",isRoot=path==="";switch(type){case 42:return{...error,summary:isRoot?"Value should not be provided":`Property '${property}' should not be provided`};case 45:return{...error,summary:isRoot?"Value is missing":`Property '${property}' is missing`};case 50:let quoteIndex=message.indexOf("'"),format=message.slice(quoteIndex+1,message.indexOf("'",quoteIndex+1));return{...error,summary:isRoot?"Value should be an email":`Property '${property}' should be ${format}`};case 54:return{...error,summary:`${message.slice(0,9).trim()} property '${property}' to be ${message.slice(8).trim()} but found: ${value}`};case 62:let union=error.schema.anyOf.map((x)=>`'${x?.format??x.type}'`).join(", ");return{...error,summary:isRoot?`Value should be one of ${union}`:`Property '${property}' should be one of: ${union}`};default:return{summary:message,...error}}};class InvalidFileType extends Error{property;expected;message;code="INVALID_FILE_TYPE";status=422;constructor(property,expected,message=`"${property}" has invalid file type`){super(message);this.property=property,this.expected=expected,this.message=message,Object.setPrototypeOf(this,InvalidFileType.prototype)}toResponse(headers){if(isProduction)return new Response(JSON.stringify({type:"validation",on:"body"}),{status:422,headers:{...headers,"content-type":"application/json"}});return new Response(JSON.stringify({type:"validation",on:"body",summary:"Invalid file type",message:this.message,property:this.property,expected:this.expected}),{status:422,headers:{...headers,"content-type":"application/json"}})}}class ValidationError extends Error{type;validator;value;allowUnsafeValidationDetails;code="VALIDATION";status=422;valueError;get messageValue(){return this.valueError}expected;customError;constructor(type,validator,value,allowUnsafeValidationDetails=!1,errors){let message="",error,expected,customError;if(validator?.provider==="standard"||"~standard"in validator||validator.schema&&"~standard"in validator.schema){let standard=("~standard"in validator?validator:validator.schema)["~standard"];if(error=(errors??standard.validate(value).issues)?.[0],isProduction)message=JSON.stringify({type:"validation",on:type,found:value});else message=JSON.stringify({type:"validation",on:type,property:error.path?.[0]||"root",message:error?.message,summary:error?.problem,expected,found:value,errors},null,2);customError=error?.message}else{if(value&&typeof value==="object"&&value instanceof ElysiaCustomStatusResponse)value=value.response;error=errors?.First()??("Errors"in validator?validator.Errors(value).First():exports_value2.Errors(validator,value).First());let accessor=error?.path||"root",schema=validator?.schema??validator;if(!isProduction&&!allowUnsafeValidationDetails)try{expected=exports_value2.Create(schema)}catch(error2){expected={type:"Could not create expected value",message:error2?.message,error:error2}}if(customError=error?.schema?.message||error?.schema?.error!==void 0?typeof error.schema.error==="function"?error.schema.error(isProduction&&!allowUnsafeValidationDetails?{type:"validation",on:type,found:value}:{type:"validation",on:type,value,property:accessor,message:error?.message,summary:mapValueError(error).summary,found:value,expected,errors:"Errors"in validator?[...validator.Errors(value)].map(mapValueError):[...exports_value2.Errors(validator,value)].map(mapValueError)},validator):error.schema.error:void 0,customError!==void 0)message=typeof customError==="object"?JSON.stringify(customError):customError+"";else if(isProduction&&!allowUnsafeValidationDetails)message=JSON.stringify({type:"validation",on:type,found:value});else message=JSON.stringify({type:"validation",on:type,property:accessor,message:error?.message,summary:mapValueError(error).summary,expected,found:value,errors:"Errors"in validator?[...validator.Errors(value)].map(mapValueError):[...exports_value2.Errors(validator,value)].map(mapValueError)},null,2)}super(message);this.type=type,this.validator=validator,this.value=value,this.allowUnsafeValidationDetails=allowUnsafeValidationDetails,this.valueError=error,this.expected=expected,this.customError=customError,Object.setPrototypeOf(this,ValidationError.prototype)}get all(){if(this.validator?.provider==="standard"||"~standard"in this.validator||"schema"in this.validator&&this.validator.schema&&"~standard"in this.validator.schema)return("~standard"in this.validator?this.validator:this.validator.schema)["~standard"].validate(this.value).issues?.map((issue)=>({summary:issue.message,path:issue.path?.join(".")||"root",message:issue.message,value:this.value}))||[];return"Errors"in this.validator?[...this.validator.Errors(this.value)].map(mapValueError):[...exports_value2.Errors(this.validator,this.value)].map(mapValueError)}static simplifyModel(validator){let model="schema"in validator?validator.schema:validator;try{return exports_value2.Create(model)}catch{return model}}get model(){if("~standard"in this.validator)return this.validator;return ValidationError.simplifyModel(this.validator)}toResponse(headers){return new Response(this.message,{status:400,headers:{...headers,"content-type":"application/json"}})}detail(message,allowUnsafeValidatorDetails=this.allowUnsafeValidationDetails){if(!this.customError)return this.message;let value=this.value,expected=this.expected,errors=this.all;return isProduction&&!allowUnsafeValidatorDetails?{type:"validation",on:this.type,found:value,message}:{type:"validation",on:this.type,property:this.valueError?.path||"root",message,summary:mapValueError(this.valueError).summary,found:value,expected,errors}}}var tryParse=(v,schema)=>{try{return JSON.parse(v)}catch{throw new ValidationError("property",schema,v)}};function createType(kind,func){if(!exports_type2.Has(kind))exports_type2.Set(kind,func);return(options={})=>Unsafe({...options,[Kind]:kind})}var compile=(schema)=>{try{let compiler=TypeCompiler.Compile(schema);return compiler.Create=()=>exports_value2.Create(schema),compiler.Error=(v)=>new ValidationError("property",schema,v,compiler.Errors(v)),compiler}catch{return{Check:(v)=>exports_value2.Check(schema,v),CheckThrow:(v)=>{if(!exports_value2.Check(schema,v))throw new ValidationError("property",schema,v,exports_value2.Errors(schema,v))},Decode:(v)=>exports_value2.Decode(schema,v),Create:()=>exports_value2.Create(schema),Error:(v)=>new ValidationError("property",schema,v,exports_value2.Errors(schema,v))}}},parseFileUnit=(size)=>{if(typeof size==="string")switch(size.slice(-1)){case"k":return+size.slice(0,size.length-1)*1024;case"m":return+size.slice(0,size.length-1)*1048576;default:return+size}return size},checkFileExtension=(type,extension)=>{if(type.startsWith(extension))return!0;return extension.charCodeAt(extension.length-1)===42&&extension.charCodeAt(extension.length-2)===47&&type.startsWith(extension.slice(0,-1))},_fileTypeFromBlobWarn=!1,warnIfFileTypeIsNotInstalled=()=>{if(!_fileTypeFromBlobWarn)console.warn("[Elysia] Attempt to validate file type without 'file-type'. This may lead to security risks. We recommend installing 'file-type' to properly validate file extension."),_fileTypeFromBlobWarn=!0},loadFileType=async()=>Promise.resolve().then(() => (init_file_type(),exports_file_type)).then((x)=>{return _fileTypeFromBlob=x.fileTypeFromBlob,_fileTypeFromBlob}).catch(warnIfFileTypeIsNotInstalled),_fileTypeFromBlob,fileTypeFromBlob2=(file2)=>{if(_fileTypeFromBlob)return _fileTypeFromBlob(file2);return loadFileType().then((mod)=>{if(mod)return mod(file2)})},fileType=async(file2,extension,name=file2?.name??"")=>{if(Array.isArray(file2))return await Promise.all(file2.map((f)=>fileType(f,extension,name))),!0;if(!file2)return!1;let result=await fileTypeFromBlob2(file2);if(!result)throw new InvalidFileType(name,extension);if(typeof extension==="string"){if(!checkFileExtension(result.mime,extension))throw new InvalidFileType(name,extension)}for(let i=0;i<extension.length;i++)if(checkFileExtension(result.mime,extension[i]))return!0;throw new InvalidFileType(name,extension)},validateFile=(options,value)=>{if(value instanceof ElysiaFile)return!0;if(!(value instanceof Blob))return!1;if(options.minSize&&value.size<parseFileUnit(options.minSize))return!1;if(options.maxSize&&value.size>parseFileUnit(options.maxSize))return!1;if(options.extension){if(typeof options.extension==="string")return checkFileExtension(value.type,options.extension);for(let i=0;i<options.extension.length;i++)if(checkFileExtension(value.type,options.extension[i]))return!0;return!1}return!0};var fullFormats={date,time:getTime(!0),"date-time":getDateTime(!0),"iso-time":getTime(!1),"iso-date-time":getDateTime(!1),duration:/^P(?!$)((\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?|(\d+W)?)$/,uri,"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,url:/^(?:https?|ftp):\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)(?:\.(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)\.){3}(?:25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)$/,ipv6:/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,regex,uuid:/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,"json-pointer":/^(?:\/(?:[^~/]|~0|~1)*)*$/,"json-pointer-uri-fragment":/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,"relative-json-pointer":/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,byte,int32:{type:"number",validate:validateInt32},int64:{type:"number",validate:validateInt64},float:{type:"number",validate:validateNumber},double:{type:"number",validate:validateNumber},password:!0,binary:!0};function isLeapYear(year){return year%4===0&&(year%100!==0||year%400===0)}var DATE=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,DAYS=[0,31,28,31,30,31,30,31,31,30,31,30,31];function date(str){let matches=DATE.exec(str);if(!matches)return!1;let year=+matches[1],month=+matches[2],day=+matches[3];return month>=1&&month<=12&&day>=1&&day<=(month===2&&isLeapYear(year)?29:DAYS[month])}var TIME=/^(\d\d):(\d\d):(\d\d(?:\.\d+)?)(z|([+-])(\d\d)(?::?(\d\d))?)?$/i;function getTime(strictTimeZone){return function(str){let matches=TIME.exec(str);if(!matches)return!1;let hr=+matches[1],min=+matches[2],sec=+matches[3],tz=matches[4],tzSign=matches[5]==="-"?-1:1,tzH=+(matches[6]||0),tzM=+(matches[7]||0);if(tzH>23||tzM>59||strictTimeZone&&!tz)return!1;if(hr<=23&&min<=59&&sec<60)return!0;let utcMin=min-tzM*tzSign,utcHr=hr-tzH*tzSign-(utcMin<0?1:0);return(utcHr===23||utcHr===-1)&&(utcMin===59||utcMin===-1)&&sec<61}}var parseDateTimeEmptySpace=(str)=>{if(str.charCodeAt(str.length-6)===32)return str.slice(0,-6)+"+"+str.slice(-5);return str},DATE_TIME_SEPARATOR=/t|\s/i;function getDateTime(strictTimeZone){let time=getTime(strictTimeZone);return function(str){let dateTime=str.split(DATE_TIME_SEPARATOR);return dateTime.length===2&&date(dateTime[0])&&time(dateTime[1])}}var NOT_URI_FRAGMENT=/\/|:/,URI=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function uri(str){return NOT_URI_FRAGMENT.test(str)&&URI.test(str)}var BYTE=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/gm;function byte(str){return BYTE.lastIndex=0,BYTE.test(str)}var MIN_INT32=-2147483648,MAX_INT32=2147483647;function validateInt32(value){return Number.isInteger(value)&&value<=MAX_INT32&&value>=MIN_INT32}function validateInt64(value){return Number.isInteger(value)}function validateNumber(){return!0}var Z_ANCHOR=/[^\\]\\Z/;function regex(str){if(Z_ANCHOR.test(str))return!1;try{return new RegExp(str),!0}catch(e){return!1}}var isISO8601=/(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d\.\d+([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))|(\d{4}-[01]\d-[0-3]\dT[0-2]\d:[0-5]\d([+-][0-2]\d:[0-5]\d|Z))/,isFormalDate=/(?:Sun|Mon|Tue|Wed|Thu|Fri|Sat)\s(?:Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s\d{2}\s\d{4}\s\d{2}:\d{2}:\d{2}\sGMT(?:\+|-)\d{4}\s\([^)]+\)/,isShortenDate=/^(?:(?:(?:(?:0?[1-9]|[12][0-9]|3[01])[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:19|20)\d{2})|(?:(?:19|20)\d{2}[/\s-](?:0?[1-9]|1[0-2])[/\s-](?:0?[1-9]|[12][0-9]|3[01]))))(?:\s(?:1[012]|0?[1-9]):[0-5][0-9](?::[0-5][0-9])?(?:\s[AP]M)?)?$/,_validateDate=fullFormats.date,_validateDateTime=fullFormats["date-time"];if(!exports_format.Has("date"))exports_format.Set("date",(value)=>{let temp=parseDateTimeEmptySpace(value).replace(/"/g,"");if(isISO8601.test(temp)||isFormalDate.test(temp)||isShortenDate.test(temp)||_validateDate(temp)){let date2=new Date(temp);if(!Number.isNaN(date2.getTime()))return!0}return!1});if(!exports_format.Has("date-time"))exports_format.Set("date-time",(value)=>{let temp=value.replace(/"/g,"");if(isISO8601.test(temp)||isFormalDate.test(temp)||isShortenDate.test(temp)||_validateDateTime(temp)){let date2=new Date(temp);if(!Number.isNaN(date2.getTime()))return!0}return!1});Object.entries(fullFormats).forEach((formatEntry)=>{let[formatName,formatValue]=formatEntry;if(!exports_format.Has(formatName)){if(formatValue instanceof RegExp)exports_format.Set(formatName,(value)=>formatValue.test(value));else if(typeof formatValue==="function")exports_format.Set(formatName,formatValue)}});if(!exports_format.Has("numeric"))exports_format.Set("numeric",(value)=>!!value&&!isNaN(+value));if(!exports_format.Has("integer"))exports_format.Set("integer",(value)=>!!value&&Number.isInteger(+value));if(!exports_format.Has("boolean"))exports_format.Set("boolean",(value)=>value==="true"||value==="false");if(!exports_format.Has("ObjectString"))exports_format.Set("ObjectString",(value)=>{let start=value.charCodeAt(0);if(start===9||start===10||start===32)start=value.trimStart().charCodeAt(0);if(start!==123&&start!==91)return!1;try{return JSON.parse(value),!0}catch{return!1}});if(!exports_format.Has("ArrayString"))exports_format.Set("ArrayString",(value)=>{let start=value.charCodeAt(0);if(start===9||start===10||start===32)start=value.trimStart().charCodeAt(0);if(start!==123&&start!==91)return!1;try{return JSON.parse(value),!0}catch{return!1}});var t=Object.assign({},Type);createType("UnionEnum",(schema,value)=>(typeof value==="number"||typeof value==="string"||value===null)&&schema.enum.includes(value));createType("ArrayBuffer",(schema,value)=>value instanceof ArrayBuffer);var internalFiles=createType("Files",(options,value)=>{if(options.minItems&&options.minItems>1&&!Array.isArray(value))return!1;if(!Array.isArray(value))return validateFile(options,value);if(options.minItems&&value.length<options.minItems)return!1;if(options.maxItems&&value.length>options.maxItems)return!1;for(let i=0;i<value.length;i++)if(!validateFile(options,value[i]))return!1;return!0}),internalFormData=createType("ElysiaForm",({compiler,...schema},value)=>{if(!(value instanceof FormData))return!1;if(compiler){if(!(ELYSIA_FORM_DATA in value))throw new ValidationError("property",schema,value);if(!compiler.Check(value[ELYSIA_FORM_DATA]))throw compiler.Error(value[ELYSIA_FORM_DATA])}return!0}),ElysiaType={String:(property)=>Type.String(property),Numeric:(property)=>{let schema=Type.Number(property),compiler=compile(schema);return t.Transform(t.Union([t.String({format:"numeric",default:0}),t.Number(property)],property)).Decode((value)=>{let number=+value;if(isNaN(number))return value;if(property&&!compiler.Check(number))throw compiler.Error(number);return number}).Encode((value)=>value)},NumericEnum(item,property){let schema=Type.Enum(item,property),compiler=compile(schema);return t.Transform(t.Union([t.String({format:"numeric"}),t.Number()],property)).Decode((value)=>{let number=+value;if(isNaN(number))throw compiler.Error(number);if(!compiler.Check(number))throw compiler.Error(number);return number}).Encode((value)=>value)},Integer:(property)=>{let schema=Type.Integer(property),compiler=compile(schema);return t.Transform(t.Union([t.String({format:"integer",default:0}),Type.Integer(property)],property)).Decode((value)=>{let number=+value;if(!compiler.Check(number))throw compiler.Error(number);return number}).Encode((value)=>value)},Date:(property)=>{let schema=Type.Date(property),compiler=compile(schema),_default=property?.default?new Date(property.default):void 0;return t.Transform(t.Union([Type.Date(property),t.String({format:"date-time",default:_default?.toISOString()}),t.String({format:"date",default:_default?.toISOString()}),t.Number({default:_default?.getTime()})],property)).Decode((value)=>{if(typeof value==="number"){let date3=new Date(value);if(!compiler.Check(date3))throw compiler.Error(date3);return date3}if(value instanceof Date)return value;let date2=new Date(parseDateTimeEmptySpace(value));if(!date2||isNaN(date2.getTime()))throw new ValidationError("property",schema,date2);if(!compiler.Check(date2))throw compiler.Error(date2);return date2}).Encode((value)=>{if(value instanceof Date)return value.toISOString();if(typeof value==="string"){if(isNaN(new Date(parseDateTimeEmptySpace(value)).getTime()))throw new ValidationError("property",schema,value);return value}if(!compiler.Check(value))throw compiler.Error(value);return value})},BooleanString:(property)=>{let schema=Type.Boolean(property),compiler=compile(schema);return t.Transform(t.Union([t.Boolean(property),t.String({format:"boolean",default:!1})],property)).Decode((value)=>{if(typeof value==="string")return value==="true";if(value!==void 0&&!compiler.Check(value))throw compiler.Error(value);return value}).Encode((value)=>value)},ObjectString:(properties,options)=>{let schema=t.Object(properties,options),compiler=compile(schema);return t.Transform(t.Union([t.String({format:"ObjectString",default:options?.default}),schema],{elysiaMeta:"ObjectString"})).Decode((value)=>{if(typeof value==="string"){if(value.charCodeAt(0)!==123)throw new ValidationError("property",schema,value);if(!compiler.Check(value=tryParse(value,schema)))throw compiler.Error(value);return compiler.Decode(value)}return value}).Encode((value)=>{let original;if(typeof value==="string")value=tryParse(original=value,schema);if(!compiler.Check(value))throw compiler.Error(value);return original??JSON.stringify(value)})},ArrayString:(children=t.String(),options)=>{let schema=t.Array(children,options),compiler=compile(schema),decode2=(value,isProperty=!1)=>{if(value.charCodeAt(0)===91){if(!compiler.Check(value=tryParse(value,schema)))throw compiler.Error(value);return compiler.Decode(value)}if(isProperty)return value;throw new ValidationError("property",schema,value)};return t.Transform(t.Union([t.String({format:"ArrayString",default:options?.default}),schema],{elysiaMeta:"ArrayString"})).Decode((value)=>{if(Array.isArray(value)){let values=[];for(let i=0;i<value.length;i++){let v=value[i];if(typeof v==="string"){let t2=decode2(v,!0);if(Array.isArray(t2))values=values.concat(t2);else values.push(t2);continue}values.push(v)}return values}if(typeof value==="string")return decode2(value);return value}).Encode((value)=>{let original;if(typeof value==="string")value=tryParse(original=value,schema);if(!compiler.Check(value))throw new ValidationError("property",schema,value);return original??JSON.stringify(value)})},ArrayQuery:(children=t.String(),options)=>{let schema=t.Array(children,options),compiler=compile(schema),decode2=(value)=>{if(value.indexOf(",")!==-1)return compiler.Decode(value.split(","));return[value]};return t.Transform(t.Union([t.String({default:options?.default}),schema],{elysiaMeta:"ArrayQuery"})).Decode((value)=>{if(Array.isArray(value)){let values=[];for(let i=0;i<value.length;i++){let v=value[i];if(typeof v==="string"){let t2=decode2(v);if(Array.isArray(t2))values=values.concat(t2);else values.push(t2);continue}values.push(v)}return values}if(typeof value==="string")return decode2(value);return value}).Encode((value)=>{let original;if(typeof value==="string")value=tryParse(original=value,schema);if(!compiler.Check(value))throw new ValidationError("property",schema,value);return original??JSON.stringify(value)})},File:createType("File",validateFile),Files:(options={})=>t.Transform(internalFiles(options)).Decode((value)=>{if(Array.isArray(value))return value;return[value]}).Encode((value)=>value),Nullable:(schema,options)=>t.Union([schema,t.Null()],{...options,nullable:!0}),MaybeEmpty:(schema,options)=>t.Union([schema,t.Null(),t.Undefined()],options),Cookie:(properties,{domain,expires,httpOnly,maxAge,path,priority,sameSite,secure,secrets,sign,...options}={})=>{let v=t.Object(properties,options);return v.config={domain,expires,httpOnly,maxAge,path,priority,sameSite,secure,secrets,sign},v},UnionEnum:(values,options={})=>{let type=values.every((value)=>typeof value==="string")?{type:"string"}:values.every((value)=>typeof value==="number")?{type:"number"}:values.every((value)=>value===null)?{type:"null"}:{};if(values.some((x)=>typeof x==="object"&&x!==null))throw Error("This type does not support objects or arrays");return{default:values[0],...options,[Kind]:"UnionEnum",...type,enum:values}},NoValidate:(v,enabled=!0)=>{return v.noValidate=enabled,v},Form:(v,options={})=>{let schema=t.Object(v,{default:form({}),...options}),compiler=compile(schema);return t.Union([schema,internalFormData({compiler})])},ArrayBuffer(options={}){return{default:[1,2,3],...options,[Kind]:"ArrayBuffer"}},Uint8Array:(options)=>{let schema=Type.Uint8Array(options),compiler=compile(schema);return t.Transform(t.Union([t.ArrayBuffer(),Type.Uint8Array(options)])).Decode((value)=>{if(value instanceof ArrayBuffer){if(!compiler.Check(value=new Uint8Array(value)))throw compiler.Error(value);return value}return value}).Encode((value)=>value)}};t.BooleanString=ElysiaType.BooleanString;t.ObjectString=ElysiaType.ObjectString;t.ArrayString=ElysiaType.ArrayString;t.ArrayQuery=ElysiaType.ArrayQuery;t.Numeric=ElysiaType.Numeric;t.NumericEnum=ElysiaType.NumericEnum;t.Integer=ElysiaType.Integer;t.File=(arg)=>{if(arg?.type)loadFileType();return ElysiaType.File({default:"File",...arg,extension:arg?.type,type:"string",format:"binary"})};t.Files=(arg)=>{if(arg?.type)loadFileType();return ElysiaType.Files({...arg,elysiaMeta:"Files",default:"Files",extension:arg?.type,type:"array",items:{...arg,default:"Files",type:"string",format:"binary"}})};t.Nullable=ElysiaType.Nullable;t.MaybeEmpty=ElysiaType.MaybeEmpty;t.Cookie=ElysiaType.Cookie;t.Date=ElysiaType.Date;t.UnionEnum=ElysiaType.UnionEnum;t.NoValidate=ElysiaType.NoValidate;t.Form=ElysiaType.Form;t.ArrayBuffer=ElysiaType.ArrayBuffer;t.Uint8Array=ElysiaType.Uint8Array;var import_cookie=__toESM2(require_dist(),1),import_fast_decode_uri_component=__toESM2(require_fast_decode_uri_component(),1),hashString=(str)=>{let hash2=2166136261,len=str.length;for(let i=0;i<len;i++)hash2^=str.charCodeAt(i),hash2=Math.imul(hash2,16777619);return hash2>>>0};class Cookie{name;jar;initial;valueHash;constructor(name,jar,initial={}){this.name=name,this.jar=jar,this.initial=initial}get cookie(){return this.jar[this.name]??this.initial}set cookie(jar){if(!(this.name in this.jar))this.jar[this.name]=this.initial;this.jar[this.name]=jar,this.valueHash=void 0}get setCookie(){if(!(this.name in this.jar))this.jar[this.name]=this.initial;return this.jar[this.name]}set setCookie(jar){this.cookie=jar}get value(){return this.cookie.value}set value(value){let current=this.cookie.value;if(current===value)return;if(typeof current==="object"&&current!==null&&typeof value==="object"&&value!==null)try{let valueStr=JSON.stringify(value),newHash=hashString(valueStr);if(this.valueHash!==void 0&&this.valueHash!==newHash)this.valueHash=newHash;else{if(JSON.stringify(current)===valueStr){this.valueHash=newHash;return}this.valueHash=newHash}}catch{}if(!(this.name in this.jar))this.jar[this.name]={...this.initial};this.jar[this.name].value=value}get expires(){return this.cookie.expires}set expires(expires){this.setCookie.expires=expires}get maxAge(){return this.cookie.maxAge}set maxAge(maxAge){this.setCookie.maxAge=maxAge}get domain(){return this.cookie.domain}set domain(domain){this.setCookie.domain=domain}get path(){return this.cookie.path}set path(path){this.setCookie.path=path}get secure(){return this.cookie.secure}set secure(secure){this.setCookie.secure=secure}get httpOnly(){return this.cookie.httpOnly}set httpOnly(httpOnly){this.setCookie.httpOnly=httpOnly}get sameSite(){return this.cookie.sameSite}set sameSite(sameSite){this.setCookie.sameSite=sameSite}get priority(){return this.cookie.priority}set priority(priority){this.setCookie.priority=priority}get partitioned(){return this.cookie.partitioned}set partitioned(partitioned){this.setCookie.partitioned=partitioned}get secrets(){return this.cookie.secrets}set secrets(secrets){this.setCookie.secrets=secrets}update(config){return this.setCookie=Object.assign(this.cookie,typeof config==="function"?config(this.cookie):config),this}set(config){return this.setCookie=Object.assign({...this.initial,value:this.value},typeof config==="function"?config(this.cookie):config),this}remove(){if(this.value===void 0)return;return this.set({expires:new Date(0),maxAge:0,value:""}),this}toString(){return typeof this.value==="object"?JSON.stringify(this.value):this.value?.toString()??""}}var createCookieJar=(set2,store,initial)=>{if(!set2.cookie)set2.cookie={};return new Proxy(store,{get(_2,key){if(key in store)return new Cookie(key,set2.cookie,Object.assign({},initial??{},store[key]));return new Cookie(key,set2.cookie,Object.assign({},initial))}})},parseCookie=async(set2,cookieString,{secrets,sign,...initial}={})=>{if(!cookieString)return createCookieJar(set2,{},initial);let isStringKey=typeof secrets==="string";if(sign&&sign!==!0&&!Array.isArray(sign))sign=[sign];let jar={},cookies=import_cookie.parse(cookieString);for(let[name,v]of Object.entries(cookies)){if(v===void 0)continue;let value=import_fast_decode_uri_component.default(v);if(value){let starts=value.charCodeAt(0),ends=value.charCodeAt(value.length-1);if(starts===123&&ends===125||starts===91&&ends===93)try{value=JSON.parse(value)}catch{}}if(sign===!0||sign?.includes(name)){if(!secrets)throw Error("No secret is provided to cookie plugin");if(isStringKey){let temp=await unsignCookie(value,secrets);if(temp===!1)throw new InvalidCookieSignature(name);value=temp}else{let decoded=!1;for(let i=0;i<secrets.length;i++){let temp=await unsignCookie(value,secrets[i]);if(temp!==!1){decoded=!0,value=temp;break}}if(!decoded)throw new InvalidCookieSignature(name)}}jar[name]={value}}return createCookieJar(set2,jar,initial)},serializeCookie=(cookies)=>{if(!cookies||!isNotEmpty(cookies))return;let set2=[];for(let[key,property]of Object.entries(cookies)){if(!key||!property)continue;let value=property.value;if(value===void 0||value===null)continue;set2.push(import_cookie.serialize(key,typeof value==="object"?JSON.stringify(value):value+"",property))}if(set2.length===0)return;if(set2.length===1)return set2[0];return set2},env2=isBun?Bun.env:typeof process<"u"&&process?.env?process.env:{},handleFile=(response,set2)=>{if(!isBun&&response instanceof Promise)return response.then((res)=>handleFile(res,set2));let size=response.size,immutable=set2&&(set2.status===206||set2.status===304||set2.status===412||set2.status===416),defaultHeader=immutable?{}:{"accept-ranges":"bytes","content-range":size?`bytes 0-${size-1}/${size}`:void 0};if(!set2&&!size)return new Response(response);if(!set2)return new Response(response,{headers:defaultHeader});if(set2.headers instanceof Headers){for(let key of Object.keys(defaultHeader))if(key in set2.headers)set2.headers.append(key,defaultHeader[key]);if(immutable)set2.headers.delete("content-length"),set2.headers.delete("accept-ranges");return new Response(response,set2)}if(isNotEmpty(set2.headers))return new Response(response,{status:set2.status,headers:Object.assign(defaultHeader,set2.headers)});return new Response(response,{status:set2.status,headers:defaultHeader})},parseSetCookies=(headers,setCookie)=>{if(!headers)return headers;headers.delete("set-cookie");for(let i=0;i<setCookie.length;i++){let index=setCookie[i].indexOf("=");headers.append("set-cookie",`${setCookie[i].slice(0,index)}=${setCookie[i].slice(index+1)||""}`)}return headers},responseToSetHeaders=(response,set2)=>{if(set2?.headers){if(response){if(hasHeaderShorthand)Object.assign(set2.headers,response.headers.toJSON());else for(let[key,value]of response.headers.entries())if(key in set2.headers)set2.headers[key]=value}if(set2.status===200)set2.status=response.status;if(set2.headers["content-encoding"])delete set2.headers["content-encoding"];return set2}if(!response)return{headers:{},status:set2?.status??200};if(hasHeaderShorthand){if(set2={headers:response.headers.toJSON(),status:set2?.status??200},set2.headers["content-encoding"])delete set2.headers["content-encoding"];return set2}set2={headers:{},status:set2?.status??200};for(let[key,value]of response.headers.entries()){if(key==="content-encoding")continue;if(key in set2.headers)set2.headers[key]=value}return set2},allowRapidStream=env2.ELYSIA_RAPID_STREAM==="true",createStreamHandler=({mapResponse,mapCompactResponse})=>async(generator,set2,request)=>{let init=generator.next?.();if(set2)handleSet(set2);if(init instanceof Promise)init=await init;if(init?.value instanceof ReadableStream)generator=init.value;else if(init&&(typeof init?.done>"u"||init?.done)){if(set2)return mapResponse(init.value,set2,request);return mapCompactResponse(init.value,request)}let isSSE=init?.value?.sse??generator?.sse??set2?.headers["content-type"]?.startsWith("text/event-stream"),format=isSSE?(data)=>`data: ${data}

`:(data)=>data,contentType=isSSE?"text/event-stream":init?.value&&typeof init?.value==="object"?"application/json":"text/plain";if(set2?.headers){if(!set2.headers["transfer-encoding"])set2.headers["transfer-encoding"]="chunked";if(!set2.headers["content-type"])set2.headers["content-type"]=contentType;if(!set2.headers["cache-control"])set2.headers["cache-control"]="no-cache"}else set2={status:200,headers:{"content-type":contentType,"transfer-encoding":"chunked","cache-control":"no-cache",connection:"keep-alive"}};let isBrowser=request?.headers.has("Origin");return new Response(new ReadableStream({async start(controller){let end=!1;if(request?.signal?.addEventListener("abort",()=>{end=!0;try{controller.close()}catch{}}),!init||init.value instanceof ReadableStream);else if(init.value!==void 0&&init.value!==null)if(init.value.toSSE)controller.enqueue(init.value.toSSE());else if(typeof init.value==="object")try{controller.enqueue(format(JSON.stringify(init.value)))}catch{controller.enqueue(format(init.value.toString()))}else controller.enqueue(format(init.value.toString()));try{for await(let chunk of generator){if(end)break;if(chunk===void 0||chunk===null)continue;if(chunk.toSSE)controller.enqueue(chunk.toSSE());else{if(typeof chunk==="object")try{controller.enqueue(format(JSON.stringify(chunk)))}catch{controller.enqueue(format(chunk.toString()))}else controller.enqueue(format(chunk.toString()));if(!allowRapidStream&&isBrowser&&!isSSE)await new Promise((resolve)=>setTimeout(()=>resolve(),0))}}}catch(error){console.warn(error)}try{controller.close()}catch{}}}),set2)};async function*streamResponse(response){let body=response.body;if(!body)return;let reader=body.getReader(),decoder=new TextDecoder;try{while(!0){let{done,value}=await reader.read();if(done)break;if(typeof value==="string")yield value;else yield decoder.decode(value)}}finally{reader.releaseLock()}}var handleSet=(set2)=>{if(typeof set2.status==="string")set2.status=StatusMap[set2.status];if(set2.cookie&&isNotEmpty(set2.cookie)){let cookie=serializeCookie(set2.cookie);if(cookie)set2.headers["set-cookie"]=cookie}if(set2.headers["set-cookie"]&&Array.isArray(set2.headers["set-cookie"]))set2.headers=parseSetCookies(new Headers(set2.headers),set2.headers["set-cookie"])},createResponseHandler=(handler)=>{let handleStream=createStreamHandler(handler);return(response,set2,request)=>{let isCookieSet=!1;if(set2.headers instanceof Headers){for(let key of set2.headers.keys())if(key==="set-cookie"){if(isCookieSet)continue;isCookieSet=!0;for(let cookie of set2.headers.getSetCookie())response.headers.append("set-cookie",cookie)}else if(!response.headers.has(key))response.headers.set(key,set2.headers?.get(key)??"")}else for(let key in set2.headers)if(key==="set-cookie")response.headers.append(key,set2.headers[key]);else if(!response.headers.has(key))response.headers.set(key,set2.headers[key]);let status2=set2.status??200;if(response.status!==status2&&status2!==200&&(response.status<=300||response.status>400)){let newResponse=new Response(response.body,{headers:response.headers,status:set2.status});if(!newResponse.headers.has("content-length")&&newResponse.headers.get("transfer-encoding")==="chunked")return handleStream(streamResponse(newResponse),responseToSetHeaders(newResponse,set2),request);return newResponse}if(!response.headers.has("content-length")&&response.headers.get("transfer-encoding")==="chunked")return handleStream(streamResponse(response),responseToSetHeaders(response,set2),request);return response}};async function tee(source,branches=2){let buffer=[],done=!1,waiting=[];(async()=>{for await(let value of source)buffer.push(value),waiting.forEach((w)=>w.resolve()),waiting=[];done=!0,waiting.forEach((w)=>w.resolve())})();async function*makeIterator(){let i=0;while(!0)if(i<buffer.length)yield buffer[i++];else if(done)return;else await new Promise((resolve)=>waiting.push({resolve}))}return Array.from({length:branches},makeIterator)}var handleElysiaFile=(file2,set2={headers:{}})=>{let path=file2.path,contentType=mime[path.slice(path.lastIndexOf(".")+1)];if(contentType)set2.headers["content-type"]=contentType;if(file2.stats&&set2.status!==206&&set2.status!==304&&set2.status!==412&&set2.status!==416)return file2.stats.then((stat2)=>{let size=stat2.size;if(size!==void 0)set2.headers["content-range"]=`bytes 0-${size-1}/${size}`,set2.headers["content-length"]=size;return handleFile(file2.value,set2)});return handleFile(file2.value,set2)},mapResponse=(response,set2,request)=>{if(isNotEmpty(set2.headers)||set2.status!==200||set2.cookie)switch(handleSet(set2),response?.constructor?.name){case"String":return set2.headers["content-type"]="text/plain",new Response(response,set2);case"Array":case"Object":return set2.headers["content-type"]="application/json",new Response(JSON.stringify(response),set2);case"ElysiaFile":return handleElysiaFile(response,set2);case"File":return handleFile(response,set2);case"Blob":return handleFile(response,set2);case"ElysiaCustomStatusResponse":return set2.status=response.code,mapResponse(response.response,set2,request);case void 0:if(!response)return new Response("",set2);return new Response(JSON.stringify(response),set2);case"Response":return handleResponse(response,set2,request);case"Error":return errorToResponse(response,set2);case"Promise":return response.then((x)=>mapResponse(x,set2,request));case"Function":return mapResponse(response(),set2,request);case"Number":case"Boolean":return new Response(response.toString(),set2);case"Cookie":if(response instanceof Cookie)return new Response(response.value,set2);return new Response(response?.toString(),set2);case"FormData":return new Response(response,set2);default:if(response instanceof Response)return handleResponse(response,set2,request);if(response instanceof Promise)return response.then((x)=>mapResponse(x,set2));if(response instanceof Error)return errorToResponse(response,set2);if(response instanceof ElysiaCustomStatusResponse)return set2.status=response.code,mapResponse(response.response,set2,request);if(typeof response?.next==="function"||response instanceof ReadableStream)return handleStream(response,set2,request);if(typeof response?.then==="function")return response.then((x)=>mapResponse(x,set2));if(typeof response?.toResponse==="function")return mapResponse(response.toResponse(),set2);if("charCodeAt"in response){let code=response.charCodeAt(0);if(code===123||code===91){if(!set2.headers["Content-Type"])set2.headers["Content-Type"]="application/json";return new Response(JSON.stringify(response),set2)}}return new Response(response,set2)}if(typeof response?.next==="function"||response instanceof ReadableStream)return handleStream(response,set2,request);return mapCompactResponse(response,request)},mapEarlyResponse=(response,set2,request)=>{if(response===void 0||response===null)return;if(isNotEmpty(set2.headers)||set2.status!==200||set2.cookie)switch(handleSet(set2),response?.constructor?.name){case"String":return set2.headers["content-type"]="text/plain",new Response(response,set2);case"Array":case"Object":return set2.headers["content-type"]="application/json",new Response(JSON.stringify(response),set2);case"ElysiaFile":return handleElysiaFile(response,set2);case"File":return handleFile(response,set2);case"Blob":return handleFile(response,set2);case"ElysiaCustomStatusResponse":return set2.status=response.code,mapEarlyResponse(response.response,set2,request);case void 0:if(!response)return;return new Response(JSON.stringify(response),set2);case"Response":return handleResponse(response,set2,request);case"Promise":return response.then((x)=>mapEarlyResponse(x,set2));case"Error":return errorToResponse(response,set2);case"Function":return mapEarlyResponse(response(),set2);case"Number":case"Boolean":return new Response(response.toString(),set2);case"FormData":return new Response(response);case"Cookie":if(response instanceof Cookie)return new Response(response.value,set2);return new Response(response?.toString(),set2);default:if(response instanceof Response)return handleResponse(response,set2,request);if(response instanceof Promise)return response.then((x)=>mapEarlyResponse(x,set2));if(response instanceof Error)return errorToResponse(response,set2);if(response instanceof ElysiaCustomStatusResponse)return set2.status=response.code,mapEarlyResponse(response.response,set2,request);if(typeof response?.next==="function"||response instanceof ReadableStream)return handleStream(response,set2,request);if(typeof response?.then==="function")return response.then((x)=>mapEarlyResponse(x,set2));if(typeof response?.toResponse==="function")return mapEarlyResponse(response.toResponse(),set2);if("charCodeAt"in response){let code=response.charCodeAt(0);if(code===123||code===91){if(!set2.headers["Content-Type"])set2.headers["Content-Type"]="application/json";return new Response(JSON.stringify(response),set2)}}return new Response(response,set2)}else switch(response?.constructor?.name){case"String":return set2.headers["content-type"]="text/plain",new Response(response);case"Array":case"Object":return set2.headers["content-type"]="application/json",new Response(JSON.stringify(response),set2);case"ElysiaFile":return handleElysiaFile(response,set2);case"File":return handleFile(response,set2);case"Blob":return handleFile(response,set2);case"ElysiaCustomStatusResponse":return set2.status=response.code,mapEarlyResponse(response.response,set2,request);case void 0:if(!response)return new Response("");return new Response(JSON.stringify(response),{headers:{"content-type":"application/json"}});case"Response":return response;case"Promise":return response.then((x)=>{let r=mapEarlyResponse(x,set2);if(r!==void 0)return r});case"Error":return errorToResponse(response,set2);case"Function":return mapCompactResponse(response(),request);case"Number":case"Boolean":return new Response(response.toString());case"Cookie":if(response instanceof Cookie)return new Response(response.value,set2);return new Response(response?.toString(),set2);case"FormData":return new Response(response);default:if(response instanceof Response)return response;if(response instanceof Promise)return response.then((x)=>mapEarlyResponse(x,set2));if(response instanceof Error)return errorToResponse(response,set2);if(response instanceof ElysiaCustomStatusResponse)return set2.status=response.code,mapEarlyResponse(response.response,set2,request);if(typeof response?.next==="function"||response instanceof ReadableStream)return handleStream(response,set2,request);if(typeof response?.then==="function")return response.then((x)=>mapEarlyResponse(x,set2));if(typeof response?.toResponse==="function")return mapEarlyResponse(response.toResponse(),set2);if("charCodeAt"in response){let code=response.charCodeAt(0);if(code===123||code===91){if(!set2.headers["Content-Type"])set2.headers["Content-Type"]="application/json";return new Response(JSON.stringify(response),set2)}}return new Response(response)}},mapCompactResponse=(response,request)=>{switch(response?.constructor?.name){case"String":return new Response(response,{headers:{"Content-Type":"text/plain"}});case"Object":case"Array":return new Response(JSON.stringify(response),{headers:{"Content-Type":"application/json"}});case"ElysiaFile":return handleElysiaFile(response);case"File":return handleFile(response);case"Blob":return handleFile(response);case"ElysiaCustomStatusResponse":return mapResponse(response.response,{status:response.code,headers:{}});case void 0:if(!response)return new Response("");return new Response(JSON.stringify(response),{headers:{"content-type":"application/json"}});case"Response":return response;case"Error":return errorToResponse(response);case"Promise":return response.then((x)=>mapCompactResponse(x,request));case"Function":return mapCompactResponse(response(),request);case"Number":case"Boolean":return new Response(response.toString());case"FormData":return new Response(response);default:if(response instanceof Response)return response;if(response instanceof Promise)return response.then((x)=>mapCompactResponse(x,request));if(response instanceof Error)return errorToResponse(response);if(response instanceof ElysiaCustomStatusResponse)return mapResponse(response.response,{status:response.code,headers:{}});if(typeof response?.next==="function"||response instanceof ReadableStream)return handleStream(response,void 0,request);if(typeof response?.then==="function")return response.then((x)=>mapResponse(x,set));if(typeof response?.toResponse==="function")return mapCompactResponse(response.toResponse());if("charCodeAt"in response){let code=response.charCodeAt(0);if(code===123||code===91)return new Response(JSON.stringify(response),{headers:{"Content-Type":"application/json"}})}return new Response(response)}},errorToResponse=(error,set2)=>{if(typeof error?.toResponse==="function"){let raw=error.toResponse(),targetSet=set2??{headers:{},status:200,redirect:""},apply=(resolved)=>{if(resolved instanceof Response)targetSet.status=resolved.status;return mapResponse(resolved,targetSet)};return typeof raw?.then==="function"?raw.then(apply):apply(raw)}return new Response(JSON.stringify({name:error?.name,message:error?.message,cause:error?.cause}),{status:set2?.status!==200?set2?.status??500:500,headers:set2?.headers})},createStaticHandler=(handle,hooks,setHeaders={})=>{if(typeof handle==="function")return;let response=mapResponse(handle,{headers:setHeaders});if(!hooks.parse?.length&&!hooks.transform?.length&&!hooks.beforeHandle?.length&&!hooks.afterHandle?.length)return()=>response.clone()},handleResponse=createResponseHandler({mapResponse,mapCompactResponse}),handleStream=createStreamHandler({mapResponse,mapCompactResponse}),WebStandardAdapter={name:"web-standard",isWebStandard:!0,handler:{mapResponse,mapEarlyResponse,mapCompactResponse,createStaticHandler},composeHandler:{mapResponseContext:"c.request",preferWebstandardHeaders:!0,headers:`c.headers={}
for(const [k,v] of c.request.headers.entries())c.headers[k]=v
`,parser:{json(isOptional){if(isOptional)return`try{c.body=await c.request.json()}catch{}
`;return`c.body=await c.request.json()
`},text(){return`c.body=await c.request.text()
`},urlencoded(){return`c.body=parseQuery(await c.request.text())
`},arrayBuffer(){return`c.body=await c.request.arrayBuffer()
`},formData(isOptional){let fnLiteral=`
c.body={}
`;if(isOptional)fnLiteral+="let form;try{form=await c.request.formData()}catch{}";else fnLiteral+=`const form=await c.request.formData()
`;return fnLiteral+`for(const key of form.keys()){if(c.body[key]) continue
const value=form.getAll(key)
if(value.length===1)c.body[key]=value[0]
else c.body[key]=value}`}}},async stop(app,closeActiveConnections){if(!app.server)throw Error("Elysia isn't running. Call `app.listen` to start the server.");if(app.server){if(await app.server.stop(closeActiveConnections),app.server=null,app.event.stop?.length)for(let i=0;i<app.event.stop.length;i++)app.event.stop[i].fn(app)}},composeGeneralHandler:{parameters:"r",createContext(app){let decoratorsLiteral="",fnLiteral="",defaultHeaders=app.setHeaders;for(let key of Object.keys(app.decorator))decoratorsLiteral+=`,'${key}':decorator['${key}']`;let standardHostname=app.config.handler?.standardHostname??!0,hasTrace=!!app.event.trace?.length;if(fnLiteral+=`const u=r.url,s=u.indexOf('/',${standardHostname?11:7}),qi=u.indexOf('?',s+1),p=u.substring(s,qi===-1?undefined:qi)
`,hasTrace)fnLiteral+=`const id=randomId()
`;if(fnLiteral+="const c={request:r,store,qi,path:p,url:u,redirect,status,set:{headers:",fnLiteral+=Object.keys(defaultHeaders??{}).length?"Object.assign({},app.setHeaders)":"Object.create(null)",fnLiteral+=",status:200}",app.inference.server)fnLiteral+=",get server(){return app.getServer()}";if(hasTrace)fnLiteral+=",[ELYSIA_REQUEST_ID]:id";return fnLiteral+=decoratorsLiteral,fnLiteral+=`}
`,fnLiteral},error404(hasEventHook,hasErrorHook,afterHandle=""){let findDynamicRoute="if(route===null){"+afterHandle+(hasErrorHook?"":"c.set.status=404")+`
return `;if(hasErrorHook)findDynamicRoute+=`app.handleError(c,notFound,false,${this.parameters})`;else findDynamicRoute+=hasEventHook?"c.response=c.responseValue=new Response(error404Message,{status:c.set.status===200?404:c.set.status,headers:c.set.headers})":"c.response=c.responseValue=error404.clone()";return findDynamicRoute+="}",{declare:hasErrorHook?"":`const error404Message=notFound.message.toString()
const error404=new Response(error404Message,{status:404})
`,code:findDynamicRoute}}},composeError:{mapResponseContext:"",validationError:"set.headers['content-type']='application/json';return mapResponse(error.message,set)",unknownError:"set.status=error.status??set.status??500;return mapResponse(error.message,set)"},listen(){return()=>{throw Error("WebStandard does not support listen, you might want to export default Elysia.fetch instead")}}},import_fast_decode_uri_component3=__toESM2(require_fast_decode_uri_component(),1),import_fast_decode_uri_component2=__toESM2(require_fast_decode_uri_component(),1),KEY_HAS_PLUS=1,KEY_NEEDS_DECODE=2,VALUE_HAS_PLUS=4,VALUE_NEEDS_DECODE=8;function parseQueryFromURL(input,startIndex=0,array,object){let result=Object.create(null),flags=0,inputLength=input.length,startingIndex=startIndex-1,equalityIndex=startingIndex;for(let i=0;i<inputLength;i++)switch(input.charCodeAt(i)){case 38:processKeyValuePair(input,i),startingIndex=i,equalityIndex=i,flags=0;break;case 61:if(equalityIndex<=startingIndex)equalityIndex=i;else flags|=VALUE_NEEDS_DECODE;break;case 43:if(equalityIndex>startingIndex)flags|=VALUE_HAS_PLUS;else flags|=KEY_HAS_PLUS;break;case 37:if(equalityIndex>startingIndex)flags|=VALUE_NEEDS_DECODE;else flags|=KEY_NEEDS_DECODE;break}if(startingIndex<inputLength)processKeyValuePair(input,inputLength);return result;function processKeyValuePair(input2,endIndex){let hasBothKeyValuePair=equalityIndex>startingIndex,effectiveEqualityIndex=hasBothKeyValuePair?equalityIndex:endIndex,keySlice=input2.slice(startingIndex+1,effectiveEqualityIndex);if(!hasBothKeyValuePair&&keySlice.length===0)return;let finalKey=keySlice;if(flags&KEY_HAS_PLUS)finalKey=finalKey.replace(/\+/g," ");if(flags&KEY_NEEDS_DECODE)finalKey=import_fast_decode_uri_component2.default(finalKey)||finalKey;let finalValue="";if(hasBothKeyValuePair){let valueSlice=input2.slice(equalityIndex+1,endIndex);if(flags&VALUE_HAS_PLUS)valueSlice=valueSlice.replace(/\+/g," ");if(flags&VALUE_NEEDS_DECODE)valueSlice=import_fast_decode_uri_component2.default(valueSlice)||valueSlice;finalValue=valueSlice}let currentValue=result[finalKey];if(array&&array?.[finalKey])if(finalValue.charCodeAt(0)===91){if(object&&object?.[finalKey])finalValue=JSON.parse(finalValue);else finalValue=finalValue.slice(1,-1).split(",");if(currentValue===void 0)result[finalKey]=finalValue;else if(Array.isArray(currentValue))currentValue.push(...finalValue);else result[finalKey]=finalValue,result[finalKey].unshift(currentValue)}else if(currentValue===void 0)result[finalKey]=finalValue;else if(Array.isArray(currentValue))currentValue.push(finalValue);else result[finalKey]=[currentValue,finalValue];else result[finalKey]=finalValue}}function parseQueryStandardSchema(input,startIndex=0){let result=Object.create(null),flags=0,inputLength=input.length,startingIndex=startIndex-1,equalityIndex=startingIndex;for(let i=0;i<inputLength;i++)switch(input.charCodeAt(i)){case 38:processKeyValuePair(input,i),startingIndex=i,equalityIndex=i,flags=0;break;case 61:if(equalityIndex<=startingIndex)equalityIndex=i;else flags|=VALUE_NEEDS_DECODE;break;case 43:if(equalityIndex>startingIndex)flags|=VALUE_HAS_PLUS;else flags|=KEY_HAS_PLUS;break;case 37:if(equalityIndex>startingIndex)flags|=VALUE_NEEDS_DECODE;else flags|=KEY_NEEDS_DECODE;break}if(startingIndex<inputLength)processKeyValuePair(input,inputLength);return result;function processKeyValuePair(input2,endIndex){let hasBothKeyValuePair=equalityIndex>startingIndex,effectiveEqualityIndex=hasBothKeyValuePair?equalityIndex:endIndex,keySlice=input2.slice(startingIndex+1,effectiveEqualityIndex);if(!hasBothKeyValuePair&&keySlice.length===0)return;let finalKey=keySlice;if(flags&KEY_HAS_PLUS)finalKey=finalKey.replace(/\+/g," ");if(flags&KEY_NEEDS_DECODE)finalKey=import_fast_decode_uri_component2.default(finalKey)||finalKey;let finalValue="";if(hasBothKeyValuePair){let valueSlice=input2.slice(equalityIndex+1,endIndex);if(flags&VALUE_HAS_PLUS)valueSlice=valueSlice.replace(/\+/g," ");if(flags&VALUE_NEEDS_DECODE)valueSlice=import_fast_decode_uri_component2.default(valueSlice)||valueSlice;finalValue=valueSlice}let currentValue=result[finalKey];if(finalValue.charCodeAt(0)===91&&finalValue.charCodeAt(finalValue.length-1)===93){try{finalValue=JSON.parse(finalValue)}catch{}if(currentValue===void 0)result[finalKey]=finalValue;else if(Array.isArray(currentValue))currentValue.push(finalValue);else result[finalKey]=[currentValue,finalValue]}else if(finalValue.charCodeAt(0)===123&&finalValue.charCodeAt(finalValue.length-1)===125){try{finalValue=JSON.parse(finalValue)}catch{}if(currentValue===void 0)result[finalKey]=finalValue;else if(Array.isArray(currentValue))currentValue.push(finalValue);else result[finalKey]=[currentValue,finalValue]}else{if(finalValue.includes(","))finalValue=finalValue.split(",");if(currentValue===void 0)result[finalKey]=finalValue;else if(Array.isArray(currentValue))currentValue.push(finalValue);else result[finalKey]=[currentValue,finalValue]}}}function parseQuery(input){let result=Object.create(null),flags=0,inputLength=input.length,startingIndex=-1,equalityIndex=-1;for(let i=0;i<inputLength;i++)switch(input.charCodeAt(i)){case 38:processKeyValuePair(input,i),startingIndex=i,equalityIndex=i,flags=0;break;case 61:if(equalityIndex<=startingIndex)equalityIndex=i;else flags|=VALUE_NEEDS_DECODE;break;case 43:if(equalityIndex>startingIndex)flags|=VALUE_HAS_PLUS;else flags|=KEY_HAS_PLUS;break;case 37:if(equalityIndex>startingIndex)flags|=VALUE_NEEDS_DECODE;else flags|=KEY_NEEDS_DECODE;break}if(startingIndex<inputLength)processKeyValuePair(input,inputLength);return result;function processKeyValuePair(input2,endIndex){let hasBothKeyValuePair=equalityIndex>startingIndex,effectiveEqualityIndex=hasBothKeyValuePair?equalityIndex:endIndex,keySlice=input2.slice(startingIndex+1,effectiveEqualityIndex);if(!hasBothKeyValuePair&&keySlice.length===0)return;let finalKey=keySlice;if(flags&KEY_HAS_PLUS)finalKey=finalKey.replace(/\+/g," ");if(flags&KEY_NEEDS_DECODE)finalKey=import_fast_decode_uri_component2.default(finalKey)||finalKey;let finalValue="";if(hasBothKeyValuePair){let valueSlice=input2.slice(equalityIndex+1,endIndex);if(flags&VALUE_HAS_PLUS)valueSlice=valueSlice.replace(/\+/g," ");if(flags&VALUE_NEEDS_DECODE)valueSlice=import_fast_decode_uri_component2.default(valueSlice)||valueSlice;finalValue=valueSlice}let currentValue=result[finalKey];if(currentValue===void 0)result[finalKey]=finalValue;else if(Array.isArray(currentValue))currentValue.push(finalValue);else result[finalKey]=[currentValue,finalValue]}}var ELYSIA_TRACE=Symbol("ElysiaTrace"),createProcess=()=>{let{promise,resolve}=Promise.withResolvers(),{promise:end,resolve:resolveEnd}=Promise.withResolvers(),{promise:error,resolve:resolveError}=Promise.withResolvers(),callbacks=[],callbacksEnd=[];return[(callback)=>{if(callback)callbacks.push(callback);return promise},(process2)=>{let processes=[],resolvers=[],groupError=null;for(let i=0;i<(process2.total??0);i++){let{promise:promise2,resolve:resolve2}=Promise.withResolvers(),{promise:end2,resolve:resolveEnd2}=Promise.withResolvers(),{promise:error2,resolve:resolveError2}=Promise.withResolvers(),callbacks2=[],callbacksEnd2=[];processes.push((callback)=>{if(callback)callbacks2.push(callback);return promise2}),resolvers.push((process3)=>{let result2={...process3,end:end2,error:error2,index:i,onStop(callback){if(callback)callbacksEnd2.push(callback);return end2}};resolve2(result2);for(let i2=0;i2<callbacks2.length;i2++)callbacks2[i2](result2);return(error3=null)=>{let end3=performance.now();if(error3)groupError=error3;let detail={end:end3,error:error3,get elapsed(){return end3-process3.begin}};for(let i2=0;i2<callbacksEnd2.length;i2++)callbacksEnd2[i2](detail);resolveEnd2(end3),resolveError2(error3)}})}let result={...process2,end,error,onEvent(callback){for(let i=0;i<processes.length;i++)processes[i](callback)},onStop(callback){if(callback)callbacksEnd.push(callback);return end}};resolve(result);for(let i=0;i<callbacks.length;i++)callbacks[i](result);return{resolveChild:resolvers,resolve(error2=null){let end2=performance.now();if(!error2&&groupError)error2=groupError;let detail={end:end2,error:error2,get elapsed(){return end2-process2.begin}};for(let i=0;i<callbacksEnd.length;i++)callbacksEnd[i](detail);resolveEnd(end2),resolveError(error2)}}}]},createTracer=(traceListener)=>{return(context)=>{let[onRequest,resolveRequest]=createProcess(),[onParse,resolveParse]=createProcess(),[onTransform,resolveTransform]=createProcess(),[onBeforeHandle,resolveBeforeHandle]=createProcess(),[onHandle,resolveHandle]=createProcess(),[onAfterHandle,resolveAfterHandle]=createProcess(),[onError,resolveError]=createProcess(),[onMapResponse,resolveMapResponse]=createProcess(),[onAfterResponse,resolveAfterResponse]=createProcess();return traceListener({id:context[ELYSIA_REQUEST_ID],context,set:context.set,onRequest,onParse,onTransform,onBeforeHandle,onHandle,onAfterHandle,onMapResponse,onAfterResponse,onError,time:Date.now(),store:context.store}),{request:resolveRequest,parse:resolveParse,transform:resolveTransform,beforeHandle:resolveBeforeHandle,handle:resolveHandle,afterHandle:resolveAfterHandle,error:resolveError,mapResponse:resolveMapResponse,afterResponse:resolveAfterResponse}}},Kind3=Symbol.for("TypeBox.Kind"),Hint2=Symbol.for("TypeBox.Hint"),isSpecialProperty=(name)=>/(\ |-|\t|\n|\.|\[|\]|\{|\})/.test(name)||!isNaN(+name[0]),joinProperty=(v1,v2,isOptional=!1)=>{if(typeof v2==="number")return`${v1}[${v2}]`;if(isSpecialProperty(v2))return`${v1}${isOptional?"?.":""}["${v2}"]`;return`${v1}${isOptional?"?":""}.${v2}`},encodeProperty=(v)=>isSpecialProperty(v)?`"${v}"`:v,sanitize=(key,sanitize2=0,schema)=>{if(schema.type!=="string"||schema.const||schema.trusted)return key;let hof="";for(let i=sanitize2-1;i>=0;i--)hof+=`d.h${i}(`;return hof+key+")".repeat(sanitize2)},mergeObjectIntersection=(schema)=>{if(!schema.allOf||Kind3 in schema&&(schema[Kind3]!=="Intersect"||schema.type!=="object"))return schema;let{allOf,...newSchema}=schema;if(newSchema.properties={},Kind3 in newSchema)newSchema[Kind3]="Object";for(let type of allOf){if(type.type!=="object")continue;let{properties,required,type:_2,[Kind3]:__,...rest}=type;if(required)newSchema.required=newSchema.required?newSchema.required.concat(required):required;Object.assign(newSchema,rest);for(let property in type.properties)newSchema.properties[property]=mergeObjectIntersection(type.properties[property])}return newSchema},handleRecord=(schema,property,instruction)=>{let child=schema.patternProperties["^(.*)$"]??schema.patternProperties[Object.keys(schema.patternProperties)[0]];if(!child)return property;let i=instruction.array;instruction.array++;let v=`(()=>{const ar${i}s=Object.keys(${property}),ar${i}v={};for(let i=0;i<ar${i}s.length;i++){const ar${i}p=${property}[ar${i}s[i]];ar${i}v[ar${i}s[i]]=${mirror(child,`ar${i}p`,instruction)}`,optionals=instruction.optionalsInArray[i+1];if(optionals)for(let oi=0;oi<optionals.length;oi++){let target=`ar${i}v[ar${i}s[i]]${optionals[oi]}`;v+=`;if(${target}===undefined)delete ${target}`}return v+=`}return ar${i}v})()`,v},handleTuple=(schema,property,instruction)=>{let i=instruction.array;instruction.array++;let isRoot=property==="v"&&!instruction.unions.length,v="";if(!isRoot)v="(()=>{";v+=`const ar${i}v=[`;for(let i2=0;i2<schema.length;i2++){if(i2!==0)v+=",";v+=mirror(schema[i2],joinProperty(property,i2,instruction.parentIsOptional),instruction)}if(v+="];",!isRoot)v+=`return ar${i}v})()`;return v};function deepClone(source,weak=new WeakMap){if(source===null||typeof source!=="object"||typeof source==="function")return source;if(weak.has(source))return weak.get(source);if(Array.isArray(source)){let copy=Array(source.length);weak.set(source,copy);for(let i=0;i<source.length;i++)copy[i]=deepClone(source[i],weak);return copy}if(typeof source==="object"){let keys=Object.keys(source).concat(Object.getOwnPropertySymbols(source)),cloned={};for(let key of keys)cloned[key]=deepClone(source[key],weak);return cloned}return source}var handleUnion=(schemas,property,instruction)=>{if(instruction.TypeCompiler===void 0){if(!instruction.typeCompilerWanred)console.warn(Error("[exact-mirror] TypeBox's TypeCompiler is required to use Union")),instruction.typeCompilerWanred=!0;return property}instruction.unionKeys[property]=1;let ui=instruction.unions.length,typeChecks=instruction.unions[ui]=[],v=`(()=>{
`,unwrapRef=(type)=>{if(!(Kind3 in type)||!type.$ref)return type;if(type[Kind3]==="This")return deepClone(instruction.definitions[type.$ref]);else if(type[Kind3]==="Ref")if(!instruction.modules)console.warn(Error("[exact-mirror] modules is required when using nested cyclic reference"));else return instruction.modules.Import(type.$ref);return type},cleanThenCheck="";for(let i=0;i<schemas.length;i++){let type=unwrapRef(schemas[i]);if(Array.isArray(type.anyOf))for(let i2=0;i2<type.anyOf.length;i2++)type.anyOf[i2]=unwrapRef(type.anyOf[i2]);else if(type.items)if(Array.isArray(type.items))for(let i2=0;i2<type.items.length;i2++)type.items[i2]=unwrapRef(type.items[i2]);else type.items=unwrapRef(type.items);typeChecks.push(TypeCompiler.Compile(type)),v+=`if(d.unions[${ui}][${i}].Check(${property})){return ${mirror(type,property,{...instruction,recursion:instruction.recursion+1,parentIsOptional:!0})}}
`,cleanThenCheck+=(i?"":"let ")+"tmp="+mirror(type,property,{...instruction,recursion:instruction.recursion+1,parentIsOptional:!0})+`
if(d.unions[${ui}][${i}].Check(tmp))return tmp
`}if(cleanThenCheck)v+=cleanThenCheck;return v+=`return ${instruction.removeUnknownUnionType?"undefined":property}`,v+"})()"},mirror=(schema,property,instruction)=>{if(!schema)return"";let isRoot=property==="v"&&!instruction.unions.length;if(Kind3 in schema&&schema[Kind3]==="Import"&&schema.$ref in schema.$defs)return mirror(schema.$defs[schema.$ref],property,{...instruction,definitions:Object.assign(instruction.definitions,schema.$defs)});if(isRoot&&schema.type!=="object"&&schema.type!=="array"&&!schema.anyOf)return`return ${sanitize("v",instruction.sanitize?.length,schema)}`;if(instruction.recursion>=instruction.recursionLimit)return property;let v="";if(schema.$id&&Hint2 in schema)instruction.definitions[schema.$id]=schema;switch(schema.type){case"object":if(schema[Kind3]==="Record"){v=handleRecord(schema,property,instruction);break}if(schema=mergeObjectIntersection(schema),v+="{",schema.additionalProperties)v+=`...${property},`;let keys=Object.keys(schema.properties);for(let i2=0;i2<keys.length;i2++){let key=keys[i2],isOptional=!schema.required||schema.required&&!schema.required.includes(key)||Array.isArray(schema.properties[key].anyOf),name=joinProperty(property,key,instruction.parentIsOptional);if(isOptional){let index=instruction.array;if(property.startsWith("ar")){let dotIndex=name.indexOf("."),refName;if(dotIndex>=0)refName=name.slice(dotIndex);else refName=name.slice(property.length);if(refName.startsWith("?."))if(refName.charAt(2)==="[")refName=refName.slice(2);else refName=refName.slice(1);let array=instruction.optionalsInArray;if(array[index])array[index].push(refName);else array[index]=[refName]}else instruction.optionals.push(name)}let child=schema.properties[key];if(i2!==0)v+=",";v+=`${encodeProperty(key)}:${isOptional?`${name}===undefined?undefined:`:""}${mirror(child,name,{...instruction,recursion:instruction.recursion+1,parentIsOptional:isOptional})}`}v+="}";break;case"array":if(schema.items.type!=="object"&&schema.items.type!=="array"){if(Array.isArray(schema.items)){v=handleTuple(schema.items,property,instruction);break}else if(isRoot&&!Array.isArray(schema.items.anyOf))return"return v";else if(Kind3 in schema.items&&schema.items.$ref&&(schema.items[Kind3]==="Ref"||schema.items[Kind3]==="This"))v=mirror(deepClone(instruction.definitions[schema.items.$ref]),property,{...instruction,parentIsOptional:!0,recursion:instruction.recursion+1});else if(!Array.isArray(schema.items.anyOf)){v=property;break}}let i=instruction.array;instruction.array++;let reference=property;if(isRoot)v=`const ar${i}v=new Array(${property}.length);`;else reference=`ar${i}s`,v=`((${reference})=>{const ar${i}v=new Array(${reference}.length);`;v+=`for(let i=0;i<${reference}.length;i++){const ar${i}p=${reference}[i];ar${i}v[i]=${mirror(schema.items,`ar${i}p`,instruction)}`;let optionals=instruction.optionalsInArray[i+1];if(optionals)for(let oi=0;oi<optionals.length;oi++){let target=`ar${i}v[i]${optionals[oi]}`;v+=`;if(${target}===undefined)delete ${target}`}if(v+="}",!isRoot)v+=`return ar${i}v})(${property})`;break;default:if(schema.$ref&&schema.$ref in instruction.definitions)return mirror(instruction.definitions[schema.$ref],property,instruction);if(Array.isArray(schema.anyOf)){v=handleUnion(schema.anyOf,property,instruction);break}v=sanitize(property,instruction.sanitize?.length,schema);break}if(!isRoot)return v;if(schema.type==="array")v=`${v}const x=ar0v;`;else v=`const x=${v}
`;for(let i=0;i<instruction.optionals.length;i++){let key=instruction.optionals[i],prop=key.slice(1);if(v+=`if(${key}===undefined`,instruction.unionKeys[key])v+=`||x${prop}===undefined`;let shouldQuestion=prop.charCodeAt(0)!==63&&schema.type!=="array";v+=`)delete x${shouldQuestion?prop.charCodeAt(0)===91?"?.":"?":""}${prop}
`}return`${v}return x`},createMirror=(schema,{TypeCompiler:TypeCompiler22,modules,definitions,sanitize:sanitize2,recursionLimit=8,removeUnknownUnionType=!1}={})=>{let unions=[];if(typeof sanitize2==="function")sanitize2=[sanitize2];let f=mirror(schema,"v",{optionals:[],optionalsInArray:[],array:0,parentIsOptional:!1,unions,unionKeys:{},TypeCompiler:TypeCompiler22,modules,definitions:definitions??modules?.$defs??{},sanitize:sanitize2,recursion:0,recursionLimit,removeUnknownUnionType});if(!unions.length&&!sanitize2?.length)return Function("v",f);let hof;if(sanitize2?.length){hof={};for(let i=0;i<sanitize2.length;i++)hof[`h${i}`]=sanitize2[i]}return Function("d",`return function mirror(v){${f}}`)({unions,...hof})},replaceSchemaTypeFromManyOptions=(schema,options)=>{if(Array.isArray(options)){let result=schema;for(let option of options)result=replaceSchemaTypeFromOption(result,option);return result}return replaceSchemaTypeFromOption(schema,options)},replaceSchemaTypeFromOption=(schema,option)=>{if(option.rootOnly&&option.excludeRoot)throw Error("Can't set both rootOnly and excludeRoot");if(option.rootOnly&&option.onlyFirst)throw Error("Can't set both rootOnly and onlyFirst");if(option.rootOnly&&option.untilObjectFound)throw Error("Can't set both rootOnly and untilObjectFound");let walk=({s,isRoot,treeLvl})=>{if(!s)return s;let skipRoot=isRoot&&option.excludeRoot,fromKind=option.from[Kind];if(s.elysiaMeta){if(option.from.elysiaMeta===s.elysiaMeta&&!skipRoot)return option.to(s);return s}let shouldTransform=fromKind&&s[Kind]===fromKind;if(!skipRoot&&option.onlyFirst&&s.type===option.onlyFirst){if(shouldTransform)return option.to(s);return s}if(isRoot&&option.rootOnly){if(shouldTransform)return option.to(s);return s}if(!isRoot&&option.untilObjectFound&&s.type==="object")return s;let newWalkInput={isRoot:!1,treeLvl:treeLvl+1},withTransformedChildren={...s};if(s.oneOf)withTransformedChildren.oneOf=s.oneOf.map((x)=>walk({...newWalkInput,s:x}));if(s.anyOf)withTransformedChildren.anyOf=s.anyOf.map((x)=>walk({...newWalkInput,s:x}));if(s.allOf)withTransformedChildren.allOf=s.allOf.map((x)=>walk({...newWalkInput,s:x}));if(s.not)withTransformedChildren.not=walk({...newWalkInput,s:s.not});if(s.properties){withTransformedChildren.properties={};for(let[k2,v]of Object.entries(s.properties))withTransformedChildren.properties[k2]=walk({...newWalkInput,s:v})}if(s.items){let items=s.items;withTransformedChildren.items=Array.isArray(items)?items.map((x)=>walk({...newWalkInput,s:x})):walk({...newWalkInput,s:items})}if(!skipRoot&&fromKind&&withTransformedChildren[Kind]===fromKind)return option.to(withTransformedChildren);return withTransformedChildren};return walk({s:schema,isRoot:!0,treeLvl:0})},_stringToStructureCoercions,stringToStructureCoercions=()=>{if(!_stringToStructureCoercions)_stringToStructureCoercions=[{from:t.Object({}),to:(schema)=>t.ObjectString(schema.properties||{},schema),excludeRoot:!0},{from:t.Array(t.Any()),to:(schema)=>t.ArrayString(schema.items||t.Any(),schema)}];return _stringToStructureCoercions},_queryCoercions,queryCoercions=()=>{if(!_queryCoercions)_queryCoercions=[{from:t.Object({}),to:(schema)=>t.ObjectString(schema.properties??{},schema),excludeRoot:!0},{from:t.Array(t.Any()),to:(schema)=>t.ArrayQuery(schema.items??t.Any(),schema)}];return _queryCoercions},_coercePrimitiveRoot,coercePrimitiveRoot=()=>{if(!_coercePrimitiveRoot)_coercePrimitiveRoot=[{from:t.Number(),to:(schema)=>t.Numeric(schema),rootOnly:!0},{from:t.Boolean(),to:(schema)=>t.BooleanString(schema),rootOnly:!0}];return _coercePrimitiveRoot},_coerceFormData,coerceFormData=()=>{if(!_coerceFormData)_coerceFormData=[{from:t.Object({}),to:(schema)=>t.ObjectString(schema.properties??{},schema),onlyFirst:"object",excludeRoot:!0},{from:t.Array(t.Any()),to:(schema)=>t.ArrayString(schema.items??t.Any(),schema),onlyFirst:"array",excludeRoot:!0}];return _coerceFormData},isOptional=(schema)=>{if(!schema)return!1;if(schema?.[Kind]==="Import"&&schema.References)return schema.References().some(isOptional);if(schema.schema)schema=schema.schema;return!!schema&&OptionalKind in schema},hasAdditionalProperties=(_schema)=>{if(!_schema)return!1;let schema=_schema?.schema??_schema;if(schema[Kind]==="Import"&&_schema.References)return _schema.References().some(hasAdditionalProperties);if(schema.anyOf)return schema.anyOf.some(hasAdditionalProperties);if(schema.someOf)return schema.someOf.some(hasAdditionalProperties);if(schema.allOf)return schema.allOf.some(hasAdditionalProperties);if(schema.not)return schema.not.some(hasAdditionalProperties);if(schema.type==="object"){let properties=schema.properties;if("additionalProperties"in schema)return schema.additionalProperties;if("patternProperties"in schema)return!1;for(let key of Object.keys(properties)){let property=properties[key];if(property.type==="object"){if(hasAdditionalProperties(property))return!0}else if(property.anyOf){for(let i=0;i<property.anyOf.length;i++)if(hasAdditionalProperties(property.anyOf[i]))return!0}return property.additionalProperties}return!1}if(schema.type==="array"&&schema.items&&!Array.isArray(schema.items))return hasAdditionalProperties(schema.items);return!1},resolveSchema=(schema,models,modules)=>{if(!schema)return;if(typeof schema!=="string")return schema;if(modules&&schema in modules.$defs)return modules.Import(schema);return models?.[schema]},hasType=(type,schema)=>{if(!schema)return!1;if(Kind in schema&&schema[Kind]===type)return!0;if(Kind in schema&&schema[Kind]==="Import"){if(schema.$defs&&schema.$ref){let ref=schema.$ref.replace("#/$defs/","");if(schema.$defs[ref])return hasType(type,schema.$defs[ref])}}if(schema.anyOf)return schema.anyOf.some((s)=>hasType(type,s));if(schema.oneOf)return schema.oneOf.some((s)=>hasType(type,s));if(schema.allOf)return schema.allOf.some((s)=>hasType(type,s));if(schema.type==="array"&&schema.items){if(type==="Files"&&Kind in schema.items&&schema.items[Kind]==="File")return!0;return hasType(type,schema.items)}if(schema.type==="object"){let properties=schema.properties;if(!properties)return!1;for(let key of Object.keys(properties))if(hasType(type,properties[key]))return!0}return!1},hasElysiaMeta=(meta,_schema)=>{if(!_schema)return!1;let schema=_schema?.schema??_schema;if(schema.elysiaMeta===meta)return!0;if(schema[Kind]==="Import"&&_schema.References)return _schema.References().some((schema2)=>hasElysiaMeta(meta,schema2));if(schema.anyOf)return schema.anyOf.some((schema2)=>hasElysiaMeta(meta,schema2));if(schema.someOf)return schema.someOf.some((schema2)=>hasElysiaMeta(meta,schema2));if(schema.allOf)return schema.allOf.some((schema2)=>hasElysiaMeta(meta,schema2));if(schema.not)return schema.not.some((schema2)=>hasElysiaMeta(meta,schema2));if(schema.type==="object"){let properties=schema.properties;for(let key of Object.keys(properties)){let property=properties[key];if(property.type==="object"){if(hasElysiaMeta(meta,property))return!0}else if(property.anyOf){for(let i=0;i<property.anyOf.length;i++)if(hasElysiaMeta(meta,property.anyOf[i]))return!0}return schema.elysiaMeta===meta}return!1}if(schema.type==="array"&&schema.items&&!Array.isArray(schema.items))return hasElysiaMeta(meta,schema.items);return!1},hasProperty=(expectedProperty,_schema)=>{if(!_schema)return;let schema=_schema.schema??_schema;if(schema[Kind]==="Import"&&_schema.References)return _schema.References().some((schema2)=>hasProperty(expectedProperty,schema2));if(schema.type==="object"){let properties=schema.properties;if(!properties)return!1;for(let key of Object.keys(properties)){let property=properties[key];if(expectedProperty in property)return!0;if(property.type==="object"){if(hasProperty(expectedProperty,property))return!0}else if(property.anyOf){for(let i=0;i<property.anyOf.length;i++)if(hasProperty(expectedProperty,property.anyOf[i]))return!0}}return!1}return expectedProperty in schema},hasRef=(schema)=>{if(!schema)return!1;if(schema.oneOf){for(let i=0;i<schema.oneOf.length;i++)if(hasRef(schema.oneOf[i]))return!0}if(schema.anyOf){for(let i=0;i<schema.anyOf.length;i++)if(hasRef(schema.anyOf[i]))return!0}if(schema.oneOf){for(let i=0;i<schema.oneOf.length;i++)if(hasRef(schema.oneOf[i]))return!0}if(schema.allOf){for(let i=0;i<schema.allOf.length;i++)if(hasRef(schema.allOf[i]))return!0}if(schema.not&&hasRef(schema.not))return!0;if(schema.type==="object"&&schema.properties){let properties=schema.properties;for(let key of Object.keys(properties)){let property=properties[key];if(hasRef(property))return!0;if(property.type==="array"&&property.items&&hasRef(property.items))return!0}}if(schema.type==="array"&&schema.items&&hasRef(schema.items))return!0;return schema[Kind]==="Ref"&&"$ref"in schema},hasTransform=(schema)=>{if(!schema)return!1;if(schema.$ref&&schema.$defs&&schema.$ref in schema.$defs&&hasTransform(schema.$defs[schema.$ref]))return!0;if(schema.oneOf){for(let i=0;i<schema.oneOf.length;i++)if(hasTransform(schema.oneOf[i]))return!0}if(schema.anyOf){for(let i=0;i<schema.anyOf.length;i++)if(hasTransform(schema.anyOf[i]))return!0}if(schema.allOf){for(let i=0;i<schema.allOf.length;i++)if(hasTransform(schema.allOf[i]))return!0}if(schema.not&&hasTransform(schema.not))return!0;if(schema.type==="object"&&schema.properties){let properties=schema.properties;for(let key of Object.keys(properties)){let property=properties[key];if(hasTransform(property))return!0;if(property.type==="array"&&property.items&&hasTransform(property.items))return!0}}if(schema.type==="array"&&schema.items&&hasTransform(schema.items))return!0;return TransformKind in schema},createCleaner=(schema)=>(value)=>{if(typeof value==="object")try{return exports_value2.Clean(schema,value)}catch{}return value},getSchemaValidator=(s,{models={},dynamic=!1,modules,normalize=!1,additionalProperties=!1,forceAdditionalProperties=!1,coerce=!1,additionalCoerce=[],validators,sanitize:sanitize2}={})=>{if(validators=validators?.filter((x)=>x),!s){if(!validators?.length)return;s=validators[0],validators=validators.slice(1)}let doesHaveRef=void 0,replaceSchema=(schema2)=>{if(coerce)return replaceSchemaTypeFromManyOptions(schema2,[{from:t.Number(),to:(options)=>t.Numeric(options),untilObjectFound:!0},{from:t.Boolean(),to:(options)=>t.BooleanString(options),untilObjectFound:!0},...Array.isArray(additionalCoerce)?additionalCoerce:[additionalCoerce]]);return replaceSchemaTypeFromManyOptions(schema2,additionalCoerce)},mapSchema=(s2)=>{if(s2&&typeof s2!=="string"&&"~standard"in s2)return s2;if(!s2)return;let schema2;if(typeof s2!=="string")schema2=s2;else if(schema2=modules&&s2 in modules.$defs?modules.Import(s2):models[s2],!schema2)return;let hasAdditionalCoerce=Array.isArray(additionalCoerce)?additionalCoerce.length>0:!!additionalCoerce;if(Kind in schema2){if(schema2[Kind]==="Import"){if(!hasRef(schema2.$defs[schema2.$ref])){if(schema2=schema2.$defs[schema2.$ref],coerce||hasAdditionalCoerce){if(schema2=replaceSchema(schema2),"$id"in schema2&&!schema2.$defs)schema2.$id=`${schema2.$id}_coerced_${randomId()}`}}}else if(hasRef(schema2)){let id=randomId();schema2=t.Module({...modules?.$defs,[id]:schema2}).Import(id)}else if(coerce||hasAdditionalCoerce)schema2=replaceSchema(schema2)}return schema2},schema=mapSchema(s),_validators=validators;if("~standard"in schema||validators?.length&&validators.some((x)=>x&&typeof x!=="string"&&("~standard"in x))){let typeboxSubValidator=(schema2)=>{let mirror2;if(normalize===!0||normalize==="exactMirror")try{mirror2=createMirror(schema2,{TypeCompiler,sanitize:sanitize2?.(),modules})}catch{console.warn("Failed to create exactMirror. Please report the following code to https://github.com/elysiajs/elysia/issues"),console.warn(schema2),mirror2=createCleaner(schema2)}let vali=getSchemaValidator(schema2,{models,modules,dynamic,normalize,additionalProperties:!0,forceAdditionalProperties:!0,coerce,additionalCoerce});return vali.Decode=mirror2,(v)=>{if(vali.Check(v))return{value:vali.Decode(v)};else return{issues:[...vali.Errors(v)]}}},mainCheck=schema["~standard"]?schema["~standard"].validate:typeboxSubValidator(schema),checkers=[];if(validators?.length)for(let validator2 of validators){if(!validator2)continue;if(typeof validator2==="string")continue;if(validator2?.["~standard"]){checkers.push(validator2["~standard"]);continue}if(Kind in validator2){checkers.push(typeboxSubValidator(validator2));continue}}async function Check2(value){let v=mainCheck(value);if(v instanceof Promise)v=await v;if(v.issues)return v;let values=[];if(v&&typeof v==="object")values.push(v.value);for(let i=0;i<checkers.length;i++){if(v=checkers[i].validate(value),v instanceof Promise)v=await v;if(v.issues)return v;if(v&&typeof v==="object")values.push(v.value)}if(!values.length)return{value:v};if(values.length===1)return{value:values[0]};if(values.length===2)return{value:mergeDeep(values[0],values[1])};let newValue=mergeDeep(values[0],values[1]);for(let i=2;i<values.length;i++)newValue=mergeDeep(newValue,values[i]);return{value:newValue}}let validator={provider:"standard",schema,references:"",checkFunc:()=>{},code:"",Check:Check2,Errors:(value)=>Check2(value)?.then?.((x)=>x?.issues),Code:()=>"",Decode:Check2,Encode:(value)=>value,hasAdditionalProperties:!1,hasDefault:!1,isOptional:!1,hasTransform:!1,hasRef:!1};return validator.parse=(v)=>{try{return validator.Decode(validator.Clean?.(v)??v)}catch(error){throw[...validator.Errors(v)].map(mapValueError)}},validator.safeParse=(v)=>{try{return{success:!0,data:validator.Decode(validator.Clean?.(v)??v),error:null}}catch(error){let errors=[...compiled.Errors(v)].map(mapValueError);return{success:!1,data:null,error:errors[0]?.summary,errors}}},validator}else if(validators?.length){let hasAdditional=!1,validators2=_validators,{schema:mergedObjectSchema,notObjects}=mergeObjectSchemas([schema,...validators2.map(mapSchema)]);if(notObjects){if(schema=t.Intersect([...mergedObjectSchema?[mergedObjectSchema]:[],...notObjects.map((x)=>{let schema2=mapSchema(x);if(schema2.type==="object"&&"additionalProperties"in schema2){if(!hasAdditional&&schema2.additionalProperties===!1)hasAdditional=!0;delete schema2.additionalProperties}return schema2})]),schema.type==="object"&&hasAdditional)schema.additionalProperties=!1}}else if(schema.type==="object"&&(("additionalProperties"in schema)===!1||forceAdditionalProperties))schema.additionalProperties=additionalProperties;else schema=replaceSchemaTypeFromManyOptions(schema,{onlyFirst:"object",from:t.Object({}),to(schema2){if(!schema2.properties)return schema2;if("additionalProperties"in schema2)return schema2;return t.Object(schema2.properties,{...schema2,additionalProperties:!1})}});if(dynamic)if(Kind in schema){let validator={provider:"typebox",schema,references:"",checkFunc:()=>{},code:"",Check:(value)=>exports_value2.Check(schema,value),Errors:(value)=>exports_value2.Errors(schema,value),Code:()=>"",Clean:createCleaner(schema),Decode:(value)=>exports_value2.Decode(schema,value),Encode:(value)=>exports_value2.Encode(schema,value),get hasAdditionalProperties(){if("~hasAdditionalProperties"in this)return this["~hasAdditionalProperties"];return this["~hasAdditionalProperties"]=hasAdditionalProperties(schema)},get hasDefault(){if("~hasDefault"in this)return this["~hasDefault"];return this["~hasDefault"]=hasProperty("default",schema)},get isOptional(){if("~isOptional"in this)return this["~isOptional"];return this["~isOptional"]=isOptional(schema)},get hasTransform(){if("~hasTransform"in this)return this["~hasTransform"];return this["~hasTransform"]=hasTransform(schema)},"~hasRef":doesHaveRef,get hasRef(){if("~hasRef"in this)return this["~hasRef"];return this["~hasRef"]=hasTransform(schema)}};if(schema.config){if(validator.config=schema.config,validator?.schema?.config)delete validator.schema.config}if(normalize&&schema.additionalProperties===!1)if(normalize===!0||normalize==="exactMirror")try{validator.Clean=createMirror(schema,{TypeCompiler,sanitize:sanitize2?.(),modules})}catch{console.warn("Failed to create exactMirror. Please report the following code to https://github.com/elysiajs/elysia/issues"),console.warn(schema),validator.Clean=createCleaner(schema)}else validator.Clean=createCleaner(schema);return validator.parse=(v)=>{try{return validator.Decode(validator.Clean?.(v)??v)}catch(error){throw[...validator.Errors(v)].map(mapValueError)}},validator.safeParse=(v)=>{try{return{success:!0,data:validator.Decode(validator.Clean?.(v)??v),error:null}}catch(error){let errors=[...compiled.Errors(v)].map(mapValueError);return{success:!1,data:null,error:errors[0]?.summary,errors}}},validator}else{let validator={provider:"standard",schema,references:"",checkFunc:()=>{},code:"",Check:(v)=>schema["~standard"].validate(v),Errors(value){let response=schema["~standard"].validate(value);if(response instanceof Promise)throw Error("Async validation is not supported in non-dynamic schema");return response.issues},Code:()=>"",Decode(value){let response=schema["~standard"].validate(value);if(response instanceof Promise)throw Error("Async validation is not supported in non-dynamic schema");return response},Encode:(value)=>value,hasAdditionalProperties:!1,hasDefault:!1,isOptional:!1,hasTransform:!1,hasRef:!1};return validator.parse=(v)=>{try{return validator.Decode(validator.Clean?.(v)??v)}catch(error){throw[...validator.Errors(v)].map(mapValueError)}},validator.safeParse=(v)=>{try{return{success:!0,data:validator.Decode(validator.Clean?.(v)??v),error:null}}catch(error){let errors=[...compiled.Errors(v)].map(mapValueError);return{success:!1,data:null,error:errors[0]?.summary,errors}}},validator}let compiled;if(Kind in schema){if(compiled=TypeCompiler.Compile(schema,Object.values(models).filter((x)=>(Kind in x))),compiled.provider="typebox",schema.config){if(compiled.config=schema.config,compiled?.schema?.config)delete compiled.schema.config}if(normalize===!0||normalize==="exactMirror")try{compiled.Clean=createMirror(schema,{TypeCompiler,sanitize:sanitize2?.(),modules})}catch(error){console.warn("Failed to create exactMirror. Please report the following code to https://github.com/elysiajs/elysia/issues"),console.dir(schema,{depth:null}),compiled.Clean=createCleaner(schema)}else if(normalize==="typebox")compiled.Clean=createCleaner(schema)}else compiled={provider:"standard",schema,references:"",checkFunc(value){let response=schema["~standard"].validate(value);if(response instanceof Promise)throw Error("Async validation is not supported in non-dynamic schema");return response},code:"",Check:(v)=>schema["~standard"].validate(v),Errors(value){let response=schema["~standard"].validate(value);if(response instanceof Promise)throw Error("Async validation is not supported in non-dynamic schema");return response.issues},Code:()=>"",Decode(value){let response=schema["~standard"].validate(value);if(response instanceof Promise)throw Error("Async validation is not supported in non-dynamic schema");return response},Encode:(value)=>value,hasAdditionalProperties:!1,hasDefault:!1,isOptional:!1,hasTransform:!1,hasRef:!1};if(compiled.parse=(v)=>{try{return compiled.Decode(compiled.Clean?.(v)??v)}catch(error){throw[...compiled.Errors(v)].map(mapValueError)}},compiled.safeParse=(v)=>{try{return{success:!0,data:compiled.Decode(compiled.Clean?.(v)??v),error:null}}catch(error){let errors=[...compiled.Errors(v)].map(mapValueError);return{success:!1,data:null,error:errors[0]?.summary,errors}}},Kind in schema)Object.assign(compiled,{get hasAdditionalProperties(){if("~hasAdditionalProperties"in this)return this["~hasAdditionalProperties"];return this["~hasAdditionalProperties"]=hasAdditionalProperties(compiled)},get hasDefault(){if("~hasDefault"in this)return this["~hasDefault"];return this["~hasDefault"]=hasProperty("default",compiled)},get isOptional(){if("~isOptional"in this)return this["~isOptional"];return this["~isOptional"]=isOptional(compiled)},get hasTransform(){if("~hasTransform"in this)return this["~hasTransform"];return this["~hasTransform"]=hasTransform(schema)},get hasRef(){if("~hasRef"in this)return this["~hasRef"];return this["~hasRef"]=hasRef(schema)},"~hasRef":doesHaveRef});return compiled},isUnion=(schema)=>schema[Kind]==="Union"||!schema.schema&&!!schema.anyOf,mergeObjectSchemas=(schemas)=>{if(schemas.length===0)return{schema:void 0,notObjects:[]};if(schemas.length===1)return schemas[0].type==="object"?{schema:schemas[0],notObjects:[]}:{schema:void 0,notObjects:schemas};let newSchema,notObjects=[],additionalPropertiesIsTrue=!1,additionalPropertiesIsFalse=!1;for(let schema of schemas){if(schema.type!=="object"){notObjects.push(schema);continue}if("additionalProperties"in schema){if(schema.additionalProperties===!0)additionalPropertiesIsTrue=!0;else if(schema.additionalProperties===!1)additionalPropertiesIsFalse=!0}if(!newSchema){newSchema=schema;continue}newSchema={...newSchema,...schema,properties:{...newSchema.properties,...schema.properties},required:[...newSchema?.required??[],...schema.required??[]]}}if(newSchema){if(newSchema.required)newSchema.required=[...new Set(newSchema.required)];if(additionalPropertiesIsFalse)newSchema.additionalProperties=!1;else if(additionalPropertiesIsTrue)newSchema.additionalProperties=!0}return{schema:newSchema,notObjects}},getResponseSchemaValidator=(s,{models={},modules,dynamic=!1,normalize=!1,additionalProperties=!1,validators=[],sanitize:sanitize2})=>{if(validators=validators.filter((x)=>x),!s){if(!validators?.length)return;s=validators[0],validators=validators.slice(1)}let maybeSchemaOrRecord;if(typeof s!=="string")maybeSchemaOrRecord=s;else if(maybeSchemaOrRecord=modules&&s in modules.$defs?modules.Import(s):models[s],!maybeSchemaOrRecord)return;if(!maybeSchemaOrRecord)return;if(Kind in maybeSchemaOrRecord||"~standard"in maybeSchemaOrRecord)return{200:getSchemaValidator(maybeSchemaOrRecord,{modules,models,additionalProperties,dynamic,normalize,coerce:!1,additionalCoerce:[],validators:validators.map((x)=>x[200]),sanitize:sanitize2})};let record={};return Object.keys(maybeSchemaOrRecord).forEach((status2)=>{if(isNaN(+status2))return;let maybeNameOrSchema=maybeSchemaOrRecord[+status2];if(typeof maybeNameOrSchema==="string"){if(maybeNameOrSchema in models){let schema=models[maybeNameOrSchema];if(!schema)return;record[+status2]=Kind in schema||"~standard"in schema?getSchemaValidator(schema,{modules,models,additionalProperties,dynamic,normalize,coerce:!1,additionalCoerce:[],validators:validators.map((x)=>x[+status2]),sanitize:sanitize2}):schema}return}record[+status2]=Kind in maybeNameOrSchema||"~standard"in maybeNameOrSchema?getSchemaValidator(maybeNameOrSchema,{modules,models,additionalProperties,dynamic,normalize,coerce:!1,additionalCoerce:[],validators:validators.map((x)=>x[+status2]),sanitize:sanitize2}):maybeNameOrSchema}),record},getCookieValidator=({validator,modules,defaultConfig={},config,dynamic,normalize=!1,models,validators,sanitize:sanitize2})=>{let cookieValidator=validator?.provider?validator:getSchemaValidator(validator,{modules,dynamic,models,normalize,additionalProperties:!0,coerce:!0,additionalCoerce:stringToStructureCoercions(),validators,sanitize:sanitize2});if(cookieValidator)cookieValidator.config=mergeCookie(cookieValidator.config,config);else cookieValidator=getSchemaValidator(t.Cookie(t.Any()),{modules,dynamic,models,additionalProperties:!0,validators,sanitize:sanitize2}),cookieValidator.config=defaultConfig;return cookieValidator},unwrapImportSchema=(schema)=>schema&&schema[Kind]==="Import"&&schema.$defs[schema.$ref][Kind]==="Object"?schema.$defs[schema.$ref]:schema,allocateIf=(value,condition)=>condition?value:"",defaultParsers=["json","text","urlencoded","arrayBuffer","formdata","application/json","text/plain","application/x-www-form-urlencoded","application/octet-stream","multipart/form-data"],createReport=({context="c",trace=[],addFn})=>{if(!trace.length)return()=>{return{resolveChild(){return()=>{}},resolve(){}}};for(let i=0;i<trace.length;i++)addFn(`let report${i},reportChild${i},reportErr${i},reportErrChild${i};let trace${i}=${context}[ELYSIA_TRACE]?.[${i}]??trace[${i}](${context});
`);return(event,{name,total=0,alias}={})=>{if(!name)name="anonymous";let reporter=event==="error"?"reportErr":"report";for(let i=0;i<trace.length;i++)if(addFn(`${alias?"const ":""}${alias??reporter}${i}=trace${i}.${event}({id,event:'${event}',name:'${name}',begin:performance.now(),total:${total}})
`),alias)addFn(`${reporter}${i}=${alias}${i}
`);return{resolve(){for(let i=0;i<trace.length;i++)addFn(`${alias??reporter}${i}.resolve()
`)},resolveChild(name2){for(let i=0;i<trace.length;i++)addFn(`${reporter}Child${i}=${reporter}${i}.resolveChild?.shift()?.({id,event:'${event}',name:'${name2}',begin:performance.now()})
`);return(binding)=>{for(let i=0;i<trace.length;i++)if(binding)addFn(`if(${binding} instanceof Error){${reporter}Child${i}?.(${binding}) }else{${reporter}Child${i}?.()}`);else addFn(`${reporter}Child${i}?.()
`)}}}}},composeCleaner=({schema,name,type,typeAlias=type,normalize,ignoreTryCatch=!1})=>{if(!normalize||!schema.Clean)return"";if(normalize===!0||normalize==="exactMirror"){if(ignoreTryCatch)return`${name}=validator.${typeAlias}.Clean(${name})
`;return`try{${name}=validator.${typeAlias}.Clean(${name})
}catch{}`}if(normalize==="typebox")return`${name}=validator.${typeAlias}.Clean(${name})
`;return""},composeValidationFactory=({injectResponse="",normalize=!1,validator,encodeSchema=!1,isStaticResponse=!1,hasSanitize=!1,allowUnsafeValidationDetails=!1})=>({validate:(type,value=`c.${type}`,error)=>`c.set.status=422;throw new ValidationError('${type}',validator.${type},${value},${allowUnsafeValidationDetails}${error?","+error:""})`,response:(name="r")=>{if(isStaticResponse||!validator.response)return"";let code=injectResponse+`
`;code+=`if(${name} instanceof ElysiaCustomStatusResponse){c.set.status=${name}.code
${name}=${name}.response}if(${name} instanceof Response === false && typeof ${name}?.next !== 'function' && !(${name} instanceof ReadableStream))switch(c.set.status){`;for(let[status2,value]of Object.entries(validator.response)){if(code+=`
case ${status2}:
`,value.provider==="standard"){code+=`let vare${status2}=validator.response[${status2}].Check(${name})
if(vare${status2} instanceof Promise)vare${status2}=await vare${status2}
if(vare${status2}.issues)throw new ValidationError('response',validator.response[${status2}],${name},${allowUnsafeValidationDetails},vare${status2}.issues)
${name}=vare${status2}.value
c.set.status=${status2}
break
`;continue}let noValidate=value.schema?.noValidate===!0;if(!noValidate&&value.schema?.$ref&&value.schema?.$defs){let refKey=value.schema.$ref,defKey=typeof refKey==="string"&&refKey.includes("/")?refKey.split("/").pop():refKey;if(value.schema.$defs[defKey]?.noValidate===!0)noValidate=!0}let appliedCleaner=noValidate||hasSanitize,clean2=({ignoreTryCatch=!1}={})=>composeCleaner({name,schema:value,type:"response",typeAlias:`response[${status2}]`,normalize,ignoreTryCatch});if(appliedCleaner)code+=clean2();let applyErrorCleaner=!appliedCleaner&&normalize&&!noValidate;if(encodeSchema&&value.hasTransform&&!noValidate){if(code+=`try{${name}=validator.response[${status2}].Encode(${name})
`,!appliedCleaner)code+=clean2({ignoreTryCatch:!0});code+=`c.set.status=${status2}}catch{`+(applyErrorCleaner?`try{
`+clean2({ignoreTryCatch:!0})+`${name}=validator.response[${status2}].Encode(${name})
}catch{throw new ValidationError('response',validator.response[${status2}],${name},${allowUnsafeValidationDetails})}`:`throw new ValidationError('response',validator.response[${status2}],${name}),${allowUnsafeValidationDetails}`)+"}"}else{if(!appliedCleaner)code+=clean2();if(!noValidate)code+=`if(validator.response[${status2}].Check(${name})===false)throw new ValidationError('response',validator.response[${status2}],${name},${allowUnsafeValidationDetails})
c.set.status=${status2}
`}code+=`break
`}return code+"}"}}),isAsyncName=(v)=>{return(v?.fn??v).constructor.name==="AsyncFunction"},matchResponseClone=/=>\s?response\.clone\(/,matchFnReturn=/(?:return|=>)\s?\S+\(|a(?:sync|wait)/,isAsync=(v)=>{let isObject2=typeof v==="object";if(isObject2&&v.isAsync!==void 0)return v.isAsync;let fn=isObject2?v.fn:v;if(fn.constructor.name==="AsyncFunction")return!0;let literal=fn.toString();if(matchResponseClone.test(literal)){if(isObject2)v.isAsync=!1;return!1}let result=matchFnReturn.test(literal);if(isObject2)v.isAsync=result;return result},hasReturn=(v)=>{let isObject2=typeof v==="object";if(isObject2&&v.hasReturn!==void 0)return v.hasReturn;let fnLiteral=isObject2?v.fn.toString():typeof v==="string"?v.toString():v,parenthesisEnd=fnLiteral.indexOf(")");if(fnLiteral.charCodeAt(parenthesisEnd+2)===61&&fnLiteral.charCodeAt(parenthesisEnd+5)!==123){if(isObject2)v.hasReturn=!0;return!0}let result=fnLiteral.includes("return");if(isObject2)v.hasReturn=result;return result},isGenerator=(v)=>{let fn=v?.fn??v;return fn.constructor.name==="AsyncGeneratorFunction"||fn.constructor.name==="GeneratorFunction"},coerceTransformDecodeError=(fnLiteral,type,allowUnsafeValidationDetails=!1,value=`c.${type}`)=>`try{${fnLiteral}}catch(error){if(error.constructor.name === 'TransformDecodeError'){c.set.status=422
throw error.error ?? new ValidationError('${type}',validator.${type},${value},${allowUnsafeValidationDetails})}}`,setImmediateFn=hasSetImmediate?"setImmediate":"Promise.resolve().then",composeHandler=({app,path,method,hooks,validator,handler,allowMeta=!1,inference})=>{let adapter=app["~adapter"].composeHandler,adapterHandler=app["~adapter"].handler,isHandleFn=typeof handler==="function";if(!isHandleFn){handler=adapterHandler.mapResponse(handler,{headers:app.setHeaders??{}});let isResponse=handler instanceof Response||handler?.constructor?.name==="Response"&&typeof handler?.clone==="function";if(hooks.parse?.length&&hooks.transform?.length&&hooks.beforeHandle?.length&&hooks.afterHandle?.length){if(isResponse)return Function("a",`"use strict";
return function(){return a.clone()}`)(handler);return Function("a",`"use strict";
return function(){return a}`)(handler)}if(isResponse){let response=handler;handler=()=>response.clone()}}let handle=isHandleFn?"handler(c)":"handler",hasTrace=!!hooks.trace?.length,fnLiteral="";if(inference=sucrose(Object.assign({handler},hooks),inference,app.config.sucrose),adapter.declare){let literal=adapter.declare(inference);if(literal)fnLiteral+=literal}if(inference.server)fnLiteral+=`Object.defineProperty(c,'server',{get:function(){return getServer()}})
`;validator.createBody?.(),validator.createQuery?.(),validator.createHeaders?.(),validator.createParams?.(),validator.createCookie?.(),validator.createResponse?.();let hasValidation=!!validator.body||!!validator.headers||!!validator.params||!!validator.query||!!validator.cookie||!!validator.response,hasQuery=inference.query||!!validator.query,requestNoBody=hooks.parse?.length===1&&hooks.parse[0].fn==="none",hasBody=method!==""&&method!=="GET"&&method!=="HEAD"&&(inference.body||!!validator.body||!!hooks.parse?.length)&&!requestNoBody,defaultHeaders=app.setHeaders,hasDefaultHeaders=defaultHeaders&&!!Object.keys(defaultHeaders).length,hasHeaders=inference.headers||!!validator.headers||adapter.preferWebstandardHeaders!==!0&&inference.body,hasCookie=inference.cookie||!!validator.cookie,cookieMeta=validator.cookie?.config?mergeCookie(validator?.cookie?.config,app.config.cookie):app.config.cookie,_encodeCookie="",encodeCookie=()=>{if(_encodeCookie)return _encodeCookie;if(cookieMeta?.sign){if(!cookieMeta.secrets)throw Error(`t.Cookie required secret which is not set in (${method}) ${path}.`);let secret=!cookieMeta.secrets?void 0:typeof cookieMeta.secrets==="string"?cookieMeta.secrets:cookieMeta.secrets[0];if(_encodeCookie+=`const _setCookie = c.set.cookie
if(_setCookie){`,cookieMeta.sign===!0)_encodeCookie+=`for(const [key, cookie] of Object.entries(_setCookie)){c.set.cookie[key].value=await signCookie(cookie.value,${!secret?"undefined":JSON.stringify(secret)})}`;else{if(typeof cookieMeta.sign==="string")cookieMeta.sign=[cookieMeta.sign];for(let name of cookieMeta.sign)_encodeCookie+=`if(_setCookie[${JSON.stringify(name)}]?.value)c.set.cookie[${JSON.stringify(name)}].value=await signCookie(_setCookie[${JSON.stringify(name)}].value,${!secret?"undefined":JSON.stringify(secret)})
`}_encodeCookie+=`}
`}return _encodeCookie},normalize=app.config.normalize,encodeSchema=app.config.encodeSchema,allowUnsafeValidationDetails=app.config.allowUnsafeValidationDetails,validation=composeValidationFactory({normalize,validator,encodeSchema,isStaticResponse:handler instanceof Response,hasSanitize:!!app.config.sanitize,allowUnsafeValidationDetails});if(hasHeaders)fnLiteral+=adapter.headers;if(hasTrace)fnLiteral+=`const id=c[ELYSIA_REQUEST_ID]
`;let report=createReport({trace:hooks.trace,addFn:(word)=>{fnLiteral+=word}});if(fnLiteral+="try{",hasCookie){let get=(name,defaultValue)=>{let value=cookieMeta?.[name]??defaultValue;if(value===void 0)return"";if(!value)return typeof defaultValue==="string"?`${name}:"${defaultValue}",`:`${name}:${defaultValue},`;if(typeof value==="string")return`${name}:${JSON.stringify(value)},`;if(value instanceof Date)return`${name}: new Date(${value.getTime()}),`;return`${name}:${value},`},options=cookieMeta?`{secrets:${cookieMeta.secrets!==void 0?typeof cookieMeta.secrets==="string"?JSON.stringify(cookieMeta.secrets):"["+cookieMeta.secrets.map((x)=>JSON.stringify(x)).join(",")+"]":"undefined"},sign:${cookieMeta.sign===!0?!0:cookieMeta.sign!==void 0?typeof cookieMeta.sign==="string"?JSON.stringify(cookieMeta.sign):"["+cookieMeta.sign.map((x)=>JSON.stringify(x)).join(",")+"]":"undefined"},`+get("domain")+get("expires")+get("httpOnly")+get("maxAge")+get("path","/")+get("priority")+get("sameSite")+get("secure")+"}":"undefined";if(hasHeaders)fnLiteral+=`
c.cookie=await parseCookie(c.set,c.headers.cookie,${options})
`;else fnLiteral+=`
c.cookie=await parseCookie(c.set,c.request.headers.get('cookie'),${options})
`}if(hasQuery){let arrayProperties={},objectProperties={},hasArrayProperty=!1,hasObjectProperty=!1;if(validator.query?.schema){let schema=unwrapImportSchema(validator.query?.schema);if(Kind in schema&&schema.properties)for(let[key,value]of Object.entries(schema.properties)){if(hasElysiaMeta("ArrayQuery",value))arrayProperties[key]=!0,hasArrayProperty=!0;if(hasElysiaMeta("ObjectString",value))objectProperties[key]=!0,hasObjectProperty=!0}}fnLiteral+=`if(c.qi===-1){c.query=Object.create(null)}else{c.query=parseQueryFromURL(c.url,c.qi+1${hasArrayProperty?","+JSON.stringify(arrayProperties):hasObjectProperty?",undefined":""}${hasObjectProperty?","+JSON.stringify(objectProperties):""})}`}let isAsyncHandler=typeof handler==="function"&&isAsync(handler),saveResponse=hasTrace||hooks.afterResponse?.length?"c.response=c.responseValue= ":"",responseKeys=Object.keys(validator.response??{}),hasMultipleResponses=responseKeys.length>1,hasSingle200=responseKeys.length===0||responseKeys.length===1&&responseKeys[0]==="200",maybeAsync=hasCookie||hasBody||isAsyncHandler||!!hooks.parse?.length||!!hooks.afterHandle?.some(isAsync)||!!hooks.beforeHandle?.some(isAsync)||!!hooks.transform?.some(isAsync)||!!hooks.mapResponse?.some(isAsync)||validator.body?.provider==="standard"||validator.headers?.provider==="standard"||validator.query?.provider==="standard"||validator.params?.provider==="standard"||validator.cookie?.provider==="standard"||Object.values(validator.response??{}).find((x)=>x.provider==="standard"),maybeStream=(typeof handler==="function"?isGenerator(handler):!1)||!!hooks.beforeHandle?.some(isGenerator)||!!hooks.afterHandle?.some(isGenerator)||!!hooks.transform?.some(isGenerator),hasSet=inference.cookie||inference.set||hasHeaders||hasTrace||hasMultipleResponses||!hasSingle200||isHandleFn&&hasDefaultHeaders||maybeStream,_afterResponse,afterResponse=(hasStream=!0)=>{if(_afterResponse!==void 0)return _afterResponse;if(!hooks.afterResponse?.length&&!hasTrace)return"";let afterResponse2="";afterResponse2+=`
${setImmediateFn}(async()=>{if(c.responseValue){if(c.responseValue instanceof ElysiaCustomStatusResponse) c.set.status=c.responseValue.code
`+(hasStream?`if(typeof afterHandlerStreamListener!=='undefined')for await(const v of afterHandlerStreamListener){}
`:"")+`}
`;let reporter=createReport({trace:hooks.trace,addFn:(word)=>{afterResponse2+=word}})("afterResponse",{total:hooks.afterResponse?.length});if(hooks.afterResponse?.length&&hooks.afterResponse)for(let i=0;i<hooks.afterResponse.length;i++){let endUnit=reporter.resolveChild(hooks.afterResponse[i].fn.name),prefix=isAsync(hooks.afterResponse[i])?"await ":"";afterResponse2+=`
${prefix}e.afterResponse[${i}](c)
`,endUnit()}return reporter.resolve(),afterResponse2+=`})
`,_afterResponse=afterResponse2},mapResponse2=(r="r")=>{let after=afterResponse(),response=`${hasSet?"mapResponse":"mapCompactResponse"}(${saveResponse}${r}${hasSet?",c.set":""}${mapResponseContext})
`;if(!after)return`return ${response}`;return`const _res=${response}`+after+"return _res"},mapResponseContext=maybeStream&&adapter.mapResponseContext?`,${adapter.mapResponseContext}`:"";if(hasTrace||inference.route)fnLiteral+=`c.route=\`${path}\`
`;if(hasTrace||hooks.afterResponse?.length)fnLiteral+=`let afterHandlerStreamListener
`;let parseReporter=report("parse",{total:hooks.parse?.length});if(hasBody){let hasBodyInference=!!hooks.parse?.length||inference.body||validator.body;if(adapter.parser.declare)fnLiteral+=adapter.parser.declare;fnLiteral+=`
try{`;let parser=typeof hooks.parse==="string"?hooks.parse:Array.isArray(hooks.parse)&&hooks.parse.length===1?typeof hooks.parse[0]==="string"?hooks.parse[0]:typeof hooks.parse[0].fn==="string"?hooks.parse[0].fn:void 0:void 0;if(!parser&&validator.body&&!hooks.parse?.length){let schema=validator.body.schema;if(schema&&schema.anyOf&&schema[Kind]==="Union"&&schema.anyOf?.length===2&&schema.anyOf?.find((x)=>x[Kind]==="ElysiaForm"))parser="formdata"}if(parser&&defaultParsers.includes(parser)){let reporter=report("parse",{total:hooks.parse?.length}),isOptionalBody=!!validator.body?.isOptional;switch(parser){case"json":case"application/json":fnLiteral+=adapter.parser.json(isOptionalBody);break;case"text":case"text/plain":fnLiteral+=adapter.parser.text(isOptionalBody);break;case"urlencoded":case"application/x-www-form-urlencoded":fnLiteral+=adapter.parser.urlencoded(isOptionalBody);break;case"arrayBuffer":case"application/octet-stream":fnLiteral+=adapter.parser.arrayBuffer(isOptionalBody);break;case"formdata":case"multipart/form-data":fnLiteral+=adapter.parser.formData(isOptionalBody);break;default:if(parser[0]in app["~parser"])fnLiteral+=hasHeaders?"let contentType = c.headers['content-type']":"let contentType = c.request.headers.get('content-type')",fnLiteral+=`
if(contentType){const index=contentType.indexOf(';')
if(index!==-1)contentType=contentType.substring(0,index)}
else{contentType=''}c.contentType=contentType
let result=parser['${parser}'](c, contentType)
if(result instanceof Promise)result=await result
if(result instanceof ElysiaCustomStatusResponse)throw result
if(result!==undefined)c.body=result
delete c.contentType
`;break}reporter.resolve()}else if(hasBodyInference){fnLiteral+=`
`,fnLiteral+=`let contentType
if(c.request.body)`,fnLiteral+=hasHeaders?`contentType=c.headers['content-type']
`:`contentType=c.request.headers.get('content-type')
`;let hasDefaultParser=!1;if(hooks.parse?.length)fnLiteral+=`if(contentType){
const index=contentType.indexOf(';')

if(index!==-1)contentType=contentType.substring(0,index)}else{contentType=''}let used=false
c.contentType=contentType
`;else{hasDefaultParser=!0;let isOptionalBody=!!validator.body?.isOptional;fnLiteral+=`if(contentType)switch(contentType.charCodeAt(12)){
case 106:`+adapter.parser.json(isOptionalBody)+`break
case 120:`+adapter.parser.urlencoded(isOptionalBody)+`break
case 111:`+adapter.parser.arrayBuffer(isOptionalBody)+`break
case 114:`+adapter.parser.formData(isOptionalBody)+`break
default:if(contentType.charCodeAt(0)===116){`+adapter.parser.text(isOptionalBody)+`}break
}`}let reporter=report("parse",{total:hooks.parse?.length});if(hooks.parse)for(let i=0;i<hooks.parse.length;i++){let name=`bo${i}`;if(i!==0)fnLiteral+=`
if(!used){`;if(typeof hooks.parse[i].fn==="string"){let endUnit=reporter.resolveChild(hooks.parse[i].fn),isOptionalBody=!!validator.body?.isOptional;switch(hooks.parse[i].fn){case"json":case"application/json":hasDefaultParser=!0,fnLiteral+=adapter.parser.json(isOptionalBody);break;case"text":case"text/plain":hasDefaultParser=!0,fnLiteral+=adapter.parser.text(isOptionalBody);break;case"urlencoded":case"application/x-www-form-urlencoded":hasDefaultParser=!0,fnLiteral+=adapter.parser.urlencoded(isOptionalBody);break;case"arrayBuffer":case"application/octet-stream":hasDefaultParser=!0,fnLiteral+=adapter.parser.arrayBuffer(isOptionalBody);break;case"formdata":case"multipart/form-data":hasDefaultParser=!0,fnLiteral+=adapter.parser.formData(isOptionalBody);break;default:fnLiteral+=`let ${name}=parser['${hooks.parse[i].fn}'](c,contentType)
if(${name} instanceof Promise)${name}=await ${name}
if(${name}!==undefined){c.body=${name};used=true;}
`}endUnit()}else{let endUnit=reporter.resolveChild(hooks.parse[i].fn.name);fnLiteral+=`let ${name}=e.parse[${i}]
${name}=${name}(c,contentType)
if(${name} instanceof Promise)${name}=await ${name}
if(${name}!==undefined){c.body=${name};used=true}`,endUnit()}if(i!==0)fnLiteral+="}";if(hasDefaultParser)break}if(reporter.resolve(),!hasDefaultParser){let isOptionalBody=!!validator.body?.isOptional;if(hooks.parse?.length)fnLiteral+=`
if(!used){
`;fnLiteral+=`switch(contentType){case 'application/json':
`+adapter.parser.json(isOptionalBody)+`break
case 'text/plain':`+adapter.parser.text(isOptionalBody)+`break
case 'application/x-www-form-urlencoded':`+adapter.parser.urlencoded(isOptionalBody)+`break
case 'application/octet-stream':`+adapter.parser.arrayBuffer(isOptionalBody)+`break
case 'multipart/form-data':`+adapter.parser.formData(isOptionalBody)+`break
`;for(let key of Object.keys(app["~parser"]))fnLiteral+=`case '${key}':let bo${key}=parser['${key}'](c,contentType)
if(bo${key} instanceof Promise)bo${key}=await bo${key}
if(bo${key} instanceof ElysiaCustomStatusResponse){`+mapResponse2(`bo${key}`)+`}if(bo${key}!==undefined)c.body=bo${key}
break
`;if(hooks.parse?.length)fnLiteral+="}";fnLiteral+="}"}if(hooks.parse?.length)fnLiteral+=`
delete c.contentType`}fnLiteral+="}catch(error){throw new ParseError(error)}"}if(parseReporter.resolve(),hooks?.transform||hasTrace){let reporter=report("transform",{total:hooks.transform?.length});if(hooks.transform?.length){fnLiteral+=`let transformed
`;for(let i=0;i<hooks.transform.length;i++){let transform2=hooks.transform[i],endUnit=reporter.resolveChild(transform2.fn.name);if(fnLiteral+=isAsync(transform2)?`transformed=await e.transform[${i}](c)
`:`transformed=e.transform[${i}](c)
`,transform2.subType==="mapDerive")fnLiteral+="if(transformed instanceof ElysiaCustomStatusResponse){"+mapResponse2("transformed")+`}else{transformed.request=c.request
transformed.store=c.store
transformed.qi=c.qi
transformed.path=c.path
transformed.url=c.url
transformed.redirect=c.redirect
transformed.set=c.set
transformed.error=c.error
c=transformed}`;else fnLiteral+="if(transformed instanceof ElysiaCustomStatusResponse){"+mapResponse2("transformed")+`}else Object.assign(c,transformed)
`;endUnit()}}reporter.resolve()}let fileUnions=[];if(validator){if(validator.headers){if(validator.headers.hasDefault)for(let[key,value]of Object.entries(exports_value2.Default(validator.headers.schema,{}))){let parsed=typeof value==="object"?JSON.stringify(value):typeof value==="string"?`'${value}'`:value;if(parsed!==void 0)fnLiteral+=`c.headers['${key}']??=${parsed}
`}if(fnLiteral+=composeCleaner({name:"c.headers",schema:validator.headers,type:"headers",normalize}),validator.headers.isOptional)fnLiteral+="if(isNotEmpty(c.headers)){";if(validator.headers?.provider==="standard")fnLiteral+=`let vah=validator.headers.Check(c.headers)
if(vah instanceof Promise)vah=await vah
if(vah.issues){`+validation.validate("headers",void 0,"vah.issues")+`}else{c.headers=vah.value}
`;else if(validator.headers?.schema?.noValidate!==!0)fnLiteral+="if(validator.headers.Check(c.headers) === false){"+validation.validate("headers")+"}";if(validator.headers.hasTransform)fnLiteral+=coerceTransformDecodeError(`c.headers=validator.headers.Decode(c.headers)
`,"headers",allowUnsafeValidationDetails);if(validator.headers.isOptional)fnLiteral+="}"}if(validator.params){if(validator.params.hasDefault)for(let[key,value]of Object.entries(exports_value2.Default(validator.params.schema,{}))){let parsed=typeof value==="object"?JSON.stringify(value):typeof value==="string"?`'${value}'`:value;if(parsed!==void 0)fnLiteral+=`c.params['${key}']??=${parsed}
`}if(validator.params.provider==="standard")fnLiteral+=`let vap=validator.params.Check(c.params)
if(vap instanceof Promise)vap=await vap
if(vap.issues){`+validation.validate("params",void 0,"vap.issues")+`}else{c.params=vap.value}
`;else if(validator.params?.schema?.noValidate!==!0)fnLiteral+="if(validator.params.Check(c.params)===false){"+validation.validate("params")+"}";if(validator.params.hasTransform)fnLiteral+=coerceTransformDecodeError(`c.params=validator.params.Decode(c.params)
`,"params",allowUnsafeValidationDetails)}if(validator.query){if(Kind in validator.query?.schema&&validator.query.hasDefault)for(let[key,value]of Object.entries(exports_value2.Default(validator.query.schema,{}))){let parsed=typeof value==="object"?JSON.stringify(value):typeof value==="string"?`'${value}'`:value;if(parsed!==void 0)fnLiteral+=`if(c.query['${key}']===undefined)c.query['${key}']=${parsed}
`}if(fnLiteral+=composeCleaner({name:"c.query",schema:validator.query,type:"query",normalize}),validator.query.isOptional)fnLiteral+="if(isNotEmpty(c.query)){";if(validator.query.provider==="standard")fnLiteral+=`let vaq=validator.query.Check(c.query)
if(vaq instanceof Promise)vaq=await vaq
if(vaq.issues){`+validation.validate("query",void 0,"vaq.issues")+`}else{c.query=vaq.value}
`;else if(validator.query?.schema?.noValidate!==!0)fnLiteral+="if(validator.query.Check(c.query)===false){"+validation.validate("query")+"}";if(validator.query.hasTransform)fnLiteral+=coerceTransformDecodeError(`c.query=validator.query.Decode(c.query)
`,"query",allowUnsafeValidationDetails),fnLiteral+=coerceTransformDecodeError(`c.query=validator.query.Decode(c.query)
`,"query",allowUnsafeValidationDetails);if(validator.query.isOptional)fnLiteral+="}"}if(hasBody&&validator.body){if(validator.body.hasTransform||validator.body.isOptional)fnLiteral+=`const isNotEmptyObject=c.body&&(typeof c.body==="object"&&(isNotEmpty(c.body)||c.body instanceof ArrayBuffer))
`;let hasUnion=isUnion(validator.body.schema),hasNonUnionFileWithDefault=!1;if(validator.body.hasDefault){let value=exports_value2.Default(validator.body.schema,validator.body.schema.type==="object"||unwrapImportSchema(validator.body.schema)[Kind]==="Object"?{}:void 0),schema=unwrapImportSchema(validator.body.schema);if(!hasUnion&&value&&typeof value==="object"&&(hasType("File",schema)||hasType("Files",schema))){hasNonUnionFileWithDefault=!0;for(let[k2,v]of Object.entries(value))if(v==="File"||v==="Files")delete value[k2];if(!isNotEmpty(value))value=void 0}let parsed=typeof value==="object"?JSON.stringify(value):typeof value==="string"?`'${value}'`:value;if(value!==void 0&&value!==null)if(Array.isArray(value))fnLiteral+=`if(!c.body)c.body=${parsed}
`;else if(typeof value==="object")fnLiteral+=`c.body=Object.assign(${parsed},c.body)
`;else fnLiteral+=`c.body=${parsed}
`;if(fnLiteral+=composeCleaner({name:"c.body",schema:validator.body,type:"body",normalize}),validator.body.provider==="standard")fnLiteral+=`let vab=validator.body.Check(c.body)
if(vab instanceof Promise)vab=await vab
if(vab.issues){`+validation.validate("body",void 0,"vab.issues")+`}else{c.body=vab.value}
`;else if(validator.body?.schema?.noValidate!==!0)if(validator.body.isOptional)fnLiteral+="if(isNotEmptyObject&&validator.body.Check(c.body)===false){"+validation.validate("body")+"}";else fnLiteral+="if(validator.body.Check(c.body)===false){"+validation.validate("body")+"}"}else if(fnLiteral+=composeCleaner({name:"c.body",schema:validator.body,type:"body",normalize}),validator.body.provider==="standard")fnLiteral+=`let vab=validator.body.Check(c.body)
if(vab instanceof Promise)vab=await vab
if(vab.issues){`+validation.validate("body",void 0,"vab.issues")+`}else{c.body=vab.value}
`;else if(validator.body?.schema?.noValidate!==!0)if(validator.body.isOptional)fnLiteral+="if(isNotEmptyObject&&validator.body.Check(c.body)===false){"+validation.validate("body")+"}";else fnLiteral+="if(validator.body.Check(c.body)===false){"+validation.validate("body")+"}";if(validator.body.hasTransform)fnLiteral+=coerceTransformDecodeError(`if(isNotEmptyObject)c.body=validator.body.Decode(c.body)
`,"body",allowUnsafeValidationDetails);if(hasUnion&&validator.body.schema.anyOf?.length){let iterator=Object.values(validator.body.schema.anyOf);for(let i=0;i<iterator.length;i++){let type=iterator[i];if(hasType("File",type)||hasType("Files",type)){let candidate=getSchemaValidator(type,{modules:app.definitions.typebox,dynamic:!app.config.aot,models:app.definitions.type,normalize:app.config.normalize,additionalCoerce:coercePrimitiveRoot(),sanitize:()=>app.config.sanitize});if(candidate){let isFirst=fileUnions.length===0,properties=candidate.schema?.properties??type.properties;if(!properties&&candidate.schema?.anyOf){let objectSchema=candidate.schema.anyOf.find((s)=>s.type==="object"||(Kind in s)&&s[Kind]==="Object");if(objectSchema)properties=objectSchema.properties}if(!properties)continue;let iterator2=Object.entries(properties),validator2=isFirst?`
`:" else ";validator2+=`if(fileUnions[${fileUnions.length}].Check(c.body)){`;let validateFile2="",validatorLength=0;for(let i2=0;i2<iterator2.length;i2++){let[k2,v]=iterator2[i2];if(!v.extension||v[Kind]!=="File"&&v[Kind]!=="Files")continue;if(validatorLength)validateFile2+=",";validateFile2+=`fileType(c.body.${k2},${JSON.stringify(v.extension)},'body.${k2}')`,validatorLength++}if(validateFile2){if(validatorLength===1)validator2+=`await ${validateFile2}
`;else if(validatorLength>1)validator2+=`await Promise.all([${validateFile2}])
`;validator2+="}",fnLiteral+=validator2,fileUnions.push(candidate)}}}}}else if(hasNonUnionFileWithDefault||!hasUnion&&(hasType("File",unwrapImportSchema(validator.body.schema))||hasType("Files",unwrapImportSchema(validator.body.schema)))){let validateFile2="",i=0;for(let[k2,v]of Object.entries(unwrapImportSchema(validator.body.schema).properties)){if(!v.extension||v[Kind]!=="File"&&v[Kind]!=="Files")continue;if(i)validateFile2+=",";validateFile2+=`fileType(c.body.${k2},${JSON.stringify(v.extension)},'body.${k2}')`,i++}if(i)fnLiteral+=`
`;if(i===1)fnLiteral+=`await ${validateFile2}
`;else if(i>1)fnLiteral+=`await Promise.all([${validateFile2}])
`}}if(validator.cookie){if(validator.cookie.config=mergeCookie(validator.cookie.config,validator.cookie?.config??{}),fnLiteral+=`let cookieValue={}
for(const [key,value] of Object.entries(c.cookie))cookieValue[key]=value.value
`,validator.cookie.isOptional)fnLiteral+="if(isNotEmpty(c.cookie)){";if(validator.cookie.provider==="standard")fnLiteral+=`let vac=validator.cookie.Check(cookieValue)
if(vac instanceof Promise)vac=await vac
if(vac.issues){`+validation.validate("cookie",void 0,"vac.issues")+`}else{cookieValue=vac.value}
`,fnLiteral+=`for(const k of Object.keys(cookieValue))c.cookie[k].value=cookieValue[k]
`;else if(validator.body?.schema?.noValidate!==!0){if(fnLiteral+="if(validator.cookie.Check(cookieValue)===false){"+validation.validate("cookie","cookieValue")+"}",validator.cookie.hasTransform)fnLiteral+=coerceTransformDecodeError("for(const [key,value] of Object.entries(validator.cookie.Decode(cookieValue))){c.cookie[key].cookie.value = value}","cookie",allowUnsafeValidationDetails)}if(validator.cookie.isOptional)fnLiteral+="}"}}if(hooks?.beforeHandle||hasTrace){let reporter=report("beforeHandle",{total:hooks.beforeHandle?.length}),hasResolve=!1;if(hooks.beforeHandle?.length)for(let i=0;i<hooks.beforeHandle.length;i++){let beforeHandle=hooks.beforeHandle[i],endUnit=reporter.resolveChild(beforeHandle.fn.name),returning=hasReturn(beforeHandle);if(beforeHandle.subType==="resolve"||beforeHandle.subType==="mapResolve"){if(!hasResolve)hasResolve=!0,fnLiteral+=`
let resolved
`;if(fnLiteral+=isAsync(beforeHandle)?`resolved=await e.beforeHandle[${i}](c);
`:`resolved=e.beforeHandle[${i}](c);
`,beforeHandle.subType==="mapResolve")fnLiteral+="if(resolved instanceof ElysiaCustomStatusResponse){"+mapResponse2("resolved")+`}else{resolved.request=c.request
resolved.store=c.store
resolved.qi=c.qi
resolved.path=c.path
resolved.url=c.url
resolved.redirect=c.redirect
resolved.set=c.set
resolved.error=c.error
c=resolved}`;else fnLiteral+="if(resolved instanceof ElysiaCustomStatusResponse){"+mapResponse2("resolved")+`}else Object.assign(c, resolved)
`;endUnit()}else if(!returning)fnLiteral+=isAsync(beforeHandle)?`await e.beforeHandle[${i}](c)
`:`e.beforeHandle[${i}](c)
`,endUnit();else{if(fnLiteral+=isAsync(beforeHandle)?`be=await e.beforeHandle[${i}](c)
`:`be=e.beforeHandle[${i}](c)
`,endUnit("be"),fnLiteral+="if(be!==undefined){",reporter.resolve(),hooks.afterHandle?.length||hasTrace){report("handle",{name:isHandleFn?handler.name:void 0}).resolve();let reporter2=report("afterHandle",{total:hooks.afterHandle?.length});if(hooks.afterHandle?.length)for(let i2=0;i2<hooks.afterHandle.length;i2++){let hook=hooks.afterHandle[i2],returning2=hasReturn(hook),endUnit2=reporter2.resolveChild(hook.fn.name);if(fnLiteral+=`c.response=c.responseValue=be
`,!returning2)fnLiteral+=isAsync(hook.fn)?`await e.afterHandle[${i2}](c, be)
`:`e.afterHandle[${i2}](c, be)
`;else fnLiteral+=isAsync(hook.fn)?`af=await e.afterHandle[${i2}](c)
`:`af=e.afterHandle[${i2}](c)
`,fnLiteral+=`if(af!==undefined) c.response=c.responseValue=be=af
`;endUnit2("af")}reporter2.resolve()}if(validator.response)fnLiteral+=validation.response("be");let mapResponseReporter=report("mapResponse",{total:hooks.mapResponse?.length});if(hooks.mapResponse?.length){fnLiteral+=`c.response=c.responseValue=be
`;for(let i2=0;i2<hooks.mapResponse.length;i2++){let mapResponse3=hooks.mapResponse[i2],endUnit2=mapResponseReporter.resolveChild(mapResponse3.fn.name);fnLiteral+=`if(mr===undefined){mr=${isAsyncName(mapResponse3)?"await ":""}e.mapResponse[${i2}](c)
if(mr!==undefined)be=c.response=c.responseValue=mr}`,endUnit2()}}mapResponseReporter.resolve(),fnLiteral+=afterResponse(),fnLiteral+=encodeCookie(),fnLiteral+=`return mapEarlyResponse(${saveResponse}be,c.set${mapResponseContext})}
`}}reporter.resolve()}function reportHandler(name){let handleReporter=report("handle",{name,alias:"reportHandler"});return()=>{if(hasTrace)fnLiteral+='if(r&&(r[Symbol.iterator]||r[Symbol.asyncIterator])&&typeof r.next==="function"){'+(maybeAsync?"":"(async()=>{")+`const stream=await tee(r,3)
r=stream[0]
const listener=stream[1]
`+(hasTrace||hooks.afterResponse?.length?`afterHandlerStreamListener=stream[2]
`:"")+`${setImmediateFn}(async ()=>{if(listener)for await(const v of listener){}
`,handleReporter.resolve(),fnLiteral+="})"+(maybeAsync?"":"})()")+"}else{",handleReporter.resolve(),fnLiteral+=`}
`}}if(hooks.afterHandle?.length||hasTrace){let resolveHandler=reportHandler(isHandleFn?handler.name:void 0);if(hooks.afterHandle?.length)fnLiteral+=isAsyncHandler?`let r=c.response=c.responseValue=await ${handle}
`:`let r=c.response=c.responseValue=${handle}
`;else fnLiteral+=isAsyncHandler?`let r=await ${handle}
`:`let r=${handle}
`;resolveHandler();let reporter=report("afterHandle",{total:hooks.afterHandle?.length});if(hooks.afterHandle?.length)for(let i=0;i<hooks.afterHandle.length;i++){let hook=hooks.afterHandle[i],returning=hasReturn(hook),endUnit=reporter.resolveChild(hook.fn.name);if(!returning)fnLiteral+=isAsync(hook.fn)?`await e.afterHandle[${i}](c)
`:`e.afterHandle[${i}](c)
`,endUnit();else if(fnLiteral+=isAsync(hook.fn)?`af=await e.afterHandle[${i}](c)
`:`af=e.afterHandle[${i}](c)
`,endUnit("af"),validator.response)fnLiteral+="if(af!==undefined){",reporter.resolve(),fnLiteral+=validation.response("af"),fnLiteral+="c.response=c.responseValue=af}";else fnLiteral+="if(af!==undefined){",reporter.resolve(),fnLiteral+="c.response=c.responseValue=af}"}if(reporter.resolve(),hooks.afterHandle?.length)fnLiteral+=`r=c.response
`;if(validator.response)fnLiteral+=validation.response();fnLiteral+=encodeCookie();let mapResponseReporter=report("mapResponse",{total:hooks.mapResponse?.length});if(hooks.mapResponse?.length)for(let i=0;i<hooks.mapResponse.length;i++){let mapResponse3=hooks.mapResponse[i],endUnit=mapResponseReporter.resolveChild(mapResponse3.fn.name);fnLiteral+=`mr=${isAsyncName(mapResponse3)?"await ":""}e.mapResponse[${i}](c)
if(mr!==undefined)r=c.response=c.responseValue=mr
`,endUnit()}mapResponseReporter.resolve(),fnLiteral+=mapResponse2()}else{let resolveHandler=reportHandler(isHandleFn?handler.name:void 0);if(validator.response||hooks.mapResponse?.length||hasTrace){if(fnLiteral+=isAsyncHandler?`let r=await ${handle}
`:`let r=${handle}
`,resolveHandler(),validator.response)fnLiteral+=validation.response();let mapResponseReporter=report("mapResponse",{total:hooks.mapResponse?.length});if(hooks.mapResponse?.length){fnLiteral+=`
c.response=c.responseValue=r
`;for(let i=0;i<hooks.mapResponse.length;i++){let mapResponse3=hooks.mapResponse[i],endUnit=mapResponseReporter.resolveChild(mapResponse3.fn.name);fnLiteral+=`
if(mr===undefined){mr=${isAsyncName(mapResponse3)?"await ":""}e.mapResponse[${i}](c)
if(mr!==undefined)r=c.response=c.responseValue=mr}
`,endUnit()}}if(mapResponseReporter.resolve(),fnLiteral+=encodeCookie(),handler instanceof Response)fnLiteral+=afterResponse(),fnLiteral+=inference.set?`if(isNotEmpty(c.set.headers)||c.set.status!==200||c.set.redirect||c.set.cookie)return mapResponse(${saveResponse}${handle}.clone(),c.set${mapResponseContext})
else return ${handle}.clone()`:`return ${handle}.clone()`,fnLiteral+=`
`;else fnLiteral+=mapResponse2()}else if(hasCookie||hasTrace){fnLiteral+=isAsyncHandler?`let r=await ${handle}
`:`let r=${handle}
`,resolveHandler();let mapResponseReporter=report("mapResponse",{total:hooks.mapResponse?.length});if(hooks.mapResponse?.length){fnLiteral+=`c.response=c.responseValue= r
`;for(let i=0;i<hooks.mapResponse.length;i++){let mapResponse3=hooks.mapResponse[i],endUnit=mapResponseReporter.resolveChild(mapResponse3.fn.name);fnLiteral+=`if(mr===undefined){mr=${isAsyncName(mapResponse3)?"await ":""}e.mapResponse[${i}](c)
if(mr!==undefined)r=c.response=c.responseValue=mr}`,endUnit()}}mapResponseReporter.resolve(),fnLiteral+=encodeCookie()+mapResponse2()}else{resolveHandler();let handled=isAsyncHandler?`await ${handle}`:handle;if(handler instanceof Response)fnLiteral+=afterResponse(),fnLiteral+=inference.set?`if(isNotEmpty(c.set.headers)||c.set.status!==200||c.set.redirect||c.set.cookie)return mapResponse(${saveResponse}${handle}.clone(),c.set${mapResponseContext})
else return ${handle}.clone()
`:`return ${handle}.clone()
`;else fnLiteral+=mapResponse2(handled)}}if(fnLiteral+=`
}catch(error){`,!maybeAsync&&hooks.error?.length)fnLiteral+="return(async()=>{";if(fnLiteral+=`const set=c.set
if(!set.status||set.status<300)set.status=error?.status||500
`,hasCookie)fnLiteral+=encodeCookie();if(hasTrace&&hooks.trace)for(let i=0;i<hooks.trace.length;i++)fnLiteral+=`report${i}?.resolve(error);reportChild${i}?.(error)
`;let errorReporter=report("error",{total:hooks.error?.length});if(hooks.error?.length){if(fnLiteral+=`c.error=error
`,hasValidation)fnLiteral+=`if(error instanceof TypeBoxError){c.code="VALIDATION"
c.set.status=422}else{c.code=error.code??error[ERROR_CODE]??"UNKNOWN"}`;else fnLiteral+=`c.code=error.code??error[ERROR_CODE]??"UNKNOWN"
`;if(fnLiteral+=`let er
`,hooks.mapResponse?.length)fnLiteral+=`let mep
`;for(let i=0;i<hooks.error.length;i++){let endUnit=errorReporter.resolveChild(hooks.error[i].fn.name);if(isAsync(hooks.error[i]))fnLiteral+=`er=await e.error[${i}](c)
`;else fnLiteral+=`er=e.error[${i}](c)
if(er instanceof Promise)er=await er
`;if(endUnit(),hooks.mapResponse?.length){let mapResponseReporter=report("mapResponse",{total:hooks.mapResponse?.length});for(let i2=0;i2<hooks.mapResponse.length;i2++){let mapResponse3=hooks.mapResponse[i2],endUnit2=mapResponseReporter.resolveChild(mapResponse3.fn.name);fnLiteral+=`c.response=c.responseValue=er
mep=e.mapResponse[${i2}](c)
if(mep instanceof Promise)er=await er
if(mep!==undefined)er=mep
`,endUnit2()}mapResponseReporter.resolve()}if(fnLiteral+=`er=mapEarlyResponse(er,set${mapResponseContext})
`,fnLiteral+="if(er){",hasTrace&&hooks.trace){for(let i2=0;i2<hooks.trace.length;i2++)fnLiteral+=`report${i2}.resolve()
`;errorReporter.resolve()}fnLiteral+=afterResponse(!1),fnLiteral+="return er}"}}if(errorReporter.resolve(),fnLiteral+="return handleError(c,error,true)",!maybeAsync&&hooks.error?.length)fnLiteral+="})()";fnLiteral+="}";let adapterVariables=adapter.inject?Object.keys(adapter.inject).join(",")+",":"",init="const {handler,handleError,hooks:e, "+allocateIf("validator,",hasValidation)+"mapResponse,mapCompactResponse,mapEarlyResponse,isNotEmpty,utils:{"+allocateIf("parseQuery,",hasBody)+allocateIf("parseQueryFromURL,",hasQuery)+"},error:{"+allocateIf("ValidationError,",hasValidation)+allocateIf("ParseError",hasBody)+"},fileType,schema,definitions,tee,ERROR_CODE,"+allocateIf("parseCookie,",hasCookie)+allocateIf("signCookie,",hasCookie)+allocateIf("decodeURIComponent,",hasQuery)+"ElysiaCustomStatusResponse,"+allocateIf("ELYSIA_TRACE,",hasTrace)+allocateIf("ELYSIA_REQUEST_ID,",hasTrace)+allocateIf("parser,",hooks.parse?.length)+allocateIf("getServer,",inference.server)+allocateIf("fileUnions,",fileUnions.length)+adapterVariables+allocateIf("TypeBoxError",hasValidation)+`}=hooks
const trace=e.trace
return ${maybeAsync?"async ":""}function handle(c){`;if(hooks.beforeHandle?.length)init+=`let be
`;if(hooks.afterHandle?.length)init+=`let af
`;if(hooks.mapResponse?.length)init+=`let mr
`;if(allowMeta)init+=`c.schema=schema
c.defs=definitions
`;fnLiteral=init+fnLiteral+"}",init="";try{return Function("hooks",`"use strict";
`+fnLiteral)({handler,hooks:lifeCycleToFn(hooks),validator:hasValidation?validator:void 0,handleError:app.handleError,mapResponse:adapterHandler.mapResponse,mapCompactResponse:adapterHandler.mapCompactResponse,mapEarlyResponse:adapterHandler.mapEarlyResponse,isNotEmpty,utils:{parseQuery:hasBody?parseQuery:void 0,parseQueryFromURL:hasQuery?validator.query?.provider==="standard"?parseQueryStandardSchema:parseQueryFromURL:void 0},error:{ValidationError:hasValidation?ValidationError:void 0,ParseError:hasBody?ParseError2:void 0},fileType,schema:app.router.history,definitions:app.definitions.type,tee,ERROR_CODE,parseCookie:hasCookie?parseCookie:void 0,signCookie:hasCookie?signCookie:void 0,Cookie:hasCookie?Cookie:void 0,decodeURIComponent:hasQuery?import_fast_decode_uri_component3.default:void 0,ElysiaCustomStatusResponse,ELYSIA_TRACE:hasTrace?ELYSIA_TRACE:void 0,ELYSIA_REQUEST_ID:hasTrace?ELYSIA_REQUEST_ID:void 0,getServer:inference.server?()=>app.getServer():void 0,fileUnions:fileUnions.length?fileUnions:void 0,TypeBoxError:hasValidation?TypeBoxError:void 0,parser:app["~parser"],...adapter.inject})}catch(error){let debugHooks=lifeCycleToFn(hooks);if(console.log("[Composer] failed to generate optimized handler"),console.log("---"),console.log({handler:typeof handler==="function"?handler.toString():handler,instruction:fnLiteral,hooks:{...debugHooks,transform:debugHooks?.transform?.map?.((x)=>x.toString()),resolve:debugHooks?.resolve?.map?.((x)=>x.toString()),beforeHandle:debugHooks?.beforeHandle?.map?.((x)=>x.toString()),afterHandle:debugHooks?.afterHandle?.map?.((x)=>x.toString()),mapResponse:debugHooks?.mapResponse?.map?.((x)=>x.toString()),parse:debugHooks?.parse?.map?.((x)=>x.toString()),error:debugHooks?.error?.map?.((x)=>x.toString()),afterResponse:debugHooks?.afterResponse?.map?.((x)=>x.toString()),stop:debugHooks?.stop?.map?.((x)=>x.toString())},validator,definitions:app.definitions.type,error}),console.log("---"),typeof process?.exit==="function")process.exit(1);return()=>new Response("Internal Server Error",{status:500})}},createOnRequestHandler=(app,addFn)=>{let fnLiteral="",reporter=createReport({trace:app.event.trace,addFn:addFn??((word)=>{fnLiteral+=word})})("request",{total:app.event.request?.length});if(app.event.request?.length){fnLiteral+="try{";for(let i=0;i<app.event.request.length;i++){let hook=app.event.request[i],withReturn=hasReturn(hook),maybeAsync=isAsync(hook),endUnit=reporter.resolveChild(app.event.request[i].fn.name);if(withReturn)fnLiteral+=`re=mapEarlyResponse(${maybeAsync?"await ":""}onRequest[${i}](c),c.set)
`,endUnit("re"),fnLiteral+=`if(re!==undefined)return re
`;else fnLiteral+=`${maybeAsync?"await ":""}onRequest[${i}](c)
`,endUnit()}fnLiteral+="}catch(error){return app.handleError(c,error,false)}"}return reporter.resolve(),fnLiteral},createHoc=(app,fnName="map")=>{let hoc=app.extender.higherOrderFunctions;if(!hoc.length)return"return "+fnName;let adapter=app["~adapter"].composeGeneralHandler,handler=fnName;for(let i=0;i<hoc.length;i++)handler=`hoc[${i}](${handler},${adapter.parameters})`;return`return function hocMap(${adapter.parameters}){return ${handler}(${adapter.parameters})}`},composeGeneralHandler=(app)=>{let adapter=app["~adapter"].composeGeneralHandler;app.router.http.build();let isWebstandard=app["~adapter"].isWebStandard,hasTrace=app.event.trace?.length,fnLiteral="",router=app.router,findDynamicRoute=router.http.root.WS?"const route=router.find(r.method==='GET'&&r.headers.get('upgrade')==='websocket'?'WS':r.method,p)":"const route=router.find(r.method,p)";if(findDynamicRoute+=router.http.root.ALL?`??router.find('ALL',p)
`:`
`,isWebstandard)findDynamicRoute+='if(r.method==="HEAD"){const route=router.find("GET",p);if(route){c.params=route.params;const _res=route.store.handler?route.store.handler(c):route.store.compile()(c);if(_res)return Promise.resolve(_res).then((_res)=>{if(!_res.headers)_res.headers=new Headers();return getResponseLength(_res).then((length)=>{_res.headers.set("content-length", length);return new Response(null,{status:_res.status,statusText:_res.statusText,headers:_res.headers});})});}}';let afterResponse=`c.error=notFound
`;if(app.event.afterResponse?.length&&!app.event.error){afterResponse=`
c.error=notFound
`;let prefix=app.event.afterResponse.some(isAsync)?"async":"";afterResponse+=`
${setImmediateFn}(${prefix}()=>{if(c.responseValue instanceof ElysiaCustomStatusResponse) c.set.status=c.responseValue.code
`;for(let i=0;i<app.event.afterResponse.length;i++){let fn2=app.event.afterResponse[i].fn;afterResponse+=`
${isAsyncName(fn2)?"await ":""}afterResponse[${i}](c)
`}afterResponse+=`})
`}if(app.inference.query)afterResponse+=`
if(c.qi===-1){c.query={}}else{c.query=parseQueryFromURL(c.url,c.qi+1)}`;let error404=adapter.error404(!!app.event.request?.length,!!app.event.error?.length,afterResponse);findDynamicRoute+=error404.code,findDynamicRoute+=`
c.params=route.params
if(route.store.handler)return route.store.handler(c)
return route.store.compile()(c)
`;let switchMap="";for(let[path,methods]of Object.entries(router.static)){if(switchMap+=`case'${path}':`,app.config.strictPath!==!0)switchMap+=`case'${getLoosePath(path)}':`;let encoded=encodePath(path);if(path!==encoded)switchMap+=`case'${encoded}':`;if(switchMap+="switch(r.method){","GET"in methods||"WS"in methods){if(switchMap+="case 'GET':","WS"in methods){if(switchMap+=`if(r.headers.get('upgrade')==='websocket')return ht[${methods.WS}].composed(c)
`,"GET"in methods===!1)if("ALL"in methods)switchMap+=`return ht[${methods.ALL}].composed(c)
`;else switchMap+=`break map
`}if("GET"in methods)switchMap+=`return ht[${methods.GET}].composed(c)
`}if(isWebstandard&&(("GET"in methods)||("ALL"in methods))&&"HEAD"in methods===!1)switchMap+=`case 'HEAD':return Promise.resolve(ht[${methods.GET??methods.ALL}].composed(c)).then(_ht=>getResponseLength(_ht).then((length)=>{_ht.headers.set('content-length', length)
return new Response(null,{status:_ht.status,statusText:_ht.statusText,headers:_ht.headers})
}))
`;for(let[method,index]of Object.entries(methods)){if(method==="ALL"||method==="GET"||method==="WS")continue;switchMap+=`case '${method}':return ht[${index}].composed(c)
`}if("ALL"in methods)switchMap+=`default:return ht[${methods.ALL}].composed(c)
`;else switchMap+=`default:break map
`;switchMap+="}"}let maybeAsync=!!app.event.request?.some(isAsync),adapterVariables=adapter.inject?Object.keys(adapter.inject).join(",")+",":"";if(fnLiteral+=`
const {app,mapEarlyResponse,NotFoundError,randomId,handleError,status,redirect,getResponseLength,ElysiaCustomStatusResponse,`+allocateIf("parseQueryFromURL,",app.inference.query)+allocateIf("ELYSIA_TRACE,",hasTrace)+allocateIf("ELYSIA_REQUEST_ID,",hasTrace)+adapterVariables+`}=data
const store=app.singleton.store
const decorator=app.singleton.decorator
const staticRouter=app.router.static.http
const ht=app.router.history
const router=app.router.http
const trace=app.event.trace?.map(x=>typeof x==='function'?x:x.fn)??[]
const notFound=new NotFoundError()
const hoc=app.extender.higherOrderFunctions.map(x=>x.fn)
`,app.event.request?.length)fnLiteral+=`const onRequest=app.event.request.map(x=>x.fn)
`;if(app.event.afterResponse?.length)fnLiteral+=`const afterResponse=app.event.afterResponse.map(x=>x.fn)
`;if(fnLiteral+=error404.declare,app.event.trace?.length)fnLiteral+="const "+app.event.trace.map((_2,i)=>`tr${i}=app.event.trace[${i}].fn`).join(",")+`
`;if(fnLiteral+=`${maybeAsync?"async ":""}function map(${adapter.parameters}){`,app.event.request?.length)fnLiteral+=`let re
`;if(fnLiteral+=adapter.createContext(app),app.event.trace?.length)fnLiteral+="c[ELYSIA_TRACE]=["+app.event.trace.map((_2,i)=>`tr${i}(c)`).join(",")+`]
`;if(fnLiteral+=createOnRequestHandler(app),switchMap)fnLiteral+=`
map: switch(p){
`+switchMap+"}";fnLiteral+=findDynamicRoute+`}
`+createHoc(app);let handleError=composeErrorHandler(app);app.handleError=handleError;let fn=Function("data",`"use strict";
`+fnLiteral)({app,mapEarlyResponse:app["~adapter"].handler.mapEarlyResponse,NotFoundError,randomId,handleError,status,redirect,getResponseLength,ElysiaCustomStatusResponse,parseQueryFromURL:app.inference.query?parseQueryFromURL:void 0,ELYSIA_TRACE:hasTrace?ELYSIA_TRACE:void 0,ELYSIA_REQUEST_ID:hasTrace?ELYSIA_REQUEST_ID:void 0,...adapter.inject});if(isBun)Bun.gc(!1);return fn},composeErrorHandler=(app)=>{let hooks=app.event,fnLiteral="",adapter=app["~adapter"].composeError,adapterVariables=adapter.inject?Object.keys(adapter.inject).join(",")+",":"",hasTrace=!!app.event.trace?.length;if(fnLiteral+="const {mapResponse,ERROR_CODE,ElysiaCustomStatusResponse,ValidationError,TransformDecodeError,"+allocateIf("onError,",app.event.error)+allocateIf("afterResponse,",app.event.afterResponse)+allocateIf("trace,",app.event.trace)+allocateIf("onMapResponse,",app.event.mapResponse)+allocateIf("ELYSIA_TRACE,",hasTrace)+allocateIf("ELYSIA_REQUEST_ID,",hasTrace)+adapterVariables+`}=inject
`,fnLiteral+="return async function(context,error,skipGlobal){",fnLiteral+="",hasTrace)fnLiteral+=`const id=context[ELYSIA_REQUEST_ID]
`;let report=createReport({context:"context",trace:hooks.trace,addFn:(word)=>{fnLiteral+=word}}),afterResponse=()=>{if(!hooks.afterResponse?.length&&!hasTrace)return"";let afterResponse2="",prefix=hooks.afterResponse?.some(isAsync)?"async":"";afterResponse2+=`
${setImmediateFn}(${prefix}()=>{`;let reporter=createReport({context:"context",trace:hooks.trace,addFn:(word)=>{afterResponse2+=word}})("afterResponse",{total:hooks.afterResponse?.length,name:"context"});if(hooks.afterResponse?.length&&hooks.afterResponse)for(let i=0;i<hooks.afterResponse.length;i++){let fn=hooks.afterResponse[i].fn,endUnit=reporter.resolveChild(fn.name);afterResponse2+=`
${isAsyncName(fn)?"await ":""}afterResponse[${i}](context)
`,endUnit()}return reporter.resolve(),afterResponse2+=`})
`,afterResponse2};if(fnLiteral+=`const set=context.set
let _r
if(!context.code)context.code=error.code??error[ERROR_CODE]
if(!(context.error instanceof Error))context.error=error
if(error instanceof ElysiaCustomStatusResponse){set.status=error.status=error.code
error.message=error.response}`,adapter.declare)fnLiteral+=adapter.declare;let saveResponse=hasTrace||!!hooks.afterResponse?.length?"context.response = ":"";if(fnLiteral+=`if(typeof error?.toResponse==='function'&&!(error instanceof ValidationError)&&!(error instanceof TransformDecodeError)){try{let raw=error.toResponse()
if(typeof raw?.then==='function')raw=await raw
if(raw instanceof Response)set.status=raw.status
context.response=context.responseValue=raw
}catch(toResponseError){
}
}
`,app.event.error)for(let i=0;i<app.event.error.length;i++){let handler=app.event.error[i],response=`${isAsync(handler)?"await ":""}onError[${i}](context)
`;if(fnLiteral+="if(skipGlobal!==true&&!context.response){",hasReturn(handler)){fnLiteral+=`_r=${response}
if(_r!==undefined){if(_r instanceof Response){`+afterResponse()+`return mapResponse(_r,set${adapter.mapResponseContext})}if(_r instanceof ElysiaCustomStatusResponse){error.status=error.code
error.message = error.response}if(set.status===200||!set.status)set.status=error.status
`;let mapResponseReporter2=report("mapResponse",{total:hooks.mapResponse?.length,name:"context"});if(hooks.mapResponse?.length)for(let i2=0;i2<hooks.mapResponse.length;i2++){let mapResponse2=hooks.mapResponse[i2],endUnit=mapResponseReporter2.resolveChild(mapResponse2.fn.name);fnLiteral+=`context.response=context.responseValue=_r_r=${isAsyncName(mapResponse2)?"await ":""}onMapResponse[${i2}](context)
`,endUnit()}mapResponseReporter2.resolve(),fnLiteral+=afterResponse()+`return mapResponse(${saveResponse}_r,set${adapter.mapResponseContext})}`}else fnLiteral+=response;fnLiteral+="}"}fnLiteral+=`if(error instanceof ValidationError||error instanceof TransformDecodeError){
if(error.error)error=error.error
set.status=error.status??422
`+afterResponse()+adapter.validationError+`
}
`,fnLiteral+="if(!context.response&&error instanceof Error){"+afterResponse()+adapter.unknownError+`
}`;let mapResponseReporter=report("mapResponse",{total:hooks.mapResponse?.length,name:"context"});if(fnLiteral+=`
if(!context.response)context.response=context.responseValue=error.message??error
`,hooks.mapResponse?.length){fnLiteral+=`let mr
`;for(let i=0;i<hooks.mapResponse.length;i++){let mapResponse2=hooks.mapResponse[i],endUnit=mapResponseReporter.resolveChild(mapResponse2.fn.name);fnLiteral+=`if(mr===undefined){mr=${isAsyncName(mapResponse2)?"await ":""}onMapResponse[${i}](context)
if(mr!==undefined)error=context.response=context.responseValue=mr}`,endUnit()}}mapResponseReporter.resolve(),fnLiteral+=afterResponse()+`
return mapResponse(${saveResponse}error,set${adapter.mapResponseContext})}`;let mapFn=(x)=>typeof x==="function"?x:x.fn;return Function("inject",`"use strict";
`+fnLiteral)({mapResponse:app["~adapter"].handler.mapResponse,ERROR_CODE,ElysiaCustomStatusResponse,ValidationError,TransformDecodeError,onError:app.event.error?.map(mapFn),afterResponse:app.event.afterResponse?.map(mapFn),trace:app.event.trace?.map(mapFn),onMapResponse:app.event.mapResponse?.map(mapFn),ELYSIA_TRACE:hasTrace?ELYSIA_TRACE:void 0,ELYSIA_REQUEST_ID:hasTrace?ELYSIA_REQUEST_ID:void 0,...adapter.inject})};function isCloudflareWorker(){try{if(typeof caches<"u"&&typeof caches.default<"u")return!0;if(typeof WebSocketPair<"u")return!0}catch{return!1}return!1}var CloudflareAdapter={...WebStandardAdapter,name:"cloudflare-worker",composeGeneralHandler:{...WebStandardAdapter.composeGeneralHandler,error404(hasEventHook,hasErrorHook,afterHandle){let{code}=WebStandardAdapter.composeGeneralHandler.error404(hasEventHook,hasErrorHook,afterHandle);return{code,declare:hasErrorHook?"":`const error404Message=notFound.message.toString()
const error404={clone:()=>new Response(error404Message,{status:404})}
`}}},beforeCompile(app){app.handleError=composeErrorHandler(app);for(let route of app.routes)route.compile()},listen(){return()=>{console.warn("Cloudflare Worker does not support listen method. Please export default Elysia instance instead.")}}},separateFunction=(code)=>{if(code.startsWith("async"))code=code.slice(5);code=code.trimStart();let index=-1;if(code.charCodeAt(0)===40){if(index=code.indexOf("=>",code.indexOf(")")),index!==-1){let bracketEndIndex=index;while(bracketEndIndex>0)if(code.charCodeAt(--bracketEndIndex)===41)break;let body=code.slice(index+2);if(body.charCodeAt(0)===32)body=body.trimStart();return[code.slice(1,bracketEndIndex),body,{isArrowReturn:body.charCodeAt(0)!==123}]}}if(/^(\w+)=>/g.test(code)){if(index=code.indexOf("=>"),index!==-1){let body=code.slice(index+2);if(body.charCodeAt(0)===32)body=body.trimStart();return[code.slice(0,index),body,{isArrowReturn:body.charCodeAt(0)!==123}]}}if(code.startsWith("function")){index=code.indexOf("(");let end=code.indexOf(")");return[code.slice(index+1,end),code.slice(end+2),{isArrowReturn:!1}]}let start=code.indexOf("(");if(start!==-1){let sep=code.indexOf(`
`,2),parameter=code.slice(0,sep),end=parameter.lastIndexOf(")")+1,body=code.slice(sep+1);return[parameter.slice(start,end),"{"+body,{isArrowReturn:!1}]}let x=code.split(`
`,2);return[x[0],x[1],{isArrowReturn:!1}]},bracketPairRange=(parameter)=>{let start=parameter.indexOf("{");if(start===-1)return[-1,0];let end=start+1,deep=1;for(;end<parameter.length;end++){let char=parameter.charCodeAt(end);if(char===123)deep++;else if(char===125)deep--;if(deep===0)break}if(deep!==0)return[0,parameter.length];return[start,end+1]},bracketPairRangeReverse=(parameter)=>{let end=parameter.lastIndexOf("}");if(end===-1)return[-1,0];let start=end-1,deep=1;for(;start>=0;start--){let char=parameter.charCodeAt(start);if(char===125)deep++;else if(char===123)deep--;if(deep===0)break}if(deep!==0)return[-1,0];return[start,end+1]},removeColonAlias=(parameter)=>{while(!0){let start=parameter.indexOf(":");if(start===-1)break;let end=parameter.indexOf(",",start);if(end===-1)end=parameter.indexOf("}",start)-1;if(end===-2)end=parameter.length;parameter=parameter.slice(0,start)+parameter.slice(end)}return parameter},retrieveRootParamters=(parameter)=>{let hasParenthesis=!1;if(parameter.charCodeAt(0)===40)parameter=parameter.slice(1,-1);if(parameter.charCodeAt(0)===123)hasParenthesis=!0,parameter=parameter.slice(1,-1);parameter=parameter.replace(/( |\t|\n)/g,"").trim();let parameters=[];while(!0){let[start,end]=bracketPairRange(parameter);if(start===-1)break;if(parameters.push(parameter.slice(0,start-1)),parameter.charCodeAt(end)===44)end++;parameter=parameter.slice(end)}if(parameter=removeColonAlias(parameter),parameter)parameters=parameters.concat(parameter.split(","));let parameterMap=Object.create(null);for(let p of parameters){if(p.indexOf(",")===-1){parameterMap[p]=!0;continue}for(let q of p.split(","))parameterMap[q.trim()]=!0}return{hasParenthesis,parameters:parameterMap}},findParameterReference=(parameter,inference)=>{let{parameters,hasParenthesis}=retrieveRootParamters(parameter);if(parameters.query)inference.query=!0;if(parameters.headers)inference.headers=!0;if(parameters.body)inference.body=!0;if(parameters.cookie)inference.cookie=!0;if(parameters.set)inference.set=!0;if(parameters.server)inference.server=!0;if(parameters.route)inference.route=!0;if(parameters.url)inference.url=!0;if(parameters.path)inference.path=!0;if(hasParenthesis)return`{ ${Object.keys(parameters).join(", ")} }`;return Object.keys(parameters).join(", ")},findEndIndex=(type,content,index)=>{let regex2=new RegExp(`${type.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}[\\n\\t,; ]`);if(index!==void 0)regex2.lastIndex=index;let match=regex2.exec(content);return match?match.index:-1},findAlias=(type,body,depth=0)=>{if(depth>5)return[];let aliases=[],content=body;while(!0){let index=findEndIndex(" = "+type,content);if(index===-1)index=findEndIndex("="+type,content);if(index===-1){let lastIndex=content.indexOf(" = "+type);if(lastIndex===-1)lastIndex=content.indexOf("="+type);if(lastIndex+3+type.length!==content.length)break;index=lastIndex}let part=content.slice(0,index),lastPart=part.lastIndexOf(" "),variable=part.slice(lastPart!==-1?lastPart+1:-1);if(variable==="}"){let[start,end]=bracketPairRangeReverse(part);aliases.push(removeColonAlias(content.slice(start,end))),content=content.slice(index+3+type.length);continue}while(variable.charCodeAt(0)===44)variable=variable.slice(1);while(variable.charCodeAt(0)===9)variable=variable.slice(1);if(!variable.includes("("))aliases.push(variable);content=content.slice(index+3+type.length)}for(let alias of aliases){if(alias.charCodeAt(0)===123)continue;let deepAlias=findAlias(alias,body);if(deepAlias.length>0)aliases.push(...deepAlias)}return aliases},extractMainParameter=(parameter)=>{if(!parameter)return;if(parameter.charCodeAt(0)!==123)return parameter;if(parameter=parameter.slice(2,-2),!parameter.includes(",")){if(parameter.indexOf("...")!==-1)return parameter.slice(parameter.indexOf("...")+3);return}let spreadIndex=parameter.indexOf("...");if(spreadIndex===-1)return;return parameter.slice(spreadIndex+3).trimEnd()},inferBodyReference=(code,aliases,inference)=>{let access=(type,alias)=>new RegExp(`${alias}\\.(${type})|${alias}\\["${type}"\\]|${alias}\\['${type}'\\]`).test(code);for(let alias of aliases){if(!alias)continue;if(alias.charCodeAt(0)===123){let parameters=retrieveRootParamters(alias).parameters;if(parameters.query)inference.query=!0;if(parameters.headers)inference.headers=!0;if(parameters.body)inference.body=!0;if(parameters.cookie)inference.cookie=!0;if(parameters.set)inference.set=!0;if(parameters.server)inference.server=!0;if(parameters.url)inference.url=!0;if(parameters.route)inference.route=!0;if(parameters.path)inference.path=!0;continue}if(!inference.query&&(access("query",alias)||code.includes("return "+alias)||code.includes("return "+alias+".query")))inference.query=!0;if(!inference.headers&&access("headers",alias))inference.headers=!0;if(!inference.body&&access("body",alias))inference.body=!0;if(!inference.cookie&&access("cookie",alias))inference.cookie=!0;if(!inference.set&&access("set",alias))inference.set=!0;if(!inference.server&&access("server",alias))inference.server=!0;if(!inference.route&&access("route",alias))inference.route=!0;if(!inference.url&&access("url",alias))inference.url=!0;if(!inference.path&&access("path",alias))inference.path=!0;if(inference.query&&inference.headers&&inference.body&&inference.cookie&&inference.set&&inference.server&&inference.route&&inference.url&&inference.path)break}return aliases},isContextPassToFunction=(context,body,inference)=>{try{let captureFunction=new RegExp(`\\w\\((?:.*?)?${context}(?:.*?)?\\)`,"gs"),exactParameter=new RegExp(`${context}(,|\\))`,"gs"),length=body.length,fn;fn=captureFunction.exec(body)+"";while(captureFunction.lastIndex!==0&&captureFunction.lastIndex<length+(fn?fn.length:0)){if(fn&&exactParameter.test(fn))return inference.query=!0,inference.headers=!0,inference.body=!0,inference.cookie=!0,inference.set=!0,inference.server=!0,inference.url=!0,inference.route=!0,inference.path=!0,!0;fn=captureFunction.exec(body)+""}let nextChar=body.charCodeAt(captureFunction.lastIndex);if(nextChar===41||nextChar===44)return inference.query=!0,inference.headers=!0,inference.body=!0,inference.cookie=!0,inference.set=!0,inference.server=!0,inference.url=!0,inference.route=!0,inference.path=!0,!0;return!1}catch(error){return console.log("[Sucrose] warning: unexpected isContextPassToFunction error, you may continue development as usual but please report the following to maintainers:"),console.log("--- body ---"),console.log(body),console.log("--- context ---"),console.log(context),!0}},pendingGC,caches2={},clearSucroseCache=(delay)=>{if(delay===null||isCloudflareWorker())return;if(delay===void 0)delay=295000;if(pendingGC)clearTimeout(pendingGC);pendingGC=setTimeout(()=>{if(caches2={},pendingGC=void 0,isBun)Bun.gc(!1)},delay)},mergeInference=(a,b)=>{return{body:a.body||b.body,cookie:a.cookie||b.cookie,headers:a.headers||b.headers,query:a.query||b.query,set:a.set||b.set,server:a.server||b.server,url:a.url||b.url,route:a.route||b.route,path:a.path||b.path}},sucrose=(lifeCycle,inference={query:!1,headers:!1,body:!1,cookie:!1,set:!1,server:!1,url:!1,route:!1,path:!1},settings={})=>{let events=[];if(lifeCycle.request?.length)events.push(...lifeCycle.request);if(lifeCycle.beforeHandle?.length)events.push(...lifeCycle.beforeHandle);if(lifeCycle.parse?.length)events.push(...lifeCycle.parse);if(lifeCycle.error?.length)events.push(...lifeCycle.error);if(lifeCycle.transform?.length)events.push(...lifeCycle.transform);if(lifeCycle.afterHandle?.length)events.push(...lifeCycle.afterHandle);if(lifeCycle.mapResponse?.length)events.push(...lifeCycle.mapResponse);if(lifeCycle.afterResponse?.length)events.push(...lifeCycle.afterResponse);if(lifeCycle.handler&&typeof lifeCycle.handler==="function")events.push(lifeCycle.handler);for(let i=0;i<events.length;i++){let e=events[i];if(!e)continue;let event=typeof e==="object"?e.fn:e;if(typeof event!=="function")continue;let content=event.toString(),key=checksum(content),cachedInference=caches2[key];if(cachedInference){inference=mergeInference(inference,cachedInference);continue}clearSucroseCache(settings.gcTime);let fnInference={query:!1,headers:!1,body:!1,cookie:!1,set:!1,server:!1,url:!1,route:!1,path:!1},[parameter,body]=separateFunction(content),rootParameters=findParameterReference(parameter,fnInference),mainParameter=extractMainParameter(rootParameters);if(mainParameter){let aliases=findAlias(mainParameter,body.slice(1,-1));aliases.splice(0,-1,mainParameter);let code=body;if(code.charCodeAt(0)===123&&code.charCodeAt(body.length-1)===125)code=code.slice(1,-1).trim();if(!isContextPassToFunction(mainParameter,code,fnInference))inferBodyReference(code,aliases,fnInference);if(!fnInference.query&&code.includes("return "+mainParameter+".query"))fnInference.query=!0}if(!caches2[key])caches2[key]=fnInference;if(inference=mergeInference(inference,fnInference),inference.query&&inference.headers&&inference.body&&inference.cookie&&inference.set&&inference.server&&inference.url&&inference.route&&inference.path)break}return inference},mapResponse2=(response,set2,request)=>{if(isNotEmpty(set2.headers)||set2.status!==200||set2.cookie)switch(handleSet(set2),response?.constructor?.name){case"String":return new Response(response,set2);case"Array":case"Object":return set2.headers["content-type"]="application/json",new Response(JSON.stringify(response),set2);case"ElysiaFile":return handleFile(response.value,set2);case"File":return handleFile(response,set2);case"Blob":return handleFile(response,set2);case"ElysiaCustomStatusResponse":return set2.status=response.code,mapResponse2(response.response,set2,request);case void 0:if(!response)return new Response("",set2);return new Response(JSON.stringify(response),set2);case"Response":return handleResponse2(response,set2,request);case"Error":return errorToResponse2(response,set2);case"Promise":return response.then((x)=>mapResponse2(x,set2,request));case"Function":return mapResponse2(response(),set2,request);case"Number":case"Boolean":return new Response(response.toString(),set2);case"Cookie":if(response instanceof Cookie)return new Response(response.value,set2);return new Response(response?.toString(),set2);case"FormData":return new Response(response,set2);default:if(response instanceof Response)return handleResponse2(response,set2,request);if(response instanceof Promise)return response.then((x)=>mapResponse2(x,set2));if(response instanceof Error)return errorToResponse2(response,set2);if(response instanceof ElysiaCustomStatusResponse)return set2.status=response.code,mapResponse2(response.response,set2,request);if(typeof response?.next==="function"||response instanceof ReadableStream)return handleStream2(response,set2,request);if(typeof response?.then==="function")return response.then((x)=>mapResponse2(x,set2));if(typeof response?.toResponse==="function")return mapResponse2(response.toResponse(),set2);if("charCodeAt"in response){let code=response.charCodeAt(0);if(code===123||code===91){if(!set2.headers["Content-Type"])set2.headers["Content-Type"]="application/json";return new Response(JSON.stringify(response),set2)}}return new Response(response,set2)}if(typeof response?.next==="function"||response instanceof ReadableStream)return handleStream2(response,set2,request);return mapCompactResponse2(response,request)},mapEarlyResponse2=(response,set2,request)=>{if(response===void 0||response===null)return;if(isNotEmpty(set2.headers)||set2.status!==200||set2.cookie)switch(handleSet(set2),response?.constructor?.name){case"String":return new Response(response,set2);case"Array":case"Object":return set2.headers["content-type"]="application/json",new Response(JSON.stringify(response),set2);case"ElysiaFile":return handleFile(response.value,set2);case"File":return handleFile(response,set2);case"Blob":return handleFile(response,set2);case"ElysiaCustomStatusResponse":return set2.status=response.code,mapEarlyResponse2(response.response,set2,request);case void 0:if(!response)return;return new Response(JSON.stringify(response),set2);case"Response":return handleResponse2(response,set2,request);case"Promise":return response.then((x)=>mapEarlyResponse2(x,set2));case"Error":return errorToResponse2(response,set2);case"Function":return mapEarlyResponse2(response(),set2);case"Number":case"Boolean":return new Response(response.toString(),set2);case"FormData":return new Response(response);case"Cookie":if(response instanceof Cookie)return new Response(response.value,set2);return new Response(response?.toString(),set2);default:if(response instanceof Response)return handleResponse2(response,set2,request);if(response instanceof Promise)return response.then((x)=>mapEarlyResponse2(x,set2));if(response instanceof Error)return errorToResponse2(response,set2);if(response instanceof ElysiaCustomStatusResponse)return set2.status=response.code,mapEarlyResponse2(response.response,set2,request);if(typeof response?.next==="function"||response instanceof ReadableStream)return handleStream2(response,set2,request);if(typeof response?.then==="function")return response.then((x)=>mapEarlyResponse2(x,set2));if(typeof response?.toResponse==="function")return mapEarlyResponse2(response.toResponse(),set2);if("charCodeAt"in response){let code=response.charCodeAt(0);if(code===123||code===91){if(!set2.headers["Content-Type"])set2.headers["Content-Type"]="application/json";return new Response(JSON.stringify(response),set2)}}return new Response(response,set2)}else switch(response?.constructor?.name){case"String":return new Response(response);case"Array":case"Object":return set2.headers["content-type"]="application/json",new Response(JSON.stringify(response),set2);case"ElysiaFile":return handleFile(response.value,set2);case"File":return handleFile(response,set2);case"Blob":return handleFile(response,set2);case"ElysiaCustomStatusResponse":return set2.status=response.code,mapEarlyResponse2(response.response,set2,request);case void 0:if(!response)return new Response("");return new Response(JSON.stringify(response),{headers:{"content-type":"application/json"}});case"Response":return response;case"Promise":return response.then((x)=>{let r=mapEarlyResponse2(x,set2);if(r!==void 0)return r});case"Error":return errorToResponse2(response,set2);case"Function":return mapCompactResponse2(response(),request);case"Number":case"Boolean":return new Response(response.toString());case"Cookie":if(response instanceof Cookie)return new Response(response.value,set2);return new Response(response?.toString(),set2);case"FormData":return new Response(response);default:if(response instanceof Response)return response;if(response instanceof Promise)return response.then((x)=>mapEarlyResponse2(x,set2));if(response instanceof Error)return errorToResponse2(response,set2);if(response instanceof ElysiaCustomStatusResponse)return set2.status=response.code,mapEarlyResponse2(response.response,set2,request);if(typeof response?.next==="function"||response instanceof ReadableStream)return handleStream2(response,set2,request);if(typeof response?.then==="function")return response.then((x)=>mapEarlyResponse2(x,set2));if(typeof response?.toResponse==="function")return mapEarlyResponse2(response.toResponse(),set2);if("charCodeAt"in response){let code=response.charCodeAt(0);if(code===123||code===91){if(!set2.headers["Content-Type"])set2.headers["Content-Type"]="application/json";return new Response(JSON.stringify(response),set2)}}return new Response(response)}},mapCompactResponse2=(response,request)=>{switch(response?.constructor?.name){case"String":return new Response(response);case"Object":case"Array":return new Response(JSON.stringify(response),{headers:{"Content-Type":"application/json"}});case"ElysiaFile":return handleFile(response.value);case"File":return handleFile(response);case"Blob":return handleFile(response);case"ElysiaCustomStatusResponse":return mapResponse2(response.response,{status:response.code,headers:{}});case void 0:if(!response)return new Response("");return new Response(JSON.stringify(response),{headers:{"content-type":"application/json"}});case"Response":return response;case"Error":return errorToResponse2(response);case"Promise":return response.then((x)=>mapCompactResponse2(x,request));case"Function":return mapCompactResponse2(response(),request);case"Number":case"Boolean":return new Response(response.toString());case"FormData":return new Response(response);default:if(response instanceof Response)return response;if(response instanceof Promise)return response.then((x)=>mapCompactResponse2(x,request));if(response instanceof Error)return errorToResponse2(response);if(response instanceof ElysiaCustomStatusResponse)return mapResponse2(response.response,{status:response.code,headers:{}});if(typeof response?.next==="function"||response instanceof ReadableStream)return handleStream2(response,void 0,request);if(typeof response?.then==="function")return response.then((x)=>mapResponse2(x,set));if(typeof response?.toResponse==="function")return mapCompactResponse2(response.toResponse());if("charCodeAt"in response){let code=response.charCodeAt(0);if(code===123||code===91)return new Response(JSON.stringify(response),{headers:{"Content-Type":"application/json"}})}return new Response(response)}},errorToResponse2=(error,set2)=>{if(typeof error?.toResponse==="function"){let raw=error.toResponse(),targetSet=set2??{headers:{},status:200,redirect:""},apply=(resolved)=>{if(resolved instanceof Response)targetSet.status=resolved.status;return mapResponse2(resolved,targetSet)};return typeof raw?.then==="function"?raw.then(apply):apply(raw)}return new Response(JSON.stringify({name:error?.name,message:error?.message,cause:error?.cause}),{status:set2?.status!==200?set2?.status??500:500,headers:set2?.headers})},createStaticHandler2=(handle,hooks,setHeaders={})=>{if(typeof handle==="function")return;let response=mapResponse2(handle,{headers:setHeaders});if(!hooks.parse?.length&&!hooks.transform?.length&&!hooks.beforeHandle?.length&&!hooks.afterHandle?.length)return()=>response.clone()},handleResponse2=createResponseHandler({mapResponse:mapResponse2,mapCompactResponse:mapCompactResponse2}),handleStream2=createStreamHandler({mapResponse:mapResponse2,mapCompactResponse:mapCompactResponse2}),allocateIf2=(value,condition)=>condition?value:"",createContext=(app,route,inference,isInline=!1)=>{let fnLiteral="",defaultHeaders=app.setHeaders,hasTrace=!!app.event.trace?.length;if(hasTrace)fnLiteral+=`const id=randomId()
`;let isDynamic=/[:*]/.test(route.path),getQi=`const u=request.url,s=u.indexOf('/',${app.config.handler?.standardHostname??!0?11:7}),qi=u.indexOf('?', s + 1)
`,needsQuery=inference.query||!!route.hooks.query||!!route.hooks.standaloneValidator?.find((x)=>x.query)||app.event.request?.length;if(needsQuery)fnLiteral+=getQi;let getPath=!inference.path?"":!isDynamic?`path:'${route.path}',`:"get path(){"+(needsQuery?"":getQi)+`if(qi===-1)return u.substring(s)
return u.substring(s,qi)
},`;if(fnLiteral+=allocateIf2("const c=",!isInline)+"{request,store,"+allocateIf2("qi,",needsQuery)+allocateIf2("params:request.params,",isDynamic)+getPath+allocateIf2("url:request.url,",hasTrace||inference.url||needsQuery)+"redirect,status,set:{headers:"+(isNotEmpty(defaultHeaders)?"Object.assign({},app.setHeaders)":"Object.create(null)")+",status:200}",inference.server)fnLiteral+=",get server(){return app.getServer()}";if(hasTrace)fnLiteral+=",[ELYSIA_REQUEST_ID]:id";{let decoratorsLiteral="";for(let key of Object.keys(app.singleton.decorator))decoratorsLiteral+=`,'${key}':decorator['${key}']`;fnLiteral+=decoratorsLiteral}return fnLiteral+=`}
`,fnLiteral},createBunRouteHandler=(app,route)=>{let hasTrace=!!app.event.trace?.length,hasHoc=!!app.extender.higherOrderFunctions.length,inference=sucrose(route.hooks,app.inference);inference=sucrose({handler:route.handler},inference);let fnLiteral="const handler=data.handler,app=data.app,store=data.store,decorator=data.decorator,redirect=data.redirect,route=data.route,mapEarlyResponse=data.mapEarlyResponse,"+allocateIf2("randomId=data.randomId,",hasTrace)+allocateIf2("ELYSIA_REQUEST_ID=data.ELYSIA_REQUEST_ID,",hasTrace)+allocateIf2("ELYSIA_TRACE=data.ELYSIA_TRACE,",hasTrace)+allocateIf2("trace=data.trace,",hasTrace)+allocateIf2("hoc=data.hoc,",hasHoc)+`status=data.status
`;if(app.event.request?.length)fnLiteral+=`const onRequest=app.event.request.map(x=>x.fn)
`;fnLiteral+=`${app.event.request?.find(isAsync)?"async":""} function map(request){`;let needsQuery=inference.query||!!route.hooks.query||!!route.hooks.standaloneValidator?.find((x)=>x.query);if(hasTrace||needsQuery||app.event.request?.length)fnLiteral+=createContext(app,route,inference),fnLiteral+=createOnRequestHandler(app),fnLiteral+="return handler(c)}";else fnLiteral+=`return handler(${createContext(app,route,inference,!0)})}`;return fnLiteral+=createHoc(app),Function("data",fnLiteral)({app,handler:route.compile?.()??route.composed,redirect,status,hoc:app.extender.higherOrderFunctions.map((x)=>x.fn),store:app.store,decorator:app.decorator,route:route.path,randomId:hasTrace?randomId:void 0,ELYSIA_TRACE:hasTrace?ELYSIA_TRACE:void 0,ELYSIA_REQUEST_ID:hasTrace?ELYSIA_REQUEST_ID:void 0,trace:hasTrace?app.event.trace?.map((x)=>x?.fn??x):void 0,mapEarlyResponse:mapEarlyResponse2})},createNativeStaticHandler=(handle,hooks,set2)=>{if(typeof handle==="function"||handle instanceof Blob)return;if(isHTMLBundle(handle))return()=>handle;let response=mapResponse2(handle,set2??{headers:{}});if(!hooks.parse?.length&&!hooks.transform?.length&&!hooks.beforeHandle?.length&&!hooks.afterHandle?.length){if(response instanceof Promise)return response.then((response2)=>{if(!response2)return;if(!response2.headers.has("content-type"))response2.headers.append("content-type","text/plain");return response2.clone()});if(!response.headers.has("content-type"))response.headers.append("content-type","text/plain");return()=>response.clone()}},websocket={open(ws){ws.data.open?.(ws)},message(ws,message){ws.data.message?.(ws,message)},drain(ws){ws.data.drain?.(ws)},close(ws,code,reason){ws.data.close?.(ws,code,reason)},ping(ws){ws.data.ping?.(ws)},pong(ws){ws.data.pong?.(ws)}};class ElysiaWS{raw;data;body;constructor(raw,data,body=void 0){this.raw=raw,this.data=data,this.body=body,this.validator=raw.data?.validator,this.sendText=raw.sendText.bind(raw),this.sendBinary=raw.sendBinary.bind(raw),this.close=raw.close.bind(raw),this.terminate=raw.terminate.bind(raw),this.publishText=raw.publishText.bind(raw),this.publishBinary=raw.publishBinary.bind(raw),this.subscribe=raw.subscribe.bind(raw),this.unsubscribe=raw.unsubscribe.bind(raw),this.isSubscribed=raw.isSubscribed.bind(raw),this.cork=raw.cork.bind(raw),this.remoteAddress=raw.remoteAddress,this.binaryType=raw.binaryType,this.data=raw.data,this.send=this.send.bind(this),this.ping=this.ping.bind(this),this.pong=this.pong.bind(this),this.publish=this.publish.bind(this)}send(data,compress){if(Buffer.isBuffer(data))return this.raw.send(data,compress);if(this.validator?.Check(data)===!1)return this.raw.send(new ValidationError("message",this.validator,data).message);if(typeof data==="object")data=JSON.stringify(data);return this.raw.send(data,compress)}ping(data){if(Buffer.isBuffer(data))return this.raw.ping(data);if(this.validator?.Check(data)===!1)return this.raw.send(new ValidationError("message",this.validator,data).message);if(typeof data==="object")data=JSON.stringify(data);return this.raw.ping(data)}pong(data){if(Buffer.isBuffer(data))return this.raw.pong(data);if(this.validator?.Check(data)===!1)return this.raw.send(new ValidationError("message",this.validator,data).message);if(typeof data==="object")data=JSON.stringify(data);return this.raw.pong(data)}publish(topic,data,compress){if(Buffer.isBuffer(data))return this.raw.publish(topic,data,compress);if(this.validator?.Check(data)===!1)return this.raw.send(new ValidationError("message",this.validator,data).message);if(typeof data==="object")data=JSON.stringify(data);return this.raw.publish(topic,data,compress)}sendText;sendBinary;close;terminate;publishText;publishBinary;subscribe;unsubscribe;isSubscribed;cork;remoteAddress;binaryType;get readyState(){return this.raw.readyState}validator;["~types"];get id(){return this.data.id}}var createWSMessageParser=(parse2)=>{let parsers=typeof parse2==="function"?[parse2]:parse2;return async function(ws,message){if(typeof message==="string"){let start=message?.charCodeAt(0);if(start===34||start===47||start===91||start===123)try{message=JSON.parse(message)}catch{}else if(isNumericString(message))message=+message;else if(message==="true")message=!0;else if(message==="false")message=!1;else if(message==="null")message=null}if(parsers)for(let i=0;i<parsers.length;i++){let temp=parsers[i](ws,message);if(temp instanceof Promise)temp=await temp;if(temp!==void 0)return temp}return message}},createHandleWSResponse=(responseValidator)=>{let handleWSResponse=(ws,data)=>{if(data instanceof Promise)return data.then((data2)=>handleWSResponse(ws,data2));if(Buffer.isBuffer(data))return ws.send(data.toString());if(data===void 0)return;let validateResponse=responseValidator?responseValidator.provider==="standard"?(data2)=>responseValidator.schema["~standard"].validate(data2).issues:(data2)=>responseValidator.Check(data2)===!1:void 0,send=(datum)=>{if(validateResponse&&validateResponse(datum)===!1)return ws.send(new ValidationError("message",responseValidator,datum).message);if(typeof datum==="object")return ws.send(JSON.stringify(datum));ws.send(datum)};if(typeof data?.next!=="function")return void send(data);let init=data.next();if(init instanceof Promise)return(async()=>{let first=await init;if(validateResponse&&validateResponse(first))return ws.send(new ValidationError("message",responseValidator,first).message);if(send(first.value),!first.done)for await(let datum of data)send(datum)})();if(send(init.value),!init.done)for(let datum of data)send(datum)};return handleWSResponse},optionalParam=/:.+?\?(?=\/|$)/,getPossibleParams=(path)=>{let match=optionalParam.exec(path);if(!match)return[path];let routes=[],head=path.slice(0,match.index),param=match[0].slice(0,-1),tail=path.slice(match.index+match[0].length);routes.push(head.slice(0,-1)),routes.push(head+param);for(let fragment of getPossibleParams(tail)){if(!fragment)continue;if(!fragment.startsWith("/:"))routes.push(head.slice(0,-1)+fragment);routes.push(head+param+fragment)}return routes},isHTMLBundle=(handle)=>{return typeof handle==="object"&&handle!==null&&(handle.toString()==="[object HTMLBundle]"||typeof handle.index==="string")},supportedMethods={GET:!0,HEAD:!0,OPTIONS:!0,DELETE:!0,PATCH:!0,POST:!0,PUT:!0},mapRoutes=(app)=>{if(!app.config.aot||!app.config.systemRouter)return;let routes={},add=(route,handler)=>{let path=encodeURI(route.path);if(routes[path]){if(!routes[path][route.method])routes[path][route.method]=handler}else routes[path]={[route.method]:handler}},tree=app.routeTree;for(let route of app.router.history){if(typeof route.handler!=="function")continue;let method=route.method;if(method==="GET"&&`WS_${route.path}`in tree||method==="WS"||route.path.charCodeAt(route.path.length-1)===42||!(method in supportedMethods))continue;if(method==="ALL"){if(!(`WS_${route.path}`in tree))routes[route.path]=route.hooks?.config?.mount?route.hooks.trace||app.event.trace||app.extender.higherOrderFunctions?createBunRouteHandler(app,route):route.hooks.mount||route.handler:route.handler;continue}let compiled,handler=app.config.precompile?createBunRouteHandler(app,route):(request)=>{if(compiled)return compiled(request);return(compiled=createBunRouteHandler(app,route))(request)};for(let path of getPossibleParams(route.path))add({method,path},handler)}return routes},mergeRoutes=(r1,r2)=>{if(!r2)return r1;for(let key of Object.keys(r2)){if(r1[key]===r2[key])continue;if(!r1[key]){r1[key]=r2[key];continue}if(r1[key]&&r2[key]){if(typeof r1[key]==="function"||r1[key]instanceof Response){r1[key]=r2[key];continue}r1[key]={...r1[key],...r2[key]}}}return r1},BunAdapter={...WebStandardAdapter,name:"bun",handler:{mapResponse:mapResponse2,mapEarlyResponse:mapEarlyResponse2,mapCompactResponse:mapCompactResponse2,createStaticHandler:createStaticHandler2,createNativeStaticHandler},composeHandler:{...WebStandardAdapter.composeHandler,headers:hasHeaderShorthand?`c.headers=c.request.headers.toJSON()
`:`c.headers={}
for(const [k,v] of c.request.headers.entries())c.headers[k]=v
`},listen(app){return(options,callback)=>{if(typeof Bun>"u")throw Error(".listen() is designed to run on Bun only. If you are running Elysia in other environment please use a dedicated plugin or export the handler via Elysia.fetch");if(app.compile(),typeof options==="string"){if(!isNumericString(options))throw Error("Port must be a numeric value");options=parseInt(options)}let createStaticRoute=(iterator,{withAsync=!1}={})=>{let staticRoutes={},ops=[];for(let[path,route]of Object.entries(iterator))if(path=encodeURI(path),supportPerMethodInlineHandler){if(!route)continue;for(let[method,value]of Object.entries(route)){if(!value||!(method in supportedMethods))continue;if(value instanceof Promise){if(withAsync){if(!staticRoutes[path])staticRoutes[path]={};ops.push(value.then((awaited)=>{if(awaited instanceof Response)staticRoutes[path][method]=awaited;if(isHTMLBundle(awaited))staticRoutes[path][method]=awaited}))}continue}if(!(value instanceof Response)&&!isHTMLBundle(value))continue;if(!staticRoutes[path])staticRoutes[path]={};staticRoutes[path][method]=value}}else{if(!route)continue;if(route instanceof Promise){if(withAsync){if(!staticRoutes[path])staticRoutes[path]={};ops.push(route.then((awaited)=>{if(awaited instanceof Response)staticRoutes[path]=awaited}))}continue}if(!(route instanceof Response))continue;staticRoutes[path]=route}if(withAsync)return Promise.all(ops).then(()=>staticRoutes);return staticRoutes},serve=typeof options==="object"?{development:!isProduction,reusePort:!0,idleTimeout:30,...app.config.serve||{},...options||{},routes:mergeRoutes(mergeRoutes(createStaticRoute(app.router.response),mapRoutes(app)),app.config.serve?.routes),websocket:{...app.config.websocket||{},...websocket||{},...options.websocket||{}},fetch:app.fetch}:{development:!isProduction,reusePort:!0,idleTimeout:30,...app.config.serve||{},routes:mergeRoutes(mergeRoutes(createStaticRoute(app.router.response),mapRoutes(app)),app.config.serve?.routes),websocket:{...app.config.websocket||{},...websocket||{}},port:options,fetch:app.fetch};if(app.server=Bun.serve(serve),app.event.start)for(let i=0;i<app.event.start.length;i++)app.event.start[i].fn(app);if(callback)callback(app.server);process.on("beforeExit",async()=>{if(app.server){if(await app.server.stop?.(),app.server=null,app.event.stop)for(let i=0;i<app.event.stop.length;i++)app.event.stop[i].fn(app)}}),app.promisedModules.then(async()=>{app.config.aot,app.compile(),app.server?.reload({...serve,fetch:app.fetch,routes:mergeRoutes(mergeRoutes(await createStaticRoute(app.router.response,{withAsync:!0}),mapRoutes(app)),app.config.serve?.routes)}),Bun?.gc(!1)})}},async stop(app,closeActiveConnections){if(app.server){if(await app.server.stop(closeActiveConnections),app.server=null,app.event.stop?.length)for(let i=0;i<app.event.stop.length;i++)app.event.stop[i].fn(app)}else console.log("Elysia isn't running. Call `app.listen` to start the server.",Error().stack)},ws(app,path,options){let{parse:parse2,body,response,...rest}=options,messageValidator=getSchemaValidator(body,{modules:app.definitions.typebox,models:app.definitions.type,normalize:app.config.normalize}),validateMessage=messageValidator?messageValidator.provider==="standard"?(data)=>messageValidator.schema["~standard"].validate(data).issues:(data)=>messageValidator.Check(data)===!1:void 0,responseValidator=getSchemaValidator(response,{modules:app.definitions.typebox,models:app.definitions.type,normalize:app.config.normalize});app.route("WS",path,async(context)=>{let server=context.server??app.server,{set:set2,path:path2,qi,headers,query,params}=context;if(context.validator=responseValidator,options.upgrade){if(typeof options.upgrade==="function"){let temp=options.upgrade(context);if(temp instanceof Promise)await temp}else if(options.upgrade)Object.assign(set2.headers,options.upgrade)}if(set2.cookie&&isNotEmpty(set2.cookie)){let cookie=serializeCookie(set2.cookie);if(cookie)set2.headers["set-cookie"]=cookie}if(set2.headers["set-cookie"]&&Array.isArray(set2.headers["set-cookie"]))set2.headers=parseSetCookies(new Headers(set2.headers),set2.headers["set-cookie"]);let handleResponse3=createHandleWSResponse(responseValidator),parseMessage=createWSMessageParser(parse2),_id;if(typeof options.beforeHandle==="function"){let result=options.beforeHandle(context);if(result instanceof Promise)await result}let errorHandlers=[...options.error?Array.isArray(options.error)?options.error:[options.error]:[],...(app.event.error??[]).map((x)=>typeof x==="function"?x:x.fn)].filter((x)=>x),hasCustomErrorHandlers=errorHandlers.length>0,handleErrors=!hasCustomErrorHandlers?()=>{}:async(ws,error)=>{for(let handleError of errorHandlers){let response2=handleError(Object.assign(context,{error}));if(response2 instanceof Promise)response2=await response2;if(await handleResponse3(ws,response2),response2)break}};if(server?.upgrade(context.request,{headers:isNotEmpty(set2.headers)?set2.headers:void 0,data:{...context,get id(){if(_id)return _id;return _id=randomId()},validator:responseValidator,ping(ws,data){options.ping?.(ws,data)},pong(ws,data){options.pong?.(ws,data)},open:async(ws)=>{try{await handleResponse3(ws,options.open?.(new ElysiaWS(ws,context)))}catch(error){handleErrors(ws,error)}},message:async(ws,_message)=>{let message=await parseMessage(ws,_message);if(validateMessage&&validateMessage(message)){let validationError=new ValidationError("message",messageValidator,message);if(!hasCustomErrorHandlers)return void ws.send(validationError.message);return handleErrors(ws,validationError)}try{await handleResponse3(ws,options.message?.(new ElysiaWS(ws,context,message),message))}catch(error){handleErrors(ws,error)}},drain:async(ws)=>{try{await handleResponse3(ws,options.drain?.(new ElysiaWS(ws,context)))}catch(error){handleErrors(ws,error)}},close:async(ws,code,reason)=>{try{await handleResponse3(ws,options.close?.(new ElysiaWS(ws,context),code,reason))}catch(error){handleErrors(ws,error)}}}}))return;return status(400,"Expected a websocket connection")},{...rest,websocket:options})}},injectDefaultValues=(typeChecker,obj)=>{let schema=typeChecker.schema;if(!schema)return;if(schema.$defs?.[schema.$ref])schema=schema.$defs[schema.$ref];if(!schema?.properties)return;for(let[key,keySchema]of Object.entries(schema.properties))obj[key]??=keySchema.default},createDynamicHandler=(app)=>{let{mapResponse:mapResponse3,mapEarlyResponse:mapEarlyResponse3}=app["~adapter"].handler,defaultHeader=app.setHeaders;return async(request)=>{let url=request.url,s=url.indexOf("/",11),qi=url.indexOf("?",s+1),path=qi===-1?url.substring(s):url.substring(s,qi),set2={cookie:{},status:200,headers:defaultHeader?{...defaultHeader}:{}},context=Object.assign({},app.singleton.decorator,{set:set2,store:app.singleton.store,request,path,qi,error:status,status,redirect}),hooks;try{if(app.event.request)for(let i=0;i<app.event.request.length;i++){let onRequest=app.event.request[i].fn,response2=onRequest(context);if(response2 instanceof Promise)response2=await response2;if(response2=mapEarlyResponse3(response2,set2),response2)return context.response=response2}let methodKey=request.method==="GET"&&request.headers.get("upgrade")?.toLowerCase()==="websocket"?"WS":request.method,handler=app.router.dynamic.find(request.method,path)??app.router.dynamic.find(methodKey,path)??app.router.dynamic.find("ALL",path);if(!handler)throw context.query=qi===-1?{}:parseQuery(url.substring(qi+1)),new NotFoundError;let{handle,validator,content,route}=handler.store;hooks=handler.store.hooks;let body;if(request.method!=="GET"&&request.method!=="HEAD")if(content)switch(content){case"application/json":body=await request.json();break;case"text/plain":body=await request.text();break;case"application/x-www-form-urlencoded":body=parseQuery(await request.text());break;case"application/octet-stream":body=await request.arrayBuffer();break;case"multipart/form-data":{body={};let form2=await request.formData();for(let key of form2.keys()){if(body[key])continue;let value=form2.getAll(key);if(value.length===1)body[key]=value[0];else body[key]=value}break}}else{let contentType;if(request.body)contentType=request.headers.get("content-type");if(contentType){let index=contentType.indexOf(";");if(index!==-1)contentType=contentType.slice(0,index);if(context.contentType=contentType,hooks.parse)for(let i=0;i<hooks.parse.length;i++){let hook=hooks.parse[i].fn;if(typeof hook==="string")switch(hook){case"json":case"application/json":body=await request.json();break;case"text":case"text/plain":body=await request.text();break;case"urlencoded":case"application/x-www-form-urlencoded":body=parseQuery(await request.text());break;case"arrayBuffer":case"application/octet-stream":body=await request.arrayBuffer();break;case"formdata":case"multipart/form-data":{body={};let form2=await request.formData();for(let key of form2.keys()){if(body[key])continue;let value=form2.getAll(key);if(value.length===1)body[key]=value[0];else body[key]=value}break}default:{let parser=app["~parser"][hook];if(parser){let temp=parser(context,contentType);if(temp instanceof Promise)temp=await temp;if(temp){body=temp;break}}break}}else{let temp=hook(context,contentType);if(temp instanceof Promise)temp=await temp;if(temp){body=temp;break}}}if(delete context.contentType,body===void 0)switch(contentType){case"application/json":body=await request.json();break;case"text/plain":body=await request.text();break;case"application/x-www-form-urlencoded":body=parseQuery(await request.text());break;case"application/octet-stream":body=await request.arrayBuffer();break;case"multipart/form-data":{body={};let form2=await request.formData();for(let key of form2.keys()){if(body[key])continue;let value=form2.getAll(key);if(value.length===1)body[key]=value[0];else body[key]=value}break}}}}context.route=route,context.body=body,context.params=handler?.params||void 0,context.query=qi===-1?{}:parseQuery(url.substring(qi+1)),context.headers={};for(let[key,value]of request.headers.entries())context.headers[key]=value;let cookieMeta={domain:app.config.cookie?.domain??validator?.cookie?.config.domain,expires:app.config.cookie?.expires??validator?.cookie?.config.expires,httpOnly:app.config.cookie?.httpOnly??validator?.cookie?.config.httpOnly,maxAge:app.config.cookie?.maxAge??validator?.cookie?.config.maxAge,path:app.config.cookie?.path??validator?.cookie?.config.path,priority:app.config.cookie?.priority??validator?.cookie?.config.priority,partitioned:app.config.cookie?.partitioned??validator?.cookie?.config.partitioned,sameSite:app.config.cookie?.sameSite??validator?.cookie?.config.sameSite,secure:app.config.cookie?.secure??validator?.cookie?.config.secure,secrets:app.config.cookie?.secrets??validator?.cookie?.config.secrets,sign:app.config.cookie?.sign??validator?.cookie?.config.sign},cookieHeaderValue=request.headers.get("cookie");context.cookie=await parseCookie(context.set,cookieHeaderValue,cookieMeta);let headerValidator=validator?.createHeaders?.();if(headerValidator)injectDefaultValues(headerValidator,context.headers);let paramsValidator=validator?.createParams?.();if(paramsValidator)injectDefaultValues(paramsValidator,context.params);let queryValidator=validator?.createQuery?.();if(queryValidator)injectDefaultValues(queryValidator,context.query);if(hooks.transform)for(let i=0;i<hooks.transform.length;i++){let hook=hooks.transform[i],response2=hook.fn(context);if(response2 instanceof Promise)response2=await response2;if(response2 instanceof ElysiaCustomStatusResponse){let result=mapEarlyResponse3(response2,context.set);if(result)return context.response=result}if(hook.subType==="derive")Object.assign(context,response2)}if(validator){if(headerValidator){let _header=structuredClone(context.headers);for(let[key,value]of request.headers)_header[key]=value;if(validator.headers.Check(_header)===!1)throw new ValidationError("header",validator.headers,_header)}else if(validator.headers?.Decode)context.headers=validator.headers.Decode(context.headers);if(paramsValidator?.Check(context.params)===!1)throw new ValidationError("params",validator.params,context.params);else if(validator.params?.Decode)context.params=validator.params.Decode(context.params);if(validator.query?.schema){let schema=validator.query.schema;if(schema.$defs?.[schema.$ref])schema=schema.$defs[schema.$ref];let properties=schema.properties;for(let property of Object.keys(properties)){let value=properties[property];if((value.type==="array"||value.items?.type==="string")&&typeof context.query[property]==="string"&&context.query[property])context.query[property]=context.query[property].split(",")}}if(queryValidator?.Check(context.query)===!1)throw new ValidationError("query",validator.query,context.query);else if(validator.query?.Decode)context.query=validator.query.Decode(context.query);if(validator.createCookie?.()){let cookieValue={};for(let[key,value]of Object.entries(context.cookie))cookieValue[key]=value.value;if(validator.cookie.Check(cookieValue)===!1)throw new ValidationError("cookie",validator.cookie,cookieValue);else if(validator.cookie?.Decode)cookieValue=validator.cookie.Decode(cookieValue)}if(validator.createBody?.()?.Check(body)===!1)throw new ValidationError("body",validator.body,body);else if(validator.body?.Decode)context.body=validator.body.Decode(body)}if(hooks.beforeHandle)for(let i=0;i<hooks.beforeHandle.length;i++){let hook=hooks.beforeHandle[i],response2=hook.fn(context);if(response2 instanceof Promise)response2=await response2;if(response2 instanceof ElysiaCustomStatusResponse){let result=mapEarlyResponse3(response2,context.set);if(result)return context.response=result}if(hook.subType==="resolve"){Object.assign(context,response2);continue}if(response2!==void 0){if(context.response=response2,hooks.afterHandle)for(let i2=0;i2<hooks.afterHandle.length;i2++){let newResponse=hooks.afterHandle[i2].fn(context);if(newResponse instanceof Promise)newResponse=await newResponse;if(newResponse)response2=newResponse}let result=mapEarlyResponse3(response2,context.set);if(result)return context.response=result}}let response=typeof handle==="function"?handle(context):handle;if(response instanceof Promise)response=await response;if(!hooks.afterHandle?.length){let isCustomStatuResponse=response instanceof ElysiaCustomStatusResponse,status2=isCustomStatuResponse?response.code:set2.status?typeof set2.status==="string"?StatusMap[set2.status]:set2.status:200;if(isCustomStatuResponse)set2.status=status2,response=response.response;let responseValidator=validator?.createResponse?.()?.[status2];if(responseValidator?.Check(response)===!1)if(responseValidator?.Clean){let temp=responseValidator.Clean(response);if(responseValidator?.Check(temp)===!1)throw new ValidationError("response",responseValidator,response);response=temp}else throw new ValidationError("response",responseValidator,response);if(responseValidator?.Encode)response=responseValidator.Encode(response);if(responseValidator?.Clean)response=responseValidator.Clean(response)}else{context.response=response;for(let i=0;i<hooks.afterHandle.length;i++){let response2=hooks.afterHandle[i].fn(context);if(response2 instanceof Promise)response2=await response2;let isCustomStatuResponse=response2 instanceof ElysiaCustomStatusResponse,status2=isCustomStatuResponse?response2.code:set2.status?typeof set2.status==="string"?StatusMap[set2.status]:set2.status:200;if(isCustomStatuResponse)set2.status=status2,response2=response2.response;let responseValidator=validator?.createResponse?.()?.[status2];if(responseValidator?.Check(response2)===!1)if(responseValidator?.Clean){let temp=responseValidator.Clean(response2);if(responseValidator?.Check(temp)===!1)throw new ValidationError("response",responseValidator,response2);response2=temp}else throw new ValidationError("response",responseValidator,response2);if(responseValidator?.Encode)context.response=response2=responseValidator.Encode(response2);if(responseValidator?.Clean)context.response=response2=responseValidator.Clean(response2);let result=mapEarlyResponse3(response2,context.set);if(result!==void 0)return context.response=result}}if(context.set.cookie&&cookieMeta?.sign){let secret=!cookieMeta.secrets?void 0:typeof cookieMeta.secrets==="string"?cookieMeta.secrets:cookieMeta.secrets[0];if(cookieMeta.sign===!0){if(secret)for(let[key,cookie]of Object.entries(context.set.cookie))context.set.cookie[key].value=await signCookie(cookie.value,secret)}else{let properties=validator?.cookie?.schema?.properties;if(secret)for(let name of cookieMeta.sign){if(!(name in properties))continue;if(context.set.cookie[name]?.value)context.set.cookie[name].value=await signCookie(context.set.cookie[name].value,secret)}}}return mapResponse3(context.response=response,context.set)}catch(error){let reportedError=error instanceof TransformDecodeError&&error.error?error.error:error;return app.handleError(context,reportedError)}finally{let afterResponses=hooks?hooks.afterResponse:app.event.afterResponse;if(afterResponses)if(hasSetImmediate)setImmediate(async()=>{for(let afterResponse of afterResponses)await afterResponse.fn(context)});else Promise.resolve().then(async()=>{for(let afterResponse of afterResponses)await afterResponse.fn(context)})}}},createDynamicErrorHandler=(app)=>{let{mapResponse:mapResponse3}=app["~adapter"].handler;return async(context,error)=>{let errorContext=Object.assign(context,{error,code:error.code});if(errorContext.set=context.set,typeof error?.toResponse==="function"&&!(error instanceof ValidationError)&&!(error instanceof TransformDecodeError))try{let raw=error.toResponse();if(typeof raw?.then==="function")raw=await raw;if(raw instanceof Response)context.set.status=raw.status;context.response=raw}catch(toResponseError){}if(!context.response&&app.event.error)for(let i=0;i<app.event.error.length;i++){let response=app.event.error[i].fn(errorContext);if(response instanceof Promise)response=await response;if(response!==void 0&&response!==null)return context.response=mapResponse3(response,context.set)}if(context.response){if(app.event.mapResponse)for(let i=0;i<app.event.mapResponse.length;i++){let response=app.event.mapResponse[i].fn(errorContext);if(response instanceof Promise)response=await response;if(response!==void 0&&response!==null)context.response=response}return mapResponse3(context.response,context.set)}return context.set.status=error.status??500,mapResponse3(typeof error.cause==="string"?error.cause:error.message,context.set)}};class Elysia{config;server=null;dependencies={};"~Prefix"="";"~Singleton"=null;"~Definitions"=null;"~Metadata"=null;"~Ephemeral"=null;"~Volatile"=null;"~Routes"=null;singleton={decorator:{},store:{},derive:{},resolve:{}};get store(){return this.singleton.store}get decorator(){return this.singleton.decorator}definitions={typebox:t.Module({}),type:{},error:{}};extender={macro:{},higherOrderFunctions:[]};validator={global:null,scoped:null,local:null,getCandidate(){if(!this.global&&!this.scoped&&!this.local)return{body:void 0,headers:void 0,params:void 0,query:void 0,cookie:void 0,response:void 0};return mergeSchemaValidator(mergeSchemaValidator(this.global,this.scoped),this.local)}};standaloneValidator={global:null,scoped:null,local:null};event={};telemetry;router={"~http":void 0,get http(){if(!this["~http"])this["~http"]=new _({lazy:!0,onParam:import_fast_decode_uri_component4.default});return this["~http"]},"~dynamic":void 0,get dynamic(){if(!this["~dynamic"])this["~dynamic"]=new _({onParam:import_fast_decode_uri_component4.default});return this["~dynamic"]},static:{},response:{},history:[]};routeTree={};get routes(){return this.router.history}getGlobalRoutes(){return this.router.history}getGlobalDefinitions(){return this.definitions}inference={body:!1,cookie:!1,headers:!1,query:!1,set:!1,server:!1,path:!1,route:!1,url:!1};getServer(){return this.server}getParent(){return null}"~parser"={};_promisedModules;get promisedModules(){if(!this._promisedModules)this._promisedModules=new PromiseGroup(console.error,()=>{});return this._promisedModules}constructor(config={}){if(config.tags)if(!config.detail)config.detail={tags:config.tags};else config.detail.tags=config.tags;if(this.config={aot:env2.ELYSIA_AOT!=="false",nativeStaticResponse:!0,encodeSchema:!0,normalize:!0,...config,prefix:config.prefix?config.prefix.charCodeAt(0)===47?config.prefix:`/${config.prefix}`:void 0,cookie:{path:"/",...config?.cookie},experimental:config?.experimental??{},seed:config?.seed===void 0?"":config?.seed},this["~adapter"]=config.adapter??(typeof Bun<"u"?BunAdapter:WebStandardAdapter),config?.analytic&&(config?.name||config?.seed!==void 0))this.telemetry={stack:Error().stack}}"~adapter";env(model,_env=env2){if(getSchemaValidator(model,{modules:this.definitions.typebox,dynamic:!0,additionalProperties:!0,coerce:!0,sanitize:()=>this.config.sanitize}).Check(_env)===!1){let error=new ValidationError("env",model,_env);throw Error(error.all.map((x)=>x.summary).join(`
`))}return this}wrap(fn){return this.extender.higherOrderFunctions.push({checksum:checksum(JSON.stringify({name:this.config.name,seed:this.config.seed,content:fn.toString()})),fn}),this}get models(){let models={};for(let name of Object.keys(this.definitions.type))models[name]=getSchemaValidator(this.definitions.typebox.Import(name));return models.modules=this.definitions.typebox,models}add(method,path,handle,localHook,options){let skipPrefix=options?.skipPrefix??!1,allowMeta=options?.allowMeta??!1;localHook??={},this.applyMacro(localHook);let standaloneValidators=[];if(localHook.standaloneValidator)standaloneValidators=standaloneValidators.concat(localHook.standaloneValidator);if(this.standaloneValidator.local)standaloneValidators=standaloneValidators.concat(this.standaloneValidator.local);if(this.standaloneValidator.scoped)standaloneValidators=standaloneValidators.concat(this.standaloneValidator.scoped);if(this.standaloneValidator.global)standaloneValidators=standaloneValidators.concat(this.standaloneValidator.global);if(path!==""&&path.charCodeAt(0)!==47)path="/"+path;if(this.config.prefix&&!skipPrefix)path=this.config.prefix+path;if(localHook?.type)switch(localHook.type){case"text":localHook.type="text/plain";break;case"json":localHook.type="application/json";break;case"formdata":localHook.type="multipart/form-data";break;case"urlencoded":localHook.type="application/x-www-form-urlencoded";break;case"arrayBuffer":localHook.type="application/octet-stream";break;default:break}let instanceValidator=this.validator.getCandidate(),cloned={body:localHook?.body??instanceValidator?.body,headers:localHook?.headers??instanceValidator?.headers,params:localHook?.params??instanceValidator?.params,query:localHook?.query??instanceValidator?.query,cookie:localHook?.cookie??instanceValidator?.cookie,response:localHook?.response??instanceValidator?.response},shouldPrecompile=this.config.precompile===!0||typeof this.config.precompile==="object"&&this.config.precompile.compose===!0,createValidator=()=>{let models=this.definitions.type,dynamic=!this.config.aot,normalize=this.config.normalize,modules=this.definitions.typebox,sanitize2=()=>this.config.sanitize,cookieValidator=()=>{if(cloned.cookie||standaloneValidators.find((x)=>x.cookie))return getCookieValidator({modules,validator:cloned.cookie,defaultConfig:this.config.cookie,normalize,config:cloned.cookie?.config??{},dynamic,models,validators:standaloneValidators.map((x)=>x.cookie),sanitize:sanitize2})};return shouldPrecompile?{body:getSchemaValidator(cloned.body,{modules,dynamic,models,normalize,additionalCoerce:(()=>{let resolved=resolveSchema(cloned.body,models,modules);return resolved&&Kind in resolved&&(hasType("File",resolved)||hasType("Files",resolved))?coerceFormData():coercePrimitiveRoot()})(),validators:standaloneValidators.map((x)=>x.body),sanitize:sanitize2}),headers:getSchemaValidator(cloned.headers,{modules,dynamic,models,additionalProperties:!0,coerce:!0,additionalCoerce:stringToStructureCoercions(),validators:standaloneValidators.map((x)=>x.headers),sanitize:sanitize2}),params:getSchemaValidator(cloned.params,{modules,dynamic,models,coerce:!0,additionalCoerce:stringToStructureCoercions(),validators:standaloneValidators.map((x)=>x.params),sanitize:sanitize2}),query:getSchemaValidator(cloned.query,{modules,dynamic,models,normalize,coerce:!0,additionalCoerce:queryCoercions(),validators:standaloneValidators.map((x)=>x.query),sanitize:sanitize2}),cookie:cookieValidator(),response:getResponseSchemaValidator(cloned.response,{modules,dynamic,models,normalize,validators:standaloneValidators.map((x)=>x.response),sanitize:sanitize2})}:{createBody(){if(this.body)return this.body;return this.body=getSchemaValidator(cloned.body,{modules,dynamic,models,normalize,additionalCoerce:(()=>{let resolved=resolveSchema(cloned.body,models,modules);return resolved&&Kind in resolved&&(hasType("File",resolved)||hasType("Files",resolved))?coerceFormData():coercePrimitiveRoot()})(),validators:standaloneValidators.map((x)=>x.body),sanitize:sanitize2})},createHeaders(){if(this.headers)return this.headers;return this.headers=getSchemaValidator(cloned.headers,{modules,dynamic,models,normalize,additionalProperties:!normalize,coerce:!0,additionalCoerce:stringToStructureCoercions(),validators:standaloneValidators.map((x)=>x.headers),sanitize:sanitize2})},createParams(){if(this.params)return this.params;return this.params=getSchemaValidator(cloned.params,{modules,dynamic,models,normalize,coerce:!0,additionalCoerce:stringToStructureCoercions(),validators:standaloneValidators.map((x)=>x.params),sanitize:sanitize2})},createQuery(){if(this.query)return this.query;return this.query=getSchemaValidator(cloned.query,{modules,dynamic,models,normalize,coerce:!0,additionalCoerce:queryCoercions(),validators:standaloneValidators.map((x)=>x.query),sanitize:sanitize2})},createCookie(){if(this.cookie)return this.cookie;return this.cookie=cookieValidator()},createResponse(){if(this.response)return this.response;return this.response=getResponseSchemaValidator(cloned.response,{modules,dynamic,models,normalize,validators:standaloneValidators.map((x)=>x.response),sanitize:sanitize2})}}};if(instanceValidator.body||instanceValidator.cookie||instanceValidator.headers||instanceValidator.params||instanceValidator.query||instanceValidator.response)localHook=mergeHook(localHook,instanceValidator);if(localHook.tags)if(!localHook.detail)localHook.detail={tags:localHook.tags};else localHook.detail.tags=localHook.tags;if(isNotEmpty(this.config.detail))localHook.detail=mergeDeep(Object.assign({},this.config.detail),localHook.detail);let hooks=isNotEmpty(this.event)?mergeHook(this.event,localHookToLifeCycleStore(localHook)):{...lifeCycleToArray(localHookToLifeCycleStore(localHook))};if(standaloneValidators.length)Object.assign(hooks,{standaloneValidator:standaloneValidators});if(this.config.aot===!1){let validator=createValidator();this.router.dynamic.add(method,path,{validator,hooks,content:localHook?.type,handle,route:path});let encoded=encodePath(path,{dynamic:!0});if(path!==encoded)this.router.dynamic.add(method,encoded,{validator,hooks,content:localHook?.type,handle,route:path});if(!this.config.strictPath){let loosePath=getLoosePath(path);this.router.dynamic.add(method,loosePath,{validator,hooks,content:localHook?.type,handle,route:path});let encoded2=encodePath(loosePath);if(loosePath!==encoded2)this.router.dynamic.add(method,loosePath,{validator,hooks,content:localHook?.type,handle,route:path})}this.router.history.push({method,path,composed:null,handler:handle,compile:void 0,hooks});return}let adapter=this["~adapter"].handler,nativeStaticHandler=typeof handle!=="function"?()=>{let context={redirect,request:this["~adapter"].isWebStandard?new Request(`http://ely.sia${path}`,{method}):void 0,server:null,set:{headers:Object.assign({},this.setHeaders)},status,store:this.store};try{this.event.request?.map((x)=>{if(typeof x.fn==="function")return x.fn(context);if(typeof x==="function")return x(context)})}catch(error){let res;if(context.error=error,this.event.error?.some((x)=>{if(typeof x.fn==="function")return res=x.fn(context);if(typeof x==="function")return res=x(context)}),res!==void 0)handle=res}let fn=adapter.createNativeStaticHandler?.(handle,hooks,context.set);return fn instanceof Promise?fn.then((fn2)=>{if(fn2)return fn2}):fn?.()}:void 0,useNativeStaticResponse=this.config.nativeStaticResponse===!0,addResponsePath=(path2)=>{if(!useNativeStaticResponse||!nativeStaticHandler)return;if(supportPerMethodInlineHandler)if(this.router.response[path2])this.router.response[path2][method]=nativeStaticHandler();else this.router.response[path2]={[method]:nativeStaticHandler()};else this.router.response[path2]=nativeStaticHandler()};addResponsePath(path);let _compiled,compile2=()=>{if(_compiled)return _compiled;let compiled=composeHandler({app:this,path,method,hooks,validator:createValidator(),handler:typeof handle!=="function"&&typeof adapter.createStaticHandler!=="function"?()=>handle:handle,allowMeta,inference:this.inference});if(this.router.history[index])_compiled=this.router.history[index].composed=compiled;return compiled},oldIndex;if(`${method}_${path}`in this.routeTree)for(let i=0;i<this.router.history.length;i++){let route2=this.router.history[i];if(route2.path===path&&route2.method===method){oldIndex=i;break}}else this.routeTree[`${method}_${path}`]=this.router.history.length;let index=oldIndex??this.router.history.length,route=this.router.history,mainHandler=shouldPrecompile?compile2():(ctx)=>_compiled?_compiled(ctx):(route[index].composed=compile2())(ctx);if(oldIndex!==void 0)this.router.history[oldIndex]=Object.assign({method,path,composed:mainHandler,compile:compile2,handler:handle,hooks},standaloneValidators.length?{standaloneValidators}:void 0,localHook.webSocket?{websocket:localHook.websocket}:void 0);else this.router.history.push(Object.assign({method,path,composed:mainHandler,compile:compile2,handler:handle,hooks},localHook.webSocket?{websocket:localHook.websocket}:void 0));let handler={handler:shouldPrecompile?route[index].composed:void 0,compile(){return this.handler=compile2()}},staticRouter=this.router.static,isStaticPath=path.indexOf(":")===-1&&path.indexOf("*")===-1;if(method==="WS"){if(isStaticPath){if(path in staticRouter)staticRouter[path][method]=index;else staticRouter[path]={[method]:index};return}if(this.router.http.add("WS",path,handler),!this.config.strictPath)this.router.http.add("WS",getLoosePath(path),handler);let encoded=encodePath(path,{dynamic:!0});if(path!==encoded)this.router.http.add("WS",encoded,handler);return}if(isStaticPath){if(path in staticRouter)staticRouter[path][method]=index;else staticRouter[path]={[method]:index};if(!this.config.strictPath)addResponsePath(getLoosePath(path))}else{if(this.router.http.add(method,path,handler),!this.config.strictPath){let loosePath=getLoosePath(path);addResponsePath(loosePath),this.router.http.add(method,loosePath,handler)}let encoded=encodePath(path,{dynamic:!0});if(path!==encoded)this.router.http.add(method,encoded,handler),addResponsePath(encoded)}}setHeaders;headers(header){if(!header)return this;if(!this.setHeaders)this.setHeaders={};return this.setHeaders=mergeDeep(this.setHeaders,header),this}onStart(handler){return this.on("start",handler),this}onRequest(handler){return this.on("request",handler),this}onParse(options,handler){if(!handler){if(typeof options==="string")return this.on("parse",this["~parser"][options]);return this.on("parse",options)}return this.on(options,"parse",handler)}parser(name,parser){return this["~parser"][name]=parser,this}onTransform(options,handler){if(!handler)return this.on("transform",options);return this.on(options,"transform",handler)}resolve(optionsOrResolve,resolve){if(!resolve)resolve=optionsOrResolve,optionsOrResolve={as:"local"};let hook={subType:"resolve",fn:resolve};return this.onBeforeHandle(optionsOrResolve,hook)}mapResolve(optionsOrResolve,mapper){if(!mapper)mapper=optionsOrResolve,optionsOrResolve={as:"local"};let hook={subType:"mapResolve",fn:mapper};return this.onBeforeHandle(optionsOrResolve,hook)}onBeforeHandle(options,handler){if(!handler)return this.on("beforeHandle",options);return this.on(options,"beforeHandle",handler)}onAfterHandle(options,handler){if(!handler)return this.on("afterHandle",options);return this.on(options,"afterHandle",handler)}mapResponse(options,handler){if(!handler)return this.on("mapResponse",options);return this.on(options,"mapResponse",handler)}onAfterResponse(options,handler){if(!handler)return this.on("afterResponse",options);return this.on(options,"afterResponse",handler)}trace(options,handler){if(!handler)handler=options,options={as:"local"};if(!Array.isArray(handler))handler=[handler];for(let fn of handler)this.on(options,"trace",createTracer(fn));return this}error(name,error){switch(typeof name){case"string":return error.prototype[ERROR_CODE]=name,this.definitions.error[name]=error,this;case"function":return this.definitions.error=name(this.definitions.error),this}for(let[code,error2]of Object.entries(name))error2.prototype[ERROR_CODE]=code,this.definitions.error[code]=error2;return this}onError(options,handler){if(!handler)return this.on("error",options);return this.on(options,"error",handler)}onStop(handler){return this.on("stop",handler),this}on(optionsOrType,typeOrHandlers,handlers){let type;switch(typeof optionsOrType){case"string":type=optionsOrType,handlers=typeOrHandlers;break;case"object":if(type=typeOrHandlers,!Array.isArray(typeOrHandlers)&&typeof typeOrHandlers==="object")handlers=typeOrHandlers;break}if(Array.isArray(handlers))handlers=fnToContainer(handlers);else if(typeof handlers==="function")handlers=[{fn:handlers}];else handlers=[handlers];let handles=handlers;for(let handle of handles)if(handle.scope=typeof optionsOrType==="string"?"local":optionsOrType?.as??"local",type==="resolve"||type==="derive")handle.subType=type;if(type!=="trace")this.inference=sucrose({[type]:handles.map((x)=>x.fn)},this.inference,this.config.sucrose);for(let handle of handles){let fn=asHookType(handle,"global",{skipIfHasType:!0});switch(type){case"start":this.event.start??=[],this.event.start.push(fn);break;case"request":this.event.request??=[],this.event.request.push(fn);break;case"parse":this.event.parse??=[],this.event.parse.push(fn);break;case"transform":this.event.transform??=[],this.event.transform.push(fn);break;case"derive":this.event.transform??=[],this.event.transform.push(fnToContainer(fn,"derive"));break;case"beforeHandle":this.event.beforeHandle??=[],this.event.beforeHandle.push(fn);break;case"resolve":this.event.beforeHandle??=[],this.event.beforeHandle.push(fnToContainer(fn,"resolve"));break;case"afterHandle":this.event.afterHandle??=[],this.event.afterHandle.push(fn);break;case"mapResponse":this.event.mapResponse??=[],this.event.mapResponse.push(fn);break;case"afterResponse":this.event.afterResponse??=[],this.event.afterResponse.push(fn);break;case"trace":this.event.trace??=[],this.event.trace.push(fn);break;case"error":this.event.error??=[],this.event.error.push(fn);break;case"stop":this.event.stop??=[],this.event.stop.push(fn);break}}return this}as(type){if(promoteEvent(this.event.parse,type),promoteEvent(this.event.transform,type),promoteEvent(this.event.beforeHandle,type),promoteEvent(this.event.afterHandle,type),promoteEvent(this.event.mapResponse,type),promoteEvent(this.event.afterResponse,type),promoteEvent(this.event.trace,type),promoteEvent(this.event.error,type),type==="scoped"){if(this.validator.scoped=mergeSchemaValidator(this.validator.scoped,this.validator.local),this.validator.local=null,this.standaloneValidator.local!==null)this.standaloneValidator.scoped||=[],this.standaloneValidator.scoped.push(...this.standaloneValidator.local),this.standaloneValidator.local=null}else if(type==="global"){if(this.validator.global=mergeSchemaValidator(this.validator.global,mergeSchemaValidator(this.validator.scoped,this.validator.local)),this.validator.scoped=null,this.validator.local=null,this.standaloneValidator.local!==null)this.standaloneValidator.scoped||=[],this.standaloneValidator.scoped.push(...this.standaloneValidator.local),this.standaloneValidator.local=null;if(this.standaloneValidator.scoped!==null)this.standaloneValidator.global||=[],this.standaloneValidator.global.push(...this.standaloneValidator.scoped),this.standaloneValidator.scoped=null}return this}group(prefix,schemaOrRun,run){let instance=new Elysia({...this.config,prefix:""});instance.singleton={...this.singleton},instance.definitions={...this.definitions},instance.getServer=()=>this.getServer(),instance.inference=cloneInference(this.inference),instance.extender={...this.extender},instance["~parser"]=this["~parser"],instance.standaloneValidator={local:[...this.standaloneValidator.local??[]],scoped:[...this.standaloneValidator.scoped??[]],global:[...this.standaloneValidator.global??[]]};let isSchema=typeof schemaOrRun==="object",sandbox=(isSchema?run:schemaOrRun)(instance);if(this.singleton=mergeDeep(this.singleton,instance.singleton),this.definitions=mergeDeep(this.definitions,instance.definitions),sandbox.event.request?.length)this.event.request=[...this.event.request||[],...sandbox.event.request||[]];if(sandbox.event.mapResponse?.length)this.event.mapResponse=[...this.event.mapResponse||[],...sandbox.event.mapResponse||[]];return this.model(sandbox.definitions.type),Object.values(instance.router.history).forEach(({method,path,handler,hooks})=>{if(path=(isSchema?"":this.config.prefix??"")+prefix+path,isSchema){let{body,headers,query,params,cookie,response,...hook}=schemaOrRun,localHook=hooks,hasStandaloneSchema=body||headers||query||params||cookie||response;this.add(method,path,handler,mergeHook(hook,{...localHook||{},error:!localHook.error?sandbox.event.error:Array.isArray(localHook.error)?[...localHook.error??[],...sandbox.event.error??[]]:[localHook.error,...sandbox.event.error??[]],standaloneValidator:!hasStandaloneSchema?localHook.standaloneValidator:[...localHook.standaloneValidator??[],{body,headers,query,params,cookie,response}]}),void 0)}else this.add(method,path,handler,mergeHook(hooks,{error:sandbox.event.error}),{skipPrefix:!0})}),this}guard(hook,run){if(!run){if(typeof hook==="object"){if(this.applyMacro(hook),hook.detail)if(this.config.detail)this.config.detail=mergeDeep(Object.assign({},this.config.detail),hook.detail);else this.config.detail=hook.detail;if(hook.tags)if(!this.config.detail)this.config.detail={tags:hook.tags};else this.config.detail.tags=hook.tags;let type=hook.as??"local";if(hook.schema==="standalone"){if(!this.standaloneValidator[type])this.standaloneValidator[type]=[];let response=!hook?.response?void 0:typeof hook.response==="string"||(Kind in hook.response)||("~standard"in hook.response)?{200:hook.response}:hook?.response;this.standaloneValidator[type].push({body:hook.body,headers:hook.headers,params:hook.params,query:hook.query,response,cookie:hook.cookie})}else this.validator[type]={body:hook.body??this.validator[type]?.body,headers:hook.headers??this.validator[type]?.headers,params:hook.params??this.validator[type]?.params,query:hook.query??this.validator[type]?.query,response:hook.response??this.validator[type]?.response,cookie:hook.cookie??this.validator[type]?.cookie};if(hook.parse)this.on({as:type},"parse",hook.parse);if(hook.transform)this.on({as:type},"transform",hook.transform);if(hook.derive)this.on({as:type},"derive",hook.derive);if(hook.beforeHandle)this.on({as:type},"beforeHandle",hook.beforeHandle);if(hook.resolve)this.on({as:type},"resolve",hook.resolve);if(hook.afterHandle)this.on({as:type},"afterHandle",hook.afterHandle);if(hook.mapResponse)this.on({as:type},"mapResponse",hook.mapResponse);if(hook.afterResponse)this.on({as:type},"afterResponse",hook.afterResponse);if(hook.error)this.on({as:type},"error",hook.error);return this}return this.guard({},hook)}let instance=new Elysia({...this.config,prefix:""});instance.singleton={...this.singleton},instance.definitions={...this.definitions},instance.inference=cloneInference(this.inference),instance.extender={...this.extender},instance.getServer=()=>this.getServer();let sandbox=run(instance);if(this.singleton=mergeDeep(this.singleton,instance.singleton),this.definitions=mergeDeep(this.definitions,instance.definitions),sandbox.getServer=()=>this.server,sandbox.event.request?.length)this.event.request=[...this.event.request||[],...sandbox.event.request||[]];if(sandbox.event.mapResponse?.length)this.event.mapResponse=[...this.event.mapResponse||[],...sandbox.event.mapResponse||[]];return this.model(sandbox.definitions.type),Object.values(instance.router.history).forEach(({method,path,handler,hooks:localHook})=>{let{body,headers,query,params,cookie,response,...guardHook}=hook,hasStandaloneSchema=body||headers||query||params||cookie||response;this.add(method,path,handler,mergeHook(guardHook,{...localHook||{},error:!localHook.error?sandbox.event.error:Array.isArray(localHook.error)?[...localHook.error??[],...sandbox.event.error??[]]:[localHook.error,...sandbox.event.error??[]],standaloneValidator:!hasStandaloneSchema?localHook.standaloneValidator:[...localHook.standaloneValidator??[],{body,headers,query,params,cookie,response}]}))}),this}use(plugin){if(!plugin)return this;if(Array.isArray(plugin)){let app=this;for(let p of plugin)app=app.use(p);return app}if(plugin instanceof Promise)return this.promisedModules.add(plugin.then((plugin2)=>{if(typeof plugin2==="function")return plugin2(this);if(plugin2 instanceof Elysia)return this._use(plugin2).compile();if(plugin2.constructor?.name==="Elysia")return this._use(plugin2).compile();if(typeof plugin2.default==="function")return plugin2.default(this);if(plugin2.default instanceof Elysia)return this._use(plugin2.default);if(plugin2.constructor?.name==="Elysia")return this._use(plugin2.default);if(plugin2.constructor?.name==="_Elysia")return this._use(plugin2.default);try{return this._use(plugin2.default)}catch(error){throw console.error('Invalid plugin type. Expected Elysia instance, function, or module with "default" as Elysia instance or function that returns Elysia instance.'),error}}).then((v)=>{if(v&&typeof v.compile==="function")v.compile();return v})),this;return this._use(plugin)}propagatePromiseModules(plugin){if(plugin.promisedModules.size<=0)return this;for(let promise of plugin.promisedModules.promises)this.promisedModules.add(promise.then((v)=>{if(!v)return;let t2=this._use(v);if(t2 instanceof Promise)return t2.then((v2)=>{if(v2)v2.compile();else v.compile()});return v.compile()}));return this}_use(plugin){if(typeof plugin==="function"){let instance=plugin(this);if(instance instanceof Promise)return this.promisedModules.add(instance.then((plugin2)=>{if(plugin2 instanceof Elysia){plugin2.getServer=()=>this.getServer(),plugin2.getGlobalRoutes=()=>this.getGlobalRoutes(),plugin2.getGlobalDefinitions=()=>this.getGlobalDefinitions(),plugin2.model(this.definitions.type),plugin2.error(this.definitions.error);for(let{method,path,handler,hooks}of Object.values(plugin2.router.history))this.add(method,path,handler,hooks,void 0);if(plugin2===this)return;return this.propagatePromiseModules(plugin2),plugin2}if(typeof plugin2==="function")return plugin2(this);if(typeof plugin2.default==="function")return plugin2.default(this);return this._use(plugin2)}).then((v)=>{if(v&&typeof v.compile==="function")v.compile();return v})),this;return instance}this.propagatePromiseModules(plugin);let name=plugin.config.name,seed=plugin.config.seed;if(plugin.getParent=()=>this,plugin.getServer=()=>this.getServer(),plugin.getGlobalRoutes=()=>this.getGlobalRoutes(),plugin.getGlobalDefinitions=()=>this.getGlobalDefinitions(),plugin.standaloneValidator?.scoped)if(this.standaloneValidator.local)this.standaloneValidator.local=this.standaloneValidator.local.concat(plugin.standaloneValidator.scoped);else this.standaloneValidator.local=plugin.standaloneValidator.scoped;if(plugin.standaloneValidator?.global)if(this.standaloneValidator.global)this.standaloneValidator.global=this.standaloneValidator.global.concat(plugin.standaloneValidator.global);else this.standaloneValidator.global=plugin.standaloneValidator.global;if(isNotEmpty(plugin["~parser"]))this["~parser"]={...plugin["~parser"],...this["~parser"]};if(plugin.setHeaders)this.headers(plugin.setHeaders);if(name){if(!(name in this.dependencies))this.dependencies[name]=[];let current=seed!==void 0?checksum(name+JSON.stringify(seed)):0;if(!this.dependencies[name].some(({checksum:checksum2})=>current===checksum2))this.extender.macro={...this.extender.macro,...plugin.extender.macro},this.extender.higherOrderFunctions=this.extender.higherOrderFunctions.concat(plugin.extender.higherOrderFunctions)}else{if(isNotEmpty(plugin.extender.macro))this.extender.macro={...this.extender.macro,...plugin.extender.macro};if(plugin.extender.higherOrderFunctions.length)this.extender.higherOrderFunctions=this.extender.higherOrderFunctions.concat(plugin.extender.higherOrderFunctions)}if(plugin.extender.higherOrderFunctions.length){deduplicateChecksum(this.extender.higherOrderFunctions);let hofHashes=[];for(let i=0;i<this.extender.higherOrderFunctions.length;i++){let hof=this.extender.higherOrderFunctions[i];if(hof.checksum){if(hofHashes.includes(hof.checksum))this.extender.higherOrderFunctions.splice(i,1),i--;hofHashes.push(hof.checksum)}}hofHashes.length=0}if(this.inference=mergeInference(this.inference,plugin.inference),isNotEmpty(plugin.singleton.decorator))this.decorate(plugin.singleton.decorator);if(isNotEmpty(plugin.singleton.store))this.state(plugin.singleton.store);if(isNotEmpty(plugin.definitions.type))this.model(plugin.definitions.type);if(isNotEmpty(plugin.definitions.error))this.error(plugin.definitions.error);if(isNotEmpty(plugin.extender.macro))this.extender.macro={...this.extender.macro,...plugin.extender.macro};for(let{method,path,handler,hooks}of Object.values(plugin.router.history))this.add(method,path,handler,hooks);if(name){if(!(name in this.dependencies))this.dependencies[name]=[];let current=seed!==void 0?checksum(name+JSON.stringify(seed)):0;if(this.dependencies[name].some(({checksum:checksum2})=>current===checksum2))return this;if(this.dependencies[name].push(this.config?.analytic?{name:plugin.config.name,seed:plugin.config.seed,checksum:current,dependencies:plugin.dependencies,stack:plugin.telemetry?.stack,routes:plugin.router.history,decorators:plugin.singleton,store:plugin.singleton.store,error:plugin.definitions.error,derive:plugin.event.transform?.filter((x)=>x?.subType==="derive").map((x)=>({fn:x.toString(),stack:Error().stack??""})),resolve:plugin.event.transform?.filter((x)=>x?.subType==="resolve").map((x)=>({fn:x.toString(),stack:Error().stack??""}))}:{name:plugin.config.name,seed:plugin.config.seed,checksum:current,dependencies:plugin.dependencies}),isNotEmpty(plugin.event))this.event=mergeLifeCycle(this.event,filterGlobalHook(plugin.event),current)}else if(isNotEmpty(plugin.event))this.event=mergeLifeCycle(this.event,filterGlobalHook(plugin.event));if(plugin.validator.global)this.validator.global=mergeHook(this.validator.global,{...plugin.validator.global});if(plugin.validator.scoped)this.validator.local=mergeHook(this.validator.local,{...plugin.validator.scoped});return this}macro(macroOrName,macro){if(typeof macroOrName==="string"&&!macro)throw Error("Macro function is required");if(typeof macroOrName==="string")this.extender.macro[macroOrName]=macro;else this.extender.macro={...this.extender.macro,...macroOrName};return this}applyMacro(localHook,appliable=localHook,{iteration=0,applied={}}={}){if(iteration>=16)return;let macro=this.extender.macro;for(let[key,value]of Object.entries(appliable)){if(key in macro===!1)continue;let macroHook=typeof macro[key]==="function"?macro[key](value):macro[key];if(!macroHook||typeof macro[key]==="object"&&value===!1)return;let seed=checksum(key+JSON.stringify(macroHook.seed??value));if(seed in applied)continue;applied[seed]=!0;for(let[k2,value2]of Object.entries(macroHook)){if(k2==="seed")continue;if(k2 in emptySchema){insertStandaloneValidator(localHook,k2,value2),delete localHook[key];continue}if(k2==="introspect"){value2?.(localHook),delete localHook[key];continue}if(k2==="detail"){if(!localHook.detail)localHook.detail={};localHook.detail=mergeDeep(localHook.detail,value2,{mergeArray:!0}),delete localHook[key];continue}if(k2 in macro){this.applyMacro(localHook,{[k2]:value2},{applied,iteration:iteration+1}),delete localHook[key];continue}if((k2==="derive"||k2==="resolve")&&typeof value2==="function")value2={fn:value2,subType:k2};switch(typeof localHook[k2]){case"function":localHook[k2]=[localHook[k2],value2];break;case"object":if(Array.isArray(localHook[k2]))localHook[k2].push(value2);else localHook[k2]=[localHook[k2],value2];break;case"undefined":localHook[k2]=value2;break}delete localHook[key]}}}mount(path,handleOrConfig,config){if(path instanceof Elysia||typeof path==="function"||path.length===0||path==="/"){let run=typeof path==="function"?path:path instanceof Elysia?path.compile().fetch:handleOrConfig instanceof Elysia?handleOrConfig.compile().fetch:typeof handleOrConfig==="function"?handleOrConfig:(()=>{throw Error("Invalid handler")})(),handler2=({request,path:path2})=>run(new Request(replaceUrlPath(request.url,path2),{method:request.method,headers:request.headers,signal:request.signal,credentials:request.credentials,referrerPolicy:request.referrerPolicy,duplex:request.duplex,redirect:request.redirect,mode:request.mode,keepalive:request.keepalive,integrity:request.integrity,body:request.body}));return this.route("ALL","/*",handler2,{parse:"none",...config,detail:{...config?.detail,hide:!0},config:{mount:run}}),this}let handle=handleOrConfig instanceof Elysia?handleOrConfig.compile().fetch:typeof handleOrConfig==="function"?handleOrConfig:(()=>{throw Error("Invalid handler")})(),length=path.length-(path.endsWith("*")?1:0),handler=({request,path:path2})=>handle(new Request(replaceUrlPath(request.url,path2.slice(length)||"/"),{method:request.method,headers:request.headers,signal:request.signal,credentials:request.credentials,referrerPolicy:request.referrerPolicy,duplex:request.duplex,redirect:request.redirect,mode:request.mode,keepalive:request.keepalive,integrity:request.integrity,body:request.body}));return this.route("ALL",path,handler,{parse:"none",...config,detail:{...config?.detail,hide:!0},config:{mount:handle}}),this.route("ALL",path+(path.endsWith("/")?"*":"/*"),handler,{parse:"none",...config,detail:{...config?.detail,hide:!0},config:{mount:handle}}),this}get(path,handler,hook){return this.add("GET",path,handler,hook),this}post(path,handler,hook){return this.add("POST",path,handler,hook),this}put(path,handler,hook){return this.add("PUT",path,handler,hook),this}patch(path,handler,hook){return this.add("PATCH",path,handler,hook),this}delete(path,handler,hook){return this.add("DELETE",path,handler,hook),this}options(path,handler,hook){return this.add("OPTIONS",path,handler,hook),this}all(path,handler,hook){return this.add("ALL",path,handler,hook),this}head(path,handler,hook){return this.add("HEAD",path,handler,hook),this}connect(path,handler,hook){return this.add("CONNECT",path,handler,hook),this}route(method,path,handler,hook){return this.add(method.toUpperCase(),path,handler,hook,hook?.config),this}ws(path,options){if(this["~adapter"].ws)this["~adapter"].ws(this,path,options);else console.warn("Current adapter doesn't support WebSocket");return this}state(options,name,value){if(name===void 0)value=options,options={as:"append"},name="";else if(value===void 0){if(typeof options==="string")value=name,name=options,options={as:"append"};else if(typeof options==="object")value=name,name=""}let{as}=options;if(typeof name!=="string")return this;switch(typeof value){case"object":if(!value||!isNotEmpty(value))return this;if(name){if(name in this.singleton.store)this.singleton.store[name]=mergeDeep(this.singleton.store[name],value,{override:as==="override"});else this.singleton.store[name]=value;return this}if(value===null)return this;return this.singleton.store=mergeDeep(this.singleton.store,value,{override:as==="override"}),this;case"function":if(name){if(as==="override"||!(name in this.singleton.store))this.singleton.store[name]=value}else this.singleton.store=value(this.singleton.store);return this;default:if(as==="override"||!(name in this.singleton.store))this.singleton.store[name]=value;return this}}decorate(options,name,value){if(name===void 0)value=options,options={as:"append"},name="";else if(value===void 0){if(typeof options==="string")value=name,name=options,options={as:"append"};else if(typeof options==="object")value=name,name=""}let{as}=options;if(typeof name!=="string")return this;switch(typeof value){case"object":if(name){if(name in this.singleton.decorator)this.singleton.decorator[name]=mergeDeep(this.singleton.decorator[name],value,{override:as==="override"});else this.singleton.decorator[name]=value;return this}if(value===null)return this;return this.singleton.decorator=mergeDeep(this.singleton.decorator,value,{override:as==="override"}),this;case"function":if(name){if(as==="override"||!(name in this.singleton.decorator))this.singleton.decorator[name]=value}else this.singleton.decorator=value(this.singleton.decorator);return this;default:if(as==="override"||!(name in this.singleton.decorator))this.singleton.decorator[name]=value;return this}}derive(optionsOrTransform,transform2){if(!transform2)transform2=optionsOrTransform,optionsOrTransform={as:"local"};let hook={subType:"derive",fn:transform2};return this.onTransform(optionsOrTransform,hook)}model(name,model){let onlyTypebox=(a)=>{let res={};for(let key in a)if(!("~standard"in a[key]))res[key]=a[key];return res};switch(typeof name){case"object":let parsedTypebox={},kvs=Object.entries(name);if(!kvs.length)return this;for(let[key,value]of kvs){if(key in this.definitions.type)continue;if("~standard"in value)this.definitions.type[key]=value;else parsedTypebox[key]=this.definitions.type[key]=value,parsedTypebox[key].$id??=`#/components/schemas/${key}`}return this.definitions.typebox=t.Module({...this.definitions.typebox.$defs,...parsedTypebox}),this;case"function":let result=name(this.definitions.type);return this.definitions.type=result,this.definitions.typebox=t.Module(onlyTypebox(result)),this;case"string":if(!model)break;if(this.definitions.type[name]=model,"~standard"in model)return this;let newModel={...model,id:model.$id??`#/components/schemas/${name}`};return this.definitions.typebox=t.Module({...this.definitions.typebox.$defs,...newModel}),this}if(!model)return this;if(this.definitions.type[name]=model,"~standard"in model)return this;return this.definitions.typebox=t.Module({...this.definitions.typebox.$defs,[name]:model}),this}Ref(key){return t.Ref(key)}mapDerive(optionsOrDerive,mapper){if(!mapper)mapper=optionsOrDerive,optionsOrDerive={as:"local"};let hook={subType:"mapDerive",fn:mapper};return this.onTransform(optionsOrDerive,hook)}affix(base,type,word){if(word==="")return this;let delimieter=["_","-"," "],capitalize=(word2)=>word2[0].toUpperCase()+word2.slice(1),joinKey=base==="prefix"?(prefix,word2)=>delimieter.includes(prefix.at(-1)??"")?prefix+word2:prefix+capitalize(word2):delimieter.includes(word.at(-1)??"")?(suffix,word2)=>word2+suffix:(suffix,word2)=>word2+capitalize(suffix),remap=(type2)=>{let store={};switch(type2){case"decorator":for(let key in this.singleton.decorator)store[joinKey(word,key)]=this.singleton.decorator[key];this.singleton.decorator=store;break;case"state":for(let key in this.singleton.store)store[joinKey(word,key)]=this.singleton.store[key];this.singleton.store=store;break;case"model":for(let key in this.definitions.type)store[joinKey(word,key)]=this.definitions.type[key];this.definitions.type=store;break;case"error":for(let key in this.definitions.error)store[joinKey(word,key)]=this.definitions.error[key];this.definitions.error=store;break}},types=Array.isArray(type)?type:[type];for(let type2 of types.some((x)=>x==="all")?["decorator","state","model","error"]:types)remap(type2);return this}prefix(type,word){return this.affix("prefix",type,word)}suffix(type,word){return this.affix("suffix",type,word)}compile(){if(this["~adapter"].beforeCompile?.(this),this["~adapter"].isWebStandard){if(this._handle=this.config.aot?composeGeneralHandler(this):createDynamicHandler(this),Object.defineProperty(this,"fetch",{value:this._handle,configurable:!0,writable:!0}),typeof this.server?.reload==="function")this.server.reload({...this.server||{},fetch:this.fetch});return this}if(typeof this.server?.reload==="function")this.server.reload(this.server||{});return this._handle=composeGeneralHandler(this),this}handle=async(request)=>this.fetch(request);get fetch(){let fetch2=this.config.aot?composeGeneralHandler(this):createDynamicHandler(this);return Object.defineProperty(this,"fetch",{value:fetch2,configurable:!0,writable:!0}),fetch2}handleError=async(context,error)=>{return(this.handleError=this.config.aot?composeErrorHandler(this):createDynamicErrorHandler(this))(context,error)};listen=(options,callback)=>{return this["~adapter"].listen(this)(options,callback),this};stop=async(closeActiveConnections)=>{return await this["~adapter"].stop?.(this,closeActiveConnections),this};[Symbol.dispose]=()=>{if(this.server)this.stop()};get modules(){return this.promisedModules}}var a=`/* basic theme */
:root {
  --scalar-text-decoration: underline;
  --scalar-text-decoration-hover: underline;
}
.light-mode,
.light-mode .dark-mode {
  --scalar-background-1: #f9f9f9;
  --scalar-background-2: #f1f1f1;
  --scalar-background-3: #e7e7e7;
  --scalar-background-card: #fff;

  --scalar-color-1: #2a2f45;
  --scalar-color-2: #757575;
  --scalar-color-3: #8e8e8e;

  --scalar-color-accent: var(--scalar-color-1);
  --scalar-background-accent: var(--scalar-background-3);

  --scalar-border-color: rgba(0, 0, 0, 0.1);
}
.dark-mode {
  --scalar-background-1: #131313;
  --scalar-background-2: #1d1d1d;
  --scalar-background-3: #272727;
  --scalar-background-card: #1d1d1d;

  --scalar-color-1: rgba(255, 255, 255, 0.9);
  --scalar-color-2: rgba(255, 255, 255, 0.62);
  --scalar-color-3: rgba(255, 255, 255, 0.44);

  --scalar-color-accent: var(--scalar-color-1);
  --scalar-background-accent: var(--scalar-background-3);

  --scalar-border-color: #2a2b2a;
}
/* Document Sidebar */
.light-mode .t-doc__sidebar,
.dark-mode .t-doc__sidebar {
  --scalar-sidebar-background-1: var(--scalar-background-1);
  --scalar-sidebar-color-1: var(--scalar-color-1);
  --scalar-sidebar-color-2: var(--scalar-color-2);
  --scalar-sidebar-border-color: var(--scalar-border-color);

  --scalar-sidebar-item-hover-background: var(--scalar-background-2);
  --scalar-sidebar-item-hover-color: currentColor;

  --scalar-sidebar-item-active-background: var(--scalar-background-accent);
  --scalar-sidebar-color-active: var(--scalar-color-accent);

  --scalar-sidebar-search-background: transparent;
  --scalar-sidebar-search-color: var(--scalar-color-3);
  --scalar-sidebar-search-border-color: var(--scalar-border-color);
}
/* advanced */
.light-mode .dark-mode,
.light-mode {
  --scalar-color-green: #069061;
  --scalar-color-red: #ef0006;
  --scalar-color-yellow: #edbe20;
  --scalar-color-blue: #0082d0;
  --scalar-color-orange: #fb892c;
  --scalar-color-purple: #5203d1;

  --scalar-button-1: rgba(0, 0, 0, 1);
  --scalar-button-1-hover: rgba(0, 0, 0, 0.8);
  --scalar-button-1-color: rgba(255, 255, 255, 0.9);
}
.dark-mode {
  --scalar-color-green: #00b648;
  --scalar-color-red: #dd2f2c;
  --scalar-color-yellow: #ffc90d;
  --scalar-color-blue: #4eb3ec;
  --scalar-color-orange: #ff8d4d;
  --scalar-color-purple: #b191f9;

  --scalar-button-1: rgba(255, 255, 255, 1);
  --scalar-button-1-hover: rgba(255, 255, 255, 0.9);
  --scalar-button-1-color: black;
}

.scalar-api-client__item,
.scalar-card,
.dark-mode .dark-mode.scalar-card {
  --scalar-background-1: var(--scalar-background-card);
  --scalar-background-2: var(--scalar-background-1);
  --scalar-background-3: var(--scalar-background-1);
}
.dark-mode .dark-mode.scalar-card {
  --scalar-background-3: var(--scalar-background-3);
}
.t-doc__sidebar {
  --scalar-color-green: var(--scalar-color-1);
  --scalar-color-red: var(--scalar-color-1);
  --scalar-color-yellow: var(--scalar-color-1);
  --scalar-color-blue: var(--scalar-color-1);
  --scalar-color-orange: var(--scalar-color-1);
  --scalar-color-purple: var(--scalar-color-1);
}
.light-mode *::selection {
  background-color: color-mix(in srgb, var(--scalar-color-blue), transparent 70%);
}
.dark-mode *::selection {
  background-color: color-mix(in srgb, var(--scalar-color-blue), transparent 50%);
}
`;var a2=`/* basic theme */
:root {
  --scalar-text-decoration: underline;
  --scalar-text-decoration-hover: underline;
}
.light-mode {
  --scalar-background-1: #f0f2f5;
  --scalar-background-2: #eaecf0;
  --scalar-background-3: #e0e2e6;
  --scalar-border-color: rgb(213 213 213);

  --scalar-color-1: rgb(9, 9, 11);
  --scalar-color-2: rgb(113, 113, 122);
  --scalar-color-3: rgba(25, 25, 28, 0.5);

  --scalar-color-accent: var(--scalar-color-1);
  --scalar-background-accent: #8ab4f81f;
}
.light-mode .scalar-card.dark-mode,
.dark-mode {
  --scalar-background-1: #000e23;
  --scalar-background-2: #01132e;
  --scalar-background-3: #03193b;
  --scalar-border-color: #2e394c;

  --scalar-color-1: #fafafa;
  --scalar-color-2: rgb(161, 161, 170);
  --scalar-color-3: rgba(255, 255, 255, 0.533);

  --scalar-color-accent: var(--scalar-color-1);
  --scalar-background-accent: #8ab4f81f;

  --scalar-code-language-color-supersede: var(--scalar-color-1);
}
/* Document Sidebar */
.light-mode .t-doc__sidebar,
.dark-mode .t-doc__sidebar {
  --scalar-sidebar-background-1: var(--scalar-background-1);
  --scalar-sidebar-color-1: var(--scalar-color-1);
  --scalar-sidebar-color-2: var(--scalar-color-2);
  --scalar-sidebar-border-color: var(--scalar-border-color);

  --scalar-sidebar-item-hover-background: var(--scalar-background-2);
  --scalar-sidebar-item-hover-color: currentColor;

  --scalar-sidebar-item-active-background: var(--scalar-background-3);
  --scalar-sidebar-color-active: var(--scalar-color-accent);

  --scalar-sidebar-search-background: rgba(255, 255, 255, 0.1);
  --scalar-sidebar-search-border-color: var(--scalar-border-color);
  --scalar-sidebar-search-color: var(--scalar-color-3);
  z-index: 1;
}
.light-mode .t-doc__sidebar {
  --scalar-sidebar-search-background: white;
}
/* advanced */
.light-mode {
  --scalar-color-green: #069061;
  --scalar-color-red: #ef0006;
  --scalar-color-yellow: #edbe20;
  --scalar-color-blue: #0082d0;
  --scalar-color-orange: #fb892c;
  --scalar-color-purple: #5203d1;

  --scalar-button-1: rgba(0, 0, 0, 1);
  --scalar-button-1-hover: rgba(0, 0, 0, 0.8);
  --scalar-button-1-color: rgba(255, 255, 255, 0.9);
}
.dark-mode {
  --scalar-color-green: rgba(69, 255, 165, 0.823);
  --scalar-color-red: #ff8589;
  --scalar-color-yellow: #ffcc4d;
  --scalar-color-blue: #6bc1fe;
  --scalar-color-orange: #f98943;
  --scalar-color-purple: #b191f9;

  --scalar-button-1: rgba(255, 255, 255, 1);
  --scalar-button-1-hover: rgba(255, 255, 255, 0.9);
  --scalar-button-1-color: black;
}
/* Custom theme */
/* Document header */
@keyframes headerbackground {
  from {
    background: transparent;
    backdrop-filter: none;
  }
  to {
    background: var(--header-background-1);
    backdrop-filter: blur(12px);
  }
}
.dark-mode h2.t-editor__heading,
.dark-mode .t-editor__page-title h1,
.dark-mode h1.section-header:not(::selection),
.dark-mode .markdown h1,
.dark-mode .markdown h2,
.dark-mode .markdown h3,
.dark-mode .markdown h4,
.dark-mode .markdown h5,
.dark-mode .markdown h6 {
  -webkit-text-fill-color: transparent;
  background-image: linear-gradient(to right bottom, rgb(255, 255, 255) 30%, rgba(255, 255, 255, 0.38));
  -webkit-background-clip: text;
  background-clip: text;
}
/* Hero Section Flare */
.section-flare-item:nth-of-type(1) {
  --c1: #ffffff;
  --c2: #babfd8;
  --c3: #2e8bb2;
  --c4: #1a8593;
  --c5: #0a143e;
  --c6: #0a0f52;
  --c7: #2341b8;

  --solid: var(--c1), var(--c2), var(--c3), var(--c4), var(--c5), var(--c6), var(--c7);
  --solid-wrap: var(--solid), var(--c1);
  --trans:
    var(--c1), transparent, var(--c2), transparent, var(--c3),
    transparent, var(--c4), transparent, var(--c5), transparent, var(--c6),
    transparent, var(--c7);
  --trans-wrap: var(--trans), transparent, var(--c1);

  background: radial-gradient(circle, var(--trans)), conic-gradient(from 180deg, var(--trans-wrap)),
    radial-gradient(circle, var(--trans)), conic-gradient(var(--solid-wrap));
  width: 70vw;
  height: 700px;
  border-radius: 50%;
  filter: blur(100px);
  z-index: 0;
  right: 0;
  position: absolute;
  transform: rotate(-45deg);
  top: -300px;
  opacity: 0.3;
}
.section-flare-item:nth-of-type(3) {
  --star-color: #6b9acc;
  --star-color2: #446b8d;
  --star-color3: #3e5879;
  background-image: radial-gradient(2px 2px at 20px 30px, var(--star-color2), rgba(0, 0, 0, 0)),
    radial-gradient(2px 2px at 40px 70px, var(--star-color), rgba(0, 0, 0, 0)),
    radial-gradient(2px 2px at 50px 160px, var(--star-color3), rgba(0, 0, 0, 0)),
    radial-gradient(2px 2px at 90px 40px, var(--star-color), rgba(0, 0, 0, 0)),
    radial-gradient(2px 2px at 130px 80px, var(--star-color), rgba(0, 0, 0, 0)),
    radial-gradient(2px 2px at 160px 120px, var(--star-color3), rgba(0, 0, 0, 0));
  background-repeat: repeat;
  background-size: 200px 200px;
  width: 100%;
  height: 100%;
  mask-image: radial-gradient(ellipse at 100% 0%, black 40%, transparent 70%);
}
.section-flare {
  top: -150px !important;
  height: 100vh;
  background: linear-gradient(#000, var(--scalar-background-1));
  width: 100vw;
  overflow-x: hidden;
}
.light-mode .section-flare {
  display: none;
}
.light-mode .scalar-card {
  --scalar-background-1: #fff;
  --scalar-background-2: #fff;
  --scalar-background-3: #fff;
}

*::selection {
  background-color: color-mix(in srgb, var(--scalar-color-blue), transparent 60%);
}
`;var a3=`/* basic theme */
:root {
  --scalar-text-decoration: underline;
  --scalar-text-decoration-hover: underline;
}
.light-mode {
  --scalar-color-1: rgb(9, 9, 11);
  --scalar-color-2: rgb(113, 113, 122);
  --scalar-color-3: rgba(25, 25, 28, 0.5);
  --scalar-color-accent: var(--scalar-color-1);

  --scalar-background-1: #fff;
  --scalar-background-2: #f4f4f5;
  --scalar-background-3: #e3e3e6;
  --scalar-background-accent: #8ab4f81f;

  --scalar-border-color: rgb(228, 228, 231);
  --scalar-code-language-color-supersede: var(--scalar-color-1);
}
.dark-mode {
  --scalar-color-1: #fafafa;
  --scalar-color-2: rgb(161, 161, 170);
  --scalar-color-3: rgba(255, 255, 255, 0.533);
  --scalar-color-accent: var(--scalar-color-1);

  --scalar-background-1: #09090b;
  --scalar-background-2: #18181b;
  --scalar-background-3: #2c2c30;
  --scalar-background-accent: #8ab4f81f;

  --scalar-border-color: rgba(255, 255, 255, 0.16);
  --scalar-code-language-color-supersede: var(--scalar-color-1);
}

/* Document Sidebar */
.light-mode .t-doc__sidebar,
.dark-mode .t-doc__sidebar {
  --scalar-sidebar-background-1: var(--scalar-background-1);
  --scalar-sidebar-color-1: var(--scalar-color-1);
  --scalar-sidebar-color-2: var(--scalar-color-2);
  --scalar-sidebar-border-color: var(--scalar-border-color);

  --scalar-sidebar-item-hover-color: currentColor;
  --scalar-sidebar-item-hover-background: var(--scalar-background-2);

  --scalar-sidebar-item-active-background: var(--scalar-background-3);
  --scalar-sidebar-color-active: var(--scalar-color-accent);

  --scalar-sidebar-search-background: transparent;
  --scalar-sidebar-search-border-color: var(--scalar-border-color);
  --scalar-sidebar-search-color: var(--scalar-color-3);
}
.light-mode .t-doc__sidebar {
  --scalar-sidebar-item-active-background: var(--scalar-background-2);
}
/* advanced */
.light-mode {
  --scalar-color-green: #069061;
  --scalar-color-red: #ef0006;
  --scalar-color-yellow: #edbe20;
  --scalar-color-blue: #0082d0;
  --scalar-color-orange: #fb892c;
  --scalar-color-purple: #5203d1;

  --scalar-button-1: rgba(0, 0, 0, 1);
  --scalar-button-1-hover: rgba(0, 0, 0, 0.8);
  --scalar-button-1-color: rgba(255, 255, 255, 0.9);
}
.dark-mode {
  --scalar-color-green: rgba(69, 255, 165, 0.823);
  --scalar-color-red: #ff8589;
  --scalar-color-yellow: #ffcc4d;
  --scalar-color-blue: #6bc1fe;
  --scalar-color-orange: #f98943;
  --scalar-color-purple: #b191f9;

  --scalar-button-1: rgba(255, 255, 255, 1);
  --scalar-button-1-hover: rgba(255, 255, 255, 0.9);
  --scalar-button-1-color: black;
}
/* Custom theme */
.dark-mode h2.t-editor__heading,
.dark-mode .t-editor__page-title h1,
.dark-mode h1.section-header:not(::selection),
.dark-mode .markdown h1,
.dark-mode .markdown h2,
.dark-mode .markdown h3,
.dark-mode .markdown h4,
.dark-mode .markdown h5,
.dark-mode .markdown h6 {
  -webkit-text-fill-color: transparent;
  background-image: linear-gradient(to right bottom, rgb(255, 255, 255) 30%, rgba(255, 255, 255, 0.38));
  -webkit-background-clip: text;
  background-clip: text;
}
.examples .scalar-card-footer {
  --scalar-background-3: transparent;
  padding-top: 0;
}
/* Hero section flare */
.section-flare {
  width: 100vw;
  height: 550px;
  position: absolute;
}
.section-flare-item:nth-of-type(1) {
  position: absolute;
  width: 100vw;
  height: 550px;
  --stripesDark: repeating-linear-gradient(100deg, #000 0%, #000 7%, transparent 10%, transparent 12%, #000 16%);
  --rainbow: repeating-linear-gradient(100deg, #fff 10%, #fff 16%, #fff 22%, #fff 30%);
  background-image: var(--stripesDark), var(--rainbow);
  background-size: 300%, 200%;
  background-position: 50% 50%, 50% 50%;
  filter: invert(100%);
  -webkit-mask-image: radial-gradient(ellipse at 100% 0%, black 40%, transparent 70%);
  mask-image: radial-gradient(ellipse at 100% 0%, black 40%, transparent 70%);
  pointer-events: none;
  opacity: 0.07;
}
.dark-mode .section-flare-item:nth-of-type(1) {
  background-image: var(--stripesDark), var(--rainbow);
  filter: opacity(50%) saturate(200%);
  opacity: 0.25;
  height: 350px;
}
.section-flare-item:nth-of-type(1):after {
  content: "";
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  background-image: var(--stripesDark), var(--rainbow);
  background-size: 200%, 100%;
  background-attachment: fixed;
  mix-blend-mode: difference;
}
.dark-mode .section-flare:after {
  background-image: var(--stripesDark), var(--rainbow);
}
.section-flare-item:nth-of-type(2) {
  --star-color: #fff;
  --star-color2: #fff;
  --star-color3: #fff;
  width: 100%;
  height: 100%;
  position: absolute;
  background-image: radial-gradient(2px 2px at 20px 30px, var(--star-color2), rgba(0, 0, 0, 0)),
    radial-gradient(2px 2px at 40px 70px, var(--star-color), rgba(0, 0, 0, 0)),
    radial-gradient(2px 2px at 50px 160px, var(--star-color3), rgba(0, 0, 0, 0)),
    radial-gradient(2px 2px at 90px 40px, var(--star-color), rgba(0, 0, 0, 0)),
    radial-gradient(2px 2px at 130px 80px, var(--star-color), rgba(0, 0, 0, 0)),
    radial-gradient(2px 2px at 160px 120px, var(--star-color3), rgba(0, 0, 0, 0));
  background-repeat: repeat;
  background-size: 200px 200px;
  mask-image: radial-gradient(ellipse at 100% 0%, black 40%, transparent 70%);
  opacity: 0.2;
}
.light-mode *::selection {
  background-color: color-mix(in srgb, var(--scalar-color-blue), transparent 70%);
}
.dark-mode *::selection {
  background-color: color-mix(in srgb, var(--scalar-color-blue), transparent 50%);
}
`;var r=`/* basic theme */
.light-mode {
  --scalar-background-1: #fff;
  --scalar-background-2: #f6f6f6;
  --scalar-background-3: #e7e7e7;
  --scalar-background-accent: #8ab4f81f;

  --scalar-color-1: #2a2f45;
  --scalar-color-2: #757575;
  --scalar-color-3: #8e8e8e;

  --scalar-color-accent: #0099ff;
  --scalar-border-color: #dfdfdf;
}
.dark-mode {
  --scalar-background-1: #0f0f0f;
  --scalar-background-2: #1a1a1a;
  --scalar-background-3: #272727;

  --scalar-color-1: #e7e7e7;
  --scalar-color-2: #a4a4a4;
  --scalar-color-3: #797979;

  --scalar-color-accent: #3ea6ff;
  --scalar-background-accent: #3ea6ff1f;

  --scalar-border-color: #2d2d2d;
}
/* Document Sidebar */
.light-mode .t-doc__sidebar,
.dark-mode .t-doc__sidebar {
  --scalar-sidebar-background-1: var(--scalar-background-1);
  --scalar-sidebar-color-1: var(--scalar-color-1);
  --scalar-sidebar-color-2: var(--scalar-color-2);
  --scalar-sidebar-border-color: var(--scalar-border-color);

  --scalar-sidebar-item-hover-background: var(--scalar-background-2);
  --scalar-sidebar-item-hover-color: currentColor;

  --scalar-sidebar-item-active-background: var(--scalar-background-2);
  --scalar-sidebar-color-active: var(--scalar-color-1);

  --scalar-sidebar-indent-border: var(--scalar-sidebar-border-color);
  --scalar-sidebar-indent-border-hover: var(--scalar-sidebar-border-color);
  --scalar-sidebar-indent-border-active: var(--scalar-sidebar-border-color);

  --scalar-sidebar-search-background: transparent;
  --scalar-sidebar-search-color: var(--scalar-color-3);
  --scalar-sidebar-search-border-color: var(--scalar-border-color);
}
/* advanced */
.light-mode {
  --scalar-color-green: #069061;
  --scalar-color-red: #ef0006;
  --scalar-color-yellow: #edbe20;
  --scalar-color-blue: #0082d0;
  --scalar-color-orange: #fb892c;
  --scalar-color-purple: #5203d1;

  --scalar-button-1: rgba(0, 0, 0, 1);
  --scalar-button-1-hover: rgba(0, 0, 0, 0.8);
  --scalar-button-1-color: rgba(255, 255, 255, 0.9);

  --scalar-color-danger: color-mix(in srgb, var(--scalar-color-red), var(--scalar-color-1) 20%);

  --scalar-background-alert: color-mix(in srgb, var(--scalar-color-orange), var(--scalar-background-1) 95%);
  --scalar-background-danger: color-mix(in srgb, var(--scalar-color-red), var(--scalar-background-1) 95%);
}
.dark-mode {
  --scalar-color-green: #00b648;
  --scalar-color-red: #dc1b19;
  --scalar-color-yellow: #ffc90d;
  --scalar-color-blue: #4eb3ec;
  --scalar-color-orange: #ff8d4d;
  --scalar-color-purple: #b191f9;

  --scalar-button-1: rgba(255, 255, 255, 1);
  --scalar-button-1-hover: rgba(255, 255, 255, 0.9);
  --scalar-button-1-color: black;

  --scalar-color-danger: color-mix(in srgb, var(--scalar-color-red), var(--scalar-background-1) 20%);

  --scalar-background-alert: color-mix(in srgb, var(--scalar-color-orange), var(--scalar-background-1) 95%);
  --scalar-background-danger: color-mix(in srgb, var(--scalar-color-red), var(--scalar-background-1) 95%);
}
@supports (color: color(display-p3 1 1 1)) {
  .light-mode {
    --scalar-color-accent: color(display-p3 0.0 0.6 1.0 / 1.0);
    --scalar-color-green: color(display-p3 0.023529 0.564706 0.380392 / 1.0);
    --scalar-color-red: color(display-p3 0.937255 0.0 0.023529 / 1.0);
    --scalar-color-yellow: color(display-p3 0.929412 0.745098 0.12549 / 1.0);
    --scalar-color-blue: color(display-p3 0.0 0.509804 0.815686 / 1.0);
    --scalar-color-orange: color(display-p3 0.984314 0.537255 0.172549 / 1.0);
    --scalar-color-purple: color(display-p3 0.321569 0.011765 0.819608 / 1.0);
  }
  .dark-mode {
    --scalar-color-accent: color(display-p3 0.243137 0.65098 1.0 / 1.0);
    --scalar-color-green: color(display-p3 0.0 0.713725 0.282353 / 1.0);
    --scalar-color-red: color(display-p3 0.862745 0.105882 0.098039 / 1.0);
    --scalar-color-yellow: color(display-p3 1.0 0.788235 0.05098 / 1.0);
    --scalar-color-blue: color(display-p3 0.305882 0.701961 0.92549 / 1.0);
    --scalar-color-orange: color(display-p3 1.0 0.552941 0.301961 / 1.0);
    --scalar-color-purple: color(display-p3 0.694118 0.568627 0.976471 / 1.0);
  }
}
`;var a4=`.light-mode {
  --scalar-color-1: #2a2f45;
  --scalar-color-2: #757575;
  --scalar-color-3: #8e8e8e;
  --scalar-color-accent: #f06292;

  --scalar-background-1: #fff;
  --scalar-background-2: #f6f6f6;
  --scalar-background-3: #e7e7e7;

  --scalar-border-color: rgba(0, 0, 0, 0.1);
}
.dark-mode {
  --scalar-color-1: rgba(255, 255, 255, 0.9);
  --scalar-color-2: rgba(156, 163, 175, 1);
  --scalar-color-3: rgba(255, 255, 255, 0.44);
  --scalar-color-accent: #f06292;

  --scalar-background-1: #111728;
  --scalar-background-2: #1e293b;
  --scalar-background-3: #334155;
  --scalar-background-accent: #f062921f;

  --scalar-border-color: rgba(255, 255, 255, 0.1);
}

/* Document Sidebar */
.light-mode .t-doc__sidebar,
.dark-mode .t-doc__sidebar {
  --scalar-sidebar-background-1: var(--scalar-background-1);
  --scalar-sidebar-color-1: var(--scalar-color-1);
  --scalar-sidebar-color-2: var(--scalar-color-2);
  --scalar-sidebar-border-color: var(--scalar-border-color);

  --scalar-sidebar-item-hover-background: var(--scalar-background-2);
  --scalar-sidebar-item-hover-color: currentColor;

  --scalar-sidebar-item-active-background: #f062921f;
  --scalar-sidebar-color-active: var(--scalar-color-accent);

  --scalar-sidebar-search-background: transparent;
  --scalar-sidebar-search-color: var(--scalar-color-3);
  --scalar-sidebar-search-border-color: var(--scalar-border-color);
}

/* advanced */
.light-mode {
  --scalar-button-1: rgb(49 53 56);
  --scalar-button-1-color: #fff;
  --scalar-button-1-hover: rgb(28 31 33);

  --scalar-color-green: #069061;
  --scalar-color-red: #ef0006;
  --scalar-color-yellow: #edbe20;
  --scalar-color-blue: #0082d0;
  --scalar-color-orange: #fb892c;
  --scalar-color-purple: #5203d1;

  --scalar-scrollbar-color: rgba(0, 0, 0, 0.18);
  --scalar-scrollbar-color-active: rgba(0, 0, 0, 0.36);
}
.dark-mode {
  --scalar-button-1: #f6f6f6;
  --scalar-button-1-color: #000;
  --scalar-button-1-hover: #e7e7e7;

  --scalar-color-green: #a3ffa9;
  --scalar-color-red: #ffa3a3;
  --scalar-color-yellow: #fffca3;
  --scalar-color-blue: #a5d6ff;
  --scalar-color-orange: #e2ae83;
  --scalar-color-purple: #d2a8ff;

  --scalar-scrollbar-color: rgba(255, 255, 255, 0.24);
  --scalar-scrollbar-color-active: rgba(255, 255, 255, 0.48);
}
.section-flare {
  width: 100%;
  height: 400px;
  position: absolute;
}
.section-flare-item:first-of-type:before {
  content: "";
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  --stripes: repeating-linear-gradient(100deg, #fff 0%, #fff 0%, transparent 2%, transparent 12%, #fff 17%);
  --stripesDark: repeating-linear-gradient(100deg, #000 0%, #000 0%, transparent 10%, transparent 12%, #000 17%);
  --rainbow: repeating-linear-gradient(100deg, #60a5fa 10%, #e879f9 16%, #5eead4 22%, #60a5fa 30%);
  contain: strict;
  contain-intrinsic-size: 100vw 40vh;
  background-image: var(--stripesDark), var(--rainbow);
  background-size: 300%, 200%;
  background-position: 50% 50%, 50% 50%;
  filter: opacity(20%) saturate(200%);
  -webkit-mask-image: radial-gradient(ellipse at 100% 0%, black 40%, transparent 70%);
  mask-image: radial-gradient(ellipse at 100% 0%, black 40%, transparent 70%);
  pointer-events: none;
}
.section-flare-item:first-of-type:after {
  content: "";
  position: absolute;
  top: 0;
  right: 0;
  bottom: 0;
  left: 0;
  background-image: var(--stripes), var(--rainbow);
  background-size: 200%, 100%;
  background-attachment: fixed;
  mix-blend-mode: difference;
  background-image: var(--stripesDark), var(--rainbow);
  pointer-events: none;
}
.light-mode .section-flare-item:first-of-type:after,
.light-mode .section-flare-item:first-of-type:before {
  background-image: var(--stripes), var(--rainbow);
  filter: opacity(4%) saturate(200%);
}
`;var a5=`.light-mode {
  color-scheme: light;
  --scalar-color-1: #1c1e21;
  --scalar-color-2: #757575;
  --scalar-color-3: #8e8e8e;
  --scalar-color-disabled: #b4b1b1;
  --scalar-color-ghost: #a7a7a7;
  --scalar-color-accent: #2f8555;
  --scalar-background-1: #fff;
  --scalar-background-2: #f5f5f5;
  --scalar-background-3: #ededed;
  --scalar-background-4: rgba(0, 0, 0, 0.06);
  --scalar-background-accent: #2f85551f;

  --scalar-border-color: rgba(0, 0, 0, 0.1);
  --scalar-scrollbar-color: rgba(0, 0, 0, 0.18);
  --scalar-scrollbar-color-active: rgba(0, 0, 0, 0.36);
  --scalar-lifted-brightness: 1;
  --scalar-backdrop-brightness: 1;

  --scalar-shadow-1: 0 1px 3px 0 rgba(0, 0, 0, 0.11);
  --scalar-shadow-2: rgba(0, 0, 0, 0.08) 0px 13px 20px 0px, rgba(0, 0, 0, 0.08) 0px 3px 8px 0px, #eeeeed 0px 0 0 1px;

  --scalar-button-1: rgb(49 53 56);
  --scalar-button-1-color: #fff;
  --scalar-button-1-hover: rgb(28 31 33);

  --scalar-color-green: #007300;
  --scalar-color-red: #af272b;
  --scalar-color-yellow: #b38200;
  --scalar-color-blue: #3b8ba5;
  --scalar-color-orange: #fb892c;
  --scalar-color-purple: #5203d1;
}

.dark-mode {
  color-scheme: dark;
  --scalar-color-1: rgba(255, 255, 255, 0.9);
  --scalar-color-2: rgba(255, 255, 255, 0.62);
  --scalar-color-3: rgba(255, 255, 255, 0.44);
  --scalar-color-disabled: rgba(255, 255, 255, 0.34);
  --scalar-color-ghost: rgba(255, 255, 255, 0.26);
  --scalar-color-accent: #27c2a0;
  --scalar-background-1: #1b1b1d;
  --scalar-background-2: #242526;
  --scalar-background-3: #3b3b3b;
  --scalar-background-4: rgba(255, 255, 255, 0.06);
  --scalar-background-accent: #27c2a01f;

  --scalar-border-color: rgba(255, 255, 255, 0.1);
  --scalar-scrollbar-color: rgba(255, 255, 255, 0.24);
  --scalar-scrollbar-color-active: rgba(255, 255, 255, 0.48);
  --scalar-lifted-brightness: 1.45;
  --scalar-backdrop-brightness: 0.5;

  --scalar-shadow-1: 0 1px 3px 0 rgb(0, 0, 0, 0.1);
  --scalar-shadow-2: rgba(15, 15, 15, 0.2) 0px 3px 6px, rgba(15, 15, 15, 0.4) 0px 9px 24px, 0 0 0 1px
    rgba(255, 255, 255, 0.1);

  --scalar-button-1: #f6f6f6;
  --scalar-button-1-color: #000;
  --scalar-button-1-hover: #e7e7e7;

  --scalar-color-green: #26b226;
  --scalar-color-red: #fb565b;
  --scalar-color-yellow: #ffc426;
  --scalar-color-blue: #6ecfef;
  --scalar-color-orange: #ff8d4d;
  --scalar-color-purple: #b191f9;
}
`;var a6=`/* basic theme */
.light-mode {
  --scalar-color-1: #2a2f45;
  --scalar-color-2: #757575;
  --scalar-color-3: #8e8e8e;
  --scalar-color-accent: #7070ff;

  --scalar-background-1: #fff;
  --scalar-background-2: #f6f6f6;
  --scalar-background-3: #e7e7e7;
  --scalar-background-accent: #7070ff1f;

  --scalar-border-color: rgba(0, 0, 0, 0.1);

  --scalar-code-language-color-supersede: var(--scalar-color-3);
}
.dark-mode {
  --scalar-color-1: #f7f8f8;
  --scalar-color-2: rgb(180, 188, 208);
  --scalar-color-3: #b4bcd099;
  --scalar-color-accent: #828fff;

  --scalar-background-1: #000212;
  --scalar-background-2: #0d0f1e;
  --scalar-background-3: #232533;
  --scalar-background-accent: #8ab4f81f;

  --scalar-border-color: #313245;
  --scalar-code-language-color-supersede: var(--scalar-color-3);
}
/* Document Sidebar */
.light-mode .t-doc__sidebar {
  --scalar-sidebar-background-1: var(--scalar-background-1);
  --scalar-sidebar-item-hover-color: currentColor;
  --scalar-sidebar-item-hover-background: var(--scalar-background-2);
  --scalar-sidebar-item-active-background: var(--scalar-background-accent);
  --scalar-sidebar-border-color: var(--scalar-border-color);
  --scalar-sidebar-color-1: var(--scalar-color-1);
  --scalar-sidebar-color-2: var(--scalar-color-2);
  --scalar-sidebar-color-active: var(--scalar-color-accent);
  --scalar-sidebar-search-background: rgba(0, 0, 0, 0.05);
  --scalar-sidebar-search-border-color: 1px solid rgba(0, 0, 0, 0.05);
  --scalar-sidebar-search-color: var(--scalar-color-3);
  --scalar-background-2: rgba(0, 0, 0, 0.03);
}
.dark-mode .t-doc__sidebar {
  --scalar-sidebar-background-1: var(--scalar-background-1);
  --scalar-sidebar-item-hover-color: currentColor;
  --scalar-sidebar-item-hover-background: var(--scalar-background-2);
  --scalar-sidebar-item-active-background: rgba(255, 255, 255, 0.1);
  --scalar-sidebar-border-color: var(--scalar-border-color);
  --scalar-sidebar-color-1: var(--scalar-color-1);
  --scalar-sidebar-color-2: var(--scalar-color-2);
  --scalar-sidebar-color-active: var(--scalar-color-accent);
  --scalar-sidebar-search-background: rgba(255, 255, 255, 0.1);
  --scalar-sidebar-search-border-color: 1px solid rgba(255, 255, 255, 0.05);
  --scalar-sidebar-search-color: var(--scalar-color-3);
}
/* advanced */
.light-mode {
  --scalar-color-green: #069061;
  --scalar-color-red: #ef0006;
  --scalar-color-yellow: #edbe20;
  --scalar-color-blue: #0082d0;
  --scalar-color-orange: #fb892c;
  --scalar-color-purple: #5203d1;

  --scalar-button-1: rgba(0, 0, 0, 1);
  --scalar-button-1-hover: rgba(0, 0, 0, 0.8);
  --scalar-button-1-color: rgba(255, 255, 255, 0.9);
}
.dark-mode {
  --scalar-color-green: #00b648;
  --scalar-color-red: #dc1b19;
  --scalar-color-yellow: #ffc90d;
  --scalar-color-blue: #4eb3ec;
  --scalar-color-orange: #ff8d4d;
  --scalar-color-purple: #b191f9;

  --scalar-button-1: rgba(255, 255, 255, 1);
  --scalar-button-1-hover: rgba(255, 255, 255, 0.9);
  --scalar-button-1-color: black;
}
/* Custom Theme */
.dark-mode h2.t-editor__heading,
.dark-mode .t-editor__page-title h1,
.dark-mode h1.section-header:not(::selection),
.dark-mode .markdown h1,
.dark-mode .markdown h2,
.dark-mode .markdown h3,
.dark-mode .markdown h4,
.dark-mode .markdown h5,
.dark-mode .markdown h6 {
  -webkit-text-fill-color: transparent;
  background-image: linear-gradient(to right bottom, rgb(255, 255, 255) 30%, rgba(255, 255, 255, 0.38));
  -webkit-background-clip: text;
  background-clip: text;
}
.sidebar-search {
  backdrop-filter: blur(12px);
}
@keyframes headerbackground {
  from {
    background: transparent;
    backdrop-filter: none;
  }
  to {
    background: var(--header-background-1);
    backdrop-filter: blur(12px);
  }
}
.dark-mode .scalar-card {
  background: rgba(255, 255, 255, 0.05) !important;
}
.dark-mode .scalar-card * {
  --scalar-background-2: transparent !important;
  --scalar-background-1: transparent !important;
}
.light-mode .dark-mode.scalar-card *,
.light-mode .dark-mode.scalar-card {
  --scalar-background-1: #0d0f1e !important;
  --scalar-background-2: #0d0f1e !important;
  --scalar-background-3: #191b29 !important;
}
.light-mode .dark-mode.scalar-card {
  background: #191b29 !important;
}
.badge {
  box-shadow: 0 0 0 1px var(--scalar-border-color);
  margin-right: 6px;
}

.table-row.required-parameter .table-row-item:nth-of-type(2):after {
  background: transparent;
  box-shadow: none;
}
/* Hero Section Flare */
.section-flare {
  width: 100vw;
  background: radial-gradient(ellipse 80% 50% at 50% -20%, rgba(120, 119, 198, 0.3), transparent);
  height: 100vh;
}
.light-mode *::selection {
  background-color: color-mix(in srgb, var(--scalar-color-accent), transparent 70%);
}
.dark-mode *::selection {
  background-color: color-mix(in srgb, var(--scalar-color-accent), transparent 50%);
}
`;var a7=`/* basic theme */
:root {
  --scalar-text-decoration: underline;
  --scalar-text-decoration-hover: underline;
}
.light-mode {
  --scalar-background-1: #f9f6f0;
  --scalar-background-2: #f2efe8;
  --scalar-background-3: #e9e7e2;
  --scalar-border-color: rgba(203, 165, 156, 0.6);

  --scalar-color-1: #c75549;
  --scalar-color-2: #c75549;
  --scalar-color-3: #c75549;

  --scalar-color-accent: #c75549;
  --scalar-background-accent: #dcbfa81f;

  --scalar-code-language-color-supersede: var(--scalar-color-1);
}
.dark-mode {
  --scalar-background-1: #140507;
  --scalar-background-2: #20090c;
  --scalar-background-3: #321116;
  --scalar-border-color: #3c3031;

  --scalar-color-1: rgba(255, 255, 255, 0.9);
  --scalar-color-2: rgba(255, 255, 255, 0.62);
  --scalar-color-3: rgba(255, 255, 255, 0.44);

  --scalar-color-accent: rgba(255, 255, 255, 0.9);
  --scalar-background-accent: #441313;

  --scalar-code-language-color-supersede: var(--scalar-color-1);
}

/* Document Sidebar */
.light-mode .t-doc__sidebar,
.dark-mode .t-doc__sidebar {
  --scalar-sidebar-background-1: var(--scalar-background-1);
  --scalar-sidebar-color-1: var(--scalar-color-1);
  --scalar-sidebar-color-2: var(--scalar-color-2);
  --scalar-sidebar-border-color: var(--scalar-border-color);

  --scalar-sidebar-item-hover-color: currentColor;
  --scalar-sidebar-item-hover-background: var(--scalar-background-2);

  --scalar-sidebar-item-active-background: var(--scalar-background-3);
  --scalar-sidebar-color-active: var(--scalar-color-accent);

  --scalar-sidebar-search-background: rgba(255, 255, 255, 0.1);
  --scalar-sidebar-search-color: var(--scalar-color-3);
  --scalar-sidebar-search-border-color: var(--scalar-border-color);
  z-index: 1;
}
/* advanced */
.light-mode {
  --scalar-color-green: #09533a;
  --scalar-color-red: #aa181d;
  --scalar-color-yellow: #ab8d2b;
  --scalar-color-blue: #19689a;
  --scalar-color-orange: #b26c34;
  --scalar-color-purple: #4c2191;

  --scalar-button-1: rgba(0, 0, 0, 1);
  --scalar-button-1-hover: rgba(0, 0, 0, 0.8);
  --scalar-button-1-color: rgba(255, 255, 255, 0.9);
}
.dark-mode {
  --scalar-color-green: rgba(69, 255, 165, 0.823);
  --scalar-color-red: #ff8589;
  --scalar-color-yellow: #ffcc4d;
  --scalar-color-blue: #6bc1fe;
  --scalar-color-orange: #f98943;
  --scalar-color-purple: #b191f9;

  --scalar-button-1: rgba(255, 255, 255, 1);
  --scalar-button-1-hover: rgba(255, 255, 255, 0.9);
  --scalar-button-1-color: black;
}
/* Custom Theme */
.dark-mode h2.t-editor__heading,
.dark-mode .t-editor__page-title h1,
.dark-mode h1.section-header:not(::selection),
.dark-mode .markdown h1,
.dark-mode .markdown h2,
.dark-mode .markdown h3,
.dark-mode .markdown h4,
.dark-mode .markdown h5,
.dark-mode .markdown h6 {
  -webkit-text-fill-color: transparent;
  background-image: linear-gradient(to right bottom, rgb(255, 255, 255) 30%, rgba(255, 255, 255, 0.38));
  -webkit-background-clip: text;
  background-clip: text;
}
.light-mode .t-doc__sidebar {
  --scalar-sidebar-search-background: white;
}
.examples .scalar-card-footer {
  --scalar-background-3: transparent;
  padding-top: 0;
}
/* Hero section flare */
.section-flare {
  overflow-x: hidden;
  height: 100vh;
  left: initial;
}
.section-flare-item:nth-of-type(1) {
  background: #d25019;
  position: relative;
  top: -150px;
  right: -400px;
  width: 80vw;
  height: 500px;
  margin-top: -150px;
  border-radius: 50%;
  filter: blur(100px);
  z-index: 0;
}
.light-mode .section-flare {
  display: none;
}
*::selection {
  background-color: color-mix(in srgb, var(--scalar-color-red), transparent 75%);
}
`;var a8=`.light-mode {
  color-scheme: light;
  --scalar-color-1: #000000;
  --scalar-color-2: #000000;
  --scalar-color-3: #000000;
  --scalar-color-accent: #645b0f;
  --scalar-background-1: #ccc9b3;
  --scalar-background-2: #c2bfaa;
  --scalar-background-3: #b8b5a1;
  --scalar-background-accent: #000000;

  --scalar-border-color: rgba(0, 0, 0, 0.2);
  --scalar-scrollbar-color: rgba(0, 0, 0, 0.18);
  --scalar-scrollbar-color-active: rgba(0, 0, 0, 0.36);
  --scalar-lifted-brightness: 1;
  --scalar-backdrop-brightness: 1;

  --scalar-shadow-1: 0 1px 3px 0 rgba(0, 0, 0, 0.11);
  --scalar-shadow-2: rgba(0, 0, 0, 0.08) 0px 13px 20px 0px, rgba(0, 0, 0, 0.08) 0px 3px 8px 0px,
    var(--scalar-border-color) 0px 0 0 1px;

  --scalar-button-1: rgb(49 53 56);
  --scalar-button-1-color: #fff;
  --scalar-button-1-hover: rgb(28 31 33);

  --scalar-color-red: #b91c1c;
  --scalar-color-orange: #a16207;
  --scalar-color-green: #047857;
  --scalar-color-blue: #1d4ed8;
  --scalar-color-orange: #c2410c;
  --scalar-color-purple: #6d28d9;
}

.dark-mode {
  color-scheme: dark;
  --scalar-color-1: #fffef3;
  --scalar-color-2: #fffef3;
  --scalar-color-3: #fffef3;
  --scalar-color-accent: #c3b531;
  --scalar-background-1: #313332;
  --scalar-background-2: #393b3a;
  --scalar-background-3: #414342;
  --scalar-background-accent: #fffef3;

  --scalar-border-color: #505452;
  --scalar-scrollbar-color: rgba(255, 255, 255, 0.24);
  --scalar-scrollbar-color-active: rgba(255, 255, 255, 0.48);
  --scalar-lifted-brightness: 1.45;
  --scalar-backdrop-brightness: 0.5;

  --scalar-shadow-1: 0 1px 3px 0 rgba(0, 0, 0, 0.11);
  --scalar-shadow-2: rgba(15, 15, 15, 0.2) 0px 3px 6px, rgba(15, 15, 15, 0.4) 0px 9px 24px, 0 0 0 1px
    rgba(255, 255, 255, 0.1);

  --scalar-button-1: #f6f6f6;
  --scalar-button-1-color: #000;
  --scalar-button-1-hover: #e7e7e7;

  --scalar-color-green: #00b648;
  --scalar-color-red: #dc1b19;
  --scalar-color-yellow: #ffc90d;
  --scalar-color-blue: #4eb3ec;
  --scalar-color-orange: #ff8d4d;
  --scalar-color-purple: #b191f9;
}

/* Sidebar */
.light-mode .t-doc__sidebar,
.dark-mode .t-doc__sidebar {
  --scalar-sidebar-background-1: var(--scalar-background-1);
  --scalar-sidebar-color-1: var(--scalar-color-1);
  --scalar-sidebar-color-2: var(--scalar-color-2);
  --scalar-sidebar-border-color: var(--scalar-border-color);

  --scalar-sidebar-item-hover-background: var(--scalar-background-2);
  --scalar-sidebar-item-hover-color: currentColor;

  --scalar-sidebar-item-active-background: var(--scalar-background-3);
  --scalar-sidebar-color-active: var(--scalar-color-1);

  --scalar-sidebar-search-background: transparent;
  --scalar-sidebar-search-color: var(--scalar-color-3);
  --scalar-sidebar-search-border-color: var(--scalar-border-color);
}
*::selection {
  background-color: color-mix(in srgb, var(--scalar-color-accent), transparent 80%);
}
`;var a9=`/* basic theme */
.light-mode {
  --scalar-background-1: #fff;
  --scalar-background-2: #f5f6f8;
  --scalar-background-3: #eceef1;

  --scalar-color-1: #2a2f45;
  --scalar-color-2: #757575;
  --scalar-color-3: #8e8e8e;

  --scalar-color-accent: #5469d4;
  --scalar-background-accent: #5469d41f;

  --scalar-border-color: rgba(215, 215, 206, 0.68);
}
.dark-mode {
  --scalar-background-1: #15171c;
  --scalar-background-2: #1c1e24;
  --scalar-background-3: #22252b;

  --scalar-color-1: #fafafa;
  --scalar-color-2: #c9ced8;
  --scalar-color-3: #8c99ad;

  --scalar-color-accent: #5469d4;
  --scalar-background-accent: #5469d41f;

  --scalar-border-color: #3f4145;
}
/* Document Sidebar */
.light-mode .t-doc__sidebar,
.dark-mode .t-doc__sidebar {
  --scalar-sidebar-background-1: var(--scalar-background-1);
  --scalar-sidebar-color-1: var(--scalar-color-1);
  --scalar-sidebar-color-2: var(--scalar-color-2);
  --scalar-sidebar-border-color: var(--scalar-border-color);

  --scalar-sidebar-item-hover-color: currentColor;
  --scalar-sidebar-item-hover-background: var(--scalar-background-3);

  --scalar-sidebar-item-active-background: var(--scalar-background-accent);
  --scalar-sidebar-color-active: var(--scalar-color-accent);

  --scalar-sidebar-search-background: var(--scalar-background-1);
  --scalar-sidebar-search-color: var(--scalar-color-3);
  --scalar-sidebar-search-border-color: var(--scalar-border-color);
}

/* advanced */
.light-mode {
  --scalar-color-green: #17803d;
  --scalar-color-red: #e10909;
  --scalar-color-yellow: #edbe20;
  --scalar-color-blue: #1763a6;
  --scalar-color-orange: #e25b09;
  --scalar-color-purple: #5c3993;

  --scalar-button-1: rgba(0, 0, 0, 1);
  --scalar-button-1-hover: rgba(0, 0, 0, 0.8);
  --scalar-button-1-color: rgba(255, 255, 255, 0.9);
}
.dark-mode {
  --scalar-color-green: #30a159;
  --scalar-color-red: #dc1b19;
  --scalar-color-yellow: #eec644;
  --scalar-color-blue: #2b7abf;
  --scalar-color-orange: #f07528;
  --scalar-color-purple: #7a59b1;

  --scalar-button-1: rgba(255, 255, 255, 1);
  --scalar-button-1-hover: rgba(255, 255, 255, 0.9);
  --scalar-button-1-color: black;
}
.light-mode *::selection {
  background-color: color-mix(in srgb, var(--scalar-color-accent), transparent 70%);
}
.dark-mode *::selection {
  background-color: color-mix(in srgb, var(--scalar-color-accent), transparent 50%);
}
`;var a10=`/* basic theme */
.light-mode {
  --scalar-background-1: #f3f3ee;
  --scalar-background-2: #e8e8e3;
  --scalar-background-3: #e4e4df;
  --scalar-border-color: rgba(215, 215, 206, 0.85);

  --scalar-color-1: #2a2f45;
  --scalar-color-2: #757575;
  --scalar-color-3: #8e8e8e;

  --scalar-color-accent: #1763a6;
  --scalar-background-accent: #1f648e1f;
}
.dark-mode {
  --scalar-background-1: #09090b;
  --scalar-background-2: #18181b;
  --scalar-background-3: #2c2c30;
  --scalar-border-color: rgba(255, 255, 255, 0.17);

  --scalar-color-1: #fafafa;
  --scalar-color-2: rgb(161, 161, 170);
  --scalar-color-3: rgba(255, 255, 255, 0.533);

  --scalar-color-accent: #4eb3ec;
  --scalar-background-accent: #8ab4f81f;
}
/* Document Sidebar */
.light-mode .t-doc__sidebar,
.dark-mode .t-doc__sidebar {
  --scalar-sidebar-background-1: var(--scalar-background-1);
  --scalar-sidebar-color-1: var(--scalar-color-1);
  --scalar-sidebar-color-2: var(--scalar-color-2);
  --scalar-sidebar-border-color: var(--scalar-border-color);

  --scalar-sidebar-item-hover-background: var(--scalar-background-2);
  --scalar-sidebar-item-hover-color: currentColor;

  --scalar-sidebar-item-active-background: var(--scalar-background-3);
  --scalar-sidebar-color-active: var(--scalar-color-1);

  --scalar-sidebar-search-background: var(--scalar-background-1);
  --scalar-sidebar-search-border-color: var(--scalar-border-color);
  --scalar-sidebar-search-color: var(--scalar-color-3);
}

/* advanced */
.light-mode {
  --scalar-color-green: #17803d;
  --scalar-color-red: #e10909;
  --scalar-color-yellow: #edbe20;
  --scalar-color-blue: #1763a6;
  --scalar-color-orange: #e25b09;
  --scalar-color-purple: #5c3993;

  --scalar-button-1: rgba(0, 0, 0, 1);
  --scalar-button-1-hover: rgba(0, 0, 0, 0.8);
  --scalar-button-1-color: rgba(255, 255, 255, 0.9);
}
.dark-mode {
  --scalar-color-green: #30a159;
  --scalar-color-red: #dc1b19;
  --scalar-color-yellow: #eec644;
  --scalar-color-blue: #2b7abf;
  --scalar-color-orange: #f07528;
  --scalar-color-purple: #7a59b1;

  --scalar-button-1: rgba(255, 255, 255, 1);
  --scalar-button-1-hover: rgba(255, 255, 255, 0.9);
  --scalar-button-1-color: black;
}
.dark-mode h2.t-editor__heading,
.dark-mode .t-editor__page-title h1,
.dark-mode h1.section-header:not(::selection),
.dark-mode .markdown h1,
.dark-mode .markdown h2,
.dark-mode .markdown h3,
.dark-mode .markdown h4,
.dark-mode .markdown h5,
.dark-mode .markdown h6 {
  -webkit-text-fill-color: transparent;
  background-image: linear-gradient(to right bottom, rgb(255, 255, 255) 30%, rgba(255, 255, 255, 0.38));
  -webkit-background-clip: text;
  background-clip: text;
}
.light-mode *::selection {
  background-color: color-mix(in srgb, var(--scalar-color-accent), transparent 70%);
}
.dark-mode *::selection {
  background-color: color-mix(in srgb, var(--scalar-color-accent), transparent 50%);
}
`;var a11=`.light-mode {
  color-scheme: light;
  --scalar-color-1: #584c27;
  --scalar-color-2: #616161;
  --scalar-color-3: #a89f84;
  --scalar-color-accent: #b58900;
  --scalar-background-1: #fdf6e3;
  --scalar-background-2: #eee8d5;
  --scalar-background-3: #ddd6c1;
  --scalar-background-accent: #b589001f;

  --scalar-border-color: #ded8c8;
  --scalar-scrollbar-color: rgba(0, 0, 0, 0.18);
  --scalar-scrollbar-color-active: rgba(0, 0, 0, 0.36);
  --scalar-lifted-brightness: 1;
  --scalar-backdrop-brightness: 1;

  --scalar-shadow-1: 0 1px 3px 0 rgba(0, 0, 0, 0.11);
  --scalar-shadow-2: rgba(0, 0, 0, 0.08) 0px 13px 20px 0px, rgba(0, 0, 0, 0.08) 0px 3px 8px 0px, #eeeeed 0px 0 0 1px;

  --scalar-button-1: rgb(49 53 56);
  --scalar-button-1-color: #fff;
  --scalar-button-1-hover: rgb(28 31 33);

  --scalar-color-red: #b91c1c;
  --scalar-color-orange: #a16207;
  --scalar-color-green: #047857;
  --scalar-color-blue: #1d4ed8;
  --scalar-color-orange: #c2410c;
  --scalar-color-purple: #6d28d9;
}

.dark-mode {
  color-scheme: dark;
  --scalar-color-1: #fff;
  --scalar-color-2: #cccccc;
  --scalar-color-3: #6d8890;
  --scalar-color-accent: #007acc;
  --scalar-background-1: #00212b;
  --scalar-background-2: #012b36;
  --scalar-background-3: #004052;
  --scalar-background-accent: #015a6f;

  --scalar-border-color: #2f4851;
  --scalar-scrollbar-color: rgba(255, 255, 255, 0.24);
  --scalar-scrollbar-color-active: rgba(255, 255, 255, 0.48);
  --scalar-lifted-brightness: 1.45;
  --scalar-backdrop-brightness: 0.5;

  --scalar-shadow-1: 0 1px 3px 0 rgb(0, 0, 0, 0.1);
  --scalar-shadow-2: rgba(15, 15, 15, 0.2) 0px 3px 6px, rgba(15, 15, 15, 0.4) 0px 9px 24px, 0 0 0 1px
    rgba(255, 255, 255, 0.1);

  --scalar-button-1: #f6f6f6;
  --scalar-button-1-color: #000;
  --scalar-button-1-hover: #e7e7e7;

  --scalar-color-green: #00b648;
  --scalar-color-red: #dc1b19;
  --scalar-color-yellow: #ffc90d;
  --scalar-color-blue: #4eb3ec;
  --scalar-color-orange: #ff8d4d;
  --scalar-color-purple: #b191f9;
}

/* Sidebar */
.light-mode .t-doc__sidebar {
  --scalar-sidebar-background-1: var(--scalar-background-1);
  --scalar-sidebar-item-hover-color: currentColor;
  --scalar-sidebar-item-hover-background: var(--scalar-background-2);
  --scalar-sidebar-item-active-background: var(--scalar-background-accent);
  --scalar-sidebar-border-color: var(--scalar-border-color);
  --scalar-sidebar-color-1: var(--scalar-color-1);
  --scalar-sidebar-color-2: var(--scalar-color-2);
  --scalar-sidebar-color-active: var(--scalar-color-accent);
  --scalar-sidebar-search-background: var(--scalar-background-2);
  --scalar-sidebar-search-border-color: var(--scalar-sidebar-search-background);
  --scalar-sidebar-search--color: var(--scalar-color-3);
}

.dark-mode .sidebar {
  --scalar-sidebar-background-1: var(--scalar-background-1);
  --scalar-sidebar-item-hover-color: currentColor;
  --scalar-sidebar-item-hover-background: var(--scalar-background-2);
  --scalar-sidebar-item-active-background: var(--scalar-background-accent);
  --scalar-sidebar-border-color: var(--scalar-border-color);
  --scalar-sidebar-color-1: var(--scalar-color-1);
  --scalar-sidebar-color-2: var(--scalar-color-2);
  --scalar-sidebar-color-active: var(--scalar-sidebar-color-1);
  --scalar-sidebar-search-background: var(--scalar-background-2);
  --scalar-sidebar-search-border-color: var(--scalar-sidebar-search-background);
  --scalar-sidebar-search--color: var(--scalar-color-3);
}
*::selection {
  background-color: color-mix(in srgb, var(--scalar-color-accent), transparent 70%);
}
`;var exports_external={};__export(exports_external,{void:()=>voidType,util:()=>util,unknown:()=>unknownType,union:()=>unionType,undefined:()=>undefinedType,tuple:()=>tupleType,transformer:()=>effectsType,symbol:()=>symbolType,string:()=>stringType,strictObject:()=>strictObjectType,setErrorMap:()=>setErrorMap,set:()=>setType,record:()=>recordType,quotelessJson:()=>quotelessJson,promise:()=>promiseType,preprocess:()=>preprocessType,pipeline:()=>pipelineType,ostring:()=>ostring,optional:()=>optionalType,onumber:()=>onumber,oboolean:()=>oboolean,objectUtil:()=>objectUtil,object:()=>objectType,number:()=>numberType,nullable:()=>nullableType,null:()=>nullType,never:()=>neverType,nativeEnum:()=>nativeEnumType,nan:()=>nanType,map:()=>mapType,makeIssue:()=>makeIssue,literal:()=>literalType,lazy:()=>lazyType,late:()=>late,isValid:()=>isValid,isDirty:()=>isDirty,isAsync:()=>isAsync2,isAborted:()=>isAborted,intersection:()=>intersectionType,instanceof:()=>instanceOfType,getParsedType:()=>getParsedType,getErrorMap:()=>getErrorMap,function:()=>functionType,enum:()=>enumType,effect:()=>effectsType,discriminatedUnion:()=>discriminatedUnionType,defaultErrorMap:()=>en_default,datetimeRegex:()=>datetimeRegex,date:()=>dateType,custom:()=>custom,coerce:()=>coerce,boolean:()=>booleanType,bigint:()=>bigIntType,array:()=>arrayType,any:()=>anyType,addIssueToContext:()=>addIssueToContext,ZodVoid:()=>ZodVoid,ZodUnknown:()=>ZodUnknown,ZodUnion:()=>ZodUnion,ZodUndefined:()=>ZodUndefined,ZodType:()=>ZodType,ZodTuple:()=>ZodTuple,ZodTransformer:()=>ZodEffects,ZodSymbol:()=>ZodSymbol,ZodString:()=>ZodString,ZodSet:()=>ZodSet,ZodSchema:()=>ZodType,ZodRecord:()=>ZodRecord,ZodReadonly:()=>ZodReadonly,ZodPromise:()=>ZodPromise,ZodPipeline:()=>ZodPipeline,ZodParsedType:()=>ZodParsedType,ZodOptional:()=>ZodOptional,ZodObject:()=>ZodObject,ZodNumber:()=>ZodNumber,ZodNullable:()=>ZodNullable,ZodNull:()=>ZodNull,ZodNever:()=>ZodNever,ZodNativeEnum:()=>ZodNativeEnum,ZodNaN:()=>ZodNaN,ZodMap:()=>ZodMap,ZodLiteral:()=>ZodLiteral,ZodLazy:()=>ZodLazy,ZodIssueCode:()=>ZodIssueCode,ZodIntersection:()=>ZodIntersection,ZodFunction:()=>ZodFunction,ZodFirstPartyTypeKind:()=>ZodFirstPartyTypeKind,ZodError:()=>ZodError,ZodEnum:()=>ZodEnum,ZodEffects:()=>ZodEffects,ZodDiscriminatedUnion:()=>ZodDiscriminatedUnion,ZodDefault:()=>ZodDefault,ZodDate:()=>ZodDate,ZodCatch:()=>ZodCatch,ZodBranded:()=>ZodBranded,ZodBoolean:()=>ZodBoolean,ZodBigInt:()=>ZodBigInt,ZodArray:()=>ZodArray,ZodAny:()=>ZodAny,Schema:()=>ZodType,ParseStatus:()=>ParseStatus,OK:()=>OK,NEVER:()=>NEVER,INVALID:()=>INVALID,EMPTY_PATH:()=>EMPTY_PATH,DIRTY:()=>DIRTY,BRAND:()=>BRAND});var util;(function(util2){util2.assertEqual=(_2)=>{};function assertIs(_arg){}util2.assertIs=assertIs;function assertNever(_x){throw Error()}util2.assertNever=assertNever,util2.arrayToEnum=(items)=>{let obj={};for(let item of items)obj[item]=item;return obj},util2.getValidEnumValues=(obj)=>{let validKeys=util2.objectKeys(obj).filter((k2)=>typeof obj[obj[k2]]!=="number"),filtered={};for(let k2 of validKeys)filtered[k2]=obj[k2];return util2.objectValues(filtered)},util2.objectValues=(obj)=>{return util2.objectKeys(obj).map(function(e){return obj[e]})},util2.objectKeys=typeof Object.keys==="function"?(obj)=>Object.keys(obj):(object)=>{let keys=[];for(let key in object)if(Object.prototype.hasOwnProperty.call(object,key))keys.push(key);return keys},util2.find=(arr,checker)=>{for(let item of arr)if(checker(item))return item;return},util2.isInteger=typeof Number.isInteger==="function"?(val)=>Number.isInteger(val):(val)=>typeof val==="number"&&Number.isFinite(val)&&Math.floor(val)===val;function joinValues(array,separator=" | "){return array.map((val)=>typeof val==="string"?`'${val}'`:val).join(separator)}util2.joinValues=joinValues,util2.jsonStringifyReplacer=(_2,value)=>{if(typeof value==="bigint")return value.toString();return value}})(util||(util={}));var objectUtil;(function(objectUtil2){objectUtil2.mergeShapes=(first,second)=>{return{...first,...second}}})(objectUtil||(objectUtil={}));var ZodParsedType=util.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),getParsedType=(data)=>{switch(typeof data){case"undefined":return ZodParsedType.undefined;case"string":return ZodParsedType.string;case"number":return Number.isNaN(data)?ZodParsedType.nan:ZodParsedType.number;case"boolean":return ZodParsedType.boolean;case"function":return ZodParsedType.function;case"bigint":return ZodParsedType.bigint;case"symbol":return ZodParsedType.symbol;case"object":if(Array.isArray(data))return ZodParsedType.array;if(data===null)return ZodParsedType.null;if(data.then&&typeof data.then==="function"&&data.catch&&typeof data.catch==="function")return ZodParsedType.promise;if(typeof Map<"u"&&data instanceof Map)return ZodParsedType.map;if(typeof Set<"u"&&data instanceof Set)return ZodParsedType.set;if(typeof Date<"u"&&data instanceof Date)return ZodParsedType.date;return ZodParsedType.object;default:return ZodParsedType.unknown}};var ZodIssueCode=util.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]),quotelessJson=(obj)=>{return JSON.stringify(obj,null,2).replace(/"([^"]+)":/g,"$1:")};class ZodError extends Error{get errors(){return this.issues}constructor(issues){super();this.issues=[],this.addIssue=(sub)=>{this.issues=[...this.issues,sub]},this.addIssues=(subs=[])=>{this.issues=[...this.issues,...subs]};let actualProto=new.target.prototype;if(Object.setPrototypeOf)Object.setPrototypeOf(this,actualProto);else this.__proto__=actualProto;this.name="ZodError",this.issues=issues}format(_mapper){let mapper=_mapper||function(issue){return issue.message},fieldErrors={_errors:[]},processError=(error)=>{for(let issue of error.issues)if(issue.code==="invalid_union")issue.unionErrors.map(processError);else if(issue.code==="invalid_return_type")processError(issue.returnTypeError);else if(issue.code==="invalid_arguments")processError(issue.argumentsError);else if(issue.path.length===0)fieldErrors._errors.push(mapper(issue));else{let curr=fieldErrors,i=0;while(i<issue.path.length){let el=issue.path[i];if(i!==issue.path.length-1)curr[el]=curr[el]||{_errors:[]};else curr[el]=curr[el]||{_errors:[]},curr[el]._errors.push(mapper(issue));curr=curr[el],i++}}};return processError(this),fieldErrors}static assert(value){if(!(value instanceof ZodError))throw Error(`Not a ZodError: ${value}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,util.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(mapper=(issue)=>issue.message){let fieldErrors={},formErrors=[];for(let sub of this.issues)if(sub.path.length>0){let firstEl=sub.path[0];fieldErrors[firstEl]=fieldErrors[firstEl]||[],fieldErrors[firstEl].push(mapper(sub))}else formErrors.push(mapper(sub));return{formErrors,fieldErrors}}get formErrors(){return this.flatten()}}ZodError.create=(issues)=>{return new ZodError(issues)};var errorMap=(issue,_ctx)=>{let message;switch(issue.code){case ZodIssueCode.invalid_type:if(issue.received===ZodParsedType.undefined)message="Required";else message=`Expected ${issue.expected}, received ${issue.received}`;break;case ZodIssueCode.invalid_literal:message=`Invalid literal value, expected ${JSON.stringify(issue.expected,util.jsonStringifyReplacer)}`;break;case ZodIssueCode.unrecognized_keys:message=`Unrecognized key(s) in object: ${util.joinValues(issue.keys,", ")}`;break;case ZodIssueCode.invalid_union:message="Invalid input";break;case ZodIssueCode.invalid_union_discriminator:message=`Invalid discriminator value. Expected ${util.joinValues(issue.options)}`;break;case ZodIssueCode.invalid_enum_value:message=`Invalid enum value. Expected ${util.joinValues(issue.options)}, received '${issue.received}'`;break;case ZodIssueCode.invalid_arguments:message="Invalid function arguments";break;case ZodIssueCode.invalid_return_type:message="Invalid function return type";break;case ZodIssueCode.invalid_date:message="Invalid date";break;case ZodIssueCode.invalid_string:if(typeof issue.validation==="object")if("includes"in issue.validation){if(message=`Invalid input: must include "${issue.validation.includes}"`,typeof issue.validation.position==="number")message=`${message} at one or more positions greater than or equal to ${issue.validation.position}`}else if("startsWith"in issue.validation)message=`Invalid input: must start with "${issue.validation.startsWith}"`;else if("endsWith"in issue.validation)message=`Invalid input: must end with "${issue.validation.endsWith}"`;else util.assertNever(issue.validation);else if(issue.validation!=="regex")message=`Invalid ${issue.validation}`;else message="Invalid";break;case ZodIssueCode.too_small:if(issue.type==="array")message=`Array must contain ${issue.exact?"exactly":issue.inclusive?"at least":"more than"} ${issue.minimum} element(s)`;else if(issue.type==="string")message=`String must contain ${issue.exact?"exactly":issue.inclusive?"at least":"over"} ${issue.minimum} character(s)`;else if(issue.type==="number")message=`Number must be ${issue.exact?"exactly equal to ":issue.inclusive?"greater than or equal to ":"greater than "}${issue.minimum}`;else if(issue.type==="bigint")message=`Number must be ${issue.exact?"exactly equal to ":issue.inclusive?"greater than or equal to ":"greater than "}${issue.minimum}`;else if(issue.type==="date")message=`Date must be ${issue.exact?"exactly equal to ":issue.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(issue.minimum))}`;else message="Invalid input";break;case ZodIssueCode.too_big:if(issue.type==="array")message=`Array must contain ${issue.exact?"exactly":issue.inclusive?"at most":"less than"} ${issue.maximum} element(s)`;else if(issue.type==="string")message=`String must contain ${issue.exact?"exactly":issue.inclusive?"at most":"under"} ${issue.maximum} character(s)`;else if(issue.type==="number")message=`Number must be ${issue.exact?"exactly":issue.inclusive?"less than or equal to":"less than"} ${issue.maximum}`;else if(issue.type==="bigint")message=`BigInt must be ${issue.exact?"exactly":issue.inclusive?"less than or equal to":"less than"} ${issue.maximum}`;else if(issue.type==="date")message=`Date must be ${issue.exact?"exactly":issue.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(issue.maximum))}`;else message="Invalid input";break;case ZodIssueCode.custom:message="Invalid input";break;case ZodIssueCode.invalid_intersection_types:message="Intersection results could not be merged";break;case ZodIssueCode.not_multiple_of:message=`Number must be a multiple of ${issue.multipleOf}`;break;case ZodIssueCode.not_finite:message="Number must be finite";break;default:message=_ctx.defaultError,util.assertNever(issue)}return{message}},en_default=errorMap;var overrideErrorMap=en_default;function setErrorMap(map3){overrideErrorMap=map3}function getErrorMap(){return overrideErrorMap}var makeIssue=(params)=>{let{data,path,errorMaps,issueData}=params,fullPath=[...path,...issueData.path||[]],fullIssue={...issueData,path:fullPath};if(issueData.message!==void 0)return{...issueData,path:fullPath,message:issueData.message};let errorMessage="",maps=errorMaps.filter((m)=>!!m).slice().reverse();for(let map3 of maps)errorMessage=map3(fullIssue,{data,defaultError:errorMessage}).message;return{...issueData,path:fullPath,message:errorMessage}},EMPTY_PATH=[];function addIssueToContext(ctx,issueData){let overrideMap=getErrorMap(),issue=makeIssue({issueData,data:ctx.data,path:ctx.path,errorMaps:[ctx.common.contextualErrorMap,ctx.schemaErrorMap,overrideMap,overrideMap===en_default?void 0:en_default].filter((x)=>!!x)});ctx.common.issues.push(issue)}class ParseStatus{constructor(){this.value="valid"}dirty(){if(this.value==="valid")this.value="dirty"}abort(){if(this.value!=="aborted")this.value="aborted"}static mergeArray(status2,results){let arrayValue=[];for(let s of results){if(s.status==="aborted")return INVALID;if(s.status==="dirty")status2.dirty();arrayValue.push(s.value)}return{status:status2.value,value:arrayValue}}static async mergeObjectAsync(status2,pairs){let syncPairs=[];for(let pair of pairs){let key=await pair.key,value=await pair.value;syncPairs.push({key,value})}return ParseStatus.mergeObjectSync(status2,syncPairs)}static mergeObjectSync(status2,pairs){let finalObject={};for(let pair of pairs){let{key,value}=pair;if(key.status==="aborted")return INVALID;if(value.status==="aborted")return INVALID;if(key.status==="dirty")status2.dirty();if(value.status==="dirty")status2.dirty();if(key.value!=="__proto__"&&(typeof value.value<"u"||pair.alwaysSet))finalObject[key.value]=value.value}return{status:status2.value,value:finalObject}}}var INVALID=Object.freeze({status:"aborted"}),DIRTY=(value)=>({status:"dirty",value}),OK=(value)=>({status:"valid",value}),isAborted=(x)=>x.status==="aborted",isDirty=(x)=>x.status==="dirty",isValid=(x)=>x.status==="valid",isAsync2=(x)=>typeof Promise<"u"&&x instanceof Promise;var errorUtil;(function(errorUtil2){errorUtil2.errToObj=(message)=>typeof message==="string"?{message}:message||{},errorUtil2.toString=(message)=>typeof message==="string"?message:message?.message})(errorUtil||(errorUtil={}));class ParseInputLazyPath{constructor(parent,value,path,key){this._cachedPath=[],this.parent=parent,this.data=value,this._path=path,this._key=key}get path(){if(!this._cachedPath.length)if(Array.isArray(this._key))this._cachedPath.push(...this._path,...this._key);else this._cachedPath.push(...this._path,this._key);return this._cachedPath}}var handleResult=(ctx,result)=>{if(isValid(result))return{success:!0,data:result.value};else{if(!ctx.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let error=new ZodError(ctx.common.issues);return this._error=error,this._error}}}};function processCreateParams(params){if(!params)return{};let{errorMap:errorMap2,invalid_type_error,required_error,description}=params;if(errorMap2&&(invalid_type_error||required_error))throw Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);if(errorMap2)return{errorMap:errorMap2,description};return{errorMap:(iss,ctx)=>{let{message}=params;if(iss.code==="invalid_enum_value")return{message:message??ctx.defaultError};if(typeof ctx.data>"u")return{message:message??required_error??ctx.defaultError};if(iss.code!=="invalid_type")return{message:ctx.defaultError};return{message:message??invalid_type_error??ctx.defaultError}},description}}class ZodType{get description(){return this._def.description}_getType(input){return getParsedType(input.data)}_getOrReturnCtx(input,ctx){return ctx||{common:input.parent.common,data:input.data,parsedType:getParsedType(input.data),schemaErrorMap:this._def.errorMap,path:input.path,parent:input.parent}}_processInputParams(input){return{status:new ParseStatus,ctx:{common:input.parent.common,data:input.data,parsedType:getParsedType(input.data),schemaErrorMap:this._def.errorMap,path:input.path,parent:input.parent}}}_parseSync(input){let result=this._parse(input);if(isAsync2(result))throw Error("Synchronous parse encountered promise.");return result}_parseAsync(input){let result=this._parse(input);return Promise.resolve(result)}parse(data,params){let result=this.safeParse(data,params);if(result.success)return result.data;throw result.error}safeParse(data,params){let ctx={common:{issues:[],async:params?.async??!1,contextualErrorMap:params?.errorMap},path:params?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data,parsedType:getParsedType(data)},result=this._parseSync({data,path:ctx.path,parent:ctx});return handleResult(ctx,result)}"~validate"(data){let ctx={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data,parsedType:getParsedType(data)};if(!this["~standard"].async)try{let result=this._parseSync({data,path:[],parent:ctx});return isValid(result)?{value:result.value}:{issues:ctx.common.issues}}catch(err){if(err?.message?.toLowerCase()?.includes("encountered"))this["~standard"].async=!0;ctx.common={issues:[],async:!0}}return this._parseAsync({data,path:[],parent:ctx}).then((result)=>isValid(result)?{value:result.value}:{issues:ctx.common.issues})}async parseAsync(data,params){let result=await this.safeParseAsync(data,params);if(result.success)return result.data;throw result.error}async safeParseAsync(data,params){let ctx={common:{issues:[],contextualErrorMap:params?.errorMap,async:!0},path:params?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data,parsedType:getParsedType(data)},maybeAsyncResult=this._parse({data,path:ctx.path,parent:ctx}),result=await(isAsync2(maybeAsyncResult)?maybeAsyncResult:Promise.resolve(maybeAsyncResult));return handleResult(ctx,result)}refine(check2,message){let getIssueProperties=(val)=>{if(typeof message==="string"||typeof message>"u")return{message};else if(typeof message==="function")return message(val);else return message};return this._refinement((val,ctx)=>{let result=check2(val),setError=()=>ctx.addIssue({code:ZodIssueCode.custom,...getIssueProperties(val)});if(typeof Promise<"u"&&result instanceof Promise)return result.then((data)=>{if(!data)return setError(),!1;else return!0});if(!result)return setError(),!1;else return!0})}refinement(check2,refinementData){return this._refinement((val,ctx)=>{if(!check2(val))return ctx.addIssue(typeof refinementData==="function"?refinementData(val,ctx):refinementData),!1;else return!0})}_refinement(refinement){return new ZodEffects({schema:this,typeName:ZodFirstPartyTypeKind.ZodEffects,effect:{type:"refinement",refinement}})}superRefine(refinement){return this._refinement(refinement)}constructor(def){this.spa=this.safeParseAsync,this._def=def,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:(data)=>this["~validate"](data)}}optional(){return ZodOptional.create(this,this._def)}nullable(){return ZodNullable.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ZodArray.create(this)}promise(){return ZodPromise.create(this,this._def)}or(option){return ZodUnion.create([this,option],this._def)}and(incoming){return ZodIntersection.create(this,incoming,this._def)}transform(transform2){return new ZodEffects({...processCreateParams(this._def),schema:this,typeName:ZodFirstPartyTypeKind.ZodEffects,effect:{type:"transform",transform:transform2}})}default(def){let defaultValueFunc=typeof def==="function"?def:()=>def;return new ZodDefault({...processCreateParams(this._def),innerType:this,defaultValue:defaultValueFunc,typeName:ZodFirstPartyTypeKind.ZodDefault})}brand(){return new ZodBranded({typeName:ZodFirstPartyTypeKind.ZodBranded,type:this,...processCreateParams(this._def)})}catch(def){let catchValueFunc=typeof def==="function"?def:()=>def;return new ZodCatch({...processCreateParams(this._def),innerType:this,catchValue:catchValueFunc,typeName:ZodFirstPartyTypeKind.ZodCatch})}describe(description){return new this.constructor({...this._def,description})}pipe(target){return ZodPipeline.create(this,target)}readonly(){return ZodReadonly.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}var cuidRegex=/^c[^\s-]{8,}$/i,cuid2Regex=/^[0-9a-z]+$/,ulidRegex=/^[0-9A-HJKMNP-TV-Z]{26}$/i,uuidRegex=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,nanoidRegex=/^[a-z0-9_-]{21}$/i,jwtRegex=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,durationRegex=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,emailRegex=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,_emojiRegex="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",emojiRegex,ipv4Regex=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4CidrRegex=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6Regex=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,ipv6CidrRegex=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64Regex=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64urlRegex=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,dateRegexSource="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",dateRegex=new RegExp(`^${dateRegexSource}$`);function timeRegexSource(args){let secondsRegexSource="[0-5]\\d";if(args.precision)secondsRegexSource=`${secondsRegexSource}\\.\\d{${args.precision}}`;else if(args.precision==null)secondsRegexSource=`${secondsRegexSource}(\\.\\d+)?`;let secondsQuantifier=args.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${secondsRegexSource})${secondsQuantifier}`}function timeRegex(args){return new RegExp(`^${timeRegexSource(args)}$`)}function datetimeRegex(args){let regex2=`${dateRegexSource}T${timeRegexSource(args)}`,opts=[];if(opts.push(args.local?"Z?":"Z"),args.offset)opts.push("([+-]\\d{2}:?\\d{2})");return regex2=`${regex2}(${opts.join("|")})`,new RegExp(`^${regex2}$`)}function isValidIP(ip,version){if((version==="v4"||!version)&&ipv4Regex.test(ip))return!0;if((version==="v6"||!version)&&ipv6Regex.test(ip))return!0;return!1}function isValidJWT(jwt,alg){if(!jwtRegex.test(jwt))return!1;try{let[header]=jwt.split(".");if(!header)return!1;let base64=header.replace(/-/g,"+").replace(/_/g,"/").padEnd(header.length+(4-header.length%4)%4,"="),decoded=JSON.parse(atob(base64));if(typeof decoded!=="object"||decoded===null)return!1;if("typ"in decoded&&decoded?.typ!=="JWT")return!1;if(!decoded.alg)return!1;if(alg&&decoded.alg!==alg)return!1;return!0}catch{return!1}}function isValidCidr(ip,version){if((version==="v4"||!version)&&ipv4CidrRegex.test(ip))return!0;if((version==="v6"||!version)&&ipv6CidrRegex.test(ip))return!0;return!1}class ZodString extends ZodType{_parse(input){if(this._def.coerce)input.data=String(input.data);if(this._getType(input)!==ZodParsedType.string){let ctx2=this._getOrReturnCtx(input);return addIssueToContext(ctx2,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.string,received:ctx2.parsedType}),INVALID}let status2=new ParseStatus,ctx=void 0;for(let check2 of this._def.checks)if(check2.kind==="min"){if(input.data.length<check2.value)ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{code:ZodIssueCode.too_small,minimum:check2.value,type:"string",inclusive:!0,exact:!1,message:check2.message}),status2.dirty()}else if(check2.kind==="max"){if(input.data.length>check2.value)ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{code:ZodIssueCode.too_big,maximum:check2.value,type:"string",inclusive:!0,exact:!1,message:check2.message}),status2.dirty()}else if(check2.kind==="length"){let tooBig=input.data.length>check2.value,tooSmall=input.data.length<check2.value;if(tooBig||tooSmall){if(ctx=this._getOrReturnCtx(input,ctx),tooBig)addIssueToContext(ctx,{code:ZodIssueCode.too_big,maximum:check2.value,type:"string",inclusive:!0,exact:!0,message:check2.message});else if(tooSmall)addIssueToContext(ctx,{code:ZodIssueCode.too_small,minimum:check2.value,type:"string",inclusive:!0,exact:!0,message:check2.message});status2.dirty()}}else if(check2.kind==="email"){if(!emailRegex.test(input.data))ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{validation:"email",code:ZodIssueCode.invalid_string,message:check2.message}),status2.dirty()}else if(check2.kind==="emoji"){if(!emojiRegex)emojiRegex=new RegExp(_emojiRegex,"u");if(!emojiRegex.test(input.data))ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{validation:"emoji",code:ZodIssueCode.invalid_string,message:check2.message}),status2.dirty()}else if(check2.kind==="uuid"){if(!uuidRegex.test(input.data))ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{validation:"uuid",code:ZodIssueCode.invalid_string,message:check2.message}),status2.dirty()}else if(check2.kind==="nanoid"){if(!nanoidRegex.test(input.data))ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{validation:"nanoid",code:ZodIssueCode.invalid_string,message:check2.message}),status2.dirty()}else if(check2.kind==="cuid"){if(!cuidRegex.test(input.data))ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{validation:"cuid",code:ZodIssueCode.invalid_string,message:check2.message}),status2.dirty()}else if(check2.kind==="cuid2"){if(!cuid2Regex.test(input.data))ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{validation:"cuid2",code:ZodIssueCode.invalid_string,message:check2.message}),status2.dirty()}else if(check2.kind==="ulid"){if(!ulidRegex.test(input.data))ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{validation:"ulid",code:ZodIssueCode.invalid_string,message:check2.message}),status2.dirty()}else if(check2.kind==="url")try{new URL(input.data)}catch{ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{validation:"url",code:ZodIssueCode.invalid_string,message:check2.message}),status2.dirty()}else if(check2.kind==="regex"){if(check2.regex.lastIndex=0,!check2.regex.test(input.data))ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{validation:"regex",code:ZodIssueCode.invalid_string,message:check2.message}),status2.dirty()}else if(check2.kind==="trim")input.data=input.data.trim();else if(check2.kind==="includes"){if(!input.data.includes(check2.value,check2.position))ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{code:ZodIssueCode.invalid_string,validation:{includes:check2.value,position:check2.position},message:check2.message}),status2.dirty()}else if(check2.kind==="toLowerCase")input.data=input.data.toLowerCase();else if(check2.kind==="toUpperCase")input.data=input.data.toUpperCase();else if(check2.kind==="startsWith"){if(!input.data.startsWith(check2.value))ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{code:ZodIssueCode.invalid_string,validation:{startsWith:check2.value},message:check2.message}),status2.dirty()}else if(check2.kind==="endsWith"){if(!input.data.endsWith(check2.value))ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{code:ZodIssueCode.invalid_string,validation:{endsWith:check2.value},message:check2.message}),status2.dirty()}else if(check2.kind==="datetime"){if(!datetimeRegex(check2).test(input.data))ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{code:ZodIssueCode.invalid_string,validation:"datetime",message:check2.message}),status2.dirty()}else if(check2.kind==="date"){if(!dateRegex.test(input.data))ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{code:ZodIssueCode.invalid_string,validation:"date",message:check2.message}),status2.dirty()}else if(check2.kind==="time"){if(!timeRegex(check2).test(input.data))ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{code:ZodIssueCode.invalid_string,validation:"time",message:check2.message}),status2.dirty()}else if(check2.kind==="duration"){if(!durationRegex.test(input.data))ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{validation:"duration",code:ZodIssueCode.invalid_string,message:check2.message}),status2.dirty()}else if(check2.kind==="ip"){if(!isValidIP(input.data,check2.version))ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{validation:"ip",code:ZodIssueCode.invalid_string,message:check2.message}),status2.dirty()}else if(check2.kind==="jwt"){if(!isValidJWT(input.data,check2.alg))ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{validation:"jwt",code:ZodIssueCode.invalid_string,message:check2.message}),status2.dirty()}else if(check2.kind==="cidr"){if(!isValidCidr(input.data,check2.version))ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{validation:"cidr",code:ZodIssueCode.invalid_string,message:check2.message}),status2.dirty()}else if(check2.kind==="base64"){if(!base64Regex.test(input.data))ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{validation:"base64",code:ZodIssueCode.invalid_string,message:check2.message}),status2.dirty()}else if(check2.kind==="base64url"){if(!base64urlRegex.test(input.data))ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{validation:"base64url",code:ZodIssueCode.invalid_string,message:check2.message}),status2.dirty()}else util.assertNever(check2);return{status:status2.value,value:input.data}}_regex(regex2,validation,message){return this.refinement((data)=>regex2.test(data),{validation,code:ZodIssueCode.invalid_string,...errorUtil.errToObj(message)})}_addCheck(check2){return new ZodString({...this._def,checks:[...this._def.checks,check2]})}email(message){return this._addCheck({kind:"email",...errorUtil.errToObj(message)})}url(message){return this._addCheck({kind:"url",...errorUtil.errToObj(message)})}emoji(message){return this._addCheck({kind:"emoji",...errorUtil.errToObj(message)})}uuid(message){return this._addCheck({kind:"uuid",...errorUtil.errToObj(message)})}nanoid(message){return this._addCheck({kind:"nanoid",...errorUtil.errToObj(message)})}cuid(message){return this._addCheck({kind:"cuid",...errorUtil.errToObj(message)})}cuid2(message){return this._addCheck({kind:"cuid2",...errorUtil.errToObj(message)})}ulid(message){return this._addCheck({kind:"ulid",...errorUtil.errToObj(message)})}base64(message){return this._addCheck({kind:"base64",...errorUtil.errToObj(message)})}base64url(message){return this._addCheck({kind:"base64url",...errorUtil.errToObj(message)})}jwt(options){return this._addCheck({kind:"jwt",...errorUtil.errToObj(options)})}ip(options){return this._addCheck({kind:"ip",...errorUtil.errToObj(options)})}cidr(options){return this._addCheck({kind:"cidr",...errorUtil.errToObj(options)})}datetime(options){if(typeof options==="string")return this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:options});return this._addCheck({kind:"datetime",precision:typeof options?.precision>"u"?null:options?.precision,offset:options?.offset??!1,local:options?.local??!1,...errorUtil.errToObj(options?.message)})}date(message){return this._addCheck({kind:"date",message})}time(options){if(typeof options==="string")return this._addCheck({kind:"time",precision:null,message:options});return this._addCheck({kind:"time",precision:typeof options?.precision>"u"?null:options?.precision,...errorUtil.errToObj(options?.message)})}duration(message){return this._addCheck({kind:"duration",...errorUtil.errToObj(message)})}regex(regex2,message){return this._addCheck({kind:"regex",regex:regex2,...errorUtil.errToObj(message)})}includes(value,options){return this._addCheck({kind:"includes",value,position:options?.position,...errorUtil.errToObj(options?.message)})}startsWith(value,message){return this._addCheck({kind:"startsWith",value,...errorUtil.errToObj(message)})}endsWith(value,message){return this._addCheck({kind:"endsWith",value,...errorUtil.errToObj(message)})}min(minLength,message){return this._addCheck({kind:"min",value:minLength,...errorUtil.errToObj(message)})}max(maxLength,message){return this._addCheck({kind:"max",value:maxLength,...errorUtil.errToObj(message)})}length(len,message){return this._addCheck({kind:"length",value:len,...errorUtil.errToObj(message)})}nonempty(message){return this.min(1,errorUtil.errToObj(message))}trim(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find((ch)=>ch.kind==="datetime")}get isDate(){return!!this._def.checks.find((ch)=>ch.kind==="date")}get isTime(){return!!this._def.checks.find((ch)=>ch.kind==="time")}get isDuration(){return!!this._def.checks.find((ch)=>ch.kind==="duration")}get isEmail(){return!!this._def.checks.find((ch)=>ch.kind==="email")}get isURL(){return!!this._def.checks.find((ch)=>ch.kind==="url")}get isEmoji(){return!!this._def.checks.find((ch)=>ch.kind==="emoji")}get isUUID(){return!!this._def.checks.find((ch)=>ch.kind==="uuid")}get isNANOID(){return!!this._def.checks.find((ch)=>ch.kind==="nanoid")}get isCUID(){return!!this._def.checks.find((ch)=>ch.kind==="cuid")}get isCUID2(){return!!this._def.checks.find((ch)=>ch.kind==="cuid2")}get isULID(){return!!this._def.checks.find((ch)=>ch.kind==="ulid")}get isIP(){return!!this._def.checks.find((ch)=>ch.kind==="ip")}get isCIDR(){return!!this._def.checks.find((ch)=>ch.kind==="cidr")}get isBase64(){return!!this._def.checks.find((ch)=>ch.kind==="base64")}get isBase64url(){return!!this._def.checks.find((ch)=>ch.kind==="base64url")}get minLength(){let min=null;for(let ch of this._def.checks)if(ch.kind==="min"){if(min===null||ch.value>min)min=ch.value}return min}get maxLength(){let max=null;for(let ch of this._def.checks)if(ch.kind==="max"){if(max===null||ch.value<max)max=ch.value}return max}}ZodString.create=(params)=>{return new ZodString({checks:[],typeName:ZodFirstPartyTypeKind.ZodString,coerce:params?.coerce??!1,...processCreateParams(params)})};function floatSafeRemainder(val,step){let valDecCount=(val.toString().split(".")[1]||"").length,stepDecCount=(step.toString().split(".")[1]||"").length,decCount=valDecCount>stepDecCount?valDecCount:stepDecCount,valInt=Number.parseInt(val.toFixed(decCount).replace(".","")),stepInt=Number.parseInt(step.toFixed(decCount).replace(".",""));return valInt%stepInt/10**decCount}class ZodNumber extends ZodType{constructor(){super(...arguments);this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(input){if(this._def.coerce)input.data=Number(input.data);if(this._getType(input)!==ZodParsedType.number){let ctx2=this._getOrReturnCtx(input);return addIssueToContext(ctx2,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.number,received:ctx2.parsedType}),INVALID}let ctx=void 0,status2=new ParseStatus;for(let check2 of this._def.checks)if(check2.kind==="int"){if(!util.isInteger(input.data))ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:"integer",received:"float",message:check2.message}),status2.dirty()}else if(check2.kind==="min"){if(check2.inclusive?input.data<check2.value:input.data<=check2.value)ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{code:ZodIssueCode.too_small,minimum:check2.value,type:"number",inclusive:check2.inclusive,exact:!1,message:check2.message}),status2.dirty()}else if(check2.kind==="max"){if(check2.inclusive?input.data>check2.value:input.data>=check2.value)ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{code:ZodIssueCode.too_big,maximum:check2.value,type:"number",inclusive:check2.inclusive,exact:!1,message:check2.message}),status2.dirty()}else if(check2.kind==="multipleOf"){if(floatSafeRemainder(input.data,check2.value)!==0)ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{code:ZodIssueCode.not_multiple_of,multipleOf:check2.value,message:check2.message}),status2.dirty()}else if(check2.kind==="finite"){if(!Number.isFinite(input.data))ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{code:ZodIssueCode.not_finite,message:check2.message}),status2.dirty()}else util.assertNever(check2);return{status:status2.value,value:input.data}}gte(value,message){return this.setLimit("min",value,!0,errorUtil.toString(message))}gt(value,message){return this.setLimit("min",value,!1,errorUtil.toString(message))}lte(value,message){return this.setLimit("max",value,!0,errorUtil.toString(message))}lt(value,message){return this.setLimit("max",value,!1,errorUtil.toString(message))}setLimit(kind,value,inclusive,message){return new ZodNumber({...this._def,checks:[...this._def.checks,{kind,value,inclusive,message:errorUtil.toString(message)}]})}_addCheck(check2){return new ZodNumber({...this._def,checks:[...this._def.checks,check2]})}int(message){return this._addCheck({kind:"int",message:errorUtil.toString(message)})}positive(message){return this._addCheck({kind:"min",value:0,inclusive:!1,message:errorUtil.toString(message)})}negative(message){return this._addCheck({kind:"max",value:0,inclusive:!1,message:errorUtil.toString(message)})}nonpositive(message){return this._addCheck({kind:"max",value:0,inclusive:!0,message:errorUtil.toString(message)})}nonnegative(message){return this._addCheck({kind:"min",value:0,inclusive:!0,message:errorUtil.toString(message)})}multipleOf(value,message){return this._addCheck({kind:"multipleOf",value,message:errorUtil.toString(message)})}finite(message){return this._addCheck({kind:"finite",message:errorUtil.toString(message)})}safe(message){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:errorUtil.toString(message)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:errorUtil.toString(message)})}get minValue(){let min=null;for(let ch of this._def.checks)if(ch.kind==="min"){if(min===null||ch.value>min)min=ch.value}return min}get maxValue(){let max=null;for(let ch of this._def.checks)if(ch.kind==="max"){if(max===null||ch.value<max)max=ch.value}return max}get isInt(){return!!this._def.checks.find((ch)=>ch.kind==="int"||ch.kind==="multipleOf"&&util.isInteger(ch.value))}get isFinite(){let max=null,min=null;for(let ch of this._def.checks)if(ch.kind==="finite"||ch.kind==="int"||ch.kind==="multipleOf")return!0;else if(ch.kind==="min"){if(min===null||ch.value>min)min=ch.value}else if(ch.kind==="max"){if(max===null||ch.value<max)max=ch.value}return Number.isFinite(min)&&Number.isFinite(max)}}ZodNumber.create=(params)=>{return new ZodNumber({checks:[],typeName:ZodFirstPartyTypeKind.ZodNumber,coerce:params?.coerce||!1,...processCreateParams(params)})};class ZodBigInt extends ZodType{constructor(){super(...arguments);this.min=this.gte,this.max=this.lte}_parse(input){if(this._def.coerce)try{input.data=BigInt(input.data)}catch{return this._getInvalidInput(input)}if(this._getType(input)!==ZodParsedType.bigint)return this._getInvalidInput(input);let ctx=void 0,status2=new ParseStatus;for(let check2 of this._def.checks)if(check2.kind==="min"){if(check2.inclusive?input.data<check2.value:input.data<=check2.value)ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{code:ZodIssueCode.too_small,type:"bigint",minimum:check2.value,inclusive:check2.inclusive,message:check2.message}),status2.dirty()}else if(check2.kind==="max"){if(check2.inclusive?input.data>check2.value:input.data>=check2.value)ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{code:ZodIssueCode.too_big,type:"bigint",maximum:check2.value,inclusive:check2.inclusive,message:check2.message}),status2.dirty()}else if(check2.kind==="multipleOf"){if(input.data%check2.value!==BigInt(0))ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{code:ZodIssueCode.not_multiple_of,multipleOf:check2.value,message:check2.message}),status2.dirty()}else util.assertNever(check2);return{status:status2.value,value:input.data}}_getInvalidInput(input){let ctx=this._getOrReturnCtx(input);return addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.bigint,received:ctx.parsedType}),INVALID}gte(value,message){return this.setLimit("min",value,!0,errorUtil.toString(message))}gt(value,message){return this.setLimit("min",value,!1,errorUtil.toString(message))}lte(value,message){return this.setLimit("max",value,!0,errorUtil.toString(message))}lt(value,message){return this.setLimit("max",value,!1,errorUtil.toString(message))}setLimit(kind,value,inclusive,message){return new ZodBigInt({...this._def,checks:[...this._def.checks,{kind,value,inclusive,message:errorUtil.toString(message)}]})}_addCheck(check2){return new ZodBigInt({...this._def,checks:[...this._def.checks,check2]})}positive(message){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:errorUtil.toString(message)})}negative(message){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:errorUtil.toString(message)})}nonpositive(message){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:errorUtil.toString(message)})}nonnegative(message){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:errorUtil.toString(message)})}multipleOf(value,message){return this._addCheck({kind:"multipleOf",value,message:errorUtil.toString(message)})}get minValue(){let min=null;for(let ch of this._def.checks)if(ch.kind==="min"){if(min===null||ch.value>min)min=ch.value}return min}get maxValue(){let max=null;for(let ch of this._def.checks)if(ch.kind==="max"){if(max===null||ch.value<max)max=ch.value}return max}}ZodBigInt.create=(params)=>{return new ZodBigInt({checks:[],typeName:ZodFirstPartyTypeKind.ZodBigInt,coerce:params?.coerce??!1,...processCreateParams(params)})};class ZodBoolean extends ZodType{_parse(input){if(this._def.coerce)input.data=Boolean(input.data);if(this._getType(input)!==ZodParsedType.boolean){let ctx=this._getOrReturnCtx(input);return addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.boolean,received:ctx.parsedType}),INVALID}return OK(input.data)}}ZodBoolean.create=(params)=>{return new ZodBoolean({typeName:ZodFirstPartyTypeKind.ZodBoolean,coerce:params?.coerce||!1,...processCreateParams(params)})};class ZodDate extends ZodType{_parse(input){if(this._def.coerce)input.data=new Date(input.data);if(this._getType(input)!==ZodParsedType.date){let ctx2=this._getOrReturnCtx(input);return addIssueToContext(ctx2,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.date,received:ctx2.parsedType}),INVALID}if(Number.isNaN(input.data.getTime())){let ctx2=this._getOrReturnCtx(input);return addIssueToContext(ctx2,{code:ZodIssueCode.invalid_date}),INVALID}let status2=new ParseStatus,ctx=void 0;for(let check2 of this._def.checks)if(check2.kind==="min"){if(input.data.getTime()<check2.value)ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{code:ZodIssueCode.too_small,message:check2.message,inclusive:!0,exact:!1,minimum:check2.value,type:"date"}),status2.dirty()}else if(check2.kind==="max"){if(input.data.getTime()>check2.value)ctx=this._getOrReturnCtx(input,ctx),addIssueToContext(ctx,{code:ZodIssueCode.too_big,message:check2.message,inclusive:!0,exact:!1,maximum:check2.value,type:"date"}),status2.dirty()}else util.assertNever(check2);return{status:status2.value,value:new Date(input.data.getTime())}}_addCheck(check2){return new ZodDate({...this._def,checks:[...this._def.checks,check2]})}min(minDate,message){return this._addCheck({kind:"min",value:minDate.getTime(),message:errorUtil.toString(message)})}max(maxDate,message){return this._addCheck({kind:"max",value:maxDate.getTime(),message:errorUtil.toString(message)})}get minDate(){let min=null;for(let ch of this._def.checks)if(ch.kind==="min"){if(min===null||ch.value>min)min=ch.value}return min!=null?new Date(min):null}get maxDate(){let max=null;for(let ch of this._def.checks)if(ch.kind==="max"){if(max===null||ch.value<max)max=ch.value}return max!=null?new Date(max):null}}ZodDate.create=(params)=>{return new ZodDate({checks:[],coerce:params?.coerce||!1,typeName:ZodFirstPartyTypeKind.ZodDate,...processCreateParams(params)})};class ZodSymbol extends ZodType{_parse(input){if(this._getType(input)!==ZodParsedType.symbol){let ctx=this._getOrReturnCtx(input);return addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.symbol,received:ctx.parsedType}),INVALID}return OK(input.data)}}ZodSymbol.create=(params)=>{return new ZodSymbol({typeName:ZodFirstPartyTypeKind.ZodSymbol,...processCreateParams(params)})};class ZodUndefined extends ZodType{_parse(input){if(this._getType(input)!==ZodParsedType.undefined){let ctx=this._getOrReturnCtx(input);return addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.undefined,received:ctx.parsedType}),INVALID}return OK(input.data)}}ZodUndefined.create=(params)=>{return new ZodUndefined({typeName:ZodFirstPartyTypeKind.ZodUndefined,...processCreateParams(params)})};class ZodNull extends ZodType{_parse(input){if(this._getType(input)!==ZodParsedType.null){let ctx=this._getOrReturnCtx(input);return addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.null,received:ctx.parsedType}),INVALID}return OK(input.data)}}ZodNull.create=(params)=>{return new ZodNull({typeName:ZodFirstPartyTypeKind.ZodNull,...processCreateParams(params)})};class ZodAny extends ZodType{constructor(){super(...arguments);this._any=!0}_parse(input){return OK(input.data)}}ZodAny.create=(params)=>{return new ZodAny({typeName:ZodFirstPartyTypeKind.ZodAny,...processCreateParams(params)})};class ZodUnknown extends ZodType{constructor(){super(...arguments);this._unknown=!0}_parse(input){return OK(input.data)}}ZodUnknown.create=(params)=>{return new ZodUnknown({typeName:ZodFirstPartyTypeKind.ZodUnknown,...processCreateParams(params)})};class ZodNever extends ZodType{_parse(input){let ctx=this._getOrReturnCtx(input);return addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.never,received:ctx.parsedType}),INVALID}}ZodNever.create=(params)=>{return new ZodNever({typeName:ZodFirstPartyTypeKind.ZodNever,...processCreateParams(params)})};class ZodVoid extends ZodType{_parse(input){if(this._getType(input)!==ZodParsedType.undefined){let ctx=this._getOrReturnCtx(input);return addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.void,received:ctx.parsedType}),INVALID}return OK(input.data)}}ZodVoid.create=(params)=>{return new ZodVoid({typeName:ZodFirstPartyTypeKind.ZodVoid,...processCreateParams(params)})};class ZodArray extends ZodType{_parse(input){let{ctx,status:status2}=this._processInputParams(input),def=this._def;if(ctx.parsedType!==ZodParsedType.array)return addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.array,received:ctx.parsedType}),INVALID;if(def.exactLength!==null){let tooBig=ctx.data.length>def.exactLength.value,tooSmall=ctx.data.length<def.exactLength.value;if(tooBig||tooSmall)addIssueToContext(ctx,{code:tooBig?ZodIssueCode.too_big:ZodIssueCode.too_small,minimum:tooSmall?def.exactLength.value:void 0,maximum:tooBig?def.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:def.exactLength.message}),status2.dirty()}if(def.minLength!==null){if(ctx.data.length<def.minLength.value)addIssueToContext(ctx,{code:ZodIssueCode.too_small,minimum:def.minLength.value,type:"array",inclusive:!0,exact:!1,message:def.minLength.message}),status2.dirty()}if(def.maxLength!==null){if(ctx.data.length>def.maxLength.value)addIssueToContext(ctx,{code:ZodIssueCode.too_big,maximum:def.maxLength.value,type:"array",inclusive:!0,exact:!1,message:def.maxLength.message}),status2.dirty()}if(ctx.common.async)return Promise.all([...ctx.data].map((item,i)=>{return def.type._parseAsync(new ParseInputLazyPath(ctx,item,ctx.path,i))})).then((result2)=>{return ParseStatus.mergeArray(status2,result2)});let result=[...ctx.data].map((item,i)=>{return def.type._parseSync(new ParseInputLazyPath(ctx,item,ctx.path,i))});return ParseStatus.mergeArray(status2,result)}get element(){return this._def.type}min(minLength,message){return new ZodArray({...this._def,minLength:{value:minLength,message:errorUtil.toString(message)}})}max(maxLength,message){return new ZodArray({...this._def,maxLength:{value:maxLength,message:errorUtil.toString(message)}})}length(len,message){return new ZodArray({...this._def,exactLength:{value:len,message:errorUtil.toString(message)}})}nonempty(message){return this.min(1,message)}}ZodArray.create=(schema,params)=>{return new ZodArray({type:schema,minLength:null,maxLength:null,exactLength:null,typeName:ZodFirstPartyTypeKind.ZodArray,...processCreateParams(params)})};function deepPartialify(schema){if(schema instanceof ZodObject){let newShape={};for(let key in schema.shape){let fieldSchema=schema.shape[key];newShape[key]=ZodOptional.create(deepPartialify(fieldSchema))}return new ZodObject({...schema._def,shape:()=>newShape})}else if(schema instanceof ZodArray)return new ZodArray({...schema._def,type:deepPartialify(schema.element)});else if(schema instanceof ZodOptional)return ZodOptional.create(deepPartialify(schema.unwrap()));else if(schema instanceof ZodNullable)return ZodNullable.create(deepPartialify(schema.unwrap()));else if(schema instanceof ZodTuple)return ZodTuple.create(schema.items.map((item)=>deepPartialify(item)));else return schema}class ZodObject extends ZodType{constructor(){super(...arguments);this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let shape=this._def.shape(),keys=util.objectKeys(shape);return this._cached={shape,keys},this._cached}_parse(input){if(this._getType(input)!==ZodParsedType.object){let ctx2=this._getOrReturnCtx(input);return addIssueToContext(ctx2,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.object,received:ctx2.parsedType}),INVALID}let{status:status2,ctx}=this._processInputParams(input),{shape,keys:shapeKeys}=this._getCached(),extraKeys=[];if(!(this._def.catchall instanceof ZodNever&&this._def.unknownKeys==="strip")){for(let key in ctx.data)if(!shapeKeys.includes(key))extraKeys.push(key)}let pairs=[];for(let key of shapeKeys){let keyValidator=shape[key],value=ctx.data[key];pairs.push({key:{status:"valid",value:key},value:keyValidator._parse(new ParseInputLazyPath(ctx,value,ctx.path,key)),alwaysSet:key in ctx.data})}if(this._def.catchall instanceof ZodNever){let unknownKeys=this._def.unknownKeys;if(unknownKeys==="passthrough")for(let key of extraKeys)pairs.push({key:{status:"valid",value:key},value:{status:"valid",value:ctx.data[key]}});else if(unknownKeys==="strict"){if(extraKeys.length>0)addIssueToContext(ctx,{code:ZodIssueCode.unrecognized_keys,keys:extraKeys}),status2.dirty()}else if(unknownKeys==="strip");else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let catchall=this._def.catchall;for(let key of extraKeys){let value=ctx.data[key];pairs.push({key:{status:"valid",value:key},value:catchall._parse(new ParseInputLazyPath(ctx,value,ctx.path,key)),alwaysSet:key in ctx.data})}}if(ctx.common.async)return Promise.resolve().then(async()=>{let syncPairs=[];for(let pair of pairs){let key=await pair.key,value=await pair.value;syncPairs.push({key,value,alwaysSet:pair.alwaysSet})}return syncPairs}).then((syncPairs)=>{return ParseStatus.mergeObjectSync(status2,syncPairs)});else return ParseStatus.mergeObjectSync(status2,pairs)}get shape(){return this._def.shape()}strict(message){return errorUtil.errToObj,new ZodObject({...this._def,unknownKeys:"strict",...message!==void 0?{errorMap:(issue,ctx)=>{let defaultError=this._def.errorMap?.(issue,ctx).message??ctx.defaultError;if(issue.code==="unrecognized_keys")return{message:errorUtil.errToObj(message).message??defaultError};return{message:defaultError}}}:{}})}strip(){return new ZodObject({...this._def,unknownKeys:"strip"})}passthrough(){return new ZodObject({...this._def,unknownKeys:"passthrough"})}extend(augmentation){return new ZodObject({...this._def,shape:()=>({...this._def.shape(),...augmentation})})}merge(merging){return new ZodObject({unknownKeys:merging._def.unknownKeys,catchall:merging._def.catchall,shape:()=>({...this._def.shape(),...merging._def.shape()}),typeName:ZodFirstPartyTypeKind.ZodObject})}setKey(key,schema){return this.augment({[key]:schema})}catchall(index){return new ZodObject({...this._def,catchall:index})}pick(mask){let shape={};for(let key of util.objectKeys(mask))if(mask[key]&&this.shape[key])shape[key]=this.shape[key];return new ZodObject({...this._def,shape:()=>shape})}omit(mask){let shape={};for(let key of util.objectKeys(this.shape))if(!mask[key])shape[key]=this.shape[key];return new ZodObject({...this._def,shape:()=>shape})}deepPartial(){return deepPartialify(this)}partial(mask){let newShape={};for(let key of util.objectKeys(this.shape)){let fieldSchema=this.shape[key];if(mask&&!mask[key])newShape[key]=fieldSchema;else newShape[key]=fieldSchema.optional()}return new ZodObject({...this._def,shape:()=>newShape})}required(mask){let newShape={};for(let key of util.objectKeys(this.shape))if(mask&&!mask[key])newShape[key]=this.shape[key];else{let newField=this.shape[key];while(newField instanceof ZodOptional)newField=newField._def.innerType;newShape[key]=newField}return new ZodObject({...this._def,shape:()=>newShape})}keyof(){return createZodEnum(util.objectKeys(this.shape))}}ZodObject.create=(shape,params)=>{return new ZodObject({shape:()=>shape,unknownKeys:"strip",catchall:ZodNever.create(),typeName:ZodFirstPartyTypeKind.ZodObject,...processCreateParams(params)})};ZodObject.strictCreate=(shape,params)=>{return new ZodObject({shape:()=>shape,unknownKeys:"strict",catchall:ZodNever.create(),typeName:ZodFirstPartyTypeKind.ZodObject,...processCreateParams(params)})};ZodObject.lazycreate=(shape,params)=>{return new ZodObject({shape,unknownKeys:"strip",catchall:ZodNever.create(),typeName:ZodFirstPartyTypeKind.ZodObject,...processCreateParams(params)})};class ZodUnion extends ZodType{_parse(input){let{ctx}=this._processInputParams(input),options=this._def.options;function handleResults(results){for(let result of results)if(result.result.status==="valid")return result.result;for(let result of results)if(result.result.status==="dirty")return ctx.common.issues.push(...result.ctx.common.issues),result.result;let unionErrors=results.map((result)=>new ZodError(result.ctx.common.issues));return addIssueToContext(ctx,{code:ZodIssueCode.invalid_union,unionErrors}),INVALID}if(ctx.common.async)return Promise.all(options.map(async(option)=>{let childCtx={...ctx,common:{...ctx.common,issues:[]},parent:null};return{result:await option._parseAsync({data:ctx.data,path:ctx.path,parent:childCtx}),ctx:childCtx}})).then(handleResults);else{let dirty=void 0,issues=[];for(let option of options){let childCtx={...ctx,common:{...ctx.common,issues:[]},parent:null},result=option._parseSync({data:ctx.data,path:ctx.path,parent:childCtx});if(result.status==="valid")return result;else if(result.status==="dirty"&&!dirty)dirty={result,ctx:childCtx};if(childCtx.common.issues.length)issues.push(childCtx.common.issues)}if(dirty)return ctx.common.issues.push(...dirty.ctx.common.issues),dirty.result;let unionErrors=issues.map((issues2)=>new ZodError(issues2));return addIssueToContext(ctx,{code:ZodIssueCode.invalid_union,unionErrors}),INVALID}}get options(){return this._def.options}}ZodUnion.create=(types,params)=>{return new ZodUnion({options:types,typeName:ZodFirstPartyTypeKind.ZodUnion,...processCreateParams(params)})};var getDiscriminator=(type)=>{if(type instanceof ZodLazy)return getDiscriminator(type.schema);else if(type instanceof ZodEffects)return getDiscriminator(type.innerType());else if(type instanceof ZodLiteral)return[type.value];else if(type instanceof ZodEnum)return type.options;else if(type instanceof ZodNativeEnum)return util.objectValues(type.enum);else if(type instanceof ZodDefault)return getDiscriminator(type._def.innerType);else if(type instanceof ZodUndefined)return[void 0];else if(type instanceof ZodNull)return[null];else if(type instanceof ZodOptional)return[void 0,...getDiscriminator(type.unwrap())];else if(type instanceof ZodNullable)return[null,...getDiscriminator(type.unwrap())];else if(type instanceof ZodBranded)return getDiscriminator(type.unwrap());else if(type instanceof ZodReadonly)return getDiscriminator(type.unwrap());else if(type instanceof ZodCatch)return getDiscriminator(type._def.innerType);else return[]};class ZodDiscriminatedUnion extends ZodType{_parse(input){let{ctx}=this._processInputParams(input);if(ctx.parsedType!==ZodParsedType.object)return addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.object,received:ctx.parsedType}),INVALID;let discriminator=this.discriminator,discriminatorValue=ctx.data[discriminator],option=this.optionsMap.get(discriminatorValue);if(!option)return addIssueToContext(ctx,{code:ZodIssueCode.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[discriminator]}),INVALID;if(ctx.common.async)return option._parseAsync({data:ctx.data,path:ctx.path,parent:ctx});else return option._parseSync({data:ctx.data,path:ctx.path,parent:ctx})}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(discriminator,options,params){let optionsMap=new Map;for(let type of options){let discriminatorValues=getDiscriminator(type.shape[discriminator]);if(!discriminatorValues.length)throw Error(`A discriminator value for key \`${discriminator}\` could not be extracted from all schema options`);for(let value of discriminatorValues){if(optionsMap.has(value))throw Error(`Discriminator property ${String(discriminator)} has duplicate value ${String(value)}`);optionsMap.set(value,type)}}return new ZodDiscriminatedUnion({typeName:ZodFirstPartyTypeKind.ZodDiscriminatedUnion,discriminator,options,optionsMap,...processCreateParams(params)})}}function mergeValues(a12,b){let aType=getParsedType(a12),bType=getParsedType(b);if(a12===b)return{valid:!0,data:a12};else if(aType===ZodParsedType.object&&bType===ZodParsedType.object){let bKeys=util.objectKeys(b),sharedKeys=util.objectKeys(a12).filter((key)=>bKeys.indexOf(key)!==-1),newObj={...a12,...b};for(let key of sharedKeys){let sharedValue=mergeValues(a12[key],b[key]);if(!sharedValue.valid)return{valid:!1};newObj[key]=sharedValue.data}return{valid:!0,data:newObj}}else if(aType===ZodParsedType.array&&bType===ZodParsedType.array){if(a12.length!==b.length)return{valid:!1};let newArray=[];for(let index=0;index<a12.length;index++){let itemA=a12[index],itemB=b[index],sharedValue=mergeValues(itemA,itemB);if(!sharedValue.valid)return{valid:!1};newArray.push(sharedValue.data)}return{valid:!0,data:newArray}}else if(aType===ZodParsedType.date&&bType===ZodParsedType.date&&+a12===+b)return{valid:!0,data:a12};else return{valid:!1}}class ZodIntersection extends ZodType{_parse(input){let{status:status2,ctx}=this._processInputParams(input),handleParsed=(parsedLeft,parsedRight)=>{if(isAborted(parsedLeft)||isAborted(parsedRight))return INVALID;let merged=mergeValues(parsedLeft.value,parsedRight.value);if(!merged.valid)return addIssueToContext(ctx,{code:ZodIssueCode.invalid_intersection_types}),INVALID;if(isDirty(parsedLeft)||isDirty(parsedRight))status2.dirty();return{status:status2.value,value:merged.data}};if(ctx.common.async)return Promise.all([this._def.left._parseAsync({data:ctx.data,path:ctx.path,parent:ctx}),this._def.right._parseAsync({data:ctx.data,path:ctx.path,parent:ctx})]).then(([left,right])=>handleParsed(left,right));else return handleParsed(this._def.left._parseSync({data:ctx.data,path:ctx.path,parent:ctx}),this._def.right._parseSync({data:ctx.data,path:ctx.path,parent:ctx}))}}ZodIntersection.create=(left,right,params)=>{return new ZodIntersection({left,right,typeName:ZodFirstPartyTypeKind.ZodIntersection,...processCreateParams(params)})};class ZodTuple extends ZodType{_parse(input){let{status:status2,ctx}=this._processInputParams(input);if(ctx.parsedType!==ZodParsedType.array)return addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.array,received:ctx.parsedType}),INVALID;if(ctx.data.length<this._def.items.length)return addIssueToContext(ctx,{code:ZodIssueCode.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),INVALID;if(!this._def.rest&&ctx.data.length>this._def.items.length)addIssueToContext(ctx,{code:ZodIssueCode.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),status2.dirty();let items=[...ctx.data].map((item,itemIndex)=>{let schema=this._def.items[itemIndex]||this._def.rest;if(!schema)return null;return schema._parse(new ParseInputLazyPath(ctx,item,ctx.path,itemIndex))}).filter((x)=>!!x);if(ctx.common.async)return Promise.all(items).then((results)=>{return ParseStatus.mergeArray(status2,results)});else return ParseStatus.mergeArray(status2,items)}get items(){return this._def.items}rest(rest){return new ZodTuple({...this._def,rest})}}ZodTuple.create=(schemas,params)=>{if(!Array.isArray(schemas))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new ZodTuple({items:schemas,typeName:ZodFirstPartyTypeKind.ZodTuple,rest:null,...processCreateParams(params)})};class ZodRecord extends ZodType{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(input){let{status:status2,ctx}=this._processInputParams(input);if(ctx.parsedType!==ZodParsedType.object)return addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.object,received:ctx.parsedType}),INVALID;let pairs=[],keyType=this._def.keyType,valueType=this._def.valueType;for(let key in ctx.data)pairs.push({key:keyType._parse(new ParseInputLazyPath(ctx,key,ctx.path,key)),value:valueType._parse(new ParseInputLazyPath(ctx,ctx.data[key],ctx.path,key)),alwaysSet:key in ctx.data});if(ctx.common.async)return ParseStatus.mergeObjectAsync(status2,pairs);else return ParseStatus.mergeObjectSync(status2,pairs)}get element(){return this._def.valueType}static create(first,second,third){if(second instanceof ZodType)return new ZodRecord({keyType:first,valueType:second,typeName:ZodFirstPartyTypeKind.ZodRecord,...processCreateParams(third)});return new ZodRecord({keyType:ZodString.create(),valueType:first,typeName:ZodFirstPartyTypeKind.ZodRecord,...processCreateParams(second)})}}class ZodMap extends ZodType{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(input){let{status:status2,ctx}=this._processInputParams(input);if(ctx.parsedType!==ZodParsedType.map)return addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.map,received:ctx.parsedType}),INVALID;let keyType=this._def.keyType,valueType=this._def.valueType,pairs=[...ctx.data.entries()].map(([key,value],index)=>{return{key:keyType._parse(new ParseInputLazyPath(ctx,key,ctx.path,[index,"key"])),value:valueType._parse(new ParseInputLazyPath(ctx,value,ctx.path,[index,"value"]))}});if(ctx.common.async){let finalMap=new Map;return Promise.resolve().then(async()=>{for(let pair of pairs){let key=await pair.key,value=await pair.value;if(key.status==="aborted"||value.status==="aborted")return INVALID;if(key.status==="dirty"||value.status==="dirty")status2.dirty();finalMap.set(key.value,value.value)}return{status:status2.value,value:finalMap}})}else{let finalMap=new Map;for(let pair of pairs){let{key,value}=pair;if(key.status==="aborted"||value.status==="aborted")return INVALID;if(key.status==="dirty"||value.status==="dirty")status2.dirty();finalMap.set(key.value,value.value)}return{status:status2.value,value:finalMap}}}}ZodMap.create=(keyType,valueType,params)=>{return new ZodMap({valueType,keyType,typeName:ZodFirstPartyTypeKind.ZodMap,...processCreateParams(params)})};class ZodSet extends ZodType{_parse(input){let{status:status2,ctx}=this._processInputParams(input);if(ctx.parsedType!==ZodParsedType.set)return addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.set,received:ctx.parsedType}),INVALID;let def=this._def;if(def.minSize!==null){if(ctx.data.size<def.minSize.value)addIssueToContext(ctx,{code:ZodIssueCode.too_small,minimum:def.minSize.value,type:"set",inclusive:!0,exact:!1,message:def.minSize.message}),status2.dirty()}if(def.maxSize!==null){if(ctx.data.size>def.maxSize.value)addIssueToContext(ctx,{code:ZodIssueCode.too_big,maximum:def.maxSize.value,type:"set",inclusive:!0,exact:!1,message:def.maxSize.message}),status2.dirty()}let valueType=this._def.valueType;function finalizeSet(elements2){let parsedSet=new Set;for(let element of elements2){if(element.status==="aborted")return INVALID;if(element.status==="dirty")status2.dirty();parsedSet.add(element.value)}return{status:status2.value,value:parsedSet}}let elements=[...ctx.data.values()].map((item,i)=>valueType._parse(new ParseInputLazyPath(ctx,item,ctx.path,i)));if(ctx.common.async)return Promise.all(elements).then((elements2)=>finalizeSet(elements2));else return finalizeSet(elements)}min(minSize,message){return new ZodSet({...this._def,minSize:{value:minSize,message:errorUtil.toString(message)}})}max(maxSize,message){return new ZodSet({...this._def,maxSize:{value:maxSize,message:errorUtil.toString(message)}})}size(size,message){return this.min(size,message).max(size,message)}nonempty(message){return this.min(1,message)}}ZodSet.create=(valueType,params)=>{return new ZodSet({valueType,minSize:null,maxSize:null,typeName:ZodFirstPartyTypeKind.ZodSet,...processCreateParams(params)})};class ZodFunction extends ZodType{constructor(){super(...arguments);this.validate=this.implement}_parse(input){let{ctx}=this._processInputParams(input);if(ctx.parsedType!==ZodParsedType.function)return addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.function,received:ctx.parsedType}),INVALID;function makeArgsIssue(args,error){return makeIssue({data:args,path:ctx.path,errorMaps:[ctx.common.contextualErrorMap,ctx.schemaErrorMap,getErrorMap(),en_default].filter((x)=>!!x),issueData:{code:ZodIssueCode.invalid_arguments,argumentsError:error}})}function makeReturnsIssue(returns,error){return makeIssue({data:returns,path:ctx.path,errorMaps:[ctx.common.contextualErrorMap,ctx.schemaErrorMap,getErrorMap(),en_default].filter((x)=>!!x),issueData:{code:ZodIssueCode.invalid_return_type,returnTypeError:error}})}let params={errorMap:ctx.common.contextualErrorMap},fn=ctx.data;if(this._def.returns instanceof ZodPromise){let me=this;return OK(async function(...args){let error=new ZodError([]),parsedArgs=await me._def.args.parseAsync(args,params).catch((e)=>{throw error.addIssue(makeArgsIssue(args,e)),error}),result=await Reflect.apply(fn,this,parsedArgs);return await me._def.returns._def.type.parseAsync(result,params).catch((e)=>{throw error.addIssue(makeReturnsIssue(result,e)),error})})}else{let me=this;return OK(function(...args){let parsedArgs=me._def.args.safeParse(args,params);if(!parsedArgs.success)throw new ZodError([makeArgsIssue(args,parsedArgs.error)]);let result=Reflect.apply(fn,this,parsedArgs.data),parsedReturns=me._def.returns.safeParse(result,params);if(!parsedReturns.success)throw new ZodError([makeReturnsIssue(result,parsedReturns.error)]);return parsedReturns.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...items){return new ZodFunction({...this._def,args:ZodTuple.create(items).rest(ZodUnknown.create())})}returns(returnType){return new ZodFunction({...this._def,returns:returnType})}implement(func){return this.parse(func)}strictImplement(func){return this.parse(func)}static create(args,returns,params){return new ZodFunction({args:args?args:ZodTuple.create([]).rest(ZodUnknown.create()),returns:returns||ZodUnknown.create(),typeName:ZodFirstPartyTypeKind.ZodFunction,...processCreateParams(params)})}}class ZodLazy extends ZodType{get schema(){return this._def.getter()}_parse(input){let{ctx}=this._processInputParams(input);return this._def.getter()._parse({data:ctx.data,path:ctx.path,parent:ctx})}}ZodLazy.create=(getter,params)=>{return new ZodLazy({getter,typeName:ZodFirstPartyTypeKind.ZodLazy,...processCreateParams(params)})};class ZodLiteral extends ZodType{_parse(input){if(input.data!==this._def.value){let ctx=this._getOrReturnCtx(input);return addIssueToContext(ctx,{received:ctx.data,code:ZodIssueCode.invalid_literal,expected:this._def.value}),INVALID}return{status:"valid",value:input.data}}get value(){return this._def.value}}ZodLiteral.create=(value,params)=>{return new ZodLiteral({value,typeName:ZodFirstPartyTypeKind.ZodLiteral,...processCreateParams(params)})};function createZodEnum(values,params){return new ZodEnum({values,typeName:ZodFirstPartyTypeKind.ZodEnum,...processCreateParams(params)})}class ZodEnum extends ZodType{_parse(input){if(typeof input.data!=="string"){let ctx=this._getOrReturnCtx(input),expectedValues=this._def.values;return addIssueToContext(ctx,{expected:util.joinValues(expectedValues),received:ctx.parsedType,code:ZodIssueCode.invalid_type}),INVALID}if(!this._cache)this._cache=new Set(this._def.values);if(!this._cache.has(input.data)){let ctx=this._getOrReturnCtx(input),expectedValues=this._def.values;return addIssueToContext(ctx,{received:ctx.data,code:ZodIssueCode.invalid_enum_value,options:expectedValues}),INVALID}return OK(input.data)}get options(){return this._def.values}get enum(){let enumValues={};for(let val of this._def.values)enumValues[val]=val;return enumValues}get Values(){let enumValues={};for(let val of this._def.values)enumValues[val]=val;return enumValues}get Enum(){let enumValues={};for(let val of this._def.values)enumValues[val]=val;return enumValues}extract(values,newDef=this._def){return ZodEnum.create(values,{...this._def,...newDef})}exclude(values,newDef=this._def){return ZodEnum.create(this.options.filter((opt)=>!values.includes(opt)),{...this._def,...newDef})}}ZodEnum.create=createZodEnum;class ZodNativeEnum extends ZodType{_parse(input){let nativeEnumValues=util.getValidEnumValues(this._def.values),ctx=this._getOrReturnCtx(input);if(ctx.parsedType!==ZodParsedType.string&&ctx.parsedType!==ZodParsedType.number){let expectedValues=util.objectValues(nativeEnumValues);return addIssueToContext(ctx,{expected:util.joinValues(expectedValues),received:ctx.parsedType,code:ZodIssueCode.invalid_type}),INVALID}if(!this._cache)this._cache=new Set(util.getValidEnumValues(this._def.values));if(!this._cache.has(input.data)){let expectedValues=util.objectValues(nativeEnumValues);return addIssueToContext(ctx,{received:ctx.data,code:ZodIssueCode.invalid_enum_value,options:expectedValues}),INVALID}return OK(input.data)}get enum(){return this._def.values}}ZodNativeEnum.create=(values,params)=>{return new ZodNativeEnum({values,typeName:ZodFirstPartyTypeKind.ZodNativeEnum,...processCreateParams(params)})};class ZodPromise extends ZodType{unwrap(){return this._def.type}_parse(input){let{ctx}=this._processInputParams(input);if(ctx.parsedType!==ZodParsedType.promise&&ctx.common.async===!1)return addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.promise,received:ctx.parsedType}),INVALID;let promisified=ctx.parsedType===ZodParsedType.promise?ctx.data:Promise.resolve(ctx.data);return OK(promisified.then((data)=>{return this._def.type.parseAsync(data,{path:ctx.path,errorMap:ctx.common.contextualErrorMap})}))}}ZodPromise.create=(schema,params)=>{return new ZodPromise({type:schema,typeName:ZodFirstPartyTypeKind.ZodPromise,...processCreateParams(params)})};class ZodEffects extends ZodType{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===ZodFirstPartyTypeKind.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(input){let{status:status2,ctx}=this._processInputParams(input),effect=this._def.effect||null,checkCtx={addIssue:(arg)=>{if(addIssueToContext(ctx,arg),arg.fatal)status2.abort();else status2.dirty()},get path(){return ctx.path}};if(checkCtx.addIssue=checkCtx.addIssue.bind(checkCtx),effect.type==="preprocess"){let processed=effect.transform(ctx.data,checkCtx);if(ctx.common.async)return Promise.resolve(processed).then(async(processed2)=>{if(status2.value==="aborted")return INVALID;let result=await this._def.schema._parseAsync({data:processed2,path:ctx.path,parent:ctx});if(result.status==="aborted")return INVALID;if(result.status==="dirty")return DIRTY(result.value);if(status2.value==="dirty")return DIRTY(result.value);return result});else{if(status2.value==="aborted")return INVALID;let result=this._def.schema._parseSync({data:processed,path:ctx.path,parent:ctx});if(result.status==="aborted")return INVALID;if(result.status==="dirty")return DIRTY(result.value);if(status2.value==="dirty")return DIRTY(result.value);return result}}if(effect.type==="refinement"){let executeRefinement=(acc)=>{let result=effect.refinement(acc,checkCtx);if(ctx.common.async)return Promise.resolve(result);if(result instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return acc};if(ctx.common.async===!1){let inner=this._def.schema._parseSync({data:ctx.data,path:ctx.path,parent:ctx});if(inner.status==="aborted")return INVALID;if(inner.status==="dirty")status2.dirty();return executeRefinement(inner.value),{status:status2.value,value:inner.value}}else return this._def.schema._parseAsync({data:ctx.data,path:ctx.path,parent:ctx}).then((inner)=>{if(inner.status==="aborted")return INVALID;if(inner.status==="dirty")status2.dirty();return executeRefinement(inner.value).then(()=>{return{status:status2.value,value:inner.value}})})}if(effect.type==="transform")if(ctx.common.async===!1){let base=this._def.schema._parseSync({data:ctx.data,path:ctx.path,parent:ctx});if(!isValid(base))return INVALID;let result=effect.transform(base.value,checkCtx);if(result instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:status2.value,value:result}}else return this._def.schema._parseAsync({data:ctx.data,path:ctx.path,parent:ctx}).then((base)=>{if(!isValid(base))return INVALID;return Promise.resolve(effect.transform(base.value,checkCtx)).then((result)=>({status:status2.value,value:result}))});util.assertNever(effect)}}ZodEffects.create=(schema,effect,params)=>{return new ZodEffects({schema,typeName:ZodFirstPartyTypeKind.ZodEffects,effect,...processCreateParams(params)})};ZodEffects.createWithPreprocess=(preprocess,schema,params)=>{return new ZodEffects({schema,effect:{type:"preprocess",transform:preprocess},typeName:ZodFirstPartyTypeKind.ZodEffects,...processCreateParams(params)})};class ZodOptional extends ZodType{_parse(input){if(this._getType(input)===ZodParsedType.undefined)return OK(void 0);return this._def.innerType._parse(input)}unwrap(){return this._def.innerType}}ZodOptional.create=(type,params)=>{return new ZodOptional({innerType:type,typeName:ZodFirstPartyTypeKind.ZodOptional,...processCreateParams(params)})};class ZodNullable extends ZodType{_parse(input){if(this._getType(input)===ZodParsedType.null)return OK(null);return this._def.innerType._parse(input)}unwrap(){return this._def.innerType}}ZodNullable.create=(type,params)=>{return new ZodNullable({innerType:type,typeName:ZodFirstPartyTypeKind.ZodNullable,...processCreateParams(params)})};class ZodDefault extends ZodType{_parse(input){let{ctx}=this._processInputParams(input),data=ctx.data;if(ctx.parsedType===ZodParsedType.undefined)data=this._def.defaultValue();return this._def.innerType._parse({data,path:ctx.path,parent:ctx})}removeDefault(){return this._def.innerType}}ZodDefault.create=(type,params)=>{return new ZodDefault({innerType:type,typeName:ZodFirstPartyTypeKind.ZodDefault,defaultValue:typeof params.default==="function"?params.default:()=>params.default,...processCreateParams(params)})};class ZodCatch extends ZodType{_parse(input){let{ctx}=this._processInputParams(input),newCtx={...ctx,common:{...ctx.common,issues:[]}},result=this._def.innerType._parse({data:newCtx.data,path:newCtx.path,parent:{...newCtx}});if(isAsync2(result))return result.then((result2)=>{return{status:"valid",value:result2.status==="valid"?result2.value:this._def.catchValue({get error(){return new ZodError(newCtx.common.issues)},input:newCtx.data})}});else return{status:"valid",value:result.status==="valid"?result.value:this._def.catchValue({get error(){return new ZodError(newCtx.common.issues)},input:newCtx.data})}}removeCatch(){return this._def.innerType}}ZodCatch.create=(type,params)=>{return new ZodCatch({innerType:type,typeName:ZodFirstPartyTypeKind.ZodCatch,catchValue:typeof params.catch==="function"?params.catch:()=>params.catch,...processCreateParams(params)})};class ZodNaN extends ZodType{_parse(input){if(this._getType(input)!==ZodParsedType.nan){let ctx=this._getOrReturnCtx(input);return addIssueToContext(ctx,{code:ZodIssueCode.invalid_type,expected:ZodParsedType.nan,received:ctx.parsedType}),INVALID}return{status:"valid",value:input.data}}}ZodNaN.create=(params)=>{return new ZodNaN({typeName:ZodFirstPartyTypeKind.ZodNaN,...processCreateParams(params)})};var BRAND=Symbol("zod_brand");class ZodBranded extends ZodType{_parse(input){let{ctx}=this._processInputParams(input),data=ctx.data;return this._def.type._parse({data,path:ctx.path,parent:ctx})}unwrap(){return this._def.type}}class ZodPipeline extends ZodType{_parse(input){let{status:status2,ctx}=this._processInputParams(input);if(ctx.common.async)return(async()=>{let inResult=await this._def.in._parseAsync({data:ctx.data,path:ctx.path,parent:ctx});if(inResult.status==="aborted")return INVALID;if(inResult.status==="dirty")return status2.dirty(),DIRTY(inResult.value);else return this._def.out._parseAsync({data:inResult.value,path:ctx.path,parent:ctx})})();else{let inResult=this._def.in._parseSync({data:ctx.data,path:ctx.path,parent:ctx});if(inResult.status==="aborted")return INVALID;if(inResult.status==="dirty")return status2.dirty(),{status:"dirty",value:inResult.value};else return this._def.out._parseSync({data:inResult.value,path:ctx.path,parent:ctx})}}static create(a12,b){return new ZodPipeline({in:a12,out:b,typeName:ZodFirstPartyTypeKind.ZodPipeline})}}class ZodReadonly extends ZodType{_parse(input){let result=this._def.innerType._parse(input),freeze=(data)=>{if(isValid(data))data.value=Object.freeze(data.value);return data};return isAsync2(result)?result.then((data)=>freeze(data)):freeze(result)}unwrap(){return this._def.innerType}}ZodReadonly.create=(type,params)=>{return new ZodReadonly({innerType:type,typeName:ZodFirstPartyTypeKind.ZodReadonly,...processCreateParams(params)})};function cleanParams(params,data){let p=typeof params==="function"?params(data):typeof params==="string"?{message:params}:params;return typeof p==="string"?{message:p}:p}function custom(check2,_params={},fatal){if(check2)return ZodAny.create().superRefine((data,ctx)=>{let r2=check2(data);if(r2 instanceof Promise)return r2.then((r3)=>{if(!r3){let params=cleanParams(_params,data),_fatal=params.fatal??fatal??!0;ctx.addIssue({code:"custom",...params,fatal:_fatal})}});if(!r2){let params=cleanParams(_params,data),_fatal=params.fatal??fatal??!0;ctx.addIssue({code:"custom",...params,fatal:_fatal})}return});return ZodAny.create()}var late={object:ZodObject.lazycreate},ZodFirstPartyTypeKind;(function(ZodFirstPartyTypeKind2){ZodFirstPartyTypeKind2.ZodString="ZodString",ZodFirstPartyTypeKind2.ZodNumber="ZodNumber",ZodFirstPartyTypeKind2.ZodNaN="ZodNaN",ZodFirstPartyTypeKind2.ZodBigInt="ZodBigInt",ZodFirstPartyTypeKind2.ZodBoolean="ZodBoolean",ZodFirstPartyTypeKind2.ZodDate="ZodDate",ZodFirstPartyTypeKind2.ZodSymbol="ZodSymbol",ZodFirstPartyTypeKind2.ZodUndefined="ZodUndefined",ZodFirstPartyTypeKind2.ZodNull="ZodNull",ZodFirstPartyTypeKind2.ZodAny="ZodAny",ZodFirstPartyTypeKind2.ZodUnknown="ZodUnknown",ZodFirstPartyTypeKind2.ZodNever="ZodNever",ZodFirstPartyTypeKind2.ZodVoid="ZodVoid",ZodFirstPartyTypeKind2.ZodArray="ZodArray",ZodFirstPartyTypeKind2.ZodObject="ZodObject",ZodFirstPartyTypeKind2.ZodUnion="ZodUnion",ZodFirstPartyTypeKind2.ZodDiscriminatedUnion="ZodDiscriminatedUnion",ZodFirstPartyTypeKind2.ZodIntersection="ZodIntersection",ZodFirstPartyTypeKind2.ZodTuple="ZodTuple",ZodFirstPartyTypeKind2.ZodRecord="ZodRecord",ZodFirstPartyTypeKind2.ZodMap="ZodMap",ZodFirstPartyTypeKind2.ZodSet="ZodSet",ZodFirstPartyTypeKind2.ZodFunction="ZodFunction",ZodFirstPartyTypeKind2.ZodLazy="ZodLazy",ZodFirstPartyTypeKind2.ZodLiteral="ZodLiteral",ZodFirstPartyTypeKind2.ZodEnum="ZodEnum",ZodFirstPartyTypeKind2.ZodEffects="ZodEffects",ZodFirstPartyTypeKind2.ZodNativeEnum="ZodNativeEnum",ZodFirstPartyTypeKind2.ZodOptional="ZodOptional",ZodFirstPartyTypeKind2.ZodNullable="ZodNullable",ZodFirstPartyTypeKind2.ZodDefault="ZodDefault",ZodFirstPartyTypeKind2.ZodCatch="ZodCatch",ZodFirstPartyTypeKind2.ZodPromise="ZodPromise",ZodFirstPartyTypeKind2.ZodBranded="ZodBranded",ZodFirstPartyTypeKind2.ZodPipeline="ZodPipeline",ZodFirstPartyTypeKind2.ZodReadonly="ZodReadonly"})(ZodFirstPartyTypeKind||(ZodFirstPartyTypeKind={}));var instanceOfType=(cls,params={message:`Input not instance of ${cls.name}`})=>custom((data)=>data instanceof cls,params),stringType=ZodString.create,numberType=ZodNumber.create,nanType=ZodNaN.create,bigIntType=ZodBigInt.create,booleanType=ZodBoolean.create,dateType=ZodDate.create,symbolType=ZodSymbol.create,undefinedType=ZodUndefined.create,nullType=ZodNull.create,anyType=ZodAny.create,unknownType=ZodUnknown.create,neverType=ZodNever.create,voidType=ZodVoid.create,arrayType=ZodArray.create,objectType=ZodObject.create,strictObjectType=ZodObject.strictCreate,unionType=ZodUnion.create,discriminatedUnionType=ZodDiscriminatedUnion.create,intersectionType=ZodIntersection.create,tupleType=ZodTuple.create,recordType=ZodRecord.create,mapType=ZodMap.create,setType=ZodSet.create,functionType=ZodFunction.create,lazyType=ZodLazy.create,literalType=ZodLiteral.create,enumType=ZodEnum.create,nativeEnumType=ZodNativeEnum.create,promiseType=ZodPromise.create,effectsType=ZodEffects.create,optionalType=ZodOptional.create,nullableType=ZodNullable.create,preprocessType=ZodEffects.createWithPreprocess,pipelineType=ZodPipeline.create,ostring=()=>stringType().optional(),onumber=()=>numberType().optional(),oboolean=()=>booleanType().optional(),coerce={string:(arg)=>ZodString.create({...arg,coerce:!0}),number:(arg)=>ZodNumber.create({...arg,coerce:!0}),boolean:(arg)=>ZodBoolean.create({...arg,coerce:!0}),bigint:(arg)=>ZodBigInt.create({...arg,coerce:!0}),date:(arg)=>ZodDate.create({...arg,coerce:!0})};var NEVER=INVALID;var OpenApiExtensionSchema=exports_external.object({name:exports_external.string().regex(/^x-/),component:exports_external.unknown()}),ApiReferencePluginSchema=exports_external.function().returns(exports_external.object({name:exports_external.string(),extensions:exports_external.array(OpenApiExtensionSchema)}));var PREFIX_MIGRATIONS=[["--theme-","--scalar-"],["--sidebar-","--scalar-sidebar-"]],LEGACY_PREFIXES=PREFIX_MIGRATIONS.map(([legacy])=>legacy);function migrateThemeVariables(styles){if(!LEGACY_PREFIXES.some((p)=>styles.includes(p)))return styles;return console.warn("DEPRECATION WARNING: It looks like you're using legacy CSS variables in your custom CSS string. Please migrate them to use the updated prefixes. See https://github.com/scalar/scalar/blob/main/documentation/themes.md#theme-prefix-changes"),PREFIX_MIGRATIONS.reduce((s,[o,n])=>s.replaceAll(o,n),styles)}var themeIdEnum=exports_external.enum(["alternate","default","moon","purple","solarized","bluePlanet","deepSpace","saturn","kepler","elysiajs","fastify","mars","none"]),searchHotKeyEnum=exports_external.enum(["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"]),integrationEnum=exports_external.enum(["adonisjs","docusaurus","dotnet","elysiajs","express","fastapi","fastify","go","hono","html","laravel","litestar","nestjs","nextjs","nitro","nuxt","platformatic","react","rust","vue"]).nullable(),specConfigurationSchema=exports_external.object({url:exports_external.string().optional(),content:exports_external.union([exports_external.string(),exports_external.record(exports_external.any()),exports_external.function().returns(exports_external.record(exports_external.any())),exports_external.null()]).optional(),title:exports_external.string().optional(),slug:exports_external.string().optional()}),pathRoutingSchema=exports_external.object({basePath:exports_external.string()}),apiClientConfigurationSchema=exports_external.object({url:exports_external.string().optional(),content:exports_external.union([exports_external.string(),exports_external.record(exports_external.any()),exports_external.function().returns(exports_external.record(exports_external.any())),exports_external.null()]).optional(),title:exports_external.string().optional(),slug:exports_external.string().optional(),spec:specConfigurationSchema.optional(),authentication:exports_external.any().optional(),baseServerURL:exports_external.string().optional(),hideClientButton:exports_external.boolean().optional().default(!1).catch(!1),proxyUrl:exports_external.string().optional(),searchHotKey:searchHotKeyEnum.optional(),servers:exports_external.array(exports_external.any()).optional(),showSidebar:exports_external.boolean().optional().default(!0).catch(!0),theme:themeIdEnum.optional().default("default").catch("default"),_integration:integrationEnum.optional(),onRequestSent:exports_external.function().args(exports_external.string()).returns(exports_external.void()).optional()}),OLD_PROXY_URL="https://api.scalar.com/request-proxy",NEW_PROXY_URL="https://proxy.scalar.com",_apiReferenceConfigurationSchema=apiClientConfigurationSchema.merge(exports_external.object({layout:exports_external.enum(["modern","classic"]).optional().default("modern").catch("modern"),proxy:exports_external.string().optional(),plugins:exports_external.array(ApiReferencePluginSchema).optional(),isEditable:exports_external.boolean().optional().default(!1).catch(!1),isLoading:exports_external.boolean().optional().default(!1).catch(!1),hideModels:exports_external.boolean().optional().default(!1).catch(!1),hideDownloadButton:exports_external.boolean().optional().default(!1).catch(!1),hideTestRequestButton:exports_external.boolean().optional().default(!1).catch(!1),hideSearch:exports_external.boolean().optional().default(!1).catch(!1),darkMode:exports_external.boolean().optional(),forceDarkModeState:exports_external.enum(["dark","light"]).optional(),hideDarkModeToggle:exports_external.boolean().optional().default(!1).catch(!1),metaData:exports_external.any().optional(),favicon:exports_external.string().optional(),hiddenClients:exports_external.union([exports_external.record(exports_external.union([exports_external.boolean(),exports_external.array(exports_external.string())])),exports_external.array(exports_external.string()),exports_external.literal(!0)]).optional(),defaultHttpClient:exports_external.object({targetKey:exports_external.custom(),clientKey:exports_external.string()}).optional(),customCss:exports_external.string().optional(),onSpecUpdate:exports_external.function().args(exports_external.string()).returns(exports_external.void()).optional(),onServerChange:exports_external.function().args(exports_external.string()).returns(exports_external.void()).optional(),onDocumentSelect:exports_external.function().returns(exports_external.void().or(exports_external.void().promise())).optional(),onLoaded:exports_external.function().returns(exports_external.void().or(exports_external.void().promise())).optional(),onShowMore:exports_external.function().args(exports_external.string()).returns(exports_external.void().or(exports_external.void().promise())).optional(),onSidebarClick:exports_external.function().args(exports_external.string()).returns(exports_external.void().or(exports_external.void().promise())).optional(),pathRouting:pathRoutingSchema.optional(),generateHeadingSlug:exports_external.function().args(exports_external.object({slug:exports_external.string().default("headingSlug")})).returns(exports_external.string()).optional(),generateModelSlug:exports_external.function().args(exports_external.object({name:exports_external.string().default("modelName")})).returns(exports_external.string()).optional(),generateTagSlug:exports_external.function().args(exports_external.object({name:exports_external.string().default("tagName")})).returns(exports_external.string()).optional(),generateOperationSlug:exports_external.function().args(exports_external.object({path:exports_external.string(),operationId:exports_external.string().optional(),method:exports_external.string(),summary:exports_external.string().optional()})).returns(exports_external.string()).optional(),generateWebhookSlug:exports_external.function().args(exports_external.object({name:exports_external.string(),method:exports_external.string().optional()})).returns(exports_external.string()).optional(),redirect:exports_external.function().args(exports_external.string()).returns(exports_external.string().nullable().optional()).optional(),withDefaultFonts:exports_external.boolean().optional().default(!0).catch(!0),defaultOpenAllTags:exports_external.boolean().optional(),tagsSorter:exports_external.union([exports_external.literal("alpha"),exports_external.function().args(exports_external.any(),exports_external.any()).returns(exports_external.number())]).optional(),operationsSorter:exports_external.union([exports_external.literal("alpha"),exports_external.literal("method"),exports_external.function().args(exports_external.any(),exports_external.any()).returns(exports_external.number())]).optional()})),migrateConfiguration=(_configuration)=>{let configuration={..._configuration};if(configuration.spec?.url)console.warn("[DEPRECATED] You're using the deprecated 'spec.url' attribute. Remove the spec prefix and move the 'url' attribute to the top level."),configuration.url=configuration.spec.url,delete configuration.spec;if(configuration.spec?.content)console.warn("[DEPRECATED] You're using the deprecated 'spec.content' attribute. Remove the spec prefix and move the 'content' attribute to the top level."),configuration.content=configuration.spec.content,delete configuration.spec;if(configuration.customCss)configuration.customCss=migrateThemeVariables(configuration.customCss);if(configuration.proxy){if(console.warn("[DEPRECATED] You're using the deprecated 'proxy' attribute, rename it to 'proxyUrl' or update the package."),!configuration.proxyUrl)configuration.proxyUrl=configuration.proxy;delete configuration.proxy}if(configuration.proxyUrl===OLD_PROXY_URL)console.warn(`[DEPRECATED] Warning: configuration.proxyUrl points to our old proxy (${OLD_PROXY_URL}).`),console.warn(`[DEPRECATED] We are overwriting the value and use the new proxy URL (${NEW_PROXY_URL}) instead.`),console.warn(`[DEPRECATED] Action Required: You should manually update your configuration to use the new URL (${NEW_PROXY_URL}). Read more: https://github.com/scalar/scalar`),configuration.proxyUrl=NEW_PROXY_URL;return configuration},apiReferenceConfigurationSchema=_apiReferenceConfigurationSchema.transform(migrateConfiguration);var htmlRenderingConfigurationSchema=exports_external.object({cdn:exports_external.string().optional().default("https://cdn.jsdelivr.net/npm/@scalar/api-reference"),pageTitle:exports_external.string().optional().default("Scalar API Reference")});var m={alternate:a,default:r,moon:a8,elysiajs:a4,fastify:a5,purple:a9,solarized:a11,bluePlanet:a2,deepSpace:a3,saturn:a10,kepler:a6,mars:a7};var K=Object.keys(m);function isSchemaObject(schema){return"type"in schema||"properties"in schema||"items"in schema}function isDateTimeProperty(key,schema){return(key==="createdAt"||key==="updatedAt")&&"anyOf"in schema&&Array.isArray(schema.anyOf)}function transformDateProperties(schema){if(!isSchemaObject(schema)||typeof schema!=="object"||schema===null)return schema;let newSchema={...schema};return Object.entries(newSchema).forEach(([key,value])=>{if(isSchemaObject(value))if(isDateTimeProperty(key,value)){let dateTimeFormat=value.anyOf?.find((item)=>isSchemaObject(item)&&item.format==="date-time");if(dateTimeFormat){let dateTimeSchema={type:"string",format:"date-time",default:dateTimeFormat.default};newSchema[key]=dateTimeSchema}}else newSchema[key]=transformDateProperties(value)}),newSchema}var SwaggerUIRender=(info,version,theme,stringifiedSwaggerOptions,autoDarkMode)=>{let swaggerOptions=JSON.parse(stringifiedSwaggerOptions);if(swaggerOptions.components&&swaggerOptions.components.schemas)swaggerOptions.components.schemas=Object.fromEntries(Object.entries(swaggerOptions.components.schemas).map(([key,schema])=>[key,transformDateProperties(schema)]));let transformedStringifiedSwaggerOptions=JSON.stringify(swaggerOptions);return`<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>${info.title}</title>
    <meta
        name="description"
        content="${info.description}"
    />
    <meta
        name="og:description"
        content="${info.description}"
    />
    ${autoDarkMode&&typeof theme==="string"?`
    <style>
        @media (prefers-color-scheme: dark) {
            body {
                background-color: #222;
                color: #faf9a;
            }
            .swagger-ui {
                filter: invert(92%) hue-rotate(180deg);
            }

            .swagger-ui .microlight {
                filter: invert(100%) hue-rotate(180deg);
            }
        }
    </style>`:""}
    ${typeof theme==="string"?`<link rel="stylesheet" href="${theme}" />`:`<link rel="stylesheet" media="(prefers-color-scheme: light)" href="${theme.light}" />
<link rel="stylesheet" media="(prefers-color-scheme: dark)" href="${theme.dark}" />`}
</head>
<body>
    <div id="swagger-ui"></div>
    <script src="https://unpkg.com/swagger-ui-dist@${version}/swagger-ui-bundle.js" crossorigin></script>
    <script>
        window.onload = () => {
            window.ui = SwaggerUIBundle(${transformedStringifiedSwaggerOptions});
        };
    </script>
</body>
</html>`},ScalarRender=(info,version,config,cdn)=>`<!doctype html>
<html>
  <head>
    <title>${info.title}</title>
    <meta
        name="description"
        content="${info.description}"
    />
    <meta
        name="og:description"
        content="${info.description}"
    />
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1" />
    <style>
      body {
        margin: 0;
      }
    </style>
    <style>
      ${config.customCss??a4}
    </style>
  </head>
  <body>
    <script
      id="api-reference"
      data-url="${config.spec?.url}"
      data-configuration='${JSON.stringify(config)}'
    >
    </script>
    <script src="${cdn?cdn:`https://cdn.jsdelivr.net/npm/@scalar/api-reference@${version}/dist/browser/standalone.min.js`}" crossorigin></script>
  </body>
</html>`;var Kind2=Symbol.for("TypeBox.Kind"),toOpenAPIPath=(path)=>path.split("/").map((x)=>{if(x.startsWith(":")){if(x=x.slice(1,x.length),x.endsWith("?"))x=x.slice(0,-1);x=`{${x}}`}return x}).join("/"),mapProperties=(name,schema,models)=>{if(schema===void 0)return[];if(typeof schema==="string")if(schema in models)schema=models[schema];else throw Error(`Can't find model ${schema}`);return Object.entries(schema?.properties??[]).map(([key,value])=>{let{type:valueType=void 0,description,examples,...schemaKeywords}=value;return{description,examples,schema:{type:valueType,...schemaKeywords},in:name,name:key,required:schema.required?.includes(key)??!1}})},mapTypesResponse=(types2,schema)=>{if(typeof schema==="object"&&["void","undefined","null"].includes(schema.type))return;let responses={};for(let type of types2)responses[type]={schema:typeof schema==="string"?{$ref:`#/components/schemas/${schema}`}:("$ref"in schema)&&(Kind2 in schema)&&schema[Kind2]==="Ref"?{...schema,$ref:`#/components/schemas/${schema.$ref}`}:replaceSchemaTypeFromManyOptions({...schema},{from:t.Ref(""),to:({$ref,...options})=>{if(!$ref.startsWith("#/components/schemas/"))return t.Ref(`#/components/schemas/${$ref}`,options);return t.Ref($ref,options)}})};return responses},capitalize=(word)=>word.charAt(0).toUpperCase()+word.slice(1),generateOperationId=(method,paths)=>{let operationId=method.toLowerCase();if(paths==="/")return operationId+"Index";for(let path of paths.split("/"))if(path.charCodeAt(0)===123)operationId+="By"+capitalize(path.slice(1,-1));else operationId+=capitalize(path);return operationId},cloneHook=(hook)=>{if(!hook)return;if(typeof hook==="string")return hook;if(Array.isArray(hook))return[...hook];return{...hook}},registerSchemaPath=({schema,path,method,hook,models})=>{if(hook=cloneHook(hook),hook.parse&&!Array.isArray(hook.parse))hook.parse=[hook.parse];let contentType=hook.parse?.map((x)=>{switch(typeof x){case"string":return x;case"object":if(x&&typeof x?.fn!=="string")return;switch(x?.fn){case"json":case"application/json":return"application/json";case"text":case"text/plain":return"text/plain";case"urlencoded":case"application/x-www-form-urlencoded":return"application/x-www-form-urlencoded";case"arrayBuffer":case"application/octet-stream":return"application/octet-stream";case"formdata":case"multipart/form-data":return"multipart/form-data"}}}).filter((x)=>x!==void 0);if(!contentType||contentType.length===0)contentType=["application/json","multipart/form-data","text/plain"];path=toOpenAPIPath(path);let contentTypes=typeof contentType==="string"?[contentType]:contentType??["application/json"],bodySchema=cloneHook(hook?.body),paramsSchema=cloneHook(hook?.params),headerSchema=cloneHook(hook?.headers),querySchema=cloneHook(hook?.query),responseSchema=cloneHook(hook?.response);if(typeof responseSchema==="object")if(Kind2 in responseSchema){let{type,properties,required,additionalProperties,patternProperties,$ref,...rest}=responseSchema;responseSchema={"200":{...rest,description:rest.description,content:mapTypesResponse(contentTypes,type==="object"||type==="array"?{type,properties,patternProperties,items:responseSchema.items,required}:responseSchema)}}}else Object.entries(responseSchema).forEach(([key,value])=>{if(typeof value==="string"){if(!models[value])return;let{type,properties,required,additionalProperties:_1,patternProperties:_2,...rest}=models[value];responseSchema[key]={...rest,description:rest.description,content:mapTypesResponse(contentTypes,value)}}else{let{type,properties,required,additionalProperties,patternProperties,...rest}=value;responseSchema[key]={...rest,description:rest.description,content:mapTypesResponse(contentTypes,type==="object"||type==="array"?{type,properties,patternProperties,items:value.items,required}:value)}}});else if(typeof responseSchema==="string"){if(!(responseSchema in models))return;let{type,properties,required,$ref,additionalProperties:_1,patternProperties:_2,...rest}=models[responseSchema];responseSchema={"200":{...rest,content:mapTypesResponse(contentTypes,responseSchema)}}}let parameters=[...mapProperties("header",headerSchema,models),...mapProperties("path",paramsSchema,models),...mapProperties("query",querySchema,models)];schema[path]={...schema[path]?schema[path]:{},[method.toLowerCase()]:{...headerSchema||paramsSchema||querySchema||bodySchema?{parameters}:{},...responseSchema?{responses:responseSchema}:{},operationId:hook?.detail?.operationId??generateOperationId(method,path),...hook?.detail,...bodySchema?{requestBody:{required:!0,content:mapTypesResponse(contentTypes,typeof bodySchema==="string"?{$ref:`#/components/schemas/${bodySchema}`}:bodySchema)}}:null}}},filterPaths=(paths,{excludeStaticFile=!0,exclude=[]})=>{let newPaths={};for(let[key,value]of Object.entries(paths))if(!exclude.some((x)=>{if(typeof x==="string")return key===x;return x.test(key)})&&!key.includes("*")&&(excludeStaticFile?!key.includes("."):!0))Object.keys(value).forEach((method)=>{let schema=value[method];if(key.includes("{")){if(!schema.parameters)schema.parameters=[];schema.parameters=[...key.split("/").filter((x)=>x.startsWith("{")&&!schema.parameters.find((params)=>params.in==="path"&&params.name===x.slice(1,x.length-1))).map((x)=>({schema:{type:"string"},in:"path",name:x.slice(1,x.length-1),required:!0})),...schema.parameters]}if(!schema.responses)schema.responses={200:{}}}),newPaths[key]=value;return newPaths},swagger=({provider="scalar",scalarVersion="latest",scalarCDN="",scalarConfig={},documentation={},version="5.9.0",excludeStaticFile=!0,path="/swagger",specPath=`${path}/json`,exclude=[],swaggerOptions={},theme=`https://unpkg.com/swagger-ui-dist@${version}/swagger-ui.css`,autoDarkMode=!0,excludeMethods=["OPTIONS"],excludeTags=[]}={})=>{let schema={},totalRoutes=0;if(!version)version=`https://unpkg.com/swagger-ui-dist@${version}/swagger-ui.css`;let info={title:"Elysia Documentation",description:"Development documentation",version:"0.0.0",...documentation.info},relativePath=specPath.startsWith("/")?specPath.slice(1):specPath,app=new Elysia({name:"@elysiajs/swagger"}),page=new Response(provider==="swagger-ui"?SwaggerUIRender(info,version,theme,JSON.stringify({url:relativePath,dom_id:"#swagger-ui",...swaggerOptions},(_2,value)=>typeof value==="function"?void 0:value),autoDarkMode):ScalarRender(info,scalarVersion,{spec:{url:relativePath,...scalarConfig.spec},...scalarConfig,_integration:"elysiajs"},scalarCDN),{headers:{"content-type":"text/html; charset=utf8"}});return app.get(path,page,{detail:{hide:!0}}).get(specPath,function(){let routes=app.getGlobalRoutes();if(routes.length!==totalRoutes){let ALLOWED_METHODS=["GET","PUT","POST","DELETE","OPTIONS","HEAD","PATCH","TRACE"];totalRoutes=routes.length,routes.forEach((route)=>{if(route.hooks?.detail?.hide===!0)return;if(excludeMethods.includes(route.method))return;if(ALLOWED_METHODS.includes(route.method)===!1&&route.method!=="ALL")return;if(route.method==="ALL")ALLOWED_METHODS.forEach((method)=>{registerSchemaPath({schema,hook:route.hooks,method,path:route.path,models:app.getGlobalDefinitions?.().type,contentType:route.hooks.type})});else registerSchemaPath({schema,hook:route.hooks,method:route.method,path:route.path,models:app.getGlobalDefinitions?.().type,contentType:route.hooks.type})})}return{openapi:"3.0.3",...{...documentation,tags:documentation.tags?.filter((tag)=>!excludeTags?.includes(tag?.name)),info:{title:"Elysia Documentation",description:"Development documentation",version:"0.0.0",...documentation.info}},paths:{...filterPaths(schema,{excludeStaticFile,exclude:Array.isArray(exclude)?exclude:[exclude]}),...documentation.paths},components:{...documentation.components,schemas:{...app.getGlobalDefinitions?.().type,...documentation.components?.schemas}}}},{detail:{hide:!0}}),app};var isBun3=typeof new Headers()?.toJSON==="function",processHeaders=(headers)=>{if(isBun3)return Object.keys(headers.toJSON()).join(", ");let keys="",i=0;return headers.forEach((_2,key)=>{if(i)keys=keys+", "+key;else keys=key;i++}),keys},cors=(config)=>{let{aot=!0,origin=!0,methods=!0,allowedHeaders=!0,exposeHeaders=!0,credentials=!0,maxAge=5,preflight=!0}=config??{};if(Array.isArray(allowedHeaders))allowedHeaders=allowedHeaders.join(", ");if(Array.isArray(exposeHeaders))exposeHeaders=exposeHeaders.join(", ");let origins=typeof origin==="boolean"?void 0:Array.isArray(origin)?origin:[origin],app=new Elysia({name:"@elysiajs/cors",seed:config,aot}),anyOrigin=origins?.some((o)=>o==="*"),originMap={};if(origins){for(let origin2 of origins)if(typeof origin2==="string")originMap[origin2]=!0}let processOrigin=(origin2,request,from)=>{if(Array.isArray(origin2))return origin2.some((o)=>processOrigin(o,request,from));switch(typeof origin2){case"string":if(from in originMap)return!0;let fromProtocol=from.indexOf("://");if(fromProtocol!==-1)from=from.slice(fromProtocol+3);return origin2===from;case"function":return origin2(request)===!0;case"object":if(origin2 instanceof RegExp)return origin2.test(from)}return!1},handleOrigin=(set2,request)=>{if(origin===!0){set2.headers.vary="*",set2.headers["access-control-allow-origin"]=request.headers.get("Origin")||"*";return}if(anyOrigin){set2.headers.vary="*",set2.headers["access-control-allow-origin"]="*";return}if(!origins?.length)return;let headers=[];if(origins.length){let from=request.headers.get("Origin")??"";for(let i=0;i<origins.length;i++)if(processOrigin(origins[i],request,from)===!0){set2.headers.vary=origin?"Origin":"*",set2.headers["access-control-allow-origin"]=from||"*";return}}if(set2.headers.vary="Origin",headers.length)set2.headers["access-control-allow-origin"]=headers.join(", ")},handleMethod=(set2,method)=>{if(!method)return;if(methods===!0)return set2.headers["access-control-allow-methods"]=method??"*";if(methods===!1||!methods?.length)return;if(methods==="*")return set2.headers["access-control-allow-methods"]="*";if(!Array.isArray(methods))return set2.headers["access-control-allow-methods"]=methods;set2.headers["access-control-allow-methods"]=methods.join(", ")},defaultHeaders={};if(typeof exposeHeaders==="string")defaultHeaders["access-control-expose-headers"]=exposeHeaders;if(typeof allowedHeaders==="string")defaultHeaders["access-control-allow-headers"]=allowedHeaders;if(credentials===!0)defaultHeaders["access-control-allow-credentials"]="true";app.headers(defaultHeaders);function handleOption({set:set2,request,headers}){if(handleOrigin(set2,request),handleMethod(set2,request.headers.get("access-control-request-method")),allowedHeaders===!0||exposeHeaders===!0){if(allowedHeaders===!0)set2.headers["access-control-allow-headers"]=headers["access-control-request-headers"];if(exposeHeaders===!0)set2.headers["access-control-expose-headers"]=Object.keys(headers).join(",")}if(maxAge)set2.headers["access-control-max-age"]=maxAge.toString();return new Response(null,{status:204})}if(preflight)app.options("/",handleOption).options("/*",handleOption);return app.onRequest(function({set:set2,request}){if(handleOrigin(set2,request),handleMethod(set2,request.method),allowedHeaders===!0||exposeHeaders===!0){let headers=processHeaders(request.headers);if(allowedHeaders===!0)set2.headers["access-control-allow-headers"]=headers;if(exposeHeaders===!0)set2.headers["access-control-expose-headers"]=headers}})};var import_config=__toESM(require_config(),1);import os from"os";import fs from"fs";var originCache=new Map,originStackCache=new Map,originError=Symbol("OriginError"),CLOSE={};class Query extends Promise{constructor(strings,args,handler,canceller,options={}){let resolve,reject;super((a12,b)=>{resolve=a12,reject=b});this.tagged=Array.isArray(strings.raw),this.strings=strings,this.args=args,this.handler=handler,this.canceller=canceller,this.options=options,this.state=null,this.statement=null,this.resolve=(x)=>(this.active=!1,resolve(x)),this.reject=(x)=>(this.active=!1,reject(x)),this.active=!1,this.cancelled=null,this.executed=!1,this.signature="",this[originError]=this.handler.debug?Error():this.tagged&&cachedError(this.strings)}get origin(){return(this.handler.debug?this[originError].stack:this.tagged&&originStackCache.has(this.strings)?originStackCache.get(this.strings):originStackCache.set(this.strings,this[originError].stack).get(this.strings))||""}static get[Symbol.species](){return Promise}cancel(){return this.canceller&&(this.canceller(this),this.canceller=null)}simple(){return this.options.simple=!0,this.options.prepare=!1,this}async readable(){return this.simple(),this.streaming=!0,this}async writable(){return this.simple(),this.streaming=!0,this}cursor(rows=1,fn){if(this.options.simple=!1,typeof rows==="function")fn=rows,rows=1;if(this.cursorRows=rows,typeof fn==="function")return this.cursorFn=fn,this;let prev;return{[Symbol.asyncIterator]:()=>({next:()=>{if(this.executed&&!this.active)return{done:!0};prev&&prev();let promise=new Promise((resolve,reject)=>{this.cursorFn=(value)=>{return resolve({value,done:!1}),new Promise((r2)=>prev=r2)},this.resolve=()=>(this.active=!1,resolve({done:!0})),this.reject=(x)=>(this.active=!1,reject(x))});return this.execute(),promise},return(){return prev&&prev(CLOSE),{done:!0}}})}}describe(){return this.options.simple=!1,this.onlyDescribe=this.options.prepare=!0,this}stream(){throw Error(".stream has been renamed to .forEach")}forEach(fn){return this.forEachFn=fn,this.handle(),this}raw(){return this.isRaw=!0,this}values(){return this.isRaw="values",this}async handle(){!this.executed&&(this.executed=!0)&&await 1&&this.handler(this)}execute(){return this.handle(),this}then(){return this.handle(),super.then.apply(this,arguments)}catch(){return this.handle(),super.catch.apply(this,arguments)}finally(){return this.handle(),super.finally.apply(this,arguments)}}function cachedError(xs){if(originCache.has(xs))return originCache.get(xs);let x=Error.stackTraceLimit;return Error.stackTraceLimit=4,originCache.set(xs,Error()),Error.stackTraceLimit=x,originCache.get(xs)}class PostgresError extends Error{constructor(x){super(x.message);this.name=this.constructor.name,Object.assign(this,x)}}var Errors2={connection,postgres,generic,notSupported};function connection(x,options,socket){let{host,port}=socket||options,error=Object.assign(Error("write "+x+" "+(options.path||host+":"+port)),{code:x,errno:x,address:options.path||host},options.path?{}:{port});return Error.captureStackTrace(error,connection),error}function postgres(x){let error=new PostgresError(x);return Error.captureStackTrace(error,postgres),error}function generic(code,message){let error=Object.assign(Error(code+": "+message),{code});return Error.captureStackTrace(error,generic),error}function notSupported(x){let error=Object.assign(Error(x+" (B) is not supported"),{code:"MESSAGE_NOT_SUPPORTED",name:x});return Error.captureStackTrace(error,notSupported),error}var types2={string:{to:25,from:null,serialize:(x)=>""+x},number:{to:0,from:[21,23,26,700,701],serialize:(x)=>""+x,parse:(x)=>+x},json:{to:114,from:[114,3802],serialize:(x)=>JSON.stringify(x),parse:(x)=>JSON.parse(x)},boolean:{to:16,from:16,serialize:(x)=>x===!0?"t":"f",parse:(x)=>x==="t"},date:{to:1184,from:[1082,1114,1184],serialize:(x)=>(x instanceof Date?x:new Date(x)).toISOString(),parse:(x)=>new Date(x)},bytea:{to:17,from:17,serialize:(x)=>"\\x"+Buffer.from(x).toString("hex"),parse:(x)=>Buffer.from(x.slice(2),"hex")}};class NotTagged{then(){notTagged()}catch(){notTagged()}finally(){notTagged()}}class Identifier2 extends NotTagged{constructor(value){super();this.value=escapeIdentifier(value)}}class Parameter extends NotTagged{constructor(value,type,array){super();this.value=value,this.type=type,this.array=array}}class Builder extends NotTagged{constructor(first,rest){super();this.first=first,this.rest=rest}build(before,parameters,types3,options){let keyword=builders.map(([x,fn])=>({fn,i:before.search(x)})).sort((a12,b)=>a12.i-b.i).pop();return keyword.i===-1?escapeIdentifiers(this.first,options):keyword.fn(this.first,this.rest,parameters,types3,options)}}function handleValue(x,parameters,types3,options){let value=x instanceof Parameter?x.value:x;if(value===void 0){if(x instanceof Parameter?x.value=options.transform.undefined:value=x=options.transform.undefined,value===void 0)throw Errors2.generic("UNDEFINED_VALUE","Undefined values are not allowed")}return"$"+types3.push(x instanceof Parameter?(parameters.push(x.value),x.array?x.array[x.type||inferType(x.value)]||x.type||firstIsString(x.value):x.type):(parameters.push(x),inferType(x)))}var defaultHandlers=typeHandlers(types2);function stringify(q,string,value,parameters,types3,options){for(let i=1;i<q.strings.length;i++)string+=stringifyValue(string,value,parameters,types3,options)+q.strings[i],value=q.args[i];return string}function stringifyValue(string,value,parameters,types3,o){return value instanceof Builder?value.build(string,parameters,types3,o):value instanceof Query?fragment(value,parameters,types3,o):value instanceof Identifier2?value.value:value&&value[0]instanceof Query?value.reduce((acc,x)=>acc+" "+fragment(x,parameters,types3,o),""):handleValue(value,parameters,types3,o)}function fragment(q,parameters,types3,options){return q.fragment=!0,stringify(q,q.strings[0],q.args[0],parameters,types3,options)}function valuesBuilder(first,parameters,types3,columns,options){return first.map((row)=>"("+columns.map((column)=>stringifyValue("values",row[column],parameters,types3,options)).join(",")+")").join(",")}function values(first,rest,parameters,types3,options){let multi=Array.isArray(first[0]),columns=rest.length?rest.flat():Object.keys(multi?first[0]:first);return valuesBuilder(multi?first:[first],parameters,types3,columns,options)}function select(first,rest,parameters,types3,options){if(typeof first==="string"&&(first=[first].concat(rest)),Array.isArray(first))return escapeIdentifiers(first,options);let value;return(rest.length?rest.flat():Object.keys(first)).map((x)=>{return value=first[x],(value instanceof Query?fragment(value,parameters,types3,options):value instanceof Identifier2?value.value:handleValue(value,parameters,types3,options))+" as "+escapeIdentifier(options.transform.column.to?options.transform.column.to(x):x)}).join(",")}var builders=Object.entries({values,in:(...xs)=>{let x=values(...xs);return x==="()"?"(null)":x},select,as:select,returning:select,"\\(":select,update(first,rest,parameters,types3,options){return(rest.length?rest.flat():Object.keys(first)).map((x)=>escapeIdentifier(options.transform.column.to?options.transform.column.to(x):x)+"="+stringifyValue("values",first[x],parameters,types3,options))},insert(first,rest,parameters,types3,options){let columns=rest.length?rest.flat():Object.keys(Array.isArray(first)?first[0]:first);return"("+escapeIdentifiers(columns,options)+")values"+valuesBuilder(Array.isArray(first)?first:[first],parameters,types3,columns,options)}}).map(([x,fn])=>[new RegExp("((?:^|[\\s(])"+x+"(?:$|[\\s(]))(?![\\s\\S]*\\1)","i"),fn]);function notTagged(){throw Errors2.generic("NOT_TAGGED_CALL","Query not called as a tagged template literal")}var{serializers,parsers}=defaultHandlers;function firstIsString(x){if(Array.isArray(x))return firstIsString(x[0]);return typeof x==="string"?1009:0}var mergeUserTypes=function(types3){let user=typeHandlers(types3||{});return{serializers:Object.assign({},serializers,user.serializers),parsers:Object.assign({},parsers,user.parsers)}};function typeHandlers(types3){return Object.keys(types3).reduce((acc,k2)=>{if(types3[k2].from&&[].concat(types3[k2].from).forEach((x)=>acc.parsers[x]=types3[k2].parse),types3[k2].serialize)acc.serializers[types3[k2].to]=types3[k2].serialize,types3[k2].from&&[].concat(types3[k2].from).forEach((x)=>acc.serializers[x]=types3[k2].serialize);return acc},{parsers:{},serializers:{}})}function escapeIdentifiers(xs,{transform:{column}}){return xs.map((x)=>escapeIdentifier(column.to?column.to(x):x)).join(",")}var escapeIdentifier=function(str){return'"'+str.replace(/"/g,'""').replace(/\./g,'"."')+'"'},inferType=function inferType2(x){return x instanceof Parameter?x.type:x instanceof Date?1184:x instanceof Uint8Array?17:x===!0||x===!1?16:typeof x==="bigint"?20:Array.isArray(x)?inferType2(x[0]):0},escapeBackslash=/\\/g,escapeQuote=/"/g;function arrayEscape(x){return x.replace(escapeBackslash,"\\\\").replace(escapeQuote,"\\\"")}var arraySerializer=function arraySerializer2(xs,serializer,options,typarray){if(Array.isArray(xs)===!1)return xs;if(!xs.length)return"{}";let first=xs[0],delimiter=typarray===1020?";":",";if(Array.isArray(first)&&!first.type)return"{"+xs.map((x)=>arraySerializer2(x,serializer,options,typarray)).join(delimiter)+"}";return"{"+xs.map((x)=>{if(x===void 0){if(x=options.transform.undefined,x===void 0)throw Errors2.generic("UNDEFINED_VALUE","Undefined values are not allowed")}return x===null?"null":'"'+arrayEscape(serializer?serializer(x.type?x.value:x):""+x)+'"'}).join(delimiter)+"}"},arrayParserState={i:0,char:null,str:"",quoted:!1,last:0},arrayParser=function(x,parser,typarray){return arrayParserState.i=arrayParserState.last=0,arrayParserLoop(arrayParserState,x,parser,typarray)};function arrayParserLoop(s,x,parser,typarray){let xs=[],delimiter=typarray===1020?";":",";for(;s.i<x.length;s.i++){if(s.char=x[s.i],s.quoted)if(s.char==="\\")s.str+=x[++s.i];else if(s.char==='"')xs.push(parser?parser(s.str):s.str),s.str="",s.quoted=x[s.i+1]==='"',s.last=s.i+2;else s.str+=s.char;else if(s.char==='"')s.quoted=!0;else if(s.char==="{")s.last=++s.i,xs.push(arrayParserLoop(s,x,parser,typarray));else if(s.char==="}"){s.quoted=!1,s.last<s.i&&xs.push(parser?parser(x.slice(s.last,s.i)):x.slice(s.last,s.i)),s.last=s.i+1;break}else if(s.char===delimiter&&s.p!=="}"&&s.p!=='"')xs.push(parser?parser(x.slice(s.last,s.i)):x.slice(s.last,s.i)),s.last=s.i+1;s.p=s.char}return s.last<s.i&&xs.push(parser?parser(x.slice(s.last,s.i+1)):x.slice(s.last,s.i+1)),xs}var toCamel=(x)=>{let str=x[0];for(let i=1;i<x.length;i++)str+=x[i]==="_"?x[++i].toUpperCase():x[i];return str},toPascal=(x)=>{let str=x[0].toUpperCase();for(let i=1;i<x.length;i++)str+=x[i]==="_"?x[++i].toUpperCase():x[i];return str},toKebab=(x)=>x.replace(/_/g,"-"),fromCamel=(x)=>x.replace(/([A-Z])/g,"_$1").toLowerCase(),fromPascal=(x)=>(x.slice(0,1)+x.slice(1).replace(/([A-Z])/g,"_$1")).toLowerCase(),fromKebab=(x)=>x.replace(/-/g,"_");function createJsonTransform(fn){return function jsonTransform(x,column){return typeof x==="object"&&x!==null&&(column.type===114||column.type===3802)?Array.isArray(x)?x.map((x2)=>jsonTransform(x2,column)):Object.entries(x).reduce((acc,[k2,v])=>Object.assign(acc,{[fn(k2)]:jsonTransform(v,column)}),{}):x}}toCamel.column={from:toCamel};toCamel.value={from:createJsonTransform(toCamel)};fromCamel.column={to:fromCamel};var camel={...toCamel};camel.column.to=fromCamel;toPascal.column={from:toPascal};toPascal.value={from:createJsonTransform(toPascal)};fromPascal.column={to:fromPascal};var pascal={...toPascal};pascal.column.to=fromPascal;toKebab.column={from:toKebab};toKebab.value={from:createJsonTransform(toKebab)};fromKebab.column={to:fromKebab};var kebab={...toKebab};kebab.column.to=fromKebab;import net from"net";import tls from"tls";import crypto2 from"crypto";import Stream from"stream";import{performance as performance2}from"perf_hooks";class Result extends Array{constructor(){super();Object.defineProperties(this,{count:{value:null,writable:!0},state:{value:null,writable:!0},command:{value:null,writable:!0},columns:{value:null,writable:!0},statement:{value:null,writable:!0}})}static get[Symbol.species](){return Array}}var queue_default=Queue;function Queue(initial=[]){let xs=initial.slice(),index=0;return{get length(){return xs.length-index},remove:(x)=>{let index2=xs.indexOf(x);return index2===-1?null:(xs.splice(index2,1),x)},push:(x)=>(xs.push(x),x),shift:()=>{let out=xs[index++];if(index===xs.length)index=0,xs=[];else xs[index-1]=void 0;return out}}}var buffer=Buffer.allocUnsafe(256),messages="BCcDdEFfHPpQSX".split("").reduce((acc,x)=>{let v=x.charCodeAt(0);return acc[x]=()=>{return buffer[0]=v,b.i=5,b},acc},{}),b=Object.assign(reset,messages,{N:String.fromCharCode(0),i:0,inc(x){return b.i+=x,b},str(x){let length=Buffer.byteLength(x);return fit(length),b.i+=buffer.write(x,b.i,length,"utf8"),b},i16(x){return fit(2),buffer.writeUInt16BE(x,b.i),b.i+=2,b},i32(x,i){if(i||i===0)return buffer.writeUInt32BE(x,i),b;return fit(4),buffer.writeUInt32BE(x,b.i),b.i+=4,b},z(x){return fit(x),buffer.fill(0,b.i,b.i+x),b.i+=x,b},raw(x){return buffer=Buffer.concat([buffer.subarray(0,b.i),x]),b.i=buffer.length,b},end(at=1){buffer.writeUInt32BE(b.i-at,at);let out=buffer.subarray(0,b.i);return b.i=0,buffer=Buffer.allocUnsafe(256),out}}),bytes_default=b;function fit(x){if(buffer.length-b.i<x){let prev=buffer,length=prev.length;buffer=Buffer.allocUnsafe(length+(length>>1)+x),prev.copy(buffer)}}function reset(){return b.i=0,b}var connection_default=Connection,uid=1,Sync=bytes_default().S().end(),Flush=bytes_default().H().end(),SSLRequest=bytes_default().i32(8).i32(80877103).end(8),ExecuteUnnamed=Buffer.concat([bytes_default().E().str(bytes_default.N).i32(0).end(),Sync]),DescribeUnnamed=bytes_default().D().str("S").str(bytes_default.N).end(),noop=()=>{},retryRoutines=new Set(["FetchPreparedStatement","RevalidateCachedQuery","transformAssignedExpr"]),errorFields={83:"severity_local",86:"severity",67:"code",77:"message",68:"detail",72:"hint",80:"position",112:"internal_position",113:"internal_query",87:"where",115:"schema_name",116:"table_name",99:"column_name",100:"data type_name",110:"constraint_name",70:"file",76:"line",82:"routine"};function Connection(options,queues={},{onopen=noop,onend=noop,onclose=noop}={}){let{ssl,max,user,host,port,database,parsers:parsers2,transform:transform2,onnotice,onnotify,onparameter,max_pipeline,keep_alive,backoff,target_session_attrs}=options,sent=queue_default(),id=uid++,backend={pid:null,secret:null},idleTimer=timer(end,options.idle_timeout),lifeTimer=timer(end,options.max_lifetime),connectTimer=timer(connectTimedOut,options.connect_timeout),socket=null,cancelMessage,result=new Result,incoming=Buffer.alloc(0),needsTypes=options.fetch_types,backendParameters={},statements={},statementId=Math.random().toString(36).slice(2),statementCount=1,closedDate=0,remaining=0,hostIndex=0,retries=0,length=0,delay=0,rows=0,serverSignature=null,nextWriteTimer=null,terminated=!1,incomings=null,results=null,initial=null,ending=null,stream=null,chunk=null,ended=null,nonce=null,query=null,final=null,connection2={queue:queues.closed,idleTimer,connect(query2){initial=query2,reconnect()},terminate,execute,cancel,end,count:0,id};return queues.closed&&queues.closed.push(connection2),connection2;async function createSocket(){let x;try{x=options.socket?await Promise.resolve(options.socket(options)):new net.Socket}catch(e){error(e);return}return x.on("error",error),x.on("close",closed),x.on("drain",drain),x}async function cancel({pid,secret},resolve,reject){try{cancelMessage=bytes_default().i32(16).i32(80877102).i32(pid).i32(secret).end(16),await connect(),socket.once("error",reject),socket.once("close",resolve)}catch(error2){reject(error2)}}function execute(q){if(terminated)return queryError(q,Errors2.connection("CONNECTION_DESTROYED",options));if(q.cancelled)return;try{return q.state=backend,query?sent.push(q):(query=q,query.active=!0),build(q),write(toBuffer(q))&&!q.describeFirst&&!q.cursorFn&&sent.length<max_pipeline&&(!q.options.onexecute||q.options.onexecute(connection2))}catch(error2){return sent.length===0&&write(Sync),errored(error2),!0}}function toBuffer(q){if(q.parameters.length>=65534)throw Errors2.generic("MAX_PARAMETERS_EXCEEDED","Max number of parameters (65534) exceeded");return q.options.simple?bytes_default().Q().str(q.statement.string+bytes_default.N).end():q.describeFirst?Buffer.concat([describe(q),Flush]):q.prepare?q.prepared?prepared(q):Buffer.concat([describe(q),prepared(q)]):unnamed(q)}function describe(q){return Buffer.concat([Parse2(q.statement.string,q.parameters,q.statement.types,q.statement.name),Describe("S",q.statement.name)])}function prepared(q){return Buffer.concat([Bind(q.parameters,q.statement.types,q.statement.name,q.cursorName),q.cursorFn?Execute("",q.cursorRows):ExecuteUnnamed])}function unnamed(q){return Buffer.concat([Parse2(q.statement.string,q.parameters,q.statement.types),DescribeUnnamed,prepared(q)])}function build(q){let parameters=[],types3=[],string=stringify(q,q.strings[0],q.args[0],parameters,types3,options);!q.tagged&&q.args.forEach((x)=>handleValue(x,parameters,types3,options)),q.prepare=options.prepare&&("prepare"in q.options?q.options.prepare:!0),q.string=string,q.signature=q.prepare&&types3+string,q.onlyDescribe&&delete statements[q.signature],q.parameters=q.parameters||parameters,q.prepared=q.prepare&&q.signature in statements,q.describeFirst=q.onlyDescribe||parameters.length&&!q.prepared,q.statement=q.prepared?statements[q.signature]:{string,types:types3,name:q.prepare?statementId+statementCount++:""},typeof options.debug==="function"&&options.debug(id,string,parameters,types3)}function write(x,fn){if(chunk=chunk?Buffer.concat([chunk,x]):Buffer.from(x),fn||chunk.length>=1024)return nextWrite(fn);return nextWriteTimer===null&&(nextWriteTimer=setImmediate(nextWrite)),!0}function nextWrite(fn){let x=socket.write(chunk,fn);return nextWriteTimer!==null&&clearImmediate(nextWriteTimer),chunk=nextWriteTimer=null,x}function connectTimedOut(){errored(Errors2.connection("CONNECT_TIMEOUT",options,socket)),socket.destroy()}async function secure(){if(write(SSLRequest),!await new Promise((r2)=>socket.once("data",(x)=>r2(x[0]===83)))&&ssl==="prefer")return connected();socket.removeAllListeners(),socket=tls.connect({socket,servername:net.isIP(socket.host)?void 0:socket.host,...ssl==="require"||ssl==="allow"||ssl==="prefer"?{rejectUnauthorized:!1}:ssl==="verify-full"?{}:typeof ssl==="object"?ssl:{}}),socket.on("secureConnect",connected),socket.on("error",error),socket.on("close",closed),socket.on("drain",drain)}function drain(){!query&&onopen(connection2)}function data(x){if(incomings){if(incomings.push(x),remaining-=x.length,remaining>0)return}incoming=incomings?Buffer.concat(incomings,length-remaining):incoming.length===0?x:Buffer.concat([incoming,x],incoming.length+x.length);while(incoming.length>4){if(length=incoming.readUInt32BE(1),length>=incoming.length){remaining=length-incoming.length,incomings=[incoming];break}try{handle(incoming.subarray(0,length+1))}catch(e){query&&(query.cursorFn||query.describeFirst)&&write(Sync),errored(e)}incoming=incoming.subarray(length+1),remaining=0,incomings=null}}async function connect(){if(terminated=!1,backendParameters={},socket||(socket=await createSocket()),!socket)return;if(connectTimer.start(),options.socket)return ssl?secure():connected();if(socket.on("connect",ssl?secure:connected),options.path)return socket.connect(options.path);socket.ssl=ssl,socket.connect(port[hostIndex],host[hostIndex]),socket.host=host[hostIndex],socket.port=port[hostIndex],hostIndex=(hostIndex+1)%port.length}function reconnect(){setTimeout(connect,closedDate?closedDate+delay-performance2.now():0)}function connected(){try{statements={},needsTypes=options.fetch_types,statementId=Math.random().toString(36).slice(2),statementCount=1,lifeTimer.start(),socket.on("data",data),keep_alive&&socket.setKeepAlive&&socket.setKeepAlive(!0,1000*keep_alive);let s=StartupMessage();write(s)}catch(err){error(err)}}function error(err){if(connection2.queue===queues.connecting&&options.host[retries+1])return;errored(err);while(sent.length)queryError(sent.shift(),err)}function errored(err){stream&&(stream.destroy(err),stream=null),query&&queryError(query,err),initial&&(queryError(initial,err),initial=null)}function queryError(query2,err){if(query2.reserve)return query2.reject(err);if(!err||typeof err!=="object")err=Error(err);"query"in err||"parameters"in err||Object.defineProperties(err,{stack:{value:err.stack+query2.origin.replace(/.*\n/,`
`),enumerable:options.debug},query:{value:query2.string,enumerable:options.debug},parameters:{value:query2.parameters,enumerable:options.debug},args:{value:query2.args,enumerable:options.debug},types:{value:query2.statement&&query2.statement.types,enumerable:options.debug}}),query2.reject(err)}function end(){return ending||(!connection2.reserved&&onend(connection2),!connection2.reserved&&!initial&&!query&&sent.length===0?(terminate(),new Promise((r2)=>socket&&socket.readyState!=="closed"?socket.once("close",r2):r2())):ending=new Promise((r2)=>ended=r2))}function terminate(){if(terminated=!0,stream||query||initial||sent.length)error(Errors2.connection("CONNECTION_DESTROYED",options));if(clearImmediate(nextWriteTimer),socket)socket.removeListener("data",data),socket.removeListener("connect",connected),socket.readyState==="open"&&socket.end(bytes_default().X().end());ended&&(ended(),ending=ended=null)}async function closed(hadError){if(incoming=Buffer.alloc(0),remaining=0,incomings=null,clearImmediate(nextWriteTimer),socket.removeListener("data",data),socket.removeListener("connect",connected),idleTimer.cancel(),lifeTimer.cancel(),connectTimer.cancel(),socket.removeAllListeners(),socket=null,initial)return reconnect();!hadError&&(query||sent.length)&&error(Errors2.connection("CONNECTION_CLOSED",options,socket)),closedDate=performance2.now(),hadError&&options.shared.retries++,delay=(typeof backoff==="function"?backoff(options.shared.retries):backoff)*1000,onclose(connection2,Errors2.connection("CONNECTION_CLOSED",options,socket))}function handle(xs,x=xs[0]){(x===68?DataRow:x===100?CopyData:x===65?NotificationResponse:x===83?ParameterStatus:x===90?ReadyForQuery:x===67?CommandComplete:x===50?BindComplete:x===49?ParseComplete:x===116?ParameterDescription:x===84?RowDescription:x===82?Authentication:x===110?NoData:x===75?BackendKeyData:x===69?ErrorResponse:x===115?PortalSuspended:x===51?CloseComplete:x===71?CopyInResponse:x===78?NoticeResponse:x===72?CopyOutResponse:x===99?CopyDone:x===73?EmptyQueryResponse:x===86?FunctionCallResponse:x===118?NegotiateProtocolVersion:x===87?CopyBothResponse:UnknownMessage)(xs)}function DataRow(x){let index=7,length2,column,value,row=query.isRaw?Array(query.statement.columns.length):{};for(let i=0;i<query.statement.columns.length;i++)column=query.statement.columns[i],length2=x.readInt32BE(index),index+=4,value=length2===-1?null:query.isRaw===!0?x.subarray(index,index+=length2):column.parser===void 0?x.toString("utf8",index,index+=length2):column.parser.array===!0?column.parser(x.toString("utf8",index+1,index+=length2)):column.parser(x.toString("utf8",index,index+=length2)),query.isRaw?row[i]=query.isRaw===!0?value:transform2.value.from?transform2.value.from(value,column):value:row[column.name]=transform2.value.from?transform2.value.from(value,column):value;query.forEachFn?query.forEachFn(transform2.row.from?transform2.row.from(row):row,result):result[rows++]=transform2.row.from?transform2.row.from(row):row}function ParameterStatus(x){let[k2,v]=x.toString("utf8",5,x.length-1).split(bytes_default.N);if(backendParameters[k2]=v,options.parameters[k2]!==v)options.parameters[k2]=v,onparameter&&onparameter(k2,v)}function ReadyForQuery(x){if(query&&query.options.simple&&query.resolve(results||result),query=results=null,result=new Result,connectTimer.cancel(),initial){if(target_session_attrs){if(!backendParameters.in_hot_standby||!backendParameters.default_transaction_read_only)return fetchState();else if(tryNext(target_session_attrs,backendParameters))return terminate()}if(needsTypes)return initial.reserve&&(initial=null),fetchArrayTypes();initial&&!initial.reserve&&execute(initial),options.shared.retries=retries=0,initial=null;return}while(sent.length&&(query=sent.shift())&&(query.active=!0,query.cancelled))Connection(options).cancel(query.state,query.cancelled.resolve,query.cancelled.reject);if(query)return;connection2.reserved?!connection2.reserved.release&&x[5]===73?ending?terminate():(connection2.reserved=null,onopen(connection2)):connection2.reserved():ending?terminate():onopen(connection2)}function CommandComplete(x){rows=0;for(let i=x.length-1;i>0;i--){if(x[i]===32&&x[i+1]<58&&result.count===null)result.count=+x.toString("utf8",i+1,x.length-1);if(x[i-1]>=65){result.command=x.toString("utf8",5,i),result.state=backend;break}}if(final&&(final(),final=null),result.command==="BEGIN"&&max!==1&&!connection2.reserved)return errored(Errors2.generic("UNSAFE_TRANSACTION","Only use sql.begin, sql.reserved or max: 1"));if(query.options.simple)return BindComplete();if(query.cursorFn)result.count&&query.cursorFn(result),write(Sync);query.resolve(result)}function ParseComplete(){query.parsing=!1}function BindComplete(){!result.statement&&(result.statement=query.statement),result.columns=query.statement.columns}function ParameterDescription(x){let length2=x.readUInt16BE(5);for(let i=0;i<length2;++i)!query.statement.types[i]&&(query.statement.types[i]=x.readUInt32BE(7+i*4));query.prepare&&(statements[query.signature]=query.statement),query.describeFirst&&!query.onlyDescribe&&(write(prepared(query)),query.describeFirst=!1)}function RowDescription(x){if(result.command)results=results||[result],results.push(result=new Result),result.count=null,query.statement.columns=null;let length2=x.readUInt16BE(5),index=7,start;query.statement.columns=Array(length2);for(let i=0;i<length2;++i){start=index;while(x[index++]!==0);let table=x.readUInt32BE(index),number=x.readUInt16BE(index+4),type=x.readUInt32BE(index+6);query.statement.columns[i]={name:transform2.column.from?transform2.column.from(x.toString("utf8",start,index-1)):x.toString("utf8",start,index-1),parser:parsers2[type],table,number,type},index+=18}if(result.statement=query.statement,query.onlyDescribe)return query.resolve(query.statement),write(Sync)}async function Authentication(x,type=x.readUInt32BE(5)){(type===3?AuthenticationCleartextPassword:type===5?AuthenticationMD5Password:type===10?SASL:type===11?SASLContinue:type===12?SASLFinal:type!==0?UnknownAuth:noop)(x,type)}async function AuthenticationCleartextPassword(){let payload=await Pass();write(bytes_default().p().str(payload).z(1).end())}async function AuthenticationMD5Password(x){let payload="md5"+await md5(Buffer.concat([Buffer.from(await md5(await Pass()+user)),x.subarray(9)]));write(bytes_default().p().str(payload).z(1).end())}async function SASL(){nonce=(await crypto2.randomBytes(18)).toString("base64"),bytes_default().p().str("SCRAM-SHA-256"+bytes_default.N);let i=bytes_default.i;write(bytes_default.inc(4).str("n,,n=*,r="+nonce).i32(bytes_default.i-i-4,i).end())}async function SASLContinue(x){let res=x.toString("utf8",9).split(",").reduce((acc,x2)=>(acc[x2[0]]=x2.slice(2),acc),{}),saltedPassword=await crypto2.pbkdf2Sync(await Pass(),Buffer.from(res.s,"base64"),parseInt(res.i),32,"sha256"),clientKey=await hmac(saltedPassword,"Client Key"),auth="n=*,r="+nonce+",r="+res.r+",s="+res.s+",i="+res.i+",c=biws,r="+res.r;serverSignature=(await hmac(await hmac(saltedPassword,"Server Key"),auth)).toString("base64");let payload="c=biws,r="+res.r+",p="+xor(clientKey,Buffer.from(await hmac(await sha256(clientKey),auth))).toString("base64");write(bytes_default().p().str(payload).end())}function SASLFinal(x){if(x.toString("utf8",9).split(bytes_default.N,1)[0].slice(2)===serverSignature)return;errored(Errors2.generic("SASL_SIGNATURE_MISMATCH","The server did not return the correct signature")),socket.destroy()}function Pass(){return Promise.resolve(typeof options.pass==="function"?options.pass():options.pass)}function NoData(){if(result.statement=query.statement,result.statement.columns=[],query.onlyDescribe)return query.resolve(query.statement),write(Sync)}function BackendKeyData(x){backend.pid=x.readUInt32BE(5),backend.secret=x.readUInt32BE(9)}async function fetchArrayTypes(){needsTypes=!1,(await new Query([`
      select b.oid, b.typarray
      from pg_catalog.pg_type a
      left join pg_catalog.pg_type b on b.oid = a.typelem
      where a.typcategory = 'A'
      group by b.oid, b.typarray
      order by b.oid
    `],[],execute)).forEach(({oid,typarray})=>addArrayType(oid,typarray))}function addArrayType(oid,typarray){if(!!options.parsers[typarray]&&!!options.serializers[typarray])return;let parser=options.parsers[oid];options.shared.typeArrayMap[oid]=typarray,options.parsers[typarray]=(xs)=>arrayParser(xs,parser,typarray),options.parsers[typarray].array=!0,options.serializers[typarray]=(xs)=>arraySerializer(xs,options.serializers[oid],options,typarray)}function tryNext(x,xs){return x==="read-write"&&xs.default_transaction_read_only==="on"||x==="read-only"&&xs.default_transaction_read_only==="off"||x==="primary"&&xs.in_hot_standby==="on"||x==="standby"&&xs.in_hot_standby==="off"||x==="prefer-standby"&&xs.in_hot_standby==="off"&&options.host[retries]}function fetchState(){let query2=new Query([`
      show transaction_read_only;
      select pg_catalog.pg_is_in_recovery()
    `],[],execute,null,{simple:!0});query2.resolve=([[a12],[b2]])=>{backendParameters.default_transaction_read_only=a12.transaction_read_only,backendParameters.in_hot_standby=b2.pg_is_in_recovery?"on":"off"},query2.execute()}function ErrorResponse(x){query&&(query.cursorFn||query.describeFirst)&&write(Sync);let error2=Errors2.postgres(parseError(x));query&&query.retried?errored(query.retried):query&&query.prepared&&retryRoutines.has(error2.routine)?retry(query,error2):errored(error2)}function retry(q,error2){delete statements[q.signature],q.retried=error2,execute(q)}function NotificationResponse(x){if(!onnotify)return;let index=9;while(x[index++]!==0);onnotify(x.toString("utf8",9,index-1),x.toString("utf8",index,x.length-1))}async function PortalSuspended(){try{let x=await Promise.resolve(query.cursorFn(result));rows=0,x===CLOSE?write(Close(query.portal)):(result=new Result,write(Execute("",query.cursorRows)))}catch(err){write(Sync),query.reject(err)}}function CloseComplete(){result.count&&query.cursorFn(result),query.resolve(result)}function CopyInResponse(){stream=new Stream.Writable({autoDestroy:!0,write(chunk2,encoding,callback){socket.write(bytes_default().d().raw(chunk2).end(),callback)},destroy(error2,callback){callback(error2),socket.write(bytes_default().f().str(error2+bytes_default.N).end()),stream=null},final(callback){socket.write(bytes_default().c().end()),final=callback}}),query.resolve(stream)}function CopyOutResponse(){stream=new Stream.Readable({read(){socket.resume()}}),query.resolve(stream)}function CopyBothResponse(){stream=new Stream.Duplex({autoDestroy:!0,read(){socket.resume()},write(chunk2,encoding,callback){socket.write(bytes_default().d().raw(chunk2).end(),callback)},destroy(error2,callback){callback(error2),socket.write(bytes_default().f().str(error2+bytes_default.N).end()),stream=null},final(callback){socket.write(bytes_default().c().end()),final=callback}}),query.resolve(stream)}function CopyData(x){stream&&(stream.push(x.subarray(5))||socket.pause())}function CopyDone(){stream&&stream.push(null),stream=null}function NoticeResponse(x){onnotice?onnotice(parseError(x)):console.log(parseError(x))}function EmptyQueryResponse(){}function FunctionCallResponse(){errored(Errors2.notSupported("FunctionCallResponse"))}function NegotiateProtocolVersion(){errored(Errors2.notSupported("NegotiateProtocolVersion"))}function UnknownMessage(x){console.error("Postgres.js : Unknown Message:",x[0])}function UnknownAuth(x,type){console.error("Postgres.js : Unknown Auth:",type)}function Bind(parameters,types3,statement="",portal=""){let prev,type;return bytes_default().B().str(portal+bytes_default.N).str(statement+bytes_default.N).i16(0).i16(parameters.length),parameters.forEach((x,i)=>{if(x===null)return bytes_default.i32(4294967295);type=types3[i],parameters[i]=x=type in options.serializers?options.serializers[type](x):""+x,prev=bytes_default.i,bytes_default.inc(4).str(x).i32(bytes_default.i-prev-4,prev)}),bytes_default.i16(0),bytes_default.end()}function Parse2(str,parameters,types3,name=""){return bytes_default().P().str(name+bytes_default.N).str(str+bytes_default.N).i16(parameters.length),parameters.forEach((x,i)=>bytes_default.i32(types3[i]||0)),bytes_default.end()}function Describe(x,name=""){return bytes_default().D().str(x).str(name+bytes_default.N).end()}function Execute(portal="",rows2=0){return Buffer.concat([bytes_default().E().str(portal+bytes_default.N).i32(rows2).end(),Flush])}function Close(portal=""){return Buffer.concat([bytes_default().C().str("P").str(portal+bytes_default.N).end(),bytes_default().S().end()])}function StartupMessage(){return cancelMessage||bytes_default().inc(4).i16(3).z(2).str(Object.entries(Object.assign({user,database,client_encoding:"UTF8"},options.connection)).filter(([,v])=>v).map(([k2,v])=>k2+bytes_default.N+v).join(bytes_default.N)).z(2).end(0)}}function parseError(x){let error={},start=5;for(let i=5;i<x.length-1;i++)if(x[i]===0)error[errorFields[x[start]]]=x.toString("utf8",start+1,i),start=i+1;return error}function md5(x){return crypto2.createHash("md5").update(x).digest("hex")}function hmac(key,x){return crypto2.createHmac("sha256",key).update(x).digest()}function sha256(x){return crypto2.createHash("sha256").update(x).digest()}function xor(a12,b2){let length=Math.max(a12.length,b2.length),buffer2=Buffer.allocUnsafe(length);for(let i=0;i<length;i++)buffer2[i]=a12[i]^b2[i];return buffer2}function timer(fn,seconds){if(seconds=typeof seconds==="function"?seconds():seconds,!seconds)return{cancel:noop,start:noop};let timer2;return{cancel(){timer2&&(clearTimeout(timer2),timer2=null)},start(){timer2&&clearTimeout(timer2),timer2=setTimeout(done,seconds*1000,arguments)}};function done(args){fn.apply(null,args),timer2=null}}var noop2=()=>{};function Subscribe(postgres2,options){let subscribers=new Map,slot="postgresjs_"+Math.random().toString(36).slice(2),state={},connection2,stream,ended=!1,sql=subscribe.sql=postgres2({...options,transform:{column:{},value:{},row:{}},max:1,fetch_types:!1,idle_timeout:null,max_lifetime:null,connection:{...options.connection,replication:"database"},onclose:async function(){if(ended)return;stream=null,state.pid=state.secret=void 0,connected(await init(sql,slot,options.publications)),subscribers.forEach((event)=>event.forEach(({onsubscribe})=>onsubscribe()))},no_subscribe:!0}),end=sql.end,close=sql.close;return sql.end=async()=>{return ended=!0,stream&&await new Promise((r2)=>(stream.once("close",r2),stream.end())),end()},sql.close=async()=>{return stream&&await new Promise((r2)=>(stream.once("close",r2),stream.end())),close()},subscribe;async function subscribe(event,fn,onsubscribe=noop2,onerror=noop2){if(event=parseEvent(event),!connection2)connection2=init(sql,slot,options.publications);let subscriber={fn,onsubscribe},fns=subscribers.has(event)?subscribers.get(event).add(subscriber):subscribers.set(event,new Set([subscriber])).get(event),unsubscribe=()=>{fns.delete(subscriber),fns.size===0&&subscribers.delete(event)};return connection2.then((x)=>{return connected(x),onsubscribe(),stream&&stream.on("error",onerror),{unsubscribe,state,sql}})}function connected(x){stream=x.stream,state.pid=x.state.pid,state.secret=x.state.secret}async function init(sql2,slot2,publications){if(!publications)throw Error("Missing publication names");let xs=await sql2.unsafe(`CREATE_REPLICATION_SLOT ${slot2} TEMPORARY LOGICAL pgoutput NOEXPORT_SNAPSHOT`),[x]=xs,stream2=await sql2.unsafe(`START_REPLICATION SLOT ${slot2} LOGICAL ${x.consistent_point} (proto_version '1', publication_names '${publications}')`).writable(),state2={lsn:Buffer.concat(x.consistent_point.split("/").map((x2)=>Buffer.from(("00000000"+x2).slice(-8),"hex")))};return stream2.on("data",data),stream2.on("error",error),stream2.on("close",sql2.close),{stream:stream2,state:xs.state};function error(e){console.error("Unexpected error during logical streaming - reconnecting",e)}function data(x2){if(x2[0]===119)parse2(x2.subarray(25),state2,sql2.options.parsers,handle,options.transform);else if(x2[0]===107&&x2[17])state2.lsn=x2.subarray(1,9),pong()}function handle(a12,b2){let path=b2.relation.schema+"."+b2.relation.table;call("*",a12,b2),call("*:"+path,a12,b2),b2.relation.keys.length&&call("*:"+path+"="+b2.relation.keys.map((x2)=>a12[x2.name]),a12,b2),call(b2.command,a12,b2),call(b2.command+":"+path,a12,b2),b2.relation.keys.length&&call(b2.command+":"+path+"="+b2.relation.keys.map((x2)=>a12[x2.name]),a12,b2)}function pong(){let x2=Buffer.alloc(34);x2[0]=114,x2.fill(state2.lsn,1),x2.writeBigInt64BE(BigInt(Date.now()-Date.UTC(2000,0,1))*BigInt(1000),25),stream2.write(x2)}}function call(x,a12,b2){subscribers.has(x)&&subscribers.get(x).forEach(({fn})=>fn(a12,b2,x))}}function Time(x){return new Date(Date.UTC(2000,0,1)+Number(x/BigInt(1000)))}function parse2(x,state,parsers2,handle,transform2){let char=(acc,[k2,v])=>(acc[k2.charCodeAt(0)]=v,acc);Object.entries({R:(x2)=>{let i=1,r2=state[x2.readUInt32BE(i)]={schema:x2.toString("utf8",i+=4,i=x2.indexOf(0,i))||"pg_catalog",table:x2.toString("utf8",i+1,i=x2.indexOf(0,i+1)),columns:Array(x2.readUInt16BE(i+=2)),keys:[]};i+=2;let columnIndex=0,column;while(i<x2.length)column=r2.columns[columnIndex++]={key:x2[i++],name:transform2.column.from?transform2.column.from(x2.toString("utf8",i,i=x2.indexOf(0,i))):x2.toString("utf8",i,i=x2.indexOf(0,i)),type:x2.readUInt32BE(i+=1),parser:parsers2[x2.readUInt32BE(i)],atttypmod:x2.readUInt32BE(i+=4)},column.key&&r2.keys.push(column),i+=4},Y:()=>{},O:()=>{},B:(x2)=>{state.date=Time(x2.readBigInt64BE(9)),state.lsn=x2.subarray(1,9)},I:(x2)=>{let i=1,relation=state[x2.readUInt32BE(i)],{row}=tuples(x2,relation.columns,i+=7,transform2);handle(row,{command:"insert",relation})},D:(x2)=>{let i=1,relation=state[x2.readUInt32BE(i)];i+=4;let key=x2[i]===75;handle(key||x2[i]===79?tuples(x2,relation.columns,i+=3,transform2).row:null,{command:"delete",relation,key})},U:(x2)=>{let i=1,relation=state[x2.readUInt32BE(i)];i+=4;let key=x2[i]===75,xs=key||x2[i]===79?tuples(x2,relation.columns,i+=3,transform2):null;xs&&(i=xs.i);let{row}=tuples(x2,relation.columns,i+3,transform2);handle(row,{command:"update",relation,key,old:xs&&xs.row})},T:()=>{},C:()=>{}}).reduce(char,{})[x[0]](x)}function tuples(x,columns,xi,transform2){let type,column,value,row=transform2.raw?Array(columns.length):{};for(let i=0;i<columns.length;i++)type=x[xi++],column=columns[i],value=type===110?null:type===117?void 0:column.parser===void 0?x.toString("utf8",xi+4,xi+=4+x.readUInt32BE(xi)):column.parser.array===!0?column.parser(x.toString("utf8",xi+5,xi+=4+x.readUInt32BE(xi))):column.parser(x.toString("utf8",xi+4,xi+=4+x.readUInt32BE(xi))),transform2.raw?row[i]=transform2.raw===!0?value:transform2.value.from?transform2.value.from(value,column):value:row[column.name]=transform2.value.from?transform2.value.from(value,column):value;return{i:xi,row:transform2.row.from?transform2.row.from(row):row}}function parseEvent(x){let xs=x.match(/^(\*|insert|update|delete)?:?([^.]+?\.?[^=]+)?=?(.+)?/i)||[];if(!xs)throw Error("Malformed subscribe pattern: "+x);let[,command,path,key]=xs;return(command||"*")+(path?":"+(path.indexOf(".")===-1?"public."+path:path):"")+(key?"="+key:"")}import Stream2 from"stream";function largeObject(sql,oid,mode=393216){return new Promise(async(resolve,reject)=>{await sql.begin(async(sql2)=>{let finish;!oid&&([{oid}]=await sql2`select lo_creat(-1) as oid`);let[{fd}]=await sql2`select lo_open(${oid}, ${mode}) as fd`,lo={writable,readable,close:()=>sql2`select lo_close(${fd})`.then(finish),tell:()=>sql2`select lo_tell64(${fd})`,read:(x)=>sql2`select loread(${fd}, ${x}) as data`,write:(x)=>sql2`select lowrite(${fd}, ${x})`,truncate:(x)=>sql2`select lo_truncate64(${fd}, ${x})`,seek:(x,whence=0)=>sql2`select lo_lseek64(${fd}, ${x}, ${whence})`,size:()=>sql2`
          select
            lo_lseek64(${fd}, location, 0) as position,
            seek.size
          from (
            select
              lo_lseek64($1, 0, 2) as size,
              tell.location
            from (select lo_tell64($1) as location) tell
          ) seek
        `};return resolve(lo),new Promise(async(r2)=>finish=r2);async function readable({highWaterMark=16384,start=0,end=1/0}={}){let max=end-start;return start&&await lo.seek(start),new Stream2.Readable({highWaterMark,async read(size){let l2=size>max?size-max:size;max-=size;let[{data}]=await lo.read(l2);if(this.push(data),data.length<size)this.push(null)}})}async function writable({highWaterMark=16384,start=0}={}){return start&&await lo.seek(start),new Stream2.Writable({highWaterMark,write(chunk,encoding,callback){lo.write(chunk).then(()=>callback(),callback)}})}}).catch(reject)})}Object.assign(Postgres,{PostgresError,toPascal,pascal,toCamel,camel,toKebab,kebab,fromPascal,fromCamel,fromKebab,BigInt:{to:20,from:[20],parse:(x)=>BigInt(x),serialize:(x)=>x.toString()}});var src_default=Postgres;function Postgres(a12,b2){let options=parseOptions(a12,b2),subscribe=options.no_subscribe||Subscribe(Postgres,{...options}),ending=!1,queries=queue_default(),connecting=queue_default(),reserved=queue_default(),closed=queue_default(),ended=queue_default(),open=queue_default(),busy=queue_default(),full=queue_default(),queues={connecting,reserved,closed,ended,open,busy,full},connections=[...Array(options.max)].map(()=>connection_default(options,queues,{onopen,onend,onclose})),sql=Sql(handler);return Object.assign(sql,{get parameters(){return options.parameters},largeObject:largeObject.bind(null,sql),subscribe,CLOSE,END:CLOSE,PostgresError,options,reserve,listen,begin,close,end}),sql;function Sql(handler2){return handler2.debug=options.debug,Object.entries(options.types).reduce((acc,[name,type])=>{return acc[name]=(x)=>new Parameter(x,type.to),acc},typed),Object.assign(sql2,{types:typed,typed,unsafe,notify,array,json,file}),sql2;function typed(value,type){return new Parameter(value,type)}function sql2(strings,...args){return strings&&Array.isArray(strings.raw)?new Query(strings,args,handler2,cancel):typeof strings==="string"&&!args.length?new Identifier2(options.transform.column.to?options.transform.column.to(strings):strings):new Builder(strings,args)}function unsafe(string,args=[],options2={}){return arguments.length===2&&!Array.isArray(args)&&(options2=args,args=[]),new Query([string],args,handler2,cancel,{prepare:!1,...options2,simple:"simple"in options2?options2.simple:args.length===0})}function file(path,args=[],options2={}){return arguments.length===2&&!Array.isArray(args)&&(options2=args,args=[]),new Query([],args,(query2)=>{fs.readFile(path,"utf8",(err,string)=>{if(err)return query2.reject(err);query2.strings=[string],handler2(query2)})},cancel,{...options2,simple:"simple"in options2?options2.simple:args.length===0})}}async function listen(name,fn,onlisten){let listener={fn,onlisten},sql2=listen.sql||(listen.sql=Postgres({...options,max:1,idle_timeout:null,max_lifetime:null,fetch_types:!1,onclose(){Object.entries(listen.channels).forEach(([name2,{listeners}])=>{delete listen.channels[name2],Promise.all(listeners.map((l2)=>listen(name2,l2.fn,l2.onlisten).catch(()=>{})))})},onnotify(c,x){c in listen.channels&&listen.channels[c].listeners.forEach((l2)=>l2.fn(x))}})),channels=listen.channels||(listen.channels={});if(name in channels){channels[name].listeners.push(listener);let result2=await channels[name].result;return listener.onlisten&&listener.onlisten(),{state:result2.state,unlisten}}channels[name]={result:sql2`listen ${sql2.unsafe('"'+name.replace(/"/g,'""')+'"')}`,listeners:[listener]};let result=await channels[name].result;return listener.onlisten&&listener.onlisten(),{state:result.state,unlisten};async function unlisten(){if(name in channels===!1)return;if(channels[name].listeners=channels[name].listeners.filter((x)=>x!==listener),channels[name].listeners.length)return;return delete channels[name],sql2`unlisten ${sql2.unsafe('"'+name.replace(/"/g,'""')+'"')}`}}async function notify(channel,payload){return await sql`select pg_notify(${channel}, ${""+payload})`}async function reserve(){let queue=queue_default(),c=open.length?open.shift():await new Promise((resolve,reject)=>{let query={reserve:resolve,reject};queries.push(query),closed.length&&connect(closed.shift(),query)});move(c,reserved),c.reserved=()=>queue.length?c.execute(queue.shift()):move(c,reserved),c.reserved.release=!0;let sql2=Sql(handler2);return sql2.release=()=>{c.reserved=null,onopen(c)},sql2;function handler2(q){c.queue===full?queue.push(q):c.execute(q)||move(c,full)}}async function begin(options2,fn){!fn&&(fn=options2,options2="");let queries2=queue_default(),savepoints=0,connection2,prepare=null;try{return await sql.unsafe("begin "+options2.replace(/[^a-z ]/ig,""),[],{onexecute}).execute(),await Promise.race([scope(connection2,fn),new Promise((_2,reject)=>connection2.onclose=reject)])}catch(error){throw error}async function scope(c,fn2,name){let sql2=Sql(handler2);sql2.savepoint=savepoint,sql2.prepare=(x)=>prepare=x.replace(/[^a-z0-9$-_. ]/gi);let uncaughtError,result;name&&await sql2`savepoint ${sql2(name)}`;try{if(result=await new Promise((resolve,reject)=>{let x=fn2(sql2);Promise.resolve(Array.isArray(x)?Promise.all(x):x).then(resolve,reject)}),uncaughtError)throw uncaughtError}catch(e){throw await(name?sql2`rollback to ${sql2(name)}`:sql2`rollback`),e instanceof PostgresError&&e.code==="25P02"&&uncaughtError||e}if(!name)prepare?await sql2`prepare transaction '${sql2.unsafe(prepare)}'`:await sql2`commit`;return result;function savepoint(name2,fn3){if(name2&&Array.isArray(name2.raw))return savepoint((sql3)=>sql3.apply(sql3,arguments));return arguments.length===1&&(fn3=name2,name2=null),scope(c,fn3,"s"+savepoints+++(name2?"_"+name2:""))}function handler2(q){q.catch((e)=>uncaughtError||(uncaughtError=e)),c.queue===full?queries2.push(q):c.execute(q)||move(c,full)}}function onexecute(c){connection2=c,move(c,reserved),c.reserved=()=>queries2.length?c.execute(queries2.shift()):move(c,reserved)}}function move(c,queue){return c.queue.remove(c),queue.push(c),c.queue=queue,queue===open?c.idleTimer.start():c.idleTimer.cancel(),c}function json(x){return new Parameter(x,3802)}function array(x,type){if(!Array.isArray(x))return array(Array.from(arguments));return new Parameter(x,type||(x.length?inferType(x)||25:0),options.shared.typeArrayMap)}function handler(query){if(ending)return query.reject(Errors2.connection("CONNECTION_ENDED",options,options));if(open.length)return go(open.shift(),query);if(closed.length)return connect(closed.shift(),query);busy.length?go(busy.shift(),query):queries.push(query)}function go(c,query){return c.execute(query)?move(c,busy):move(c,full)}function cancel(query){return new Promise((resolve,reject)=>{query.state?query.active?connection_default(options).cancel(query.state,resolve,reject):query.cancelled={resolve,reject}:(queries.remove(query),query.cancelled=!0,query.reject(Errors2.generic("57014","canceling statement due to user request")),resolve())})}async function end({timeout=null}={}){if(ending)return ending;await 1;let timer2;return ending=Promise.race([new Promise((r2)=>timeout!==null&&(timer2=setTimeout(destroy,timeout*1000,r2))),Promise.all(connections.map((c)=>c.end()).concat(listen.sql?listen.sql.end({timeout:0}):[],subscribe.sql?subscribe.sql.end({timeout:0}):[]))]).then(()=>clearTimeout(timer2))}async function close(){await Promise.all(connections.map((c)=>c.end()))}async function destroy(resolve){await Promise.all(connections.map((c)=>c.terminate()));while(queries.length)queries.shift().reject(Errors2.connection("CONNECTION_DESTROYED",options));resolve()}function connect(c,query){return move(c,connecting),c.connect(query),c}function onend(c){move(c,ended)}function onopen(c){if(queries.length===0)return move(c,open);let max=Math.ceil(queries.length/(connecting.length+1)),ready=!0;while(ready&&queries.length&&max-- >0){let query=queries.shift();if(query.reserve)return query.reserve(c);ready=c.execute(query)}ready?move(c,busy):move(c,full)}function onclose(c,e){move(c,closed),c.reserved=null,c.onclose&&(c.onclose(e),c.onclose=null),options.onclose&&options.onclose(c.id),queries.length&&connect(c,queries.shift())}}function parseOptions(a12,b2){if(a12&&a12.shared)return a12;let env3=process.env,o=(!a12||typeof a12==="string"?b2:a12)||{},{url,multihost}=parseUrl(a12),query=[...url.searchParams].reduce((a13,[b3,c])=>(a13[b3]=c,a13),{}),host=o.hostname||o.host||multihost||url.hostname||env3.PGHOST||"localhost",port=o.port||url.port||env3.PGPORT||5432,user=o.user||o.username||url.username||env3.PGUSERNAME||env3.PGUSER||osUsername();o.no_prepare&&(o.prepare=!1),query.sslmode&&(query.ssl=query.sslmode,delete query.sslmode),"timeout"in o&&(console.log("The timeout option is deprecated, use idle_timeout instead"),o.idle_timeout=o.timeout),query.sslrootcert==="system"&&(query.ssl="verify-full");let ints=["idle_timeout","connect_timeout","max_lifetime","max_pipeline","backoff","keep_alive"],defaults={max:10,ssl:!1,idle_timeout:null,connect_timeout:30,max_lifetime,max_pipeline:100,backoff,keep_alive:60,prepare:!0,debug:!1,fetch_types:!0,publications:"alltables",target_session_attrs:null};return{host:Array.isArray(host)?host:host.split(",").map((x)=>x.split(":")[0]),port:Array.isArray(port)?port:host.split(",").map((x)=>parseInt(x.split(":")[1]||port)),path:o.path||host.indexOf("/")>-1&&host+"/.s.PGSQL."+port,database:o.database||o.db||(url.pathname||"").slice(1)||env3.PGDATABASE||user,user,pass:o.pass||o.password||url.password||env3.PGPASSWORD||"",...Object.entries(defaults).reduce((acc,[k2,d])=>{let value=k2 in o?o[k2]:(k2 in query)?query[k2]==="disable"||query[k2]==="false"?!1:query[k2]:env3["PG"+k2.toUpperCase()]||d;return acc[k2]=typeof value==="string"&&ints.includes(k2)?+value:value,acc},{}),connection:{application_name:env3.PGAPPNAME||"postgres.js",...o.connection,...Object.entries(query).reduce((acc,[k2,v])=>((k2 in defaults)||(acc[k2]=v),acc),{})},types:o.types||{},target_session_attrs:tsa(o,url,env3),onnotice:o.onnotice,onnotify:o.onnotify,onclose:o.onclose,onparameter:o.onparameter,socket:o.socket,transform:parseTransform(o.transform||{undefined:void 0}),parameters:{},shared:{retries:0,typeArrayMap:{}},...mergeUserTypes(o.types)}}function tsa(o,url,env3){let x=o.target_session_attrs||url.searchParams.get("target_session_attrs")||env3.PGTARGETSESSIONATTRS;if(!x||["read-write","read-only","primary","standby","prefer-standby"].includes(x))return x;throw Error("target_session_attrs "+x+" is not supported")}function backoff(retries){return(0.5+Math.random()/2)*Math.min(3**retries/100,20)}function max_lifetime(){return 60*(30+Math.random()*30)}function parseTransform(x){return{undefined:x.undefined,column:{from:typeof x.column==="function"?x.column:x.column&&x.column.from,to:x.column&&x.column.to},value:{from:typeof x.value==="function"?x.value:x.value&&x.value.from,to:x.value&&x.value.to},row:{from:typeof x.row==="function"?x.row:x.row&&x.row.from,to:x.row&&x.row.to}}}function parseUrl(url){if(!url||typeof url!=="string")return{url:{searchParams:new Map}};let host=url;host=host.slice(host.indexOf("://")+3).split(/[?/]/)[0],host=decodeURIComponent(host.slice(host.indexOf("@")+1));let urlObj=new URL(url.replace(host,host.split(",")[0]));return{url:{username:decodeURIComponent(urlObj.username),password:decodeURIComponent(urlObj.password),host:urlObj.host,hostname:urlObj.hostname,port:urlObj.port,pathname:urlObj.pathname,searchParams:urlObj.searchParams},multihost:host.indexOf(",")>-1&&host}}function osUsername(){try{return os.userInfo().username}catch(_2){return process.env.USERNAME||process.env.USER||process.env.LOGNAME}}var entityKind=Symbol.for("drizzle:entityKind");function is(value,type){if(!value||typeof value!=="object")return!1;if(value instanceof type)return!0;if(!Object.prototype.hasOwnProperty.call(type,entityKind))throw Error(`Class "${type.name??"<unknown>"}" doesn't look like a Drizzle entity. If this is incorrect and the class is provided by Drizzle, please report this as a bug.`);let cls=Object.getPrototypeOf(value).constructor;if(cls)while(cls){if(entityKind in cls&&cls[entityKind]===type[entityKind])return!0;cls=Object.getPrototypeOf(cls)}return!1}class ConsoleLogWriter{static[entityKind]="ConsoleLogWriter";write(message){console.log(message)}}class DefaultLogger{static[entityKind]="DefaultLogger";writer;constructor(config){this.writer=config?.writer??new ConsoleLogWriter}logQuery(query,params){let stringifiedParams=params.map((p)=>{try{return JSON.stringify(p)}catch{return String(p)}}),paramsStr=stringifiedParams.length?` -- params: [${stringifiedParams.join(", ")}]`:"";this.writer.write(`Query: ${query}${paramsStr}`)}}class NoopLogger{static[entityKind]="NoopLogger";logQuery(){}}class QueryPromise{static[entityKind]="QueryPromise";[Symbol.toStringTag]="QueryPromise";catch(onRejected){return this.then(void 0,onRejected)}finally(onFinally){return this.then((value)=>{return onFinally?.(),value},(reason)=>{throw onFinally?.(),reason})}then(onFulfilled,onRejected){return this.execute().then(onFulfilled,onRejected)}}class Column{constructor(table,config){this.table=table,this.config=config,this.name=config.name,this.keyAsName=config.keyAsName,this.notNull=config.notNull,this.default=config.default,this.defaultFn=config.defaultFn,this.onUpdateFn=config.onUpdateFn,this.hasDefault=config.hasDefault,this.primary=config.primaryKey,this.isUnique=config.isUnique,this.uniqueName=config.uniqueName,this.uniqueType=config.uniqueType,this.dataType=config.dataType,this.columnType=config.columnType,this.generated=config.generated,this.generatedIdentity=config.generatedIdentity}static[entityKind]="Column";name;keyAsName;primary;notNull;default;defaultFn;onUpdateFn;hasDefault;isUnique;uniqueName;uniqueType;dataType;columnType;enumValues=void 0;generated=void 0;generatedIdentity=void 0;config;mapFromDriverValue(value){return value}mapToDriverValue(value){return value}shouldDisableInsert(){return this.config.generated!==void 0&&this.config.generated.type!=="byDefault"}}class ColumnBuilder{static[entityKind]="ColumnBuilder";config;constructor(name,dataType,columnType){this.config={name,keyAsName:name==="",notNull:!1,default:void 0,hasDefault:!1,primaryKey:!1,isUnique:!1,uniqueName:void 0,uniqueType:void 0,dataType,columnType,generated:void 0}}$type(){return this}notNull(){return this.config.notNull=!0,this}default(value){return this.config.default=value,this.config.hasDefault=!0,this}$defaultFn(fn){return this.config.defaultFn=fn,this.config.hasDefault=!0,this}$default=this.$defaultFn;$onUpdateFn(fn){return this.config.onUpdateFn=fn,this.config.hasDefault=!0,this}$onUpdate=this.$onUpdateFn;primaryKey(){return this.config.primaryKey=!0,this.config.notNull=!0,this}setName(name){if(this.config.name!=="")return;this.config.name=name}}var TableName=Symbol.for("drizzle:Name");class ForeignKeyBuilder{static[entityKind]="PgForeignKeyBuilder";reference;_onUpdate="no action";_onDelete="no action";constructor(config,actions){if(this.reference=()=>{let{name,columns,foreignColumns}=config();return{name,columns,foreignTable:foreignColumns[0].table,foreignColumns}},actions)this._onUpdate=actions.onUpdate,this._onDelete=actions.onDelete}onUpdate(action){return this._onUpdate=action===void 0?"no action":action,this}onDelete(action){return this._onDelete=action===void 0?"no action":action,this}build(table){return new ForeignKey(table,this)}}class ForeignKey{constructor(table,builder){this.table=table,this.reference=builder.reference,this.onUpdate=builder._onUpdate,this.onDelete=builder._onDelete}static[entityKind]="PgForeignKey";reference;onUpdate;onDelete;getName(){let{name,columns,foreignColumns}=this.reference(),columnNames=columns.map((column)=>column.name),foreignColumnNames=foreignColumns.map((column)=>column.name),chunks=[this.table[TableName],...columnNames,foreignColumns[0].table[TableName],...foreignColumnNames];return name??`${chunks.join("_")}_fk`}}function iife(fn,...args){return fn(...args)}function unique(name){return new UniqueOnConstraintBuilder(name)}function uniqueKeyName(table,columns){return`${table[TableName]}_${columns.join("_")}_unique`}class UniqueConstraintBuilder{constructor(columns,name){this.name=name,this.columns=columns}static[entityKind]="PgUniqueConstraintBuilder";columns;nullsNotDistinctConfig=!1;nullsNotDistinct(){return this.nullsNotDistinctConfig=!0,this}build(table){return new UniqueConstraint(table,this.columns,this.nullsNotDistinctConfig,this.name)}}class UniqueOnConstraintBuilder{static[entityKind]="PgUniqueOnConstraintBuilder";name;constructor(name){this.name=name}on(...columns){return new UniqueConstraintBuilder(columns,this.name)}}class UniqueConstraint{constructor(table,columns,nullsNotDistinct,name){this.table=table,this.columns=columns,this.name=name??uniqueKeyName(this.table,this.columns.map((column)=>column.name)),this.nullsNotDistinct=nullsNotDistinct}static[entityKind]="PgUniqueConstraint";columns;name;nullsNotDistinct=!1;getName(){return this.name}}function parsePgArrayValue(arrayString,startFrom,inQuotes){for(let i=startFrom;i<arrayString.length;i++){let char=arrayString[i];if(char==="\\"){i++;continue}if(char==='"')return[arrayString.slice(startFrom,i).replace(/\\/g,""),i+1];if(inQuotes)continue;if(char===","||char==="}")return[arrayString.slice(startFrom,i).replace(/\\/g,""),i]}return[arrayString.slice(startFrom).replace(/\\/g,""),arrayString.length]}function parsePgNestedArray(arrayString,startFrom=0){let result=[],i=startFrom,lastCharIsComma=!1;while(i<arrayString.length){let char=arrayString[i];if(char===","){if(lastCharIsComma||i===startFrom)result.push("");lastCharIsComma=!0,i++;continue}if(lastCharIsComma=!1,char==="\\"){i+=2;continue}if(char==='"'){let[value2,startFrom2]=parsePgArrayValue(arrayString,i+1,!0);result.push(value2),i=startFrom2;continue}if(char==="}")return[result,i+1];if(char==="{"){let[value2,startFrom2]=parsePgNestedArray(arrayString,i+1);result.push(value2),i=startFrom2;continue}let[value,newStartFrom]=parsePgArrayValue(arrayString,i,!1);result.push(value),i=newStartFrom}return[result,i]}function parsePgArray(arrayString){let[result]=parsePgNestedArray(arrayString,1);return result}function makePgArray(array){return`{${array.map((item)=>{if(Array.isArray(item))return makePgArray(item);if(typeof item==="string")return`"${item.replace(/\\/g,"\\\\").replace(/"/g,"\\\"")}"`;return`${item}`}).join(",")}}`}class PgColumnBuilder extends ColumnBuilder{foreignKeyConfigs=[];static[entityKind]="PgColumnBuilder";array(size){return new PgArrayBuilder(this.config.name,this,size)}references(ref,actions={}){return this.foreignKeyConfigs.push({ref,actions}),this}unique(name,config){return this.config.isUnique=!0,this.config.uniqueName=name,this.config.uniqueType=config?.nulls,this}generatedAlwaysAs(as){return this.config.generated={as,type:"always",mode:"stored"},this}buildForeignKeys(column,table){return this.foreignKeyConfigs.map(({ref,actions})=>{return iife((ref2,actions2)=>{let builder=new ForeignKeyBuilder(()=>{let foreignColumn=ref2();return{columns:[column],foreignColumns:[foreignColumn]}});if(actions2.onUpdate)builder.onUpdate(actions2.onUpdate);if(actions2.onDelete)builder.onDelete(actions2.onDelete);return builder.build(table)},ref,actions)})}buildExtraConfigColumn(table){return new ExtraConfigColumn(table,this.config)}}class PgColumn extends Column{constructor(table,config){if(!config.uniqueName)config.uniqueName=uniqueKeyName(table,[config.name]);super(table,config);this.table=table}static[entityKind]="PgColumn"}class ExtraConfigColumn extends PgColumn{static[entityKind]="ExtraConfigColumn";getSQLType(){return this.getSQLType()}indexConfig={order:this.config.order??"asc",nulls:this.config.nulls??"last",opClass:this.config.opClass};defaultConfig={order:"asc",nulls:"last",opClass:void 0};asc(){return this.indexConfig.order="asc",this}desc(){return this.indexConfig.order="desc",this}nullsFirst(){return this.indexConfig.nulls="first",this}nullsLast(){return this.indexConfig.nulls="last",this}op(opClass){return this.indexConfig.opClass=opClass,this}}class IndexedColumn{static[entityKind]="IndexedColumn";constructor(name,keyAsName,type,indexConfig){this.name=name,this.keyAsName=keyAsName,this.type=type,this.indexConfig=indexConfig}name;keyAsName;type;indexConfig}class PgArrayBuilder extends PgColumnBuilder{static[entityKind]="PgArrayBuilder";constructor(name,baseBuilder,size){super(name,"array","PgArray");this.config.baseBuilder=baseBuilder,this.config.size=size}build(table){let baseColumn=this.config.baseBuilder.build(table);return new PgArray(table,this.config,baseColumn)}}class PgArray extends PgColumn{constructor(table,config,baseColumn,range){super(table,config);this.baseColumn=baseColumn,this.range=range,this.size=config.size}size;static[entityKind]="PgArray";getSQLType(){return`${this.baseColumn.getSQLType()}[${typeof this.size==="number"?this.size:""}]`}mapFromDriverValue(value){if(typeof value==="string")value=parsePgArray(value);return value.map((v)=>this.baseColumn.mapFromDriverValue(v))}mapToDriverValue(value,isNestedArray=!1){let a12=value.map((v)=>v===null?null:is(this.baseColumn,PgArray)?this.baseColumn.mapToDriverValue(v,!0):this.baseColumn.mapToDriverValue(v));if(isNestedArray)return a12;return makePgArray(a12)}}class PgEnumObjectColumnBuilder extends PgColumnBuilder{static[entityKind]="PgEnumObjectColumnBuilder";constructor(name,enumInstance){super(name,"string","PgEnumObjectColumn");this.config.enum=enumInstance}build(table){return new PgEnumObjectColumn(table,this.config)}}class PgEnumObjectColumn extends PgColumn{static[entityKind]="PgEnumObjectColumn";enum;enumValues=this.config.enum.enumValues;constructor(table,config){super(table,config);this.enum=config.enum}getSQLType(){return this.enum.enumName}}var isPgEnumSym=Symbol.for("drizzle:isPgEnum");function isPgEnum(obj){return!!obj&&typeof obj==="function"&&isPgEnumSym in obj&&obj[isPgEnumSym]===!0}class PgEnumColumnBuilder extends PgColumnBuilder{static[entityKind]="PgEnumColumnBuilder";constructor(name,enumInstance){super(name,"string","PgEnumColumn");this.config.enum=enumInstance}build(table){return new PgEnumColumn(table,this.config)}}class PgEnumColumn extends PgColumn{static[entityKind]="PgEnumColumn";enum=this.config.enum;enumValues=this.config.enum.enumValues;constructor(table,config){super(table,config);this.enum=config.enum}getSQLType(){return this.enum.enumName}}function pgEnum(enumName,input){return Array.isArray(input)?pgEnumWithSchema(enumName,[...input],void 0):pgEnumObjectWithSchema(enumName,input,void 0)}function pgEnumWithSchema(enumName,values2,schema){let enumInstance=Object.assign((name)=>new PgEnumColumnBuilder(name??"",enumInstance),{enumName,enumValues:values2,schema,[isPgEnumSym]:!0});return enumInstance}function pgEnumObjectWithSchema(enumName,values2,schema){let enumInstance=Object.assign((name)=>new PgEnumObjectColumnBuilder(name??"",enumInstance),{enumName,enumValues:Object.values(values2),schema,[isPgEnumSym]:!0});return enumInstance}class Subquery{static[entityKind]="Subquery";constructor(sql,fields,alias,isWith=!1,usedTables=[]){this._={brand:"Subquery",sql,selectedFields:fields,alias,isWith,usedTables}}}class WithSubquery extends Subquery{static[entityKind]="WithSubquery"}var version="0.44.7";var otel,rawTracer,tracer={startActiveSpan(name,fn){if(!otel)return fn();if(!rawTracer)rawTracer=otel.trace.getTracer("drizzle-orm",version);return iife((otel2,rawTracer2)=>rawTracer2.startActiveSpan(name,(span)=>{try{return fn(span)}catch(e){throw span.setStatus({code:otel2.SpanStatusCode.ERROR,message:e instanceof Error?e.message:"Unknown error"}),e}finally{span.end()}}),otel,rawTracer)}};var ViewBaseConfig=Symbol.for("drizzle:ViewBaseConfig");var Schema=Symbol.for("drizzle:Schema"),Columns=Symbol.for("drizzle:Columns"),ExtraConfigColumns=Symbol.for("drizzle:ExtraConfigColumns"),OriginalName=Symbol.for("drizzle:OriginalName"),BaseName=Symbol.for("drizzle:BaseName"),IsAlias=Symbol.for("drizzle:IsAlias"),ExtraConfigBuilder=Symbol.for("drizzle:ExtraConfigBuilder"),IsDrizzleTable=Symbol.for("drizzle:IsDrizzleTable");class Table{static[entityKind]="Table";static Symbol={Name:TableName,Schema,OriginalName,Columns,ExtraConfigColumns,BaseName,IsAlias,ExtraConfigBuilder};[TableName];[OriginalName];[Schema];[Columns];[ExtraConfigColumns];[BaseName];[IsAlias]=!1;[IsDrizzleTable]=!0;[ExtraConfigBuilder]=void 0;constructor(name,schema,baseName){this[TableName]=this[OriginalName]=name,this[Schema]=schema,this[BaseName]=baseName}}function isTable(table){return typeof table==="object"&&table!==null&&IsDrizzleTable in table}function getTableName(table){return table[TableName]}function getTableUniqueName(table){return`${table[Schema]??"public"}.${table[TableName]}`}function isSQLWrapper(value){return value!==null&&value!==void 0&&typeof value.getSQL==="function"}function mergeQueries(queries){let result={sql:"",params:[]};for(let query of queries)if(result.sql+=query.sql,result.params.push(...query.params),query.typings?.length){if(!result.typings)result.typings=[];result.typings.push(...query.typings)}return result}class StringChunk{static[entityKind]="StringChunk";value;constructor(value){this.value=Array.isArray(value)?value:[value]}getSQL(){return new SQL([this])}}class SQL{constructor(queryChunks){this.queryChunks=queryChunks;for(let chunk of queryChunks)if(is(chunk,Table)){let schemaName=chunk[Table.Symbol.Schema];this.usedTables.push(schemaName===void 0?chunk[Table.Symbol.Name]:schemaName+"."+chunk[Table.Symbol.Name])}}static[entityKind]="SQL";decoder=noopDecoder;shouldInlineParams=!1;usedTables=[];append(query){return this.queryChunks.push(...query.queryChunks),this}toQuery(config){return tracer.startActiveSpan("drizzle.buildSQL",(span)=>{let query=this.buildQueryFromSourceParams(this.queryChunks,config);return span?.setAttributes({"drizzle.query.text":query.sql,"drizzle.query.params":JSON.stringify(query.params)}),query})}buildQueryFromSourceParams(chunks,_config){let config=Object.assign({},_config,{inlineParams:_config.inlineParams||this.shouldInlineParams,paramStartIndex:_config.paramStartIndex||{value:0}}),{casing,escapeName,escapeParam,prepareTyping,inlineParams,paramStartIndex}=config;return mergeQueries(chunks.map((chunk)=>{if(is(chunk,StringChunk))return{sql:chunk.value.join(""),params:[]};if(is(chunk,Name))return{sql:escapeName(chunk.value),params:[]};if(chunk===void 0)return{sql:"",params:[]};if(Array.isArray(chunk)){let result=[new StringChunk("(")];for(let[i,p]of chunk.entries())if(result.push(p),i<chunk.length-1)result.push(new StringChunk(", "));return result.push(new StringChunk(")")),this.buildQueryFromSourceParams(result,config)}if(is(chunk,SQL))return this.buildQueryFromSourceParams(chunk.queryChunks,{...config,inlineParams:inlineParams||chunk.shouldInlineParams});if(is(chunk,Table)){let schemaName=chunk[Table.Symbol.Schema],tableName=chunk[Table.Symbol.Name];return{sql:schemaName===void 0||chunk[IsAlias]?escapeName(tableName):escapeName(schemaName)+"."+escapeName(tableName),params:[]}}if(is(chunk,Column)){let columnName=casing.getColumnCasing(chunk);if(_config.invokeSource==="indexes")return{sql:escapeName(columnName),params:[]};let schemaName=chunk.table[Table.Symbol.Schema];return{sql:chunk.table[IsAlias]||schemaName===void 0?escapeName(chunk.table[Table.Symbol.Name])+"."+escapeName(columnName):escapeName(schemaName)+"."+escapeName(chunk.table[Table.Symbol.Name])+"."+escapeName(columnName),params:[]}}if(is(chunk,View)){let schemaName=chunk[ViewBaseConfig].schema,viewName=chunk[ViewBaseConfig].name;return{sql:schemaName===void 0||chunk[ViewBaseConfig].isAlias?escapeName(viewName):escapeName(schemaName)+"."+escapeName(viewName),params:[]}}if(is(chunk,Param)){if(is(chunk.value,Placeholder))return{sql:escapeParam(paramStartIndex.value++,chunk),params:[chunk],typings:["none"]};let mappedValue=chunk.value===null?null:chunk.encoder.mapToDriverValue(chunk.value);if(is(mappedValue,SQL))return this.buildQueryFromSourceParams([mappedValue],config);if(inlineParams)return{sql:this.mapInlineParam(mappedValue,config),params:[]};let typings=["none"];if(prepareTyping)typings=[prepareTyping(chunk.encoder)];return{sql:escapeParam(paramStartIndex.value++,mappedValue),params:[mappedValue],typings}}if(is(chunk,Placeholder))return{sql:escapeParam(paramStartIndex.value++,chunk),params:[chunk],typings:["none"]};if(is(chunk,SQL.Aliased)&&chunk.fieldAlias!==void 0)return{sql:escapeName(chunk.fieldAlias),params:[]};if(is(chunk,Subquery)){if(chunk._.isWith)return{sql:escapeName(chunk._.alias),params:[]};return this.buildQueryFromSourceParams([new StringChunk("("),chunk._.sql,new StringChunk(") "),new Name(chunk._.alias)],config)}if(isPgEnum(chunk)){if(chunk.schema)return{sql:escapeName(chunk.schema)+"."+escapeName(chunk.enumName),params:[]};return{sql:escapeName(chunk.enumName),params:[]}}if(isSQLWrapper(chunk)){if(chunk.shouldOmitSQLParens?.())return this.buildQueryFromSourceParams([chunk.getSQL()],config);return this.buildQueryFromSourceParams([new StringChunk("("),chunk.getSQL(),new StringChunk(")")],config)}if(inlineParams)return{sql:this.mapInlineParam(chunk,config),params:[]};return{sql:escapeParam(paramStartIndex.value++,chunk),params:[chunk],typings:["none"]}}))}mapInlineParam(chunk,{escapeString}){if(chunk===null)return"null";if(typeof chunk==="number"||typeof chunk==="boolean")return chunk.toString();if(typeof chunk==="string")return escapeString(chunk);if(typeof chunk==="object"){let mappedValueAsString=chunk.toString();if(mappedValueAsString==="[object Object]")return escapeString(JSON.stringify(chunk));return escapeString(mappedValueAsString)}throw Error("Unexpected param value: "+chunk)}getSQL(){return this}as(alias){if(alias===void 0)return this;return new SQL.Aliased(this,alias)}mapWith(decoder){return this.decoder=typeof decoder==="function"?{mapFromDriverValue:decoder}:decoder,this}inlineParams(){return this.shouldInlineParams=!0,this}if(condition){return condition?this:void 0}}class Name{constructor(value){this.value=value}static[entityKind]="Name";brand;getSQL(){return new SQL([this])}}function isDriverValueEncoder(value){return typeof value==="object"&&value!==null&&"mapToDriverValue"in value&&typeof value.mapToDriverValue==="function"}var noopDecoder={mapFromDriverValue:(value)=>value},noopEncoder={mapToDriverValue:(value)=>value},noopMapper={...noopDecoder,...noopEncoder};class Param{constructor(value,encoder2=noopEncoder){this.value=value,this.encoder=encoder2}static[entityKind]="Param";brand;getSQL(){return new SQL([this])}}function sql(strings,...params){let queryChunks=[];if(params.length>0||strings.length>0&&strings[0]!=="")queryChunks.push(new StringChunk(strings[0]));for(let[paramIndex,param2]of params.entries())queryChunks.push(param2,new StringChunk(strings[paramIndex+1]));return new SQL(queryChunks)}((sql2)=>{function empty(){return new SQL([])}sql2.empty=empty;function fromList(list){return new SQL(list)}sql2.fromList=fromList;function raw(str){return new SQL([new StringChunk(str)])}sql2.raw=raw;function join(chunks,separator){let result=[];for(let[i,chunk]of chunks.entries()){if(i>0&&separator!==void 0)result.push(separator);result.push(chunk)}return new SQL(result)}sql2.join=join;function identifier(value){return new Name(value)}sql2.identifier=identifier;function placeholder2(name2){return new Placeholder(name2)}sql2.placeholder=placeholder2;function param2(value,encoder2){return new Param(value,encoder2)}sql2.param=param2})(sql||(sql={}));((SQL2)=>{class Aliased{constructor(sql2,fieldAlias){this.sql=sql2,this.fieldAlias=fieldAlias}static[entityKind]="SQL.Aliased";isSelectionField=!1;getSQL(){return this.sql}clone(){return new Aliased(this.sql,this.fieldAlias)}}SQL2.Aliased=Aliased})(SQL||(SQL={}));class Placeholder{constructor(name2){this.name=name2}static[entityKind]="Placeholder";getSQL(){return new SQL([this])}}function fillPlaceholders(params,values2){return params.map((p)=>{if(is(p,Placeholder)){if(!(p.name in values2))throw Error(`No value for placeholder "${p.name}" was provided`);return values2[p.name]}if(is(p,Param)&&is(p.value,Placeholder)){if(!(p.value.name in values2))throw Error(`No value for placeholder "${p.value.name}" was provided`);return p.encoder.mapToDriverValue(values2[p.value.name])}return p})}var IsDrizzleView=Symbol.for("drizzle:IsDrizzleView");class View{static[entityKind]="View";[ViewBaseConfig];[IsDrizzleView]=!0;constructor({name:name2,schema,selectedFields,query}){this[ViewBaseConfig]={name:name2,originalName:name2,schema,selectedFields,query,isExisting:!query,isAlias:!1}}getSQL(){return new SQL([this])}}function isView(view){return typeof view==="object"&&view!==null&&IsDrizzleView in view}Column.prototype.getSQL=function(){return new SQL([this])};Table.prototype.getSQL=function(){return new SQL([this])};Subquery.prototype.getSQL=function(){return new SQL([this])};class ColumnAliasProxyHandler{constructor(table){this.table=table}static[entityKind]="ColumnAliasProxyHandler";get(columnObj,prop){if(prop==="table")return this.table;return columnObj[prop]}}class TableAliasProxyHandler{constructor(alias,replaceOriginalName){this.alias=alias,this.replaceOriginalName=replaceOriginalName}static[entityKind]="TableAliasProxyHandler";get(target,prop){if(prop===Table.Symbol.IsAlias)return!0;if(prop===Table.Symbol.Name)return this.alias;if(this.replaceOriginalName&&prop===Table.Symbol.OriginalName)return this.alias;if(prop===ViewBaseConfig)return{...target[ViewBaseConfig],name:this.alias,isAlias:!0};if(prop===Table.Symbol.Columns){let columns=target[Table.Symbol.Columns];if(!columns)return columns;let proxiedColumns={};return Object.keys(columns).map((key)=>{proxiedColumns[key]=new Proxy(columns[key],new ColumnAliasProxyHandler(new Proxy(target,this)))}),proxiedColumns}let value=target[prop];if(is(value,Column))return new Proxy(value,new ColumnAliasProxyHandler(new Proxy(target,this)));return value}}function aliasedTable(table,tableAlias){return new Proxy(table,new TableAliasProxyHandler(tableAlias,!1))}function aliasedTableColumn(column,tableAlias){return new Proxy(column,new ColumnAliasProxyHandler(new Proxy(column.table,new TableAliasProxyHandler(tableAlias,!1))))}function mapColumnsInAliasedSQLToAlias(query,alias){return new SQL.Aliased(mapColumnsInSQLToAlias(query.sql,alias),query.fieldAlias)}function mapColumnsInSQLToAlias(query,alias){return sql.join(query.queryChunks.map((c)=>{if(is(c,Column))return aliasedTableColumn(c,alias);if(is(c,SQL))return mapColumnsInSQLToAlias(c,alias);if(is(c,SQL.Aliased))return mapColumnsInAliasedSQLToAlias(c,alias);return c}))}class SelectionProxyHandler{static[entityKind]="SelectionProxyHandler";config;constructor(config){this.config={...config}}get(subquery,prop){if(prop==="_")return{...subquery._,selectedFields:new Proxy(subquery._.selectedFields,this)};if(prop===ViewBaseConfig)return{...subquery[ViewBaseConfig],selectedFields:new Proxy(subquery[ViewBaseConfig].selectedFields,this)};if(typeof prop==="symbol")return subquery[prop];let value=(is(subquery,Subquery)?subquery._.selectedFields:is(subquery,View)?subquery[ViewBaseConfig].selectedFields:subquery)[prop];if(is(value,SQL.Aliased)){if(this.config.sqlAliasedBehavior==="sql"&&!value.isSelectionField)return value.sql;let newValue=value.clone();return newValue.isSelectionField=!0,newValue}if(is(value,SQL)){if(this.config.sqlBehavior==="sql")return value;throw Error(`You tried to reference "${prop}" field from a subquery, which is a raw SQL field, but it doesn't have an alias declared. Please add an alias to the field using ".as('alias')" method.`)}if(is(value,Column)){if(this.config.alias)return new Proxy(value,new ColumnAliasProxyHandler(new Proxy(value.table,new TableAliasProxyHandler(this.config.alias,this.config.replaceOriginalName??!1))));return value}if(typeof value!=="object"||value===null)return value;return new Proxy(value,new SelectionProxyHandler(this.config))}}function mapResultRow(columns,row,joinsNotNullableMap){let nullifyMap={},result=columns.reduce((result2,{path,field},columnIndex)=>{let decoder;if(is(field,Column))decoder=field;else if(is(field,SQL))decoder=field.decoder;else decoder=field.sql.decoder;let node=result2;for(let[pathChunkIndex,pathChunk]of path.entries())if(pathChunkIndex<path.length-1){if(!(pathChunk in node))node[pathChunk]={};node=node[pathChunk]}else{let rawValue=row[columnIndex],value=node[pathChunk]=rawValue===null?null:decoder.mapFromDriverValue(rawValue);if(joinsNotNullableMap&&is(field,Column)&&path.length===2){let objectName=path[0];if(!(objectName in nullifyMap))nullifyMap[objectName]=value===null?getTableName(field.table):!1;else if(typeof nullifyMap[objectName]==="string"&&nullifyMap[objectName]!==getTableName(field.table))nullifyMap[objectName]=!1}}return result2},{});if(joinsNotNullableMap&&Object.keys(nullifyMap).length>0){for(let[objectName,tableName]of Object.entries(nullifyMap))if(typeof tableName==="string"&&!joinsNotNullableMap[tableName])result[objectName]=null}return result}function orderSelectedFields(fields,pathPrefix){return Object.entries(fields).reduce((result,[name,field])=>{if(typeof name!=="string")return result;let newPath=pathPrefix?[...pathPrefix,name]:[name];if(is(field,Column)||is(field,SQL)||is(field,SQL.Aliased))result.push({path:newPath,field});else if(is(field,Table))result.push(...orderSelectedFields(field[Table.Symbol.Columns],newPath));else result.push(...orderSelectedFields(field,newPath));return result},[])}function haveSameKeys(left,right){let leftKeys=Object.keys(left),rightKeys=Object.keys(right);if(leftKeys.length!==rightKeys.length)return!1;for(let[index,key]of leftKeys.entries())if(key!==rightKeys[index])return!1;return!0}function mapUpdateSet(table,values2){let entries=Object.entries(values2).filter(([,value])=>value!==void 0).map(([key,value])=>{if(is(value,SQL)||is(value,Column))return[key,value];else return[key,new Param(value,table[Table.Symbol.Columns][key])]});if(entries.length===0)throw Error("No values to set");return Object.fromEntries(entries)}function applyMixins(baseClass,extendedClasses){for(let extendedClass of extendedClasses)for(let name of Object.getOwnPropertyNames(extendedClass.prototype)){if(name==="constructor")continue;Object.defineProperty(baseClass.prototype,name,Object.getOwnPropertyDescriptor(extendedClass.prototype,name)||Object.create(null))}}function getTableColumns(table){return table[Table.Symbol.Columns]}function getViewSelectedFields(view){return view[ViewBaseConfig].selectedFields}function getTableLikeName(table){return is(table,Subquery)?table._.alias:is(table,View)?table[ViewBaseConfig].name:is(table,SQL)?void 0:table[Table.Symbol.IsAlias]?table[Table.Symbol.Name]:table[Table.Symbol.BaseName]}function getColumnNameAndConfig(a12,b2){return{name:typeof a12==="string"&&a12.length>0?a12:"",config:typeof a12==="object"?a12:b2}}function isConfig(data){if(typeof data!=="object"||data===null)return!1;if(data.constructor.name!=="Object")return!1;if("logger"in data){let type=typeof data.logger;if(type!=="boolean"&&(type!=="object"||typeof data.logger.logQuery!=="function")&&type!=="undefined")return!1;return!0}if("schema"in data){let type=typeof data.schema;if(type!=="object"&&type!=="undefined")return!1;return!0}if("casing"in data){let type=typeof data.casing;if(type!=="string"&&type!=="undefined")return!1;return!0}if("mode"in data){if(data.mode!=="default"||data.mode!=="planetscale"||data.mode!==void 0)return!1;return!0}if("connection"in data){let type=typeof data.connection;if(type!=="string"&&type!=="object"&&type!=="undefined")return!1;return!0}if("client"in data){let type=typeof data.client;if(type!=="object"&&type!=="function"&&type!=="undefined")return!1;return!0}if(Object.keys(data).length===0)return!0;return!1}class PgIntColumnBaseBuilder extends PgColumnBuilder{static[entityKind]="PgIntColumnBaseBuilder";generatedAlwaysAsIdentity(sequence){if(sequence){let{name,...options}=sequence;this.config.generatedIdentity={type:"always",sequenceName:name,sequenceOptions:options}}else this.config.generatedIdentity={type:"always"};return this.config.hasDefault=!0,this.config.notNull=!0,this}generatedByDefaultAsIdentity(sequence){if(sequence){let{name,...options}=sequence;this.config.generatedIdentity={type:"byDefault",sequenceName:name,sequenceOptions:options}}else this.config.generatedIdentity={type:"byDefault"};return this.config.hasDefault=!0,this.config.notNull=!0,this}}class PgBigInt53Builder extends PgIntColumnBaseBuilder{static[entityKind]="PgBigInt53Builder";constructor(name){super(name,"number","PgBigInt53")}build(table){return new PgBigInt53(table,this.config)}}class PgBigInt53 extends PgColumn{static[entityKind]="PgBigInt53";getSQLType(){return"bigint"}mapFromDriverValue(value){if(typeof value==="number")return value;return Number(value)}}class PgBigInt64Builder extends PgIntColumnBaseBuilder{static[entityKind]="PgBigInt64Builder";constructor(name){super(name,"bigint","PgBigInt64")}build(table){return new PgBigInt64(table,this.config)}}class PgBigInt64 extends PgColumn{static[entityKind]="PgBigInt64";getSQLType(){return"bigint"}mapFromDriverValue(value){return BigInt(value)}}function bigint(a12,b2){let{name,config}=getColumnNameAndConfig(a12,b2);if(config.mode==="number")return new PgBigInt53Builder(name);return new PgBigInt64Builder(name)}class PgBigSerial53Builder extends PgColumnBuilder{static[entityKind]="PgBigSerial53Builder";constructor(name){super(name,"number","PgBigSerial53");this.config.hasDefault=!0,this.config.notNull=!0}build(table){return new PgBigSerial53(table,this.config)}}class PgBigSerial53 extends PgColumn{static[entityKind]="PgBigSerial53";getSQLType(){return"bigserial"}mapFromDriverValue(value){if(typeof value==="number")return value;return Number(value)}}class PgBigSerial64Builder extends PgColumnBuilder{static[entityKind]="PgBigSerial64Builder";constructor(name){super(name,"bigint","PgBigSerial64");this.config.hasDefault=!0}build(table){return new PgBigSerial64(table,this.config)}}class PgBigSerial64 extends PgColumn{static[entityKind]="PgBigSerial64";getSQLType(){return"bigserial"}mapFromDriverValue(value){return BigInt(value)}}function bigserial(a12,b2){let{name,config}=getColumnNameAndConfig(a12,b2);if(config.mode==="number")return new PgBigSerial53Builder(name);return new PgBigSerial64Builder(name)}class PgBooleanBuilder extends PgColumnBuilder{static[entityKind]="PgBooleanBuilder";constructor(name){super(name,"boolean","PgBoolean")}build(table){return new PgBoolean(table,this.config)}}class PgBoolean extends PgColumn{static[entityKind]="PgBoolean";getSQLType(){return"boolean"}}function boolean(name){return new PgBooleanBuilder(name??"")}class PgCharBuilder extends PgColumnBuilder{static[entityKind]="PgCharBuilder";constructor(name,config){super(name,"string","PgChar");this.config.length=config.length,this.config.enumValues=config.enum}build(table){return new PgChar(table,this.config)}}class PgChar extends PgColumn{static[entityKind]="PgChar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"char":`char(${this.length})`}}function char(a12,b2={}){let{name,config}=getColumnNameAndConfig(a12,b2);return new PgCharBuilder(name,config)}class PgCidrBuilder extends PgColumnBuilder{static[entityKind]="PgCidrBuilder";constructor(name){super(name,"string","PgCidr")}build(table){return new PgCidr(table,this.config)}}class PgCidr extends PgColumn{static[entityKind]="PgCidr";getSQLType(){return"cidr"}}function cidr(name){return new PgCidrBuilder(name??"")}class PgCustomColumnBuilder extends PgColumnBuilder{static[entityKind]="PgCustomColumnBuilder";constructor(name,fieldConfig,customTypeParams){super(name,"custom","PgCustomColumn");this.config.fieldConfig=fieldConfig,this.config.customTypeParams=customTypeParams}build(table){return new PgCustomColumn(table,this.config)}}class PgCustomColumn extends PgColumn{static[entityKind]="PgCustomColumn";sqlName;mapTo;mapFrom;constructor(table,config){super(table,config);this.sqlName=config.customTypeParams.dataType(config.fieldConfig),this.mapTo=config.customTypeParams.toDriver,this.mapFrom=config.customTypeParams.fromDriver}getSQLType(){return this.sqlName}mapFromDriverValue(value){return typeof this.mapFrom==="function"?this.mapFrom(value):value}mapToDriverValue(value){return typeof this.mapTo==="function"?this.mapTo(value):value}}function customType(customTypeParams){return(a12,b2)=>{let{name,config}=getColumnNameAndConfig(a12,b2);return new PgCustomColumnBuilder(name,config,customTypeParams)}}class PgDateColumnBaseBuilder extends PgColumnBuilder{static[entityKind]="PgDateColumnBaseBuilder";defaultNow(){return this.default(sql`now()`)}}class PgDateBuilder extends PgDateColumnBaseBuilder{static[entityKind]="PgDateBuilder";constructor(name){super(name,"date","PgDate")}build(table){return new PgDate(table,this.config)}}class PgDate extends PgColumn{static[entityKind]="PgDate";getSQLType(){return"date"}mapFromDriverValue(value){return new Date(value)}mapToDriverValue(value){return value.toISOString()}}class PgDateStringBuilder extends PgDateColumnBaseBuilder{static[entityKind]="PgDateStringBuilder";constructor(name){super(name,"string","PgDateString")}build(table){return new PgDateString(table,this.config)}}class PgDateString extends PgColumn{static[entityKind]="PgDateString";getSQLType(){return"date"}}function date2(a12,b2){let{name,config}=getColumnNameAndConfig(a12,b2);if(config?.mode==="date")return new PgDateBuilder(name);return new PgDateStringBuilder(name)}class PgDoublePrecisionBuilder extends PgColumnBuilder{static[entityKind]="PgDoublePrecisionBuilder";constructor(name){super(name,"number","PgDoublePrecision")}build(table){return new PgDoublePrecision(table,this.config)}}class PgDoublePrecision extends PgColumn{static[entityKind]="PgDoublePrecision";getSQLType(){return"double precision"}mapFromDriverValue(value){if(typeof value==="string")return Number.parseFloat(value);return value}}function doublePrecision(name){return new PgDoublePrecisionBuilder(name??"")}class PgInetBuilder extends PgColumnBuilder{static[entityKind]="PgInetBuilder";constructor(name){super(name,"string","PgInet")}build(table){return new PgInet(table,this.config)}}class PgInet extends PgColumn{static[entityKind]="PgInet";getSQLType(){return"inet"}}function inet(name){return new PgInetBuilder(name??"")}class PgIntegerBuilder extends PgIntColumnBaseBuilder{static[entityKind]="PgIntegerBuilder";constructor(name){super(name,"number","PgInteger")}build(table){return new PgInteger(table,this.config)}}class PgInteger extends PgColumn{static[entityKind]="PgInteger";getSQLType(){return"integer"}mapFromDriverValue(value){if(typeof value==="string")return Number.parseInt(value);return value}}function integer(name){return new PgIntegerBuilder(name??"")}class PgIntervalBuilder extends PgColumnBuilder{static[entityKind]="PgIntervalBuilder";constructor(name,intervalConfig){super(name,"string","PgInterval");this.config.intervalConfig=intervalConfig}build(table){return new PgInterval(table,this.config)}}class PgInterval extends PgColumn{static[entityKind]="PgInterval";fields=this.config.intervalConfig.fields;precision=this.config.intervalConfig.precision;getSQLType(){let fields=this.fields?` ${this.fields}`:"",precision=this.precision?`(${this.precision})`:"";return`interval${fields}${precision}`}}function interval(a12,b2={}){let{name,config}=getColumnNameAndConfig(a12,b2);return new PgIntervalBuilder(name,config)}class PgJsonBuilder extends PgColumnBuilder{static[entityKind]="PgJsonBuilder";constructor(name){super(name,"json","PgJson")}build(table){return new PgJson(table,this.config)}}class PgJson extends PgColumn{static[entityKind]="PgJson";constructor(table,config){super(table,config)}getSQLType(){return"json"}mapToDriverValue(value){return JSON.stringify(value)}mapFromDriverValue(value){if(typeof value==="string")try{return JSON.parse(value)}catch{return value}return value}}function json(name){return new PgJsonBuilder(name??"")}class PgJsonbBuilder extends PgColumnBuilder{static[entityKind]="PgJsonbBuilder";constructor(name){super(name,"json","PgJsonb")}build(table){return new PgJsonb(table,this.config)}}class PgJsonb extends PgColumn{static[entityKind]="PgJsonb";constructor(table,config){super(table,config)}getSQLType(){return"jsonb"}mapToDriverValue(value){return JSON.stringify(value)}mapFromDriverValue(value){if(typeof value==="string")try{return JSON.parse(value)}catch{return value}return value}}function jsonb(name){return new PgJsonbBuilder(name??"")}class PgLineBuilder extends PgColumnBuilder{static[entityKind]="PgLineBuilder";constructor(name){super(name,"array","PgLine")}build(table){return new PgLineTuple(table,this.config)}}class PgLineTuple extends PgColumn{static[entityKind]="PgLine";getSQLType(){return"line"}mapFromDriverValue(value){let[a12,b2,c]=value.slice(1,-1).split(",");return[Number.parseFloat(a12),Number.parseFloat(b2),Number.parseFloat(c)]}mapToDriverValue(value){return`{${value[0]},${value[1]},${value[2]}}`}}class PgLineABCBuilder extends PgColumnBuilder{static[entityKind]="PgLineABCBuilder";constructor(name){super(name,"json","PgLineABC")}build(table){return new PgLineABC(table,this.config)}}class PgLineABC extends PgColumn{static[entityKind]="PgLineABC";getSQLType(){return"line"}mapFromDriverValue(value){let[a12,b2,c]=value.slice(1,-1).split(",");return{a:Number.parseFloat(a12),b:Number.parseFloat(b2),c:Number.parseFloat(c)}}mapToDriverValue(value){return`{${value.a},${value.b},${value.c}}`}}function line(a12,b2){let{name,config}=getColumnNameAndConfig(a12,b2);if(!config?.mode||config.mode==="tuple")return new PgLineBuilder(name);return new PgLineABCBuilder(name)}class PgMacaddrBuilder extends PgColumnBuilder{static[entityKind]="PgMacaddrBuilder";constructor(name){super(name,"string","PgMacaddr")}build(table){return new PgMacaddr(table,this.config)}}class PgMacaddr extends PgColumn{static[entityKind]="PgMacaddr";getSQLType(){return"macaddr"}}function macaddr(name){return new PgMacaddrBuilder(name??"")}class PgMacaddr8Builder extends PgColumnBuilder{static[entityKind]="PgMacaddr8Builder";constructor(name){super(name,"string","PgMacaddr8")}build(table){return new PgMacaddr8(table,this.config)}}class PgMacaddr8 extends PgColumn{static[entityKind]="PgMacaddr8";getSQLType(){return"macaddr8"}}function macaddr8(name){return new PgMacaddr8Builder(name??"")}class PgNumericBuilder extends PgColumnBuilder{static[entityKind]="PgNumericBuilder";constructor(name,precision,scale){super(name,"string","PgNumeric");this.config.precision=precision,this.config.scale=scale}build(table){return new PgNumeric(table,this.config)}}class PgNumeric extends PgColumn{static[entityKind]="PgNumeric";precision;scale;constructor(table,config){super(table,config);this.precision=config.precision,this.scale=config.scale}mapFromDriverValue(value){if(typeof value==="string")return value;return String(value)}getSQLType(){if(this.precision!==void 0&&this.scale!==void 0)return`numeric(${this.precision}, ${this.scale})`;else if(this.precision===void 0)return"numeric";else return`numeric(${this.precision})`}}class PgNumericNumberBuilder extends PgColumnBuilder{static[entityKind]="PgNumericNumberBuilder";constructor(name,precision,scale){super(name,"number","PgNumericNumber");this.config.precision=precision,this.config.scale=scale}build(table){return new PgNumericNumber(table,this.config)}}class PgNumericNumber extends PgColumn{static[entityKind]="PgNumericNumber";precision;scale;constructor(table,config){super(table,config);this.precision=config.precision,this.scale=config.scale}mapFromDriverValue(value){if(typeof value==="number")return value;return Number(value)}mapToDriverValue=String;getSQLType(){if(this.precision!==void 0&&this.scale!==void 0)return`numeric(${this.precision}, ${this.scale})`;else if(this.precision===void 0)return"numeric";else return`numeric(${this.precision})`}}class PgNumericBigIntBuilder extends PgColumnBuilder{static[entityKind]="PgNumericBigIntBuilder";constructor(name,precision,scale){super(name,"bigint","PgNumericBigInt");this.config.precision=precision,this.config.scale=scale}build(table){return new PgNumericBigInt(table,this.config)}}class PgNumericBigInt extends PgColumn{static[entityKind]="PgNumericBigInt";precision;scale;constructor(table,config){super(table,config);this.precision=config.precision,this.scale=config.scale}mapFromDriverValue=BigInt;mapToDriverValue=String;getSQLType(){if(this.precision!==void 0&&this.scale!==void 0)return`numeric(${this.precision}, ${this.scale})`;else if(this.precision===void 0)return"numeric";else return`numeric(${this.precision})`}}function numeric(a12,b2){let{name,config}=getColumnNameAndConfig(a12,b2),mode=config?.mode;return mode==="number"?new PgNumericNumberBuilder(name,config?.precision,config?.scale):mode==="bigint"?new PgNumericBigIntBuilder(name,config?.precision,config?.scale):new PgNumericBuilder(name,config?.precision,config?.scale)}class PgPointTupleBuilder extends PgColumnBuilder{static[entityKind]="PgPointTupleBuilder";constructor(name){super(name,"array","PgPointTuple")}build(table){return new PgPointTuple(table,this.config)}}class PgPointTuple extends PgColumn{static[entityKind]="PgPointTuple";getSQLType(){return"point"}mapFromDriverValue(value){if(typeof value==="string"){let[x,y]=value.slice(1,-1).split(",");return[Number.parseFloat(x),Number.parseFloat(y)]}return[value.x,value.y]}mapToDriverValue(value){return`(${value[0]},${value[1]})`}}class PgPointObjectBuilder extends PgColumnBuilder{static[entityKind]="PgPointObjectBuilder";constructor(name){super(name,"json","PgPointObject")}build(table){return new PgPointObject(table,this.config)}}class PgPointObject extends PgColumn{static[entityKind]="PgPointObject";getSQLType(){return"point"}mapFromDriverValue(value){if(typeof value==="string"){let[x,y]=value.slice(1,-1).split(",");return{x:Number.parseFloat(x),y:Number.parseFloat(y)}}return value}mapToDriverValue(value){return`(${value.x},${value.y})`}}function point(a12,b2){let{name,config}=getColumnNameAndConfig(a12,b2);if(!config?.mode||config.mode==="tuple")return new PgPointTupleBuilder(name);return new PgPointObjectBuilder(name)}function hexToBytes(hex){let bytes=[];for(let c=0;c<hex.length;c+=2)bytes.push(Number.parseInt(hex.slice(c,c+2),16));return new Uint8Array(bytes)}function bytesToFloat64(bytes,offset){let buffer2=new ArrayBuffer(8),view=new DataView(buffer2);for(let i=0;i<8;i++)view.setUint8(i,bytes[offset+i]);return view.getFloat64(0,!0)}function parseEWKB(hex){let bytes=hexToBytes(hex),offset=0,byteOrder=bytes[offset];offset+=1;let view=new DataView(bytes.buffer),geomType=view.getUint32(offset,byteOrder===1);offset+=4;let _srid;if(geomType&536870912)_srid=view.getUint32(offset,byteOrder===1),offset+=4;if((geomType&65535)===1){let x=bytesToFloat64(bytes,offset);offset+=8;let y=bytesToFloat64(bytes,offset);return offset+=8,[x,y]}throw Error("Unsupported geometry type")}class PgGeometryBuilder extends PgColumnBuilder{static[entityKind]="PgGeometryBuilder";constructor(name){super(name,"array","PgGeometry")}build(table){return new PgGeometry(table,this.config)}}class PgGeometry extends PgColumn{static[entityKind]="PgGeometry";getSQLType(){return"geometry(point)"}mapFromDriverValue(value){return parseEWKB(value)}mapToDriverValue(value){return`point(${value[0]} ${value[1]})`}}class PgGeometryObjectBuilder extends PgColumnBuilder{static[entityKind]="PgGeometryObjectBuilder";constructor(name){super(name,"json","PgGeometryObject")}build(table){return new PgGeometryObject(table,this.config)}}class PgGeometryObject extends PgColumn{static[entityKind]="PgGeometryObject";getSQLType(){return"geometry(point)"}mapFromDriverValue(value){let parsed=parseEWKB(value);return{x:parsed[0],y:parsed[1]}}mapToDriverValue(value){return`point(${value.x} ${value.y})`}}function geometry(a12,b2){let{name,config}=getColumnNameAndConfig(a12,b2);if(!config?.mode||config.mode==="tuple")return new PgGeometryBuilder(name);return new PgGeometryObjectBuilder(name)}class PgRealBuilder extends PgColumnBuilder{static[entityKind]="PgRealBuilder";constructor(name,length){super(name,"number","PgReal");this.config.length=length}build(table){return new PgReal(table,this.config)}}class PgReal extends PgColumn{static[entityKind]="PgReal";constructor(table,config){super(table,config)}getSQLType(){return"real"}mapFromDriverValue=(value)=>{if(typeof value==="string")return Number.parseFloat(value);return value}}function real(name){return new PgRealBuilder(name??"")}class PgSerialBuilder extends PgColumnBuilder{static[entityKind]="PgSerialBuilder";constructor(name){super(name,"number","PgSerial");this.config.hasDefault=!0,this.config.notNull=!0}build(table){return new PgSerial(table,this.config)}}class PgSerial extends PgColumn{static[entityKind]="PgSerial";getSQLType(){return"serial"}}function serial(name){return new PgSerialBuilder(name??"")}class PgSmallIntBuilder extends PgIntColumnBaseBuilder{static[entityKind]="PgSmallIntBuilder";constructor(name){super(name,"number","PgSmallInt")}build(table){return new PgSmallInt(table,this.config)}}class PgSmallInt extends PgColumn{static[entityKind]="PgSmallInt";getSQLType(){return"smallint"}mapFromDriverValue=(value)=>{if(typeof value==="string")return Number(value);return value}}function smallint(name){return new PgSmallIntBuilder(name??"")}class PgSmallSerialBuilder extends PgColumnBuilder{static[entityKind]="PgSmallSerialBuilder";constructor(name){super(name,"number","PgSmallSerial");this.config.hasDefault=!0,this.config.notNull=!0}build(table){return new PgSmallSerial(table,this.config)}}class PgSmallSerial extends PgColumn{static[entityKind]="PgSmallSerial";getSQLType(){return"smallserial"}}function smallserial(name){return new PgSmallSerialBuilder(name??"")}class PgTextBuilder extends PgColumnBuilder{static[entityKind]="PgTextBuilder";constructor(name,config){super(name,"string","PgText");this.config.enumValues=config.enum}build(table){return new PgText(table,this.config)}}class PgText extends PgColumn{static[entityKind]="PgText";enumValues=this.config.enumValues;getSQLType(){return"text"}}function text(a12,b2={}){let{name,config}=getColumnNameAndConfig(a12,b2);return new PgTextBuilder(name,config)}class PgTimeBuilder extends PgDateColumnBaseBuilder{constructor(name,withTimezone,precision){super(name,"string","PgTime");this.withTimezone=withTimezone,this.precision=precision,this.config.withTimezone=withTimezone,this.config.precision=precision}static[entityKind]="PgTimeBuilder";build(table){return new PgTime(table,this.config)}}class PgTime extends PgColumn{static[entityKind]="PgTime";withTimezone;precision;constructor(table,config){super(table,config);this.withTimezone=config.withTimezone,this.precision=config.precision}getSQLType(){return`time${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}}function time(a12,b2={}){let{name,config}=getColumnNameAndConfig(a12,b2);return new PgTimeBuilder(name,config.withTimezone??!1,config.precision)}class PgTimestampBuilder extends PgDateColumnBaseBuilder{static[entityKind]="PgTimestampBuilder";constructor(name,withTimezone,precision){super(name,"date","PgTimestamp");this.config.withTimezone=withTimezone,this.config.precision=precision}build(table){return new PgTimestamp(table,this.config)}}class PgTimestamp extends PgColumn{static[entityKind]="PgTimestamp";withTimezone;precision;constructor(table,config){super(table,config);this.withTimezone=config.withTimezone,this.precision=config.precision}getSQLType(){return`timestamp${this.precision===void 0?"":` (${this.precision})`}${this.withTimezone?" with time zone":""}`}mapFromDriverValue=(value)=>{return new Date(this.withTimezone?value:value+"+0000")};mapToDriverValue=(value)=>{return value.toISOString()}}class PgTimestampStringBuilder extends PgDateColumnBaseBuilder{static[entityKind]="PgTimestampStringBuilder";constructor(name,withTimezone,precision){super(name,"string","PgTimestampString");this.config.withTimezone=withTimezone,this.config.precision=precision}build(table){return new PgTimestampString(table,this.config)}}class PgTimestampString extends PgColumn{static[entityKind]="PgTimestampString";withTimezone;precision;constructor(table,config){super(table,config);this.withTimezone=config.withTimezone,this.precision=config.precision}getSQLType(){return`timestamp${this.precision===void 0?"":`(${this.precision})`}${this.withTimezone?" with time zone":""}`}}function timestamp(a12,b2={}){let{name,config}=getColumnNameAndConfig(a12,b2);if(config?.mode==="string")return new PgTimestampStringBuilder(name,config.withTimezone??!1,config.precision);return new PgTimestampBuilder(name,config?.withTimezone??!1,config?.precision)}class PgUUIDBuilder extends PgColumnBuilder{static[entityKind]="PgUUIDBuilder";constructor(name){super(name,"string","PgUUID")}defaultRandom(){return this.default(sql`gen_random_uuid()`)}build(table){return new PgUUID(table,this.config)}}class PgUUID extends PgColumn{static[entityKind]="PgUUID";getSQLType(){return"uuid"}}function uuid(name){return new PgUUIDBuilder(name??"")}class PgVarcharBuilder extends PgColumnBuilder{static[entityKind]="PgVarcharBuilder";constructor(name,config){super(name,"string","PgVarchar");this.config.length=config.length,this.config.enumValues=config.enum}build(table){return new PgVarchar(table,this.config)}}class PgVarchar extends PgColumn{static[entityKind]="PgVarchar";length=this.config.length;enumValues=this.config.enumValues;getSQLType(){return this.length===void 0?"varchar":`varchar(${this.length})`}}function varchar(a12,b2={}){let{name,config}=getColumnNameAndConfig(a12,b2);return new PgVarcharBuilder(name,config)}class PgBinaryVectorBuilder extends PgColumnBuilder{static[entityKind]="PgBinaryVectorBuilder";constructor(name,config){super(name,"string","PgBinaryVector");this.config.dimensions=config.dimensions}build(table){return new PgBinaryVector(table,this.config)}}class PgBinaryVector extends PgColumn{static[entityKind]="PgBinaryVector";dimensions=this.config.dimensions;getSQLType(){return`bit(${this.dimensions})`}}function bit(a12,b2){let{name,config}=getColumnNameAndConfig(a12,b2);return new PgBinaryVectorBuilder(name,config)}class PgHalfVectorBuilder extends PgColumnBuilder{static[entityKind]="PgHalfVectorBuilder";constructor(name,config){super(name,"array","PgHalfVector");this.config.dimensions=config.dimensions}build(table){return new PgHalfVector(table,this.config)}}class PgHalfVector extends PgColumn{static[entityKind]="PgHalfVector";dimensions=this.config.dimensions;getSQLType(){return`halfvec(${this.dimensions})`}mapToDriverValue(value){return JSON.stringify(value)}mapFromDriverValue(value){return value.slice(1,-1).split(",").map((v)=>Number.parseFloat(v))}}function halfvec(a12,b2){let{name,config}=getColumnNameAndConfig(a12,b2);return new PgHalfVectorBuilder(name,config)}class PgSparseVectorBuilder extends PgColumnBuilder{static[entityKind]="PgSparseVectorBuilder";constructor(name,config){super(name,"string","PgSparseVector");this.config.dimensions=config.dimensions}build(table){return new PgSparseVector(table,this.config)}}class PgSparseVector extends PgColumn{static[entityKind]="PgSparseVector";dimensions=this.config.dimensions;getSQLType(){return`sparsevec(${this.dimensions})`}}function sparsevec(a12,b2){let{name,config}=getColumnNameAndConfig(a12,b2);return new PgSparseVectorBuilder(name,config)}class PgVectorBuilder extends PgColumnBuilder{static[entityKind]="PgVectorBuilder";constructor(name,config){super(name,"array","PgVector");this.config.dimensions=config.dimensions}build(table){return new PgVector(table,this.config)}}class PgVector extends PgColumn{static[entityKind]="PgVector";dimensions=this.config.dimensions;getSQLType(){return`vector(${this.dimensions})`}mapToDriverValue(value){return JSON.stringify(value)}mapFromDriverValue(value){return value.slice(1,-1).split(",").map((v)=>Number.parseFloat(v))}}function vector(a12,b2){let{name,config}=getColumnNameAndConfig(a12,b2);return new PgVectorBuilder(name,config)}function getPgColumnBuilders(){return{bigint,bigserial,boolean,char,cidr,customType,date:date2,doublePrecision,inet,integer,interval,json,jsonb,line,macaddr,macaddr8,numeric,point,geometry,real,serial,smallint,smallserial,text,time,timestamp,uuid,varchar,bit,halfvec,sparsevec,vector}}var InlineForeignKeys=Symbol.for("drizzle:PgInlineForeignKeys"),EnableRLS=Symbol.for("drizzle:EnableRLS");class PgTable extends Table{static[entityKind]="PgTable";static Symbol=Object.assign({},Table.Symbol,{InlineForeignKeys,EnableRLS});[InlineForeignKeys]=[];[EnableRLS]=!1;[Table.Symbol.ExtraConfigBuilder]=void 0;[Table.Symbol.ExtraConfigColumns]={}}function pgTableWithSchema(name,columns,extraConfig,schema,baseName=name){let rawTable=new PgTable(name,schema,baseName),parsedColumns=typeof columns==="function"?columns(getPgColumnBuilders()):columns,builtColumns=Object.fromEntries(Object.entries(parsedColumns).map(([name2,colBuilderBase])=>{let colBuilder=colBuilderBase;colBuilder.setName(name2);let column=colBuilder.build(rawTable);return rawTable[InlineForeignKeys].push(...colBuilder.buildForeignKeys(column,rawTable)),[name2,column]})),builtColumnsForExtraConfig=Object.fromEntries(Object.entries(parsedColumns).map(([name2,colBuilderBase])=>{let colBuilder=colBuilderBase;colBuilder.setName(name2);let column=colBuilder.buildExtraConfigColumn(rawTable);return[name2,column]})),table=Object.assign(rawTable,builtColumns);if(table[Table.Symbol.Columns]=builtColumns,table[Table.Symbol.ExtraConfigColumns]=builtColumnsForExtraConfig,extraConfig)table[PgTable.Symbol.ExtraConfigBuilder]=extraConfig;return Object.assign(table,{enableRLS:()=>{return table[PgTable.Symbol.EnableRLS]=!0,table}})}var pgTable=(name,columns,extraConfig)=>{return pgTableWithSchema(name,columns,extraConfig,void 0)};class IndexBuilderOn{constructor(unique2,name){this.unique=unique2,this.name=name}static[entityKind]="PgIndexBuilderOn";on(...columns){return new IndexBuilder(columns.map((it)=>{if(is(it,SQL))return it;it=it;let clonedIndexedColumn=new IndexedColumn(it.name,!!it.keyAsName,it.columnType,it.indexConfig);return it.indexConfig=JSON.parse(JSON.stringify(it.defaultConfig)),clonedIndexedColumn}),this.unique,!1,this.name)}onOnly(...columns){return new IndexBuilder(columns.map((it)=>{if(is(it,SQL))return it;it=it;let clonedIndexedColumn=new IndexedColumn(it.name,!!it.keyAsName,it.columnType,it.indexConfig);return it.indexConfig=it.defaultConfig,clonedIndexedColumn}),this.unique,!0,this.name)}using(method,...columns){return new IndexBuilder(columns.map((it)=>{if(is(it,SQL))return it;it=it;let clonedIndexedColumn=new IndexedColumn(it.name,!!it.keyAsName,it.columnType,it.indexConfig);return it.indexConfig=JSON.parse(JSON.stringify(it.defaultConfig)),clonedIndexedColumn}),this.unique,!0,this.name,method)}}class IndexBuilder{static[entityKind]="PgIndexBuilder";config;constructor(columns,unique2,only,name,method="btree"){this.config={name,columns,unique:unique2,only,method}}concurrently(){return this.config.concurrently=!0,this}with(obj){return this.config.with=obj,this}where(condition){return this.config.where=condition,this}build(table){return new Index2(this.config,table)}}class Index2{static[entityKind]="PgIndex";config;constructor(config,table){this.config={...config,table}}}function index(name){return new IndexBuilderOn(!1,name)}function uniqueIndex(name){return new IndexBuilderOn(!0,name)}class PrimaryKeyBuilder{static[entityKind]="PgPrimaryKeyBuilder";columns;name;constructor(columns,name){this.columns=columns,this.name=name}build(table){return new PrimaryKey(table,this.columns,this.name)}}class PrimaryKey{constructor(table,columns,name){this.table=table,this.columns=columns,this.name=name}static[entityKind]="PgPrimaryKey";columns;name;getName(){return this.name??`${this.table[PgTable.Symbol.Name]}_${this.columns.map((column)=>column.name).join("_")}_pk`}}function toSnakeCase(input){return(input.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).map((word)=>word.toLowerCase()).join("_")}function toCamelCase(input){return(input.replace(/['\u2019]/g,"").match(/[\da-z]+|[A-Z]+(?![a-z])|[A-Z][\da-z]+/g)??[]).reduce((acc,word,i)=>{let formattedWord=i===0?word.toLowerCase():`${word[0].toUpperCase()}${word.slice(1)}`;return acc+formattedWord},"")}function noopCase(input){return input}class CasingCache{static[entityKind]="CasingCache";cache={};cachedTables={};convert;constructor(casing){this.convert=casing==="snake_case"?toSnakeCase:casing==="camelCase"?toCamelCase:noopCase}getColumnCasing(column){if(!column.keyAsName)return column.name;let schema=column.table[Table.Symbol.Schema]??"public",tableName=column.table[Table.Symbol.OriginalName],key=`${schema}.${tableName}.${column.name}`;if(!this.cache[key])this.cacheTable(column.table);return this.cache[key]}cacheTable(table){let schema=table[Table.Symbol.Schema]??"public",tableName=table[Table.Symbol.OriginalName],tableKey=`${schema}.${tableName}`;if(!this.cachedTables[tableKey]){for(let column of Object.values(table[Table.Symbol.Columns])){let columnKey=`${tableKey}.${column.name}`;this.cache[columnKey]=this.convert(column.name)}this.cachedTables[tableKey]=!0}}clearCache(){this.cache={},this.cachedTables={}}}class DrizzleError extends Error{static[entityKind]="DrizzleError";constructor({message,cause}){super(message);this.name="DrizzleError",this.cause=cause}}class DrizzleQueryError extends Error{constructor(query,params,cause){super(`Failed query: ${query}
params: ${params}`);if(this.query=query,this.params=params,this.cause=cause,Error.captureStackTrace(this,DrizzleQueryError),cause)this.cause=cause}}class TransactionRollbackError extends DrizzleError{static[entityKind]="TransactionRollbackError";constructor(){super({message:"Rollback"})}}function bindIfParam(value,column){if(isDriverValueEncoder(column)&&!isSQLWrapper(value)&&!is(value,Param)&&!is(value,Placeholder)&&!is(value,Column)&&!is(value,Table)&&!is(value,View))return new Param(value,column);return value}var eq=(left,right)=>{return sql`${left} = ${bindIfParam(right,left)}`},ne=(left,right)=>{return sql`${left} <> ${bindIfParam(right,left)}`};function and(...unfilteredConditions){let conditions=unfilteredConditions.filter((c)=>c!==void 0);if(conditions.length===0)return;if(conditions.length===1)return new SQL(conditions);return new SQL([new StringChunk("("),sql.join(conditions,new StringChunk(" and ")),new StringChunk(")")])}function or(...unfilteredConditions){let conditions=unfilteredConditions.filter((c)=>c!==void 0);if(conditions.length===0)return;if(conditions.length===1)return new SQL(conditions);return new SQL([new StringChunk("("),sql.join(conditions,new StringChunk(" or ")),new StringChunk(")")])}function not(condition){return sql`not ${condition}`}var gt=(left,right)=>{return sql`${left} > ${bindIfParam(right,left)}`},gte=(left,right)=>{return sql`${left} >= ${bindIfParam(right,left)}`},lt=(left,right)=>{return sql`${left} < ${bindIfParam(right,left)}`},lte=(left,right)=>{return sql`${left} <= ${bindIfParam(right,left)}`};function inArray(column,values2){if(Array.isArray(values2)){if(values2.length===0)return sql`false`;return sql`${column} in ${values2.map((v)=>bindIfParam(v,column))}`}return sql`${column} in ${bindIfParam(values2,column)}`}function notInArray(column,values2){if(Array.isArray(values2)){if(values2.length===0)return sql`true`;return sql`${column} not in ${values2.map((v)=>bindIfParam(v,column))}`}return sql`${column} not in ${bindIfParam(values2,column)}`}function isNull(value){return sql`${value} is null`}function isNotNull(value){return sql`${value} is not null`}function exists(subquery){return sql`exists ${subquery}`}function notExists(subquery){return sql`not exists ${subquery}`}function between(column,min,max){return sql`${column} between ${bindIfParam(min,column)} and ${bindIfParam(max,column)}`}function notBetween(column,min,max){return sql`${column} not between ${bindIfParam(min,column)} and ${bindIfParam(max,column)}`}function like(column,value){return sql`${column} like ${value}`}function notLike(column,value){return sql`${column} not like ${value}`}function ilike(column,value){return sql`${column} ilike ${value}`}function notIlike(column,value){return sql`${column} not ilike ${value}`}function asc(column){return sql`${column} asc`}function desc(column){return sql`${column} desc`}class Relation{constructor(sourceTable,referencedTable,relationName){this.sourceTable=sourceTable,this.referencedTable=referencedTable,this.relationName=relationName,this.referencedTableName=referencedTable[Table.Symbol.Name]}static[entityKind]="Relation";referencedTableName;fieldName}class Relations{constructor(table,config){this.table=table,this.config=config}static[entityKind]="Relations"}class One extends Relation{constructor(sourceTable,referencedTable,config,isNullable){super(sourceTable,referencedTable,config?.relationName);this.config=config,this.isNullable=isNullable}static[entityKind]="One";withFieldName(fieldName){let relation=new One(this.sourceTable,this.referencedTable,this.config,this.isNullable);return relation.fieldName=fieldName,relation}}class Many extends Relation{constructor(sourceTable,referencedTable,config){super(sourceTable,referencedTable,config?.relationName);this.config=config}static[entityKind]="Many";withFieldName(fieldName){let relation=new Many(this.sourceTable,this.referencedTable,this.config);return relation.fieldName=fieldName,relation}}function getOperators(){return{and,between,eq,exists,gt,gte,ilike,inArray,isNull,isNotNull,like,lt,lte,ne,not,notBetween,notExists,notLike,notIlike,notInArray,or,sql}}function getOrderByOperators(){return{sql,asc,desc}}function extractTablesRelationalConfig(schema,configHelpers){if(Object.keys(schema).length===1&&"default"in schema&&!is(schema.default,Table))schema=schema.default;let tableNamesMap={},relationsBuffer={},tablesConfig={};for(let[key,value]of Object.entries(schema))if(is(value,Table)){let dbName=getTableUniqueName(value),bufferedRelations=relationsBuffer[dbName];tableNamesMap[dbName]=key,tablesConfig[key]={tsName:key,dbName:value[Table.Symbol.Name],schema:value[Table.Symbol.Schema],columns:value[Table.Symbol.Columns],relations:bufferedRelations?.relations??{},primaryKey:bufferedRelations?.primaryKey??[]};for(let column of Object.values(value[Table.Symbol.Columns]))if(column.primary)tablesConfig[key].primaryKey.push(column);let extraConfig=value[Table.Symbol.ExtraConfigBuilder]?.(value[Table.Symbol.ExtraConfigColumns]);if(extraConfig){for(let configEntry of Object.values(extraConfig))if(is(configEntry,PrimaryKeyBuilder))tablesConfig[key].primaryKey.push(...configEntry.columns)}}else if(is(value,Relations)){let dbName=getTableUniqueName(value.table),tableName=tableNamesMap[dbName],relations2=value.config(configHelpers(value.table)),primaryKey;for(let[relationName,relation]of Object.entries(relations2))if(tableName){let tableConfig=tablesConfig[tableName];if(tableConfig.relations[relationName]=relation,primaryKey)tableConfig.primaryKey.push(...primaryKey)}else{if(!(dbName in relationsBuffer))relationsBuffer[dbName]={relations:{},primaryKey};relationsBuffer[dbName].relations[relationName]=relation}}return{tables:tablesConfig,tableNamesMap}}function createOne(sourceTable){return function(table,config){return new One(sourceTable,table,config,config?.fields.reduce((res,f)=>res&&f.notNull,!0)??!1)}}function createMany(sourceTable){return function(referencedTable,config){return new Many(sourceTable,referencedTable,config)}}function normalizeRelation(schema,tableNamesMap,relation){if(is(relation,One)&&relation.config)return{fields:relation.config.fields,references:relation.config.references};let referencedTableTsName=tableNamesMap[getTableUniqueName(relation.referencedTable)];if(!referencedTableTsName)throw Error(`Table "${relation.referencedTable[Table.Symbol.Name]}" not found in schema`);let referencedTableConfig=schema[referencedTableTsName];if(!referencedTableConfig)throw Error(`Table "${referencedTableTsName}" not found in schema`);let sourceTable=relation.sourceTable,sourceTableTsName=tableNamesMap[getTableUniqueName(sourceTable)];if(!sourceTableTsName)throw Error(`Table "${sourceTable[Table.Symbol.Name]}" not found in schema`);let reverseRelations=[];for(let referencedTableRelation of Object.values(referencedTableConfig.relations))if(relation.relationName&&relation!==referencedTableRelation&&referencedTableRelation.relationName===relation.relationName||!relation.relationName&&referencedTableRelation.referencedTable===relation.sourceTable)reverseRelations.push(referencedTableRelation);if(reverseRelations.length>1)throw relation.relationName?Error(`There are multiple relations with name "${relation.relationName}" in table "${referencedTableTsName}"`):Error(`There are multiple relations between "${referencedTableTsName}" and "${relation.sourceTable[Table.Symbol.Name]}". Please specify relation name`);if(reverseRelations[0]&&is(reverseRelations[0],One)&&reverseRelations[0].config)return{fields:reverseRelations[0].config.references,references:reverseRelations[0].config.fields};throw Error(`There is not enough information to infer relation "${sourceTableTsName}.${relation.fieldName}"`)}function createTableRelationsHelpers(sourceTable){return{one:createOne(sourceTable),many:createMany(sourceTable)}}function mapRelationalRow(tablesConfig,tableConfig,row,buildQueryResultSelection,mapColumnValue=(value)=>value){let result={};for(let[selectionItemIndex,selectionItem]of buildQueryResultSelection.entries())if(selectionItem.isJson){let relation=tableConfig.relations[selectionItem.tsKey],rawSubRows=row[selectionItemIndex],subRows=typeof rawSubRows==="string"?JSON.parse(rawSubRows):rawSubRows;result[selectionItem.tsKey]=is(relation,One)?subRows&&mapRelationalRow(tablesConfig,tablesConfig[selectionItem.relationTableTsKey],subRows,selectionItem.selection,mapColumnValue):subRows.map((subRow)=>mapRelationalRow(tablesConfig,tablesConfig[selectionItem.relationTableTsKey],subRow,selectionItem.selection,mapColumnValue))}else{let value=mapColumnValue(row[selectionItemIndex]),field=selectionItem.field,decoder;if(is(field,Column))decoder=field;else if(is(field,SQL))decoder=field.decoder;else decoder=field.sql.decoder;result[selectionItem.tsKey]=value===null?null:decoder.mapFromDriverValue(value)}return result}class PgViewBase extends View{static[entityKind]="PgViewBase"}class PgDialect{static[entityKind]="PgDialect";casing;constructor(config){this.casing=new CasingCache(config?.casing)}async migrate(migrations,session,config){let migrationsTable=typeof config==="string"?"__drizzle_migrations":config.migrationsTable??"__drizzle_migrations",migrationsSchema=typeof config==="string"?"drizzle":config.migrationsSchema??"drizzle",migrationTableCreate=sql`
			CREATE TABLE IF NOT EXISTS ${sql.identifier(migrationsSchema)}.${sql.identifier(migrationsTable)} (
				id SERIAL PRIMARY KEY,
				hash text NOT NULL,
				created_at bigint
			)
		`;await session.execute(sql`CREATE SCHEMA IF NOT EXISTS ${sql.identifier(migrationsSchema)}`),await session.execute(migrationTableCreate);let lastDbMigration=(await session.all(sql`select id, hash, created_at from ${sql.identifier(migrationsSchema)}.${sql.identifier(migrationsTable)} order by created_at desc limit 1`))[0];await session.transaction(async(tx)=>{for await(let migration of migrations)if(!lastDbMigration||Number(lastDbMigration.created_at)<migration.folderMillis){for(let stmt of migration.sql)await tx.execute(sql.raw(stmt));await tx.execute(sql`insert into ${sql.identifier(migrationsSchema)}.${sql.identifier(migrationsTable)} ("hash", "created_at") values(${migration.hash}, ${migration.folderMillis})`)}})}escapeName(name){return`"${name}"`}escapeParam(num){return`$${num+1}`}escapeString(str){return`'${str.replace(/'/g,"''")}'`}buildWithCTE(queries){if(!queries?.length)return;let withSqlChunks=[sql`with `];for(let[i,w]of queries.entries())if(withSqlChunks.push(sql`${sql.identifier(w._.alias)} as (${w._.sql})`),i<queries.length-1)withSqlChunks.push(sql`, `);return withSqlChunks.push(sql` `),sql.join(withSqlChunks)}buildDeleteQuery({table,where,returning,withList}){let withSql=this.buildWithCTE(withList),returningSql=returning?sql` returning ${this.buildSelection(returning,{isSingleTable:!0})}`:void 0,whereSql=where?sql` where ${where}`:void 0;return sql`${withSql}delete from ${table}${whereSql}${returningSql}`}buildUpdateSet(table,set2){let tableColumns=table[Table.Symbol.Columns],columnNames=Object.keys(tableColumns).filter((colName)=>set2[colName]!==void 0||tableColumns[colName]?.onUpdateFn!==void 0),setSize=columnNames.length;return sql.join(columnNames.flatMap((colName,i)=>{let col=tableColumns[colName],value=set2[colName]??sql.param(col.onUpdateFn(),col),res=sql`${sql.identifier(this.casing.getColumnCasing(col))} = ${value}`;if(i<setSize-1)return[res,sql.raw(", ")];return[res]}))}buildUpdateQuery({table,set:set2,where,returning,withList,from,joins}){let withSql=this.buildWithCTE(withList),tableName=table[PgTable.Symbol.Name],tableSchema=table[PgTable.Symbol.Schema],origTableName=table[PgTable.Symbol.OriginalName],alias=tableName===origTableName?void 0:tableName,tableSql=sql`${tableSchema?sql`${sql.identifier(tableSchema)}.`:void 0}${sql.identifier(origTableName)}${alias&&sql` ${sql.identifier(alias)}`}`,setSql=this.buildUpdateSet(table,set2),fromSql=from&&sql.join([sql.raw(" from "),this.buildFromTable(from)]),joinsSql=this.buildJoins(joins),returningSql=returning?sql` returning ${this.buildSelection(returning,{isSingleTable:!from})}`:void 0,whereSql=where?sql` where ${where}`:void 0;return sql`${withSql}update ${tableSql} set ${setSql}${fromSql}${joinsSql}${whereSql}${returningSql}`}buildSelection(fields,{isSingleTable=!1}={}){let columnsLen=fields.length,chunks=fields.flatMap(({field},i)=>{let chunk=[];if(is(field,SQL.Aliased)&&field.isSelectionField)chunk.push(sql.identifier(field.fieldAlias));else if(is(field,SQL.Aliased)||is(field,SQL)){let query=is(field,SQL.Aliased)?field.sql:field;if(isSingleTable)chunk.push(new SQL(query.queryChunks.map((c)=>{if(is(c,PgColumn))return sql.identifier(this.casing.getColumnCasing(c));return c})));else chunk.push(query);if(is(field,SQL.Aliased))chunk.push(sql` as ${sql.identifier(field.fieldAlias)}`)}else if(is(field,Column))if(isSingleTable)chunk.push(sql.identifier(this.casing.getColumnCasing(field)));else chunk.push(field);if(i<columnsLen-1)chunk.push(sql`, `);return chunk});return sql.join(chunks)}buildJoins(joins){if(!joins||joins.length===0)return;let joinsArray=[];for(let[index2,joinMeta]of joins.entries()){if(index2===0)joinsArray.push(sql` `);let table=joinMeta.table,lateralSql=joinMeta.lateral?sql` lateral`:void 0,onSql=joinMeta.on?sql` on ${joinMeta.on}`:void 0;if(is(table,PgTable)){let tableName=table[PgTable.Symbol.Name],tableSchema=table[PgTable.Symbol.Schema],origTableName=table[PgTable.Symbol.OriginalName],alias=tableName===origTableName?void 0:joinMeta.alias;joinsArray.push(sql`${sql.raw(joinMeta.joinType)} join${lateralSql} ${tableSchema?sql`${sql.identifier(tableSchema)}.`:void 0}${sql.identifier(origTableName)}${alias&&sql` ${sql.identifier(alias)}`}${onSql}`)}else if(is(table,View)){let viewName=table[ViewBaseConfig].name,viewSchema=table[ViewBaseConfig].schema,origViewName=table[ViewBaseConfig].originalName,alias=viewName===origViewName?void 0:joinMeta.alias;joinsArray.push(sql`${sql.raw(joinMeta.joinType)} join${lateralSql} ${viewSchema?sql`${sql.identifier(viewSchema)}.`:void 0}${sql.identifier(origViewName)}${alias&&sql` ${sql.identifier(alias)}`}${onSql}`)}else joinsArray.push(sql`${sql.raw(joinMeta.joinType)} join${lateralSql} ${table}${onSql}`);if(index2<joins.length-1)joinsArray.push(sql` `)}return sql.join(joinsArray)}buildFromTable(table){if(is(table,Table)&&table[Table.Symbol.IsAlias]){let fullName=sql`${sql.identifier(table[Table.Symbol.OriginalName])}`;if(table[Table.Symbol.Schema])fullName=sql`${sql.identifier(table[Table.Symbol.Schema])}.${fullName}`;return sql`${fullName} ${sql.identifier(table[Table.Symbol.Name])}`}return table}buildSelectQuery({withList,fields,fieldsFlat,where,having,table,joins,orderBy,groupBy,limit,offset,lockingClause,distinct,setOperators}){let fieldsList=fieldsFlat??orderSelectedFields(fields);for(let f of fieldsList)if(is(f.field,Column)&&getTableName(f.field.table)!==(is(table,Subquery)?table._.alias:is(table,PgViewBase)?table[ViewBaseConfig].name:is(table,SQL)?void 0:getTableName(table))&&!((table2)=>joins?.some(({alias})=>alias===(table2[Table.Symbol.IsAlias]?getTableName(table2):table2[Table.Symbol.BaseName])))(f.field.table)){let tableName=getTableName(f.field.table);throw Error(`Your "${f.path.join("->")}" field references a column "${tableName}"."${f.field.name}", but the table "${tableName}" is not part of the query! Did you forget to join it?`)}let isSingleTable=!joins||joins.length===0,withSql=this.buildWithCTE(withList),distinctSql;if(distinct)distinctSql=distinct===!0?sql` distinct`:sql` distinct on (${sql.join(distinct.on,sql`, `)})`;let selection=this.buildSelection(fieldsList,{isSingleTable}),tableSql=this.buildFromTable(table),joinsSql=this.buildJoins(joins),whereSql=where?sql` where ${where}`:void 0,havingSql=having?sql` having ${having}`:void 0,orderBySql;if(orderBy&&orderBy.length>0)orderBySql=sql` order by ${sql.join(orderBy,sql`, `)}`;let groupBySql;if(groupBy&&groupBy.length>0)groupBySql=sql` group by ${sql.join(groupBy,sql`, `)}`;let limitSql=typeof limit==="object"||typeof limit==="number"&&limit>=0?sql` limit ${limit}`:void 0,offsetSql=offset?sql` offset ${offset}`:void 0,lockingClauseSql=sql.empty();if(lockingClause){let clauseSql=sql` for ${sql.raw(lockingClause.strength)}`;if(lockingClause.config.of)clauseSql.append(sql` of ${sql.join(Array.isArray(lockingClause.config.of)?lockingClause.config.of:[lockingClause.config.of],sql`, `)}`);if(lockingClause.config.noWait)clauseSql.append(sql` nowait`);else if(lockingClause.config.skipLocked)clauseSql.append(sql` skip locked`);lockingClauseSql.append(clauseSql)}let finalQuery=sql`${withSql}select${distinctSql} ${selection} from ${tableSql}${joinsSql}${whereSql}${groupBySql}${havingSql}${orderBySql}${limitSql}${offsetSql}${lockingClauseSql}`;if(setOperators.length>0)return this.buildSetOperations(finalQuery,setOperators);return finalQuery}buildSetOperations(leftSelect,setOperators){let[setOperator,...rest]=setOperators;if(!setOperator)throw Error("Cannot pass undefined values to any set operator");if(rest.length===0)return this.buildSetOperationQuery({leftSelect,setOperator});return this.buildSetOperations(this.buildSetOperationQuery({leftSelect,setOperator}),rest)}buildSetOperationQuery({leftSelect,setOperator:{type,isAll,rightSelect,limit,orderBy,offset}}){let leftChunk=sql`(${leftSelect.getSQL()}) `,rightChunk=sql`(${rightSelect.getSQL()})`,orderBySql;if(orderBy&&orderBy.length>0){let orderByValues=[];for(let singleOrderBy of orderBy)if(is(singleOrderBy,PgColumn))orderByValues.push(sql.identifier(singleOrderBy.name));else if(is(singleOrderBy,SQL)){for(let i=0;i<singleOrderBy.queryChunks.length;i++){let chunk=singleOrderBy.queryChunks[i];if(is(chunk,PgColumn))singleOrderBy.queryChunks[i]=sql.identifier(chunk.name)}orderByValues.push(sql`${singleOrderBy}`)}else orderByValues.push(sql`${singleOrderBy}`);orderBySql=sql` order by ${sql.join(orderByValues,sql`, `)} `}let limitSql=typeof limit==="object"||typeof limit==="number"&&limit>=0?sql` limit ${limit}`:void 0,operatorChunk=sql.raw(`${type} ${isAll?"all ":""}`),offsetSql=offset?sql` offset ${offset}`:void 0;return sql`${leftChunk}${operatorChunk}${rightChunk}${orderBySql}${limitSql}${offsetSql}`}buildInsertQuery({table,values:valuesOrSelect,onConflict,returning,withList,select:select2,overridingSystemValue_}){let valuesSqlList=[],columns=table[Table.Symbol.Columns],colEntries=Object.entries(columns).filter(([_2,col])=>!col.shouldDisableInsert()),insertOrder=colEntries.map(([,column])=>sql.identifier(this.casing.getColumnCasing(column)));if(select2){let select22=valuesOrSelect;if(is(select22,SQL))valuesSqlList.push(select22);else valuesSqlList.push(select22.getSQL())}else{let values2=valuesOrSelect;valuesSqlList.push(sql.raw("values "));for(let[valueIndex,value]of values2.entries()){let valueList=[];for(let[fieldName,col]of colEntries){let colValue=value[fieldName];if(colValue===void 0||is(colValue,Param)&&colValue.value===void 0)if(col.defaultFn!==void 0){let defaultFnResult=col.defaultFn(),defaultValue=is(defaultFnResult,SQL)?defaultFnResult:sql.param(defaultFnResult,col);valueList.push(defaultValue)}else if(!col.default&&col.onUpdateFn!==void 0){let onUpdateFnResult=col.onUpdateFn(),newValue=is(onUpdateFnResult,SQL)?onUpdateFnResult:sql.param(onUpdateFnResult,col);valueList.push(newValue)}else valueList.push(sql`default`);else valueList.push(colValue)}if(valuesSqlList.push(valueList),valueIndex<values2.length-1)valuesSqlList.push(sql`, `)}}let withSql=this.buildWithCTE(withList),valuesSql=sql.join(valuesSqlList),returningSql=returning?sql` returning ${this.buildSelection(returning,{isSingleTable:!0})}`:void 0,onConflictSql=onConflict?sql` on conflict ${onConflict}`:void 0,overridingSql=overridingSystemValue_===!0?sql`overriding system value `:void 0;return sql`${withSql}insert into ${table} ${insertOrder} ${overridingSql}${valuesSql}${onConflictSql}${returningSql}`}buildRefreshMaterializedViewQuery({view,concurrently,withNoData}){let concurrentlySql=concurrently?sql` concurrently`:void 0,withNoDataSql=withNoData?sql` with no data`:void 0;return sql`refresh materialized view${concurrentlySql} ${view}${withNoDataSql}`}prepareTyping(encoder2){if(is(encoder2,PgJsonb)||is(encoder2,PgJson))return"json";else if(is(encoder2,PgNumeric))return"decimal";else if(is(encoder2,PgTime))return"time";else if(is(encoder2,PgTimestamp)||is(encoder2,PgTimestampString))return"timestamp";else if(is(encoder2,PgDate)||is(encoder2,PgDateString))return"date";else if(is(encoder2,PgUUID))return"uuid";else return"none"}sqlToQuery(sql2,invokeSource){return sql2.toQuery({casing:this.casing,escapeName:this.escapeName,escapeParam:this.escapeParam,escapeString:this.escapeString,prepareTyping:this.prepareTyping,invokeSource})}buildRelationalQueryWithoutPK({fullSchema,schema,tableNamesMap,table,tableConfig,queryConfig:config,tableAlias,nestedQueryRelation,joinOn}){let selection=[],limit,offset,orderBy=[],where,joins=[];if(config===!0)selection=Object.entries(tableConfig.columns).map(([key,value])=>({dbKey:value.name,tsKey:key,field:aliasedTableColumn(value,tableAlias),relationTableTsKey:void 0,isJson:!1,selection:[]}));else{let aliasedColumns=Object.fromEntries(Object.entries(tableConfig.columns).map(([key,value])=>[key,aliasedTableColumn(value,tableAlias)]));if(config.where){let whereSql=typeof config.where==="function"?config.where(aliasedColumns,getOperators()):config.where;where=whereSql&&mapColumnsInSQLToAlias(whereSql,tableAlias)}let fieldsSelection=[],selectedColumns=[];if(config.columns){let isIncludeMode=!1;for(let[field,value]of Object.entries(config.columns)){if(value===void 0)continue;if(field in tableConfig.columns){if(!isIncludeMode&&value===!0)isIncludeMode=!0;selectedColumns.push(field)}}if(selectedColumns.length>0)selectedColumns=isIncludeMode?selectedColumns.filter((c)=>config.columns?.[c]===!0):Object.keys(tableConfig.columns).filter((key)=>!selectedColumns.includes(key))}else selectedColumns=Object.keys(tableConfig.columns);for(let field of selectedColumns){let column=tableConfig.columns[field];fieldsSelection.push({tsKey:field,value:column})}let selectedRelations=[];if(config.with)selectedRelations=Object.entries(config.with).filter((entry)=>!!entry[1]).map(([tsKey,queryConfig])=>({tsKey,queryConfig,relation:tableConfig.relations[tsKey]}));let extras;if(config.extras){extras=typeof config.extras==="function"?config.extras(aliasedColumns,{sql}):config.extras;for(let[tsKey,value]of Object.entries(extras))fieldsSelection.push({tsKey,value:mapColumnsInAliasedSQLToAlias(value,tableAlias)})}for(let{tsKey,value}of fieldsSelection)selection.push({dbKey:is(value,SQL.Aliased)?value.fieldAlias:tableConfig.columns[tsKey].name,tsKey,field:is(value,Column)?aliasedTableColumn(value,tableAlias):value,relationTableTsKey:void 0,isJson:!1,selection:[]});let orderByOrig=typeof config.orderBy==="function"?config.orderBy(aliasedColumns,getOrderByOperators()):config.orderBy??[];if(!Array.isArray(orderByOrig))orderByOrig=[orderByOrig];orderBy=orderByOrig.map((orderByValue)=>{if(is(orderByValue,Column))return aliasedTableColumn(orderByValue,tableAlias);return mapColumnsInSQLToAlias(orderByValue,tableAlias)}),limit=config.limit,offset=config.offset;for(let{tsKey:selectedRelationTsKey,queryConfig:selectedRelationConfigValue,relation}of selectedRelations){let normalizedRelation=normalizeRelation(schema,tableNamesMap,relation),relationTableName=getTableUniqueName(relation.referencedTable),relationTableTsName=tableNamesMap[relationTableName],relationTableAlias=`${tableAlias}_${selectedRelationTsKey}`,joinOn2=and(...normalizedRelation.fields.map((field2,i)=>eq(aliasedTableColumn(normalizedRelation.references[i],relationTableAlias),aliasedTableColumn(field2,tableAlias)))),builtRelation=this.buildRelationalQueryWithoutPK({fullSchema,schema,tableNamesMap,table:fullSchema[relationTableTsName],tableConfig:schema[relationTableTsName],queryConfig:is(relation,One)?selectedRelationConfigValue===!0?{limit:1}:{...selectedRelationConfigValue,limit:1}:selectedRelationConfigValue,tableAlias:relationTableAlias,joinOn:joinOn2,nestedQueryRelation:relation}),field=sql`${sql.identifier(relationTableAlias)}.${sql.identifier("data")}`.as(selectedRelationTsKey);joins.push({on:sql`true`,table:new Subquery(builtRelation.sql,{},relationTableAlias),alias:relationTableAlias,joinType:"left",lateral:!0}),selection.push({dbKey:selectedRelationTsKey,tsKey:selectedRelationTsKey,field,relationTableTsKey:relationTableTsName,isJson:!0,selection:builtRelation.selection})}}if(selection.length===0)throw new DrizzleError({message:`No fields selected for table "${tableConfig.tsName}" ("${tableAlias}")`});let result;if(where=and(joinOn,where),nestedQueryRelation){let field=sql`json_build_array(${sql.join(selection.map(({field:field2,tsKey,isJson})=>isJson?sql`${sql.identifier(`${tableAlias}_${tsKey}`)}.${sql.identifier("data")}`:is(field2,SQL.Aliased)?field2.sql:field2),sql`, `)})`;if(is(nestedQueryRelation,Many))field=sql`coalesce(json_agg(${field}${orderBy.length>0?sql` order by ${sql.join(orderBy,sql`, `)}`:void 0}), '[]'::json)`;let nestedSelection=[{dbKey:"data",tsKey:"data",field:field.as("data"),isJson:!0,relationTableTsKey:tableConfig.tsName,selection}];if(limit!==void 0||offset!==void 0||orderBy.length>0)result=this.buildSelectQuery({table:aliasedTable(table,tableAlias),fields:{},fieldsFlat:[{path:[],field:sql.raw("*")}],where,limit,offset,orderBy,setOperators:[]}),where=void 0,limit=void 0,offset=void 0,orderBy=[];else result=aliasedTable(table,tableAlias);result=this.buildSelectQuery({table:is(result,PgTable)?result:new Subquery(result,{},tableAlias),fields:{},fieldsFlat:nestedSelection.map(({field:field2})=>({path:[],field:is(field2,Column)?aliasedTableColumn(field2,tableAlias):field2})),joins,where,limit,offset,orderBy,setOperators:[]})}else result=this.buildSelectQuery({table:aliasedTable(table,tableAlias),fields:{},fieldsFlat:selection.map(({field})=>({path:[],field:is(field,Column)?aliasedTableColumn(field,tableAlias):field})),joins,where,limit,offset,orderBy,setOperators:[]});return{tableTsKey:tableConfig.tsName,sql:result,selection}}}class TypedQueryBuilder{static[entityKind]="TypedQueryBuilder";getSelectedFields(){return this._.selectedFields}}class PgSelectBuilder{static[entityKind]="PgSelectBuilder";fields;session;dialect;withList=[];distinct;constructor(config){if(this.fields=config.fields,this.session=config.session,this.dialect=config.dialect,config.withList)this.withList=config.withList;this.distinct=config.distinct}authToken;setToken(token){return this.authToken=token,this}from(source){let isPartialSelect=!!this.fields,src=source,fields;if(this.fields)fields=this.fields;else if(is(src,Subquery))fields=Object.fromEntries(Object.keys(src._.selectedFields).map((key)=>[key,src[key]]));else if(is(src,PgViewBase))fields=src[ViewBaseConfig].selectedFields;else if(is(src,SQL))fields={};else fields=getTableColumns(src);return new PgSelectBase({table:src,fields,isPartialSelect,session:this.session,dialect:this.dialect,withList:this.withList,distinct:this.distinct}).setToken(this.authToken)}}class PgSelectQueryBuilderBase extends TypedQueryBuilder{static[entityKind]="PgSelectQueryBuilder";_;config;joinsNotNullableMap;tableName;isPartialSelect;session;dialect;cacheConfig=void 0;usedTables=new Set;constructor({table,fields,isPartialSelect,session,dialect,withList,distinct}){super();this.config={withList,table,fields:{...fields},distinct,setOperators:[]},this.isPartialSelect=isPartialSelect,this.session=session,this.dialect=dialect,this._={selectedFields:fields,config:this.config},this.tableName=getTableLikeName(table),this.joinsNotNullableMap=typeof this.tableName==="string"?{[this.tableName]:!0}:{};for(let item of extractUsedTable(table))this.usedTables.add(item)}getUsedTables(){return[...this.usedTables]}createJoin(joinType,lateral){return(table,on)=>{let baseTableName=this.tableName,tableName=getTableLikeName(table);for(let item of extractUsedTable(table))this.usedTables.add(item);if(typeof tableName==="string"&&this.config.joins?.some((join)=>join.alias===tableName))throw Error(`Alias "${tableName}" is already used in this query`);if(!this.isPartialSelect){if(Object.keys(this.joinsNotNullableMap).length===1&&typeof baseTableName==="string")this.config.fields={[baseTableName]:this.config.fields};if(typeof tableName==="string"&&!is(table,SQL)){let selection=is(table,Subquery)?table._.selectedFields:is(table,View)?table[ViewBaseConfig].selectedFields:table[Table.Symbol.Columns];this.config.fields[tableName]=selection}}if(typeof on==="function")on=on(new Proxy(this.config.fields,new SelectionProxyHandler({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})));if(!this.config.joins)this.config.joins=[];if(this.config.joins.push({on,table,joinType,alias:tableName,lateral}),typeof tableName==="string")switch(joinType){case"left":{this.joinsNotNullableMap[tableName]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([key])=>[key,!1])),this.joinsNotNullableMap[tableName]=!0;break}case"cross":case"inner":{this.joinsNotNullableMap[tableName]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([key])=>[key,!1])),this.joinsNotNullableMap[tableName]=!1;break}}return this}}leftJoin=this.createJoin("left",!1);leftJoinLateral=this.createJoin("left",!0);rightJoin=this.createJoin("right",!1);innerJoin=this.createJoin("inner",!1);innerJoinLateral=this.createJoin("inner",!0);fullJoin=this.createJoin("full",!1);crossJoin=this.createJoin("cross",!1);crossJoinLateral=this.createJoin("cross",!0);createSetOperator(type,isAll){return(rightSelection)=>{let rightSelect=typeof rightSelection==="function"?rightSelection(getPgSetOperators()):rightSelection;if(!haveSameKeys(this.getSelectedFields(),rightSelect.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return this.config.setOperators.push({type,isAll,rightSelect}),this}}union=this.createSetOperator("union",!1);unionAll=this.createSetOperator("union",!0);intersect=this.createSetOperator("intersect",!1);intersectAll=this.createSetOperator("intersect",!0);except=this.createSetOperator("except",!1);exceptAll=this.createSetOperator("except",!0);addSetOperators(setOperators){return this.config.setOperators.push(...setOperators),this}where(where){if(typeof where==="function")where=where(new Proxy(this.config.fields,new SelectionProxyHandler({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})));return this.config.where=where,this}having(having){if(typeof having==="function")having=having(new Proxy(this.config.fields,new SelectionProxyHandler({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})));return this.config.having=having,this}groupBy(...columns){if(typeof columns[0]==="function"){let groupBy=columns[0](new Proxy(this.config.fields,new SelectionProxyHandler({sqlAliasedBehavior:"alias",sqlBehavior:"sql"})));this.config.groupBy=Array.isArray(groupBy)?groupBy:[groupBy]}else this.config.groupBy=columns;return this}orderBy(...columns){if(typeof columns[0]==="function"){let orderBy=columns[0](new Proxy(this.config.fields,new SelectionProxyHandler({sqlAliasedBehavior:"alias",sqlBehavior:"sql"}))),orderByArray=Array.isArray(orderBy)?orderBy:[orderBy];if(this.config.setOperators.length>0)this.config.setOperators.at(-1).orderBy=orderByArray;else this.config.orderBy=orderByArray}else{let orderByArray=columns;if(this.config.setOperators.length>0)this.config.setOperators.at(-1).orderBy=orderByArray;else this.config.orderBy=orderByArray}return this}limit(limit){if(this.config.setOperators.length>0)this.config.setOperators.at(-1).limit=limit;else this.config.limit=limit;return this}offset(offset){if(this.config.setOperators.length>0)this.config.setOperators.at(-1).offset=offset;else this.config.offset=offset;return this}for(strength,config={}){return this.config.lockingClause={strength,config},this}getSQL(){return this.dialect.buildSelectQuery(this.config)}toSQL(){let{typings:_typings,...rest}=this.dialect.sqlToQuery(this.getSQL());return rest}as(alias){let usedTables=[];if(usedTables.push(...extractUsedTable(this.config.table)),this.config.joins)for(let it of this.config.joins)usedTables.push(...extractUsedTable(it.table));return new Proxy(new Subquery(this.getSQL(),this.config.fields,alias,!1,[...new Set(usedTables)]),new SelectionProxyHandler({alias,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}getSelectedFields(){return new Proxy(this.config.fields,new SelectionProxyHandler({alias:this.tableName,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}$dynamic(){return this}$withCache(config){return this.cacheConfig=config===void 0?{config:{},enable:!0,autoInvalidate:!0}:config===!1?{enable:!1}:{enable:!0,autoInvalidate:!0,...config},this}}class PgSelectBase extends PgSelectQueryBuilderBase{static[entityKind]="PgSelect";_prepare(name){let{session,config,dialect,joinsNotNullableMap,authToken,cacheConfig,usedTables}=this;if(!session)throw Error("Cannot execute a query on a query builder. Please use a database instance instead.");let{fields}=config;return tracer.startActiveSpan("drizzle.prepareQuery",()=>{let fieldsList=orderSelectedFields(fields),query=session.prepareQuery(dialect.sqlToQuery(this.getSQL()),fieldsList,name,!0,void 0,{type:"select",tables:[...usedTables]},cacheConfig);return query.joinsNotNullableMap=joinsNotNullableMap,query.setToken(authToken)})}prepare(name){return this._prepare(name)}authToken;setToken(token){return this.authToken=token,this}execute=(placeholderValues)=>{return tracer.startActiveSpan("drizzle.operation",()=>{return this._prepare().execute(placeholderValues,this.authToken)})}}applyMixins(PgSelectBase,[QueryPromise]);function createSetOperator(type,isAll){return(leftSelect,rightSelect,...restSelects)=>{let setOperators=[rightSelect,...restSelects].map((select2)=>({type,isAll,rightSelect:select2}));for(let setOperator of setOperators)if(!haveSameKeys(leftSelect.getSelectedFields(),setOperator.rightSelect.getSelectedFields()))throw Error("Set operator error (union / intersect / except): selected fields are not the same or are in a different order");return leftSelect.addSetOperators(setOperators)}}var getPgSetOperators=()=>({union,unionAll,intersect,intersectAll,except,exceptAll}),union=createSetOperator("union",!1),unionAll=createSetOperator("union",!0),intersect=createSetOperator("intersect",!1),intersectAll=createSetOperator("intersect",!0),except=createSetOperator("except",!1),exceptAll=createSetOperator("except",!0);class QueryBuilder{static[entityKind]="PgQueryBuilder";dialect;dialectConfig;constructor(dialect){this.dialect=is(dialect,PgDialect)?dialect:void 0,this.dialectConfig=is(dialect,PgDialect)?void 0:dialect}$with=(alias,selection)=>{let queryBuilder=this;return{as:(qb)=>{if(typeof qb==="function")qb=qb(queryBuilder);return new Proxy(new WithSubquery(qb.getSQL(),selection??("getSelectedFields"in qb?qb.getSelectedFields()??{}:{}),alias,!0),new SelectionProxyHandler({alias,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}}};with(...queries){let self2=this;function select2(fields){return new PgSelectBuilder({fields:fields??void 0,session:void 0,dialect:self2.getDialect(),withList:queries})}function selectDistinct(fields){return new PgSelectBuilder({fields:fields??void 0,session:void 0,dialect:self2.getDialect(),distinct:!0})}function selectDistinctOn(on,fields){return new PgSelectBuilder({fields:fields??void 0,session:void 0,dialect:self2.getDialect(),distinct:{on}})}return{select:select2,selectDistinct,selectDistinctOn}}select(fields){return new PgSelectBuilder({fields:fields??void 0,session:void 0,dialect:this.getDialect()})}selectDistinct(fields){return new PgSelectBuilder({fields:fields??void 0,session:void 0,dialect:this.getDialect(),distinct:!0})}selectDistinctOn(on,fields){return new PgSelectBuilder({fields:fields??void 0,session:void 0,dialect:this.getDialect(),distinct:{on}})}getDialect(){if(!this.dialect)this.dialect=new PgDialect(this.dialectConfig);return this.dialect}}function extractUsedTable(table){if(is(table,PgTable))return[table[Schema]?`${table[Schema]}.${table[Table.Symbol.BaseName]}`:table[Table.Symbol.BaseName]];if(is(table,Subquery))return table._.usedTables??[];if(is(table,SQL))return table.usedTables??[];return[]}class PgDeleteBase extends QueryPromise{constructor(table,session,dialect,withList){super();this.session=session,this.dialect=dialect,this.config={table,withList}}static[entityKind]="PgDelete";config;cacheConfig;where(where){return this.config.where=where,this}returning(fields=this.config.table[Table.Symbol.Columns]){return this.config.returningFields=fields,this.config.returning=orderSelectedFields(fields),this}getSQL(){return this.dialect.buildDeleteQuery(this.config)}toSQL(){let{typings:_typings,...rest}=this.dialect.sqlToQuery(this.getSQL());return rest}_prepare(name){return tracer.startActiveSpan("drizzle.prepareQuery",()=>{return this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,name,!0,void 0,{type:"delete",tables:extractUsedTable(this.config.table)},this.cacheConfig)})}prepare(name){return this._prepare(name)}authToken;setToken(token){return this.authToken=token,this}execute=(placeholderValues)=>{return tracer.startActiveSpan("drizzle.operation",()=>{return this._prepare().execute(placeholderValues,this.authToken)})};getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new SelectionProxyHandler({alias:getTableName(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}}class PgInsertBuilder{constructor(table,session,dialect,withList,overridingSystemValue_){this.table=table,this.session=session,this.dialect=dialect,this.withList=withList,this.overridingSystemValue_=overridingSystemValue_}static[entityKind]="PgInsertBuilder";authToken;setToken(token){return this.authToken=token,this}overridingSystemValue(){return this.overridingSystemValue_=!0,this}values(values2){if(values2=Array.isArray(values2)?values2:[values2],values2.length===0)throw Error("values() must be called with at least one value");let mappedValues=values2.map((entry)=>{let result={},cols=this.table[Table.Symbol.Columns];for(let colKey of Object.keys(entry)){let colValue=entry[colKey];result[colKey]=is(colValue,SQL)?colValue:new Param(colValue,cols[colKey])}return result});return new PgInsertBase(this.table,mappedValues,this.session,this.dialect,this.withList,!1,this.overridingSystemValue_).setToken(this.authToken)}select(selectQuery){let select2=typeof selectQuery==="function"?selectQuery(new QueryBuilder):selectQuery;if(!is(select2,SQL)&&!haveSameKeys(this.table[Columns],select2._.selectedFields))throw Error("Insert select error: selected fields are not the same or are in a different order compared to the table definition");return new PgInsertBase(this.table,select2,this.session,this.dialect,this.withList,!0)}}class PgInsertBase extends QueryPromise{constructor(table,values2,session,dialect,withList,select2,overridingSystemValue_){super();this.session=session,this.dialect=dialect,this.config={table,values:values2,withList,select:select2,overridingSystemValue_}}static[entityKind]="PgInsert";config;cacheConfig;returning(fields=this.config.table[Table.Symbol.Columns]){return this.config.returningFields=fields,this.config.returning=orderSelectedFields(fields),this}onConflictDoNothing(config={}){if(config.target===void 0)this.config.onConflict=sql`do nothing`;else{let targetColumn="";targetColumn=Array.isArray(config.target)?config.target.map((it)=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(it))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(config.target));let whereSql=config.where?sql` where ${config.where}`:void 0;this.config.onConflict=sql`(${sql.raw(targetColumn)})${whereSql} do nothing`}return this}onConflictDoUpdate(config){if(config.where&&(config.targetWhere||config.setWhere))throw Error('You cannot use both "where" and "targetWhere"/"setWhere" at the same time - "where" is deprecated, use "targetWhere" or "setWhere" instead.');let whereSql=config.where?sql` where ${config.where}`:void 0,targetWhereSql=config.targetWhere?sql` where ${config.targetWhere}`:void 0,setWhereSql=config.setWhere?sql` where ${config.setWhere}`:void 0,setSql=this.dialect.buildUpdateSet(this.config.table,mapUpdateSet(this.config.table,config.set)),targetColumn="";return targetColumn=Array.isArray(config.target)?config.target.map((it)=>this.dialect.escapeName(this.dialect.casing.getColumnCasing(it))).join(","):this.dialect.escapeName(this.dialect.casing.getColumnCasing(config.target)),this.config.onConflict=sql`(${sql.raw(targetColumn)})${targetWhereSql} do update set ${setSql}${whereSql}${setWhereSql}`,this}getSQL(){return this.dialect.buildInsertQuery(this.config)}toSQL(){let{typings:_typings,...rest}=this.dialect.sqlToQuery(this.getSQL());return rest}_prepare(name){return tracer.startActiveSpan("drizzle.prepareQuery",()=>{return this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,name,!0,void 0,{type:"insert",tables:extractUsedTable(this.config.table)},this.cacheConfig)})}prepare(name){return this._prepare(name)}authToken;setToken(token){return this.authToken=token,this}execute=(placeholderValues)=>{return tracer.startActiveSpan("drizzle.operation",()=>{return this._prepare().execute(placeholderValues,this.authToken)})};getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new SelectionProxyHandler({alias:getTableName(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}}class PgRefreshMaterializedView extends QueryPromise{constructor(view,session,dialect){super();this.session=session,this.dialect=dialect,this.config={view}}static[entityKind]="PgRefreshMaterializedView";config;concurrently(){if(this.config.withNoData!==void 0)throw Error("Cannot use concurrently and withNoData together");return this.config.concurrently=!0,this}withNoData(){if(this.config.concurrently!==void 0)throw Error("Cannot use concurrently and withNoData together");return this.config.withNoData=!0,this}getSQL(){return this.dialect.buildRefreshMaterializedViewQuery(this.config)}toSQL(){let{typings:_typings,...rest}=this.dialect.sqlToQuery(this.getSQL());return rest}_prepare(name){return tracer.startActiveSpan("drizzle.prepareQuery",()=>{return this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),void 0,name,!0)})}prepare(name){return this._prepare(name)}authToken;setToken(token){return this.authToken=token,this}execute=(placeholderValues)=>{return tracer.startActiveSpan("drizzle.operation",()=>{return this._prepare().execute(placeholderValues,this.authToken)})}}class PgUpdateBuilder{constructor(table,session,dialect,withList){this.table=table,this.session=session,this.dialect=dialect,this.withList=withList}static[entityKind]="PgUpdateBuilder";authToken;setToken(token){return this.authToken=token,this}set(values2){return new PgUpdateBase(this.table,mapUpdateSet(this.table,values2),this.session,this.dialect,this.withList).setToken(this.authToken)}}class PgUpdateBase extends QueryPromise{constructor(table,set2,session,dialect,withList){super();this.session=session,this.dialect=dialect,this.config={set:set2,table,withList,joins:[]},this.tableName=getTableLikeName(table),this.joinsNotNullableMap=typeof this.tableName==="string"?{[this.tableName]:!0}:{}}static[entityKind]="PgUpdate";config;tableName;joinsNotNullableMap;cacheConfig;from(source){let src=source,tableName=getTableLikeName(src);if(typeof tableName==="string")this.joinsNotNullableMap[tableName]=!0;return this.config.from=src,this}getTableLikeFields(table){if(is(table,PgTable))return table[Table.Symbol.Columns];else if(is(table,Subquery))return table._.selectedFields;return table[ViewBaseConfig].selectedFields}createJoin(joinType){return(table,on)=>{let tableName=getTableLikeName(table);if(typeof tableName==="string"&&this.config.joins.some((join)=>join.alias===tableName))throw Error(`Alias "${tableName}" is already used in this query`);if(typeof on==="function"){let from=this.config.from&&!is(this.config.from,SQL)?this.getTableLikeFields(this.config.from):void 0;on=on(new Proxy(this.config.table[Table.Symbol.Columns],new SelectionProxyHandler({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})),from&&new Proxy(from,new SelectionProxyHandler({sqlAliasedBehavior:"sql",sqlBehavior:"sql"})))}if(this.config.joins.push({on,table,joinType,alias:tableName}),typeof tableName==="string")switch(joinType){case"left":{this.joinsNotNullableMap[tableName]=!1;break}case"right":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([key])=>[key,!1])),this.joinsNotNullableMap[tableName]=!0;break}case"inner":{this.joinsNotNullableMap[tableName]=!0;break}case"full":{this.joinsNotNullableMap=Object.fromEntries(Object.entries(this.joinsNotNullableMap).map(([key])=>[key,!1])),this.joinsNotNullableMap[tableName]=!1;break}}return this}}leftJoin=this.createJoin("left");rightJoin=this.createJoin("right");innerJoin=this.createJoin("inner");fullJoin=this.createJoin("full");where(where){return this.config.where=where,this}returning(fields){if(!fields){if(fields=Object.assign({},this.config.table[Table.Symbol.Columns]),this.config.from){let tableName=getTableLikeName(this.config.from);if(typeof tableName==="string"&&this.config.from&&!is(this.config.from,SQL)){let fromFields=this.getTableLikeFields(this.config.from);fields[tableName]=fromFields}for(let join of this.config.joins){let tableName2=getTableLikeName(join.table);if(typeof tableName2==="string"&&!is(join.table,SQL)){let fromFields=this.getTableLikeFields(join.table);fields[tableName2]=fromFields}}}}return this.config.returningFields=fields,this.config.returning=orderSelectedFields(fields),this}getSQL(){return this.dialect.buildUpdateQuery(this.config)}toSQL(){let{typings:_typings,...rest}=this.dialect.sqlToQuery(this.getSQL());return rest}_prepare(name){let query=this.session.prepareQuery(this.dialect.sqlToQuery(this.getSQL()),this.config.returning,name,!0,void 0,{type:"insert",tables:extractUsedTable(this.config.table)},this.cacheConfig);return query.joinsNotNullableMap=this.joinsNotNullableMap,query}prepare(name){return this._prepare(name)}authToken;setToken(token){return this.authToken=token,this}execute=(placeholderValues)=>{return this._prepare().execute(placeholderValues,this.authToken)};getSelectedFields(){return this.config.returningFields?new Proxy(this.config.returningFields,new SelectionProxyHandler({alias:getTableName(this.config.table),sqlAliasedBehavior:"alias",sqlBehavior:"error"})):void 0}$dynamic(){return this}}class PgCountBuilder extends SQL{constructor(params){super(PgCountBuilder.buildEmbeddedCount(params.source,params.filters).queryChunks);this.params=params,this.mapWith(Number),this.session=params.session,this.sql=PgCountBuilder.buildCount(params.source,params.filters)}sql;token;static[entityKind]="PgCountBuilder";[Symbol.toStringTag]="PgCountBuilder";session;static buildEmbeddedCount(source,filters){return sql`(select count(*) from ${source}${sql.raw(" where ").if(filters)}${filters})`}static buildCount(source,filters){return sql`select count(*) as count from ${source}${sql.raw(" where ").if(filters)}${filters};`}setToken(token){return this.token=token,this}then(onfulfilled,onrejected){return Promise.resolve(this.session.count(this.sql,this.token)).then(onfulfilled,onrejected)}catch(onRejected){return this.then(void 0,onRejected)}finally(onFinally){return this.then((value)=>{return onFinally?.(),value},(reason)=>{throw onFinally?.(),reason})}}class RelationalQueryBuilder{constructor(fullSchema,schema,tableNamesMap,table,tableConfig,dialect,session){this.fullSchema=fullSchema,this.schema=schema,this.tableNamesMap=tableNamesMap,this.table=table,this.tableConfig=tableConfig,this.dialect=dialect,this.session=session}static[entityKind]="PgRelationalQueryBuilder";findMany(config){return new PgRelationalQuery(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,config?config:{},"many")}findFirst(config){return new PgRelationalQuery(this.fullSchema,this.schema,this.tableNamesMap,this.table,this.tableConfig,this.dialect,this.session,config?{...config,limit:1}:{limit:1},"first")}}class PgRelationalQuery extends QueryPromise{constructor(fullSchema,schema,tableNamesMap,table,tableConfig,dialect,session,config,mode){super();this.fullSchema=fullSchema,this.schema=schema,this.tableNamesMap=tableNamesMap,this.table=table,this.tableConfig=tableConfig,this.dialect=dialect,this.session=session,this.config=config,this.mode=mode}static[entityKind]="PgRelationalQuery";_prepare(name){return tracer.startActiveSpan("drizzle.prepareQuery",()=>{let{query,builtQuery}=this._toSQL();return this.session.prepareQuery(builtQuery,void 0,name,!0,(rawRows,mapColumnValue)=>{let rows=rawRows.map((row)=>mapRelationalRow(this.schema,this.tableConfig,row,query.selection,mapColumnValue));if(this.mode==="first")return rows[0];return rows})})}prepare(name){return this._prepare(name)}_getQuery(){return this.dialect.buildRelationalQueryWithoutPK({fullSchema:this.fullSchema,schema:this.schema,tableNamesMap:this.tableNamesMap,table:this.table,tableConfig:this.tableConfig,queryConfig:this.config,tableAlias:this.tableConfig.tsName})}getSQL(){return this._getQuery().sql}_toSQL(){let query=this._getQuery(),builtQuery=this.dialect.sqlToQuery(query.sql);return{query,builtQuery}}toSQL(){return this._toSQL().builtQuery}authToken;setToken(token){return this.authToken=token,this}execute(){return tracer.startActiveSpan("drizzle.operation",()=>{return this._prepare().execute(void 0,this.authToken)})}}class PgRaw extends QueryPromise{constructor(execute,sql2,query,mapBatchResult){super();this.execute=execute,this.sql=sql2,this.query=query,this.mapBatchResult=mapBatchResult}static[entityKind]="PgRaw";getSQL(){return this.sql}getQuery(){return this.query}mapResult(result,isFromBatch){return isFromBatch?this.mapBatchResult(result):result}_prepare(){return this}isResponseInArrayMode(){return!1}}class PgDatabase{constructor(dialect,session,schema){if(this.dialect=dialect,this.session=session,this._=schema?{schema:schema.schema,fullSchema:schema.fullSchema,tableNamesMap:schema.tableNamesMap,session}:{schema:void 0,fullSchema:{},tableNamesMap:{},session},this.query={},this._.schema)for(let[tableName,columns]of Object.entries(this._.schema))this.query[tableName]=new RelationalQueryBuilder(schema.fullSchema,this._.schema,this._.tableNamesMap,schema.fullSchema[tableName],columns,dialect,session);this.$cache={invalidate:async(_params)=>{}}}static[entityKind]="PgDatabase";query;$with=(alias,selection)=>{let self2=this;return{as:(qb)=>{if(typeof qb==="function")qb=qb(new QueryBuilder(self2.dialect));return new Proxy(new WithSubquery(qb.getSQL(),selection??("getSelectedFields"in qb?qb.getSelectedFields()??{}:{}),alias,!0),new SelectionProxyHandler({alias,sqlAliasedBehavior:"alias",sqlBehavior:"error"}))}}};$count(source,filters){return new PgCountBuilder({source,filters,session:this.session})}$cache;with(...queries){let self2=this;function select2(fields){return new PgSelectBuilder({fields:fields??void 0,session:self2.session,dialect:self2.dialect,withList:queries})}function selectDistinct(fields){return new PgSelectBuilder({fields:fields??void 0,session:self2.session,dialect:self2.dialect,withList:queries,distinct:!0})}function selectDistinctOn(on,fields){return new PgSelectBuilder({fields:fields??void 0,session:self2.session,dialect:self2.dialect,withList:queries,distinct:{on}})}function update(table){return new PgUpdateBuilder(table,self2.session,self2.dialect,queries)}function insert(table){return new PgInsertBuilder(table,self2.session,self2.dialect,queries)}function delete_(table){return new PgDeleteBase(table,self2.session,self2.dialect,queries)}return{select:select2,selectDistinct,selectDistinctOn,update,insert,delete:delete_}}select(fields){return new PgSelectBuilder({fields:fields??void 0,session:this.session,dialect:this.dialect})}selectDistinct(fields){return new PgSelectBuilder({fields:fields??void 0,session:this.session,dialect:this.dialect,distinct:!0})}selectDistinctOn(on,fields){return new PgSelectBuilder({fields:fields??void 0,session:this.session,dialect:this.dialect,distinct:{on}})}update(table){return new PgUpdateBuilder(table,this.session,this.dialect)}insert(table){return new PgInsertBuilder(table,this.session,this.dialect)}delete(table){return new PgDeleteBase(table,this.session,this.dialect)}refreshMaterializedView(view){return new PgRefreshMaterializedView(view,this.session,this.dialect)}authToken;execute(query){let sequel=typeof query==="string"?sql.raw(query):query.getSQL(),builtQuery=this.dialect.sqlToQuery(sequel),prepared=this.session.prepareQuery(builtQuery,void 0,void 0,!1);return new PgRaw(()=>prepared.execute(void 0,this.authToken),sequel,builtQuery,(result)=>prepared.mapResult(result,!0))}transaction(transaction,config){return this.session.transaction(transaction,config)}}class Cache{static[entityKind]="Cache"}class NoopCache extends Cache{strategy(){return"all"}static[entityKind]="NoopCache";async get(_key){return}async put(_hashedQuery,_response,_tables,_config){}async onMutate(_params){}}async function hashQuery(sql2,params){let dataToHash=`${sql2}-${JSON.stringify(params)}`,data=new TextEncoder().encode(dataToHash),hashBuffer=await crypto.subtle.digest("SHA-256",data);return[...new Uint8Array(hashBuffer)].map((b2)=>b2.toString(16).padStart(2,"0")).join("")}class PgPreparedQuery{constructor(query,cache,queryMetadata,cacheConfig){if(this.query=query,this.cache=cache,this.queryMetadata=queryMetadata,this.cacheConfig=cacheConfig,cache&&cache.strategy()==="all"&&cacheConfig===void 0)this.cacheConfig={enable:!0,autoInvalidate:!0};if(!this.cacheConfig?.enable)this.cacheConfig=void 0}authToken;getQuery(){return this.query}mapResult(response,_isFromBatch){return response}setToken(token){return this.authToken=token,this}static[entityKind]="PgPreparedQuery";joinsNotNullableMap;async queryWithCache(queryString,params,query){if(this.cache===void 0||is(this.cache,NoopCache)||this.queryMetadata===void 0)try{return await query()}catch(e){throw new DrizzleQueryError(queryString,params,e)}if(this.cacheConfig&&!this.cacheConfig.enable)try{return await query()}catch(e){throw new DrizzleQueryError(queryString,params,e)}if((this.queryMetadata.type==="insert"||this.queryMetadata.type==="update"||this.queryMetadata.type==="delete")&&this.queryMetadata.tables.length>0)try{let[res]=await Promise.all([query(),this.cache.onMutate({tables:this.queryMetadata.tables})]);return res}catch(e){throw new DrizzleQueryError(queryString,params,e)}if(!this.cacheConfig)try{return await query()}catch(e){throw new DrizzleQueryError(queryString,params,e)}if(this.queryMetadata.type==="select"){let fromCache=await this.cache.get(this.cacheConfig.tag??await hashQuery(queryString,params),this.queryMetadata.tables,this.cacheConfig.tag!==void 0,this.cacheConfig.autoInvalidate);if(fromCache===void 0){let result;try{result=await query()}catch(e){throw new DrizzleQueryError(queryString,params,e)}return await this.cache.put(this.cacheConfig.tag??await hashQuery(queryString,params),result,this.cacheConfig.autoInvalidate?this.queryMetadata.tables:[],this.cacheConfig.tag!==void 0,this.cacheConfig.config),result}return fromCache}try{return await query()}catch(e){throw new DrizzleQueryError(queryString,params,e)}}}class PgSession{constructor(dialect){this.dialect=dialect}static[entityKind]="PgSession";execute(query,token){return tracer.startActiveSpan("drizzle.operation",()=>{return tracer.startActiveSpan("drizzle.prepareQuery",()=>{return this.prepareQuery(this.dialect.sqlToQuery(query),void 0,void 0,!1)}).setToken(token).execute(void 0,token)})}all(query){return this.prepareQuery(this.dialect.sqlToQuery(query),void 0,void 0,!1).all()}async count(sql2,token){let res=await this.execute(sql2,token);return Number(res[0].count)}}class PgTransaction extends PgDatabase{constructor(dialect,session,schema,nestedIndex=0){super(dialect,session,schema);this.schema=schema,this.nestedIndex=nestedIndex}static[entityKind]="PgTransaction";rollback(){throw new TransactionRollbackError}getTransactionConfigSQL(config){let chunks=[];if(config.isolationLevel)chunks.push(`isolation level ${config.isolationLevel}`);if(config.accessMode)chunks.push(config.accessMode);if(typeof config.deferrable==="boolean")chunks.push(config.deferrable?"deferrable":"not deferrable");return sql.raw(chunks.join(" "))}setTransaction(config){return this.session.execute(sql`set transaction ${this.getTransactionConfigSQL(config)}`)}}class PostgresJsPreparedQuery extends PgPreparedQuery{constructor(client,queryString,params,logger,cache,queryMetadata,cacheConfig,fields,_isResponseInArrayMode,customResultMapper){super({sql:queryString,params},cache,queryMetadata,cacheConfig);this.client=client,this.queryString=queryString,this.params=params,this.logger=logger,this.fields=fields,this._isResponseInArrayMode=_isResponseInArrayMode,this.customResultMapper=customResultMapper}static[entityKind]="PostgresJsPreparedQuery";async execute(placeholderValues={}){return tracer.startActiveSpan("drizzle.execute",async(span)=>{let params=fillPlaceholders(this.params,placeholderValues);span?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(params)}),this.logger.logQuery(this.queryString,params);let{fields,queryString:query,client,joinsNotNullableMap,customResultMapper}=this;if(!fields&&!customResultMapper)return tracer.startActiveSpan("drizzle.driver.execute",()=>{return this.queryWithCache(query,params,async()=>{return await client.unsafe(query,params)})});let rows=await tracer.startActiveSpan("drizzle.driver.execute",()=>{return span?.setAttributes({"drizzle.query.text":query,"drizzle.query.params":JSON.stringify(params)}),this.queryWithCache(query,params,async()=>{return await client.unsafe(query,params).values()})});return tracer.startActiveSpan("drizzle.mapResponse",()=>{return customResultMapper?customResultMapper(rows):rows.map((row)=>mapResultRow(fields,row,joinsNotNullableMap))})})}all(placeholderValues={}){return tracer.startActiveSpan("drizzle.execute",async(span)=>{let params=fillPlaceholders(this.params,placeholderValues);return span?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(params)}),this.logger.logQuery(this.queryString,params),tracer.startActiveSpan("drizzle.driver.execute",()=>{return span?.setAttributes({"drizzle.query.text":this.queryString,"drizzle.query.params":JSON.stringify(params)}),this.queryWithCache(this.queryString,params,async()=>{return this.client.unsafe(this.queryString,params)})})})}isResponseInArrayMode(){return this._isResponseInArrayMode}}class PostgresJsSession extends PgSession{constructor(client,dialect,schema,options={}){super(dialect);this.client=client,this.schema=schema,this.options=options,this.logger=options.logger??new NoopLogger,this.cache=options.cache??new NoopCache}static[entityKind]="PostgresJsSession";logger;cache;prepareQuery(query,fields,name,isResponseInArrayMode,customResultMapper,queryMetadata,cacheConfig){return new PostgresJsPreparedQuery(this.client,query.sql,query.params,this.logger,this.cache,queryMetadata,cacheConfig,fields,isResponseInArrayMode,customResultMapper)}query(query,params){return this.logger.logQuery(query,params),this.client.unsafe(query,params).values()}queryObjects(query,params){return this.client.unsafe(query,params)}transaction(transaction,config){return this.client.begin(async(client)=>{let session=new PostgresJsSession(client,this.dialect,this.schema,this.options),tx=new PostgresJsTransaction(this.dialect,session,this.schema);if(config)await tx.setTransaction(config);return transaction(tx)})}}class PostgresJsTransaction extends PgTransaction{constructor(dialect,session,schema,nestedIndex=0){super(dialect,session,schema,nestedIndex);this.session=session}static[entityKind]="PostgresJsTransaction";transaction(transaction){return this.session.client.savepoint((client)=>{let session=new PostgresJsSession(client,this.dialect,this.schema,this.session.options),tx=new PostgresJsTransaction(this.dialect,session,this.schema);return transaction(tx)})}}class PostgresJsDatabase extends PgDatabase{static[entityKind]="PostgresJsDatabase"}function construct(client,config={}){let transparentParser=(val)=>val;for(let type of["1184","1082","1083","1114","1182","1185","1115","1231"])client.options.parsers[type]=transparentParser,client.options.serializers[type]=transparentParser;client.options.serializers["114"]=transparentParser,client.options.serializers["3802"]=transparentParser;let dialect=new PgDialect({casing:config.casing}),logger;if(config.logger===!0)logger=new DefaultLogger;else if(config.logger!==!1)logger=config.logger;let schema;if(config.schema){let tablesConfig=extractTablesRelationalConfig(config.schema,createTableRelationsHelpers);schema={fullSchema:config.schema,schema:tablesConfig.tables,tableNamesMap:tablesConfig.tableNamesMap}}let session=new PostgresJsSession(client,dialect,schema,{logger,cache:config.cache}),db=new PostgresJsDatabase(dialect,session,schema);if(db.$client=client,db.$cache=config.cache,db.$cache)db.$cache.invalidate=config.cache?.onMutate;return db}function drizzle(...params){if(typeof params[0]==="string"){let instance=src_default(params[0]);return construct(instance,params[1])}if(isConfig(params[0])){let{connection:connection2,client,...drizzleConfig}=params[0];if(client)return construct(client,drizzleConfig);if(typeof connection2==="object"&&connection2.url!==void 0){let{url,...config}=connection2,instance2=src_default(url,config);return construct(instance2,drizzleConfig)}let instance=src_default(connection2);return construct(instance,drizzleConfig)}return construct(params[0],params[1])}((drizzle2)=>{function mock(config){return construct({options:{parsers:{},serializers:{}}},config)}drizzle2.mock=mock})(drizzle||(drizzle={}));var exports_schema={};__export(exports_schema,{userTable:()=>userTable,userSettingsTable:()=>userSettingsTable,userRoleEnum:()=>userRoleEnum,tenantTable:()=>tenantTable,tenantSettingsTable:()=>tenantSettingsTable,tenantRoleEnum:()=>tenantRoleEnum,tenantMembershipTable:()=>tenantMembershipTable,technicianTable:()=>technicianTable,subscriptionStatusEnum:()=>subscriptionStatusEnum,subscriptionPlanTable:()=>subscriptionPlanTable,signupIntentTable:()=>signupIntentTable,signupIntentStatusEnum:()=>signupIntentStatusEnum,sessionTable:()=>sessionTable,sellerTable:()=>sellerTable,saleTable:()=>saleTable,saleGiftAccessoryTable:()=>saleGiftAccessoryTable,repairTable:()=>repairTable,providerTable:()=>providerTable,phoneTable:()=>phoneTable,mpEventTable:()=>mpEventTable,headphoneTable:()=>headphoneTable,expenseTable:()=>expenseTable,clientTable:()=>clientTable,accessoryTable:()=>accessoryTable});var userRoleEnum=pgEnum("user_role",["admin","user"]),tenantRoleEnum=pgEnum("tenant_role",["owner","admin","staff"]),subscriptionStatusEnum=pgEnum("subscription_status",["inactive","pending","active","trial","past_due","canceled"]),signupIntentStatusEnum=pgEnum("signup_intent_status",["created","pending","approved","rejected","expired","consumed"]),subscriptionPlanTable=pgTable("subscription_plans",{plan_id:serial().primaryKey(),key:varchar({length:64}).notNull().unique(),name:varchar({length:255}).notNull(),price_amount:numeric({precision:12,scale:2}).notNull(),currency:varchar({length:8}).notNull().default("ARS"),mp_preapproval_plan_id:varchar({length:128}).notNull(),is_active:boolean().notNull().default(!0),created_at:timestamp({withTimezone:!0}).notNull().defaultNow()}),signupIntentTable=pgTable("signup_intents",{intent_id:text("intent_id").primaryKey(),email:varchar({length:255}).notNull(),password_hash:text("password_hash").notNull(),plan_id:integer("plan_id").notNull().references(()=>subscriptionPlanTable.plan_id),status:signupIntentStatusEnum().notNull().default("created"),mp_preapproval_id:varchar({length:128}),mp_init_point:text("mp_init_point"),external_reference:varchar({length:128}).notNull(),approved_at:timestamp({withTimezone:!0}),consumed_at:timestamp({withTimezone:!0}),created_at:timestamp({withTimezone:!0}).notNull().defaultNow(),updated_at:timestamp({withTimezone:!0}).notNull().defaultNow()},(t2)=>({emailIdx:index("signup_intents_email_idx").on(t2.email),statusIdx:index("signup_intents_status_idx").on(t2.status),extRefUnique:uniqueIndex("signup_intents_external_reference_unique").on(t2.external_reference)})),userTable=pgTable("users",{user_id:serial().primaryKey(),email:varchar({length:255}).notNull(),password_hash:text("password_hash").notNull(),created_at:timestamp({withTimezone:!0}).defaultNow(),role:userRoleEnum().default("user"),is_active:boolean().notNull().default(!0),last_login:timestamp({withTimezone:!0})},(t2)=>({emailUnique:uniqueIndex("users_email_unique").on(t2.email)})),userSettingsTable=pgTable("user_settings",{user_id:integer("user_id").primaryKey().references(()=>userTable.user_id,{onDelete:"cascade"}),display_name:varchar({length:120}),phone:varchar({length:32}),email_notifications:boolean().notNull().default(!0),updated_at:timestamp({withTimezone:!0}).notNull().defaultNow()}),tenantTable=pgTable("tenants",{tenant_id:serial().primaryKey(),name:varchar({length:255}).notNull(),is_active:boolean().notNull().default(!0),created_at:timestamp({withTimezone:!0}).notNull().defaultNow(),updated_at:timestamp({withTimezone:!0}).notNull().defaultNow()},(t2)=>({nameIdx:index("tenants_name_idx").on(t2.name)})),tenantMembershipTable=pgTable("tenant_memberships",{membership_id:serial().primaryKey(),tenant_id:integer("tenant_id").notNull().references(()=>tenantTable.tenant_id,{onDelete:"cascade"}),user_id:integer("user_id").notNull().references(()=>userTable.user_id,{onDelete:"cascade"}),role:tenantRoleEnum().notNull().default("staff"),created_at:timestamp({withTimezone:!0}).notNull().defaultNow(),is_active:boolean().notNull().default(!0)},(t2)=>({tenantUserUnique:uniqueIndex("tenant_memberships_tenant_user_unique").on(t2.tenant_id,t2.user_id),tenantIdx:index("tenant_memberships_tenant_idx").on(t2.tenant_id),userIdx:index("tenant_memberships_user_idx").on(t2.user_id)})),tenantSettingsTable=pgTable("tenant_settings",{tenant_id:integer("tenant_id").primaryKey().references(()=>tenantTable.tenant_id,{onDelete:"cascade"}),business_name:varchar({length:255}),logo_key:varchar({length:1024}),logo_mime:varchar({length:100}),logo_updated_at:timestamp({withTimezone:!0}),cuit:varchar({length:32}),address:varchar({length:255}),display_currency:varchar({length:8}).notNull().default("ARS"),timezone:varchar({length:64}).notNull().default("America/Argentina/Buenos_Aires"),low_stock_threshold_default:integer().notNull().default(3),updated_at:timestamp({withTimezone:!0}).notNull().defaultNow(),subscription_status:subscriptionStatusEnum().notNull().default("inactive"),subscription_plan_id:integer("subscription_plan_id").references(()=>subscriptionPlanTable.plan_id),trial_ends_at:timestamp({withTimezone:!0}),mp_preapproval_id:varchar({length:128}),subscription_started_at:timestamp({withTimezone:!0}),current_period_end:timestamp({withTimezone:!0}),last_mp_event_at:timestamp({withTimezone:!0})}),mpEventTable=pgTable("mp_events",{mp_event_id:text().primaryKey(),intent_id:text("intent_id").references(()=>signupIntentTable.intent_id,{onDelete:"set null"}),topic:varchar({length:64}).notNull(),resource_id:varchar({length:128}).notNull(),tenant_id:integer("tenant_id").references(()=>tenantTable.tenant_id,{onDelete:"cascade"}),payload:jsonb().notNull(),received_at:timestamp({withTimezone:!0}).notNull().defaultNow(),processed_at:timestamp({withTimezone:!0})}),sessionTable=pgTable("sessions",{session_id:text().primaryKey(),user_id:integer("user_id").notNull().references(()=>userTable.user_id,{onDelete:"cascade"}),tenant_id:integer("tenant_id").notNull().references(()=>tenantTable.tenant_id,{onDelete:"cascade"}),created_at:timestamp({withTimezone:!0}).notNull().defaultNow(),expires_at:timestamp({withTimezone:!0}).notNull(),last_used:timestamp({withTimezone:!0}),revoked_at:timestamp("revoked_at",{withTimezone:!0})},(t2)=>({user_idx:index("sessions_user_id_idx").on(t2.user_id),expires_idx:index("sessions_expires_at_idx").on(t2.expires_at)})),clientTable=pgTable("client",{client_id:integer().primaryKey().generatedAlwaysAsIdentity(),name:varchar({length:255}).notNull(),email:varchar({length:255}),phone_number:varchar({length:16}),id_number:bigint({mode:"number"}).notNull(),birth_date:date2(),debt:integer().default(0),is_deleted:boolean().default(!1),tenant_id:integer("tenant_id").notNull().references(()=>tenantTable.tenant_id,{onDelete:"cascade"})},(t2)=>({tenantDeletedIdx:index("client_tenant_deleted_idx").on(t2.tenant_id,t2.is_deleted),tenantIdNumberUnique:uniqueIndex("client_tenant_id_number_unique").on(t2.tenant_id,t2.id_number)})),technicianTable=pgTable("technician",{technician_id:integer().primaryKey().generatedAlwaysAsIdentity(),name:varchar({length:255}).notNull(),email:varchar({length:255}),phone_number:varchar({length:16}),speciality:varchar({length:255}).notNull(),state:varchar({length:100}).notNull(),is_deleted:boolean().default(!1),tenant_id:integer("tenant_id").notNull().references(()=>tenantTable.tenant_id,{onDelete:"cascade"})},(t2)=>({tenantDeletedIdx:index("technician_tenant_deleted_idx").on(t2.tenant_id,t2.is_deleted)})),providerTable=pgTable("provider",{provider_id:integer().primaryKey().generatedAlwaysAsIdentity(),name:varchar({length:255}).notNull(),phone_number:varchar({length:255}).notNull(),email:varchar({length:255}),address:varchar("address",{length:255}).notNull(),is_deleted:boolean().default(!1),tenant_id:integer("tenant_id").notNull().references(()=>tenantTable.tenant_id,{onDelete:"cascade"})},(t2)=>({tenantDeletedIdx:index("provider_tenant_deleted_idx").on(t2.tenant_id,t2.is_deleted)})),expenseTable=pgTable("expense",{expense_id:integer().primaryKey().generatedAlwaysAsIdentity(),datetime:timestamp().notNull().defaultNow(),category:varchar({length:255}).notNull(),description:varchar({length:255}),amount:numeric({precision:12,scale:2}).notNull(),currency:varchar({length:8}).notNull().default("USD"),payment_method:varchar({length:50}).notNull(),receipt_key:varchar({length:1024}),receipt_original_name:varchar({length:255}),receipt_mime:varchar({length:100}),receipt_size:integer(),receipt_uploaded_at:timestamp(),provider_id:integer().references(()=>providerTable.provider_id),is_deleted:boolean().default(!1),sale_id:integer().references(()=>saleTable.sale_id),tenant_id:integer("tenant_id").notNull().references(()=>tenantTable.tenant_id,{onDelete:"cascade"}),created_by_user_id:integer("created_by_user_id").references(()=>userTable.user_id)},(t2)=>({tenantSaleIdx:index("expense_tenant_sale_idx").on(t2.tenant_id,t2.sale_id),tenantDeletedIdx:index("expense_tenant_deleted_idx").on(t2.tenant_id,t2.is_deleted),tenantDatetimeIdx:index("expense_tenant_datetime_idx").on(t2.tenant_id,t2.datetime)})),phoneTable=pgTable("phone",{device_id:integer().primaryKey().generatedAlwaysAsIdentity(),datetime:timestamp().notNull().defaultNow(),name:varchar({length:255}).notNull(),brand:varchar({length:100}).notNull(),imei:varchar({length:100}).notNull(),device_type:varchar({length:100}).notNull(),battery_health:integer(),storage_capacity:integer(),color:varchar({length:50}),category:varchar({length:100}).notNull(),price:numeric({precision:12,scale:2}).notNull(),buy_cost:numeric({precision:12,scale:2}).notNull(),currency_buy:varchar({length:8}).notNull().default("USD"),currency_sale:varchar({length:8}).notNull().default("USD"),deposit:varchar({length:255}).notNull(),sold:boolean().default(!1).notNull(),trade_in:boolean().default(!1),is_deleted:boolean().default(!1),in_repair:boolean().default(!1),tenant_id:integer("tenant_id").notNull().references(()=>tenantTable.tenant_id,{onDelete:"cascade"})},(t2)=>[index("phone_tenant_deleted_idx").on(t2.tenant_id,t2.is_deleted),index("phone_tenant_sold_idx").on(t2.tenant_id,t2.sold),index("phone_tenant_datetime_idx").on(t2.tenant_id,t2.datetime),uniqueIndex("phone_tenant_imei_unique").on(t2.tenant_id,t2.imei)]),headphoneTable=pgTable("headphone",{device_id:integer().primaryKey().generatedAlwaysAsIdentity(),datetime:timestamp().notNull().defaultNow(),name:varchar({length:255}).notNull(),brand:varchar({length:100}).notNull(),imei:varchar({length:100}),device_type:varchar({length:100}).notNull(),color:varchar({length:50}),category:varchar({length:100}).notNull(),price:numeric({precision:12,scale:2}).notNull(),buy_cost:numeric({precision:12,scale:2}).notNull(),currency_buy:varchar({length:8}).notNull().default("USD"),currency_sale:varchar({length:8}).notNull().default("USD"),deposit:varchar({length:255}).notNull(),sold:boolean().default(!1).notNull(),trade_in:boolean().default(!1),is_deleted:boolean().default(!1),in_repair:boolean().default(!1),tenant_id:integer("tenant_id").notNull().references(()=>tenantTable.tenant_id,{onDelete:"cascade"})},(t2)=>[index("headphone_tenant_deleted_idx").on(t2.tenant_id,t2.is_deleted),index("headphone_tenant_sold_idx").on(t2.tenant_id,t2.sold),index("headphone_tenant_datetime_idx").on(t2.tenant_id,t2.datetime),uniqueIndex("headphone_tenant_imei_unique").on(t2.tenant_id,t2.imei)]),accessoryTable=pgTable("accessory",{accessory_id:integer().primaryKey().generatedAlwaysAsIdentity(),datetime:timestamp().notNull().defaultNow(),name:varchar({length:255}).notNull(),brand:varchar({length:100}).notNull(),stock:integer().notNull().default(0),color:varchar({length:50}),category:varchar({length:100}).notNull(),price:numeric({precision:12,scale:2}).notNull(),buy_cost:numeric({precision:12,scale:2}).notNull(),currency_buy:varchar({length:8}).notNull().default("USD"),currency_sale:varchar({length:8}).notNull().default("USD"),deposit:varchar({length:255}).notNull(),gift:boolean().default(!1).notNull(),is_deleted:boolean().default(!1),tenant_id:integer("tenant_id").notNull().references(()=>tenantTable.tenant_id,{onDelete:"cascade"})},(t2)=>[index("accessory_tenant_deleted_idx").on(t2.tenant_id,t2.is_deleted),index("accessory_tenant_datetime_idx").on(t2.tenant_id,t2.datetime)]),repairTable=pgTable("repair",{repair_id:integer().primaryKey().generatedAlwaysAsIdentity(),datetime:timestamp().notNull().defaultNow(),repair_state:varchar({length:100}).notNull(),priority:varchar({length:50}).notNull(),description:varchar({length:255}).notNull(),diagnostic:varchar({length:255}),client_cost:numeric({precision:12,scale:2}).notNull(),internal_cost:numeric({precision:12,scale:2}).notNull(),currency_buy:varchar({length:8}).notNull().default("USD"),currency_sale:varchar({length:8}).notNull().default("USD"),client_id:integer().references(()=>clientTable.client_id).notNull(),technician_id:integer().references(()=>technicianTable.technician_id).notNull(),device_id:integer().references(()=>phoneTable.device_id).notNull(),is_deleted:boolean().default(!1),tenant_id:integer("tenant_id").notNull().references(()=>tenantTable.tenant_id,{onDelete:"cascade"})},(t2)=>({tenantDeletedIdx:index("repair_tenant_deleted_idx").on(t2.tenant_id,t2.is_deleted),tenantDatetimeIdx:index("repair_tenant_datetime_idx").on(t2.tenant_id,t2.datetime)})),saleTable=pgTable("sale",{sale_id:integer().primaryKey().generatedAlwaysAsIdentity(),datetime:timestamp().notNull().defaultNow(),total_amount:numeric({precision:12,scale:2}).notNull(),currency:varchar({length:8}).notNull().default("USD"),payment_method:varchar({length:50}).notNull(),debt:boolean().default(!1).notNull(),debt_amount:numeric({precision:12,scale:2}),client_id:integer().references(()=>clientTable.client_id).notNull(),seller_id:integer().references(()=>sellerTable.seller_id).notNull(),device_id:integer().references(()=>phoneTable.device_id).notNull(),trade_in_device:integer().references(()=>phoneTable.device_id),is_deleted:boolean().default(!1),tenant_id:integer("tenant_id").notNull().references(()=>tenantTable.tenant_id,{onDelete:"cascade"})},(t2)=>({tenantDeletedIdx:index("sale_tenant_deleted_idx").on(t2.tenant_id,t2.is_deleted),tenantDatetimeIdx:index("sale_tenant_datetime_idx").on(t2.tenant_id,t2.datetime)})),saleGiftAccessoryTable=pgTable("sale_gift_accessory",{sale_gift_id:integer().primaryKey().generatedAlwaysAsIdentity(),sale_id:integer().notNull().references(()=>saleTable.sale_id,{onDelete:"cascade"}),accessory_id:integer().notNull().references(()=>accessoryTable.accessory_id,{onDelete:"restrict"}),qty:integer().notNull().default(1),unit_price:numeric({precision:12,scale:2}).notNull(),unit_buy_cost:numeric({precision:12,scale:2}).notNull(),tenant_id:integer("tenant_id").notNull().references(()=>tenantTable.tenant_id,{onDelete:"cascade"}),is_deleted:boolean().default(!1)},(t2)=>({saleIdx:index("sale_gift_sale_idx").on(t2.tenant_id,t2.sale_id),accessoryIdx:index("sale_gift_accessory_idx").on(t2.tenant_id,t2.accessory_id),uniq:unique("sale_gift_unique").on(t2.sale_id,t2.accessory_id)})),sellerTable=pgTable("seller",{seller_id:integer().primaryKey().generatedAlwaysAsIdentity(),name:varchar({length:255}).notNull(),age:integer().notNull(),email:varchar({length:255}),phone_number:varchar({length:16}),hire_date:date2().notNull().default(sql`CURRENT_DATE`),pay_date:date2().default(sql`CURRENT_DATE`),commission:numeric({precision:5,scale:2}).default("0.00"),is_deleted:boolean().default(!1),tenant_id:integer("tenant_id").notNull().references(()=>tenantTable.tenant_id,{onDelete:"cascade"})},(t2)=>({tenantDeletedIdx:index("seller_tenant_deleted_idx").on(t2.tenant_id,t2.is_deleted)}));var connection2=await src_default(process.env.DB_URL),db=drizzle(connection2,{schema:exports_schema});import{randomBytes as randomBytes2}from"crypto";import nodeCrypto from"crypto";var randomFallback=null;function randomBytes(len){try{return crypto.getRandomValues(new Uint8Array(len))}catch{}try{return nodeCrypto.randomBytes(len)}catch{}if(!randomFallback)throw Error("Neither WebCryptoAPI nor a crypto module is available. Use bcrypt.setRandomFallback to set an alternative");return randomFallback(len)}function genSaltSync(rounds,seed_length){if(rounds=rounds||GENSALT_DEFAULT_LOG2_ROUNDS,typeof rounds!=="number")throw Error("Illegal arguments: "+typeof rounds+", "+typeof seed_length);if(rounds<4)rounds=4;else if(rounds>31)rounds=31;var salt=[];if(salt.push("$2b$"),rounds<10)salt.push("0");return salt.push(rounds.toString()),salt.push("$"),salt.push(base64_encode(randomBytes(BCRYPT_SALT_LEN),BCRYPT_SALT_LEN)),salt.join("")}function genSalt(rounds,seed_length,callback){if(typeof seed_length==="function")callback=seed_length,seed_length=void 0;if(typeof rounds==="function")callback=rounds,rounds=void 0;if(typeof rounds>"u")rounds=GENSALT_DEFAULT_LOG2_ROUNDS;else if(typeof rounds!=="number")throw Error("illegal arguments: "+typeof rounds);function _async(callback2){nextTick(function(){try{callback2(null,genSaltSync(rounds))}catch(err){callback2(err)}})}if(callback){if(typeof callback!=="function")throw Error("Illegal callback: "+typeof callback);_async(callback)}else return new Promise(function(resolve,reject){_async(function(err,res){if(err){reject(err);return}resolve(res)})})}function hash2(password,salt,callback,progressCallback){function _async(callback2){if(typeof password==="string"&&typeof salt==="number")genSalt(salt,function(err,salt2){_hash(password,salt2,callback2,progressCallback)});else if(typeof password==="string"&&typeof salt==="string")_hash(password,salt,callback2,progressCallback);else nextTick(callback2.bind(this,Error("Illegal arguments: "+typeof password+", "+typeof salt)))}if(callback){if(typeof callback!=="function")throw Error("Illegal callback: "+typeof callback);_async(callback)}else return new Promise(function(resolve,reject){_async(function(err,res){if(err){reject(err);return}resolve(res)})})}function safeStringCompare(known,unknown){var diff=known.length^unknown.length;for(var i=0;i<known.length;++i)diff|=known.charCodeAt(i)^unknown.charCodeAt(i);return diff===0}function compare(password,hashValue,callback,progressCallback){function _async(callback2){if(typeof password!=="string"||typeof hashValue!=="string"){nextTick(callback2.bind(this,Error("Illegal arguments: "+typeof password+", "+typeof hashValue)));return}if(hashValue.length!==60){nextTick(callback2.bind(this,null,!1));return}hash2(password,hashValue.substring(0,29),function(err,comp){if(err)callback2(err);else callback2(null,safeStringCompare(comp,hashValue))},progressCallback)}if(callback){if(typeof callback!=="function")throw Error("Illegal callback: "+typeof callback);_async(callback)}else return new Promise(function(resolve,reject){_async(function(err,res){if(err){reject(err);return}resolve(res)})})}var nextTick=typeof setImmediate==="function"?setImmediate:typeof scheduler==="object"&&typeof scheduler.postTask==="function"?scheduler.postTask.bind(scheduler):setTimeout;function utf8Length(string){var len=0,c=0;for(var i=0;i<string.length;++i)if(c=string.charCodeAt(i),c<128)len+=1;else if(c<2048)len+=2;else if((c&64512)===55296&&(string.charCodeAt(i+1)&64512)===56320)++i,len+=4;else len+=3;return len}function utf8Array(string){var offset=0,c1,c2,buffer2=Array(utf8Length(string));for(var i=0,k2=string.length;i<k2;++i)if(c1=string.charCodeAt(i),c1<128)buffer2[offset++]=c1;else if(c1<2048)buffer2[offset++]=c1>>6|192,buffer2[offset++]=c1&63|128;else if((c1&64512)===55296&&((c2=string.charCodeAt(i+1))&64512)===56320)c1=65536+((c1&1023)<<10)+(c2&1023),++i,buffer2[offset++]=c1>>18|240,buffer2[offset++]=c1>>12&63|128,buffer2[offset++]=c1>>6&63|128,buffer2[offset++]=c1&63|128;else buffer2[offset++]=c1>>12|224,buffer2[offset++]=c1>>6&63|128,buffer2[offset++]=c1&63|128;return buffer2}var BASE64_CODE="./ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),BASE64_INDEX=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,54,55,56,57,58,59,60,61,62,63,-1,-1,-1,-1,-1,-1,-1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,-1,-1,-1,-1,-1,-1,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,-1,-1,-1,-1,-1];function base64_encode(b2,len){var off=0,rs=[],c1,c2;if(len<=0||len>b2.length)throw Error("Illegal len: "+len);while(off<len){if(c1=b2[off++]&255,rs.push(BASE64_CODE[c1>>2&63]),c1=(c1&3)<<4,off>=len){rs.push(BASE64_CODE[c1&63]);break}if(c2=b2[off++]&255,c1|=c2>>4&15,rs.push(BASE64_CODE[c1&63]),c1=(c2&15)<<2,off>=len){rs.push(BASE64_CODE[c1&63]);break}c2=b2[off++]&255,c1|=c2>>6&3,rs.push(BASE64_CODE[c1&63]),rs.push(BASE64_CODE[c2&63])}return rs.join("")}function base64_decode(s,len){var off=0,slen=s.length,olen=0,rs=[],c1,c2,c3,c4,o,code;if(len<=0)throw Error("Illegal len: "+len);while(off<slen-1&&olen<len){if(code=s.charCodeAt(off++),c1=code<BASE64_INDEX.length?BASE64_INDEX[code]:-1,code=s.charCodeAt(off++),c2=code<BASE64_INDEX.length?BASE64_INDEX[code]:-1,c1==-1||c2==-1)break;if(o=c1<<2>>>0,o|=(c2&48)>>4,rs.push(String.fromCharCode(o)),++olen>=len||off>=slen)break;if(code=s.charCodeAt(off++),c3=code<BASE64_INDEX.length?BASE64_INDEX[code]:-1,c3==-1)break;if(o=(c2&15)<<4>>>0,o|=(c3&60)>>2,rs.push(String.fromCharCode(o)),++olen>=len||off>=slen)break;code=s.charCodeAt(off++),c4=code<BASE64_INDEX.length?BASE64_INDEX[code]:-1,o=(c3&3)<<6>>>0,o|=c4,rs.push(String.fromCharCode(o)),++olen}var res=[];for(off=0;off<olen;off++)res.push(rs[off].charCodeAt(0));return res}var BCRYPT_SALT_LEN=16,GENSALT_DEFAULT_LOG2_ROUNDS=10,BLOWFISH_NUM_ROUNDS=16,MAX_EXECUTION_TIME=100,P_ORIG=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],S_ORIG=[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946,1266315497,3048417604,3681880366,3289982499,2909710000,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055,3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504,976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409000,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462],C_ORIG=[1332899944,1700884034,1701343084,1684370003,1668446532,1869963892];function _encipher(lr,off,P,S){var n2,l2=lr[off],r2=lr[off+1];return l2^=P[0],n2=S[l2>>>24],n2+=S[256|l2>>16&255],n2^=S[512|l2>>8&255],n2+=S[768|l2&255],r2^=n2^P[1],n2=S[r2>>>24],n2+=S[256|r2>>16&255],n2^=S[512|r2>>8&255],n2+=S[768|r2&255],l2^=n2^P[2],n2=S[l2>>>24],n2+=S[256|l2>>16&255],n2^=S[512|l2>>8&255],n2+=S[768|l2&255],r2^=n2^P[3],n2=S[r2>>>24],n2+=S[256|r2>>16&255],n2^=S[512|r2>>8&255],n2+=S[768|r2&255],l2^=n2^P[4],n2=S[l2>>>24],n2+=S[256|l2>>16&255],n2^=S[512|l2>>8&255],n2+=S[768|l2&255],r2^=n2^P[5],n2=S[r2>>>24],n2+=S[256|r2>>16&255],n2^=S[512|r2>>8&255],n2+=S[768|r2&255],l2^=n2^P[6],n2=S[l2>>>24],n2+=S[256|l2>>16&255],n2^=S[512|l2>>8&255],n2+=S[768|l2&255],r2^=n2^P[7],n2=S[r2>>>24],n2+=S[256|r2>>16&255],n2^=S[512|r2>>8&255],n2+=S[768|r2&255],l2^=n2^P[8],n2=S[l2>>>24],n2+=S[256|l2>>16&255],n2^=S[512|l2>>8&255],n2+=S[768|l2&255],r2^=n2^P[9],n2=S[r2>>>24],n2+=S[256|r2>>16&255],n2^=S[512|r2>>8&255],n2+=S[768|r2&255],l2^=n2^P[10],n2=S[l2>>>24],n2+=S[256|l2>>16&255],n2^=S[512|l2>>8&255],n2+=S[768|l2&255],r2^=n2^P[11],n2=S[r2>>>24],n2+=S[256|r2>>16&255],n2^=S[512|r2>>8&255],n2+=S[768|r2&255],l2^=n2^P[12],n2=S[l2>>>24],n2+=S[256|l2>>16&255],n2^=S[512|l2>>8&255],n2+=S[768|l2&255],r2^=n2^P[13],n2=S[r2>>>24],n2+=S[256|r2>>16&255],n2^=S[512|r2>>8&255],n2+=S[768|r2&255],l2^=n2^P[14],n2=S[l2>>>24],n2+=S[256|l2>>16&255],n2^=S[512|l2>>8&255],n2+=S[768|l2&255],r2^=n2^P[15],n2=S[r2>>>24],n2+=S[256|r2>>16&255],n2^=S[512|r2>>8&255],n2+=S[768|r2&255],l2^=n2^P[16],lr[off]=r2^P[BLOWFISH_NUM_ROUNDS+1],lr[off+1]=l2,lr}function _streamtoword(data,offp){for(var i=0,word=0;i<4;++i)word=word<<8|data[offp]&255,offp=(offp+1)%data.length;return{key:word,offp}}function _key(key,P,S){var offset=0,lr=[0,0],plen=P.length,slen=S.length,sw;for(var i=0;i<plen;i++)sw=_streamtoword(key,offset),offset=sw.offp,P[i]=P[i]^sw.key;for(i=0;i<plen;i+=2)lr=_encipher(lr,0,P,S),P[i]=lr[0],P[i+1]=lr[1];for(i=0;i<slen;i+=2)lr=_encipher(lr,0,P,S),S[i]=lr[0],S[i+1]=lr[1]}function _ekskey(data,key,P,S){var offp=0,lr=[0,0],plen=P.length,slen=S.length,sw;for(var i=0;i<plen;i++)sw=_streamtoword(key,offp),offp=sw.offp,P[i]=P[i]^sw.key;offp=0;for(i=0;i<plen;i+=2)sw=_streamtoword(data,offp),offp=sw.offp,lr[0]^=sw.key,sw=_streamtoword(data,offp),offp=sw.offp,lr[1]^=sw.key,lr=_encipher(lr,0,P,S),P[i]=lr[0],P[i+1]=lr[1];for(i=0;i<slen;i+=2)sw=_streamtoword(data,offp),offp=sw.offp,lr[0]^=sw.key,sw=_streamtoword(data,offp),offp=sw.offp,lr[1]^=sw.key,lr=_encipher(lr,0,P,S),S[i]=lr[0],S[i+1]=lr[1]}function _crypt(b2,salt,rounds,callback,progressCallback){var cdata=C_ORIG.slice(),clen=cdata.length,err;if(rounds<4||rounds>31)if(err=Error("Illegal number of rounds (4-31): "+rounds),callback){nextTick(callback.bind(this,err));return}else throw err;if(salt.length!==BCRYPT_SALT_LEN)if(err=Error("Illegal salt length: "+salt.length+" != "+BCRYPT_SALT_LEN),callback){nextTick(callback.bind(this,err));return}else throw err;rounds=1<<rounds>>>0;var P,S,i=0,j;if(typeof Int32Array==="function")P=new Int32Array(P_ORIG),S=new Int32Array(S_ORIG);else P=P_ORIG.slice(),S=S_ORIG.slice();_ekskey(salt,b2,P,S);function next(){if(progressCallback)progressCallback(i/rounds);if(i<rounds){var start=Date.now();for(;i<rounds;)if(i=i+1,_key(b2,P,S),_key(salt,P,S),Date.now()-start>MAX_EXECUTION_TIME)break}else{for(i=0;i<64;i++)for(j=0;j<clen>>1;j++)_encipher(cdata,j<<1,P,S);var ret=[];for(i=0;i<clen;i++)ret.push((cdata[i]>>24&255)>>>0),ret.push((cdata[i]>>16&255)>>>0),ret.push((cdata[i]>>8&255)>>>0),ret.push((cdata[i]&255)>>>0);if(callback){callback(null,ret);return}else return ret}if(callback)nextTick(next)}if(typeof callback<"u")next();else{var res;while(!0)if(typeof(res=next())<"u")return res||[]}}function _hash(password,salt,callback,progressCallback){var err;if(typeof password!=="string"||typeof salt!=="string")if(err=Error("Invalid string / salt: Not a string"),callback){nextTick(callback.bind(this,err));return}else throw err;var minor,offset;if(salt.charAt(0)!=="$"||salt.charAt(1)!=="2")if(err=Error("Invalid salt version: "+salt.substring(0,2)),callback){nextTick(callback.bind(this,err));return}else throw err;if(salt.charAt(2)==="$")minor=String.fromCharCode(0),offset=3;else{if(minor=salt.charAt(2),minor!=="a"&&minor!=="b"&&minor!=="y"||salt.charAt(3)!=="$")if(err=Error("Invalid salt revision: "+salt.substring(2,4)),callback){nextTick(callback.bind(this,err));return}else throw err;offset=4}if(salt.charAt(offset+2)>"$")if(err=Error("Missing salt rounds"),callback){nextTick(callback.bind(this,err));return}else throw err;var r1=parseInt(salt.substring(offset,offset+1),10)*10,r2=parseInt(salt.substring(offset+1,offset+2),10),rounds=r1+r2,real_salt=salt.substring(offset+3,offset+25);password+=minor>="a"?"\x00":"";var passwordb=utf8Array(password),saltb=base64_decode(real_salt,BCRYPT_SALT_LEN);function finish(bytes){var res=[];if(res.push("$2"),minor>="a")res.push(minor);if(res.push("$"),rounds<10)res.push("0");return res.push(rounds.toString()),res.push("$"),res.push(base64_encode(saltb,saltb.length)),res.push(base64_encode(bytes,C_ORIG.length*4-1)),res.join("")}if(typeof callback>"u")return finish(_crypt(passwordb,saltb,rounds));else _crypt(passwordb,saltb,rounds,function(err2,bytes){if(err2)callback(err2,null);else callback(null,finish(bytes))},progressCallback)}var CONSTANTS={INT8_MIN:-128,INT8_MAX:127,INT8_UNSIGNED_MAX:255,INT16_MIN:-32768,INT16_MAX:32767,INT16_UNSIGNED_MAX:65535,INT24_MIN:-8388608,INT24_MAX:8388607,INT24_UNSIGNED_MAX:16777215,INT32_MIN:-2147483648,INT32_MAX:2147483647,INT32_UNSIGNED_MAX:4294967295,INT48_MIN:-140737488355328,INT48_MAX:140737488355327,INT48_UNSIGNED_MAX:281474976710655,INT64_MIN:-9223372036854775808n,INT64_MAX:9223372036854775807n,INT64_UNSIGNED_MAX:18446744073709551615n};function isColumnType(column,columnTypes){return columnTypes.includes(column.columnType)}function isWithEnum(column){return"enumValues"in column&&Array.isArray(column.enumValues)&&column.enumValues.length>0}var literalSchema=Type.Union([Type.String(),Type.Number(),Type.Boolean(),Type.Null()]),jsonSchema=Type.Union([literalSchema,Type.Array(Type.Any()),Type.Record(Type.String(),Type.Any())]);exports_type2.Set("Buffer",(_2,value)=>value instanceof Buffer);var bufferSchema={[Kind]:"Buffer",type:"buffer"};function mapEnumValues(values2){return Object.fromEntries(values2.map((value)=>[value,value]))}function columnToSchema(column,t2){let schema;if(isWithEnum(column))schema=column.enumValues.length?t2.Enum(mapEnumValues(column.enumValues)):t2.String();if(!schema){if(isColumnType(column,["PgGeometry","PgPointTuple"]))schema=t2.Tuple([t2.Number(),t2.Number()]);else if(isColumnType(column,["PgGeometryObject","PgPointObject"]))schema=t2.Object({x:t2.Number(),y:t2.Number()});else if(isColumnType(column,["PgHalfVector","PgVector"]))schema=t2.Array(t2.Number(),column.dimensions?{minItems:column.dimensions,maxItems:column.dimensions}:void 0);else if(isColumnType(column,["PgLine"]))schema=t2.Tuple([t2.Number(),t2.Number(),t2.Number()]);else if(isColumnType(column,["PgLineABC"]))schema=t2.Object({a:t2.Number(),b:t2.Number(),c:t2.Number()});else if(isColumnType(column,["PgArray"]))schema=t2.Array(columnToSchema(column.baseColumn,t2),column.size?{minItems:column.size,maxItems:column.size}:void 0);else if(column.dataType==="array")schema=t2.Array(t2.Any());else if(column.dataType==="number")schema=numberColumnToSchema(column,t2);else if(column.dataType==="bigint")schema=bigintColumnToSchema(column,t2);else if(column.dataType==="boolean")schema=t2.Boolean();else if(column.dataType==="date")schema=t2.Date();else if(column.dataType==="string")schema=stringColumnToSchema(column,t2);else if(column.dataType==="json")schema=jsonSchema;else if(column.dataType==="custom")schema=t2.Any();else if(column.dataType==="buffer")schema=bufferSchema}if(!schema)schema=t2.Any();return schema}function numberColumnToSchema(column,t2){let unsigned=column.getSQLType().includes("unsigned"),min,max,integer2=!1;if(isColumnType(column,["MySqlTinyInt","SingleStoreTinyInt"]))min=unsigned?0:CONSTANTS.INT8_MIN,max=unsigned?CONSTANTS.INT8_UNSIGNED_MAX:CONSTANTS.INT8_MAX,integer2=!0;else if(isColumnType(column,["PgSmallInt","PgSmallSerial","MySqlSmallInt","SingleStoreSmallInt"]))min=unsigned?0:CONSTANTS.INT16_MIN,max=unsigned?CONSTANTS.INT16_UNSIGNED_MAX:CONSTANTS.INT16_MAX,integer2=!0;else if(isColumnType(column,["PgReal","MySqlFloat","MySqlMediumInt","SingleStoreFloat","SingleStoreMediumInt"]))min=unsigned?0:CONSTANTS.INT24_MIN,max=unsigned?CONSTANTS.INT24_UNSIGNED_MAX:CONSTANTS.INT24_MAX,integer2=isColumnType(column,["MySqlMediumInt","SingleStoreMediumInt"]);else if(isColumnType(column,["PgInteger","PgSerial","MySqlInt","SingleStoreInt"]))min=unsigned?0:CONSTANTS.INT32_MIN,max=unsigned?CONSTANTS.INT32_UNSIGNED_MAX:CONSTANTS.INT32_MAX,integer2=!0;else if(isColumnType(column,["PgDoublePrecision","MySqlReal","MySqlDouble","SingleStoreReal","SingleStoreDouble","SQLiteReal"]))min=unsigned?0:CONSTANTS.INT48_MIN,max=unsigned?CONSTANTS.INT48_UNSIGNED_MAX:CONSTANTS.INT48_MAX;else if(isColumnType(column,["PgBigInt53","PgBigSerial53","MySqlBigInt53","MySqlSerial","SingleStoreBigInt53","SingleStoreSerial","SQLiteInteger"]))unsigned=unsigned||isColumnType(column,["MySqlSerial","SingleStoreSerial"]),min=unsigned?0:Number.MIN_SAFE_INTEGER,max=Number.MAX_SAFE_INTEGER,integer2=!0;else if(isColumnType(column,["MySqlYear","SingleStoreYear"]))min=1901,max=2155,integer2=!0;else min=Number.MIN_SAFE_INTEGER,max=Number.MAX_SAFE_INTEGER;return t2[integer2?"Integer":"Number"]({minimum:min,maximum:max})}function bigintColumnToSchema(column,t2){let unsigned=column.getSQLType().includes("unsigned"),min=unsigned?0n:CONSTANTS.INT64_MIN,max=unsigned?CONSTANTS.INT64_UNSIGNED_MAX:CONSTANTS.INT64_MAX;return t2.BigInt({minimum:min,maximum:max})}function stringColumnToSchema(column,t2){if(isColumnType(column,["PgUUID"]))return t2.String({format:"uuid"});else if(isColumnType(column,["PgBinaryVector"]))return t2.RegExp(/^[01]+$/,column.dimensions?{maxLength:column.dimensions}:void 0);let max,fixed=!1;if(isColumnType(column,["PgVarchar","SQLiteText"]))max=column.length;else if(isColumnType(column,["MySqlVarChar","SingleStoreVarChar"]))max=column.length??CONSTANTS.INT16_UNSIGNED_MAX;else if(isColumnType(column,["MySqlText","SingleStoreText"]))if(column.textType==="longtext")max=CONSTANTS.INT32_UNSIGNED_MAX;else if(column.textType==="mediumtext")max=CONSTANTS.INT24_UNSIGNED_MAX;else if(column.textType==="text")max=CONSTANTS.INT16_UNSIGNED_MAX;else max=CONSTANTS.INT8_UNSIGNED_MAX;if(isColumnType(column,["PgChar","MySqlChar","SingleStoreChar"]))max=column.length,fixed=!0;let options={};if(max!==void 0&&fixed)options.minLength=max,options.maxLength=max;else if(max!==void 0)options.maxLength=max;return t2.String(Object.keys(options).length>0?options:void 0)}function getColumns(tableLike){return isTable(tableLike)?getTableColumns(tableLike):getViewSelectedFields(tableLike)}function handleColumns(columns,refinements,conditions,factory){let columnSchemas={};for(let[key,selected]of Object.entries(columns)){if(!is(selected,Column)&&!is(selected,SQL)&&!is(selected,SQL.Aliased)&&typeof selected==="object"){let columns2=isTable(selected)||isView(selected)?getColumns(selected):selected;columnSchemas[key]=handleColumns(columns2,refinements[key]??{},conditions,factory);continue}let refinement=refinements[key];if(refinement!==void 0&&typeof refinement!=="function"){columnSchemas[key]=refinement;continue}let column=is(selected,Column)?selected:void 0,schema=column?columnToSchema(column,factory?.typeboxInstance??Type):Type.Any(),refined=typeof refinement==="function"?refinement(schema):schema;if(conditions.never(column))continue;else columnSchemas[key]=refined;if(column){if(conditions.nullable(column))columnSchemas[key]=Type.Union([columnSchemas[key],Type.Null()]);if(conditions.optional(column))columnSchemas[key]=Type.Optional(columnSchemas[key])}}return Type.Object(columnSchemas)}var insertConditions={never:(column)=>column?.generated?.type==="always"||column?.generatedIdentity?.type==="always",optional:(column)=>!column.notNull||column.notNull&&column.hasDefault,nullable:(column)=>!column.notNull};var createInsertSchema=(entity,refine)=>{let columns=getColumns(entity);return handleColumns(columns,refine??{},insertConditions)};var clientInsertSchema=createInsertSchema(clientTable),clientInsertDTO=t.Omit(clientInsertSchema,["client_id","tenant_id"]),clientUpdateDTO=t.Omit(clientInsertSchema,["client_id","tenant_id"]),technicianSchema=createInsertSchema(technicianTable),technicianInsertDTO=t.Omit(technicianSchema,["technician_id","tenant_id"]),technicianUpdateDTO=t.Omit(technicianSchema,["technician_id","tenant_id"]),phoneSchema=createInsertSchema(phoneTable),phoneInsertDTO=t.Omit(phoneSchema,["device_id","tenant_id"]),phoneUpdateDTO=t.Omit(phoneSchema,["device_id","tenant_id"]),providerSchema=createInsertSchema(providerTable),providerInsertDTO=t.Omit(providerSchema,["provider_id","tenant_id"]),providerUpdateDTO=t.Omit(providerSchema,["provider_id","tenant_id"]),expenseSchema=createInsertSchema(expenseTable),expenseInsertDTO=t.Omit(expenseSchema,["expense_id","tenant_id","created_by_user_id"]),expenseUpdateDTO=t.Omit(expenseSchema,["expense_id","tenant_id","created_by_user_id"]),repairSchema=createInsertSchema(repairTable),repairInsertDTO=t.Omit(repairSchema,["repair_id","tenant_id"]),repairUpdateDTO=t.Omit(repairSchema,["repair_id","tenant_id"]),sellerSchema=createInsertSchema(sellerTable),sellerInsertDTO=t.Omit(sellerSchema,["seller_id","tenant_id"]),sellerUpdateDTO=t.Omit(sellerSchema,["seller_id","tenant_id"]),giftAccessoryDTO=t.Object({accessory_id:t.Number(),qty:t.Number({minimum:1})}),tradeInPhoneDTO=t.Object({datetime:t.Optional(t.String({format:"date-time"})),name:t.String(),brand:t.String(),imei:t.String(),device_type:t.String(),battery_health:t.Optional(t.Number()),storage_capacity:t.Optional(t.Number()),color:t.Optional(t.String()),category:t.String(),price:t.String(),buy_cost:t.String(),currency_buy:t.Optional(t.String()),currency_sale:t.Optional(t.String()),deposit:t.String()}),saleSchema=createInsertSchema(saleTable),saleInsertDTO=t.Object({...t.Omit(saleSchema,["sale_id","tenant_id"]).properties,datetime:t.Optional(t.String({format:"date-time"})),gift_accessories:t.Optional(t.Array(giftAccessoryDTO)),trade_in_phone:t.Optional(tradeInPhoneDTO)}),saleUpdateDTO=t.Object({...t.Omit(saleSchema,["sale_id","tenant_id"]).properties,datetime:t.Optional(t.String({format:"date-time"})),gift_accessories:t.Optional(t.Array(giftAccessoryDTO)),trade_in_phone:t.Optional(tradeInPhoneDTO)}),accessorySchema=createInsertSchema(accessoryTable),accessoryInsertDTO=t.Omit(accessorySchema,["accessory_id","tenant_id"]),accessoryUpdateDTO=t.Omit(accessorySchema,["accessory_id","tenant_id"]),SESSION_COOKIE="session",SESSION_DAYS=7,ROUNDS=12;function normalizeEmail(email){return email.trim().toLowerCase()}function makeSessionId(){return randomBytes2(32).toString("hex")}function addDays(date3,days){let d=new Date(date3);return d.setDate(d.getDate()+days),d}function pickBestMembership(memberships){let rank={owner:3,admin:2,staff:1};return memberships.sort((a12,b2)=>(rank[b2.role]??0)-(rank[a12.role]??0))[0]}async function getDefaultTenantForUser(userId){let memberships=await db.select({tenant_id:tenantMembershipTable.tenant_id,role:tenantMembershipTable.role}).from(tenantMembershipTable).where(and(eq(tenantMembershipTable.user_id,userId),eq(tenantMembershipTable.is_active,!0)));return memberships.length?pickBestMembership(memberships):null}async function register(emailRaw,password){let email=normalizeEmail(emailRaw);if((await db.select({user_id:userTable.user_id}).from(userTable).where(eq(userTable.email,email)).limit(1)).length)return{ok:!1,status:409,message:"Email already in use"};let passwordHash=await hash2(password,ROUNDS),now=new Date,expiresAt=addDays(now,SESSION_DAYS),sessionId=makeSessionId(),trialEndsAt=addDays(now,7),result=await db.transaction(async(tx)=>{let userRow=(await tx.insert(userTable).values({email,password_hash:passwordHash}).returning({user_id:userTable.user_id,email:userTable.email,role:userTable.role,is_active:userTable.is_active,created_at:userTable.created_at,last_login:userTable.last_login}))[0];if(!userRow)throw Error("Failed to create user");let tenantRow=(await tx.insert(tenantTable).values({name:`Negocio de ${email}`}).returning({tenant_id:tenantTable.tenant_id,name:tenantTable.name,is_active:tenantTable.is_active,created_at:tenantTable.created_at,updated_at:tenantTable.updated_at}))[0];if(!tenantRow)throw Error("Failed to create tenant");return await tx.insert(tenantMembershipTable).values({tenant_id:tenantRow.tenant_id,user_id:userRow.user_id,role:"owner"}),await tx.insert(tenantSettingsTable).values({tenant_id:tenantRow.tenant_id,display_currency:"ARS",timezone:"America/Argentina/Buenos_Aires",low_stock_threshold_default:3,subscription_status:"trial",trial_ends_at:trialEndsAt}),await tx.insert(sessionTable).values({session_id:sessionId,user_id:userRow.user_id,tenant_id:tenantRow.tenant_id,expires_at:expiresAt}),{userRow,tenantRow}});return{ok:!0,status:201,user:{id:result.userRow.user_id,email:result.userRow.email,role:result.userRow.role??"user",is_active:result.userRow.is_active??!0,created_at:result.userRow.created_at??null,last_login:result.userRow.last_login??null},sessionId,tenant:{id:result.tenantRow.tenant_id,name:result.tenantRow.name??null,is_active:result.tenantRow.is_active??!0,created_at:result.tenantRow.created_at??null,updated_at:result.tenantRow.updated_at??null},roleInTenant:"owner"}}async function login(emailRaw,password){let email=normalizeEmail(emailRaw),users=await db.select({user_id:userTable.user_id,email:userTable.email,password_hash:userTable.password_hash,role:userTable.role,is_active:userTable.is_active,created_at:userTable.created_at,last_login:userTable.last_login}).from(userTable).where(eq(userTable.email,email)).limit(1),[user]=users;if(!user||user.is_active===!1)return{ok:!1,status:401,message:"Invalid credentials"};if(!await compare(password,user.password_hash))return{ok:!1,status:401,message:"Invalid credentials"};let membership=await getDefaultTenantForUser(user.user_id);if(!membership)return{ok:!1,status:403,message:"User has no tenant membership"};let tenant=(await db.select({tenant_id:tenantTable.tenant_id,name:tenantTable.name,is_active:tenantTable.is_active,created_at:tenantTable.created_at,updated_at:tenantTable.updated_at}).from(tenantTable).where(eq(tenantTable.tenant_id,membership.tenant_id)).limit(1))[0];if(!tenant||tenant.is_active===!1)return{ok:!1,status:403,message:"Tenant not found"};await db.delete(sessionTable).where(eq(sessionTable.user_id,user.user_id));let sessionId=makeSessionId(),now=new Date,expiresAt=addDays(now,SESSION_DAYS);return await db.insert(sessionTable).values({session_id:sessionId,user_id:user.user_id,tenant_id:tenant.tenant_id,expires_at:expiresAt}),await db.update(userTable).set({last_login:now}).where(eq(userTable.user_id,user.user_id)),{ok:!0,status:200,user:{id:user.user_id,email:user.email,role:user.role??"user",is_active:user.is_active??!0,created_at:user.created_at??null,last_login:now},sessionId,tenant:{id:tenant.tenant_id,name:tenant.name??null,is_active:tenant.is_active??!0,created_at:tenant.created_at??null,updated_at:tenant.updated_at??null},roleInTenant:membership.role}}async function logout(sessionId){await db.update(sessionTable).set({revoked_at:new Date}).where(eq(sessionTable.session_id,sessionId))}async function me(sessionId){if(!sessionId)return{ok:!1,status:401};let now=new Date,r2=(await db.select({user_id:userTable.user_id,email:userTable.email,user_role:userTable.role,user_active:userTable.is_active,user_created_at:userTable.created_at,user_last_login:userTable.last_login,ts_subscription_status:tenantSettingsTable.subscription_status,ts_trial_ends_at:tenantSettingsTable.trial_ends_at,tenant_id:tenantTable.tenant_id,tenant_name:tenantTable.name,tenant_active:tenantTable.is_active,tenant_created_at:tenantTable.created_at,tenant_updated_at:tenantTable.updated_at,membership_role:tenantMembershipTable.role,membership_active:tenantMembershipTable.is_active,ts_business_name:tenantSettingsTable.business_name,ts_logo_key:tenantSettingsTable.logo_key,ts_logo_mime:tenantSettingsTable.logo_mime,ts_logo_updated_at:tenantSettingsTable.logo_updated_at,ts_cuit:tenantSettingsTable.cuit,ts_address:tenantSettingsTable.address,ts_display_currency:tenantSettingsTable.display_currency,ts_timezone:tenantSettingsTable.timezone,ts_low_stock:tenantSettingsTable.low_stock_threshold_default,ts_updated_at:tenantSettingsTable.updated_at,us_user_id:userSettingsTable.user_id,us_display_name:userSettingsTable.display_name,us_phone:userSettingsTable.phone,us_email_notifications:userSettingsTable.email_notifications,us_updated_at:userSettingsTable.updated_at}).from(sessionTable).innerJoin(userTable,eq(sessionTable.user_id,userTable.user_id)).innerJoin(tenantTable,eq(sessionTable.tenant_id,tenantTable.tenant_id)).leftJoin(tenantSettingsTable,eq(tenantSettingsTable.tenant_id,tenantTable.tenant_id)).leftJoin(userSettingsTable,eq(userSettingsTable.user_id,userTable.user_id)).innerJoin(tenantMembershipTable,and(eq(tenantMembershipTable.user_id,userTable.user_id),eq(tenantMembershipTable.tenant_id,tenantTable.tenant_id))).where(and(eq(sessionTable.session_id,sessionId),gt(sessionTable.expires_at,now),isNull(sessionTable.revoked_at))).limit(1))[0];if(!r2)return{ok:!1,status:401};if(r2.user_active===!1)return{ok:!1,status:401};if(r2.tenant_active===!1)return{ok:!1,status:401};if(r2.membership_active===!1)return{ok:!1,status:401};await db.update(sessionTable).set({last_used:now}).where(eq(sessionTable.session_id,sessionId));let tenantSettings=r2.ts_updated_at!==null||r2.ts_business_name!==null||r2.ts_logo_key!==null||r2.ts_cuit!==null||r2.ts_address!==null?{business_name:r2.ts_business_name??null,logo_key:r2.ts_logo_key??null,logo_mime:r2.ts_logo_mime??null,logo_updated_at:r2.ts_logo_updated_at??null,cuit:r2.ts_cuit??null,address:r2.ts_address??null,display_currency:r2.ts_display_currency??"ARS",timezone:r2.ts_timezone??"America/Argentina/Buenos_Aires",low_stock_threshold_default:r2.ts_low_stock??3,updated_at:r2.ts_updated_at??null,trial_ends_at:r2.ts_trial_ends_at??null,subscription_status:r2.ts_subscription_status??null}:null,userSettings=r2.us_user_id!==null?{display_name:r2.us_display_name??null,phone:r2.us_phone??null,email_notifications:r2.us_email_notifications??!0,updated_at:r2.us_updated_at??null}:null;return{ok:!0,status:200,user:{id:r2.user_id,email:r2.email,role:r2.user_role??"user",is_active:r2.user_active??!0,created_at:r2.user_created_at??null,last_login:r2.user_last_login??null},tenant:{id:r2.tenant_id,name:r2.tenant_name??null,is_active:r2.tenant_active??!0,created_at:r2.tenant_created_at??null,updated_at:r2.tenant_updated_at??null},roleInTenant:r2.membership_role,tenantSettings,userSettings}}function buildSessionCookie(name,value,maxAgeSeconds){return`${name}=${value}; Path=/; HttpOnly; SameSite=Lax; Max-Age=${maxAgeSeconds}`}function clearSessionCookie(name){return`${name}=; Path=/; HttpOnly; SameSite=Lax; Max-Age=0`}var authController=new Elysia({prefix:"/auth"}).get("/",()=>({message:"Auth endpoint"})).post("/register",async({body,set:set2})=>{let result=await register(body.email,body.password);if(!result.ok)return set2.status=result.status,{ok:!1,message:result.message};return set2.headers["Set-Cookie"]=buildSessionCookie(SESSION_COOKIE,result.sessionId,86400*SESSION_DAYS),set2.status=201,{ok:!0,user:result.user,tenant:result.tenant,roleInTenant:result.roleInTenant}},{body:t.Object({email:t.String({minLength:5,maxLength:255}),password:t.String({minLength:8,maxLength:200})}),detail:{summary:"Register a new user (optional)",tags:["auth"]}}).post("/login",async({body,set:set2})=>{let result=await login(body.email,body.password);if(!result.ok)return set2.status=result.status,{ok:!1,message:result.message};return set2.headers["Set-Cookie"]=buildSessionCookie(SESSION_COOKIE,result.sessionId,86400*SESSION_DAYS),{ok:!0,user:result.user,tenant:result.tenant,roleInTenant:result.roleInTenant}},{body:t.Object({email:t.String({minLength:5,maxLength:255}),password:t.String({minLength:8,maxLength:200})}),detail:{summary:"Login user",tags:["auth"]}}).post("/logout",async({set:set2,cookie})=>{let raw=cookie[SESSION_COOKIE]?.value,sessionId=typeof raw==="string"?raw:void 0;if(sessionId)try{await logout(sessionId)}catch{}return set2.headers["Set-Cookie"]=clearSessionCookie(SESSION_COOKIE),{ok:!0}},{detail:{summary:"Logout user",tags:["auth"]}}).get("/me",async({set:set2,cookie})=>{let rawSession=cookie[SESSION_COOKIE]?.value,sessionId=typeof rawSession==="string"?rawSession:void 0;if(!sessionId)return set2.status=401,{ok:!1,error:"UNAUTHORIZED"};let result=await me(sessionId);if(!result.ok){let sessionCookie=cookie[SESSION_COOKIE];if(sessionCookie)sessionCookie.remove();return set2.status=result.status,{ok:!1,error:"UNAUTHORIZED"}}return{ok:!0,user:result.user,tenant:result.tenant,roleInTenant:result.roleInTenant,tenantSettings:result.tenantSettings??null,userSettings:result.userSettings??null}},{detail:{summary:"Get current user from session",tags:["auth"]}});function normalizeShortString(str){return str.normalize("NFD").replace(/[\u0300-\u036f]/g,"").trim().toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"")}function ilikeWordsNormalized(column,value){if(!value)return;let words=value.trim().toLowerCase().replace(/[-_]+/g," ").split(/\s+/).filter(Boolean),normalizedCol=sql`regexp_replace(lower(${column}), '[-_]+', ' ', 'g')`;return and(...words.map((w)=>ilike(normalizedCol,`%${w}%`)))}var fmtMoney=(n2,displayCurrency)=>new Intl.NumberFormat("es-AR",{style:"currency",currency:displayCurrency,maximumFractionDigits:2}).format(Number.isFinite(n2)?n2:0),CURRENCIES=["ARS","USD","EUR","BRL"],isCurrency=(v)=>CURRENCIES.includes(v),round2=(n2)=>Math.round(n2*100)/100;var cache=null,cacheAt=0,TTL_MS=600000;async function fetchJson(url){let r2=await fetch(url,{headers:{accept:"application/json"}});if(!r2.ok)throw Error(`FX fetch failed: ${r2.status}`);return r2.json()}async function getFxSnapshotVenta(){let now=Date.now();if(cache&&now-cacheAt<TTL_MS)return cache;try{let[usd,eur,brl]=await Promise.all([fetchJson("https://dolarapi.com/v1/dolares/blue"),fetchJson("https://dolarapi.com/v1/cotizaciones/eur"),fetchJson("https://dolarapi.com/v1/cotizaciones/brl")]);return cache={ratesToARS:{ARS:1,USD:usd.venta,EUR:eur.venta,BRL:brl.venta},updatedAt:new Date().toISOString()},cacheAt=now,cache}catch(e){if(cache)return{...cache,isStale:!0};throw e}}function convert2(amount,from,to,ratesToARS){if(from===to)return amount;return amount*ratesToARS[from]/ratesToARS[to]}async function getClientByFilter(tenantId,name,id_number,email,phone_number,is_deleted){return await db.select().from(clientTable).where(and(eq(clientTable.tenant_id,tenantId),name?ilike(clientTable.name,`%${name}%`):void 0,id_number?eq(clientTable.id_number,Number(id_number)):void 0,email?ilike(clientTable.email,`%${email}%`):void 0,phone_number?ilike(clientTable.phone_number,`%${phone_number}%`):void 0,is_deleted!==void 0?eq(clientTable.is_deleted,is_deleted):void 0)).orderBy(clientTable.client_id)}async function getAllClients(tenantId){return await db.select().from(clientTable).where(eq(clientTable.tenant_id,tenantId)).orderBy(clientTable.client_id)}var getClientById=async(tenantId,id)=>{return await db.query.clientTable.findFirst({where:and(eq(clientTable.tenant_id,tenantId),eq(clientTable.client_id,id))})};async function updateClient(tenantId,client_id,client_upd){let normalizedClient={...client_upd,name:normalizeShortString(client_upd.name),email:client_upd.email?.toLowerCase().trim()};return await db.update(clientTable).set(normalizedClient).where(and(eq(clientTable.tenant_id,tenantId),eq(clientTable.client_id,client_id))).returning()}var addClient=async(newClient)=>{let normalizedClient={...newClient,name:normalizeShortString(newClient.name),email:newClient.email?.toLowerCase().trim()};return await db.insert(clientTable).values(normalizedClient).returning()};async function softDeleteClient(tenantId,id){return(await db.update(clientTable).set({is_deleted:!0}).where(and(eq(clientTable.tenant_id,tenantId),eq(clientTable.client_id,id))).returning()).length>0}var getDebts=async(tenantId,display,fx)=>{return(await db.select().from(clientTable).where(and(eq(clientTable.tenant_id,tenantId),gt(clientTable.debt,0),eq(clientTable.is_deleted,!1))).orderBy(sql`${clientTable.debt} DESC`)).map((c)=>{let debtUsd=Number(c.debt??0),debtDisplay=convert2(debtUsd,"USD",display,fx.ratesToARS);return{...c,debt:fmtMoney(debtDisplay,display)}})},getTotalDebt=async(tenantId,display,fx)=>{let rows=await db.select({total_debt_usd:sql`COALESCE(SUM(${clientTable.debt}), 0)`}).from(clientTable).where(and(eq(clientTable.tenant_id,tenantId),eq(clientTable.is_deleted,!1))),totalUsd=Number(rows[0]?.total_debt_usd??0),totalDisplay=convert2(totalUsd,"USD",display,fx.ratesToARS);return fmtMoney(totalDisplay,display)};async function getClientOverviewMetrics(tenantId,opts,display,fx){let limit=Math.min(Math.max(Number(opts?.limit??5),1),20),debtCountRows=await db.select({clients_with_debt:sql`CAST(COUNT(*) AS INTEGER)`}).from(clientTable).where(and(eq(clientTable.tenant_id,tenantId),eq(clientTable.is_deleted,!1),gt(clientTable.debt,0))),clients_with_debt=Number(debtCountRows[0]?.clients_with_debt??0),totalDebtRows=await db.select({total_debt_usd:sql`COALESCE(SUM(${clientTable.debt}), 0)`}).from(clientTable).where(and(eq(clientTable.tenant_id,tenantId),eq(clientTable.is_deleted,!1))),totalDebtUsd=Number(totalDebtRows[0]?.total_debt_usd??0),total_debt=round2(convert2(totalDebtUsd,"USD",display,fx.ratesToARS)),saleRows=await db.select({client_id:saleTable.client_id,client_name:clientTable.name,amount:sql`COALESCE(${saleTable.total_amount}, 0)`,currency:saleTable.currency,datetime:saleTable.datetime}).from(saleTable).innerJoin(clientTable,and(eq(clientTable.client_id,saleTable.client_id),eq(clientTable.tenant_id,tenantId),eq(clientTable.is_deleted,!1))).where(and(eq(saleTable.tenant_id,tenantId),eq(saleTable.is_deleted,!1))),byClient=new Map;for(let r2 of saleRows){let cid=Number(r2.client_id);if(!Number.isFinite(cid))continue;let amt=Number(r2.amount??0);if(!Number.isFinite(amt))continue;let cur=isCurrency(r2.currency)?r2.currency:"ARS",spent=convert2(amt,cur,display,fx.ratesToARS),existing=byClient.get(cid)??{client_id:cid,name:String(r2.client_name??""),sales_count:0,total_spent_display:0,last_sale_dt:null};existing.sales_count+=1,existing.total_spent_display+=spent;let dt=r2.datetime?new Date(r2.datetime):null;if(dt&&(!existing.last_sale_dt||dt>existing.last_sale_dt))existing.last_sale_dt=dt;byClient.set(cid,existing)}let top_clients=[...byClient.values()].map((c)=>{let total=round2(c.total_spent_display);return{client_id:c.client_id,name:c.name,sales_count:c.sales_count,total_spent:total,total_spent_formatted:fmtMoney(total,display),last_sale_datetime:c.last_sale_dt?c.last_sale_dt.toISOString():null}}).sort((a12,b2)=>b2.total_spent-a12.total_spent).slice(0,limit);return{clients_with_debt,total_debt:fmtMoney(total_debt,display),top_clients}}function isWhitelistedPath(pathname){return pathname.startsWith("/billing")||pathname.startsWith("/api/billing")||pathname==="/auth/logout"||pathname==="/api/auth/logout"||pathname==="/auth/me"||pathname==="/api/auth/me"}function toISO(d){if(!d)return null;let dd=typeof d==="string"?new Date(d):d;return Number.isNaN(dd.getTime())?null:dd.toISOString()}function getPathname(ctx){if(typeof ctx.path==="string")return ctx.path;let url=ctx.request?.url;if(typeof url==="string")try{return new URL(url).pathname}catch{}return""}function protectedController(handler){return async(ctx)=>{let raw=ctx.cookie?.[SESSION_COOKIE]?.value,result=await me(typeof raw==="string"?raw:void 0);if(!result.ok)return ctx.set.status=401,{ok:!1,message:"UNAUTHORIZED"};ctx.user=result.user,ctx.tenantId=result.tenant.id,ctx.roleInTenant=result.roleInTenant,ctx.tenantSettings=result.tenantSettings??{display_currency:"ARS",subscription_status:"inactive",trial_ends_at:null};let pathname=getPathname(ctx);if(!isWhitelistedPath(pathname)){let now=new Date,status2=ctx.tenantSettings?.subscription_status,trialEndsAtRaw=ctx.tenantSettings?.trial_ends_at,trialValid=!1;if(status2==="trial"&&trialEndsAtRaw){let d=new Date(trialEndsAtRaw);if(!Number.isNaN(d.getTime())&&d.getTime()>now.getTime())trialValid=!0}if(!(status2==="active"||trialValid))return ctx.set.status=402,{ok:!1,error:"SUBSCRIPTION_REQUIRED",subscription_status:status2??"inactive",trial_ends_at:toISO(trialEndsAtRaw)}}return handler(ctx)}}var clientController=new Elysia({prefix:"/client"}).get("/",()=>({message:"Client endpoint"})).get("/all",protectedController(async(ctx)=>{let{query,tenantId}=ctx;if(query.name||query.id_number||query.email||query.phone_number||query.is_deleted){let is_deleted;if(query.is_deleted!==void 0)is_deleted=query.is_deleted==="true";return await getClientByFilter(tenantId,query.name,query.id_number,query.email,query.phone_number,is_deleted)}return await getAllClients(tenantId)}),{detail:{summary:"Get all clients in DB (scoped by tenant)",tags:["clients"]}}).get("/:id",protectedController(async(ctx)=>{return await getClientById(ctx.tenantId,Number(ctx.params.id))}),{detail:{summary:"Get client details by ID (scoped by tenant)",tags:["clients"]}}).post("/",protectedController(async(ctx)=>{let{body,set:set2}=ctx,newClient={tenant_id:ctx.tenantId,name:body.name,id_number:Number(body.id_number),...body.email&&{email:body.email},...body.phone_number&&{phone_number:body.phone_number},...body.birth_date&&{birth_date:body.birth_date},...body.debt&&{debt:body.debt}},result=await addClient(newClient);return set2.status=201,result}),{body:t.Object({...clientInsertDTO.properties,id_number:t.String()}),detail:{summary:"Insert a new client (scoped by tenant)",tags:["clients"]}}).put("/:id",protectedController(async(ctx)=>{let{body,set:set2}=ctx,updClient={name:body.name,id_number:Number(body.id_number),...body.email&&{email:body.email},...body.phone_number&&{phone_number:body.phone_number},...body.birth_date&&{birth_date:body.birth_date},...body.debt&&{debt:body.debt}},result=await updateClient(ctx.tenantId,Number(ctx.params.id),updClient);return set2.status=200,result}),{body:t.Object({...clientUpdateDTO.properties,id_number:t.String()}),detail:{summary:"Update a client (scoped by tenant)",tags:["clients"]}}).delete("/:id",protectedController(async(ctx)=>{let ok=await softDeleteClient(ctx.tenantId,Number(ctx.params.id));return ctx.set.status=ok?200:404,ok})).get("/debts",protectedController(async(ctx)=>{let display=ctx.tenantSettings.display_currency??"ARS",fx=await getFxSnapshotVenta();return await getDebts(ctx.tenantId,display,fx)}),{detail:{summary:"Get all debts (scoped by tenant)",tags:["sales"]}}).get("/total-debt",protectedController(async(ctx)=>{let display=ctx.tenantSettings.display_currency??"ARS",fx=await getFxSnapshotVenta();return await getTotalDebt(ctx.tenantId,display,fx)}),{detail:{summary:"Get total debt amount (scoped by tenant)",tags:["sales"]}}).get("/metrics/overview",protectedController(async(ctx)=>{let display=ctx.tenantSettings.display_currency??"ARS",fx=await getFxSnapshotVenta(),tenantId=ctx.tenantId,{limit}=ctx.query;return await getClientOverviewMetrics(tenantId,{limit:limit?Number(limit):5},display,fx)}),{detail:{summary:"Clients overview metrics (debt count, total debt, top clients)",tags:["clients","metrics"]}});var metadata_min_json_default={version:4,country_calling_codes:{"1":["US","AG","AI","AS","BB","BM","BS","CA","DM","DO","GD","GU","JM","KN","KY","LC","MP","MS","PR","SX","TC","TT","VC","VG","VI"],"7":["RU","KZ"],"20":["EG"],"27":["ZA"],"30":["GR"],"31":["NL"],"32":["BE"],"33":["FR"],"34":["ES"],"36":["HU"],"39":["IT","VA"],"40":["RO"],"41":["CH"],"43":["AT"],"44":["GB","GG","IM","JE"],"45":["DK"],"46":["SE"],"47":["NO","SJ"],"48":["PL"],"49":["DE"],"51":["PE"],"52":["MX"],"53":["CU"],"54":["AR"],"55":["BR"],"56":["CL"],"57":["CO"],"58":["VE"],"60":["MY"],"61":["AU","CC","CX"],"62":["ID"],"63":["PH"],"64":["NZ"],"65":["SG"],"66":["TH"],"81":["JP"],"82":["KR"],"84":["VN"],"86":["CN"],"90":["TR"],"91":["IN"],"92":["PK"],"93":["AF"],"94":["LK"],"95":["MM"],"98":["IR"],"211":["SS"],"212":["MA","EH"],"213":["DZ"],"216":["TN"],"218":["LY"],"220":["GM"],"221":["SN"],"222":["MR"],"223":["ML"],"224":["GN"],"225":["CI"],"226":["BF"],"227":["NE"],"228":["TG"],"229":["BJ"],"230":["MU"],"231":["LR"],"232":["SL"],"233":["GH"],"234":["NG"],"235":["TD"],"236":["CF"],"237":["CM"],"238":["CV"],"239":["ST"],"240":["GQ"],"241":["GA"],"242":["CG"],"243":["CD"],"244":["AO"],"245":["GW"],"246":["IO"],"247":["AC"],"248":["SC"],"249":["SD"],"250":["RW"],"251":["ET"],"252":["SO"],"253":["DJ"],"254":["KE"],"255":["TZ"],"256":["UG"],"257":["BI"],"258":["MZ"],"260":["ZM"],"261":["MG"],"262":["RE","YT"],"263":["ZW"],"264":["NA"],"265":["MW"],"266":["LS"],"267":["BW"],"268":["SZ"],"269":["KM"],"290":["SH","TA"],"291":["ER"],"297":["AW"],"298":["FO"],"299":["GL"],"350":["GI"],"351":["PT"],"352":["LU"],"353":["IE"],"354":["IS"],"355":["AL"],"356":["MT"],"357":["CY"],"358":["FI","AX"],"359":["BG"],"370":["LT"],"371":["LV"],"372":["EE"],"373":["MD"],"374":["AM"],"375":["BY"],"376":["AD"],"377":["MC"],"378":["SM"],"380":["UA"],"381":["RS"],"382":["ME"],"383":["XK"],"385":["HR"],"386":["SI"],"387":["BA"],"389":["MK"],"420":["CZ"],"421":["SK"],"423":["LI"],"500":["FK"],"501":["BZ"],"502":["GT"],"503":["SV"],"504":["HN"],"505":["NI"],"506":["CR"],"507":["PA"],"508":["PM"],"509":["HT"],"590":["GP","BL","MF"],"591":["BO"],"592":["GY"],"593":["EC"],"594":["GF"],"595":["PY"],"596":["MQ"],"597":["SR"],"598":["UY"],"599":["CW","BQ"],"670":["TL"],"672":["NF"],"673":["BN"],"674":["NR"],"675":["PG"],"676":["TO"],"677":["SB"],"678":["VU"],"679":["FJ"],"680":["PW"],"681":["WF"],"682":["CK"],"683":["NU"],"685":["WS"],"686":["KI"],"687":["NC"],"688":["TV"],"689":["PF"],"690":["TK"],"691":["FM"],"692":["MH"],"850":["KP"],"852":["HK"],"853":["MO"],"855":["KH"],"856":["LA"],"880":["BD"],"886":["TW"],"960":["MV"],"961":["LB"],"962":["JO"],"963":["SY"],"964":["IQ"],"965":["KW"],"966":["SA"],"967":["YE"],"968":["OM"],"970":["PS"],"971":["AE"],"972":["IL"],"973":["BH"],"974":["QA"],"975":["BT"],"976":["MN"],"977":["NP"],"992":["TJ"],"993":["TM"],"994":["AZ"],"995":["GE"],"996":["KG"],"998":["UZ"]},countries:{AC:["247","00","(?:[01589]\\d|[46])\\d{4}",[5,6]],AD:["376","00","(?:1|6\\d)\\d{7}|[135-9]\\d{5}",[6,8,9],[["(\\d{3})(\\d{3})","$1 $2",["[135-9]"]],["(\\d{4})(\\d{4})","$1 $2",["1"]],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["6"]]]],AE:["971","00","(?:[4-7]\\d|9[0-689])\\d{7}|800\\d{2,9}|[2-4679]\\d{7}",[5,6,7,8,9,10,11,12],[["(\\d{3})(\\d{2,9})","$1 $2",["60|8"]],["(\\d)(\\d{3})(\\d{4})","$1 $2 $3",["[236]|[479][2-8]"],"0$1"],["(\\d{3})(\\d)(\\d{5})","$1 $2 $3",["[479]"]],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["5"],"0$1"]],"0"],AF:["93","00","[2-7]\\d{8}",[9],[["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["[2-7]"],"0$1"]],"0"],AG:["1","011","(?:268|[58]\\d\\d|900)\\d{7}",[10],0,"1",0,"([457]\\d{6})$|1","268$1",0,"268"],AI:["1","011","(?:264|[58]\\d\\d|900)\\d{7}",[10],0,"1",0,"([2457]\\d{6})$|1","264$1",0,"264"],AL:["355","00","(?:700\\d\\d|900)\\d{3}|8\\d{5,7}|(?:[2-5]|6\\d)\\d{7}",[6,7,8,9],[["(\\d{3})(\\d{3,4})","$1 $2",["80|9"],"0$1"],["(\\d)(\\d{3})(\\d{4})","$1 $2 $3",["4[2-6]"],"0$1"],["(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3",["[2358][2-5]|4"],"0$1"],["(\\d{3})(\\d{5})","$1 $2",["[23578]"],"0$1"],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["6"],"0$1"]],"0"],AM:["374","00","(?:[1-489]\\d|55|60|77)\\d{6}",[8],[["(\\d{3})(\\d{2})(\\d{3})","$1 $2 $3",["[89]0"],"0 $1"],["(\\d{3})(\\d{5})","$1 $2",["2|3[12]"],"(0$1)"],["(\\d{2})(\\d{6})","$1 $2",["1|47"],"(0$1)"],["(\\d{2})(\\d{6})","$1 $2",["[3-9]"],"0$1"]],"0"],AO:["244","00","[29]\\d{8}",[9],[["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[29]"]]]],AR:["54","00","(?:11|[89]\\d\\d)\\d{8}|[2368]\\d{9}",[10,11],[["(\\d{4})(\\d{2})(\\d{4})","$1 $2-$3",["2(?:2[024-9]|3[0-59]|47|6[245]|9[02-8])|3(?:3[28]|4[03-9]|5[2-46-8]|7[1-578]|8[2-9])","2(?:[23]02|6(?:[25]|4[6-8])|9(?:[02356]|4[02568]|72|8[23]))|3(?:3[28]|4(?:[04679]|3[5-8]|5[4-68]|8[2379])|5(?:[2467]|3[237]|8[2-5])|7[1-578]|8(?:[2469]|3[2578]|5[4-8]|7[36-8]|8[5-8]))|2(?:2[24-9]|3[1-59]|47)","2(?:[23]02|6(?:[25]|4(?:64|[78]))|9(?:[02356]|4(?:[0268]|5[2-6])|72|8[23]))|3(?:3[28]|4(?:[04679]|3[78]|5(?:4[46]|8)|8[2379])|5(?:[2467]|3[237]|8[23])|7[1-578]|8(?:[2469]|3[278]|5[56][46]|86[3-6]))|2(?:2[24-9]|3[1-59]|47)|38(?:[58][78]|7[378])|3(?:4[35][56]|58[45]|8(?:[38]5|54|76))[4-6]","2(?:[23]02|6(?:[25]|4(?:64|[78]))|9(?:[02356]|4(?:[0268]|5[2-6])|72|8[23]))|3(?:3[28]|4(?:[04679]|3(?:5(?:4[0-25689]|[56])|[78])|58|8[2379])|5(?:[2467]|3[237]|8(?:[23]|4(?:[45]|60)|5(?:4[0-39]|5|64)))|7[1-578]|8(?:[2469]|3[278]|54(?:4|5[13-7]|6[89])|86[3-6]))|2(?:2[24-9]|3[1-59]|47)|38(?:[58][78]|7[378])|3(?:454|85[56])[46]|3(?:4(?:36|5[56])|8(?:[38]5|76))[4-6]"],"0$1",1],["(\\d{2})(\\d{4})(\\d{4})","$1 $2-$3",["1"],"0$1",1],["(\\d{3})(\\d{3})(\\d{4})","$1-$2-$3",["[68]"],"0$1"],["(\\d{3})(\\d{3})(\\d{4})","$1 $2-$3",["[23]"],"0$1",1],["(\\d)(\\d{4})(\\d{2})(\\d{4})","$2 15-$3-$4",["9(?:2[2-469]|3[3-578])","9(?:2(?:2[024-9]|3[0-59]|47|6[245]|9[02-8])|3(?:3[28]|4[03-9]|5[2-46-8]|7[1-578]|8[2-9]))","9(?:2(?:[23]02|6(?:[25]|4[6-8])|9(?:[02356]|4[02568]|72|8[23]))|3(?:3[28]|4(?:[04679]|3[5-8]|5[4-68]|8[2379])|5(?:[2467]|3[237]|8[2-5])|7[1-578]|8(?:[2469]|3[2578]|5[4-8]|7[36-8]|8[5-8])))|92(?:2[24-9]|3[1-59]|47)","9(?:2(?:[23]02|6(?:[25]|4(?:64|[78]))|9(?:[02356]|4(?:[0268]|5[2-6])|72|8[23]))|3(?:3[28]|4(?:[04679]|3[78]|5(?:4[46]|8)|8[2379])|5(?:[2467]|3[237]|8[23])|7[1-578]|8(?:[2469]|3[278]|5(?:[56][46]|[78])|7[378]|8(?:6[3-6]|[78]))))|92(?:2[24-9]|3[1-59]|47)|93(?:4[35][56]|58[45]|8(?:[38]5|54|76))[4-6]","9(?:2(?:[23]02|6(?:[25]|4(?:64|[78]))|9(?:[02356]|4(?:[0268]|5[2-6])|72|8[23]))|3(?:3[28]|4(?:[04679]|3(?:5(?:4[0-25689]|[56])|[78])|5(?:4[46]|8)|8[2379])|5(?:[2467]|3[237]|8(?:[23]|4(?:[45]|60)|5(?:4[0-39]|5|64)))|7[1-578]|8(?:[2469]|3[278]|5(?:4(?:4|5[13-7]|6[89])|[56][46]|[78])|7[378]|8(?:6[3-6]|[78]))))|92(?:2[24-9]|3[1-59]|47)|93(?:4(?:36|5[56])|8(?:[38]5|76))[4-6]"],"0$1",0,"$1 $2 $3-$4"],["(\\d)(\\d{2})(\\d{4})(\\d{4})","$2 15-$3-$4",["91"],"0$1",0,"$1 $2 $3-$4"],["(\\d{3})(\\d{3})(\\d{5})","$1-$2-$3",["8"],"0$1"],["(\\d)(\\d{3})(\\d{3})(\\d{4})","$2 15-$3-$4",["9"],"0$1",0,"$1 $2 $3-$4"]],"0",0,"0?(?:(11|2(?:2(?:02?|[13]|2[13-79]|4[1-6]|5[2457]|6[124-8]|7[1-4]|8[13-6]|9[1267])|3(?:02?|1[467]|2[03-6]|3[13-8]|[49][2-6]|5[2-8]|[67])|4(?:7[3-578]|9)|6(?:[0136]|2[24-6]|4[6-8]?|5[15-8])|80|9(?:0[1-3]|[19]|2\\d|3[1-6]|4[02568]?|5[2-4]|6[2-46]|72?|8[23]?))|3(?:3(?:2[79]|6|8[2578])|4(?:0[0-24-9]|[12]|3[5-8]?|4[24-7]|5[4-68]?|6[02-9]|7[126]|8[2379]?|9[1-36-8])|5(?:1|2[1245]|3[237]?|4[1-46-9]|6[2-4]|7[1-6]|8[2-5]?)|6[24]|7(?:[069]|1[1568]|2[15]|3[145]|4[13]|5[14-8]|7[2-57]|8[126])|8(?:[01]|2[15-7]|3[2578]?|4[13-6]|5[4-8]?|6[1-357-9]|7[36-8]?|8[5-8]?|9[124])))15)?","9$1"],AS:["1","011","(?:[58]\\d\\d|684|900)\\d{7}",[10],0,"1",0,"([267]\\d{6})$|1","684$1",0,"684"],AT:["43","00","1\\d{3,12}|2\\d{6,12}|43(?:(?:0\\d|5[02-9])\\d{3,9}|2\\d{4,5}|[3467]\\d{4}|8\\d{4,6}|9\\d{4,7})|5\\d{4,12}|8\\d{7,12}|9\\d{8,12}|(?:[367]\\d|4[0-24-9])\\d{4,11}",[4,5,6,7,8,9,10,11,12,13],[["(\\d)(\\d{3,12})","$1 $2",["1(?:11|[2-9])"],"0$1"],["(\\d{3})(\\d{2})","$1 $2",["517"],"0$1"],["(\\d{2})(\\d{3,5})","$1 $2",["5[079]"],"0$1"],["(\\d{3})(\\d{3,10})","$1 $2",["(?:31|4)6|51|6(?:48|5[0-3579]|[6-9])|7(?:20|32|8)|[89]","(?:31|4)6|51|6(?:485|5[0-3579]|[6-9])|7(?:20|32|8)|[89]"],"0$1"],["(\\d{4})(\\d{3,9})","$1 $2",["[2-467]|5[2-6]"],"0$1"],["(\\d{2})(\\d{3})(\\d{3,4})","$1 $2 $3",["5"],"0$1"],["(\\d{2})(\\d{4})(\\d{4,7})","$1 $2 $3",["5"],"0$1"]],"0"],AU:["61","001[14-689]|14(?:1[14]|34|4[17]|[56]6|7[47]|88)0011","1(?:[0-79]\\d{7}(?:\\d(?:\\d{2})?)?|8[0-24-9]\\d{7})|[2-478]\\d{8}|1\\d{4,7}",[5,6,7,8,9,10,12],[["(\\d{2})(\\d{3,4})","$1 $2",["16"],"0$1"],["(\\d{2})(\\d{3})(\\d{2,4})","$1 $2 $3",["16"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["14|4"],"0$1"],["(\\d)(\\d{4})(\\d{4})","$1 $2 $3",["[2378]"],"(0$1)"],["(\\d{4})(\\d{3})(\\d{3})","$1 $2 $3",["1(?:30|[89])"]]],"0",0,"(183[12])|0",0,0,0,[["(?:(?:241|349)0\\d\\d|8(?:51(?:0(?:0[03-9]|[12479]\\d|3[2-9]|5[0-8]|6[1-9]|8[0-7])|1(?:[0235689]\\d|1[0-69]|4[0-589]|7[0-47-9])|2(?:0[0-79]|[18][13579]|2[14-9]|3[0-46-9]|[4-6]\\d|7[89]|9[0-4])|[34]\\d\\d)|91(?:(?:[0-58]\\d|6[0135-9])\\d|7(?:0[0-24-9]|[1-9]\\d)|9(?:[0-46-9]\\d|5[0-79]))))\\d{3}|(?:2(?:[0-26-9]\\d|3[0-8]|4[02-9]|5[0135-9])|3(?:[0-3589]\\d|4[0-578]|6[1-9]|7[0-35-9])|7(?:[013-57-9]\\d|2[0-8])|8(?:55|6[0-8]|[78]\\d|9[02-9]))\\d{6}",[9]],["4(?:79[01]|83[0-36-9]|95[0-3])\\d{5}|4(?:[0-36]\\d|4[047-9]|[58][0-24-9]|7[02-8]|9[0-47-9])\\d{6}",[9]],["180(?:0\\d{3}|2)\\d{3}",[7,10]],["190[0-26]\\d{6}",[10]],0,0,0,["163\\d{2,6}",[5,6,7,8,9]],["14(?:5(?:1[0458]|[23][458])|71\\d)\\d{4}",[9]],["13(?:00\\d{6}(?:\\d{2})?|45[0-4]\\d{3})|13\\d{4}",[6,8,10,12]]],"0011"],AW:["297","00","(?:[25-79]\\d\\d|800)\\d{4}",[7],[["(\\d{3})(\\d{4})","$1 $2",["[25-9]"]]]],AX:["358","00|99(?:[01469]|5(?:[14]1|3[23]|5[59]|77|88|9[09]))","2\\d{4,9}|35\\d{4,5}|(?:60\\d\\d|800)\\d{4,6}|7\\d{5,11}|(?:[14]\\d|3[0-46-9]|50)\\d{4,8}",[5,6,7,8,9,10,11,12],0,"0",0,0,0,0,"18",0,"00"],AZ:["994","00","365\\d{6}|(?:[124579]\\d|60|88)\\d{7}",[9],[["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["90"],"0$1"],["(\\d{2})(\\d{3})(\\d{2})(\\d{2})","$1 $2 $3 $4",["1[28]|2|365|46","1[28]|2|365[45]|46","1[28]|2|365(?:4|5[02])|46"],"(0$1)"],["(\\d{2})(\\d{3})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[13-9]"],"0$1"]],"0"],BA:["387","00","6\\d{8}|(?:[35689]\\d|49|70)\\d{6}",[8,9],[["(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3",["6[1-3]|[7-9]"],"0$1"],["(\\d{2})(\\d{3})(\\d{3})","$1 $2-$3",["[3-5]|6[56]"],"0$1"],["(\\d{2})(\\d{2})(\\d{2})(\\d{3})","$1 $2 $3 $4",["6"],"0$1"]],"0"],BB:["1","011","(?:246|[58]\\d\\d|900)\\d{7}",[10],0,"1",0,"([2-9]\\d{6})$|1","246$1",0,"246"],BD:["880","00","[1-469]\\d{9}|8[0-79]\\d{7,8}|[2-79]\\d{8}|[2-9]\\d{7}|[3-9]\\d{6}|[57-9]\\d{5}",[6,7,8,9,10],[["(\\d{2})(\\d{4,6})","$1-$2",["31[5-8]|[459]1"],"0$1"],["(\\d{3})(\\d{3,7})","$1-$2",["3(?:[67]|8[013-9])|4(?:6[168]|7|[89][18])|5(?:6[128]|9)|6(?:[15]|28|4[14])|7[2-589]|8(?:0[014-9]|[12])|9[358]|(?:3[2-5]|4[235]|5[2-578]|6[0389]|76|8[3-7]|9[24])1|(?:44|66)[01346-9]"],"0$1"],["(\\d{4})(\\d{3,6})","$1-$2",["[13-9]|2[23]"],"0$1"],["(\\d)(\\d{7,8})","$1-$2",["2"],"0$1"]],"0"],BE:["32","00","4\\d{8}|[1-9]\\d{7}",[8,9],[["(\\d{3})(\\d{2})(\\d{3})","$1 $2 $3",["(?:80|9)0"],"0$1"],["(\\d)(\\d{3})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[239]|4[23]"],"0$1"],["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[15-8]"],"0$1"],["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["4"],"0$1"]],"0"],BF:["226","00","(?:[025-7]\\d|44)\\d{6}",[8],[["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[024-7]"]]]],BG:["359","00","00800\\d{7}|[2-7]\\d{6,7}|[89]\\d{6,8}|2\\d{5}",[6,7,8,9,12],[["(\\d)(\\d)(\\d{2})(\\d{2})","$1 $2 $3 $4",["2"],"0$1"],["(\\d{3})(\\d{4})","$1 $2",["43[1-6]|70[1-9]"],"0$1"],["(\\d)(\\d{3})(\\d{3,4})","$1 $2 $3",["2"],"0$1"],["(\\d{2})(\\d{3})(\\d{2,3})","$1 $2 $3",["[356]|4[124-7]|7[1-9]|8[1-6]|9[1-7]"],"0$1"],["(\\d{3})(\\d{2})(\\d{3})","$1 $2 $3",["(?:70|8)0"],"0$1"],["(\\d{3})(\\d{3})(\\d{2})","$1 $2 $3",["43[1-7]|7"],"0$1"],["(\\d{2})(\\d{3})(\\d{3,4})","$1 $2 $3",["[48]|9[08]"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["9"],"0$1"]],"0"],BH:["973","00","[136-9]\\d{7}",[8],[["(\\d{4})(\\d{4})","$1 $2",["[13679]|8[02-4679]"]]]],BI:["257","00","(?:[267]\\d|31)\\d{6}",[8],[["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[2367]"]]]],BJ:["229","00","(?:01\\d|8)\\d{7}",[8,10],[["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["8"]],["(\\d{2})(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4 $5",["0"]]]],BL:["590","00","(?:590\\d|7090)\\d{5}|(?:69|80|9\\d)\\d{7}",[9],0,"0",0,0,0,0,0,[["590(?:2[7-9]|3[3-7]|5[12]|87)\\d{4}"],["(?:69(?:0\\d\\d|1(?:2[2-9]|3[0-5])|4(?:0[89]|1[2-6]|9\\d)|6(?:1[016-9]|5[0-4]|[67]\\d))|7090[0-4])\\d{4}"],["80[0-5]\\d{6}"],0,0,0,0,0,["9(?:(?:39[5-7]|76[018])\\d|475[0-6])\\d{4}"]]],BM:["1","011","(?:441|[58]\\d\\d|900)\\d{7}",[10],0,"1",0,"([2-9]\\d{6})$|1","441$1",0,"441"],BN:["673","00","[2-578]\\d{6}",[7],[["(\\d{3})(\\d{4})","$1 $2",["[2-578]"]]]],BO:["591","00(?:1\\d)?","8001\\d{5}|(?:[2-467]\\d|50)\\d{6}",[8,9],[["(\\d)(\\d{7})","$1 $2",["[235]|4[46]"]],["(\\d{8})","$1",["[67]"]],["(\\d{3})(\\d{2})(\\d{4})","$1 $2 $3",["8"]]],"0",0,"0(1\\d)?"],BQ:["599","00","(?:[34]1|7\\d)\\d{5}",[7],0,0,0,0,0,0,"[347]"],BR:["55","00(?:1[245]|2[1-35]|31|4[13]|[56]5|99)","[1-467]\\d{9,10}|55[0-46-9]\\d{8}|[34]\\d{7}|55\\d{7,8}|(?:5[0-46-9]|[89]\\d)\\d{7,9}",[8,9,10,11],[["(\\d{4})(\\d{4})","$1-$2",["300|4(?:0[02]|37|86)","300|4(?:0(?:0|20)|370|864)"]],["(\\d{3})(\\d{2,3})(\\d{4})","$1 $2 $3",["(?:[358]|90)0"],"0$1"],["(\\d{2})(\\d{4})(\\d{4})","$1 $2-$3",["(?:[14689][1-9]|2[12478]|3[1-578]|5[13-5]|7[13-579])[2-57]"],"($1)"],["(\\d{2})(\\d{5})(\\d{4})","$1 $2-$3",["[16][1-9]|[2-57-9]"],"($1)"]],"0",0,"(?:0|90)(?:(1[245]|2[1-35]|31|4[13]|[56]5|99)(\\d{10,11}))?","$2"],BS:["1","011","(?:242|[58]\\d\\d|900)\\d{7}",[10],0,"1",0,"([3-8]\\d{6})$|1","242$1",0,"242"],BT:["975","00","[178]\\d{7}|[2-8]\\d{6}",[7,8],[["(\\d)(\\d{3})(\\d{3})","$1 $2 $3",["[2-6]|7[246]|8[2-4]"]],["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["1[67]|[78]"]]]],BW:["267","00","(?:0800|(?:[37]|800)\\d)\\d{6}|(?:[2-6]\\d|90)\\d{5}",[7,8,10],[["(\\d{2})(\\d{5})","$1 $2",["90"]],["(\\d{3})(\\d{4})","$1 $2",["[24-6]|3[15-9]"]],["(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3",["[37]"]],["(\\d{4})(\\d{3})(\\d{3})","$1 $2 $3",["0"]],["(\\d{3})(\\d{4})(\\d{3})","$1 $2 $3",["8"]]]],BY:["375","810","(?:[12]\\d|33|44|902)\\d{7}|8(?:0[0-79]\\d{5,7}|[1-7]\\d{9})|8(?:1[0-489]|[5-79]\\d)\\d{7}|8[1-79]\\d{6,7}|8[0-79]\\d{5}|8\\d{5}",[6,7,8,9,10,11],[["(\\d{3})(\\d{3})","$1 $2",["800"],"8 $1"],["(\\d{3})(\\d{2})(\\d{2,4})","$1 $2 $3",["800"],"8 $1"],["(\\d{4})(\\d{2})(\\d{3})","$1 $2-$3",["1(?:5[169]|6[3-5]|7[179])|2(?:1[35]|2[34]|3[3-5])","1(?:5[169]|6(?:3[1-3]|4|5[125])|7(?:1[3-9]|7[0-24-6]|9[2-7]))|2(?:1[35]|2[34]|3[3-5])"],"8 0$1"],["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2-$3-$4",["1(?:[56]|7[467])|2[1-3]"],"8 0$1"],["(\\d{2})(\\d{3})(\\d{2})(\\d{2})","$1 $2-$3-$4",["[1-4]"],"8 0$1"],["(\\d{3})(\\d{3,4})(\\d{4})","$1 $2 $3",["[89]"],"8 $1"]],"8",0,"0|80?",0,0,0,0,"8~10"],BZ:["501","00","(?:0800\\d|[2-8])\\d{6}",[7,11],[["(\\d{3})(\\d{4})","$1-$2",["[2-8]"]],["(\\d)(\\d{3})(\\d{4})(\\d{3})","$1-$2-$3-$4",["0"]]]],CA:["1","011","[2-9]\\d{9}|3\\d{6}",[7,10],0,"1",0,0,0,0,0,[["(?:2(?:04|[23]6|[48]9|5[07]|63)|3(?:06|43|54|6[578]|82)|4(?:03|1[68]|[26]8|3[178]|50|74)|5(?:06|1[49]|48|79|8[147])|6(?:04|[18]3|39|47|72)|7(?:0[59]|42|53|78|8[02])|8(?:[06]7|19|25|7[39])|9(?:0[25]|42))[2-9]\\d{6}",[10]],["",[10]],["8(?:00|33|44|55|66|77|88)[2-9]\\d{6}",[10]],["900[2-9]\\d{6}",[10]],["52(?:3(?:[2-46-9][02-9]\\d|5(?:[02-46-9]\\d|5[0-46-9]))|4(?:[2-478][02-9]\\d|5(?:[034]\\d|2[024-9]|5[0-46-9])|6(?:0[1-9]|[2-9]\\d)|9(?:[05-9]\\d|2[0-5]|49)))\\d{4}|52[34][2-9]1[02-9]\\d{4}|(?:5(?:2[125-9]|33|44|66|77|88)|6(?:22|33))[2-9]\\d{6}",[10]],0,["310\\d{4}",[7]],0,["600[2-9]\\d{6}",[10]]]],CC:["61","001[14-689]|14(?:1[14]|34|4[17]|[56]6|7[47]|88)0011","1(?:[0-79]\\d{8}(?:\\d{2})?|8[0-24-9]\\d{7})|[148]\\d{8}|1\\d{5,7}",[6,7,8,9,10,12],0,"0",0,"([59]\\d{7})$|0","8$1",0,0,[["8(?:51(?:0(?:02|31|60|89)|1(?:18|76)|223)|91(?:0(?:1[0-2]|29)|1(?:[28]2|50|79)|2(?:10|64)|3(?:[06]8|22)|4[29]8|62\\d|70[23]|959))\\d{3}",[9]],["4(?:79[01]|83[0-36-9]|95[0-3])\\d{5}|4(?:[0-36]\\d|4[047-9]|[58][0-24-9]|7[02-8]|9[0-47-9])\\d{6}",[9]],["180(?:0\\d{3}|2)\\d{3}",[7,10]],["190[0-26]\\d{6}",[10]],0,0,0,0,["14(?:5(?:1[0458]|[23][458])|71\\d)\\d{4}",[9]],["13(?:00\\d{6}(?:\\d{2})?|45[0-4]\\d{3})|13\\d{4}",[6,8,10,12]]],"0011"],CD:["243","00","(?:(?:[189]|5\\d)\\d|2)\\d{7}|[1-68]\\d{6}",[7,8,9,10],[["(\\d{2})(\\d{2})(\\d{3})","$1 $2 $3",["88"],"0$1"],["(\\d{2})(\\d{5})","$1 $2",["[1-6]"],"0$1"],["(\\d{2})(\\d{2})(\\d{4})","$1 $2 $3",["2"],"0$1"],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["1"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[89]"],"0$1"],["(\\d{2})(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3 $4",["5"],"0$1"]],"0"],CF:["236","00","(?:[27]\\d{3}|8776)\\d{4}",[8],[["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[278]"]]]],CG:["242","00","222\\d{6}|(?:0\\d|80)\\d{7}",[9],[["(\\d)(\\d{4})(\\d{4})","$1 $2 $3",["8"]],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["[02]"]]]],CH:["41","00","8\\d{11}|[2-9]\\d{8}",[9,12],[["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["8[047]|90"],"0$1"],["(\\d{2})(\\d{3})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[2-79]|81"],"0$1"],["(\\d{3})(\\d{2})(\\d{3})(\\d{2})(\\d{2})","$1 $2 $3 $4 $5",["8"],"0$1"]],"0"],CI:["225","00","[02]\\d{9}",[10],[["(\\d{2})(\\d{2})(\\d)(\\d{5})","$1 $2 $3 $4",["2"]],["(\\d{2})(\\d{2})(\\d{2})(\\d{4})","$1 $2 $3 $4",["0"]]]],CK:["682","00","[2-578]\\d{4}",[5],[["(\\d{2})(\\d{3})","$1 $2",["[2-578]"]]]],CL:["56","(?:0|1(?:1[0-69]|2[02-5]|5[13-58]|69|7[0167]|8[018]))0","12300\\d{6}|6\\d{9,10}|[2-9]\\d{8}",[9,10,11],[["(\\d{5})(\\d{4})","$1 $2",["219","2196"],"($1)"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["60|809"]],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["44"]],["(\\d)(\\d{4})(\\d{4})","$1 $2 $3",["2[1-36]"],"($1)"],["(\\d)(\\d{4})(\\d{4})","$1 $2 $3",["9(?:10|[2-9])"]],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["3[2-5]|[47]|5[1-3578]|6[13-57]|8(?:0[1-8]|[1-9])"],"($1)"],["(\\d{3})(\\d{3})(\\d{3,4})","$1 $2 $3",["60|8"]],["(\\d{4})(\\d{3})(\\d{4})","$1 $2 $3",["1"]],["(\\d{3})(\\d{3})(\\d{2})(\\d{3})","$1 $2 $3 $4",["60"]]]],CM:["237","00","[26]\\d{8}|88\\d{6,7}",[8,9],[["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["88"]],["(\\d)(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4 $5",["[26]|88"]]]],CN:["86","00|1(?:[12]\\d|79)\\d\\d00","(?:(?:1[03-689]|2\\d)\\d\\d|6)\\d{8}|1\\d{10}|[126]\\d{6}(?:\\d(?:\\d{2})?)?|86\\d{5,6}|(?:[3-579]\\d|8[0-57-9])\\d{5,9}",[7,8,9,10,11,12],[["(\\d{2})(\\d{5,6})","$1 $2",["(?:10|2[0-57-9])[19]|3(?:[157]|35|49|9[1-68])|4(?:1[124-9]|2[179]|6[47-9]|7|8[23])|5(?:[1357]|2[37]|4[36]|6[1-46]|80)|6(?:3[1-5]|6[0238]|9[12])|7(?:01|[1579]|2[248]|3[014-9]|4[3-6]|6[023689])|8(?:07|1[236-8]|2[5-7]|[37]|8[36-8]|9[1-8])|9(?:0[1-3689]|1[1-79]|3|4[13]|5[1-5]|7[0-79]|9[0-35-9])|(?:4[35]|59|85)[1-9]","(?:10|2[0-57-9])(?:1[02]|9[56])|8078|(?:3(?:[157]\\d|35|49|9[1-68])|4(?:1[124-9]|2[179]|[35][1-9]|6[47-9]|7\\d|8[23])|5(?:[1357]\\d|2[37]|4[36]|6[1-46]|80|9[1-9])|6(?:3[1-5]|6[0238]|9[12])|7(?:01|[1579]\\d|2[248]|3[014-9]|4[3-6]|6[023689])|8(?:1[236-8]|2[5-7]|[37]\\d|5[1-9]|8[36-8]|9[1-8])|9(?:0[1-3689]|1[1-79]|3\\d|4[13]|5[1-5]|7[0-79]|9[0-35-9]))1","10(?:1(?:0|23)|9[56])|2[0-57-9](?:1(?:00|23)|9[56])|80781|(?:3(?:[157]\\d|35|49|9[1-68])|4(?:1[124-9]|2[179]|[35][1-9]|6[47-9]|7\\d|8[23])|5(?:[1357]\\d|2[37]|4[36]|6[1-46]|80|9[1-9])|6(?:3[1-5]|6[0238]|9[12])|7(?:01|[1579]\\d|2[248]|3[014-9]|4[3-6]|6[023689])|8(?:1[236-8]|2[5-7]|[37]\\d|5[1-9]|8[36-8]|9[1-8])|9(?:0[1-3689]|1[1-79]|3\\d|4[13]|5[1-5]|7[0-79]|9[0-35-9]))12","10(?:1(?:0|23)|9[56])|2[0-57-9](?:1(?:00|23)|9[56])|807812|(?:3(?:[157]\\d|35|49|9[1-68])|4(?:1[124-9]|2[179]|[35][1-9]|6[47-9]|7\\d|8[23])|5(?:[1357]\\d|2[37]|4[36]|6[1-46]|80|9[1-9])|6(?:3[1-5]|6[0238]|9[12])|7(?:01|[1579]\\d|2[248]|3[014-9]|4[3-6]|6[023689])|8(?:1[236-8]|2[5-7]|[37]\\d|5[1-9]|8[36-8]|9[1-8])|9(?:0[1-3689]|1[1-79]|3\\d|4[13]|5[1-5]|7[0-79]|9[0-35-9]))123","10(?:1(?:0|23)|9[56])|2[0-57-9](?:1(?:00|23)|9[56])|(?:3(?:[157]\\d|35|49|9[1-68])|4(?:1[124-9]|2[179]|[35][1-9]|6[47-9]|7\\d|8[23])|5(?:[1357]\\d|2[37]|4[36]|6[1-46]|80|9[1-9])|6(?:3[1-5]|6[0238]|9[12])|7(?:01|[1579]\\d|2[248]|3[014-9]|4[3-6]|6[023689])|8(?:078|1[236-8]|2[5-7]|[37]\\d|5[1-9]|8[36-8]|9[1-8])|9(?:0[1-3689]|1[1-79]|3\\d|4[13]|5[1-5]|7[0-79]|9[0-35-9]))123"],"0$1"],["(\\d{3})(\\d{5,6})","$1 $2",["3(?:[157]|35|49|9[1-68])|4(?:[17]|2[179]|6[47-9]|8[23])|5(?:[1357]|2[37]|4[36]|6[1-46]|80)|6(?:3[1-5]|6[0238]|9[12])|7(?:01|[1579]|2[248]|3[014-9]|4[3-6]|6[023689])|8(?:1[236-8]|2[5-7]|[37]|8[36-8]|9[1-8])|9(?:0[1-3689]|1[1-79]|[379]|4[13]|5[1-5])|(?:4[35]|59|85)[1-9]","(?:3(?:[157]\\d|35|49|9[1-68])|4(?:[17]\\d|2[179]|[35][1-9]|6[47-9]|8[23])|5(?:[1357]\\d|2[37]|4[36]|6[1-46]|80|9[1-9])|6(?:3[1-5]|6[0238]|9[12])|7(?:01|[1579]\\d|2[248]|3[014-9]|4[3-6]|6[023689])|8(?:1[236-8]|2[5-7]|[37]\\d|5[1-9]|8[36-8]|9[1-8])|9(?:0[1-3689]|1[1-79]|[379]\\d|4[13]|5[1-5]))[19]","85[23](?:10|95)|(?:3(?:[157]\\d|35|49|9[1-68])|4(?:[17]\\d|2[179]|[35][1-9]|6[47-9]|8[23])|5(?:[1357]\\d|2[37]|4[36]|6[1-46]|80|9[1-9])|6(?:3[1-5]|6[0238]|9[12])|7(?:01|[1579]\\d|2[248]|3[014-9]|4[3-6]|6[023689])|8(?:1[236-8]|2[5-7]|[37]\\d|5[14-9]|8[36-8]|9[1-8])|9(?:0[1-3689]|1[1-79]|[379]\\d|4[13]|5[1-5]))(?:10|9[56])","85[23](?:100|95)|(?:3(?:[157]\\d|35|49|9[1-68])|4(?:[17]\\d|2[179]|[35][1-9]|6[47-9]|8[23])|5(?:[1357]\\d|2[37]|4[36]|6[1-46]|80|9[1-9])|6(?:3[1-5]|6[0238]|9[12])|7(?:01|[1579]\\d|2[248]|3[014-9]|4[3-6]|6[023689])|8(?:1[236-8]|2[5-7]|[37]\\d|5[14-9]|8[36-8]|9[1-8])|9(?:0[1-3689]|1[1-79]|[379]\\d|4[13]|5[1-5]))(?:100|9[56])"],"0$1"],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["(?:4|80)0"]],["(\\d{2})(\\d{4})(\\d{4})","$1 $2 $3",["10|2(?:[02-57-9]|1[1-9])","10|2(?:[02-57-9]|1[1-9])","10[0-79]|2(?:[02-57-9]|1[1-79])|(?:10|21)8(?:0[1-9]|[1-9])"],"0$1",1],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["3(?:[3-59]|7[02-68])|4(?:[26-8]|3[3-9]|5[2-9])|5(?:3[03-9]|[468]|7[028]|9[2-46-9])|6|7(?:[0-247]|3[04-9]|5[0-4689]|6[2368])|8(?:[1-358]|9[1-7])|9(?:[013479]|5[1-5])|(?:[34]1|55|79|87)[02-9]"],"0$1",1],["(\\d{3})(\\d{7,8})","$1 $2",["9"]],["(\\d{4})(\\d{3})(\\d{4})","$1 $2 $3",["80"],"0$1",1],["(\\d{3})(\\d{4})(\\d{4})","$1 $2 $3",["[3-578]"],"0$1",1],["(\\d{3})(\\d{4})(\\d{4})","$1 $2 $3",["1[3-9]"]],["(\\d{2})(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3 $4",["[12]"],"0$1",1]],"0",0,"(1(?:[12]\\d|79)\\d\\d)|0",0,0,0,0,"00"],CO:["57","00(?:4(?:[14]4|56)|[579])","(?:46|60\\d\\d)\\d{6}|(?:1\\d|[39])\\d{9}",[8,10,11],[["(\\d{4})(\\d{4})","$1 $2",["46"]],["(\\d{3})(\\d{7})","$1 $2",["6|90"],"($1)"],["(\\d{3})(\\d{7})","$1 $2",["3[0-357]|9[14]"]],["(\\d)(\\d{3})(\\d{7})","$1-$2-$3",["1"],"0$1",0,"$1 $2 $3"]],"0",0,"0([3579]|4(?:[14]4|56))?"],CR:["506","00","(?:8\\d|90)\\d{8}|(?:[24-8]\\d{3}|3005)\\d{4}",[8,10],[["(\\d{4})(\\d{4})","$1 $2",["[2-7]|8[3-9]"]],["(\\d{3})(\\d{3})(\\d{4})","$1-$2-$3",["[89]"]]],0,0,"(19(?:0[0-2468]|1[09]|20|66|77|99))"],CU:["53","119","(?:[2-7]|8\\d\\d)\\d{7}|[2-47]\\d{6}|[34]\\d{5}",[6,7,8,10],[["(\\d{2})(\\d{4,6})","$1 $2",["2[1-4]|[34]"],"(0$1)"],["(\\d)(\\d{6,7})","$1 $2",["7"],"(0$1)"],["(\\d)(\\d{7})","$1 $2",["[56]"],"0$1"],["(\\d{3})(\\d{7})","$1 $2",["8"],"0$1"]],"0"],CV:["238","0","(?:[2-59]\\d\\d|800)\\d{4}",[7],[["(\\d{3})(\\d{2})(\\d{2})","$1 $2 $3",["[2-589]"]]]],CW:["599","00","(?:[34]1|60|(?:7|9\\d)\\d)\\d{5}",[7,8],[["(\\d{3})(\\d{4})","$1 $2",["[3467]"]],["(\\d)(\\d{3})(\\d{4})","$1 $2 $3",["9[4-8]"]]],0,0,0,0,0,"[69]"],CX:["61","001[14-689]|14(?:1[14]|34|4[17]|[56]6|7[47]|88)0011","1(?:[0-79]\\d{8}(?:\\d{2})?|8[0-24-9]\\d{7})|[148]\\d{8}|1\\d{5,7}",[6,7,8,9,10,12],0,"0",0,"([59]\\d{7})$|0","8$1",0,0,[["8(?:51(?:0(?:01|30|59|88)|1(?:17|46|75)|2(?:22|35))|91(?:00[6-9]|1(?:[28]1|49|78)|2(?:09|63)|3(?:12|26|75)|4(?:56|97)|64\\d|7(?:0[01]|1[0-2])|958))\\d{3}",[9]],["4(?:79[01]|83[0-36-9]|95[0-3])\\d{5}|4(?:[0-36]\\d|4[047-9]|[58][0-24-9]|7[02-8]|9[0-47-9])\\d{6}",[9]],["180(?:0\\d{3}|2)\\d{3}",[7,10]],["190[0-26]\\d{6}",[10]],0,0,0,0,["14(?:5(?:1[0458]|[23][458])|71\\d)\\d{4}",[9]],["13(?:00\\d{6}(?:\\d{2})?|45[0-4]\\d{3})|13\\d{4}",[6,8,10,12]]],"0011"],CY:["357","00","(?:[279]\\d|[58]0)\\d{6}",[8],[["(\\d{2})(\\d{6})","$1 $2",["[257-9]"]]]],CZ:["420","00","(?:[2-578]\\d|60)\\d{7}|9\\d{8,11}",[9,10,11,12],[["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[2-8]|9[015-7]"]],["(\\d{2})(\\d{3})(\\d{3})(\\d{2})","$1 $2 $3 $4",["96"]],["(\\d{2})(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3 $4",["9"]],["(\\d{3})(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3 $4",["9"]]]],DE:["49","00","[2579]\\d{5,14}|49(?:[34]0|69|8\\d)\\d\\d?|49(?:37|49|60|7[089]|9\\d)\\d{1,3}|49(?:2[024-9]|3[2-689]|7[1-7])\\d{1,8}|(?:1|[368]\\d|4[0-8])\\d{3,13}|49(?:[015]\\d|2[13]|31|[46][1-8])\\d{1,9}",[4,5,6,7,8,9,10,11,12,13,14,15],[["(\\d{2})(\\d{3,13})","$1 $2",["3[02]|40|[68]9"],"0$1"],["(\\d{3})(\\d{3,12})","$1 $2",["2(?:0[1-389]|1[124]|2[18]|3[14])|3(?:[35-9][15]|4[015])|906|(?:2[4-9]|4[2-9]|[579][1-9]|[68][1-8])1","2(?:0[1-389]|12[0-8])|3(?:[35-9][15]|4[015])|906|2(?:[13][14]|2[18])|(?:2[4-9]|4[2-9]|[579][1-9]|[68][1-8])1"],"0$1"],["(\\d{4})(\\d{2,11})","$1 $2",["[24-6]|3(?:[3569][02-46-9]|4[2-4679]|7[2-467]|8[2-46-8])|70[2-8]|8(?:0[2-9]|[1-8])|90[7-9]|[79][1-9]","[24-6]|3(?:3(?:0[1-467]|2[127-9]|3[124578]|7[1257-9]|8[1256]|9[145])|4(?:2[135]|4[13578]|9[1346])|5(?:0[14]|2[1-3589]|6[1-4]|7[13468]|8[13568])|6(?:2[1-489]|3[124-6]|6[13]|7[12579]|8[1-356]|9[135])|7(?:2[1-7]|4[145]|6[1-5]|7[1-4])|8(?:21|3[1468]|6|7[1467]|8[136])|9(?:0[12479]|2[1358]|4[134679]|6[1-9]|7[136]|8[147]|9[1468]))|70[2-8]|8(?:0[2-9]|[1-8])|90[7-9]|[79][1-9]|3[68]4[1347]|3(?:47|60)[1356]|3(?:3[46]|46|5[49])[1246]|3[4579]3[1357]"],"0$1"],["(\\d{3})(\\d{4})","$1 $2",["138"],"0$1"],["(\\d{5})(\\d{2,10})","$1 $2",["3"],"0$1"],["(\\d{3})(\\d{5,11})","$1 $2",["181"],"0$1"],["(\\d{3})(\\d)(\\d{4,10})","$1 $2 $3",["1(?:3|80)|9"],"0$1"],["(\\d{3})(\\d{7,8})","$1 $2",["1[67]"],"0$1"],["(\\d{3})(\\d{7,12})","$1 $2",["8"],"0$1"],["(\\d{5})(\\d{6})","$1 $2",["185","1850","18500"],"0$1"],["(\\d{3})(\\d{4})(\\d{4})","$1 $2 $3",["7"],"0$1"],["(\\d{4})(\\d{7})","$1 $2",["18[68]"],"0$1"],["(\\d{4})(\\d{7})","$1 $2",["15[1279]"],"0$1"],["(\\d{5})(\\d{6})","$1 $2",["15[03568]","15(?:[0568]|3[13])"],"0$1"],["(\\d{3})(\\d{8})","$1 $2",["18"],"0$1"],["(\\d{3})(\\d{2})(\\d{7,8})","$1 $2 $3",["1(?:6[023]|7)"],"0$1"],["(\\d{4})(\\d{2})(\\d{7})","$1 $2 $3",["15[279]"],"0$1"],["(\\d{3})(\\d{2})(\\d{8})","$1 $2 $3",["15"],"0$1"]],"0"],DJ:["253","00","(?:2\\d|77)\\d{6}",[8],[["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[27]"]]]],DK:["45","00","[2-9]\\d{7}",[8],[["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[2-9]"]]]],DM:["1","011","(?:[58]\\d\\d|767|900)\\d{7}",[10],0,"1",0,"([2-7]\\d{6})$|1","767$1",0,"767"],DO:["1","011","(?:[58]\\d\\d|900)\\d{7}",[10],0,"1",0,0,0,0,"8001|8[024]9"],DZ:["213","00","(?:[1-4]|[5-79]\\d|80)\\d{7}",[8,9],[["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[1-4]"],"0$1"],["(\\d{2})(\\d{3})(\\d{2})(\\d{2})","$1 $2 $3 $4",["9"],"0$1"],["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[5-8]"],"0$1"]],"0"],EC:["593","00","1\\d{9,10}|(?:[2-7]|9\\d)\\d{7}",[8,9,10,11],[["(\\d)(\\d{3})(\\d{4})","$1 $2-$3",["[2-7]"],"(0$1)",0,"$1-$2-$3"],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["9"],"0$1"],["(\\d{4})(\\d{3})(\\d{3,4})","$1 $2 $3",["1"]]],"0"],EE:["372","00","8\\d{9}|[4578]\\d{7}|(?:[3-8]\\d|90)\\d{5}",[7,8,10],[["(\\d{3})(\\d{4})","$1 $2",["[369]|4[3-8]|5(?:[0-2]|5[0-478]|6[45])|7[1-9]|88","[369]|4[3-8]|5(?:[02]|1(?:[0-8]|95)|5[0-478]|6(?:4[0-4]|5[1-589]))|7[1-9]|88"]],["(\\d{4})(\\d{3,4})","$1 $2",["[45]|8(?:00|[1-49])","[45]|8(?:00[1-9]|[1-49])"]],["(\\d{2})(\\d{2})(\\d{4})","$1 $2 $3",["7"]],["(\\d{4})(\\d{3})(\\d{3})","$1 $2 $3",["8"]]]],EG:["20","00","[189]\\d{8,9}|[24-6]\\d{8}|[135]\\d{7}",[8,9,10],[["(\\d)(\\d{7,8})","$1 $2",["[23]"],"0$1"],["(\\d{2})(\\d{6,7})","$1 $2",["1[35]|[4-6]|8[2468]|9[235-7]"],"0$1"],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["[89]"],"0$1"],["(\\d{2})(\\d{8})","$1 $2",["1"],"0$1"]],"0"],EH:["212","00","[5-8]\\d{8}",[9],0,"0",0,0,0,0,"528[89]"],ER:["291","00","[178]\\d{6}",[7],[["(\\d)(\\d{3})(\\d{3})","$1 $2 $3",["[178]"],"0$1"]],"0"],ES:["34","00","[5-9]\\d{8}",[9],[["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[89]00"]],["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[5-9]"]]]],ET:["251","00","(?:11|[2-579]\\d)\\d{7}",[9],[["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["[1-579]"],"0$1"]],"0"],FI:["358","00|99(?:[01469]|5(?:[14]1|3[23]|5[59]|77|88|9[09]))","[1-35689]\\d{4}|7\\d{10,11}|(?:[124-7]\\d|3[0-46-9])\\d{8}|[1-9]\\d{5,8}",[5,6,7,8,9,10,11,12],[["(\\d{5})","$1",["20[2-59]"],"0$1"],["(\\d{3})(\\d{3,7})","$1 $2",["(?:[1-3]0|[68])0|70[07-9]"],"0$1"],["(\\d{2})(\\d{4,8})","$1 $2",["[14]|2[09]|50|7[135]"],"0$1"],["(\\d{2})(\\d{6,10})","$1 $2",["7"],"0$1"],["(\\d)(\\d{4,9})","$1 $2",["(?:19|[2568])[1-8]|3(?:0[1-9]|[1-9])|9"],"0$1"]],"0",0,0,0,0,"1[03-79]|[2-9]",0,"00"],FJ:["679","0(?:0|52)","45\\d{5}|(?:0800\\d|[235-9])\\d{6}",[7,11],[["(\\d{3})(\\d{4})","$1 $2",["[235-9]|45"]],["(\\d{4})(\\d{3})(\\d{4})","$1 $2 $3",["0"]]],0,0,0,0,0,0,0,"00"],FK:["500","00","[2-7]\\d{4}",[5]],FM:["691","00","(?:[39]\\d\\d|820)\\d{4}",[7],[["(\\d{3})(\\d{4})","$1 $2",["[389]"]]]],FO:["298","00","[2-9]\\d{5}",[6],[["(\\d{6})","$1",["[2-9]"]]],0,0,"(10(?:01|[12]0|88))"],FR:["33","00","[1-9]\\d{8}",[9],[["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["8"],"0 $1"],["(\\d)(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4 $5",["[1-79]"],"0$1"]],"0"],GA:["241","00","(?:[067]\\d|11)\\d{6}|[2-7]\\d{6}",[7,8],[["(\\d)(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[2-7]"],"0$1"],["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["0"]],["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["11|[67]"],"0$1"]],0,0,"0(11\\d{6}|60\\d{6}|61\\d{6}|6[256]\\d{6}|7[467]\\d{6})","$1"],GB:["44","00","[1-357-9]\\d{9}|[18]\\d{8}|8\\d{6}",[7,9,10],[["(\\d{3})(\\d{4})","$1 $2",["800","8001","80011","800111","8001111"],"0$1"],["(\\d{3})(\\d{2})(\\d{2})","$1 $2 $3",["845","8454","84546","845464"],"0$1"],["(\\d{3})(\\d{6})","$1 $2",["800"],"0$1"],["(\\d{5})(\\d{4,5})","$1 $2",["1(?:38|5[23]|69|76|94)","1(?:(?:38|69)7|5(?:24|39)|768|946)","1(?:3873|5(?:242|39[4-6])|(?:697|768)[347]|9467)"],"0$1"],["(\\d{4})(\\d{5,6})","$1 $2",["1(?:[2-69][02-9]|[78])"],"0$1"],["(\\d{2})(\\d{4})(\\d{4})","$1 $2 $3",["[25]|7(?:0|6[02-9])","[25]|7(?:0|6(?:[03-9]|2[356]))"],"0$1"],["(\\d{4})(\\d{6})","$1 $2",["7"],"0$1"],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["[1389]"],"0$1"]],"0",0,"0|180020",0,0,0,[["(?:1(?:1(?:3(?:[0-58]\\d\\d|73[0-5])|4(?:(?:[0-5]\\d|70)\\d|69[7-9])|(?:(?:5[0-26-9]|[78][0-49])\\d|6(?:[0-4]\\d|5[01]))\\d)|(?:2(?:(?:0[024-9]|2[3-9]|3[3-79]|4[1-689]|[58][02-9]|6[0-47-9]|7[013-9]|9\\d)\\d|1(?:[0-7]\\d|8[0-3]))|(?:3(?:0\\d|1[0-8]|[25][02-9]|3[02-579]|[468][0-46-9]|7[1-35-79]|9[2-578])|4(?:0[03-9]|[137]\\d|[28][02-57-9]|4[02-69]|5[0-8]|[69][0-79])|5(?:0[1-35-9]|[16]\\d|2[024-9]|3[015689]|4[02-9]|5[03-9]|7[0-35-9]|8[0-468]|9[0-57-9])|6(?:0[034689]|1\\d|2[0-35689]|[38][013-9]|4[1-467]|5[0-69]|6[13-9]|7[0-8]|9[0-24578])|7(?:0[0246-9]|2\\d|3[0236-8]|4[03-9]|5[0-46-9]|6[013-9]|7[0-35-9]|8[024-9]|9[02-9])|8(?:0[35-9]|2[1-57-9]|3[02-578]|4[0-578]|5[124-9]|6[2-69]|7\\d|8[02-9]|9[02569])|9(?:0[02-589]|[18]\\d|2[02-689]|3[1-57-9]|4[2-9]|5[0-579]|6[2-47-9]|7[0-24578]|9[2-57]))\\d)\\d)|2(?:0[013478]|3[0189]|4[017]|8[0-46-9]|9[0-2])\\d{3})\\d{4}|1(?:2(?:0(?:46[1-4]|87[2-9])|545[1-79]|76(?:2\\d|3[1-8]|6[1-6])|9(?:7(?:2[0-4]|3[2-5])|8(?:2[2-8]|7[0-47-9]|8[3-5])))|3(?:6(?:38[2-5]|47[23])|8(?:47[04-9]|64[0157-9]))|4(?:044[1-7]|20(?:2[23]|8\\d)|6(?:0(?:30|5[2-57]|6[1-8]|7[2-8])|140)|8(?:052|87[1-3]))|5(?:2(?:4(?:3[2-79]|6\\d)|76\\d)|6(?:26[06-9]|686))|6(?:06(?:4\\d|7[4-79])|295[5-7]|35[34]\\d|47(?:24|61)|59(?:5[08]|6[67]|74)|9(?:55[0-4]|77[23]))|7(?:26(?:6[13-9]|7[0-7])|(?:442|688)\\d|50(?:2[0-3]|[3-68]2|76))|8(?:27[56]\\d|37(?:5[2-5]|8[239])|843[2-58])|9(?:0(?:0(?:6[1-8]|85)|52\\d)|3583|4(?:66[1-8]|9(?:2[01]|81))|63(?:23|3[1-4])|9561))\\d{3}",[9,10]],["7(?:457[0-57-9]|700[01]|911[028])\\d{5}|7(?:[1-3]\\d\\d|4(?:[0-46-9]\\d|5[0-689])|5(?:0[0-8]|[13-9]\\d|2[0-35-9])|7(?:0[1-9]|[1-7]\\d|8[02-9]|9[0-689])|8(?:[014-9]\\d|[23][0-8])|9(?:[024-9]\\d|1[02-9]|3[0-689]))\\d{6}",[10]],["80[08]\\d{7}|800\\d{6}|8001111"],["(?:8(?:4[2-5]|7[0-3])|9(?:[01]\\d|8[2-49]))\\d{7}|845464\\d",[7,10]],["70\\d{8}",[10]],0,["(?:3[0347]|55)\\d{8}",[10]],["76(?:464|652)\\d{5}|76(?:0[0-28]|2[356]|34|4[01347]|5[49]|6[0-369]|77|8[14]|9[139])\\d{6}",[10]],["56\\d{8}",[10]]],0," x"],GD:["1","011","(?:473|[58]\\d\\d|900)\\d{7}",[10],0,"1",0,"([2-9]\\d{6})$|1","473$1",0,"473"],GE:["995","00","(?:[3-57]\\d\\d|800)\\d{6}",[9],[["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["70"],"0$1"],["(\\d{2})(\\d{3})(\\d{2})(\\d{2})","$1 $2 $3 $4",["32"],"0$1"],["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[57]"]],["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[348]"],"0$1"]],"0"],GF:["594","00","(?:[56]94\\d|7093)\\d{5}|(?:80|9\\d)\\d{7}",[9],[["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[5-7]|9[47]"],"0$1"],["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[89]"],"0$1"]],"0"],GG:["44","00","(?:1481|[357-9]\\d{3})\\d{6}|8\\d{6}(?:\\d{2})?",[7,9,10],0,"0",0,"([25-9]\\d{5})$|0|180020","1481$1",0,0,[["1481[25-9]\\d{5}",[10]],["7(?:(?:781|839)\\d|911[17])\\d{5}",[10]],["80[08]\\d{7}|800\\d{6}|8001111"],["(?:8(?:4[2-5]|7[0-3])|9(?:[01]\\d|8[0-3]))\\d{7}|845464\\d",[7,10]],["70\\d{8}",[10]],0,["(?:3[0347]|55)\\d{8}",[10]],["76(?:464|652)\\d{5}|76(?:0[0-28]|2[356]|34|4[01347]|5[49]|6[0-369]|77|8[14]|9[139])\\d{6}",[10]],["56\\d{8}",[10]]]],GH:["233","00","(?:[235]\\d{3}|800)\\d{5}",[8,9],[["(\\d{3})(\\d{5})","$1 $2",["8"],"0$1"],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["[235]"],"0$1"]],"0"],GI:["350","00","(?:[25]\\d|60)\\d{6}",[8],[["(\\d{3})(\\d{5})","$1 $2",["2"]]]],GL:["299","00","(?:19|[2-689]\\d|70)\\d{4}",[6],[["(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3",["19|[2-9]"]]]],GM:["220","00","[2-9]\\d{6}",[7],[["(\\d{3})(\\d{4})","$1 $2",["[2-9]"]]]],GN:["224","00","722\\d{6}|(?:3|6\\d)\\d{7}",[8,9],[["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["3"]],["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[67]"]]]],GP:["590","00","(?:590\\d|7090)\\d{5}|(?:69|80|9\\d)\\d{7}",[9],[["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[5-79]"],"0$1"],["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["8"],"0$1"]],"0",0,0,0,0,0,[["590(?:0[1-68]|[14][0-24-9]|2[0-68]|3[1-9]|5[3-579]|[68][0-689]|7[08]|9\\d)\\d{4}"],["(?:69(?:0\\d\\d|1(?:2[2-9]|3[0-5])|4(?:0[89]|1[2-6]|9\\d)|6(?:1[016-9]|5[0-4]|[67]\\d))|7090[0-4])\\d{4}"],["80[0-5]\\d{6}"],0,0,0,0,0,["9(?:(?:39[5-7]|76[018])\\d|475[0-6])\\d{4}"]]],GQ:["240","00","222\\d{6}|(?:3\\d|55|[89]0)\\d{7}",[9],[["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[235]"]],["(\\d{3})(\\d{6})","$1 $2",["[89]"]]]],GR:["30","00","5005000\\d{3}|8\\d{9,11}|(?:[269]\\d|70)\\d{8}",[10,11,12],[["(\\d{2})(\\d{4})(\\d{4})","$1 $2 $3",["21|7"]],["(\\d{4})(\\d{6})","$1 $2",["2(?:2|3[2-57-9]|4[2-469]|5[2-59]|6[2-9]|7[2-69]|8[2-49])|5"]],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["[2689]"]],["(\\d{3})(\\d{3,4})(\\d{5})","$1 $2 $3",["8"]]]],GT:["502","00","80\\d{6}|(?:1\\d{3}|[2-7])\\d{7}",[8,11],[["(\\d{4})(\\d{4})","$1 $2",["[2-8]"]],["(\\d{4})(\\d{3})(\\d{4})","$1 $2 $3",["1"]]]],GU:["1","011","(?:[58]\\d\\d|671|900)\\d{7}",[10],0,"1",0,"([2-9]\\d{6})$|1","671$1",0,"671"],GW:["245","00","[49]\\d{8}|4\\d{6}",[7,9],[["(\\d{3})(\\d{4})","$1 $2",["40"]],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[49]"]]]],GY:["592","001","(?:[2-8]\\d{3}|9008)\\d{3}",[7],[["(\\d{3})(\\d{4})","$1 $2",["[2-9]"]]]],HK:["852","00(?:30|5[09]|[126-9]?)","8[0-46-9]\\d{6,7}|9\\d{4,7}|(?:[2-7]|9\\d{3})\\d{7}",[5,6,7,8,9,11],[["(\\d{3})(\\d{2,5})","$1 $2",["900","9003"]],["(\\d{4})(\\d{4})","$1 $2",["[2-7]|8[1-4]|9(?:0[1-9]|[1-8])"]],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["8"]],["(\\d{3})(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3 $4",["9"]]],0,0,0,0,0,0,0,"00"],HN:["504","00","8\\d{10}|[237-9]\\d{7}",[8,11],[["(\\d{4})(\\d{4})","$1-$2",["[237-9]"]]]],HR:["385","00","[2-69]\\d{8}|80\\d{5,7}|[1-79]\\d{7}|6\\d{6}",[7,8,9],[["(\\d{2})(\\d{2})(\\d{3})","$1 $2 $3",["6[01]"],"0$1"],["(\\d{3})(\\d{2})(\\d{2,3})","$1 $2 $3",["8"],"0$1"],["(\\d)(\\d{4})(\\d{3})","$1 $2 $3",["1"],"0$1"],["(\\d{2})(\\d{3})(\\d{3,4})","$1 $2 $3",["6|7[245]"],"0$1"],["(\\d{2})(\\d{3})(\\d{3,4})","$1 $2 $3",["9"],"0$1"],["(\\d{2})(\\d{3})(\\d{3,4})","$1 $2 $3",["[2-57]"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["8"],"0$1"]],"0"],HT:["509","00","[2-589]\\d{7}",[8],[["(\\d{2})(\\d{2})(\\d{4})","$1 $2 $3",["[2-589]"]]]],HU:["36","00","[235-7]\\d{8}|[1-9]\\d{7}",[8,9],[["(\\d)(\\d{3})(\\d{4})","$1 $2 $3",["1"],"(06 $1)"],["(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3",["[27][2-9]|3[2-7]|4[24-9]|5[2-79]|6|8[2-57-9]|9[2-69]"],"(06 $1)"],["(\\d{2})(\\d{3})(\\d{3,4})","$1 $2 $3",["[2-9]"],"06 $1"]],"06"],ID:["62","00[89]","00[1-9]\\d{9,14}|(?:[1-36]|8\\d{5})\\d{6}|00\\d{9}|[1-9]\\d{8,10}|[2-9]\\d{7}",[7,8,9,10,11,12,13,14,15,16,17],[["(\\d)(\\d{3})(\\d{3})","$1 $2 $3",["15"]],["(\\d{2})(\\d{5,9})","$1 $2",["2[124]|[36]1"],"(0$1)"],["(\\d{3})(\\d{5,7})","$1 $2",["800"],"0$1"],["(\\d{3})(\\d{5,8})","$1 $2",["[2-79]"],"(0$1)"],["(\\d{3})(\\d{3,4})(\\d{3})","$1-$2-$3",["8[1-35-9]"],"0$1"],["(\\d{3})(\\d{6,8})","$1 $2",["1"],"0$1"],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["804"],"0$1"],["(\\d{3})(\\d)(\\d{3})(\\d{3})","$1 $2 $3 $4",["80"],"0$1"],["(\\d{3})(\\d{4})(\\d{4,5})","$1-$2-$3",["8"],"0$1"]],"0"],IE:["353","00","(?:1\\d|[2569])\\d{6,8}|4\\d{6,9}|7\\d{8}|8\\d{8,9}",[7,8,9,10],[["(\\d{2})(\\d{5})","$1 $2",["2[24-9]|47|58|6[237-9]|9[35-9]"],"(0$1)"],["(\\d{3})(\\d{5})","$1 $2",["[45]0"],"(0$1)"],["(\\d)(\\d{3,4})(\\d{4})","$1 $2 $3",["1"],"(0$1)"],["(\\d{2})(\\d{3})(\\d{3,4})","$1 $2 $3",["[2569]|4[1-69]|7[14]"],"(0$1)"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["70"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["81"],"(0$1)"],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["[78]"],"0$1"],["(\\d{4})(\\d{3})(\\d{3})","$1 $2 $3",["1"]],["(\\d{2})(\\d{4})(\\d{4})","$1 $2 $3",["4"],"(0$1)"],["(\\d{2})(\\d)(\\d{3})(\\d{4})","$1 $2 $3 $4",["8"],"0$1"]],"0"],IL:["972","0(?:0|1[2-9])","1\\d{6}(?:\\d{3,5})?|[57]\\d{8}|[1-489]\\d{7}",[7,8,9,10,11,12],[["(\\d{4})(\\d{3})","$1-$2",["125"]],["(\\d{4})(\\d{2})(\\d{2})","$1-$2-$3",["121"]],["(\\d)(\\d{3})(\\d{4})","$1-$2-$3",["[2-489]"],"0$1"],["(\\d{2})(\\d{3})(\\d{4})","$1-$2-$3",["[57]"],"0$1"],["(\\d{4})(\\d{3})(\\d{3})","$1-$2-$3",["12"]],["(\\d{4})(\\d{6})","$1-$2",["159"]],["(\\d)(\\d{3})(\\d{3})(\\d{3})","$1-$2-$3-$4",["1[7-9]"]],["(\\d{3})(\\d{1,2})(\\d{3})(\\d{4})","$1-$2 $3-$4",["15"]]],"0"],IM:["44","00","1624\\d{6}|(?:[3578]\\d|90)\\d{8}",[10],0,"0",0,"([25-8]\\d{5})$|0|180020","1624$1",0,"74576|(?:16|7[56])24"],IN:["91","00","(?:000800|[2-9]\\d\\d)\\d{7}|1\\d{7,12}",[8,9,10,11,12,13],[["(\\d{8})","$1",["5(?:0|2[23]|3[03]|[67]1|88)","5(?:0|2(?:21|3)|3(?:0|3[23])|616|717|888)","5(?:0|2(?:21|3)|3(?:0|3[23])|616|717|8888)"],0,1],["(\\d{4})(\\d{4,5})","$1 $2",["180","1800"],0,1],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["140"],0,1],["(\\d{2})(\\d{4})(\\d{4})","$1 $2 $3",["11|2[02]|33|4[04]|79[1-7]|80[2-46]","11|2[02]|33|4[04]|79(?:[1-6]|7[19])|80(?:[2-4]|6[0-589])","11|2[02]|33|4[04]|79(?:[124-6]|3(?:[02-9]|1[0-24-9])|7(?:1|9[1-6]))|80(?:[2-4]|6[0-589])"],"0$1",1],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["1(?:2[0-249]|3[0-25]|4[145]|[68]|7[1257])|2(?:1[257]|3[013]|4[01]|5[0137]|6[0158]|78|8[1568])|3(?:26|4[1-3]|5[34]|6[01489]|7[02-46]|8[159])|4(?:1[36]|2[1-47]|5[12]|6[0-26-9]|7[0-24-9]|8[013-57]|9[014-7])|5(?:1[025]|22|[36][25]|4[28]|5[12]|[78]1)|6(?:12|[2-4]1|5[17]|6[13]|80)|7(?:12|3[134]|4[47]|61|88)|8(?:16|2[014]|3[126]|6[136]|7[078]|8[34]|91)|(?:43|59|75)[15]|(?:1[59]|29|67|72)[14]","1(?:2[0-24]|3[0-25]|4[145]|[59][14]|6[1-9]|7[1257]|8[1-57-9])|2(?:1[257]|3[013]|4[01]|5[0137]|6[058]|78|8[1568]|9[14])|3(?:26|4[1-3]|5[34]|6[01489]|7[02-46]|8[159])|4(?:1[36]|2[1-47]|3[15]|5[12]|6[0-26-9]|7[0-24-9]|8[013-57]|9[014-7])|5(?:1[025]|22|[36][25]|4[28]|[578]1|9[15])|674|7(?:(?:2[14]|3[34]|5[15])[2-6]|61[346]|88[0-8])|8(?:70[2-6]|84[235-7]|91[3-7])|(?:1(?:29|60|8[06])|261|552|6(?:12|[2-47]1|5[17]|6[13]|80)|7(?:12|31|4[47])|8(?:16|2[014]|3[126]|6[136]|7[78]|83))[2-7]","1(?:2[0-24]|3[0-25]|4[145]|[59][14]|6[1-9]|7[1257]|8[1-57-9])|2(?:1[257]|3[013]|4[01]|5[0137]|6[058]|78|8[1568]|9[14])|3(?:26|4[1-3]|5[34]|6[01489]|7[02-46]|8[159])|4(?:1[36]|2[1-47]|3[15]|5[12]|6[0-26-9]|7[0-24-9]|8[013-57]|9[014-7])|5(?:1[025]|22|[36][25]|4[28]|[578]1|9[15])|6(?:12(?:[2-6]|7[0-8])|74[2-7])|7(?:(?:2[14]|5[15])[2-6]|3171|61[346]|88(?:[2-7]|82))|8(?:70[2-6]|84(?:[2356]|7[19])|91(?:[3-6]|7[19]))|73[134][2-6]|(?:74[47]|8(?:16|2[014]|3[126]|6[136]|7[78]|83))(?:[2-6]|7[19])|(?:1(?:29|60|8[06])|261|552|6(?:[2-4]1|5[17]|6[13]|7(?:1|4[0189])|80)|7(?:12|88[01]))[2-7]"],"0$1",1],["(\\d{4})(\\d{3})(\\d{3})","$1 $2 $3",["1(?:[2-479]|5[0235-9])|[2-5]|6(?:1[1358]|2[2457-9]|3[2-5]|4[235-7]|5[2-689]|6[24578]|7[235689]|8[1-6])|7(?:1[013-9]|28|3[129]|4[1-35689]|5[29]|6[02-5]|70)|807","1(?:[2-479]|5[0235-9])|[2-5]|6(?:1[1358]|2(?:[2457]|84|95)|3(?:[2-4]|55)|4[235-7]|5[2-689]|6[24578]|7[235689]|8[1-6])|7(?:1(?:[013-8]|9[6-9])|28[6-8]|3(?:17|2[0-49]|9[2-57])|4(?:1[2-4]|[29][0-7]|3[0-8]|[56]|8[0-24-7])|5(?:2[1-3]|9[0-6])|6(?:0[5689]|2[5-9]|3[02-8]|4|5[0-367])|70[13-7])|807[19]","1(?:[2-479]|5(?:[0236-9]|5[013-9]))|[2-5]|6(?:2(?:84|95)|355|8(?:28[235-7]|3))|73179|807(?:1|9[1-3])|(?:1552|6(?:(?:1[1358]|2[2457]|3[2-4]|4[235-7]|5[2-689]|6[24578]|7[235689])\\d|8(?:[14-6]\\d|2[0-79]))|7(?:1(?:[013-8]\\d|9[6-9])|28[6-8]|3(?:2[0-49]|9[2-57])|4(?:1[2-4]|[29][0-7]|3[0-8]|[56]\\d|8[0-24-7])|5(?:2[1-3]|9[0-6])|6(?:0[5689]|2[5-9]|3[02-8]|4\\d|5[0-367])|70[13-7]))[2-7]"],"0$1",1],["(\\d{5})(\\d{5})","$1 $2",["[6-9]"],"0$1",1],["(\\d{4})(\\d{2,4})(\\d{4})","$1 $2 $3",["1(?:6|8[06])","1(?:6|8[06]0)"],0,1],["(\\d{4})(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3 $4",["18"],0,1]],"0"],IO:["246","00","3\\d{6}",[7],[["(\\d{3})(\\d{4})","$1 $2",["3"]]]],IQ:["964","00","(?:1|7\\d\\d)\\d{7}|[2-6]\\d{7,8}",[8,9,10],[["(\\d)(\\d{3})(\\d{4})","$1 $2 $3",["1"],"0$1"],["(\\d{2})(\\d{3})(\\d{3,4})","$1 $2 $3",["[2-6]"],"0$1"],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["7"],"0$1"]],"0"],IR:["98","00","[1-9]\\d{9}|(?:[1-8]\\d\\d|9)\\d{3,4}",[4,5,6,7,10],[["(\\d{4,5})","$1",["96"],"0$1"],["(\\d{2})(\\d{4,5})","$1 $2",["(?:1[137]|2[13-68]|3[1458]|4[145]|5[1468]|6[16]|7[1467]|8[13467])[12689]"],"0$1"],["(\\d{3})(\\d{3})(\\d{3,4})","$1 $2 $3",["9"],"0$1"],["(\\d{2})(\\d{4})(\\d{4})","$1 $2 $3",["[1-8]"],"0$1"]],"0"],IS:["354","00|1(?:0(?:01|[12]0)|100)","(?:38\\d|[4-9])\\d{6}",[7,9],[["(\\d{3})(\\d{4})","$1 $2",["[4-9]"]],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["3"]]],0,0,0,0,0,0,0,"00"],IT:["39","00","0\\d{5,11}|1\\d{8,10}|3(?:[0-8]\\d{7,10}|9\\d{7,8})|(?:43|55|70)\\d{8}|8\\d{5}(?:\\d{2,4})?",[6,7,8,9,10,11,12],[["(\\d{2})(\\d{4,6})","$1 $2",["0[26]"]],["(\\d{3})(\\d{3,6})","$1 $2",["0[13-57-9][0159]|8(?:03|4[17]|9[2-5])","0[13-57-9][0159]|8(?:03|4[17]|9(?:2|3[04]|[45][0-4]))"]],["(\\d{4})(\\d{2,6})","$1 $2",["0(?:[13-579][2-46-8]|8[236-8])"]],["(\\d{4})(\\d{4})","$1 $2",["894"]],["(\\d{2})(\\d{3,4})(\\d{4})","$1 $2 $3",["0[26]|5"]],["(\\d{3})(\\d{3})(\\d{3,4})","$1 $2 $3",["1(?:44|[679])|[378]|43"]],["(\\d{3})(\\d{3,4})(\\d{4})","$1 $2 $3",["0[13-57-9][0159]|14"]],["(\\d{2})(\\d{4})(\\d{5})","$1 $2 $3",["0[26]"]],["(\\d{4})(\\d{3})(\\d{4})","$1 $2 $3",["0"]],["(\\d{3})(\\d{4})(\\d{4,5})","$1 $2 $3",["[03]"]]],0,0,0,0,0,0,[["0(?:669[0-79]\\d{1,6}|831\\d{2,8})|0(?:1(?:[0159]\\d|[27][1-5]|31|4[1-4]|6[1356]|8[2-57])|2\\d\\d|3(?:[0159]\\d|2[1-4]|3[12]|[48][1-6]|6[2-59]|7[1-7])|4(?:[0159]\\d|[23][1-9]|4[245]|6[1-5]|7[1-4]|81)|5(?:[0159]\\d|2[1-5]|3[2-6]|4[1-79]|6[4-6]|7[1-578]|8[3-8])|6(?:[0-57-9]\\d|6[0-8])|7(?:[0159]\\d|2[12]|3[1-7]|4[2-46]|6[13569]|7[13-6]|8[1-59])|8(?:[0159]\\d|2[3-578]|3[2356]|[6-8][1-5])|9(?:[0159]\\d|[238][1-5]|4[12]|6[1-8]|7[1-6]))\\d{2,7}"],["3[2-9]\\d{7,8}|(?:31|43)\\d{8}",[9,10]],["80(?:0\\d{3}|3)\\d{3}",[6,9]],["(?:0878\\d{3}|89(?:2\\d|3[04]|4(?:[0-4]|[5-9]\\d\\d)|5[0-4]))\\d\\d|(?:1(?:44|6[346])|89(?:38|5[5-9]|9))\\d{6}",[6,8,9,10]],["1(?:78\\d|99)\\d{6}",[9,10]],["3[2-8]\\d{9,10}",[11,12]],0,0,["55\\d{8}",[10]],["84(?:[08]\\d{3}|[17])\\d{3}",[6,9]]]],JE:["44","00","1534\\d{6}|(?:[3578]\\d|90)\\d{8}",[10],0,"0",0,"([0-24-8]\\d{5})$|0|180020","1534$1",0,0,[["1534[0-24-8]\\d{5}"],["7(?:(?:(?:50|82)9|937)\\d|7(?:00[378]|97\\d))\\d{5}"],["80(?:07(?:35|81)|8901)\\d{4}"],["(?:8(?:4(?:4(?:4(?:05|42|69)|703)|5(?:041|800))|7(?:0002|1206))|90(?:066[59]|1810|71(?:07|55)))\\d{4}"],["701511\\d{4}"],0,["(?:3(?:0(?:07(?:35|81)|8901)|3\\d{4}|4(?:4(?:4(?:05|42|69)|703)|5(?:041|800))|7(?:0002|1206))|55\\d{4})\\d{4}"],["76(?:464|652)\\d{5}|76(?:0[0-28]|2[356]|34|4[01347]|5[49]|6[0-369]|77|8[14]|9[139])\\d{6}"],["56\\d{8}"]]],JM:["1","011","(?:[58]\\d\\d|658|900)\\d{7}",[10],0,"1",0,0,0,0,"658|876"],JO:["962","00","(?:(?:[2689]|7\\d)\\d|32|427|53)\\d{6}",[8,9],[["(\\d)(\\d{3})(\\d{4})","$1 $2 $3",["[2356]|87"],"(0$1)"],["(\\d{3})(\\d{5,6})","$1 $2",["[89]"],"0$1"],["(\\d{2})(\\d{7})","$1 $2",["70"],"0$1"],["(\\d)(\\d{4})(\\d{4})","$1 $2 $3",["[47]"],"0$1"]],"0"],JP:["81","010","00[1-9]\\d{6,14}|[25-9]\\d{9}|(?:00|[1-9]\\d\\d)\\d{6}",[8,9,10,11,12,13,14,15,16,17],[["(\\d{3})(\\d{3})(\\d{3})","$1-$2-$3",["(?:12|57|99)0"],"0$1"],["(\\d{4})(\\d)(\\d{4})","$1-$2-$3",["1(?:26|3[79]|4[56]|5[4-68]|6[3-5])|499|5(?:76|97)|746|8(?:3[89]|47|51)|9(?:80|9[16])","1(?:267|3(?:7[247]|9[278])|466|5(?:47|58|64)|6(?:3[245]|48|5[4-68]))|499[2468]|5(?:76|97)9|7468|8(?:3(?:8[7-9]|96)|477|51[2-9])|9(?:802|9(?:1[23]|69))|1(?:45|58)[67]","1(?:267|3(?:7[247]|9[278])|466|5(?:47|58|64)|6(?:3[245]|48|5[4-68]))|499[2468]|5(?:769|979[2-69])|7468|8(?:3(?:8[7-9]|96[2457-9])|477|51[2-9])|9(?:802|9(?:1[23]|69))|1(?:45|58)[67]"],"0$1"],["(\\d{2})(\\d{3})(\\d{4})","$1-$2-$3",["60"],"0$1"],["(\\d)(\\d{4})(\\d{4})","$1-$2-$3",["3|4(?:2[09]|7[01])|6[1-9]","3|4(?:2(?:0|9[02-69])|7(?:0[019]|1))|6[1-9]"],"0$1"],["(\\d{2})(\\d{3})(\\d{4})","$1-$2-$3",["1(?:1|5[45]|77|88|9[69])|2(?:2[1-37]|3[0-269]|4[59]|5|6[24]|7[1-358]|8[1369]|9[0-38])|4(?:[28][1-9]|3[0-57]|[45]|6[248]|7[2-579]|9[29])|5(?:2|3[0459]|4[0-369]|5[29]|8[02389]|9[0-389])|7(?:2[02-46-9]|34|[58]|6[0249]|7[57]|9[2-6])|8(?:2[124589]|3[26-9]|49|51|6|7[0-468]|8[68]|9[019])|9(?:[23][1-9]|4[15]|5[138]|6[1-3]|7[156]|8[189]|9[1-489])","1(?:1|5(?:4[018]|5[017])|77|88|9[69])|2(?:2(?:[127]|3[014-9])|3[0-269]|4[59]|5(?:[1-3]|5[0-69]|9[19])|62|7(?:[1-35]|8[0189])|8(?:[16]|3[0134]|9[0-5])|9(?:[028]|17))|4(?:2(?:[13-79]|8[014-6])|3[0-57]|[45]|6[248]|7[2-47]|8[1-9]|9[29])|5(?:2|3(?:[045]|9[0-8])|4[0-369]|5[29]|8[02389]|9[0-3])|7(?:2[02-46-9]|34|[58]|6[0249]|7[57]|9(?:[23]|4[0-59]|5[01569]|6[0167]))|8(?:2(?:[1258]|4[0-39]|9[0-2469])|3(?:[29]|60)|49|51|6(?:[0-24]|36|5[0-3589]|7[23]|9[01459])|7[0-468]|8[68])|9(?:[23][1-9]|4[15]|5[138]|6[1-3]|7[156]|8[189]|9(?:[1289]|3[34]|4[0178]))|(?:264|837)[016-9]|2(?:57|93)[015-9]|(?:25[0468]|422|838)[01]|(?:47[59]|59[89]|8(?:6[68]|9))[019]","1(?:1|5(?:4[018]|5[017])|77|88|9[69])|2(?:2[127]|3[0-269]|4[59]|5(?:[1-3]|5[0-69]|9(?:17|99))|6(?:2|4[016-9])|7(?:[1-35]|8[0189])|8(?:[16]|3[0134]|9[0-5])|9(?:[028]|17))|4(?:2(?:[13-79]|8[014-6])|3[0-57]|[45]|6[248]|7[2-47]|9[29])|5(?:2|3(?:[045]|9(?:[0-58]|6[4-9]|7[0-35689]))|4[0-369]|5[29]|8[02389]|9[0-3])|7(?:2[02-46-9]|34|[58]|6[0249]|7[57]|9(?:[23]|4[0-59]|5[01569]|6[0167]))|8(?:2(?:[1258]|4[0-39]|9[0169])|3(?:[29]|60|7(?:[017-9]|6[6-8]))|49|51|6(?:[0-24]|36[2-57-9]|5(?:[0-389]|5[23])|6(?:[01]|9[178])|7(?:2[2-468]|3[78])|9[0145])|7[0-468]|8[68])|9(?:4[15]|5[138]|7[156]|8[189]|9(?:[1289]|3(?:31|4[357])|4[0178]))|(?:8294|96)[1-3]|2(?:57|93)[015-9]|(?:223|8699)[014-9]|(?:25[0468]|422|838)[01]|(?:48|8292|9[23])[1-9]|(?:47[59]|59[89]|8(?:68|9))[019]"],"0$1"],["(\\d{3})(\\d{2})(\\d{4})","$1-$2-$3",["[14]|[289][2-9]|5[3-9]|7[2-4679]"],"0$1"],["(\\d{3})(\\d{3})(\\d{4})","$1-$2-$3",["800"],"0$1"],["(\\d{2})(\\d{4})(\\d{4})","$1-$2-$3",["[25-9]"],"0$1"]],"0",0,"(000[2569]\\d{4,6})$|(?:(?:003768)0?)|0","$1"],KE:["254","000","(?:[17]\\d\\d|900)\\d{6}|(?:2|80)0\\d{6,7}|[4-6]\\d{6,8}",[7,8,9,10],[["(\\d{2})(\\d{5,7})","$1 $2",["[24-6]"],"0$1"],["(\\d{3})(\\d{6})","$1 $2",["[17]"],"0$1"],["(\\d{3})(\\d{3})(\\d{3,4})","$1 $2 $3",["[89]"],"0$1"]],"0"],KG:["996","00","8\\d{9}|[235-9]\\d{8}",[9,10],[["(\\d{4})(\\d{5})","$1 $2",["3(?:1[346]|[24-79])"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[235-79]|88"],"0$1"],["(\\d{3})(\\d{3})(\\d)(\\d{2,3})","$1 $2 $3 $4",["8"],"0$1"]],"0"],KH:["855","00[14-9]","1\\d{9}|[1-9]\\d{7,8}",[8,9,10],[["(\\d{2})(\\d{3})(\\d{3,4})","$1 $2 $3",["[1-9]"],"0$1"],["(\\d{4})(\\d{3})(\\d{3})","$1 $2 $3",["1"]]],"0"],KI:["686","00","(?:[37]\\d|6[0-79])\\d{6}|(?:[2-48]\\d|50)\\d{3}",[5,8],0,"0"],KM:["269","00","[3478]\\d{6}",[7],[["(\\d{3})(\\d{2})(\\d{2})","$1 $2 $3",["[3478]"]]]],KN:["1","011","(?:[58]\\d\\d|900)\\d{7}",[10],0,"1",0,"([2-7]\\d{6})$|1","869$1",0,"869"],KP:["850","00|99","85\\d{6}|(?:19\\d|[2-7])\\d{7}",[8,10],[["(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3",["8"],"0$1"],["(\\d)(\\d{3})(\\d{4})","$1 $2 $3",["[2-7]"],"0$1"],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["1"],"0$1"]],"0"],KR:["82","00(?:[125689]|3(?:[46]5|91)|7(?:00|27|3|55|6[126]))","00[1-9]\\d{8,11}|(?:[12]|5\\d{3})\\d{7}|[13-6]\\d{9}|(?:[1-6]\\d|80)\\d{7}|[3-6]\\d{4,5}|(?:00|7)0\\d{8}",[5,6,8,9,10,11,12,13,14],[["(\\d{2})(\\d{3,4})","$1-$2",["(?:3[1-3]|[46][1-4]|5[1-5])1"],"0$1"],["(\\d{4})(\\d{4})","$1-$2",["1"]],["(\\d)(\\d{3,4})(\\d{4})","$1-$2-$3",["2"],"0$1"],["(\\d{2})(\\d{3})(\\d{4})","$1-$2-$3",["[36]0|8"],"0$1"],["(\\d{2})(\\d{3,4})(\\d{4})","$1-$2-$3",["[1346]|5[1-5]"],"0$1"],["(\\d{2})(\\d{4})(\\d{4})","$1-$2-$3",["[57]"],"0$1"],["(\\d{2})(\\d{5})(\\d{4})","$1-$2-$3",["5"],"0$1"]],"0",0,"0(8(?:[1-46-8]|5\\d\\d))?"],KW:["965","00","18\\d{5}|(?:[2569]\\d|41)\\d{6}",[7,8],[["(\\d{4})(\\d{3,4})","$1 $2",["[169]|2(?:[235]|4[1-35-9])|52"]],["(\\d{3})(\\d{5})","$1 $2",["[245]"]]]],KY:["1","011","(?:345|[58]\\d\\d|900)\\d{7}",[10],0,"1",0,"([2-9]\\d{6})$|1","345$1",0,"345"],KZ:["7","810","(?:33622|8\\d{8})\\d{5}|[78]\\d{9}",[10,14],0,"8",0,0,0,0,"33622|7",0,"8~10"],LA:["856","00","[23]\\d{9}|3\\d{8}|(?:[235-8]\\d|41)\\d{6}",[8,9,10],[["(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3",["2[13]|3[14]|[4-8]"],"0$1"],["(\\d{2})(\\d{2})(\\d{2})(\\d{3})","$1 $2 $3 $4",["3"],"0$1"],["(\\d{2})(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3 $4",["[23]"],"0$1"]],"0"],LB:["961","00","[27-9]\\d{7}|[13-9]\\d{6}",[7,8],[["(\\d)(\\d{3})(\\d{3})","$1 $2 $3",["[13-69]|7(?:[2-57]|62|8[0-6]|9[04-9])|8[02-9]"],"0$1"],["(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3",["[27-9]"]]],"0"],LC:["1","011","(?:[58]\\d\\d|758|900)\\d{7}",[10],0,"1",0,"([2-8]\\d{6})$|1","758$1",0,"758"],LI:["423","00","[68]\\d{8}|(?:[2378]\\d|90)\\d{5}",[7,9],[["(\\d{3})(\\d{2})(\\d{2})","$1 $2 $3",["[2379]|8(?:0[09]|7)","[2379]|8(?:0(?:02|9)|7)"]],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["8"]],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["69"]],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["6"]]],"0",0,"(1001)|0"],LK:["94","00","[1-9]\\d{8}",[9],[["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["7"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[1-689]"],"0$1"]],"0"],LR:["231","00","(?:[2457]\\d|33|88)\\d{7}|(?:2\\d|[4-6])\\d{6}",[7,8,9],[["(\\d)(\\d{3})(\\d{3})","$1 $2 $3",["4[67]|[56]"],"0$1"],["(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3",["2"],"0$1"],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["[2-578]"],"0$1"]],"0"],LS:["266","00","(?:[256]\\d\\d|800)\\d{5}",[8],[["(\\d{4})(\\d{4})","$1 $2",["[2568]"]]]],LT:["370","00","(?:[3469]\\d|52|[78]0)\\d{6}",[8],[["(\\d)(\\d{3})(\\d{4})","$1 $2 $3",["52[0-7]"],"(0-$1)",1],["(\\d{3})(\\d{2})(\\d{3})","$1 $2 $3",["[7-9]"],"0 $1",1],["(\\d{2})(\\d{6})","$1 $2",["37|4(?:[15]|6[1-8])"],"(0-$1)",1],["(\\d{3})(\\d{5})","$1 $2",["[3-6]"],"(0-$1)",1]],"0",0,"[08]"],LU:["352","00","35[013-9]\\d{4,8}|6\\d{8}|35\\d{2,4}|(?:[2457-9]\\d|3[0-46-9])\\d{2,9}",[4,5,6,7,8,9,10,11],[["(\\d{2})(\\d{3})","$1 $2",["2(?:0[2-689]|[2-9])|[3-57]|8(?:0[2-9]|[13-9])|9(?:0[89]|[2-579])"]],["(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3",["2(?:0[2-689]|[2-9])|[3-57]|8(?:0[2-9]|[13-9])|9(?:0[89]|[2-579])"]],["(\\d{2})(\\d{2})(\\d{3})","$1 $2 $3",["20[2-689]"]],["(\\d{2})(\\d{2})(\\d{2})(\\d{1,2})","$1 $2 $3 $4",["2(?:[0367]|4[3-8])"]],["(\\d{3})(\\d{2})(\\d{3})","$1 $2 $3",["80[01]|90[015]"]],["(\\d{2})(\\d{2})(\\d{2})(\\d{3})","$1 $2 $3 $4",["20"]],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["6"]],["(\\d{2})(\\d{2})(\\d{2})(\\d{2})(\\d{1,2})","$1 $2 $3 $4 $5",["2(?:[0367]|4[3-8])"]],["(\\d{2})(\\d{2})(\\d{2})(\\d{1,5})","$1 $2 $3 $4",["[3-57]|8[13-9]|9(?:0[89]|[2-579])|(?:2|80)[2-9]"]]],0,0,"(15(?:0[06]|1[12]|[35]5|4[04]|6[26]|77|88|99)\\d)"],LV:["371","00","(?:[268]\\d|78|90)\\d{6}",[8],[["(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3",["[2679]|8[01]"]]]],LY:["218","00","[2-9]\\d{8}",[9],[["(\\d{2})(\\d{7})","$1-$2",["[2-9]"],"0$1"]],"0"],MA:["212","00","[5-8]\\d{8}",[9],[["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["5[45]"],"0$1"],["(\\d{4})(\\d{5})","$1-$2",["5(?:[19]|2[2-46-9]|3[3-9])|8(?:0[89]|92)"],"0$1"],["(\\d{2})(\\d{7})","$1-$2",["8"],"0$1"],["(\\d{3})(\\d{6})","$1-$2",["[5-7]"],"0$1"]],"0",0,0,0,0,0,[["5(?:(?:18|4[0679]|5[03])\\d|2(?:[0-25-79]\\d|3[1-578]|4[02-46-8]|8[0235-7])|3(?:[0-47]\\d|5[02-9]|6[02-8]|8[014-9]|9[3-9]))\\d{5}"],["(?:6(?:[0-79]\\d|8[0-247-9])|7(?:[016-8]\\d|2[0-8]|5[0-5]))\\d{6}"],["80[0-7]\\d{6}"],["89\\d{7}"],0,0,0,0,["(?:592(?:4[0-2]|93)|80[89]\\d\\d)\\d{4}"]]],MC:["377","00","(?:[3489]|[67]\\d)\\d{7}",[8,9],[["(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3",["4"],"0$1"],["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[389]"]],["(\\d)(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4 $5",["[67]"],"0$1"]],"0"],MD:["373","00","(?:[235-7]\\d|[89]0)\\d{6}",[8],[["(\\d{3})(\\d{5})","$1 $2",["[89]"],"0$1"],["(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3",["22|3"],"0$1"],["(\\d{3})(\\d{2})(\\d{3})","$1 $2 $3",["[25-7]"],"0$1"]],"0"],ME:["382","00","(?:20|[3-79]\\d)\\d{6}|80\\d{6,7}",[8,9],[["(\\d{2})(\\d{3})(\\d{3,4})","$1 $2 $3",["[2-9]"],"0$1"]],"0"],MF:["590","00","(?:590\\d|7090)\\d{5}|(?:69|80|9\\d)\\d{7}",[9],0,"0",0,0,0,0,0,[["590(?:0[079]|[14]3|[27][79]|3[03-7]|5[0-268]|87)\\d{4}"],["(?:69(?:0\\d\\d|1(?:2[2-9]|3[0-5])|4(?:0[89]|1[2-6]|9\\d)|6(?:1[016-9]|5[0-4]|[67]\\d))|7090[0-4])\\d{4}"],["80[0-5]\\d{6}"],0,0,0,0,0,["9(?:(?:39[5-7]|76[018])\\d|475[0-6])\\d{4}"]]],MG:["261","00","[23]\\d{8}",[9],[["(\\d{2})(\\d{2})(\\d{3})(\\d{2})","$1 $2 $3 $4",["[23]"],"0$1"]],"0",0,"([24-9]\\d{6})$|0","20$1"],MH:["692","011","329\\d{4}|(?:[256]\\d|45)\\d{5}",[7],[["(\\d{3})(\\d{4})","$1-$2",["[2-6]"]]],"1"],MK:["389","00","[2-578]\\d{7}",[8],[["(\\d)(\\d{3})(\\d{4})","$1 $2 $3",["2|34[47]|4(?:[37]7|5[47]|64)"],"0$1"],["(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3",["[347]"],"0$1"],["(\\d{3})(\\d)(\\d{2})(\\d{2})","$1 $2 $3 $4",["[58]"],"0$1"]],"0"],ML:["223","00","[24-9]\\d{7}",[8],[["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[24-9]"]]]],MM:["95","00","1\\d{5,7}|95\\d{6}|(?:[4-7]|9[0-46-9])\\d{6,8}|(?:2|8\\d)\\d{5,8}",[6,7,8,9,10],[["(\\d)(\\d{2})(\\d{3})","$1 $2 $3",["16|2"],"0$1"],["(\\d{2})(\\d{2})(\\d{3})","$1 $2 $3",["4(?:[2-46]|5[3-5])|5|6(?:[1-689]|7[235-7])|7(?:[0-4]|5[2-7])|8[1-5]|(?:60|86)[23]"],"0$1"],["(\\d)(\\d{3})(\\d{3,4})","$1 $2 $3",["[12]|452|678|86","[12]|452|6788|86"],"0$1"],["(\\d{2})(\\d{3})(\\d{3,4})","$1 $2 $3",["[4-7]|8[1-35]"],"0$1"],["(\\d)(\\d{3})(\\d{4,6})","$1 $2 $3",["9(?:2[0-4]|[35-9]|4[137-9])"],"0$1"],["(\\d)(\\d{4})(\\d{4})","$1 $2 $3",["2"],"0$1"],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["8"],"0$1"],["(\\d)(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3 $4",["92"],"0$1"],["(\\d)(\\d{5})(\\d{4})","$1 $2 $3",["9"],"0$1"]],"0"],MN:["976","001","[12]\\d{7,9}|[5-9]\\d{7}",[8,9,10],[["(\\d{2})(\\d{2})(\\d{4})","$1 $2 $3",["[12]1"],"0$1"],["(\\d{4})(\\d{4})","$1 $2",["[5-9]"]],["(\\d{3})(\\d{5,6})","$1 $2",["[12]2[1-3]"],"0$1"],["(\\d{4})(\\d{5,6})","$1 $2",["[12](?:27|3[2-8]|4[2-68]|5[1-4689])","[12](?:27|3[2-8]|4[2-68]|5[1-4689])[0-3]"],"0$1"],["(\\d{5})(\\d{4,5})","$1 $2",["[12]"],"0$1"]],"0"],MO:["853","00","0800\\d{3}|(?:28|[68]\\d)\\d{6}",[7,8],[["(\\d{4})(\\d{3})","$1 $2",["0"]],["(\\d{4})(\\d{4})","$1 $2",["[268]"]]]],MP:["1","011","[58]\\d{9}|(?:67|90)0\\d{7}",[10],0,"1",0,"([2-9]\\d{6})$|1","670$1",0,"670"],MQ:["596","00","(?:596\\d|7091)\\d{5}|(?:69|[89]\\d)\\d{7}",[9],[["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[5-79]|8(?:0[6-9]|[36])"],"0$1"],["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["8"],"0$1"]],"0"],MR:["222","00","(?:[2-4]\\d\\d|800)\\d{5}",[8],[["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[2-48]"]]]],MS:["1","011","(?:[58]\\d\\d|664|900)\\d{7}",[10],0,"1",0,"([34]\\d{6})$|1","664$1",0,"664"],MT:["356","00","3550\\d{4}|(?:[2579]\\d\\d|800)\\d{5}",[8],[["(\\d{4})(\\d{4})","$1 $2",["[2357-9]"]]]],MU:["230","0(?:0|[24-7]0|3[03])","(?:[57]|8\\d\\d)\\d{7}|[2-468]\\d{6}",[7,8,10],[["(\\d{3})(\\d{4})","$1 $2",["[2-46]|8[013]"]],["(\\d{4})(\\d{4})","$1 $2",["[57]"]],["(\\d{5})(\\d{5})","$1 $2",["8"]]],0,0,0,0,0,0,0,"020"],MV:["960","0(?:0|19)","(?:800|9[0-57-9]\\d)\\d{7}|[34679]\\d{6}",[7,10],[["(\\d{3})(\\d{4})","$1-$2",["[34679]"]],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["[89]"]]],0,0,0,0,0,0,0,"00"],MW:["265","00","(?:[1289]\\d|31|77)\\d{7}|1\\d{6}",[7,9],[["(\\d)(\\d{3})(\\d{3})","$1 $2 $3",["1[2-9]"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["2"],"0$1"],["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[137-9]"],"0$1"]],"0"],MX:["52","0[09]","[2-9]\\d{9}",[10],[["(\\d{2})(\\d{4})(\\d{4})","$1 $2 $3",["33|5[56]|81"]],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["[2-9]"]]],0,0,0,0,0,0,0,"00"],MY:["60","00","1\\d{8,9}|(?:3\\d|[4-9])\\d{7}",[8,9,10],[["(\\d)(\\d{3})(\\d{4})","$1-$2 $3",["[4-79]"],"0$1"],["(\\d{2})(\\d{3})(\\d{3,4})","$1-$2 $3",["1(?:[02469]|[378][1-9]|53)|8","1(?:[02469]|[37][1-9]|53|8(?:[1-46-9]|5[7-9]))|8"],"0$1"],["(\\d)(\\d{4})(\\d{4})","$1-$2 $3",["3"],"0$1"],["(\\d)(\\d{3})(\\d{2})(\\d{4})","$1-$2-$3-$4",["1(?:[367]|80)"]],["(\\d{3})(\\d{3})(\\d{4})","$1-$2 $3",["15"],"0$1"],["(\\d{2})(\\d{4})(\\d{4})","$1-$2 $3",["1"],"0$1"]],"0"],MZ:["258","00","(?:2|8\\d)\\d{7}",[8,9],[["(\\d{2})(\\d{3})(\\d{3,4})","$1 $2 $3",["2|8[2-79]"]],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["8"]]]],NA:["264","00","[68]\\d{7,8}",[8,9],[["(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3",["88"],"0$1"],["(\\d{2})(\\d{3})(\\d{3,4})","$1 $2 $3",["6"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["87"],"0$1"],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["8"],"0$1"]],"0"],NC:["687","00","(?:050|[2-57-9]\\d\\d)\\d{3}",[6],[["(\\d{2})(\\d{2})(\\d{2})","$1.$2.$3",["[02-57-9]"]]]],NE:["227","00","[027-9]\\d{7}",[8],[["(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3",["08"]],["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[089]|2[013]|7[0467]"]]]],NF:["672","00","[13]\\d{5}",[6],[["(\\d{2})(\\d{4})","$1 $2",["1[0-3]"]],["(\\d)(\\d{5})","$1 $2",["[13]"]]],0,0,"([0-258]\\d{4})$","3$1"],NG:["234","009","(?:20|9\\d)\\d{8}|[78]\\d{9,13}",[10,11,12,13,14],[["(\\d{3})(\\d{3})(\\d{3,4})","$1 $2 $3",["[7-9]"],"0$1"],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["20[129]"],"0$1"],["(\\d{4})(\\d{2})(\\d{4})","$1 $2 $3",["2"],"0$1"],["(\\d{3})(\\d{4})(\\d{4,5})","$1 $2 $3",["[78]"],"0$1"],["(\\d{3})(\\d{5})(\\d{5,6})","$1 $2 $3",["[78]"],"0$1"]],"0"],NI:["505","00","(?:1800|[25-8]\\d{3})\\d{4}",[8],[["(\\d{4})(\\d{4})","$1 $2",["[125-8]"]]]],NL:["31","00","(?:[124-7]\\d\\d|3(?:[02-9]\\d|1[0-8]))\\d{6}|8\\d{6,9}|9\\d{6,10}|1\\d{4,5}",[5,6,7,8,9,10,11],[["(\\d{3})(\\d{4,7})","$1 $2",["[89]0"],"0$1"],["(\\d{2})(\\d{7})","$1 $2",["66"],"0$1"],["(\\d)(\\d{8})","$1 $2",["6"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["1[16-8]|2[259]|3[124]|4[17-9]|5[124679]"],"0$1"],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["[1-578]|91"],"0$1"],["(\\d{3})(\\d{3})(\\d{5})","$1 $2 $3",["9"],"0$1"]],"0"],NO:["47","00","(?:0|[2-9]\\d{3})\\d{4}",[5,8],[["(\\d{3})(\\d{2})(\\d{3})","$1 $2 $3",["8"]],["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[2-79]"]]],0,0,0,0,0,"[02-689]|7[0-8]"],NP:["977","00","(?:1\\d|9)\\d{9}|[1-9]\\d{7}",[8,10,11],[["(\\d)(\\d{7})","$1-$2",["1[2-6]"],"0$1"],["(\\d{2})(\\d{6})","$1-$2",["1[01]|[2-8]|9(?:[1-59]|[67][2-6])"],"0$1"],["(\\d{3})(\\d{7})","$1-$2",["9"]]],"0"],NR:["674","00","(?:222|444|(?:55|8\\d)\\d|666|777|999)\\d{4}",[7],[["(\\d{3})(\\d{4})","$1 $2",["[24-9]"]]]],NU:["683","00","(?:[4-7]|888\\d)\\d{3}",[4,7],[["(\\d{3})(\\d{4})","$1 $2",["8"]]]],NZ:["64","0(?:0|161)","[1289]\\d{9}|50\\d{5}(?:\\d{2,3})?|[27-9]\\d{7,8}|(?:[34]\\d|6[0-35-9])\\d{6}|8\\d{4,6}",[5,6,7,8,9,10],[["(\\d{2})(\\d{3,8})","$1 $2",["8[1-79]"],"0$1"],["(\\d{3})(\\d{2})(\\d{2,3})","$1 $2 $3",["50[036-8]|8|90","50(?:[0367]|88)|8|90"],"0$1"],["(\\d)(\\d{3})(\\d{4})","$1 $2 $3",["24|[346]|7[2-57-9]|9[2-9]"],"0$1"],["(\\d{3})(\\d{3})(\\d{3,4})","$1 $2 $3",["2(?:10|74)|[589]"],"0$1"],["(\\d{2})(\\d{3,4})(\\d{4})","$1 $2 $3",["1|2[028]"],"0$1"],["(\\d{2})(\\d{3})(\\d{3,5})","$1 $2 $3",["2(?:[169]|7[0-35-9])|7"],"0$1"]],"0",0,0,0,0,0,0,"00"],OM:["968","00","(?:1505|[279]\\d{3}|500)\\d{4}|800\\d{5,6}",[7,8,9],[["(\\d{3})(\\d{4,6})","$1 $2",["[58]"]],["(\\d{2})(\\d{6})","$1 $2",["2"]],["(\\d{4})(\\d{4})","$1 $2",["[179]"]]]],PA:["507","00","(?:00800|8\\d{3})\\d{6}|[68]\\d{7}|[1-57-9]\\d{6}",[7,8,10,11],[["(\\d{3})(\\d{4})","$1-$2",["[1-57-9]"]],["(\\d{4})(\\d{4})","$1-$2",["[68]"]],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["8"]]]],PE:["51","00|19(?:1[124]|77|90)00","(?:[14-8]|9\\d)\\d{7}",[8,9],[["(\\d{3})(\\d{5})","$1 $2",["80"],"(0$1)"],["(\\d)(\\d{7})","$1 $2",["1"],"(0$1)"],["(\\d{2})(\\d{6})","$1 $2",["[4-8]"],"(0$1)"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["9"]]],"0",0,0,0,0,0,0,"00"," Anexo "],PF:["689","00","4\\d{5}(?:\\d{2})?|8\\d{7,8}",[6,8,9],[["(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3",["44"]],["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["4|8[7-9]"]],["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["8"]]]],PG:["675","00|140[1-3]","(?:180|[78]\\d{3})\\d{4}|(?:[2-589]\\d|64)\\d{5}",[7,8],[["(\\d{3})(\\d{4})","$1 $2",["18|[2-69]|85"]],["(\\d{4})(\\d{4})","$1 $2",["[78]"]]],0,0,0,0,0,0,0,"00"],PH:["63","00","(?:[2-7]|9\\d)\\d{8}|2\\d{5}|(?:1800|8)\\d{7,9}",[6,8,9,10,11,12,13],[["(\\d)(\\d{5})","$1 $2",["2"],"(0$1)"],["(\\d{4})(\\d{4,6})","$1 $2",["3(?:23|39|46)|4(?:2[3-6]|[35]9|4[26]|76)|544|88[245]|(?:52|64|86)2","3(?:230|397|461)|4(?:2(?:35|[46]4|51)|396|4(?:22|63)|59[347]|76[15])|5(?:221|446)|642[23]|8(?:622|8(?:[24]2|5[13]))"],"(0$1)"],["(\\d{5})(\\d{4})","$1 $2",["346|4(?:27|9[35])|883","3469|4(?:279|9(?:30|56))|8834"],"(0$1)"],["(\\d)(\\d{4})(\\d{4})","$1 $2 $3",["2"],"(0$1)"],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["[3-7]|8[2-8]"],"(0$1)"],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["[89]"],"0$1"],["(\\d{4})(\\d{3})(\\d{4})","$1 $2 $3",["1"]],["(\\d{4})(\\d{1,2})(\\d{3})(\\d{4})","$1 $2 $3 $4",["1"]]],"0"],PK:["92","00","122\\d{6}|[24-8]\\d{10,11}|9(?:[013-9]\\d{8,10}|2(?:[01]\\d\\d|2(?:[06-8]\\d|1[01]))\\d{7})|(?:[2-8]\\d{3}|92(?:[0-7]\\d|8[1-9]))\\d{6}|[24-9]\\d{8}|[89]\\d{7}",[8,9,10,11,12],[["(\\d{3})(\\d{3})(\\d{2,7})","$1 $2 $3",["[89]0"],"0$1"],["(\\d{4})(\\d{5})","$1 $2",["1"]],["(\\d{3})(\\d{6,7})","$1 $2",["2(?:3[2358]|4[2-4]|9[2-8])|45[3479]|54[2-467]|60[468]|72[236]|8(?:2[2-689]|3[23578]|4[3478]|5[2356])|9(?:2[2-8]|3[27-9]|4[2-6]|6[3569]|9[25-8])","9(?:2[3-8]|98)|(?:2(?:3[2358]|4[2-4]|9[2-8])|45[3479]|54[2-467]|60[468]|72[236]|8(?:2[2-689]|3[23578]|4[3478]|5[2356])|9(?:22|3[27-9]|4[2-6]|6[3569]|9[25-7]))[2-9]"],"(0$1)"],["(\\d{2})(\\d{7,8})","$1 $2",["(?:2[125]|4[0-246-9]|5[1-35-7]|6[1-8]|7[14]|8[16]|91)[2-9]"],"(0$1)"],["(\\d{5})(\\d{5})","$1 $2",["58"],"(0$1)"],["(\\d{3})(\\d{7})","$1 $2",["3"],"0$1"],["(\\d{2})(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3 $4",["2[125]|4[0-246-9]|5[1-35-7]|6[1-8]|7[14]|8[16]|91"],"(0$1)"],["(\\d{3})(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3 $4",["[24-9]"],"(0$1)"]],"0"],PL:["48","00","(?:6|8\\d\\d)\\d{7}|[1-9]\\d{6}(?:\\d{2})?|[26]\\d{5}",[6,7,8,9,10],[["(\\d{5})","$1",["19"]],["(\\d{3})(\\d{3})","$1 $2",["11|20|64"]],["(\\d{2})(\\d{2})(\\d{3})","$1 $2 $3",["(?:1[2-8]|2[2-69]|3[2-4]|4[1-468]|5[24-689]|6[1-3578]|7[14-7]|8[1-79]|9[145])1","(?:1[2-8]|2[2-69]|3[2-4]|4[1-468]|5[24-689]|6[1-3578]|7[14-7]|8[1-79]|9[145])19"]],["(\\d{3})(\\d{2})(\\d{2,3})","$1 $2 $3",["64"]],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["21|39|45|5[0137]|6[0469]|7[02389]|8(?:0[14]|8)"]],["(\\d{2})(\\d{3})(\\d{2})(\\d{2})","$1 $2 $3 $4",["1[2-8]|[2-7]|8[1-79]|9[145]"]],["(\\d{3})(\\d{3})(\\d{3,4})","$1 $2 $3",["8"]]]],PM:["508","00","[45]\\d{5}|(?:708|8\\d\\d)\\d{6}",[6,9],[["(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3",["[45]"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["7"]],["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["8"],"0$1"]],"0"],PR:["1","011","(?:[589]\\d\\d|787)\\d{7}",[10],0,"1",0,0,0,0,"787|939"],PS:["970","00","[2489]2\\d{6}|(?:1\\d|5)\\d{8}",[8,9,10],[["(\\d)(\\d{3})(\\d{4})","$1 $2 $3",["[2489]"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["5"],"0$1"],["(\\d{4})(\\d{3})(\\d{3})","$1 $2 $3",["1"]]],"0"],PT:["351","00","1693\\d{5}|(?:[26-9]\\d|30)\\d{7}",[9],[["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["2[12]"]],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["16|[236-9]"]]]],PW:["680","01[12]","(?:[24-8]\\d\\d|345|900)\\d{4}",[7],[["(\\d{3})(\\d{4})","$1 $2",["[2-9]"]]]],PY:["595","00","59\\d{4,6}|9\\d{5,10}|(?:[2-46-8]\\d|5[0-8])\\d{4,7}",[6,7,8,9,10,11],[["(\\d{3})(\\d{3,6})","$1 $2",["[2-9]0"],"0$1"],["(\\d{2})(\\d{5})","$1 $2",["[26]1|3[289]|4[1246-8]|7[1-3]|8[1-36]"],"(0$1)"],["(\\d{3})(\\d{4,5})","$1 $2",["2[279]|3[13-5]|4[359]|5|6(?:[34]|7[1-46-8])|7[46-8]|85"],"(0$1)"],["(\\d{2})(\\d{3})(\\d{3,4})","$1 $2 $3",["2[14-68]|3[26-9]|4[1246-8]|6(?:1|75)|7[1-35]|8[1-36]"],"(0$1)"],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["87"]],["(\\d{3})(\\d{6})","$1 $2",["9(?:[5-79]|8[1-7])"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[2-8]"],"0$1"],["(\\d{4})(\\d{3})(\\d{4})","$1 $2 $3",["9"]]],"0"],QA:["974","00","800\\d{4}|(?:2|800)\\d{6}|(?:0080|[3-7])\\d{7}",[7,8,9,11],[["(\\d{3})(\\d{4})","$1 $2",["2[136]|8"]],["(\\d{4})(\\d{4})","$1 $2",["[3-7]"]]]],RE:["262","00","709\\d{6}|(?:26|[689]\\d)\\d{7}",[9],[["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[26-9]"],"0$1"]],"0",0,0,0,0,0,[["26(?:2\\d\\d|3(?:0\\d|1[0-6]))\\d{4}"],["(?:69(?:2\\d\\d|3(?:[06][0-6]|1[0-3]|2[0-2]|3[0-39]|4\\d|5[0-5]|7[0-37]|8[0-8]|9[0-479]))|7092[0-3])\\d{4}"],["80\\d{7}"],["89[1-37-9]\\d{6}"],0,0,0,0,["9(?:399[0-3]|479[0-6]|76(?:2[278]|3[0-37]))\\d{4}"],["8(?:1[019]|2[0156]|84|90)\\d{6}"]]],RO:["40","00","(?:[236-8]\\d|90)\\d{7}|[23]\\d{5}",[6,9],[["(\\d{3})(\\d{3})","$1 $2",["2[3-6]","2[3-6]\\d9"],"0$1"],["(\\d{2})(\\d{4})","$1 $2",["219|31"],"0$1"],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["[23]1"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[236-9]"],"0$1"]],"0",0,0,0,0,0,0,0," int "],RS:["381","00","38[02-9]\\d{6,9}|6\\d{7,9}|90\\d{4,8}|38\\d{5,6}|(?:7\\d\\d|800)\\d{3,9}|(?:[12]\\d|3[0-79])\\d{5,10}",[6,7,8,9,10,11,12],[["(\\d{3})(\\d{3,9})","$1 $2",["(?:2[389]|39)0|[7-9]"],"0$1"],["(\\d{2})(\\d{5,10})","$1 $2",["[1-36]"],"0$1"]],"0"],RU:["7","810","8\\d{13}|[347-9]\\d{9}",[10,14],[["(\\d{4})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["7(?:1[0-8]|2[1-9])","7(?:1(?:[0-356]2|4[29]|7|8[27])|2(?:1[23]|[2-9]2))","7(?:1(?:[0-356]2|4[29]|7|8[27])|2(?:13[03-69]|62[013-9]))|72[1-57-9]2"],"8 ($1)",1],["(\\d{5})(\\d)(\\d{2})(\\d{2})","$1 $2 $3 $4",["7(?:1[0-68]|2[1-9])","7(?:1(?:[06][3-6]|[18]|2[35]|[3-5][3-5])|2(?:[13][3-5]|[24-689]|7[457]))","7(?:1(?:0(?:[356]|4[023])|[18]|2(?:3[013-9]|5)|3[45]|43[013-79]|5(?:3[1-8]|4[1-7]|5)|6(?:3[0-35-9]|[4-6]))|2(?:1(?:3[178]|[45])|[24-689]|3[35]|7[457]))|7(?:14|23)4[0-8]|71(?:33|45)[1-79]"],"8 ($1)",1],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["7"],"8 ($1)",1],["(\\d{3})(\\d{3})(\\d{2})(\\d{2})","$1 $2-$3-$4",["[349]|8(?:[02-7]|1[1-8])"],"8 ($1)",1],["(\\d{4})(\\d{4})(\\d{3})(\\d{3})","$1 $2 $3 $4",["8"],"8 ($1)"]],"8",0,0,0,0,0,[["336(?:[013-9]\\d|2[013-9])\\d{5}|(?:3(?:0[12]|4[1-35-79]|5[1-3]|65|8[1-58]|9[0145])|4(?:01|1[1356]|2[13467]|7[1-5]|8[1-7]|9[1-689])|8(?:1[1-8]|2[01]|3[13-6]|4[0-8]|5[15-7]|6[0-35-79]|7[1-37-9]))\\d{7}",[10]],["9\\d{9}",[10]],["8(?:0[04]|108\\d{3})\\d{7}"],["80[39]\\d{7}",[10]],["808\\d{7}",[10]]],"8~10"],RW:["250","00","(?:06|[27]\\d\\d|[89]00)\\d{6}",[8,9],[["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["0"]],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["2"]],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[7-9]"],"0$1"]],"0"],SA:["966","00","(?:[15]\\d|800|92)\\d{7}",[9,10],[["(\\d{4})(\\d{5})","$1 $2",["9"]],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["1"],"0$1"],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["5"],"0$1"],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["8"]]],"0"],SB:["677","0[01]","[6-9]\\d{6}|[1-6]\\d{4}",[5,7],[["(\\d{2})(\\d{5})","$1 $2",["6[89]|7|8[4-9]|9(?:[1-8]|9[0-8])"]]]],SC:["248","010|0[0-2]","(?:[2489]\\d|64)\\d{5}",[7],[["(\\d)(\\d{3})(\\d{3})","$1 $2 $3",["[246]|9[57]"]]],0,0,0,0,0,0,0,"00"],SD:["249","00","[19]\\d{8}",[9],[["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["[19]"],"0$1"]],"0"],SE:["46","00","(?:[26]\\d\\d|9)\\d{9}|[1-9]\\d{8}|[1-689]\\d{7}|[1-4689]\\d{6}|2\\d{5}",[6,7,8,9,10,12],[["(\\d{2})(\\d{2,3})(\\d{2})","$1-$2 $3",["20"],"0$1",0,"$1 $2 $3"],["(\\d{3})(\\d{4})","$1-$2",["9(?:00|39|44|9)"],"0$1",0,"$1 $2"],["(\\d{2})(\\d{3})(\\d{2})","$1-$2 $3",["[12][136]|3[356]|4[0246]|6[03]|90[1-9]"],"0$1",0,"$1 $2 $3"],["(\\d)(\\d{2,3})(\\d{2})(\\d{2})","$1-$2 $3 $4",["8"],"0$1",0,"$1 $2 $3 $4"],["(\\d{3})(\\d{2,3})(\\d{2})","$1-$2 $3",["1[2457]|2(?:[247-9]|5[0138])|3[0247-9]|4[1357-9]|5[0-35-9]|6(?:[125689]|4[02-57]|7[0-2])|9(?:[125-8]|3[02-5]|4[0-3])"],"0$1",0,"$1 $2 $3"],["(\\d{3})(\\d{2,3})(\\d{3})","$1-$2 $3",["9(?:00|39|44)"],"0$1",0,"$1 $2 $3"],["(\\d{2})(\\d{2,3})(\\d{2})(\\d{2})","$1-$2 $3 $4",["1[13689]|2[0136]|3[1356]|4[0246]|54|6[03]|90[1-9]"],"0$1",0,"$1 $2 $3 $4"],["(\\d{2})(\\d{3})(\\d{2})(\\d{2})","$1-$2 $3 $4",["10|7"],"0$1",0,"$1 $2 $3 $4"],["(\\d)(\\d{3})(\\d{3})(\\d{2})","$1-$2 $3 $4",["8"],"0$1",0,"$1 $2 $3 $4"],["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1-$2 $3 $4",["[13-5]|2(?:[247-9]|5[0138])|6(?:[124-689]|7[0-2])|9(?:[125-8]|3[02-5]|4[0-3])"],"0$1",0,"$1 $2 $3 $4"],["(\\d{3})(\\d{2})(\\d{2})(\\d{3})","$1-$2 $3 $4",["9"],"0$1",0,"$1 $2 $3 $4"],["(\\d{3})(\\d{2})(\\d{3})(\\d{2})(\\d{2})","$1-$2 $3 $4 $5",["[26]"],"0$1",0,"$1 $2 $3 $4 $5"]],"0"],SG:["65","0[0-3]\\d","(?:(?:1\\d|8)\\d\\d|7000)\\d{7}|[3689]\\d{7}",[8,10,11],[["(\\d{4})(\\d{4})","$1 $2",["[369]|8(?:0[1-9]|[1-9])"]],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["8"]],["(\\d{4})(\\d{4})(\\d{3})","$1 $2 $3",["7"]],["(\\d{4})(\\d{3})(\\d{4})","$1 $2 $3",["1"]]]],SH:["290","00","(?:[256]\\d|8)\\d{3}",[4,5],0,0,0,0,0,0,"[256]"],SI:["386","00|10(?:22|66|88|99)","[1-7]\\d{7}|8\\d{4,7}|90\\d{4,6}",[5,6,7,8],[["(\\d{2})(\\d{3,6})","$1 $2",["8[09]|9"],"0$1"],["(\\d{3})(\\d{5})","$1 $2",["59|8"],"0$1"],["(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3",["[37][01]|4[0139]|51|6"],"0$1"],["(\\d)(\\d{3})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[1-57]"],"(0$1)"]],"0",0,0,0,0,0,0,"00"],SJ:["47","00","0\\d{4}|(?:[489]\\d|79)\\d{6}",[5,8],0,0,0,0,0,0,"79"],SK:["421","00","[2-689]\\d{8}|[2-59]\\d{6}|[2-5]\\d{5}",[6,7,9],[["(\\d)(\\d{2})(\\d{3,4})","$1 $2 $3",["21"],"0$1"],["(\\d{2})(\\d{2})(\\d{2,3})","$1 $2 $3",["[3-5][1-8]1","[3-5][1-8]1[67]"],"0$1"],["(\\d)(\\d{3})(\\d{3})(\\d{2})","$1/$2 $3 $4",["2"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[689]"],"0$1"],["(\\d{2})(\\d{3})(\\d{2})(\\d{2})","$1/$2 $3 $4",["[3-5]"],"0$1"]],"0"],SL:["232","00","(?:[237-9]\\d|66)\\d{6}",[8],[["(\\d{2})(\\d{6})","$1 $2",["[236-9]"],"(0$1)"]],"0"],SM:["378","00","(?:0549|[5-7]\\d)\\d{6}",[8,10],[["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[5-7]"]],["(\\d{4})(\\d{6})","$1 $2",["0"]]],0,0,"([89]\\d{5})$","0549$1"],SN:["221","00","(?:[378]\\d|93)\\d{7}",[9],[["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["8"]],["(\\d{2})(\\d{3})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[379]"]]]],SO:["252","00","[346-9]\\d{8}|[12679]\\d{7}|[1-5]\\d{6}|[1348]\\d{5}",[6,7,8,9],[["(\\d{2})(\\d{4})","$1 $2",["8[125]"]],["(\\d{6})","$1",["[134]"]],["(\\d)(\\d{6})","$1 $2",["[15]|2[0-79]|3[0-46-8]|4[0-7]"]],["(\\d)(\\d{7})","$1 $2",["(?:2|90)4|[67]"]],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[348]|64|79|90"]],["(\\d{2})(\\d{5,7})","$1 $2",["1|28|6[0-35-9]|7[67]|9[2-9]"]]],"0"],SR:["597","00","(?:[2-5]|[6-8]\\d|90)\\d{5}",[6,7],[["(\\d{2})(\\d{2})(\\d{2})","$1-$2-$3",["56"]],["(\\d{3})(\\d{3})","$1-$2",["[2-5]"]],["(\\d{3})(\\d{4})","$1-$2",["[6-9]"]]]],SS:["211","00","[19]\\d{8}",[9],[["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[19]"],"0$1"]],"0"],ST:["239","00","(?:22|9\\d)\\d{5}",[7],[["(\\d{3})(\\d{4})","$1 $2",["[29]"]]]],SV:["503","00","[25-7]\\d{7}|(?:80\\d|900)\\d{4}(?:\\d{4})?",[7,8,11],[["(\\d{3})(\\d{4})","$1 $2",["[89]"]],["(\\d{4})(\\d{4})","$1 $2",["[25-7]"]],["(\\d{3})(\\d{4})(\\d{4})","$1 $2 $3",["[89]"]]]],SX:["1","011","7215\\d{6}|(?:[58]\\d\\d|900)\\d{7}",[10],0,"1",0,"(5\\d{6})$|1","721$1",0,"721"],SY:["963","00","[1-359]\\d{8}|[1-5]\\d{7}",[8,9],[["(\\d{2})(\\d{3})(\\d{3,4})","$1 $2 $3",["[1-4]|5[1-3]"],"0$1",1],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[59]"],"0$1",1]],"0"],SZ:["268","00","0800\\d{4}|(?:[237]\\d|900)\\d{6}",[8,9],[["(\\d{4})(\\d{4})","$1 $2",["[0237]"]],["(\\d{5})(\\d{4})","$1 $2",["9"]]]],TA:["290","00","8\\d{3}",[4],0,0,0,0,0,0,"8"],TC:["1","011","(?:[58]\\d\\d|649|900)\\d{7}",[10],0,"1",0,"([2-479]\\d{6})$|1","649$1",0,"649"],TD:["235","00|16","(?:22|30|[689]\\d|77)\\d{6}",[8],[["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[236-9]"]]],0,0,0,0,0,0,0,"00"],TG:["228","00","[279]\\d{7}",[8],[["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[279]"]]]],TH:["66","00[1-9]","(?:001800|[2-57]|[689]\\d)\\d{7}|1\\d{7,9}",[8,9,10,13],[["(\\d)(\\d{3})(\\d{4})","$1 $2 $3",["2"],"0$1"],["(\\d{2})(\\d{3})(\\d{3,4})","$1 $2 $3",["[13-9]"],"0$1"],["(\\d{4})(\\d{3})(\\d{3})","$1 $2 $3",["1"]]],"0"],TJ:["992","810","(?:[0-57-9]\\d|66)\\d{7}",[9],[["(\\d{6})(\\d)(\\d{2})","$1 $2 $3",["331","3317"]],["(\\d{3})(\\d{2})(\\d{4})","$1 $2 $3",["44[02-479]|[34]7"]],["(\\d{4})(\\d)(\\d{4})","$1 $2 $3",["3(?:[1245]|3[12])"]],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["\\d"]]],0,0,0,0,0,0,0,"8~10"],TK:["690","00","[2-47]\\d{3,6}",[4,5,6,7]],TL:["670","00","7\\d{7}|(?:[2-47]\\d|[89]0)\\d{5}",[7,8],[["(\\d{3})(\\d{4})","$1 $2",["[2-489]|70"]],["(\\d{4})(\\d{4})","$1 $2",["7"]]]],TM:["993","810","(?:[1-6]\\d|71)\\d{6}",[8],[["(\\d{2})(\\d{2})(\\d{2})(\\d{2})","$1 $2-$3-$4",["12"],"(8 $1)"],["(\\d{3})(\\d)(\\d{2})(\\d{2})","$1 $2-$3-$4",["[1-5]"],"(8 $1)"],["(\\d{2})(\\d{6})","$1 $2",["[67]"],"8 $1"]],"8",0,0,0,0,0,0,"8~10"],TN:["216","00","[2-57-9]\\d{7}",[8],[["(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3",["[2-57-9]"]]]],TO:["676","00","(?:0800|(?:[5-8]\\d\\d|999)\\d)\\d{3}|[2-8]\\d{4}",[5,7],[["(\\d{2})(\\d{3})","$1-$2",["[2-4]|50|6[09]|7[0-24-69]|8[05]"]],["(\\d{4})(\\d{3})","$1 $2",["0"]],["(\\d{3})(\\d{4})","$1 $2",["[5-9]"]]]],TR:["90","00","4\\d{6}|8\\d{11,12}|(?:[2-58]\\d\\d|900)\\d{7}",[7,10,12,13],[["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["512|8[01589]|90"],"0$1",1],["(\\d{3})(\\d{3})(\\d{2})(\\d{2})","$1 $2 $3 $4",["5(?:[0-59]|61)","5(?:[0-59]|61[06])","5(?:[0-59]|61[06]1)"],"0$1",1],["(\\d{3})(\\d{3})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[24][1-8]|3[1-9]"],"(0$1)",1],["(\\d{3})(\\d{3})(\\d{6,7})","$1 $2 $3",["80"],"0$1",1]],"0"],TT:["1","011","(?:[58]\\d\\d|900)\\d{7}",[10],0,"1",0,"([2-46-8]\\d{6})$|1","868$1",0,"868"],TV:["688","00","(?:2|7\\d\\d|90)\\d{4}",[5,6,7],[["(\\d{2})(\\d{3})","$1 $2",["2"]],["(\\d{2})(\\d{4})","$1 $2",["90"]],["(\\d{2})(\\d{5})","$1 $2",["7"]]]],TW:["886","0(?:0[25-79]|19)","[2-689]\\d{8}|7\\d{9,10}|[2-8]\\d{7}|2\\d{6}",[7,8,9,10,11],[["(\\d{2})(\\d)(\\d{4})","$1 $2 $3",["202"],"0$1"],["(\\d{2})(\\d{3})(\\d{3,4})","$1 $2 $3",["[258]0"],"0$1"],["(\\d)(\\d{3,4})(\\d{4})","$1 $2 $3",["[23568]|4(?:0[02-48]|[1-47-9])|7[1-9]","[23568]|4(?:0[2-48]|[1-47-9])|(?:400|7)[1-9]"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[49]"],"0$1"],["(\\d{2})(\\d{4})(\\d{4,5})","$1 $2 $3",["7"],"0$1"]],"0",0,0,0,0,0,0,0,"#"],TZ:["255","00[056]","(?:[25-8]\\d|41|90)\\d{7}",[9],[["(\\d{3})(\\d{2})(\\d{4})","$1 $2 $3",["[89]"],"0$1"],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["[24]"],"0$1"],["(\\d{2})(\\d{7})","$1 $2",["5"]],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[67]"],"0$1"]],"0"],UA:["380","00","[89]\\d{9}|[3-9]\\d{8}",[9,10],[["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["6[12][29]|(?:3[1-8]|4[136-8]|5[12457]|6[49])2|(?:56|65)[24]","6[12][29]|(?:35|4[1378]|5[12457]|6[49])2|(?:56|65)[24]|(?:3[1-46-8]|46)2[013-9]"],"0$1"],["(\\d{4})(\\d{5})","$1 $2",["3[1-8]|4(?:[1367]|[45][6-9]|8[4-6])|5(?:[1-5]|6[0135689]|7[4-6])|6(?:[12][3-7]|[459])","3[1-8]|4(?:[1367]|[45][6-9]|8[4-6])|5(?:[1-5]|6(?:[015689]|3[02389])|7[4-6])|6(?:[12][3-7]|[459])"],"0$1"],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["[3-7]|89|9[1-9]"],"0$1"],["(\\d{3})(\\d{3})(\\d{3,4})","$1 $2 $3",["[89]"],"0$1"]],"0",0,0,0,0,0,0,"0~0"],UG:["256","00[057]","800\\d{6}|(?:[29]0|[347]\\d)\\d{7}",[9],[["(\\d{4})(\\d{5})","$1 $2",["202","2024"],"0$1"],["(\\d{3})(\\d{6})","$1 $2",["[27-9]|4(?:6[45]|[7-9])"],"0$1"],["(\\d{2})(\\d{7})","$1 $2",["[34]"],"0$1"]],"0"],US:["1","011","[2-9]\\d{9}|3\\d{6}",[10],[["(\\d{3})(\\d{4})","$1-$2",["310"],0,1],["(\\d{3})(\\d{3})(\\d{4})","($1) $2-$3",["[2-9]"],0,1,"$1-$2-$3"]],"1",0,0,0,0,0,[["3052(?:0[0-8]|[1-9]\\d)\\d{4}|(?:2742|305[3-9])\\d{6}|(?:472|983)[2-47-9]\\d{6}|(?:2(?:0[1-35-9]|1[02-9]|2[03-57-9]|3[1459]|4[08]|5[1-46]|6[0279]|7[0269]|8[13])|3(?:0[1-47-9]|1[02-9]|2[013-79]|3[0-24679]|4[167]|5[0-2]|6[01349]|8[056])|4(?:0[124-9]|1[02-579]|2[3-5]|3[0245]|4[023578]|58|6[349]|7[0589]|8[04])|5(?:0[1-57-9]|1[0235-8]|20|3[0149]|4[01]|5[179]|6[1-47]|7[0-5]|8[0256])|6(?:0[1-35-9]|1[024-9]|2[03689]|3[016]|4[0156]|5[01679]|6[0-279]|78|8[0-269])|7(?:0[1-46-8]|1[2-9]|2[04-8]|3[0-247]|4[0378]|5[47]|6[02359]|7[0-59]|8[156])|8(?:0[1-68]|1[02-8]|2[0168]|3[0-2589]|4[03578]|5[046-9]|6[02-5]|7[028])|9(?:0[1346-9]|1[02-9]|2[0589]|3[0146-8]|4[01357-9]|5[12469]|7[0-3589]|8[04-69]))[2-9]\\d{6}"],[""],["8(?:00|33|44|55|66|77|88)[2-9]\\d{6}"],["900[2-9]\\d{6}"],["52(?:3(?:[2-46-9][02-9]\\d|5(?:[02-46-9]\\d|5[0-46-9]))|4(?:[2-478][02-9]\\d|5(?:[034]\\d|2[024-9]|5[0-46-9])|6(?:0[1-9]|[2-9]\\d)|9(?:[05-9]\\d|2[0-5]|49)))\\d{4}|52[34][2-9]1[02-9]\\d{4}|5(?:00|2[125-9]|33|44|66|77|88)[2-9]\\d{6}"],0,0,0,["305209\\d{4}"]]],UY:["598","0(?:0|1[3-9]\\d)","0004\\d{2,9}|[1249]\\d{7}|2\\d{3,4}|(?:[49]\\d|80)\\d{5}",[4,5,6,7,8,9,10,11,12,13],[["(\\d{4,5})","$1",["21"]],["(\\d{3})(\\d{3,4})","$1 $2",["0"]],["(\\d{3})(\\d{4})","$1 $2",["[49]0|8"],"0$1"],["(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3",["9"],"0$1"],["(\\d{4})(\\d{4})","$1 $2",["[124]"]],["(\\d{3})(\\d{3})(\\d{2,4})","$1 $2 $3",["0"]],["(\\d{3})(\\d{3})(\\d{3})(\\d{2,4})","$1 $2 $3 $4",["0"]]],"0",0,0,0,0,0,0,"00"," int. "],UZ:["998","00","(?:20|33|[5-9]\\d)\\d{7}",[9],[["(\\d{2})(\\d{3})(\\d{2})(\\d{2})","$1 $2 $3 $4",["[235-9]"]]]],VA:["39","00","0\\d{5,10}|3[0-8]\\d{7,10}|55\\d{8}|8\\d{5}(?:\\d{2,4})?|(?:1\\d|39)\\d{7,8}",[6,7,8,9,10,11,12],0,0,0,0,0,0,"06698"],VC:["1","011","(?:[58]\\d\\d|784|900)\\d{7}",[10],0,"1",0,"([2-7]\\d{6})$|1","784$1",0,"784"],VE:["58","00","[68]00\\d{7}|(?:[24]\\d|[59]0)\\d{8}",[10],[["(\\d{3})(\\d{7})","$1-$2",["[24-689]"],"0$1"]],"0"],VG:["1","011","(?:284|[58]\\d\\d|900)\\d{7}",[10],0,"1",0,"([2-578]\\d{6})$|1","284$1",0,"284"],VI:["1","011","[58]\\d{9}|(?:34|90)0\\d{7}",[10],0,"1",0,"([2-9]\\d{6})$|1","340$1",0,"340"],VN:["84","00","[12]\\d{9}|[135-9]\\d{8}|[16]\\d{7}|[16-8]\\d{6}",[7,8,9,10],[["(\\d{2})(\\d{5})","$1 $2",["80"],"0$1",1],["(\\d{4})(\\d{4,6})","$1 $2",["1"],0,1],["(\\d{2})(\\d{3})(\\d{2})(\\d{2})","$1 $2 $3 $4",["6"],"0$1",1],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[357-9]"],"0$1",1],["(\\d{2})(\\d{4})(\\d{4})","$1 $2 $3",["2[48]"],"0$1",1],["(\\d{3})(\\d{4})(\\d{3})","$1 $2 $3",["2"],"0$1",1]],"0"],VU:["678","00","[57-9]\\d{6}|(?:[238]\\d|48)\\d{3}",[5,7],[["(\\d{3})(\\d{4})","$1 $2",["[57-9]"]]]],WF:["681","00","(?:40|72|8\\d{4})\\d{4}|[89]\\d{5}",[6,9],[["(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3",["[47-9]"]],["(\\d{3})(\\d{2})(\\d{2})(\\d{2})","$1 $2 $3 $4",["8"]]]],WS:["685","0","(?:[2-6]|8\\d{5})\\d{4}|[78]\\d{6}|[68]\\d{5}",[5,6,7,10],[["(\\d{5})","$1",["[2-5]|6[1-9]"]],["(\\d{3})(\\d{3,7})","$1 $2",["[68]"]],["(\\d{2})(\\d{5})","$1 $2",["7"]]]],XK:["383","00","2\\d{7,8}|3\\d{7,11}|(?:4\\d\\d|[89]00)\\d{5}",[8,9,10,11,12],[["(\\d{3})(\\d{5})","$1 $2",["[89]"],"0$1"],["(\\d{2})(\\d{3})(\\d{3})","$1 $2 $3",["[2-4]"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["2|39"],"0$1"],["(\\d{2})(\\d{7,10})","$1 $2",["3"],"0$1"]],"0"],YE:["967","00","(?:1|7\\d)\\d{7}|[1-7]\\d{6}",[7,8,9],[["(\\d)(\\d{3})(\\d{3,4})","$1 $2 $3",["[1-6]|7(?:[24-6]|8[0-7])"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["7"],"0$1"]],"0"],YT:["262","00","7093\\d{5}|(?:80|9\\d)\\d{7}|(?:26|63)9\\d{6}",[9],0,"0",0,0,0,0,0,[["269(?:0[0-467]|15|5[0-4]|6\\d|[78]0)\\d{4}"],["(?:639(?:0[0-79]|1[019]|[267]\\d|3[09]|40|5[05-9]|9[04-79])|7093[5-7])\\d{4}"],["80\\d{7}"],0,0,0,0,0,["9(?:(?:39|47)8[01]|769\\d)\\d{4}"]]],ZA:["27","00","[1-79]\\d{8}|8\\d{4,9}",[5,6,7,8,9,10],[["(\\d{2})(\\d{3,4})","$1 $2",["8[1-4]"],"0$1"],["(\\d{2})(\\d{3})(\\d{2,3})","$1 $2 $3",["8[1-4]"],"0$1"],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["860"],"0$1"],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["[1-9]"],"0$1"],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["8"],"0$1"]],"0"],ZM:["260","00","800\\d{6}|(?:21|[579]\\d|63)\\d{7}",[9],[["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[28]"],"0$1"],["(\\d{2})(\\d{7})","$1 $2",["[579]"],"0$1"]],"0"],ZW:["263","00","2(?:[0-57-9]\\d{6,8}|6[0-24-9]\\d{6,7})|[38]\\d{9}|[35-8]\\d{8}|[3-6]\\d{7}|[1-689]\\d{6}|[1-3569]\\d{5}|[1356]\\d{4}",[5,6,7,8,9,10],[["(\\d{3})(\\d{3,5})","$1 $2",["2(?:0[45]|2[278]|[49]8)|3(?:[09]8|17)|6(?:[29]8|37|75)|[23][78]|(?:33|5[15]|6[68])[78]"],"0$1"],["(\\d)(\\d{3})(\\d{2,4})","$1 $2 $3",["[49]"],"0$1"],["(\\d{3})(\\d{4})","$1 $2",["80"],"0$1"],["(\\d{2})(\\d{7})","$1 $2",["24|8[13-59]|(?:2[05-79]|39|5[45]|6[15-8])2","2(?:02[014]|4|[56]20|[79]2)|392|5(?:42|525)|6(?:[16-8]21|52[013])|8[13-59]"],"(0$1)"],["(\\d{2})(\\d{3})(\\d{4})","$1 $2 $3",["7"],"0$1"],["(\\d{3})(\\d{3})(\\d{3,4})","$1 $2 $3",["2(?:1[39]|2[0157]|[378]|[56][14])|3(?:12|29)","2(?:1[39]|2[0157]|[378]|[56][14])|3(?:123|29)"],"0$1"],["(\\d{4})(\\d{6})","$1 $2",["8"],"0$1"],["(\\d{2})(\\d{3,5})","$1 $2",["1|2(?:0[0-36-9]|12|29|[56])|3(?:1[0-689]|[24-6])|5(?:[0236-9]|1[2-4])|6(?:[013-59]|7[0-46-9])|(?:33|55|6[68])[0-69]|(?:29|3[09]|62)[0-79]"],"0$1"],["(\\d{2})(\\d{3})(\\d{3,4})","$1 $2 $3",["29[013-9]|39|54"],"0$1"],["(\\d{4})(\\d{3,5})","$1 $2",["(?:25|54)8","258|5483"],"0$1"]],"0"]},nonGeographic:{"800":["800",0,"(?:00|[1-9]\\d)\\d{6}",[8],[["(\\d{4})(\\d{4})","$1 $2",["\\d"]]],0,0,0,0,0,0,[0,0,["(?:00|[1-9]\\d)\\d{6}"]]],"808":["808",0,"[1-9]\\d{7}",[8],[["(\\d{4})(\\d{4})","$1 $2",["[1-9]"]]],0,0,0,0,0,0,[0,0,0,0,0,0,0,0,0,["[1-9]\\d{7}"]]],"870":["870",0,"7\\d{11}|[235-7]\\d{8}",[9,12],[["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["[235-7]"]]],0,0,0,0,0,0,[0,["(?:[356]|774[45])\\d{8}|7[6-8]\\d{7}"],0,0,0,0,0,0,["2\\d{8}",[9]]]],"878":["878",0,"10\\d{10}",[12],[["(\\d{2})(\\d{5})(\\d{5})","$1 $2 $3",["1"]]],0,0,0,0,0,0,[0,0,0,0,0,0,0,0,["10\\d{10}"]]],"881":["881",0,"6\\d{9}|[0-36-9]\\d{8}",[9,10],[["(\\d)(\\d{3})(\\d{5})","$1 $2 $3",["[0-37-9]"]],["(\\d)(\\d{3})(\\d{5,6})","$1 $2 $3",["6"]]],0,0,0,0,0,0,[0,["6\\d{9}|[0-36-9]\\d{8}"]]],"882":["882",0,"[13]\\d{6}(?:\\d{2,5})?|[19]\\d{7}|(?:[25]\\d\\d|4)\\d{7}(?:\\d{2})?",[7,8,9,10,11,12],[["(\\d{2})(\\d{5})","$1 $2",["16|342"]],["(\\d{2})(\\d{6})","$1 $2",["49"]],["(\\d{2})(\\d{2})(\\d{4})","$1 $2 $3",["1[36]|9"]],["(\\d{2})(\\d{4})(\\d{3})","$1 $2 $3",["3[23]"]],["(\\d{2})(\\d{3,4})(\\d{4})","$1 $2 $3",["16"]],["(\\d{2})(\\d{4})(\\d{4})","$1 $2 $3",["10|23|3(?:[15]|4[57])|4|51"]],["(\\d{3})(\\d{4})(\\d{4})","$1 $2 $3",["34"]],["(\\d{2})(\\d{4,5})(\\d{5})","$1 $2 $3",["[1-35]"]]],0,0,0,0,0,0,[0,["342\\d{4}|(?:337|49)\\d{6}|(?:3(?:2|47|7\\d{3})|50\\d{3})\\d{7}",[7,8,9,10,12]],0,0,0,["348[57]\\d{7}",[11]],0,0,["1(?:3(?:0[0347]|[13][0139]|2[035]|4[013568]|6[0459]|7[06]|8[15-8]|9[0689])\\d{4}|6\\d{5,10})|(?:345\\d|9[89])\\d{6}|(?:10|2(?:3|85\\d)|3(?:[15]|[69]\\d\\d)|4[15-8]|51)\\d{8}"]]],"883":["883",0,"(?:[1-4]\\d|51)\\d{6,10}",[8,9,10,11,12],[["(\\d{3})(\\d{3})(\\d{2,8})","$1 $2 $3",["[14]|2[24-689]|3[02-689]|51[24-9]"]],["(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3",["510"]],["(\\d{3})(\\d{3})(\\d{4})","$1 $2 $3",["21"]],["(\\d{4})(\\d{4})(\\d{4})","$1 $2 $3",["51[13]"]],["(\\d{3})(\\d{3})(\\d{3})(\\d{3})","$1 $2 $3 $4",["[235]"]]],0,0,0,0,0,0,[0,0,0,0,0,0,0,0,["(?:2(?:00\\d\\d|10)|(?:370[1-9]|51\\d0)\\d)\\d{7}|51(?:00\\d{5}|[24-9]0\\d{4,7})|(?:1[0-79]|2[24-689]|3[02-689]|4[0-4])0\\d{5,9}"]]],"888":["888",0,"\\d{11}",[11],[["(\\d{3})(\\d{3})(\\d{5})","$1 $2 $3"]],0,0,0,0,0,0,[0,0,0,0,0,0,["\\d{11}"]]],"979":["979",0,"[1359]\\d{8}",[9],[["(\\d)(\\d{4})(\\d{4})","$1 $2 $3",["[1359]"]]],0,0,0,0,0,0,[0,0,0,["[1359]\\d{8}"]]]}};function withMetadataArgument(func,_arguments){var args=Array.prototype.slice.call(_arguments);return args.push(metadata_min_json_default),func.apply(this,args)}function semver_compare_default(a12,b2){a12=a12.split("-"),b2=b2.split("-");var pa=a12[0].split("."),pb=b2[0].split(".");for(var i=0;i<3;i++){var na=Number(pa[i]),nb=Number(pb[i]);if(na>nb)return 1;if(nb>na)return-1;if(!isNaN(na)&&isNaN(nb))return 1;if(isNaN(na)&&!isNaN(nb))return-1}if(a12[1]&&b2[1])return a12[1]>b2[1]?1:a12[1]<b2[1]?-1:0;return!a12[1]&&b2[1]?1:a12[1]&&!b2[1]?-1:0}var objectConstructor={}.constructor;function isObject2(object){return object!==void 0&&object!==null&&object.constructor===objectConstructor}function _typeof(o){return _typeof=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o2){return typeof o2}:function(o2){return o2&&typeof Symbol=="function"&&o2.constructor===Symbol&&o2!==Symbol.prototype?"symbol":typeof o2},_typeof(o)}function _classCallCheck(a12,n2){if(!(a12 instanceof n2))throw TypeError("Cannot call a class as a function")}function _defineProperties(e,r2){for(var t2=0;t2<r2.length;t2++){var o=r2[t2];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey(o.key),o)}}function _createClass(e,r2,t2){return r2&&_defineProperties(e.prototype,r2),t2&&_defineProperties(e,t2),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(t2){var i=_toPrimitive(t2,"string");return _typeof(i)=="symbol"?i:i+""}function _toPrimitive(t2,r2){if(_typeof(t2)!="object"||!t2)return t2;var e=t2[Symbol.toPrimitive];if(e!==void 0){var i=e.call(t2,r2||"default");if(_typeof(i)!="object")return i;throw TypeError("@@toPrimitive must return a primitive value.")}return(r2==="string"?String:Number)(t2)}var V3="1.2.0",V4="1.7.35",DEFAULT_EXT_PREFIX=" ext. ",CALLING_CODE_REG_EXP=/^\d+$/,Metadata=function(){function Metadata2(metadata){_classCallCheck(this,Metadata2),validateMetadata(metadata),this.metadata=metadata,setVersion.call(this,metadata)}return _createClass(Metadata2,[{key:"getCountries",value:function(){return Object.keys(this.metadata.countries).filter(function(_2){return _2!=="001"})}},{key:"getCountryMetadata",value:function(countryCode){return this.metadata.countries[countryCode]}},{key:"nonGeographic",value:function(){if(this.v1||this.v2||this.v3)return;return this.metadata.nonGeographic||this.metadata.nonGeographical}},{key:"hasCountry",value:function(country){return this.getCountryMetadata(country)!==void 0}},{key:"hasCallingCode",value:function(callingCode){if(this.getCountryCodesForCallingCode(callingCode))return!0;if(this.nonGeographic()){if(this.nonGeographic()[callingCode])return!0}else{var countryCodes=this.countryCallingCodes()[callingCode];if(countryCodes&&countryCodes.length===1&&countryCodes[0]==="001")return!0}}},{key:"isNonGeographicCallingCode",value:function(callingCode){if(this.nonGeographic())return this.nonGeographic()[callingCode]?!0:!1;else return this.getCountryCodesForCallingCode(callingCode)?!1:!0}},{key:"country",value:function(countryCode){return this.selectNumberingPlan(countryCode)}},{key:"selectNumberingPlan",value:function(countryCode,callingCode){if(countryCode&&CALLING_CODE_REG_EXP.test(countryCode))callingCode=countryCode,countryCode=null;if(countryCode&&countryCode!=="001"){if(!this.hasCountry(countryCode))throw Error("Unknown country: ".concat(countryCode));this.numberingPlan=new NumberingPlan(this.getCountryMetadata(countryCode),this)}else if(callingCode){if(!this.hasCallingCode(callingCode))throw Error("Unknown calling code: ".concat(callingCode));this.numberingPlan=new NumberingPlan(this.getNumberingPlanMetadata(callingCode),this)}else this.numberingPlan=void 0;return this}},{key:"getCountryCodesForCallingCode",value:function(callingCode){var countryCodes=this.countryCallingCodes()[callingCode];if(countryCodes){if(countryCodes.length===1&&countryCodes[0].length===3)return;return countryCodes}}},{key:"getCountryCodeForCallingCode",value:function(callingCode){var countryCodes=this.getCountryCodesForCallingCode(callingCode);if(countryCodes)return countryCodes[0]}},{key:"getNumberingPlanMetadata",value:function(callingCode){var countryCode=this.getCountryCodeForCallingCode(callingCode);if(countryCode)return this.getCountryMetadata(countryCode);if(this.nonGeographic()){var metadata=this.nonGeographic()[callingCode];if(metadata)return metadata}else{var countryCodes=this.countryCallingCodes()[callingCode];if(countryCodes&&countryCodes.length===1&&countryCodes[0]==="001")return this.metadata.countries["001"]}}},{key:"countryCallingCode",value:function(){return this.numberingPlan.callingCode()}},{key:"IDDPrefix",value:function(){return this.numberingPlan.IDDPrefix()}},{key:"defaultIDDPrefix",value:function(){return this.numberingPlan.defaultIDDPrefix()}},{key:"nationalNumberPattern",value:function(){return this.numberingPlan.nationalNumberPattern()}},{key:"possibleLengths",value:function(){return this.numberingPlan.possibleLengths()}},{key:"formats",value:function(){return this.numberingPlan.formats()}},{key:"nationalPrefixForParsing",value:function(){return this.numberingPlan.nationalPrefixForParsing()}},{key:"nationalPrefixTransformRule",value:function(){return this.numberingPlan.nationalPrefixTransformRule()}},{key:"leadingDigits",value:function(){return this.numberingPlan.leadingDigits()}},{key:"hasTypes",value:function(){return this.numberingPlan.hasTypes()}},{key:"type",value:function(_type){return this.numberingPlan.type(_type)}},{key:"ext",value:function(){return this.numberingPlan.ext()}},{key:"countryCallingCodes",value:function(){if(this.v1)return this.metadata.country_phone_code_to_countries;return this.metadata.country_calling_codes}},{key:"chooseCountryByCountryCallingCode",value:function(callingCode){return this.selectNumberingPlan(callingCode)}},{key:"hasSelectedNumberingPlan",value:function(){return this.numberingPlan!==void 0}}])}();var NumberingPlan=function(){function NumberingPlan2(metadata,globalMetadataObject){_classCallCheck(this,NumberingPlan2),this.globalMetadataObject=globalMetadataObject,this.metadata=metadata,setVersion.call(this,globalMetadataObject.metadata)}return _createClass(NumberingPlan2,[{key:"callingCode",value:function(){return this.metadata[0]}},{key:"getDefaultCountryMetadataForRegion",value:function(){return this.globalMetadataObject.getNumberingPlanMetadata(this.callingCode())}},{key:"IDDPrefix",value:function(){if(this.v1||this.v2)return;return this.metadata[1]}},{key:"defaultIDDPrefix",value:function(){if(this.v1||this.v2)return;return this.metadata[12]}},{key:"nationalNumberPattern",value:function(){if(this.v1||this.v2)return this.metadata[1];return this.metadata[2]}},{key:"possibleLengths",value:function(){if(this.v1)return;return this.metadata[this.v2?2:3]}},{key:"_getFormats",value:function(metadata){return metadata[this.v1?2:this.v2?3:4]}},{key:"formats",value:function(){var _this=this,formats2=this._getFormats(this.metadata)||this._getFormats(this.getDefaultCountryMetadataForRegion())||[];return formats2.map(function(_2){return new Format2(_2,_this)})}},{key:"nationalPrefix",value:function(){return this.metadata[this.v1?3:this.v2?4:5]}},{key:"_getNationalPrefixFormattingRule",value:function(metadata){return metadata[this.v1?4:this.v2?5:6]}},{key:"nationalPrefixFormattingRule",value:function(){return this._getNationalPrefixFormattingRule(this.metadata)||this._getNationalPrefixFormattingRule(this.getDefaultCountryMetadataForRegion())}},{key:"_nationalPrefixForParsing",value:function(){return this.metadata[this.v1?5:this.v2?6:7]}},{key:"nationalPrefixForParsing",value:function(){return this._nationalPrefixForParsing()||this.nationalPrefix()}},{key:"nationalPrefixTransformRule",value:function(){return this.metadata[this.v1?6:this.v2?7:8]}},{key:"_getNationalPrefixIsOptionalWhenFormatting",value:function(){return!!this.metadata[this.v1?7:this.v2?8:9]}},{key:"nationalPrefixIsOptionalWhenFormattingInNationalFormat",value:function(){return this._getNationalPrefixIsOptionalWhenFormatting(this.metadata)||this._getNationalPrefixIsOptionalWhenFormatting(this.getDefaultCountryMetadataForRegion())}},{key:"leadingDigits",value:function(){return this.metadata[this.v1?8:this.v2?9:10]}},{key:"types",value:function(){return this.metadata[this.v1?9:this.v2?10:11]}},{key:"hasTypes",value:function(){if(this.types()&&this.types().length===0)return!1;return!!this.types()}},{key:"type",value:function(_type2){if(this.hasTypes()&&getType(this.types(),_type2))return new Type2(getType(this.types(),_type2),this)}},{key:"ext",value:function(){if(this.v1||this.v2)return DEFAULT_EXT_PREFIX;return this.metadata[13]||DEFAULT_EXT_PREFIX}}])}(),Format2=function(){function Format3(format,metadata){_classCallCheck(this,Format3),this._format=format,this.metadata=metadata}return _createClass(Format3,[{key:"pattern",value:function(){return this._format[0]}},{key:"format",value:function(){return this._format[1]}},{key:"leadingDigitsPatterns",value:function(){return this._format[2]||[]}},{key:"nationalPrefixFormattingRule",value:function(){return this._format[3]||this.metadata.nationalPrefixFormattingRule()}},{key:"nationalPrefixIsOptionalWhenFormattingInNationalFormat",value:function(){return!!this._format[4]||this.metadata.nationalPrefixIsOptionalWhenFormattingInNationalFormat()}},{key:"nationalPrefixIsMandatoryWhenFormattingInNationalFormat",value:function(){return this.usesNationalPrefix()&&!this.nationalPrefixIsOptionalWhenFormattingInNationalFormat()}},{key:"usesNationalPrefix",value:function(){return this.nationalPrefixFormattingRule()&&!FIRST_GROUP_ONLY_PREFIX_PATTERN.test(this.nationalPrefixFormattingRule())?!0:!1}},{key:"internationalFormat",value:function(){return this._format[5]||this.format()}}])}(),FIRST_GROUP_ONLY_PREFIX_PATTERN=/^\(?\$1\)?$/,Type2=function(){function Type3(type,metadata){_classCallCheck(this,Type3),this.type=type,this.metadata=metadata}return _createClass(Type3,[{key:"pattern",value:function(){if(this.metadata.v1)return this.type;return this.type[0]}},{key:"possibleLengths",value:function(){if(this.metadata.v1)return;return this.type[1]||this.metadata.possibleLengths()}}])}();function getType(types3,type){switch(type){case"FIXED_LINE":return types3[0];case"MOBILE":return types3[1];case"TOLL_FREE":return types3[2];case"PREMIUM_RATE":return types3[3];case"PERSONAL_NUMBER":return types3[4];case"VOICEMAIL":return types3[5];case"UAN":return types3[6];case"PAGER":return types3[7];case"VOIP":return types3[8];case"SHARED_COST":return types3[9]}}function validateMetadata(metadata){if(!metadata)throw Error("[libphonenumber-js] `metadata` argument not passed. Check your arguments.");if(!isObject2(metadata)||!isObject2(metadata.countries))throw Error("[libphonenumber-js] `metadata` argument was passed but it's not a valid metadata. Must be an object having `.countries` child object property. Got ".concat(isObject2(metadata)?"an object of shape: { "+Object.keys(metadata).join(", ")+" }":"a "+typeOf(metadata)+": "+metadata,"."))}var typeOf=function(_2){return _typeof(_2)};function getCountryCallingCode(country,metadata){if(metadata=new Metadata(metadata),metadata.hasCountry(country))return metadata.selectNumberingPlan(country).countryCallingCode();throw Error("Unknown country: ".concat(country))}function isSupportedCountry(country,metadata){return metadata.countries.hasOwnProperty(country)}function setVersion(metadata){var version2=metadata.version;if(typeof version2==="number")this.v1=version2===1,this.v2=version2===2,this.v3=version2===3,this.v4=version2===4;else if(!version2)this.v1=!0;else if(semver_compare_default(version2,V3)===-1)this.v2=!0;else if(semver_compare_default(version2,V4)===-1)this.v3=!0;else this.v4=!0}function _createForOfIteratorHelperLoose(r2,e){var t2=typeof Symbol<"u"&&r2[Symbol.iterator]||r2["@@iterator"];if(t2)return(t2=t2.call(r2)).next.bind(t2);if(Array.isArray(r2)||(t2=_unsupportedIterableToArray(r2))||e&&r2&&typeof r2.length=="number"){t2&&(r2=t2);var o=0;return function(){return o>=r2.length?{done:!0}:{done:!1,value:r2[o++]}}}throw TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray(r2,a12){if(r2){if(typeof r2=="string")return _arrayLikeToArray(r2,a12);var t2={}.toString.call(r2).slice(8,-1);return t2==="Object"&&r2.constructor&&(t2=r2.constructor.name),t2==="Map"||t2==="Set"?Array.from(r2):t2==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t2)?_arrayLikeToArray(r2,a12):void 0}}function _arrayLikeToArray(r2,a12){(a12==null||a12>r2.length)&&(a12=r2.length);for(var e=0,n2=Array(a12);e<a12;e++)n2[e]=r2[e];return n2}function mergeArrays2(a12,b2){var merged=a12.slice();for(var _iterator=_createForOfIteratorHelperLoose(b2),_step;!(_step=_iterator()).done;){var element=_step.value;if(a12.indexOf(element)<0)merged.push(element)}return merged.sort(function(a13,b3){return a13-b3})}function checkNumberLength(nationalNumber,country,metadata){return checkNumberLengthForType(nationalNumber,country,void 0,metadata)}function checkNumberLengthForType(nationalNumber,country,type,metadata){if(country)metadata=new Metadata(metadata.metadata),metadata.selectNumberingPlan(country);var type_info=metadata.type(type),possible_lengths=type_info&&type_info.possibleLengths()||metadata.possibleLengths();if(!possible_lengths)return"IS_POSSIBLE";if(type==="FIXED_LINE_OR_MOBILE"){if(!metadata.type("FIXED_LINE"))return checkNumberLengthForType(nationalNumber,country,"MOBILE",metadata);var mobile_type=metadata.type("MOBILE");if(mobile_type)possible_lengths=mergeArrays2(possible_lengths,mobile_type.possibleLengths())}else if(type&&!type_info)return"INVALID_LENGTH";var actual_length=nationalNumber.length,minimum_length=possible_lengths[0];if(minimum_length===actual_length)return"IS_POSSIBLE";if(minimum_length>actual_length)return"TOO_SHORT";if(possible_lengths[possible_lengths.length-1]<actual_length)return"TOO_LONG";return possible_lengths.indexOf(actual_length,1)>=0?"IS_POSSIBLE":"INVALID_LENGTH"}function isPossiblePhoneNumber(input,options,metadata){if(options===void 0)options={};if(metadata=new Metadata(metadata),options.v2){if(!input.countryCallingCode)throw Error("Invalid phone number object passed");metadata.selectNumberingPlan(input.countryCallingCode)}else{if(!input.phone)return!1;if(input.country){if(!metadata.hasCountry(input.country))throw Error("Unknown country: ".concat(input.country));metadata.selectNumberingPlan(input.country)}else{if(!input.countryCallingCode)throw Error("Invalid phone number object passed");metadata.selectNumberingPlan(input.countryCallingCode)}}if(metadata.possibleLengths())return isPossibleNumber(input.phone||input.nationalNumber,input.country,metadata);else if(input.countryCallingCode&&metadata.isNonGeographicCallingCode(input.countryCallingCode))return!0;else throw Error('Missing "possibleLengths" in metadata. Perhaps the metadata has been generated before v1.0.18.')}function isPossibleNumber(nationalNumber,country,metadata){switch(checkNumberLength(nationalNumber,country,metadata)){case"IS_POSSIBLE":return!0;default:return!1}}function matchesEntirely(text2,regularExpressionText){return text2=text2||"",new RegExp("^(?:"+regularExpressionText+")$").test(text2)}function _createForOfIteratorHelperLoose2(r2,e){var t2=typeof Symbol<"u"&&r2[Symbol.iterator]||r2["@@iterator"];if(t2)return(t2=t2.call(r2)).next.bind(t2);if(Array.isArray(r2)||(t2=_unsupportedIterableToArray2(r2))||e&&r2&&typeof r2.length=="number"){t2&&(r2=t2);var o=0;return function(){return o>=r2.length?{done:!0}:{done:!1,value:r2[o++]}}}throw TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray2(r2,a12){if(r2){if(typeof r2=="string")return _arrayLikeToArray2(r2,a12);var t2={}.toString.call(r2).slice(8,-1);return t2==="Object"&&r2.constructor&&(t2=r2.constructor.name),t2==="Map"||t2==="Set"?Array.from(r2):t2==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t2)?_arrayLikeToArray2(r2,a12):void 0}}function _arrayLikeToArray2(r2,a12){(a12==null||a12>r2.length)&&(a12=r2.length);for(var e=0,n2=Array(a12);e<a12;e++)n2[e]=r2[e];return n2}var NON_FIXED_LINE_PHONE_TYPES=["MOBILE","PREMIUM_RATE","TOLL_FREE","SHARED_COST","VOIP","PERSONAL_NUMBER","PAGER","UAN","VOICEMAIL"];function getNumberType(input,options,metadata){if(options=options||{},!input.country&&!input.countryCallingCode)return;metadata=new Metadata(metadata),metadata.selectNumberingPlan(input.country,input.countryCallingCode);var nationalNumber=options.v2?input.nationalNumber:input.phone;if(!matchesEntirely(nationalNumber,metadata.nationalNumberPattern()))return;if(isNumberTypeEqualTo(nationalNumber,"FIXED_LINE",metadata)){if(metadata.type("MOBILE")&&metadata.type("MOBILE").pattern()==="")return"FIXED_LINE_OR_MOBILE";if(!metadata.type("MOBILE"))return"FIXED_LINE_OR_MOBILE";if(isNumberTypeEqualTo(nationalNumber,"MOBILE",metadata))return"FIXED_LINE_OR_MOBILE";return"FIXED_LINE"}for(var _iterator=_createForOfIteratorHelperLoose2(NON_FIXED_LINE_PHONE_TYPES),_step;!(_step=_iterator()).done;){var type=_step.value;if(isNumberTypeEqualTo(nationalNumber,type,metadata))return type}}function isNumberTypeEqualTo(nationalNumber,type,metadata){if(type=metadata.type(type),!type||!type.pattern())return!1;if(type.possibleLengths()&&type.possibleLengths().indexOf(nationalNumber.length)<0)return!1;return matchesEntirely(nationalNumber,type.pattern())}function isValidNumber(input,options,metadata){if(options=options||{},metadata=new Metadata(metadata),metadata.selectNumberingPlan(input.country,input.countryCallingCode),metadata.hasTypes())return getNumberType(input,options,metadata.metadata)!==void 0;var nationalNumber=options.v2?input.nationalNumber:input.phone;return matchesEntirely(nationalNumber,metadata.nationalNumberPattern())}function getPossibleCountriesForNumber(callingCode,nationalNumber,metadata){var _metadata=new Metadata(metadata),possibleCountries=_metadata.getCountryCodesForCallingCode(callingCode);if(!possibleCountries)return[];return possibleCountries.filter(function(country){return couldNationalNumberBelongToCountry(nationalNumber,country,metadata)})}function couldNationalNumberBelongToCountry(nationalNumber,country,metadata){var _metadata=new Metadata(metadata);if(_metadata.selectNumberingPlan(country),_metadata.numberingPlan.possibleLengths().indexOf(nationalNumber.length)>=0)return!0;return!1}var MIN_LENGTH_FOR_NSN=2,MAX_LENGTH_FOR_NSN=17,MAX_LENGTH_COUNTRY_CODE=3,VALID_DIGITS="0-9\uFF10-\uFF19\u0660-\u0669\u06F0-\u06F9",DASHES="-\u2010-\u2015\u2212\u30FC\uFF0D",SLASHES="\uFF0F/",DOTS="\uFF0E.",WHITESPACE=" \xA0\xAD\u200B\u2060\u3000",BRACKETS="()\uFF08\uFF09\uFF3B\uFF3D\\[\\]",TILDES="~\u2053\u223C\uFF5E",VALID_PUNCTUATION="".concat(DASHES).concat(SLASHES).concat(DOTS).concat(WHITESPACE).concat(BRACKETS).concat(TILDES),PLUS_CHARS="+\uFF0B";var CAPTURING_DIGIT_PATTERN=new RegExp("(["+VALID_DIGITS+"])");function stripIddPrefix(number,country,callingCode,metadata){if(!country)return;var countryMetadata=new Metadata(metadata);countryMetadata.selectNumberingPlan(country,callingCode);var IDDPrefixPattern=new RegExp(countryMetadata.IDDPrefix());if(number.search(IDDPrefixPattern)!==0)return;number=number.slice(number.match(IDDPrefixPattern)[0].length);var matchedGroups=number.match(CAPTURING_DIGIT_PATTERN);if(matchedGroups&&matchedGroups[1]!=null&&matchedGroups[1].length>0){if(matchedGroups[1]==="0")return}return number}function extractNationalNumberFromPossiblyIncompleteNumber(number,metadata){if(number&&metadata.numberingPlan.nationalPrefixForParsing()){var prefixPattern=new RegExp("^(?:"+metadata.numberingPlan.nationalPrefixForParsing()+")"),prefixMatch=prefixPattern.exec(number);if(prefixMatch){var nationalNumber,carrierCode,capturedGroupsCount=prefixMatch.length-1,hasCapturedGroups=capturedGroupsCount>0&&prefixMatch[capturedGroupsCount];if(metadata.nationalPrefixTransformRule()&&hasCapturedGroups){if(nationalNumber=number.replace(prefixPattern,metadata.nationalPrefixTransformRule()),capturedGroupsCount>1)carrierCode=prefixMatch[1]}else{var prefixBeforeNationalNumber=prefixMatch[0];if(nationalNumber=number.slice(prefixBeforeNationalNumber.length),hasCapturedGroups)carrierCode=prefixMatch[1]}var nationalPrefix;if(hasCapturedGroups){var possiblePositionOfTheFirstCapturedGroup=number.indexOf(prefixMatch[1]),possibleNationalPrefix=number.slice(0,possiblePositionOfTheFirstCapturedGroup);if(possibleNationalPrefix===metadata.numberingPlan.nationalPrefix())nationalPrefix=metadata.numberingPlan.nationalPrefix()}else nationalPrefix=prefixMatch[0];return{nationalNumber,nationalPrefix,carrierCode}}}return{nationalNumber:number}}function _createForOfIteratorHelperLoose3(r2,e){var t2=typeof Symbol<"u"&&r2[Symbol.iterator]||r2["@@iterator"];if(t2)return(t2=t2.call(r2)).next.bind(t2);if(Array.isArray(r2)||(t2=_unsupportedIterableToArray3(r2))||e&&r2&&typeof r2.length=="number"){t2&&(r2=t2);var o=0;return function(){return o>=r2.length?{done:!0}:{done:!1,value:r2[o++]}}}throw TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray3(r2,a12){if(r2){if(typeof r2=="string")return _arrayLikeToArray3(r2,a12);var t2={}.toString.call(r2).slice(8,-1);return t2==="Object"&&r2.constructor&&(t2=r2.constructor.name),t2==="Map"||t2==="Set"?Array.from(r2):t2==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t2)?_arrayLikeToArray3(r2,a12):void 0}}function _arrayLikeToArray3(r2,a12){(a12==null||a12>r2.length)&&(a12=r2.length);for(var e=0,n2=Array(a12);e<a12;e++)n2[e]=r2[e];return n2}function getCountryByNationalNumber(nationalPhoneNumber,_ref){var{countries,metadata}=_ref;metadata=new Metadata(metadata);for(var _iterator=_createForOfIteratorHelperLoose3(countries),_step;!(_step=_iterator()).done;){var country=_step.value;if(metadata.selectNumberingPlan(country),metadata.leadingDigits()){if(nationalPhoneNumber&&nationalPhoneNumber.search(metadata.leadingDigits())===0)return country}else if(getNumberType({phone:nationalPhoneNumber,country},void 0,metadata.metadata))return country}}var USE_NON_GEOGRAPHIC_COUNTRY_CODE=!1;function getCountryByCallingCode(callingCode,_ref){var{nationalNumber:nationalPhoneNumber,metadata}=_ref;if(USE_NON_GEOGRAPHIC_COUNTRY_CODE){if(metadata.isNonGeographicCallingCode(callingCode))return"001"}var possibleCountries=metadata.getCountryCodesForCallingCode(callingCode);if(!possibleCountries)return;if(possibleCountries.length===1)return possibleCountries[0];return getCountryByNationalNumber(nationalPhoneNumber,{countries:possibleCountries,metadata:metadata.metadata})}function extractNationalNumber(number,country,metadata){var _extractNationalNumbe=extractNationalNumberFromPossiblyIncompleteNumber(number,metadata),carrierCode=_extractNationalNumbe.carrierCode,nationalNumber=_extractNationalNumbe.nationalNumber;if(nationalNumber!==number){if(!shouldHaveExtractedNationalPrefix(number,nationalNumber,metadata))return{nationalNumber:number};if(metadata.numberingPlan.possibleLengths()){if(!country)country=getCountryByCallingCode(metadata.numberingPlan.callingCode(),{nationalNumber,metadata});if(!isPossibleIncompleteNationalNumber(nationalNumber,country,metadata))return{nationalNumber:number}}}return{nationalNumber,carrierCode}}function shouldHaveExtractedNationalPrefix(nationalNumberBefore,nationalNumberAfter,metadata){if(matchesEntirely(nationalNumberBefore,metadata.nationalNumberPattern())&&!matchesEntirely(nationalNumberAfter,metadata.nationalNumberPattern()))return!1;return!0}function isPossibleIncompleteNationalNumber(nationalNumber,country,metadata){switch(checkNumberLength(nationalNumber,country,metadata)){case"TOO_SHORT":case"INVALID_LENGTH":return!1;default:return!0}}function extractCountryCallingCodeFromInternationalNumberWithoutPlusSign(number,country,defaultCountry,defaultCallingCode,metadata){var countryCallingCode=country||defaultCountry?getCountryCallingCode(country||defaultCountry,metadata):defaultCallingCode;if(number.indexOf(countryCallingCode)===0){metadata=new Metadata(metadata),metadata.selectNumberingPlan(country||defaultCountry,countryCallingCode);var possibleShorterNumber=number.slice(countryCallingCode.length),_extractNationalNumbe=extractNationalNumber(possibleShorterNumber,country,metadata),possibleShorterNationalNumber=_extractNationalNumbe.nationalNumber,_extractNationalNumbe2=extractNationalNumber(number,country,metadata),nationalNumber=_extractNationalNumbe2.nationalNumber;if(!matchesEntirely(nationalNumber,metadata.nationalNumberPattern())&&matchesEntirely(possibleShorterNationalNumber,metadata.nationalNumberPattern())||checkNumberLength(nationalNumber,country,metadata)==="TOO_LONG")return{countryCallingCode,number:possibleShorterNumber}}return{number}}function extractCountryCallingCode(number,country,defaultCountry,defaultCallingCode,metadata){if(!number)return{};var isNumberWithIddPrefix;if(number[0]!=="+"){var numberWithoutIDD=stripIddPrefix(number,country||defaultCountry,defaultCallingCode,metadata);if(numberWithoutIDD&&numberWithoutIDD!==number)isNumberWithIddPrefix=!0,number="+"+numberWithoutIDD;else{if(country||defaultCountry||defaultCallingCode){var _extractCountryCallin=extractCountryCallingCodeFromInternationalNumberWithoutPlusSign(number,country,defaultCountry,defaultCallingCode,metadata),countryCallingCode=_extractCountryCallin.countryCallingCode,shorterNumber=_extractCountryCallin.number;if(countryCallingCode)return{countryCallingCodeSource:"FROM_NUMBER_WITHOUT_PLUS_SIGN",countryCallingCode,number:shorterNumber}}return{number}}}if(number[1]==="0")return{};metadata=new Metadata(metadata);var i=2;while(i-1<=MAX_LENGTH_COUNTRY_CODE&&i<=number.length){var _countryCallingCode=number.slice(1,i);if(metadata.hasCallingCode(_countryCallingCode))return metadata.selectNumberingPlan(_countryCallingCode),{countryCallingCodeSource:isNumberWithIddPrefix?"FROM_NUMBER_WITH_IDD":"FROM_NUMBER_WITH_PLUS_SIGN",countryCallingCode:_countryCallingCode,number:number.slice(i)};i++}return{}}function applyInternationalSeparatorStyle(formattedNumber){return formattedNumber.replace(new RegExp("[".concat(VALID_PUNCTUATION,"]+"),"g")," ").trim()}var FIRST_GROUP_PATTERN=/(\$\d)/;function formatNationalNumberUsingFormat(number,format,_ref){var{useInternationalFormat,withNationalPrefix,carrierCode,metadata}=_ref,formattedNumber=number.replace(new RegExp(format.pattern()),useInternationalFormat?format.internationalFormat():withNationalPrefix&&format.nationalPrefixFormattingRule()?format.format().replace(FIRST_GROUP_PATTERN,format.nationalPrefixFormattingRule()):format.format());if(useInternationalFormat)return applyInternationalSeparatorStyle(formattedNumber);return formattedNumber}var SINGLE_IDD_PREFIX_REG_EXP=/^[\d]+(?:[~\u2053\u223C\uFF5E][\d]+)?$/;function getIddPrefix(country,callingCode,metadata){var countryMetadata=new Metadata(metadata);if(countryMetadata.selectNumberingPlan(country,callingCode),countryMetadata.defaultIDDPrefix())return countryMetadata.defaultIDDPrefix();if(SINGLE_IDD_PREFIX_REG_EXP.test(countryMetadata.IDDPrefix()))return countryMetadata.IDDPrefix()}var RFC3966_EXTN_PREFIX=";ext=",getExtensionDigitsPattern=function(maxLength){return"([".concat(VALID_DIGITS,"]{1,").concat(maxLength,"})")};function createExtensionPattern(purpose){var extLimitAfterExplicitLabel="20",extLimitAfterLikelyLabel="15",extLimitAfterAmbiguousChar="9",extLimitWhenNotSure="6",possibleSeparatorsBetweenNumberAndExtLabel="[ \xA0\\t,]*",possibleCharsAfterExtLabel="[:\\.\uFF0E]?[ \xA0\\t,-]*",optionalExtnSuffix="#?",explicitExtLabels="(?:e?xt(?:ensi(?:o\u0301?|\xF3))?n?|\uFF45?\uFF58\uFF54\uFF4E?|\u0434\u043E\u0431|anexo)",ambiguousExtLabels="(?:[x\uFF58#\uFF03~\uFF5E]|int|\uFF49\uFF4E\uFF54)",ambiguousSeparator="[- ]+",possibleSeparatorsNumberExtLabelNoComma="[ \xA0\\t]*",autoDiallingAndExtLabelsFound="(?:,{2}|;)",rfcExtn=RFC3966_EXTN_PREFIX+getExtensionDigitsPattern(extLimitAfterExplicitLabel),explicitExtn=possibleSeparatorsBetweenNumberAndExtLabel+explicitExtLabels+possibleCharsAfterExtLabel+getExtensionDigitsPattern(extLimitAfterExplicitLabel)+optionalExtnSuffix,ambiguousExtn=possibleSeparatorsBetweenNumberAndExtLabel+ambiguousExtLabels+possibleCharsAfterExtLabel+getExtensionDigitsPattern(extLimitAfterAmbiguousChar)+optionalExtnSuffix,americanStyleExtnWithSuffix=ambiguousSeparator+getExtensionDigitsPattern(extLimitWhenNotSure)+"#",autoDiallingExtn=possibleSeparatorsNumberExtLabelNoComma+autoDiallingAndExtLabelsFound+possibleCharsAfterExtLabel+getExtensionDigitsPattern(extLimitAfterLikelyLabel)+optionalExtnSuffix,onlyCommasExtn=possibleSeparatorsNumberExtLabelNoComma+"(?:,)+"+possibleCharsAfterExtLabel+getExtensionDigitsPattern(extLimitAfterAmbiguousChar)+optionalExtnSuffix;return rfcExtn+"|"+explicitExtn+"|"+ambiguousExtn+"|"+americanStyleExtnWithSuffix+"|"+autoDiallingExtn+"|"+onlyCommasExtn}var MIN_LENGTH_PHONE_NUMBER_PATTERN="["+VALID_DIGITS+"]{"+MIN_LENGTH_FOR_NSN+"}",VALID_PHONE_NUMBER="["+PLUS_CHARS+"]{0,1}(?:["+VALID_PUNCTUATION+"]*["+VALID_DIGITS+"]){3,}["+VALID_PUNCTUATION+VALID_DIGITS+"]*",VALID_PHONE_NUMBER_START_REG_EXP=new RegExp("^["+PLUS_CHARS+"]{0,1}(?:["+VALID_PUNCTUATION+"]*["+VALID_DIGITS+"]){1,2}$","i"),VALID_PHONE_NUMBER_WITH_EXTENSION=VALID_PHONE_NUMBER+"(?:"+createExtensionPattern()+")?",VALID_PHONE_NUMBER_PATTERN=new RegExp("^"+MIN_LENGTH_PHONE_NUMBER_PATTERN+"$|^"+VALID_PHONE_NUMBER_WITH_EXTENSION+"$","i");function isViablePhoneNumber(number){return number.length>=MIN_LENGTH_FOR_NSN&&VALID_PHONE_NUMBER_PATTERN.test(number)}function isViablePhoneNumberStart(number){return VALID_PHONE_NUMBER_START_REG_EXP.test(number)}function formatRFC3966(_ref){var{number,ext}=_ref;if(!number)return"";if(number[0]!=="+")throw Error('"formatRFC3966()" expects "number" to be in E.164 format.');return"tel:".concat(number).concat(ext?";ext="+ext:"")}var DEFAULT_OPTIONS={formatExtension:function(formattedNumber,extension,metadata){return"".concat(formattedNumber).concat(metadata.ext()).concat(extension)}};function formatNumber(input,format,options,metadata){if(options)options=merge({},DEFAULT_OPTIONS,options);else options=DEFAULT_OPTIONS;if(metadata=new Metadata(metadata),input.country&&input.country!=="001"){if(!metadata.hasCountry(input.country))throw Error("Unknown country: ".concat(input.country));metadata.selectNumberingPlan(input.country)}else if(input.countryCallingCode)metadata.selectNumberingPlan(input.countryCallingCode);else return input.phone||"";var countryCallingCode=metadata.countryCallingCode(),nationalNumber=options.v2?input.nationalNumber:input.phone,number;switch(format){case"NATIONAL":if(!nationalNumber)return"";return number=formatNationalNumber(nationalNumber,input.carrierCode,"NATIONAL",metadata,options),addExtension(number,input.ext,metadata,options.formatExtension);case"INTERNATIONAL":if(!nationalNumber)return"+".concat(countryCallingCode);return number=formatNationalNumber(nationalNumber,null,"INTERNATIONAL",metadata,options),number="+".concat(countryCallingCode," ").concat(number),addExtension(number,input.ext,metadata,options.formatExtension);case"E.164":return"+".concat(countryCallingCode).concat(nationalNumber);case"RFC3966":return formatRFC3966({number:"+".concat(countryCallingCode).concat(nationalNumber),ext:input.ext});case"IDD":if(!options.fromCountry)return;var formattedNumber=formatIDD(nationalNumber,input.carrierCode,countryCallingCode,options.fromCountry,metadata);return addExtension(formattedNumber,input.ext,metadata,options.formatExtension);default:throw Error('Unknown "format" argument passed to "formatNumber()": "'.concat(format,'"'))}}function formatNationalNumber(number,carrierCode,formatAs,metadata,options){var format=chooseFormatForNumber(metadata.formats(),number);if(!format)return number;return formatNationalNumberUsingFormat(number,format,{useInternationalFormat:formatAs==="INTERNATIONAL",withNationalPrefix:format.nationalPrefixIsOptionalWhenFormattingInNationalFormat()&&options&&options.nationalPrefix===!1?!1:!0,carrierCode,metadata})}function chooseFormatForNumber(availableFormats,nationalNumber){return pickFirstMatchingElement(availableFormats,function(format){if(format.leadingDigitsPatterns().length>0){var lastLeadingDigitsPattern=format.leadingDigitsPatterns()[format.leadingDigitsPatterns().length-1];if(nationalNumber.search(lastLeadingDigitsPattern)!==0)return!1}return matchesEntirely(nationalNumber,format.pattern())})}function addExtension(formattedNumber,ext,metadata,formatExtension2){return ext?formatExtension2(formattedNumber,ext,metadata):formattedNumber}function formatIDD(nationalNumber,carrierCode,countryCallingCode,fromCountry,metadata){var fromCountryCallingCode=getCountryCallingCode(fromCountry,metadata.metadata);if(fromCountryCallingCode===countryCallingCode){var formattedNumber=formatNationalNumber(nationalNumber,carrierCode,"NATIONAL",metadata);if(countryCallingCode==="1")return countryCallingCode+" "+formattedNumber;return formattedNumber}var iddPrefix=getIddPrefix(fromCountry,void 0,metadata.metadata);if(iddPrefix)return"".concat(iddPrefix," ").concat(countryCallingCode," ").concat(formatNationalNumber(nationalNumber,null,"INTERNATIONAL",metadata))}function merge(){var i=1;for(var _len=arguments.length,objects=Array(_len),_key2=0;_key2<_len;_key2++)objects[_key2]=arguments[_key2];while(i<objects.length){if(objects[i])for(var key in objects[i])objects[0][key]=objects[i][key];i++}return objects[0]}function pickFirstMatchingElement(elements,testFunction){var i=0;while(i<elements.length){if(testFunction(elements[i]))return elements[i];i++}}function _typeof2(o){return _typeof2=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o2){return typeof o2}:function(o2){return o2&&typeof Symbol=="function"&&o2.constructor===Symbol&&o2!==Symbol.prototype?"symbol":typeof o2},_typeof2(o)}function ownKeys(e,r2){var t2=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r2&&(o=o.filter(function(r3){return Object.getOwnPropertyDescriptor(e,r3).enumerable})),t2.push.apply(t2,o)}return t2}function _objectSpread(e){for(var r2=1;r2<arguments.length;r2++){var t2=arguments[r2]!=null?arguments[r2]:{};r2%2?ownKeys(Object(t2),!0).forEach(function(r3){_defineProperty(e,r3,t2[r3])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t2)):ownKeys(Object(t2)).forEach(function(r3){Object.defineProperty(e,r3,Object.getOwnPropertyDescriptor(t2,r3))})}return e}function _defineProperty(e,r2,t2){return(r2=_toPropertyKey2(r2))in e?Object.defineProperty(e,r2,{value:t2,enumerable:!0,configurable:!0,writable:!0}):e[r2]=t2,e}function _classCallCheck2(a12,n2){if(!(a12 instanceof n2))throw TypeError("Cannot call a class as a function")}function _defineProperties2(e,r2){for(var t2=0;t2<r2.length;t2++){var o=r2[t2];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey2(o.key),o)}}function _createClass2(e,r2,t2){return r2&&_defineProperties2(e.prototype,r2),t2&&_defineProperties2(e,t2),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey2(t2){var i=_toPrimitive2(t2,"string");return _typeof2(i)=="symbol"?i:i+""}function _toPrimitive2(t2,r2){if(_typeof2(t2)!="object"||!t2)return t2;var e=t2[Symbol.toPrimitive];if(e!==void 0){var i=e.call(t2,r2||"default");if(_typeof2(i)!="object")return i;throw TypeError("@@toPrimitive must return a primitive value.")}return(r2==="string"?String:Number)(t2)}var USE_NON_GEOGRAPHIC_COUNTRY_CODE2=!1,PhoneNumber=function(){function PhoneNumber2(countryOrCountryCallingCode,nationalNumber,metadata){if(_classCallCheck2(this,PhoneNumber2),!countryOrCountryCallingCode)throw TypeError("First argument is required");if(typeof countryOrCountryCallingCode!=="string")throw TypeError("First argument must be a string");if(countryOrCountryCallingCode[0]==="+"&&!nationalNumber)throw TypeError("`metadata` argument not passed");if(isObject2(nationalNumber)&&isObject2(nationalNumber.countries)){metadata=nationalNumber;var e164Number=countryOrCountryCallingCode;if(!E164_NUMBER_REGEXP.test(e164Number))throw Error('Invalid `number` argument passed: must consist of a "+" followed by digits');var _extractCountryCallin=extractCountryCallingCode(e164Number,void 0,void 0,void 0,metadata),_countryCallingCode=_extractCountryCallin.countryCallingCode,number=_extractCountryCallin.number;if(nationalNumber=number,countryOrCountryCallingCode=_countryCallingCode,!nationalNumber)throw Error("Invalid `number` argument passed: too short")}if(!nationalNumber)throw TypeError("`nationalNumber` argument is required");if(typeof nationalNumber!=="string")throw TypeError("`nationalNumber` argument must be a string");validateMetadata(metadata);var _getCountryAndCountry=getCountryAndCountryCallingCode(countryOrCountryCallingCode,metadata),country=_getCountryAndCountry.country,countryCallingCode=_getCountryAndCountry.countryCallingCode;this.country=country,this.countryCallingCode=countryCallingCode,this.nationalNumber=nationalNumber,this.number="+"+this.countryCallingCode+this.nationalNumber,this.getMetadata=function(){return metadata}}return _createClass2(PhoneNumber2,[{key:"setExt",value:function(ext){this.ext=ext}},{key:"getPossibleCountries",value:function(){if(this.country)return[this.country];return getPossibleCountriesForNumber(this.countryCallingCode,this.nationalNumber,this.getMetadata())}},{key:"isPossible",value:function(){return isPossiblePhoneNumber(this,{v2:!0},this.getMetadata())}},{key:"isValid",value:function(){return isValidNumber(this,{v2:!0},this.getMetadata())}},{key:"isNonGeographic",value:function(){var metadata=new Metadata(this.getMetadata());return metadata.isNonGeographicCallingCode(this.countryCallingCode)}},{key:"isEqual",value:function(phoneNumber){return this.number===phoneNumber.number&&this.ext===phoneNumber.ext}},{key:"getType",value:function(){return getNumberType(this,{v2:!0},this.getMetadata())}},{key:"format",value:function(_format,options){return formatNumber(this,_format,options?_objectSpread(_objectSpread({},options),{},{v2:!0}):{v2:!0},this.getMetadata())}},{key:"formatNational",value:function(options){return this.format("NATIONAL",options)}},{key:"formatInternational",value:function(options){return this.format("INTERNATIONAL",options)}},{key:"getURI",value:function(options){return this.format("RFC3966",options)}}])}();var isCountryCode=function(value){return/^[A-Z]{2}$/.test(value)};function getCountryAndCountryCallingCode(countryOrCountryCallingCode,metadataJson){var country,countryCallingCode,metadata=new Metadata(metadataJson);if(isCountryCode(countryOrCountryCallingCode))country=countryOrCountryCallingCode,metadata.selectNumberingPlan(country),countryCallingCode=metadata.countryCallingCode();else if(countryCallingCode=countryOrCountryCallingCode,USE_NON_GEOGRAPHIC_COUNTRY_CODE2){if(metadata.isNonGeographicCallingCode(countryCallingCode))country="001"}return{country,countryCallingCode}}var E164_NUMBER_REGEXP=/^\+\d+$/;function _typeof3(o){return _typeof3=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o2){return typeof o2}:function(o2){return o2&&typeof Symbol=="function"&&o2.constructor===Symbol&&o2!==Symbol.prototype?"symbol":typeof o2},_typeof3(o)}function _defineProperties3(e,r2){for(var t2=0;t2<r2.length;t2++){var o=r2[t2];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,_toPropertyKey3(o.key),o)}}function _createClass3(e,r2,t2){return r2&&_defineProperties3(e.prototype,r2),t2&&_defineProperties3(e,t2),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey3(t2){var i=_toPrimitive3(t2,"string");return _typeof3(i)=="symbol"?i:i+""}function _toPrimitive3(t2,r2){if(_typeof3(t2)!="object"||!t2)return t2;var e=t2[Symbol.toPrimitive];if(e!==void 0){var i=e.call(t2,r2||"default");if(_typeof3(i)!="object")return i;throw TypeError("@@toPrimitive must return a primitive value.")}return(r2==="string"?String:Number)(t2)}function _classCallCheck3(a12,n2){if(!(a12 instanceof n2))throw TypeError("Cannot call a class as a function")}function _callSuper(t2,o,e){return o=_getPrototypeOf(o),_possibleConstructorReturn(t2,_isNativeReflectConstruct()?Reflect.construct(o,e||[],_getPrototypeOf(t2).constructor):o.apply(t2,e))}function _possibleConstructorReturn(t2,e){if(e&&(_typeof3(e)=="object"||typeof e=="function"))return e;if(e!==void 0)throw TypeError("Derived constructors may only return object or undefined");return _assertThisInitialized(t2)}function _assertThisInitialized(e){if(e===void 0)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inherits(t2,e){if(typeof e!="function"&&e!==null)throw TypeError("Super expression must either be null or a function");t2.prototype=Object.create(e&&e.prototype,{constructor:{value:t2,writable:!0,configurable:!0}}),Object.defineProperty(t2,"prototype",{writable:!1}),e&&_setPrototypeOf(t2,e)}function _wrapNativeSuper(t2){var r2=typeof Map=="function"?new Map:void 0;return _wrapNativeSuper=function(t3){if(t3===null||!_isNativeFunction(t3))return t3;if(typeof t3!="function")throw TypeError("Super expression must either be null or a function");if(r2!==void 0){if(r2.has(t3))return r2.get(t3);r2.set(t3,Wrapper)}function Wrapper(){return _construct(t3,arguments,_getPrototypeOf(this).constructor)}return Wrapper.prototype=Object.create(t3.prototype,{constructor:{value:Wrapper,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(Wrapper,t3)},_wrapNativeSuper(t2)}function _construct(t2,e,r2){if(_isNativeReflectConstruct())return Reflect.construct.apply(null,arguments);var o=[null];o.push.apply(o,e);var p=new(t2.bind.apply(t2,o));return r2&&_setPrototypeOf(p,r2.prototype),p}function _isNativeReflectConstruct(){try{var t2=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t3){}return(_isNativeReflectConstruct=function(){return!!t2})()}function _isNativeFunction(t2){try{return Function.toString.call(t2).indexOf("[native code]")!==-1}catch(n2){return typeof t2=="function"}}function _setPrototypeOf(t2,e){return _setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t3,e2){return t3.__proto__=e2,t3},_setPrototypeOf(t2,e)}function _getPrototypeOf(t2){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t3){return t3.__proto__||Object.getPrototypeOf(t3)},_getPrototypeOf(t2)}var ParseError3=function(_Error){function ParseError4(code){var _this;return _classCallCheck3(this,ParseError4),_this=_callSuper(this,ParseError4,[code]),Object.setPrototypeOf(_this,ParseError4.prototype),_this.name=_this.constructor.name,_this}return _inherits(ParseError4,_Error),_createClass3(ParseError4)}(_wrapNativeSuper(Error));var EXTN_PATTERN=new RegExp("(?:"+createExtensionPattern()+")$","i");function extractExtension(number){var start=number.search(EXTN_PATTERN);if(start<0)return{};var numberWithoutExtension=number.slice(0,start),matches=number.match(EXTN_PATTERN),i=1;while(i<matches.length){if(matches[i])return{number:numberWithoutExtension,ext:matches[i]};i++}}var DIGITS={"0":"0","1":"1","2":"2","3":"3","4":"4","5":"5","6":"6","7":"7","8":"8","9":"9","\uFF10":"0","\uFF11":"1","\uFF12":"2","\uFF13":"3","\uFF14":"4","\uFF15":"5","\uFF16":"6","\uFF17":"7","\uFF18":"8","\uFF19":"9","\u0660":"0","\u0661":"1","\u0662":"2","\u0663":"3","\u0664":"4","\u0665":"5","\u0666":"6","\u0667":"7","\u0668":"8","\u0669":"9","\u06F0":"0","\u06F1":"1","\u06F2":"2","\u06F3":"3","\u06F4":"4","\u06F5":"5","\u06F6":"6","\u06F7":"7","\u06F8":"8","\u06F9":"9"};function parseDigit(character){return DIGITS[character]}function _createForOfIteratorHelperLoose4(r2,e){var t2=typeof Symbol<"u"&&r2[Symbol.iterator]||r2["@@iterator"];if(t2)return(t2=t2.call(r2)).next.bind(t2);if(Array.isArray(r2)||(t2=_unsupportedIterableToArray4(r2))||e&&r2&&typeof r2.length=="number"){t2&&(r2=t2);var o=0;return function(){return o>=r2.length?{done:!0}:{done:!1,value:r2[o++]}}}throw TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray4(r2,a12){if(r2){if(typeof r2=="string")return _arrayLikeToArray4(r2,a12);var t2={}.toString.call(r2).slice(8,-1);return t2==="Object"&&r2.constructor&&(t2=r2.constructor.name),t2==="Map"||t2==="Set"?Array.from(r2):t2==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t2)?_arrayLikeToArray4(r2,a12):void 0}}function _arrayLikeToArray4(r2,a12){(a12==null||a12>r2.length)&&(a12=r2.length);for(var e=0,n2=Array(a12);e<a12;e++)n2[e]=r2[e];return n2}function parseIncompletePhoneNumber(string){var result="";for(var _iterator=_createForOfIteratorHelperLoose4(string.split("")),_step;!(_step=_iterator()).done;){var character=_step.value;result+=parsePhoneNumberCharacter(character,result)||""}return result}function parsePhoneNumberCharacter(character,prevParsedCharacters,eventListener){if(character==="+"){if(prevParsedCharacters){if(typeof eventListener==="function")eventListener("end");return}return"+"}return parseDigit(character)}var PLUS_SIGN="+",RFC3966_VISUAL_SEPARATOR_="[\\-\\.\\(\\)]?",RFC3966_PHONE_DIGIT_="(["+VALID_DIGITS+"]|"+RFC3966_VISUAL_SEPARATOR_+")",RFC3966_GLOBAL_NUMBER_DIGITS_="^\\"+PLUS_SIGN+RFC3966_PHONE_DIGIT_+"*["+VALID_DIGITS+"]"+RFC3966_PHONE_DIGIT_+"*$",RFC3966_GLOBAL_NUMBER_DIGITS_PATTERN_=new RegExp(RFC3966_GLOBAL_NUMBER_DIGITS_,"g"),ALPHANUM_=VALID_DIGITS,RFC3966_DOMAINLABEL_="["+ALPHANUM_+"]+((\\-)*["+ALPHANUM_+"])*",VALID_ALPHA_="a-zA-Z",RFC3966_TOPLABEL_="["+VALID_ALPHA_+"]+((\\-)*["+ALPHANUM_+"])*",RFC3966_DOMAINNAME_="^("+RFC3966_DOMAINLABEL_+"\\.)*"+RFC3966_TOPLABEL_+"\\.?$",RFC3966_DOMAINNAME_PATTERN_=new RegExp(RFC3966_DOMAINNAME_,"g"),RFC3966_PREFIX_="tel:",RFC3966_PHONE_CONTEXT_=";phone-context=",RFC3966_ISDN_SUBADDRESS_=";isub=";function extractPhoneContext(numberToExtractFrom){var indexOfPhoneContext=numberToExtractFrom.indexOf(RFC3966_PHONE_CONTEXT_);if(indexOfPhoneContext<0)return null;var phoneContextStart=indexOfPhoneContext+RFC3966_PHONE_CONTEXT_.length;if(phoneContextStart>=numberToExtractFrom.length)return"";var phoneContextEnd=numberToExtractFrom.indexOf(";",phoneContextStart);if(phoneContextEnd>=0)return numberToExtractFrom.substring(phoneContextStart,phoneContextEnd);else return numberToExtractFrom.substring(phoneContextStart)}function isPhoneContextValid(phoneContext){if(phoneContext===null)return!0;if(phoneContext.length===0)return!1;return RFC3966_GLOBAL_NUMBER_DIGITS_PATTERN_.test(phoneContext)||RFC3966_DOMAINNAME_PATTERN_.test(phoneContext)}function extractFormattedPhoneNumberFromPossibleRfc3966NumberUri(numberToParse,_ref){var extractFormattedPhoneNumber=_ref.extractFormattedPhoneNumber,phoneContext=extractPhoneContext(numberToParse);if(!isPhoneContextValid(phoneContext))throw new ParseError3("NOT_A_NUMBER");var phoneNumberString;if(phoneContext===null)phoneNumberString=extractFormattedPhoneNumber(numberToParse)||"";else{if(phoneNumberString="",phoneContext.charAt(0)===PLUS_SIGN)phoneNumberString+=phoneContext;var indexOfRfc3966Prefix=numberToParse.indexOf(RFC3966_PREFIX_),indexOfNationalNumber;if(indexOfRfc3966Prefix>=0)indexOfNationalNumber=indexOfRfc3966Prefix+RFC3966_PREFIX_.length;else indexOfNationalNumber=0;var indexOfPhoneContext=numberToParse.indexOf(RFC3966_PHONE_CONTEXT_);phoneNumberString+=numberToParse.substring(indexOfNationalNumber,indexOfPhoneContext)}var indexOfIsdn=phoneNumberString.indexOf(RFC3966_ISDN_SUBADDRESS_);if(indexOfIsdn>0)phoneNumberString=phoneNumberString.substring(0,indexOfIsdn);if(phoneNumberString!=="")return phoneNumberString}var MAX_INPUT_STRING_LENGTH=250,PHONE_NUMBER_START_PATTERN=new RegExp("["+PLUS_CHARS+VALID_DIGITS+"]"),AFTER_PHONE_NUMBER_END_PATTERN=new RegExp("[^"+VALID_DIGITS+"#]+$"),USE_NON_GEOGRAPHIC_COUNTRY_CODE3=!1;function parse3(text2,options,metadata){if(options=options||{},metadata=new Metadata(metadata),options.defaultCountry&&!metadata.hasCountry(options.defaultCountry)){if(options.v2)throw new ParseError3("INVALID_COUNTRY");throw Error("Unknown country: ".concat(options.defaultCountry))}var _parseInput=parseInput(text2,options.v2,options.extract),formattedPhoneNumber=_parseInput.number,ext=_parseInput.ext,error=_parseInput.error;if(!formattedPhoneNumber){if(options.v2){if(error==="TOO_SHORT")throw new ParseError3("TOO_SHORT");throw new ParseError3("NOT_A_NUMBER")}return{}}var _parsePhoneNumber=parsePhoneNumber(formattedPhoneNumber,options.defaultCountry,options.defaultCallingCode,metadata),country=_parsePhoneNumber.country,nationalNumber=_parsePhoneNumber.nationalNumber,countryCallingCode=_parsePhoneNumber.countryCallingCode,countryCallingCodeSource=_parsePhoneNumber.countryCallingCodeSource,carrierCode=_parsePhoneNumber.carrierCode;if(!metadata.hasSelectedNumberingPlan()){if(options.v2)throw new ParseError3("INVALID_COUNTRY");return{}}if(!nationalNumber||nationalNumber.length<MIN_LENGTH_FOR_NSN){if(options.v2)throw new ParseError3("TOO_SHORT");return{}}if(nationalNumber.length>MAX_LENGTH_FOR_NSN){if(options.v2)throw new ParseError3("TOO_LONG");return{}}if(options.v2){var phoneNumber=new PhoneNumber(countryCallingCode,nationalNumber,metadata.metadata);if(country)phoneNumber.country=country;if(carrierCode)phoneNumber.carrierCode=carrierCode;if(ext)phoneNumber.ext=ext;return phoneNumber.__countryCallingCodeSource=countryCallingCodeSource,phoneNumber}var valid=(options.extended?metadata.hasSelectedNumberingPlan():country)?matchesEntirely(nationalNumber,metadata.nationalNumberPattern()):!1;if(!options.extended)return valid?result(country,nationalNumber,ext):{};return{country,countryCallingCode,carrierCode,valid,possible:valid?!0:options.extended===!0&&metadata.possibleLengths()&&isPossibleNumber(nationalNumber,country,metadata)?!0:!1,phone:nationalNumber,ext}}function _extractFormattedPhoneNumber(text2,extract,throwOnError){if(!text2)return;if(text2.length>MAX_INPUT_STRING_LENGTH){if(throwOnError)throw new ParseError3("TOO_LONG");return}if(extract===!1)return text2;var startsAt=text2.search(PHONE_NUMBER_START_PATTERN);if(startsAt<0)return;return text2.slice(startsAt).replace(AFTER_PHONE_NUMBER_END_PATTERN,"")}function parseInput(text2,v2,extract){var number=extractFormattedPhoneNumberFromPossibleRfc3966NumberUri(text2,{extractFormattedPhoneNumber:function(text3){return _extractFormattedPhoneNumber(text3,extract,v2)}});if(!number)return{};if(!isViablePhoneNumber(number)){if(isViablePhoneNumberStart(number))return{error:"TOO_SHORT"};return{}}var withExtensionStripped=extractExtension(number);if(withExtensionStripped.ext)return withExtensionStripped;return{number}}function result(country,nationalNumber,ext){var result2={country,phone:nationalNumber};if(ext)result2.ext=ext;return result2}function parsePhoneNumber(formattedPhoneNumber,defaultCountry,defaultCallingCode,metadata){var _extractCountryCallin=extractCountryCallingCode(parseIncompletePhoneNumber(formattedPhoneNumber),void 0,defaultCountry,defaultCallingCode,metadata.metadata),countryCallingCodeSource=_extractCountryCallin.countryCallingCodeSource,countryCallingCode=_extractCountryCallin.countryCallingCode,number=_extractCountryCallin.number,country;if(countryCallingCode)metadata.selectNumberingPlan(countryCallingCode);else if(number&&(defaultCountry||defaultCallingCode)){if(metadata.selectNumberingPlan(defaultCountry,defaultCallingCode),defaultCountry)country=defaultCountry;else if(USE_NON_GEOGRAPHIC_COUNTRY_CODE3){if(metadata.isNonGeographicCallingCode(defaultCallingCode))country="001"}countryCallingCode=defaultCallingCode||getCountryCallingCode(defaultCountry,metadata.metadata)}else return{};if(!number)return{countryCallingCodeSource,countryCallingCode};var _extractNationalNumbe=extractNationalNumber(parseIncompletePhoneNumber(number),country,metadata),nationalNumber=_extractNationalNumbe.nationalNumber,carrierCode=_extractNationalNumbe.carrierCode,exactCountry=getCountryByCallingCode(countryCallingCode,{nationalNumber,metadata});if(exactCountry)if(country=exactCountry,exactCountry==="001");else metadata.selectNumberingPlan(country);return{country,countryCallingCode,countryCallingCodeSource,nationalNumber,carrierCode}}function _typeof4(o){return _typeof4=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o2){return typeof o2}:function(o2){return o2&&typeof Symbol=="function"&&o2.constructor===Symbol&&o2!==Symbol.prototype?"symbol":typeof o2},_typeof4(o)}function ownKeys2(e,r2){var t2=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r2&&(o=o.filter(function(r3){return Object.getOwnPropertyDescriptor(e,r3).enumerable})),t2.push.apply(t2,o)}return t2}function _objectSpread2(e){for(var r2=1;r2<arguments.length;r2++){var t2=arguments[r2]!=null?arguments[r2]:{};r2%2?ownKeys2(Object(t2),!0).forEach(function(r3){_defineProperty2(e,r3,t2[r3])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t2)):ownKeys2(Object(t2)).forEach(function(r3){Object.defineProperty(e,r3,Object.getOwnPropertyDescriptor(t2,r3))})}return e}function _defineProperty2(e,r2,t2){return(r2=_toPropertyKey4(r2))in e?Object.defineProperty(e,r2,{value:t2,enumerable:!0,configurable:!0,writable:!0}):e[r2]=t2,e}function _toPropertyKey4(t2){var i=_toPrimitive4(t2,"string");return _typeof4(i)=="symbol"?i:i+""}function _toPrimitive4(t2,r2){if(_typeof4(t2)!="object"||!t2)return t2;var e=t2[Symbol.toPrimitive];if(e!==void 0){var i=e.call(t2,r2||"default");if(_typeof4(i)!="object")return i;throw TypeError("@@toPrimitive must return a primitive value.")}return(r2==="string"?String:Number)(t2)}function parsePhoneNumberWithError(text2,options,metadata){return parse3(text2,_objectSpread2(_objectSpread2({},options),{},{v2:!0}),metadata)}function _typeof5(o){return _typeof5=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o2){return typeof o2}:function(o2){return o2&&typeof Symbol=="function"&&o2.constructor===Symbol&&o2!==Symbol.prototype?"symbol":typeof o2},_typeof5(o)}function ownKeys3(e,r2){var t2=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r2&&(o=o.filter(function(r3){return Object.getOwnPropertyDescriptor(e,r3).enumerable})),t2.push.apply(t2,o)}return t2}function _objectSpread3(e){for(var r2=1;r2<arguments.length;r2++){var t2=arguments[r2]!=null?arguments[r2]:{};r2%2?ownKeys3(Object(t2),!0).forEach(function(r3){_defineProperty3(e,r3,t2[r3])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t2)):ownKeys3(Object(t2)).forEach(function(r3){Object.defineProperty(e,r3,Object.getOwnPropertyDescriptor(t2,r3))})}return e}function _defineProperty3(e,r2,t2){return(r2=_toPropertyKey5(r2))in e?Object.defineProperty(e,r2,{value:t2,enumerable:!0,configurable:!0,writable:!0}):e[r2]=t2,e}function _toPropertyKey5(t2){var i=_toPrimitive5(t2,"string");return _typeof5(i)=="symbol"?i:i+""}function _toPrimitive5(t2,r2){if(_typeof5(t2)!="object"||!t2)return t2;var e=t2[Symbol.toPrimitive];if(e!==void 0){var i=e.call(t2,r2||"default");if(_typeof5(i)!="object")return i;throw TypeError("@@toPrimitive must return a primitive value.")}return(r2==="string"?String:Number)(t2)}function _slicedToArray(r2,e){return _arrayWithHoles(r2)||_iterableToArrayLimit(r2,e)||_unsupportedIterableToArray5(r2,e)||_nonIterableRest()}function _nonIterableRest(){throw TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _unsupportedIterableToArray5(r2,a12){if(r2){if(typeof r2=="string")return _arrayLikeToArray5(r2,a12);var t2={}.toString.call(r2).slice(8,-1);return t2==="Object"&&r2.constructor&&(t2=r2.constructor.name),t2==="Map"||t2==="Set"?Array.from(r2):t2==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t2)?_arrayLikeToArray5(r2,a12):void 0}}function _arrayLikeToArray5(r2,a12){(a12==null||a12>r2.length)&&(a12=r2.length);for(var e=0,n2=Array(a12);e<a12;e++)n2[e]=r2[e];return n2}function _iterableToArrayLimit(r2,l2){var t2=r2==null?null:typeof Symbol<"u"&&r2[Symbol.iterator]||r2["@@iterator"];if(t2!=null){var e,n2,i,u,a12=[],f=!0,o=!1;try{if(i=(t2=t2.call(r2)).next,l2===0){if(Object(t2)!==t2)return;f=!1}else for(;!(f=(e=i.call(t2)).done)&&(a12.push(e.value),a12.length!==l2);f=!0);}catch(r3){o=!0,n2=r3}finally{try{if(!f&&t2.return!=null&&(u=t2.return(),Object(u)!==u))return}finally{if(o)throw n2}}return a12}}function _arrayWithHoles(r2){if(Array.isArray(r2))return r2}function normalizeArguments(args){var _Array$prototype$slic=Array.prototype.slice.call(args),_Array$prototype$slic2=_slicedToArray(_Array$prototype$slic,4),arg_1=_Array$prototype$slic2[0],arg_2=_Array$prototype$slic2[1],arg_3=_Array$prototype$slic2[2],arg_4=_Array$prototype$slic2[3],text2,options,metadata;if(typeof arg_1==="string")text2=arg_1;else throw TypeError("A text for parsing must be a string.");if(!arg_2||typeof arg_2==="string"){if(arg_4)options=arg_3,metadata=arg_4;else options=void 0,metadata=arg_3;if(arg_2)options=_objectSpread3({defaultCountry:arg_2},options)}else if(isObject2(arg_2))if(arg_3)options=arg_2,metadata=arg_3;else metadata=arg_2;else throw Error("Invalid second argument: ".concat(arg_2));return{text:text2,options,metadata}}function _typeof6(o){return _typeof6=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o2){return typeof o2}:function(o2){return o2&&typeof Symbol=="function"&&o2.constructor===Symbol&&o2!==Symbol.prototype?"symbol":typeof o2},_typeof6(o)}function ownKeys4(e,r2){var t2=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);r2&&(o=o.filter(function(r3){return Object.getOwnPropertyDescriptor(e,r3).enumerable})),t2.push.apply(t2,o)}return t2}function _objectSpread4(e){for(var r2=1;r2<arguments.length;r2++){var t2=arguments[r2]!=null?arguments[r2]:{};r2%2?ownKeys4(Object(t2),!0).forEach(function(r3){_defineProperty4(e,r3,t2[r3])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t2)):ownKeys4(Object(t2)).forEach(function(r3){Object.defineProperty(e,r3,Object.getOwnPropertyDescriptor(t2,r3))})}return e}function _defineProperty4(e,r2,t2){return(r2=_toPropertyKey6(r2))in e?Object.defineProperty(e,r2,{value:t2,enumerable:!0,configurable:!0,writable:!0}):e[r2]=t2,e}function _toPropertyKey6(t2){var i=_toPrimitive6(t2,"string");return _typeof6(i)=="symbol"?i:i+""}function _toPrimitive6(t2,r2){if(_typeof6(t2)!="object"||!t2)return t2;var e=t2[Symbol.toPrimitive];if(e!==void 0){var i=e.call(t2,r2||"default");if(_typeof6(i)!="object")return i;throw TypeError("@@toPrimitive must return a primitive value.")}return(r2==="string"?String:Number)(t2)}function parsePhoneNumber2(text2,options,metadata){if(options&&options.defaultCountry&&!isSupportedCountry(options.defaultCountry,metadata))options=_objectSpread4(_objectSpread4({},options),{},{defaultCountry:void 0});try{return parsePhoneNumberWithError(text2,options,metadata)}catch(error){if(error instanceof ParseError3);else throw error}}function parsePhoneNumber3(){var _normalizeArguments=normalizeArguments(arguments),text2=_normalizeArguments.text,options=_normalizeArguments.options,metadata=_normalizeArguments.metadata;return parsePhoneNumber2(text2,options,metadata)}function parsePhoneNumber4(){return withMetadataArgument(parsePhoneNumber3,arguments)}function normalizeEmail2(email){if(!email)return;let e=email.trim().toLowerCase();return e===""?void 0:e}function normalizePhoneE164AR(phone){if(!phone)return;let raw=phone.trim();if(!raw)return;let parsed=parsePhoneNumber4(raw,"AR");if(parsed&&parsed.isValid())return parsed.format("E.164");return}var getAllTechnicians=async(tenantId)=>{return await db.select().from(technicianTable).where(eq(technicianTable.tenant_id,tenantId)).orderBy(technicianTable.technician_id)},getTechnicianById=async(tenantId,id)=>{return await db.query.technicianTable.findFirst({where:and(eq(technicianTable.tenant_id,tenantId),eq(technicianTable.technician_id,id))})};async function getTechniciansByFilter(tenantId,filters){return await db.select().from(technicianTable).where(and(eq(technicianTable.tenant_id,tenantId),filters.name?ilike(technicianTable.name,`%${filters.name}%`):void 0,filters.speciality?ilike(technicianTable.speciality,`%${filters.speciality}%`):void 0,filters.state?ilike(technicianTable.state,`%${filters.state}%`):void 0,filters.email?ilike(technicianTable.email,`%${filters.email}%`):void 0,filters.phone_number?ilike(technicianTable.phone_number,`%${filters.phone_number}%`):void 0,filters.is_deleted!==void 0?eq(technicianTable.is_deleted,filters.is_deleted):void 0)).orderBy(technicianTable.technician_id)}var addTechnician=async(tenantId,newTechnician)=>{let normalizedTechnician={...newTechnician,tenant_id:tenantId,name:normalizeShortString(newTechnician.name),state:normalizeShortString(newTechnician.state),email:normalizeEmail2(newTechnician.email),phone_number:normalizePhoneE164AR(newTechnician.phone_number)};return await db.insert(technicianTable).values(normalizedTechnician).returning()},updateTechnician=async(tenantId,technician_id,technician_upd)=>{let normalizedUpd={...technician_upd,name:technician_upd.name?normalizeShortString(technician_upd.name):void 0,state:technician_upd.state?normalizeShortString(technician_upd.state):void 0,email:technician_upd.email!==void 0?normalizeEmail2(technician_upd.email):void 0,phone_number:technician_upd.phone_number!==void 0?normalizePhoneE164AR(technician_upd.phone_number):void 0};return await db.update(technicianTable).set(normalizedUpd).where(and(eq(technicianTable.tenant_id,tenantId),eq(technicianTable.technician_id,technician_id))).returning()};async function softDeleteTechnician(tenantId,id){return(await db.update(technicianTable).set({is_deleted:!0}).where(and(eq(technicianTable.tenant_id,tenantId),eq(technicianTable.technician_id,id))).returning()).length>0}var technicianController=new Elysia({prefix:"/technician"}).get("/",()=>({message:"Technician endpoint"})).get("/all",protectedController(async(ctx)=>{let{tenantId,query}=ctx;if(query.name||query.speciality||query.state||query.email||query.phone_number||query.is_deleted)return await getTechniciansByFilter(tenantId,{name:query.name,speciality:query.speciality,state:query.state,email:query.email,phone_number:query.phone_number,is_deleted:query.is_deleted===void 0?void 0:query.is_deleted==="true"});return await getAllTechnicians(tenantId)}),{detail:{summary:"Get all technicians in DB (scoped by tenant)",tags:["technicians"]}}).get("/:id",protectedController(async(ctx)=>{let tenantId=ctx.tenantId,techId=Number(ctx.params.id);return await getTechnicianById(tenantId,techId)}),{detail:{summary:"Get technician details by ID (scoped by tenant)",tags:["technicians"]}}).post("/",protectedController(async(ctx)=>{let{tenantId,body}=ctx,newTechnician={tenant_id:tenantId,name:body.name,...body.email!==void 0&&{email:body.email},...body.phone_number!==void 0&&{phone_number:body.phone_number},speciality:body.speciality,state:body.state},result2=await addTechnician(tenantId,newTechnician);return ctx.set.status=201,result2}),{body:t.Object({...technicianInsertDTO.properties}),detail:{summary:"Insert a new technician (scoped by tenant)",tags:["technicians"]}}).put("/:id",protectedController(async(ctx)=>{let tenantId=ctx.tenantId,techId=Number(ctx.params.id),body=ctx.body,updTechnician={name:body.name,...body.email!==void 0&&{email:body.email},...body.phone_number!==void 0&&{phone_number:body.phone_number},speciality:body.speciality,state:body.state},result2=await updateTechnician(tenantId,techId,updTechnician);return ctx.set.status=200,result2}),{body:t.Object({...technicianUpdateDTO.properties}),detail:{summary:"Update a technician (scoped by tenant)",tags:["technicians"]}}).delete("/:id",protectedController(async(ctx)=>{let tenantId=ctx.tenantId,techId=Number(ctx.params.id),ok=await softDeleteTechnician(tenantId,techId);return ctx.set.status=ok?200:404,ok}));async function getPhonesByFilter(tenantId,filters){return await db.select().from(phoneTable).where(and(eq(phoneTable.tenant_id,tenantId),filters.device?or(ilike(phoneTable.name,`%${filters.device}%`),ilike(phoneTable.brand,`%${filters.device}%`)):void 0,filters.imei?eq(phoneTable.imei,filters.imei):void 0,filters.color?ilike(phoneTable.color,`%${filters.color}%`):void 0,filters.storage_capacity?eq(phoneTable.storage_capacity,Number(filters.storage_capacity)):void 0,filters.battery_health?gte(phoneTable.battery_health,Number(filters.battery_health)):void 0,filters.category?eq(phoneTable.category,filters.category):void 0,filters.device_type?eq(phoneTable.device_type,filters.device_type):void 0,filters.trade_in!==void 0?eq(phoneTable.trade_in,filters.trade_in==="true"):void 0,filters.sold!==void 0?eq(phoneTable.sold,filters.sold==="true"):void 0,filters.in_repair!==void 0?eq(phoneTable.in_repair,filters.in_repair==="true"):void 0,filters.is_deleted!==void 0?eq(phoneTable.is_deleted,filters.is_deleted):void 0)).orderBy(phoneTable.device_id)}var getAllPhones=async(tenantId)=>{return await db.select().from(phoneTable).where(eq(phoneTable.tenant_id,tenantId)).orderBy(phoneTable.device_id)},getPhoneById=async(tenantId,id)=>{return await db.query.phoneTable.findFirst({where:and(eq(phoneTable.tenant_id,tenantId),eq(phoneTable.device_id,id))})},addPhone=async(newPhone)=>{let normalizedPhone={...newPhone,name:normalizeShortString(newPhone.name),brand:normalizeShortString(newPhone.brand),device_type:normalizeShortString(newPhone.device_type),category:normalizeShortString(newPhone.category),color:newPhone.color?normalizeShortString(newPhone.color):void 0,imei:newPhone.imei.trim(),price:newPhone.price,buy_cost:newPhone.buy_cost,deposit:newPhone.deposit};return await db.insert(phoneTable).values(normalizedPhone).returning()};async function updatePhone(tenantId,device_id,phone_upd){let normalizedPhone={...phone_upd,name:normalizeShortString(phone_upd.name),brand:normalizeShortString(phone_upd.brand),device_type:normalizeShortString(phone_upd.device_type),category:normalizeShortString(phone_upd.category),color:phone_upd.color?normalizeShortString(phone_upd.color):void 0,imei:phone_upd.imei.trim(),price:phone_upd.price,buy_cost:phone_upd.buy_cost,deposit:phone_upd.deposit};return await db.update(phoneTable).set(normalizedPhone).where(and(eq(phoneTable.tenant_id,tenantId),eq(phoneTable.device_id,device_id))).returning()}async function softDeletePhone(tenantId,id){return(await db.update(phoneTable).set({is_deleted:!0}).where(and(eq(phoneTable.tenant_id,tenantId),eq(phoneTable.device_id,id))).returning()).length>0}var getStockInvestment=async(tenantId,display,fx)=>{let rows=await db.select({buy_cost:sql`COALESCE(${phoneTable.buy_cost}, 0)`,currency:phoneTable.currency_buy}).from(phoneTable).where(and(eq(phoneTable.tenant_id,tenantId),eq(phoneTable.is_deleted,!1),eq(phoneTable.sold,!1))),total=0;for(let r2 of rows){let cost=Number(r2.buy_cost??0);if(!Number.isFinite(cost))continue;let cur=isCurrency(r2.currency)?r2.currency:"ARS";total+=convert2(cost,cur,display,fx.ratesToARS)}return round2(total)},getStockInvestmentBreakdown=async(tenantId)=>{return(await db.select({device_id:phoneTable.device_id,device_name:phoneTable.name,buy_cost:sql`COALESCE(${phoneTable.buy_cost}, 0)`,phone_currency:phoneTable.currency_buy}).from(phoneTable).where(and(eq(phoneTable.tenant_id,tenantId),eq(phoneTable.is_deleted,!1),eq(phoneTable.sold,!1))).orderBy(sql`COALESCE(${phoneTable.buy_cost}, 0) DESC`)).map((r2)=>{let costFormatted=fmtMoney(Number(r2.buy_cost),r2.phone_currency);return{device_id:r2.device_id,device_name:r2.device_name,buy_cost:costFormatted}})};var phoneController=new Elysia({prefix:"/phone"}).get("/",()=>({message:"Phone endpoint"})).get("/all",protectedController(async(ctx)=>{let{tenantId,query}=ctx;if(query.device||query.imei||query.color||query.storage_capacity||query.battery_health||query.category||query.device_type||query.trade_in||query.sold||query.is_deleted||query.in_repair)return await getPhonesByFilter(tenantId,{device:query.device,imei:query.imei,color:query.color,storage_capacity:query.storage_capacity,battery_health:query.battery_health,category:query.category,device_type:query.device_type,trade_in:query.trade_in,sold:query.sold,in_repair:query.in_repair,is_deleted:query.is_deleted===void 0?void 0:query.is_deleted==="true"});return await getAllPhones(tenantId)}),{detail:{summary:"Get all phones in DB (scoped by tenant)",tags:["phones"]}}).get("/:id",protectedController(async(ctx)=>{let phoneId=Number(ctx.params.id);return await getPhoneById(ctx.tenantId,phoneId)}),{detail:{summary:"Get phone details by ID (scoped by tenant)",tags:["phones"]}}).post("/",protectedController(async(ctx)=>{let{tenantId,body}=ctx,newPhone={tenant_id:tenantId,datetime:new Date(body.datetime),name:body.name,brand:body.brand,imei:body.imei,device_type:body.device_type,...body.battery_health!==void 0&&{battery_health:body.battery_health},...body.storage_capacity!==void 0&&{storage_capacity:body.storage_capacity},...body.color&&{color:body.color},category:body.category,price:body.price,currency_sale:body.currency_sale,buy_cost:body.buy_cost,currency_buy:body.currency_buy,deposit:body.deposit,...body.sold!==void 0&&{sold:body.sold},...body.trade_in!==void 0&&{trade_in:body.trade_in}},result2=await addPhone(newPhone);return ctx.set.status=201,result2}),{body:t.Object({...phoneInsertDTO.properties,datetime:t.String({format:"date-time"})}),detail:{summary:"Insert a new phone (scoped by tenant)",tags:["phones"]}}).put("/:id",protectedController(async(ctx)=>{let tenantId=ctx.tenantId,phoneId=Number(ctx.params.id),body=ctx.body,updPhone={datetime:new Date(body.datetime),name:body.name,brand:body.brand,imei:body.imei,device_type:body.device_type,...body.battery_health!==void 0&&{battery_health:body.battery_health},...body.storage_capacity!==void 0&&{storage_capacity:body.storage_capacity},...body.color&&{color:body.color},category:body.category,price:body.price,currency_sale:body.currency_sale,buy_cost:body.buy_cost,currency_buy:body.currency_buy,deposit:body.deposit,...body.sold!==void 0&&{sold:body.sold},...body.trade_in!==void 0&&{trade_in:body.trade_in}},result2=await updatePhone(tenantId,phoneId,updPhone);return ctx.set.status=200,result2}),{body:t.Object({...phoneUpdateDTO.properties,datetime:t.String({format:"date-time"})}),detail:{summary:"Update a phone (scoped by tenant)",tags:["phones"]}}).delete("/:id",protectedController(async(ctx)=>{let phoneId=Number(ctx.params.id),ok=await softDeletePhone(ctx.tenantId,phoneId);return ctx.set.status=ok?200:404,ok})).get("/stock-investment",protectedController(async(ctx)=>{let display=ctx.tenantSettings.display_currency??"ARS",fx=await getFxSnapshotVenta();return await getStockInvestment(ctx.tenantId,display,fx)})).get("/stock-investment-breakdown",protectedController(async(ctx)=>{return await getStockInvestmentBreakdown(ctx.tenantId)}));async function assertTenantClient(tenantId,clientId){if(!(await db.select({id:clientTable.client_id}).from(clientTable).where(and(eq(clientTable.tenant_id,tenantId),eq(clientTable.client_id,clientId))).limit(1))[0])throw Error("INVALID_CLIENT")}async function assertTenantTechnician(tenantId,technicianId){if(!(await db.select({id:technicianTable.technician_id}).from(technicianTable).where(and(eq(technicianTable.tenant_id,tenantId),eq(technicianTable.technician_id,technicianId))).limit(1))[0])throw Error("INVALID_TECHNICIAN")}async function assertTenantDevice(tenantId,deviceId){if(!(await db.select({id:phoneTable.device_id}).from(phoneTable).where(and(eq(phoneTable.tenant_id,tenantId),eq(phoneTable.device_id,deviceId))).limit(1))[0])throw Error("INVALID_DEVICE")}var getRepairsByFilter=async(tenantId,filters)=>{return await db.select().from(repairTable).where(and(eq(repairTable.tenant_id,tenantId),filters.date?eq(sql`date(${repairTable.datetime})`,filters.date):void 0,filters.repair_state?eq(repairTable.repair_state,filters.repair_state):void 0,filters.priority?eq(repairTable.priority,filters.priority):void 0,filters.client_id?eq(repairTable.client_id,Number(filters.client_id)):void 0,filters.technician_id?eq(repairTable.technician_id,Number(filters.technician_id)):void 0,filters.device_id?eq(repairTable.device_id,Number(filters.device_id)):void 0,filters.cost_min?gte(repairTable.client_cost,filters.cost_min):void 0,filters.cost_max?lte(repairTable.client_cost,filters.cost_max):void 0,filters.is_deleted!==void 0?eq(repairTable.is_deleted,filters.is_deleted):void 0)).orderBy(repairTable.datetime)},getAllRepairs=async(tenantId)=>{return await db.select().from(repairTable).where(eq(repairTable.tenant_id,tenantId)).orderBy(repairTable.repair_id)},addRepair=async(tenantId,newRepair)=>{await assertTenantClient(tenantId,newRepair.client_id),await assertTenantTechnician(tenantId,newRepair.technician_id),await assertTenantDevice(tenantId,newRepair.device_id);let normalizedRepair={...newRepair,tenant_id:tenantId,repair_state:normalizeShortString(newRepair.repair_state),priority:normalizeShortString(newRepair.priority),description:newRepair.description.trim(),diagnostic:newRepair.diagnostic?newRepair.diagnostic.trim():void 0,client_cost:newRepair.client_cost,internal_cost:newRepair.internal_cost};return await db.transaction(async(tx)=>{let inserted=await tx.insert(repairTable).values(normalizedRepair).returning();if((await tx.update(phoneTable).set({in_repair:!0}).where(and(eq(phoneTable.tenant_id,tenantId),eq(phoneTable.device_id,newRepair.device_id))).returning({device_id:phoneTable.device_id})).length===0)throw Error("DEVICE_UPDATE_FAILED");return inserted})},updateRepair=async(tenantId,repair_id,repair_upd)=>{if(repair_upd.client_id!==void 0)await assertTenantClient(tenantId,repair_upd.client_id);if(repair_upd.technician_id!==void 0)await assertTenantTechnician(tenantId,repair_upd.technician_id);if(repair_upd.device_id!==void 0)await assertTenantDevice(tenantId,repair_upd.device_id);let normalizedUpd={...repair_upd,repair_state:repair_upd.repair_state?normalizeShortString(repair_upd.repair_state):void 0,priority:repair_upd.priority?normalizeShortString(repair_upd.priority):void 0,description:repair_upd.description?repair_upd.description.trim():void 0,diagnostic:repair_upd.diagnostic?repair_upd.diagnostic.trim():void 0};return await db.transaction(async(tx)=>{let prev=await tx.select({device_id:repairTable.device_id,repair_state:repairTable.repair_state}).from(repairTable).where(and(eq(repairTable.tenant_id,tenantId),eq(repairTable.repair_id,repair_id))).limit(1);if(!prev[0])throw Error("REPAIR_NOT_FOUND");let prevState=normalizeShortString(String(prev[0].repair_state??"")),nextState=normalizedUpd.repair_state!==void 0?normalizedUpd.repair_state:prevState,targetDeviceId=normalizedUpd.device_id??prev[0].device_id,updated=await tx.update(repairTable).set(normalizedUpd).where(and(eq(repairTable.tenant_id,tenantId),eq(repairTable.repair_id,repair_id))).returning();if(nextState==="entregado"&&prevState!=="entregado"){if((await tx.update(phoneTable).set({in_repair:!1}).where(and(eq(phoneTable.tenant_id,tenantId),eq(phoneTable.device_id,targetDeviceId))).returning({device_id:phoneTable.device_id})).length===0)throw Error("DEVICE_UPDATE_FAILED")}return updated})};async function softDeleteRepair(tenantId,id){return(await db.update(repairTable).set({is_deleted:!0}).where(and(eq(repairTable.tenant_id,tenantId),eq(repairTable.repair_id,id))).returning()).length>0}var repairController=new Elysia({prefix:"/repair"}).get("/",()=>({message:"Repair endpoint"})).get("/all",protectedController(async(ctx)=>{let{tenantId,query}=ctx;if(query.date||query.repair_state||query.priority||query.client_id||query.technician_id||query.device_id||query.cost_min||query.cost_max||query.is_deleted)return await getRepairsByFilter(tenantId,{date:query.date,repair_state:query.repair_state,priority:query.priority,client_id:query.client_id,technician_id:query.technician_id,device_id:query.device_id,cost_min:query.cost_min,cost_max:query.cost_max,is_deleted:query.is_deleted===void 0?void 0:query.is_deleted==="true"});return await getAllRepairs(tenantId)}),{detail:{summary:"Get all repairs in DB (scoped by tenant)",tags:["repairs"]}}).post("/",protectedController(async(ctx)=>{let{tenantId,body}=ctx,newRepair={datetime:body.datetime?new Date(body.datetime):void 0,repair_state:body.repair_state,priority:body.priority,description:body.description,...body.diagnostic&&{diagnostic:body.diagnostic},client_cost:body.client_cost,internal_cost:body.internal_cost,client_id:body.client_id,technician_id:body.technician_id,device_id:body.device_id};try{let result2=await addRepair(tenantId,newRepair);return ctx.set.status=201,result2}catch(err){if(err?.message==="INVALID_CLIENT"||err?.message==="INVALID_TECHNICIAN"||err?.message==="INVALID_DEVICE")return ctx.set.status=400,{error:err.message};throw err}}),{body:t.Object({...repairInsertDTO.properties,datetime:t.String({format:"date-time"})}),detail:{summary:"Insert a new repair (scoped by tenant)",tags:["repairs"]}}).put("/:id",protectedController(async(ctx)=>{let tenantId=ctx.tenantId,repairId=Number(ctx.params.id),body=ctx.body,updRepair={datetime:body.datetime?new Date(body.datetime):void 0,repair_state:body.repair_state,priority:body.priority,description:body.description,...body.diagnostic&&{diagnostic:body.diagnostic},client_cost:body.client_cost,internal_cost:body.internal_cost,client_id:body.client_id,technician_id:body.technician_id,device_id:body.device_id};try{let result2=await updateRepair(tenantId,repairId,updRepair);return ctx.set.status=200,result2}catch(err){if(err?.message==="INVALID_CLIENT"||err?.message==="INVALID_TECHNICIAN"||err?.message==="INVALID_DEVICE")return ctx.set.status=400,{error:err.message};throw err}}),{body:t.Object({...repairUpdateDTO.properties,datetime:t.String({format:"date-time"})}),detail:{summary:"Update a repair (scoped by tenant)",tags:["repairs"]}}).delete("/:id",protectedController(async(ctx)=>{let repairId=Number(ctx.params.id),ok=await softDeleteRepair(ctx.tenantId,repairId);return ctx.set.status=ok?200:404,ok}));var import_protocol_http=__toESM(require_dist_cjs2(),1);function addExpectContinueMiddleware(options){return(next)=>async(args)=>{let{request}=args;if(options.expectContinueHeader!==!1&&import_protocol_http.HttpRequest.isInstance(request)&&request.body&&options.runtime==="node"&&options.requestHandler?.constructor?.name!=="FetchHttpHandler"){let sendHeader=!0;if(typeof options.expectContinueHeader==="number")try{sendHeader=(Number(request.headers?.["content-length"])??options.bodyLengthChecker?.(request.body)??1/0)>=options.expectContinueHeader}catch(e){}else sendHeader=!!options.expectContinueHeader;if(sendHeader)request.headers.Expect="100-continue"}return next({...args,request})}}var addExpectContinueMiddlewareOptions={step:"build",tags:["SET_EXPECT_HEADER","EXPECT_HEADER"],name:"addExpectContinueMiddleware",override:!0},getAddExpectContinuePlugin=(options)=>({applyToStack:(clientStack)=>{clientStack.add(addExpectContinueMiddleware(options),addExpectContinueMiddlewareOptions)}});var RequestChecksumCalculation={WHEN_SUPPORTED:"WHEN_SUPPORTED",WHEN_REQUIRED:"WHEN_REQUIRED"},DEFAULT_REQUEST_CHECKSUM_CALCULATION=RequestChecksumCalculation.WHEN_SUPPORTED,ResponseChecksumValidation={WHEN_SUPPORTED:"WHEN_SUPPORTED",WHEN_REQUIRED:"WHEN_REQUIRED"},DEFAULT_RESPONSE_CHECKSUM_VALIDATION=RequestChecksumCalculation.WHEN_SUPPORTED,ChecksumAlgorithm;(function(ChecksumAlgorithm2){ChecksumAlgorithm2.MD5="MD5",ChecksumAlgorithm2.CRC32="CRC32",ChecksumAlgorithm2.CRC32C="CRC32C",ChecksumAlgorithm2.CRC64NVME="CRC64NVME",ChecksumAlgorithm2.SHA1="SHA1",ChecksumAlgorithm2.SHA256="SHA256"})(ChecksumAlgorithm||(ChecksumAlgorithm={}));var ChecksumLocation;(function(ChecksumLocation2){ChecksumLocation2.HEADER="header",ChecksumLocation2.TRAILER="trailer"})(ChecksumLocation||(ChecksumLocation={}));var DEFAULT_CHECKSUM_ALGORITHM=ChecksumAlgorithm.CRC32;var SelectorType;(function(SelectorType2){SelectorType2.ENV="env",SelectorType2.CONFIG="shared config entry"})(SelectorType||(SelectorType={}));var stringUnionSelector=(obj,key,union2,type)=>{if(!(key in obj))return;let value=obj[key].toUpperCase();if(!Object.values(union2).includes(value))throw TypeError(`Cannot load ${type} '${key}'. Expected one of ${Object.values(union2)}, got '${obj[key]}'.`);return value};var ENV_REQUEST_CHECKSUM_CALCULATION="AWS_REQUEST_CHECKSUM_CALCULATION",CONFIG_REQUEST_CHECKSUM_CALCULATION="request_checksum_calculation",NODE_REQUEST_CHECKSUM_CALCULATION_CONFIG_OPTIONS={environmentVariableSelector:(env3)=>stringUnionSelector(env3,ENV_REQUEST_CHECKSUM_CALCULATION,RequestChecksumCalculation,SelectorType.ENV),configFileSelector:(profile)=>stringUnionSelector(profile,CONFIG_REQUEST_CHECKSUM_CALCULATION,RequestChecksumCalculation,SelectorType.CONFIG),default:DEFAULT_REQUEST_CHECKSUM_CALCULATION};var ENV_RESPONSE_CHECKSUM_VALIDATION="AWS_RESPONSE_CHECKSUM_VALIDATION",CONFIG_RESPONSE_CHECKSUM_VALIDATION="response_checksum_validation",NODE_RESPONSE_CHECKSUM_VALIDATION_CONFIG_OPTIONS={environmentVariableSelector:(env3)=>stringUnionSelector(env3,ENV_RESPONSE_CHECKSUM_VALIDATION,ResponseChecksumValidation,SelectorType.ENV),configFileSelector:(profile)=>stringUnionSelector(profile,CONFIG_RESPONSE_CHECKSUM_VALIDATION,ResponseChecksumValidation,SelectorType.CONFIG),default:DEFAULT_RESPONSE_CHECKSUM_VALIDATION};var import_core6=__toESM(require_dist_cjs23(),1),import_protocol_http2=__toESM(require_dist_cjs2(),1),import_util_stream=__toESM(require_dist_cjs14(),1);var CLIENT_SUPPORTED_ALGORITHMS=[ChecksumAlgorithm.CRC32,ChecksumAlgorithm.CRC32C,ChecksumAlgorithm.CRC64NVME,ChecksumAlgorithm.SHA1,ChecksumAlgorithm.SHA256],PRIORITY_ORDER_ALGORITHMS=[ChecksumAlgorithm.SHA256,ChecksumAlgorithm.SHA1,ChecksumAlgorithm.CRC32,ChecksumAlgorithm.CRC32C,ChecksumAlgorithm.CRC64NVME];var getChecksumAlgorithmForRequest=(input,{requestChecksumRequired,requestAlgorithmMember,requestChecksumCalculation})=>{if(!requestAlgorithmMember)return requestChecksumCalculation===RequestChecksumCalculation.WHEN_SUPPORTED||requestChecksumRequired?DEFAULT_CHECKSUM_ALGORITHM:void 0;if(!input[requestAlgorithmMember])return;let checksumAlgorithm=input[requestAlgorithmMember];if(!CLIENT_SUPPORTED_ALGORITHMS.includes(checksumAlgorithm))throw Error(`The checksum algorithm "${checksumAlgorithm}" is not supported by the client. Select one of ${CLIENT_SUPPORTED_ALGORITHMS}.`);return checksumAlgorithm};var getChecksumLocationName=(algorithm)=>algorithm===ChecksumAlgorithm.MD5?"content-md5":`x-amz-checksum-${algorithm.toLowerCase()}`;var hasHeader=(header,headers)=>{let soughtHeader=header.toLowerCase();for(let headerName of Object.keys(headers))if(soughtHeader===headerName.toLowerCase())return!0;return!1};var hasHeaderWithPrefix=(headerPrefix,headers)=>{let soughtHeaderPrefix=headerPrefix.toLowerCase();for(let headerName of Object.keys(headers))if(headerName.toLowerCase().startsWith(soughtHeaderPrefix))return!0;return!1};var import_is_array_buffer=__toESM(require_dist_cjs5(),1),isStreaming=(body)=>body!==void 0&&typeof body!=="string"&&!ArrayBuffer.isView(body)&&!import_is_array_buffer.isArrayBuffer(body);var import_tslib=__toESM(require_tslib(),1),{__extends,__assign,__rest,__decorate,__param,__esDecorate,__runInitializers,__propKey,__setFunctionName,__metadata,__awaiter,__generator,__exportStar,__createBinding,__values,__read,__spread,__spreadArrays,__spreadArray,__await,__asyncGenerator,__asyncDelegator,__asyncValues,__makeTemplateObject,__importStar,__importDefault,__classPrivateFieldGet:__classPrivateFieldGet2,__classPrivateFieldSet:__classPrivateFieldSet2,__classPrivateFieldIn,__addDisposableResource,__disposeResources,__rewriteRelativeImportExtension}=import_tslib.default;import{Buffer as Buffer2}from"buffer";var fromString=(input,encoding)=>{if(typeof input!=="string")throw TypeError(`The "input" argument must be of type string. Received type ${typeof input} (${input})`);return encoding?Buffer2.from(input,encoding):Buffer2.from(input)};var fromUtf8=(input)=>{let buf=fromString(input,"utf8");return new Uint8Array(buf.buffer,buf.byteOffset,buf.byteLength/Uint8Array.BYTES_PER_ELEMENT)};var fromUtf83=typeof Buffer<"u"&&Buffer.from?function(input){return Buffer.from(input,"utf8")}:fromUtf8;function convertToBuffer(data){if(data instanceof Uint8Array)return data;if(typeof data==="string")return fromUtf83(data);if(ArrayBuffer.isView(data))return new Uint8Array(data.buffer,data.byteOffset,data.byteLength/Uint8Array.BYTES_PER_ELEMENT);return new Uint8Array(data)}function isEmptyData(data){if(typeof data==="string")return data.length===0;return data.byteLength===0}function numToUint8(num){return new Uint8Array([(num&4278190080)>>24,(num&16711680)>>16,(num&65280)>>8,num&255])}function uint32ArrayFrom(a_lookUpTable){if(!Uint32Array.from){var return_array=new Uint32Array(a_lookUpTable.length),a_index=0;while(a_index<a_lookUpTable.length)return_array[a_index]=a_lookUpTable[a_index],a_index+=1;return return_array}return Uint32Array.from(a_lookUpTable)}var AwsCrc32c=function(){function AwsCrc32c2(){this.crc32c=new Crc32c}return AwsCrc32c2.prototype.update=function(toHash){if(isEmptyData(toHash))return;this.crc32c.update(convertToBuffer(toHash))},AwsCrc32c2.prototype.digest=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,numToUint8(this.crc32c.digest())]})})},AwsCrc32c2.prototype.reset=function(){this.crc32c=new Crc32c},AwsCrc32c2}();var Crc32c=function(){function Crc32c2(){this.checksum=4294967295}return Crc32c2.prototype.update=function(data){var e_1,_a;try{for(var data_1=__values(data),data_1_1=data_1.next();!data_1_1.done;data_1_1=data_1.next()){var byte2=data_1_1.value;this.checksum=this.checksum>>>8^lookupTable[(this.checksum^byte2)&255]}}catch(e_1_1){e_1={error:e_1_1}}finally{try{if(data_1_1&&!data_1_1.done&&(_a=data_1.return))_a.call(data_1)}finally{if(e_1)throw e_1.error}}return this},Crc32c2.prototype.digest=function(){return(this.checksum^4294967295)>>>0},Crc32c2}();var a_lookupTable=[0,4067132163,3778769143,324072436,3348797215,904991772,648144872,3570033899,2329499855,2024987596,1809983544,2575936315,1296289744,3207089363,2893594407,1578318884,274646895,3795141740,4049975192,51262619,3619967088,632279923,922689671,3298075524,2592579488,1760304291,2075979607,2312596564,1562183871,2943781820,3156637768,1313733451,549293790,3537243613,3246849577,871202090,3878099393,357341890,102525238,4101499445,2858735121,1477399826,1264559846,3107202533,1845379342,2677391885,2361733625,2125378298,820201905,3263744690,3520608582,598981189,4151959214,85089709,373468761,3827903834,3124367742,1213305469,1526817161,2842354314,2107672161,2412447074,2627466902,1861252501,1098587580,3004210879,2688576843,1378610760,2262928035,1955203488,1742404180,2511436119,3416409459,969524848,714683780,3639785095,205050476,4266873199,3976438427,526918040,1361435347,2739821008,2954799652,1114974503,2529119692,1691668175,2005155131,2247081528,3690758684,697762079,986182379,3366744552,476452099,3993867776,4250756596,255256311,1640403810,2477592673,2164122517,1922457750,2791048317,1412925310,1197962378,3037525897,3944729517,427051182,170179418,4165941337,746937522,3740196785,3451792453,1070968646,1905808397,2213795598,2426610938,1657317369,3053634322,1147748369,1463399397,2773627110,4215344322,153784257,444234805,3893493558,1021025245,3467647198,3722505002,797665321,2197175160,1889384571,1674398607,2443626636,1164749927,3070701412,2757221520,1446797203,137323447,4198817972,3910406976,461344835,3484808360,1037989803,781091935,3705997148,2460548119,1623424788,1939049696,2180517859,1429367560,2807687179,3020495871,1180866812,410100952,3927582683,4182430767,186734380,3756733383,763408580,1053836080,3434856499,2722870694,1344288421,1131464017,2971354706,1708204729,2545590714,2229949006,1988219213,680717673,3673779818,3383336350,1002577565,4010310262,493091189,238226049,4233660802,2987750089,1082061258,1395524158,2705686845,1972364758,2279892693,2494862625,1725896226,952904198,3399985413,3656866545,731699698,4283874585,222117402,510512622,3959836397,3280807620,837199303,582374963,3504198960,68661723,4135334616,3844915500,390545967,1230274059,3141532936,2825850620,1510247935,2395924756,2091215383,1878366691,2644384480,3553878443,565732008,854102364,3229815391,340358836,3861050807,4117890627,119113024,1493875044,2875275879,3090270611,1247431312,2660249211,1828433272,2141937292,2378227087,3811616794,291187481,34330861,4032846830,615137029,3603020806,3314634738,939183345,1776939221,2609017814,2295496738,2058945313,2926798794,1545135305,1330124605,3173225534,4084100981,17165430,307568514,3762199681,888469610,3332340585,3587147933,665062302,2042050490,2346497209,2559330125,1793573966,3190661285,1279665062,1595330642,2910671697],lookupTable=uint32ArrayFrom(a_lookupTable);var generateCRC64NVMETable=()=>{let tables=[,,,,,,,,];for(let slice=0;slice<8;slice++){let table=Array(512);for(let i=0;i<256;i++){let crc=BigInt(i);for(let j=0;j<8*(slice+1);j++)if(crc&1n)crc=crc>>1n^0x9a6c9329ac4bc9b5n;else crc=crc>>1n;table[i*2]=Number(crc>>32n&0xffffffffn),table[i*2+1]=Number(crc&0xffffffffn)}tables[slice]=new Uint32Array(table)}return tables},CRC64_NVME_REVERSED_TABLE,t0,t1,t2,t3,t4,t5,t6,t7,ensureTablesInitialized=()=>{if(!CRC64_NVME_REVERSED_TABLE)CRC64_NVME_REVERSED_TABLE=generateCRC64NVMETable(),[t0,t1,t2,t3,t4,t5,t6,t7]=CRC64_NVME_REVERSED_TABLE};class Crc64Nvme{c1=0;c2=0;constructor(){ensureTablesInitialized(),this.reset()}update(data){let len=data.length,i=0,crc1=this.c1,crc2=this.c2;while(i+8<=len){let idx0=((crc2^data[i++])&255)<<1,idx1=((crc2>>>8^data[i++])&255)<<1,idx2=((crc2>>>16^data[i++])&255)<<1,idx3=((crc2>>>24^data[i++])&255)<<1,idx4=((crc1^data[i++])&255)<<1,idx5=((crc1>>>8^data[i++])&255)<<1,idx6=((crc1>>>16^data[i++])&255)<<1,idx7=((crc1>>>24^data[i++])&255)<<1;crc1=t7[idx0]^t6[idx1]^t5[idx2]^t4[idx3]^t3[idx4]^t2[idx5]^t1[idx6]^t0[idx7],crc2=t7[idx0+1]^t6[idx1+1]^t5[idx2+1]^t4[idx3+1]^t3[idx4+1]^t2[idx5+1]^t1[idx6+1]^t0[idx7+1]}while(i<len){let idx=((crc2^data[i])&255)<<1;crc2=(crc2>>>8|(crc1&255)<<24)>>>0,crc1=crc1>>>8^t0[idx],crc2^=t0[idx+1],i++}this.c1=crc1,this.c2=crc2}async digest(){let c1=this.c1^4294967295,c2=this.c2^4294967295;return new Uint8Array([c1>>>24,c1>>>16&255,c1>>>8&255,c1&255,c2>>>24,c2>>>16&255,c2>>>8&255,c2&255])}reset(){this.c1=4294967295,this.c2=4294967295}}var crc64NvmeCrtContainer={CrtCrc64Nvme:null};var AwsCrc32=function(){function AwsCrc322(){this.crc32=new Crc32}return AwsCrc322.prototype.update=function(toHash){if(isEmptyData(toHash))return;this.crc32.update(convertToBuffer(toHash))},AwsCrc322.prototype.digest=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return[2,numToUint8(this.crc32.digest())]})})},AwsCrc322.prototype.reset=function(){this.crc32=new Crc32},AwsCrc322}();var Crc32=function(){function Crc322(){this.checksum=4294967295}return Crc322.prototype.update=function(data){var e_1,_a;try{for(var data_1=__values(data),data_1_1=data_1.next();!data_1_1.done;data_1_1=data_1.next()){var byte2=data_1_1.value;this.checksum=this.checksum>>>8^lookupTable2[(this.checksum^byte2)&255]}}catch(e_1_1){e_1={error:e_1_1}}finally{try{if(data_1_1&&!data_1_1.done&&(_a=data_1.return))_a.call(data_1)}finally{if(e_1)throw e_1.error}}return this},Crc322.prototype.digest=function(){return(this.checksum^4294967295)>>>0},Crc322}();var a_lookUpTable=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918000,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],lookupTable2=uint32ArrayFrom(a_lookUpTable);import*as zlib from"zlib";class NodeCrc32{checksum=0;update(data){this.checksum=zlib.crc32(data,this.checksum)}async digest(){return numToUint8(this.checksum)}reset(){this.checksum=0}}var getCrc32ChecksumAlgorithmFunction=()=>{if(typeof zlib.crc32>"u")return AwsCrc32;return NodeCrc32};var selectChecksumAlgorithmFunction=(checksumAlgorithm,config)=>{switch(checksumAlgorithm){case ChecksumAlgorithm.MD5:return config.md5;case ChecksumAlgorithm.CRC32:return getCrc32ChecksumAlgorithmFunction();case ChecksumAlgorithm.CRC32C:return AwsCrc32c;case ChecksumAlgorithm.CRC64NVME:if(typeof crc64NvmeCrtContainer.CrtCrc64Nvme!=="function")return Crc64Nvme;return crc64NvmeCrtContainer.CrtCrc64Nvme;case ChecksumAlgorithm.SHA1:return config.sha1;case ChecksumAlgorithm.SHA256:return config.sha256;default:throw Error(`Unsupported checksum algorithm: ${checksumAlgorithm}`)}};var import_util_utf82=__toESM(require_dist_cjs7(),1),stringHasher=(checksumAlgorithmFn,body)=>{let hash3=new checksumAlgorithmFn;return hash3.update(import_util_utf82.toUint8Array(body||"")),hash3.digest()};var flexibleChecksumsMiddlewareOptions={name:"flexibleChecksumsMiddleware",step:"build",tags:["BODY_CHECKSUM"],override:!0},flexibleChecksumsMiddleware=(config,middlewareConfig)=>(next,context)=>async(args)=>{if(!import_protocol_http2.HttpRequest.isInstance(args.request))return next(args);if(hasHeaderWithPrefix("x-amz-checksum-",args.request.headers))return next(args);let{request,input}=args,{body:requestBody,headers}=request,{base64Encoder,streamHasher}=config,{requestChecksumRequired,requestAlgorithmMember}=middlewareConfig,requestChecksumCalculation=await config.requestChecksumCalculation(),requestAlgorithmMemberName=requestAlgorithmMember?.name,requestAlgorithmMemberHttpHeader=requestAlgorithmMember?.httpHeader;if(requestAlgorithmMemberName&&!input[requestAlgorithmMemberName]){if(requestChecksumCalculation===RequestChecksumCalculation.WHEN_SUPPORTED||requestChecksumRequired){if(input[requestAlgorithmMemberName]=DEFAULT_CHECKSUM_ALGORITHM,requestAlgorithmMemberHttpHeader)headers[requestAlgorithmMemberHttpHeader]=DEFAULT_CHECKSUM_ALGORITHM}}let checksumAlgorithm=getChecksumAlgorithmForRequest(input,{requestChecksumRequired,requestAlgorithmMember:requestAlgorithmMember?.name,requestChecksumCalculation}),updatedBody=requestBody,updatedHeaders=headers;if(checksumAlgorithm){switch(checksumAlgorithm){case ChecksumAlgorithm.CRC32:import_core6.setFeature(context,"FLEXIBLE_CHECKSUMS_REQ_CRC32","U");break;case ChecksumAlgorithm.CRC32C:import_core6.setFeature(context,"FLEXIBLE_CHECKSUMS_REQ_CRC32C","V");break;case ChecksumAlgorithm.CRC64NVME:import_core6.setFeature(context,"FLEXIBLE_CHECKSUMS_REQ_CRC64","W");break;case ChecksumAlgorithm.SHA1:import_core6.setFeature(context,"FLEXIBLE_CHECKSUMS_REQ_SHA1","X");break;case ChecksumAlgorithm.SHA256:import_core6.setFeature(context,"FLEXIBLE_CHECKSUMS_REQ_SHA256","Y");break}let checksumLocationName=getChecksumLocationName(checksumAlgorithm),checksumAlgorithmFn=selectChecksumAlgorithmFunction(checksumAlgorithm,config);if(isStreaming(requestBody)){let{getAwsChunkedEncodingStream,bodyLengthChecker}=config;updatedBody=getAwsChunkedEncodingStream(typeof config.requestStreamBufferSize==="number"&&config.requestStreamBufferSize>=8192?import_util_stream.createBufferedReadable(requestBody,config.requestStreamBufferSize,context.logger):requestBody,{base64Encoder,bodyLengthChecker,checksumLocationName,checksumAlgorithmFn,streamHasher}),updatedHeaders={...headers,"content-encoding":headers["content-encoding"]?`${headers["content-encoding"]},aws-chunked`:"aws-chunked","transfer-encoding":"chunked","x-amz-decoded-content-length":headers["content-length"],"x-amz-content-sha256":"STREAMING-UNSIGNED-PAYLOAD-TRAILER","x-amz-trailer":checksumLocationName},delete updatedHeaders["content-length"]}else if(!hasHeader(checksumLocationName,headers)){let rawChecksum=await stringHasher(checksumAlgorithmFn,requestBody);updatedHeaders={...headers,[checksumLocationName]:base64Encoder(rawChecksum)}}}try{return await next({...args,request:{...request,headers:updatedHeaders,body:updatedBody}})}catch(e){if(e instanceof Error&&e.name==="InvalidChunkSizeError")try{if(!e.message.endsWith("."))e.message+=".";e.message+=" Set [requestStreamBufferSize=number e.g. 65_536] in client constructor to instruct AWS SDK to buffer your input stream."}catch(ignored){}throw e}};var import_core7=__toESM(require_dist_cjs23(),1);var flexibleChecksumsInputMiddlewareOptions={name:"flexibleChecksumsInputMiddleware",toMiddleware:"serializerMiddleware",relation:"before",tags:["BODY_CHECKSUM"],override:!0},flexibleChecksumsInputMiddleware=(config,middlewareConfig)=>(next,context)=>async(args)=>{let input=args.input,{requestValidationModeMember}=middlewareConfig,requestChecksumCalculation=await config.requestChecksumCalculation(),responseChecksumValidation=await config.responseChecksumValidation();switch(requestChecksumCalculation){case RequestChecksumCalculation.WHEN_REQUIRED:import_core7.setFeature(context,"FLEXIBLE_CHECKSUMS_REQ_WHEN_REQUIRED","a");break;case RequestChecksumCalculation.WHEN_SUPPORTED:import_core7.setFeature(context,"FLEXIBLE_CHECKSUMS_REQ_WHEN_SUPPORTED","Z");break}switch(responseChecksumValidation){case ResponseChecksumValidation.WHEN_REQUIRED:import_core7.setFeature(context,"FLEXIBLE_CHECKSUMS_RES_WHEN_REQUIRED","c");break;case ResponseChecksumValidation.WHEN_SUPPORTED:import_core7.setFeature(context,"FLEXIBLE_CHECKSUMS_RES_WHEN_SUPPORTED","b");break}if(requestValidationModeMember&&!input[requestValidationModeMember]){if(responseChecksumValidation===ResponseChecksumValidation.WHEN_SUPPORTED)input[requestValidationModeMember]="ENABLED"}return next(args)};var import_protocol_http3=__toESM(require_dist_cjs2(),1);var getChecksumAlgorithmListForResponse=(responseAlgorithms=[])=>{let validChecksumAlgorithms=[];for(let algorithm of PRIORITY_ORDER_ALGORITHMS){if(!responseAlgorithms.includes(algorithm)||!CLIENT_SUPPORTED_ALGORITHMS.includes(algorithm))continue;validChecksumAlgorithms.push(algorithm)}return validChecksumAlgorithms};var isChecksumWithPartNumber=(checksum2)=>{let lastHyphenIndex=checksum2.lastIndexOf("-");if(lastHyphenIndex!==-1){let numberPart=checksum2.slice(lastHyphenIndex+1);if(!numberPart.startsWith("0")){let number=parseInt(numberPart,10);if(!isNaN(number)&&number>=1&&number<=1e4)return!0}}return!1};var import_util_stream2=__toESM(require_dist_cjs14(),1);var getChecksum=async(body,{checksumAlgorithmFn,base64Encoder})=>base64Encoder(await stringHasher(checksumAlgorithmFn,body));var validateChecksumFromResponse=async(response,{config,responseAlgorithms,logger})=>{let checksumAlgorithms=getChecksumAlgorithmListForResponse(responseAlgorithms),{body:responseBody,headers:responseHeaders}=response;for(let algorithm of checksumAlgorithms){let responseHeader=getChecksumLocationName(algorithm),checksumFromResponse=responseHeaders[responseHeader];if(checksumFromResponse){let checksumAlgorithmFn;try{checksumAlgorithmFn=selectChecksumAlgorithmFunction(algorithm,config)}catch(error){if(algorithm===ChecksumAlgorithm.CRC64NVME){logger?.warn(`Skipping ${ChecksumAlgorithm.CRC64NVME} checksum validation: ${error.message}`);continue}throw error}let{base64Encoder}=config;if(isStreaming(responseBody)){response.body=import_util_stream2.createChecksumStream({expectedChecksum:checksumFromResponse,checksumSourceLocation:responseHeader,checksum:new checksumAlgorithmFn,source:responseBody,base64Encoder});return}let checksum2=await getChecksum(responseBody,{checksumAlgorithmFn,base64Encoder});if(checksum2===checksumFromResponse)break;throw Error(`Checksum mismatch: expected "${checksum2}" but received "${checksumFromResponse}" in response header "${responseHeader}".`)}}};var flexibleChecksumsResponseMiddlewareOptions={name:"flexibleChecksumsResponseMiddleware",toMiddleware:"deserializerMiddleware",relation:"after",tags:["BODY_CHECKSUM"],override:!0},flexibleChecksumsResponseMiddleware=(config,middlewareConfig)=>(next,context)=>async(args)=>{if(!import_protocol_http3.HttpRequest.isInstance(args.request))return next(args);let input=args.input,result2=await next(args),response=result2.response,{requestValidationModeMember,responseAlgorithms}=middlewareConfig;if(requestValidationModeMember&&input[requestValidationModeMember]==="ENABLED"){let{clientName,commandName}=context;if(clientName==="S3Client"&&commandName==="GetObjectCommand"&&getChecksumAlgorithmListForResponse(responseAlgorithms).every((algorithm)=>{let responseHeader=getChecksumLocationName(algorithm),checksumFromResponse=response.headers[responseHeader];return!checksumFromResponse||isChecksumWithPartNumber(checksumFromResponse)}))return result2;await validateChecksumFromResponse(response,{config,responseAlgorithms,logger:context.logger})}return result2};var getFlexibleChecksumsPlugin=(config,middlewareConfig)=>({applyToStack:(clientStack)=>{clientStack.add(flexibleChecksumsMiddleware(config,middlewareConfig),flexibleChecksumsMiddlewareOptions),clientStack.addRelativeTo(flexibleChecksumsInputMiddleware(config,middlewareConfig),flexibleChecksumsInputMiddlewareOptions),clientStack.addRelativeTo(flexibleChecksumsResponseMiddleware(config,middlewareConfig),flexibleChecksumsResponseMiddlewareOptions)}});var import_util_middleware=__toESM(require_dist_cjs3(),1);var resolveFlexibleChecksumsConfig=(input)=>{let{requestChecksumCalculation,responseChecksumValidation,requestStreamBufferSize}=input;return Object.assign(input,{requestChecksumCalculation:import_util_middleware.normalizeProvider(requestChecksumCalculation??DEFAULT_REQUEST_CHECKSUM_CALCULATION),responseChecksumValidation:import_util_middleware.normalizeProvider(responseChecksumValidation??DEFAULT_RESPONSE_CHECKSUM_VALIDATION),requestStreamBufferSize:Number(requestStreamBufferSize??0)})};var import_middleware_host_header2=__toESM(require_dist_cjs24(),1),import_middleware_logger2=__toESM(require_dist_cjs25(),1),import_middleware_recursion_detection2=__toESM(require_dist_cjs26(),1);var import_protocol_http4=__toESM(require_dist_cjs2(),1),import_smithy_client=__toESM(require_dist_cjs21(),1),CONTENT_LENGTH_HEADER="content-length",DECODED_CONTENT_LENGTH_HEADER="x-amz-decoded-content-length";function checkContentLengthHeader(){return(next,context)=>async(args)=>{let{request}=args;if(import_protocol_http4.HttpRequest.isInstance(request)){if(!(CONTENT_LENGTH_HEADER in request.headers)&&!(DECODED_CONTENT_LENGTH_HEADER in request.headers))if(typeof context?.logger?.warn==="function"&&!(context.logger instanceof import_smithy_client.NoOpLogger))context.logger.warn("Are you using a Stream of unknown length as the Body of a PutObject request? Consider using Upload instead from @aws-sdk/lib-storage.");else console.warn("Are you using a Stream of unknown length as the Body of a PutObject request? Consider using Upload instead from @aws-sdk/lib-storage.")}return next({...args})}}var checkContentLengthHeaderMiddlewareOptions={step:"finalizeRequest",tags:["CHECK_CONTENT_LENGTH_HEADER"],name:"getCheckContentLengthHeaderPlugin",override:!0},getCheckContentLengthHeaderPlugin=(unused)=>({applyToStack:(clientStack)=>{clientStack.add(checkContentLengthHeader(),checkContentLengthHeaderMiddlewareOptions)}});var regionRedirectEndpointMiddleware=(config)=>{return(next,context)=>async(args)=>{let originalRegion=await config.region(),regionProviderRef=config.region,unlock=()=>{};if(context.__s3RegionRedirect)Object.defineProperty(config,"region",{writable:!1,value:async()=>{return context.__s3RegionRedirect}}),unlock=()=>Object.defineProperty(config,"region",{writable:!0,value:regionProviderRef});try{let result2=await next(args);if(context.__s3RegionRedirect){unlock();let region=await config.region();if(originalRegion!==region)throw Error("Region was not restored following S3 region redirect.")}return result2}catch(e){throw unlock(),e}}},regionRedirectEndpointMiddlewareOptions={tags:["REGION_REDIRECT","S3"],name:"regionRedirectEndpointMiddleware",override:!0,relation:"before",toMiddleware:"endpointV2Middleware"};function regionRedirectMiddleware(clientConfig){return(next,context)=>async(args)=>{try{return await next(args)}catch(err){if(clientConfig.followRegionRedirects){let statusCode=err?.$metadata?.httpStatusCode,isHeadBucket=context.commandName==="HeadBucketCommand",bucketRegionHeader=err?.$response?.headers?.["x-amz-bucket-region"];if(bucketRegionHeader){if(statusCode===301||statusCode===400&&(err?.name==="IllegalLocationConstraintException"||isHeadBucket)){try{let actualRegion=bucketRegionHeader;context.logger?.debug(`Redirecting from ${await clientConfig.region()} to ${actualRegion}`),context.__s3RegionRedirect=actualRegion}catch(e){throw Error("Region redirect failed: "+e)}return next(args)}}}throw err}}}var regionRedirectMiddlewareOptions={step:"initialize",tags:["REGION_REDIRECT","S3"],name:"regionRedirectMiddleware",override:!0},getRegionRedirectMiddlewarePlugin=(clientConfig)=>({applyToStack:(clientStack)=>{clientStack.add(regionRedirectMiddleware(clientConfig),regionRedirectMiddlewareOptions),clientStack.addRelativeTo(regionRedirectEndpointMiddleware(clientConfig),regionRedirectEndpointMiddlewareOptions)}});var import_protocol_http5=__toESM(require_dist_cjs2(),1),import_smithy_client2=__toESM(require_dist_cjs21(),1),s3ExpiresMiddleware=(config)=>{return(next,context)=>async(args)=>{let result2=await next(args),{response}=result2;if(import_protocol_http5.HttpResponse.isInstance(response)){if(response.headers.expires){response.headers.expiresstring=response.headers.expires;try{import_smithy_client2.parseRfc7231DateTime(response.headers.expires)}catch(e){context.logger?.warn(`AWS SDK Warning for ${context.clientName}::${context.commandName} response parsing (${response.headers.expires}): ${e}`),delete response.headers.expires}}}return result2}},s3ExpiresMiddlewareOptions={tags:["S3"],name:"s3ExpiresMiddleware",override:!0,relation:"after",toMiddleware:"deserializerMiddleware"},getS3ExpiresMiddlewarePlugin=(clientConfig)=>({applyToStack:(clientStack)=>{clientStack.addRelativeTo(s3ExpiresMiddleware(clientConfig),s3ExpiresMiddlewareOptions)}});class S3ExpressIdentityCache{data;lastPurgeTime=Date.now();static EXPIRED_CREDENTIAL_PURGE_INTERVAL_MS=30000;constructor(data={}){this.data=data}get(key){let entry=this.data[key];if(!entry)return;return entry}set(key,entry){return this.data[key]=entry,entry}delete(key){delete this.data[key]}async purgeExpired(){let now=Date.now();if(this.lastPurgeTime+S3ExpressIdentityCache.EXPIRED_CREDENTIAL_PURGE_INTERVAL_MS>now)return;for(let key in this.data){let entry=this.data[key];if(!entry.isRefreshing){let credential=await entry.identity;if(credential.expiration){if(credential.expiration.getTime()<now)delete this.data[key]}}}}}class S3ExpressIdentityCacheEntry{_identity;isRefreshing;accessed;constructor(_identity,isRefreshing=!1,accessed=Date.now()){this._identity=_identity,this.isRefreshing=isRefreshing,this.accessed=accessed}get identity(){return this.accessed=Date.now(),this._identity}}class S3ExpressIdentityProviderImpl{createSessionFn;cache;static REFRESH_WINDOW_MS=60000;constructor(createSessionFn,cache2=new S3ExpressIdentityCache){this.createSessionFn=createSessionFn,this.cache=cache2}async getS3ExpressIdentity(awsIdentity,identityProperties){let key=identityProperties.Bucket,{cache:cache2}=this,entry=cache2.get(key);if(entry)return entry.identity.then((identity)=>{if((identity.expiration?.getTime()??0)<Date.now())return cache2.set(key,new S3ExpressIdentityCacheEntry(this.getIdentity(key))).identity;if((identity.expiration?.getTime()??0)<Date.now()+S3ExpressIdentityProviderImpl.REFRESH_WINDOW_MS&&!entry.isRefreshing)entry.isRefreshing=!0,this.getIdentity(key).then((id)=>{cache2.set(key,new S3ExpressIdentityCacheEntry(Promise.resolve(id)))});return identity});return cache2.set(key,new S3ExpressIdentityCacheEntry(this.getIdentity(key))).identity}async getIdentity(key){await this.cache.purgeExpired().catch((error)=>{console.warn(`Error while clearing expired entries in S3ExpressIdentityCache: 
`+error)});let session=await this.createSessionFn(key);if(!session.Credentials?.AccessKeyId||!session.Credentials?.SecretAccessKey)throw Error("s3#createSession response credential missing AccessKeyId or SecretAccessKey.");return{accessKeyId:session.Credentials.AccessKeyId,secretAccessKey:session.Credentials.SecretAccessKey,sessionToken:session.Credentials.SessionToken,expiration:session.Credentials.Expiration?new Date(session.Credentials.Expiration):void 0}}}var import_signature_v4=__toESM(require_dist_cjs18(),1);var import_util_config_provider=__toESM(require_dist_cjs27(),1),S3_EXPRESS_BUCKET_TYPE="Directory",S3_EXPRESS_BACKEND="S3Express",S3_EXPRESS_AUTH_SCHEME="sigv4-s3express",SESSION_TOKEN_QUERY_PARAM="X-Amz-S3session-Token",SESSION_TOKEN_HEADER=SESSION_TOKEN_QUERY_PARAM.toLowerCase(),NODE_DISABLE_S3_EXPRESS_SESSION_AUTH_ENV_NAME="AWS_S3_DISABLE_EXPRESS_SESSION_AUTH",NODE_DISABLE_S3_EXPRESS_SESSION_AUTH_INI_NAME="s3_disable_express_session_auth",NODE_DISABLE_S3_EXPRESS_SESSION_AUTH_OPTIONS={environmentVariableSelector:(env3)=>import_util_config_provider.booleanSelector(env3,NODE_DISABLE_S3_EXPRESS_SESSION_AUTH_ENV_NAME,import_util_config_provider.SelectorType.ENV),configFileSelector:(profile)=>import_util_config_provider.booleanSelector(profile,NODE_DISABLE_S3_EXPRESS_SESSION_AUTH_INI_NAME,import_util_config_provider.SelectorType.CONFIG),default:!1};class SignatureV4S3Express extends import_signature_v4.SignatureV4{async signWithCredentials(requestToSign,credentials,options){let credentialsWithoutSessionToken=getCredentialsWithoutSessionToken(credentials);requestToSign.headers[SESSION_TOKEN_HEADER]=credentials.sessionToken;let privateAccess=this;return setSingleOverride(privateAccess,credentialsWithoutSessionToken),privateAccess.signRequest(requestToSign,options??{})}async presignWithCredentials(requestToSign,credentials,options){let credentialsWithoutSessionToken=getCredentialsWithoutSessionToken(credentials);return delete requestToSign.headers[SESSION_TOKEN_HEADER],requestToSign.headers[SESSION_TOKEN_QUERY_PARAM]=credentials.sessionToken,requestToSign.query=requestToSign.query??{},requestToSign.query[SESSION_TOKEN_QUERY_PARAM]=credentials.sessionToken,setSingleOverride(this,credentialsWithoutSessionToken),this.presign(requestToSign,options)}}function getCredentialsWithoutSessionToken(credentials){return{accessKeyId:credentials.accessKeyId,secretAccessKey:credentials.secretAccessKey,expiration:credentials.expiration}}function setSingleOverride(privateAccess,credentialsWithoutSessionToken){let id=setTimeout(()=>{throw Error("SignatureV4S3Express credential override was created but not called.")},10),currentCredentialProvider=privateAccess.credentialProvider,overrideCredentialsProviderOnce=()=>{return clearTimeout(id),privateAccess.credentialProvider=currentCredentialProvider,Promise.resolve(credentialsWithoutSessionToken)};privateAccess.credentialProvider=overrideCredentialsProviderOnce}var import_core8=__toESM(require_dist_cjs23(),1),import_protocol_http6=__toESM(require_dist_cjs2(),1);var s3ExpressMiddleware=(options)=>{return(next,context)=>async(args)=>{if(context.endpointV2){let endpoint=context.endpointV2,isS3ExpressAuth=endpoint.properties?.authSchemes?.[0]?.name===S3_EXPRESS_AUTH_SCHEME;if(endpoint.properties?.backend===S3_EXPRESS_BACKEND||endpoint.properties?.bucketType===S3_EXPRESS_BUCKET_TYPE)import_core8.setFeature(context,"S3_EXPRESS_BUCKET","J"),context.isS3ExpressBucket=!0;if(isS3ExpressAuth){let requestBucket=args.input.Bucket;if(requestBucket){let s3ExpressIdentity=await options.s3ExpressIdentityProvider.getS3ExpressIdentity(await options.credentials(),{Bucket:requestBucket});if(context.s3ExpressIdentity=s3ExpressIdentity,import_protocol_http6.HttpRequest.isInstance(args.request)&&s3ExpressIdentity.sessionToken)args.request.headers[SESSION_TOKEN_HEADER]=s3ExpressIdentity.sessionToken}}}return next(args)}},s3ExpressMiddlewareOptions={name:"s3ExpressMiddleware",step:"build",tags:["S3","S3_EXPRESS"],override:!0},getS3ExpressPlugin=(options)=>({applyToStack:(clientStack)=>{clientStack.add(s3ExpressMiddleware(options),s3ExpressMiddlewareOptions)}});var import_core9=__toESM(require_dist_cjs16(),1),import_protocol_http7=__toESM(require_dist_cjs2(),1);var import_util_middleware2=__toESM(require_dist_cjs3(),1);var signS3Express=async(s3ExpressIdentity,signingOptions,request,sigV4MultiRegionSigner)=>{let signedRequest=await sigV4MultiRegionSigner.signWithCredentials(request,s3ExpressIdentity,{});if(signedRequest.headers["X-Amz-Security-Token"]||signedRequest.headers["x-amz-security-token"])throw Error("X-Amz-Security-Token must not be set for s3-express requests.");return signedRequest};var defaultErrorHandler=(signingProperties)=>(error)=>{throw error},defaultSuccessHandler=(httpResponse,signingProperties)=>{};var s3ExpressHttpSigningMiddleware=(config)=>(next,context)=>async(args)=>{if(!import_protocol_http7.HttpRequest.isInstance(args.request))return next(args);let scheme=import_util_middleware2.getSmithyContext(context).selectedHttpAuthScheme;if(!scheme)throw Error("No HttpAuthScheme was selected: unable to sign request");let{httpAuthOption:{signingProperties={}},identity,signer}=scheme,request;if(context.s3ExpressIdentity)request=await signS3Express(context.s3ExpressIdentity,signingProperties,args.request,await config.signer());else request=await signer.sign(args.request,identity,signingProperties);let output=await next({...args,request}).catch((signer.errorHandler||defaultErrorHandler)(signingProperties));return(signer.successHandler||defaultSuccessHandler)(output.response,signingProperties),output},getS3ExpressHttpSigningPlugin=(config)=>({applyToStack:(clientStack)=>{clientStack.addRelativeTo(s3ExpressHttpSigningMiddleware(config),import_core9.httpSigningMiddlewareOptions)}});var resolveS3Config=(input,{session})=>{let[s3ClientProvider,CreateSessionCommandCtor]=session,{forcePathStyle,useAccelerateEndpoint,disableMultiregionAccessPoints,followRegionRedirects,s3ExpressIdentityProvider,bucketEndpoint,expectContinueHeader}=input;return Object.assign(input,{forcePathStyle:forcePathStyle??!1,useAccelerateEndpoint:useAccelerateEndpoint??!1,disableMultiregionAccessPoints:disableMultiregionAccessPoints??!1,followRegionRedirects:followRegionRedirects??!1,s3ExpressIdentityProvider:s3ExpressIdentityProvider??new S3ExpressIdentityProviderImpl(async(key)=>s3ClientProvider().send(new CreateSessionCommandCtor({Bucket:key}))),bucketEndpoint:bucketEndpoint??!1,expectContinueHeader:expectContinueHeader??2097152})};var import_protocol_http8=__toESM(require_dist_cjs2(),1),import_util_stream3=__toESM(require_dist_cjs14(),1),THROW_IF_EMPTY_BODY={CopyObjectCommand:!0,UploadPartCopyCommand:!0,CompleteMultipartUploadCommand:!0},MAX_BYTES_TO_INSPECT=3000,throw200ExceptionsMiddleware=(config)=>(next,context)=>async(args)=>{let result2=await next(args),{response}=result2;if(!import_protocol_http8.HttpResponse.isInstance(response))return result2;let{statusCode,body:sourceBody}=response;if(statusCode<200||statusCode>=300)return result2;if(!(typeof sourceBody?.stream==="function"||typeof sourceBody?.pipe==="function"||typeof sourceBody?.tee==="function"))return result2;let bodyCopy=sourceBody,body=sourceBody;if(sourceBody&&typeof sourceBody==="object"&&!(sourceBody instanceof Uint8Array))[bodyCopy,body]=await import_util_stream3.splitStream(sourceBody);response.body=body;let bodyBytes=await collectBody(bodyCopy,{streamCollector:async(stream)=>{return import_util_stream3.headStream(stream,MAX_BYTES_TO_INSPECT)}});if(typeof bodyCopy?.destroy==="function")bodyCopy.destroy();let bodyStringTail=config.utf8Encoder(bodyBytes.subarray(bodyBytes.length-16));if(bodyBytes.length===0&&THROW_IF_EMPTY_BODY[context.commandName]){let err=Error("S3 aborted request");throw err.name="InternalError",err}if(bodyStringTail&&bodyStringTail.endsWith("</Error>"))response.statusCode=400;return result2},collectBody=(streamBody=new Uint8Array,context)=>{if(streamBody instanceof Uint8Array)return Promise.resolve(streamBody);return context.streamCollector(streamBody)||Promise.resolve(new Uint8Array)},throw200ExceptionsMiddlewareOptions={relation:"after",toMiddleware:"deserializerMiddleware",tags:["THROW_200_EXCEPTIONS","S3"],name:"throw200ExceptionsMiddleware",override:!0},getThrow200ExceptionsPlugin=(config)=>({applyToStack:(clientStack)=>{clientStack.addRelativeTo(throw200ExceptionsMiddleware(config),throw200ExceptionsMiddlewareOptions)}});var validate=(str)=>typeof str==="string"&&str.indexOf("arn:")===0&&str.split(":").length>=6;function bucketEndpointMiddleware(options){return(next,context)=>async(args)=>{if(options.bucketEndpoint){let endpoint=context.endpointV2;if(endpoint){let bucket=args.input.Bucket;if(typeof bucket==="string")try{let bucketEndpointUrl=new URL(bucket);context.endpointV2={...endpoint,url:bucketEndpointUrl}}catch(e){let warning=`@aws-sdk/middleware-sdk-s3: bucketEndpoint=true was set but Bucket=${bucket} could not be parsed as URL.`;if(context.logger?.constructor?.name==="NoOpLogger")console.warn(warning);else context.logger?.warn?.(warning);throw e}}}return next(args)}}var bucketEndpointMiddlewareOptions={name:"bucketEndpointMiddleware",override:!0,relation:"after",toMiddleware:"endpointV2Middleware"};function validateBucketNameMiddleware({bucketEndpoint}){return(next)=>async(args)=>{let{input:{Bucket}}=args;if(!bucketEndpoint&&typeof Bucket==="string"&&!validate(Bucket)&&Bucket.indexOf("/")>=0){let err=Error(`Bucket name shouldn't contain '/', received '${Bucket}'`);throw err.name="InvalidBucketName",err}return next({...args})}}var validateBucketNameMiddlewareOptions={step:"initialize",tags:["VALIDATE_BUCKET_NAME"],name:"validateBucketNameMiddleware",override:!0},getValidateBucketNamePlugin=(options)=>({applyToStack:(clientStack)=>{clientStack.add(validateBucketNameMiddleware(options),validateBucketNameMiddlewareOptions),clientStack.addRelativeTo(bucketEndpointMiddleware(options),bucketEndpointMiddlewareOptions)}});var import_middleware_user_agent2=__toESM(require_dist_cjs32(),1),import_config_resolver4=__toESM(require_dist_cjs33(),1),import_core20=__toESM(require_dist_cjs16(),1),import_schema10=__toESM(require_schema(),1);var resolveEventStreamSerdeConfig=(input)=>Object.assign(input,{eventStreamMarshaller:input.eventStreamSerdeProvider(input)});var import_middleware_content_length2=__toESM(require_dist_cjs34(),1),import_middleware_endpoint8=__toESM(require_dist_cjs37(),1),import_middleware_retry4=__toESM(require_dist_cjs40(),1),import_smithy_client19=__toESM(require_dist_cjs21(),1);var import_core10=__toESM(require_dist_cjs23(),1);var import_signature_v42=__toESM(require_dist_cjs18(),1);var signatureV4CrtContainer={CrtSignerV4:null};class SignatureV4MultiRegion{sigv4aSigner;sigv4Signer;signerOptions;static sigv4aDependency(){if(typeof signatureV4CrtContainer.CrtSignerV4==="function")return"crt";else if(typeof import_signature_v42.signatureV4aContainer.SignatureV4a==="function")return"js";return"none"}constructor(options){this.sigv4Signer=new SignatureV4S3Express(options),this.signerOptions=options}async sign(requestToSign,options={}){if(options.signingRegion==="*")return this.getSigv4aSigner().sign(requestToSign,options);return this.sigv4Signer.sign(requestToSign,options)}async signWithCredentials(requestToSign,credentials,options={}){if(options.signingRegion==="*"){let signer=this.getSigv4aSigner(),CrtSignerV4=signatureV4CrtContainer.CrtSignerV4;if(CrtSignerV4&&signer instanceof CrtSignerV4)return signer.signWithCredentials(requestToSign,credentials,options);else throw Error(`signWithCredentials with signingRegion '*' is only supported when using the CRT dependency @aws-sdk/signature-v4-crt. Please check whether you have installed the "@aws-sdk/signature-v4-crt" package explicitly. You must also register the package by calling [require("@aws-sdk/signature-v4-crt");] or an ESM equivalent such as [import "@aws-sdk/signature-v4-crt";]. For more information please go to https://github.com/aws/aws-sdk-js-v3#functionality-requiring-aws-common-runtime-crt`)}return this.sigv4Signer.signWithCredentials(requestToSign,credentials,options)}async presign(originalRequest,options={}){if(options.signingRegion==="*"){let signer=this.getSigv4aSigner(),CrtSignerV4=signatureV4CrtContainer.CrtSignerV4;if(CrtSignerV4&&signer instanceof CrtSignerV4)return signer.presign(originalRequest,options);else throw Error(`presign with signingRegion '*' is only supported when using the CRT dependency @aws-sdk/signature-v4-crt. Please check whether you have installed the "@aws-sdk/signature-v4-crt" package explicitly. You must also register the package by calling [require("@aws-sdk/signature-v4-crt");] or an ESM equivalent such as [import "@aws-sdk/signature-v4-crt";]. For more information please go to https://github.com/aws/aws-sdk-js-v3#functionality-requiring-aws-common-runtime-crt`)}return this.sigv4Signer.presign(originalRequest,options)}async presignWithCredentials(originalRequest,credentials,options={}){if(options.signingRegion==="*")throw Error("Method presignWithCredentials is not supported for [signingRegion=*].");return this.sigv4Signer.presignWithCredentials(originalRequest,credentials,options)}getSigv4aSigner(){if(!this.sigv4aSigner){let CrtSignerV4=signatureV4CrtContainer.CrtSignerV4,JsSigV4aSigner=import_signature_v42.signatureV4aContainer.SignatureV4a;if(this.signerOptions.runtime==="node"){if(!CrtSignerV4&&!JsSigV4aSigner)throw Error("Neither CRT nor JS SigV4a implementation is available. Please load either @aws-sdk/signature-v4-crt or @aws-sdk/signature-v4a. For more information please go to https://github.com/aws/aws-sdk-js-v3#functionality-requiring-aws-common-runtime-crt");if(CrtSignerV4&&typeof CrtSignerV4==="function")this.sigv4aSigner=new CrtSignerV4({...this.signerOptions,signingAlgorithm:1});else if(JsSigV4aSigner&&typeof JsSigV4aSigner==="function")this.sigv4aSigner=new JsSigV4aSigner({...this.signerOptions});else throw Error("Available SigV4a implementation is not a valid constructor. Please ensure you've properly imported @aws-sdk/signature-v4-crt or @aws-sdk/signature-v4a.For more information please go to https://github.com/aws/aws-sdk-js-v3#functionality-requiring-aws-common-runtime-crt")}else{if(!JsSigV4aSigner||typeof JsSigV4aSigner!=="function")throw Error("JS SigV4a implementation is not available or not a valid constructor. Please check whether you have installed the @aws-sdk/signature-v4a package explicitly. The CRT implementation is not available for browsers. You must also register the package by calling [require('@aws-sdk/signature-v4a');] or an ESM equivalent such as [import '@aws-sdk/signature-v4a';]. For more information please go to https://github.com/aws/aws-sdk-js-v3#using-javascript-non-crt-implementation-of-sigv4a");this.sigv4aSigner=new JsSigV4aSigner({...this.signerOptions})}}return this.sigv4aSigner}}var import_middleware_endpoint=__toESM(require_dist_cjs37(),1),import_util_middleware3=__toESM(require_dist_cjs3(),1);var import_util_endpoints=__toESM(require_dist_cjs31(),1),import_util_endpoints2=__toESM(require_dist_cjs28(),1);var T2={["required"]:!1,["type"]:"string"},U={["required"]:!0,default:!1,["type"]:"boolean"},V={["required"]:!1,["type"]:"boolean"},W={["fn"]:"booleanEquals",["argv"]:[{["ref"]:"Accelerate"},!0]},X={["fn"]:"booleanEquals",["argv"]:[{["ref"]:"UseFIPS"},!0]},Y2={["fn"]:"booleanEquals",["argv"]:[{["ref"]:"UseDualStack"},!0]},Z={["fn"]:"isSet",["argv"]:[{["ref"]:"Endpoint"}]},aa={["fn"]:"aws.partition",["argv"]:[{["ref"]:"Region"}],["assign"]:"partitionResult"},ab={["fn"]:"stringEquals",["argv"]:[{["fn"]:"getAttr",["argv"]:[{["ref"]:"partitionResult"},"name"]},"aws-cn"]},ac={["fn"]:"isSet",["argv"]:[{["ref"]:"Bucket"}]},ad={["ref"]:"Bucket"},ae={["conditions"]:[W],["error"]:"S3Express does not support S3 Accelerate.",["type"]:"error"},af={["conditions"]:[Z,{["fn"]:"parseURL",["argv"]:[{["ref"]:"Endpoint"}],["assign"]:"url"}],["rules"]:[{["conditions"]:[{["fn"]:"isSet",["argv"]:[{["ref"]:"DisableS3ExpressSessionAuth"}]},{["fn"]:"booleanEquals",["argv"]:[{["ref"]:"DisableS3ExpressSessionAuth"},!0]}],["rules"]:[{["conditions"]:[{["fn"]:"booleanEquals",["argv"]:[{["fn"]:"getAttr",["argv"]:[{["ref"]:"url"},"isIp"]},!0]}],["rules"]:[{["conditions"]:[{["fn"]:"uriEncode",["argv"]:[ad],["assign"]:"uri_encoded_bucket"}],["rules"]:[{["endpoint"]:{["url"]:"{url#scheme}://{url#authority}/{uri_encoded_bucket}{url#path}",["properties"]:{["backend"]:"S3Express",["authSchemes"]:[{["disableDoubleEncoding"]:!0,["name"]:"sigv4",["signingName"]:"s3express",["signingRegion"]:"{Region}"}]},["headers"]:{}},["type"]:"endpoint"}],["type"]:"tree"}],["type"]:"tree"},{["conditions"]:[{["fn"]:"aws.isVirtualHostableS3Bucket",["argv"]:[ad,!1]}],["rules"]:[{["endpoint"]:{["url"]:"{url#scheme}://{Bucket}.{url#authority}{url#path}",["properties"]:{["backend"]:"S3Express",["authSchemes"]:[{["disableDoubleEncoding"]:!0,["name"]:"sigv4",["signingName"]:"s3express",["signingRegion"]:"{Region}"}]},["headers"]:{}},["type"]:"endpoint"}],["type"]:"tree"},{["error"]:"S3Express bucket name is not a valid virtual hostable name.",["type"]:"error"}],["type"]:"tree"},{["conditions"]:[{["fn"]:"booleanEquals",["argv"]:[{["fn"]:"getAttr",["argv"]:[{["ref"]:"url"},"isIp"]},!0]}],["rules"]:[{["conditions"]:[{["fn"]:"uriEncode",["argv"]:[ad],["assign"]:"uri_encoded_bucket"}],["rules"]:[{["endpoint"]:{["url"]:"{url#scheme}://{url#authority}/{uri_encoded_bucket}{url#path}",["properties"]:{["backend"]:"S3Express",["authSchemes"]:[{["disableDoubleEncoding"]:!0,["name"]:"sigv4-s3express",["signingName"]:"s3express",["signingRegion"]:"{Region}"}]},["headers"]:{}},["type"]:"endpoint"}],["type"]:"tree"}],["type"]:"tree"},{["conditions"]:[{["fn"]:"aws.isVirtualHostableS3Bucket",["argv"]:[ad,!1]}],["rules"]:[{["endpoint"]:{["url"]:"{url#scheme}://{Bucket}.{url#authority}{url#path}",["properties"]:{["backend"]:"S3Express",["authSchemes"]:[{["disableDoubleEncoding"]:!0,["name"]:"sigv4-s3express",["signingName"]:"s3express",["signingRegion"]:"{Region}"}]},["headers"]:{}},["type"]:"endpoint"}],["type"]:"tree"},{["error"]:"S3Express bucket name is not a valid virtual hostable name.",["type"]:"error"}],["type"]:"tree"},ag={["fn"]:"parseURL",["argv"]:[{["ref"]:"Endpoint"}],["assign"]:"url"},ah={["fn"]:"booleanEquals",["argv"]:[{["fn"]:"getAttr",["argv"]:[{["ref"]:"url"},"isIp"]},!0]},ai={["ref"]:"url"},aj={["fn"]:"uriEncode",["argv"]:[ad],["assign"]:"uri_encoded_bucket"},ak={["backend"]:"S3Express",["authSchemes"]:[{["disableDoubleEncoding"]:!0,["name"]:"sigv4",["signingName"]:"s3express",["signingRegion"]:"{Region}"}]},al={},am={["fn"]:"aws.isVirtualHostableS3Bucket",["argv"]:[ad,!1]},an={["error"]:"S3Express bucket name is not a valid virtual hostable name.",["type"]:"error"},ao={["fn"]:"isSet",["argv"]:[{["ref"]:"UseS3ExpressControlEndpoint"}]},ap={["fn"]:"booleanEquals",["argv"]:[{["ref"]:"UseS3ExpressControlEndpoint"},!0]},aq={["fn"]:"not",["argv"]:[Z]},ar={["fn"]:"booleanEquals",["argv"]:[{["ref"]:"UseDualStack"},!1]},as={["fn"]:"booleanEquals",["argv"]:[{["ref"]:"UseFIPS"},!1]},at={["error"]:"Unrecognized S3Express bucket name format.",["type"]:"error"},au={["fn"]:"not",["argv"]:[ac]},av={["ref"]:"hardwareType"},aw={["conditions"]:[aq],["error"]:"Expected a endpoint to be specified but no endpoint was found",["type"]:"error"},ax={["authSchemes"]:[{["disableDoubleEncoding"]:!0,["name"]:"sigv4a",["signingName"]:"s3-outposts",["signingRegionSet"]:["*"]},{["disableDoubleEncoding"]:!0,["name"]:"sigv4",["signingName"]:"s3-outposts",["signingRegion"]:"{Region}"}]},ay={["fn"]:"booleanEquals",["argv"]:[{["ref"]:"ForcePathStyle"},!1]},az={["ref"]:"ForcePathStyle"},aA={["fn"]:"booleanEquals",["argv"]:[{["ref"]:"Accelerate"},!1]},aB={["fn"]:"stringEquals",["argv"]:[{["ref"]:"Region"},"aws-global"]},aC={["authSchemes"]:[{["disableDoubleEncoding"]:!0,["name"]:"sigv4",["signingName"]:"s3",["signingRegion"]:"us-east-1"}]},aD={["fn"]:"not",["argv"]:[aB]},aE={["fn"]:"booleanEquals",["argv"]:[{["ref"]:"UseGlobalEndpoint"},!0]},aF={["url"]:"https://{Bucket}.s3-fips.dualstack.{Region}.{partitionResult#dnsSuffix}",["properties"]:{["authSchemes"]:[{["disableDoubleEncoding"]:!0,["name"]:"sigv4",["signingName"]:"s3",["signingRegion"]:"{Region}"}]},["headers"]:{}},aG={["authSchemes"]:[{["disableDoubleEncoding"]:!0,["name"]:"sigv4",["signingName"]:"s3",["signingRegion"]:"{Region}"}]},aH={["fn"]:"booleanEquals",["argv"]:[{["ref"]:"UseGlobalEndpoint"},!1]},aI={["url"]:"https://{Bucket}.s3-fips.{Region}.{partitionResult#dnsSuffix}",["properties"]:aG,["headers"]:{}},aJ={["url"]:"https://{Bucket}.s3-accelerate.dualstack.{partitionResult#dnsSuffix}",["properties"]:aG,["headers"]:{}},aK={["url"]:"https://{Bucket}.s3.dualstack.{Region}.{partitionResult#dnsSuffix}",["properties"]:aG,["headers"]:{}},aL={["fn"]:"booleanEquals",["argv"]:[{["fn"]:"getAttr",["argv"]:[ai,"isIp"]},!1]},aM={["url"]:"{url#scheme}://{url#authority}{url#normalizedPath}{Bucket}",["properties"]:aG,["headers"]:{}},aN={["url"]:"{url#scheme}://{Bucket}.{url#authority}{url#path}",["properties"]:aG,["headers"]:{}},aO={["endpoint"]:aN,["type"]:"endpoint"},aP={["url"]:"https://{Bucket}.s3-accelerate.{partitionResult#dnsSuffix}",["properties"]:aG,["headers"]:{}},aQ={["url"]:"https://{Bucket}.s3.{Region}.{partitionResult#dnsSuffix}",["properties"]:aG,["headers"]:{}},aR={["error"]:"Invalid region: region was not a valid DNS name.",["type"]:"error"},aS={["ref"]:"bucketArn"},aT={["ref"]:"arnType"},aU={["fn"]:"getAttr",["argv"]:[aS,"service"]},aV={["ref"]:"accessPointName"},aW={["conditions"]:[Y2],["error"]:"S3 Object Lambda does not support Dual-stack",["type"]:"error"},aX={["conditions"]:[W],["error"]:"S3 Object Lambda does not support S3 Accelerate",["type"]:"error"},aY={["conditions"]:[{["fn"]:"isSet",["argv"]:[{["ref"]:"DisableAccessPoints"}]},{["fn"]:"booleanEquals",["argv"]:[{["ref"]:"DisableAccessPoints"},!0]}],["error"]:"Access points are not supported for this operation",["type"]:"error"},aZ={["conditions"]:[{["fn"]:"isSet",["argv"]:[{["ref"]:"UseArnRegion"}]},{["fn"]:"booleanEquals",["argv"]:[{["ref"]:"UseArnRegion"},!1]},{["fn"]:"not",["argv"]:[{["fn"]:"stringEquals",["argv"]:[{["fn"]:"getAttr",["argv"]:[aS,"region"]},"{Region}"]}]}],["error"]:"Invalid configuration: region from ARN `{bucketArn#region}` does not match client region `{Region}` and UseArnRegion is `false`",["type"]:"error"},ba={["fn"]:"getAttr",["argv"]:[{["ref"]:"bucketPartition"},"name"]},bb={["fn"]:"getAttr",["argv"]:[aS,"accountId"]},bc={["authSchemes"]:[{["disableDoubleEncoding"]:!0,["name"]:"sigv4",["signingName"]:"s3-object-lambda",["signingRegion"]:"{bucketArn#region}"}]},bd={["error"]:"Invalid ARN: The access point name may only contain a-z, A-Z, 0-9 and `-`. Found: `{accessPointName}`",["type"]:"error"},be={["error"]:"Invalid ARN: The account id may only contain a-z, A-Z, 0-9 and `-`. Found: `{bucketArn#accountId}`",["type"]:"error"},bf={["error"]:"Invalid region in ARN: `{bucketArn#region}` (invalid DNS name)",["type"]:"error"},bg={["error"]:"Client was configured for partition `{partitionResult#name}` but ARN (`{Bucket}`) has `{bucketPartition#name}`",["type"]:"error"},bh={["error"]:"Invalid ARN: The ARN may only contain a single resource component after `accesspoint`.",["type"]:"error"},bi={["error"]:"Invalid ARN: Expected a resource of the format `accesspoint:<accesspoint name>` but no name was provided",["type"]:"error"},bj={["authSchemes"]:[{["disableDoubleEncoding"]:!0,["name"]:"sigv4",["signingName"]:"s3",["signingRegion"]:"{bucketArn#region}"}]},bk={["authSchemes"]:[{["disableDoubleEncoding"]:!0,["name"]:"sigv4a",["signingName"]:"s3-outposts",["signingRegionSet"]:["*"]},{["disableDoubleEncoding"]:!0,["name"]:"sigv4",["signingName"]:"s3-outposts",["signingRegion"]:"{bucketArn#region}"}]},bl={["fn"]:"aws.parseArn",["argv"]:[ad]},bm={["url"]:"https://s3-fips.dualstack.{Region}.{partitionResult#dnsSuffix}/{uri_encoded_bucket}",["properties"]:aG,["headers"]:{}},bn={["url"]:"https://s3-fips.{Region}.{partitionResult#dnsSuffix}/{uri_encoded_bucket}",["properties"]:aG,["headers"]:{}},bo={["url"]:"https://s3.dualstack.{Region}.{partitionResult#dnsSuffix}/{uri_encoded_bucket}",["properties"]:aG,["headers"]:{}},bp={["url"]:"{url#scheme}://{url#authority}{url#normalizedPath}{uri_encoded_bucket}",["properties"]:aG,["headers"]:{}},bq={["url"]:"https://s3.{Region}.{partitionResult#dnsSuffix}/{uri_encoded_bucket}",["properties"]:aG,["headers"]:{}},br={["ref"]:"UseObjectLambdaEndpoint"},bs={["authSchemes"]:[{["disableDoubleEncoding"]:!0,["name"]:"sigv4",["signingName"]:"s3-object-lambda",["signingRegion"]:"{Region}"}]},bt={["url"]:"https://s3-fips.dualstack.{Region}.{partitionResult#dnsSuffix}",["properties"]:aG,["headers"]:{}},bu={["url"]:"https://s3-fips.{Region}.{partitionResult#dnsSuffix}",["properties"]:aG,["headers"]:{}},bv={["url"]:"https://s3.dualstack.{Region}.{partitionResult#dnsSuffix}",["properties"]:aG,["headers"]:{}},bw={["url"]:"{url#scheme}://{url#authority}{url#path}",["properties"]:aG,["headers"]:{}},bx={["url"]:"https://s3.{Region}.{partitionResult#dnsSuffix}",["properties"]:aG,["headers"]:{}},by=[{["ref"]:"Region"}],bz=[{["ref"]:"Endpoint"}],bA=[ad],bB=[W],bC=[Z,ag],bD=[{["fn"]:"isSet",["argv"]:[{["ref"]:"DisableS3ExpressSessionAuth"}]},{["fn"]:"booleanEquals",["argv"]:[{["ref"]:"DisableS3ExpressSessionAuth"},!0]}],bE=[aj],bF=[am],bG=[aa],bH=[X,Y2],bI=[X,ar],bJ=[as,Y2],bK=[as,ar],bL=[{["fn"]:"substring",["argv"]:[ad,6,14,!0],["assign"]:"s3expressAvailabilityZoneId"},{["fn"]:"substring",["argv"]:[ad,14,16,!0],["assign"]:"s3expressAvailabilityZoneDelim"},{["fn"]:"stringEquals",["argv"]:[{["ref"]:"s3expressAvailabilityZoneDelim"},"--"]}],bM=[{["conditions"]:[X,Y2],["endpoint"]:{["url"]:"https://{Bucket}.s3express-fips-{s3expressAvailabilityZoneId}.dualstack.{Region}.{partitionResult#dnsSuffix}",["properties"]:ak,["headers"]:{}},["type"]:"endpoint"},{["conditions"]:bI,["endpoint"]:{["url"]:"https://{Bucket}.s3express-fips-{s3expressAvailabilityZoneId}.{Region}.{partitionResult#dnsSuffix}",["properties"]:ak,["headers"]:{}},["type"]:"endpoint"},{["conditions"]:bJ,["endpoint"]:{["url"]:"https://{Bucket}.s3express-{s3expressAvailabilityZoneId}.dualstack.{Region}.{partitionResult#dnsSuffix}",["properties"]:ak,["headers"]:{}},["type"]:"endpoint"},{["conditions"]:bK,["endpoint"]:{["url"]:"https://{Bucket}.s3express-{s3expressAvailabilityZoneId}.{Region}.{partitionResult#dnsSuffix}",["properties"]:ak,["headers"]:{}},["type"]:"endpoint"}],bN=[{["fn"]:"substring",["argv"]:[ad,6,15,!0],["assign"]:"s3expressAvailabilityZoneId"},{["fn"]:"substring",["argv"]:[ad,15,17,!0],["assign"]:"s3expressAvailabilityZoneDelim"},{["fn"]:"stringEquals",["argv"]:[{["ref"]:"s3expressAvailabilityZoneDelim"},"--"]}],bO=[{["fn"]:"substring",["argv"]:[ad,6,19,!0],["assign"]:"s3expressAvailabilityZoneId"},{["fn"]:"substring",["argv"]:[ad,19,21,!0],["assign"]:"s3expressAvailabilityZoneDelim"},{["fn"]:"stringEquals",["argv"]:[{["ref"]:"s3expressAvailabilityZoneDelim"},"--"]}],bP=[{["fn"]:"substring",["argv"]:[ad,6,20,!0],["assign"]:"s3expressAvailabilityZoneId"},{["fn"]:"substring",["argv"]:[ad,20,22,!0],["assign"]:"s3expressAvailabilityZoneDelim"},{["fn"]:"stringEquals",["argv"]:[{["ref"]:"s3expressAvailabilityZoneDelim"},"--"]}],bQ=[{["fn"]:"substring",["argv"]:[ad,6,26,!0],["assign"]:"s3expressAvailabilityZoneId"},{["fn"]:"substring",["argv"]:[ad,26,28,!0],["assign"]:"s3expressAvailabilityZoneDelim"},{["fn"]:"stringEquals",["argv"]:[{["ref"]:"s3expressAvailabilityZoneDelim"},"--"]}],bR=[{["conditions"]:[X,Y2],["endpoint"]:{["url"]:"https://{Bucket}.s3express-fips-{s3expressAvailabilityZoneId}.dualstack.{Region}.{partitionResult#dnsSuffix}",["properties"]:{["backend"]:"S3Express",["authSchemes"]:[{["disableDoubleEncoding"]:!0,["name"]:"sigv4-s3express",["signingName"]:"s3express",["signingRegion"]:"{Region}"}]},["headers"]:{}},["type"]:"endpoint"},{["conditions"]:bI,["endpoint"]:{["url"]:"https://{Bucket}.s3express-fips-{s3expressAvailabilityZoneId}.{Region}.{partitionResult#dnsSuffix}",["properties"]:{["backend"]:"S3Express",["authSchemes"]:[{["disableDoubleEncoding"]:!0,["name"]:"sigv4-s3express",["signingName"]:"s3express",["signingRegion"]:"{Region}"}]},["headers"]:{}},["type"]:"endpoint"},{["conditions"]:bJ,["endpoint"]:{["url"]:"https://{Bucket}.s3express-{s3expressAvailabilityZoneId}.dualstack.{Region}.{partitionResult#dnsSuffix}",["properties"]:{["backend"]:"S3Express",["authSchemes"]:[{["disableDoubleEncoding"]:!0,["name"]:"sigv4-s3express",["signingName"]:"s3express",["signingRegion"]:"{Region}"}]},["headers"]:{}},["type"]:"endpoint"},{["conditions"]:bK,["endpoint"]:{["url"]:"https://{Bucket}.s3express-{s3expressAvailabilityZoneId}.{Region}.{partitionResult#dnsSuffix}",["properties"]:{["backend"]:"S3Express",["authSchemes"]:[{["disableDoubleEncoding"]:!0,["name"]:"sigv4-s3express",["signingName"]:"s3express",["signingRegion"]:"{Region}"}]},["headers"]:{}},["type"]:"endpoint"}],bS=[ad,0,7,!0],bT=[{["fn"]:"substring",["argv"]:[ad,7,15,!0],["assign"]:"s3expressAvailabilityZoneId"},{["fn"]:"substring",["argv"]:[ad,15,17,!0],["assign"]:"s3expressAvailabilityZoneDelim"},{["fn"]:"stringEquals",["argv"]:[{["ref"]:"s3expressAvailabilityZoneDelim"},"--"]}],bU=[{["fn"]:"substring",["argv"]:[ad,7,16,!0],["assign"]:"s3expressAvailabilityZoneId"},{["fn"]:"substring",["argv"]:[ad,16,18,!0],["assign"]:"s3expressAvailabilityZoneDelim"},{["fn"]:"stringEquals",["argv"]:[{["ref"]:"s3expressAvailabilityZoneDelim"},"--"]}],bV=[{["fn"]:"substring",["argv"]:[ad,7,20,!0],["assign"]:"s3expressAvailabilityZoneId"},{["fn"]:"substring",["argv"]:[ad,20,22,!0],["assign"]:"s3expressAvailabilityZoneDelim"},{["fn"]:"stringEquals",["argv"]:[{["ref"]:"s3expressAvailabilityZoneDelim"},"--"]}],bW=[{["fn"]:"substring",["argv"]:[ad,7,21,!0],["assign"]:"s3expressAvailabilityZoneId"},{["fn"]:"substring",["argv"]:[ad,21,23,!0],["assign"]:"s3expressAvailabilityZoneDelim"},{["fn"]:"stringEquals",["argv"]:[{["ref"]:"s3expressAvailabilityZoneDelim"},"--"]}],bX=[{["fn"]:"substring",["argv"]:[ad,7,27,!0],["assign"]:"s3expressAvailabilityZoneId"},{["fn"]:"substring",["argv"]:[ad,27,29,!0],["assign"]:"s3expressAvailabilityZoneDelim"},{["fn"]:"stringEquals",["argv"]:[{["ref"]:"s3expressAvailabilityZoneDelim"},"--"]}],bY=[ac],bZ=[{["fn"]:"isValidHostLabel",["argv"]:[{["ref"]:"outpostId"},!1]}],ca=[{["fn"]:"stringEquals",["argv"]:[{["ref"]:"regionPrefix"},"beta"]}],cb=["*"],cc=[{["fn"]:"isValidHostLabel",["argv"]:[{["ref"]:"Region"},!1]}],cd=[{["fn"]:"stringEquals",["argv"]:[{["ref"]:"Region"},"us-east-1"]}],ce=[{["fn"]:"stringEquals",["argv"]:[aT,"accesspoint"]}],cf=[{["fn"]:"getAttr",["argv"]:[aS,"resourceId[1]"],["assign"]:"accessPointName"},{["fn"]:"not",["argv"]:[{["fn"]:"stringEquals",["argv"]:[aV,""]}]}],cg=[aS,"resourceId[1]"],ch=[Y2],ci=[{["fn"]:"not",["argv"]:[{["fn"]:"stringEquals",["argv"]:[{["fn"]:"getAttr",["argv"]:[aS,"region"]},""]}]}],cj=[{["fn"]:"not",["argv"]:[{["fn"]:"isSet",["argv"]:[{["fn"]:"getAttr",["argv"]:[aS,"resourceId[2]"]}]}]}],ck=[aS,"resourceId[2]"],cl=[{["fn"]:"aws.partition",["argv"]:[{["fn"]:"getAttr",["argv"]:[aS,"region"]}],["assign"]:"bucketPartition"}],cm=[{["fn"]:"stringEquals",["argv"]:[ba,{["fn"]:"getAttr",["argv"]:[{["ref"]:"partitionResult"},"name"]}]}],cn=[{["fn"]:"isValidHostLabel",["argv"]:[{["fn"]:"getAttr",["argv"]:[aS,"region"]},!0]}],co=[{["fn"]:"isValidHostLabel",["argv"]:[bb,!1]}],cp=[{["fn"]:"isValidHostLabel",["argv"]:[aV,!1]}],cq=[X],cr=[{["fn"]:"isValidHostLabel",["argv"]:[{["ref"]:"Region"},!0]}],_data={version:"1.0",parameters:{Bucket:T2,Region:T2,UseFIPS:U,UseDualStack:U,Endpoint:T2,ForcePathStyle:U,Accelerate:U,UseGlobalEndpoint:U,UseObjectLambdaEndpoint:V,Key:T2,Prefix:T2,CopySource:T2,DisableAccessPoints:V,DisableMultiRegionAccessPoints:U,UseArnRegion:V,UseS3ExpressControlEndpoint:V,DisableS3ExpressSessionAuth:V},["rules"]:[{["conditions"]:[{["fn"]:"isSet",["argv"]:by}],["rules"]:[{["conditions"]:[W,X],error:"Accelerate cannot be used with FIPS",["type"]:"error"},{["conditions"]:[Y2,Z],error:"Cannot set dual-stack in combination with a custom endpoint.",["type"]:"error"},{["conditions"]:[Z,X],error:"A custom endpoint cannot be combined with FIPS",["type"]:"error"},{["conditions"]:[Z,W],error:"A custom endpoint cannot be combined with S3 Accelerate",["type"]:"error"},{["conditions"]:[X,aa,ab],error:"Partition does not support FIPS",["type"]:"error"},{["conditions"]:[ac,{["fn"]:"substring",["argv"]:[ad,0,6,!0],["assign"]:"bucketSuffix"},{["fn"]:"stringEquals",["argv"]:[{["ref"]:"bucketSuffix"},"--x-s3"]}],["rules"]:[ae,af,{["conditions"]:[ao,ap],["rules"]:[{["conditions"]:bG,["rules"]:[{["conditions"]:[aj,aq],["rules"]:[{["conditions"]:bH,endpoint:{["url"]:"https://s3express-control-fips.dualstack.{Region}.{partitionResult#dnsSuffix}/{uri_encoded_bucket}",["properties"]:ak,["headers"]:al},["type"]:"endpoint"},{["conditions"]:bI,endpoint:{["url"]:"https://s3express-control-fips.{Region}.{partitionResult#dnsSuffix}/{uri_encoded_bucket}",["properties"]:ak,["headers"]:al},["type"]:"endpoint"},{["conditions"]:bJ,endpoint:{["url"]:"https://s3express-control.dualstack.{Region}.{partitionResult#dnsSuffix}/{uri_encoded_bucket}",["properties"]:ak,["headers"]:al},["type"]:"endpoint"},{["conditions"]:bK,endpoint:{["url"]:"https://s3express-control.{Region}.{partitionResult#dnsSuffix}/{uri_encoded_bucket}",["properties"]:ak,["headers"]:al},["type"]:"endpoint"}],["type"]:"tree"}],["type"]:"tree"}],["type"]:"tree"},{["conditions"]:bF,["rules"]:[{["conditions"]:bG,["rules"]:[{["conditions"]:bD,["rules"]:[{["conditions"]:bL,["rules"]:bM,["type"]:"tree"},{["conditions"]:bN,["rules"]:bM,["type"]:"tree"},{["conditions"]:bO,["rules"]:bM,["type"]:"tree"},{["conditions"]:bP,["rules"]:bM,["type"]:"tree"},{["conditions"]:bQ,["rules"]:bM,["type"]:"tree"},at],["type"]:"tree"},{["conditions"]:bL,["rules"]:bR,["type"]:"tree"},{["conditions"]:bN,["rules"]:bR,["type"]:"tree"},{["conditions"]:bO,["rules"]:bR,["type"]:"tree"},{["conditions"]:bP,["rules"]:bR,["type"]:"tree"},{["conditions"]:bQ,["rules"]:bR,["type"]:"tree"},at],["type"]:"tree"}],["type"]:"tree"},an],["type"]:"tree"},{["conditions"]:[ac,{["fn"]:"substring",["argv"]:bS,["assign"]:"accessPointSuffix"},{["fn"]:"stringEquals",["argv"]:[{["ref"]:"accessPointSuffix"},"--xa-s3"]}],["rules"]:[ae,af,{["conditions"]:bF,["rules"]:[{["conditions"]:bG,["rules"]:[{["conditions"]:bD,["rules"]:[{["conditions"]:bT,["rules"]:bM,["type"]:"tree"},{["conditions"]:bU,["rules"]:bM,["type"]:"tree"},{["conditions"]:bV,["rules"]:bM,["type"]:"tree"},{["conditions"]:bW,["rules"]:bM,["type"]:"tree"},{["conditions"]:bX,["rules"]:bM,["type"]:"tree"},at],["type"]:"tree"},{["conditions"]:bT,["rules"]:bR,["type"]:"tree"},{["conditions"]:bU,["rules"]:bR,["type"]:"tree"},{["conditions"]:bV,["rules"]:bR,["type"]:"tree"},{["conditions"]:bW,["rules"]:bR,["type"]:"tree"},{["conditions"]:bX,["rules"]:bR,["type"]:"tree"},at],["type"]:"tree"}],["type"]:"tree"},an],["type"]:"tree"},{["conditions"]:[au,ao,ap],["rules"]:[{["conditions"]:bG,["rules"]:[{["conditions"]:bC,endpoint:{["url"]:"{url#scheme}://{url#authority}{url#path}",["properties"]:ak,["headers"]:al},["type"]:"endpoint"},{["conditions"]:bH,endpoint:{["url"]:"https://s3express-control-fips.dualstack.{Region}.{partitionResult#dnsSuffix}",["properties"]:ak,["headers"]:al},["type"]:"endpoint"},{["conditions"]:bI,endpoint:{["url"]:"https://s3express-control-fips.{Region}.{partitionResult#dnsSuffix}",["properties"]:ak,["headers"]:al},["type"]:"endpoint"},{["conditions"]:bJ,endpoint:{["url"]:"https://s3express-control.dualstack.{Region}.{partitionResult#dnsSuffix}",["properties"]:ak,["headers"]:al},["type"]:"endpoint"},{["conditions"]:bK,endpoint:{["url"]:"https://s3express-control.{Region}.{partitionResult#dnsSuffix}",["properties"]:ak,["headers"]:al},["type"]:"endpoint"}],["type"]:"tree"}],["type"]:"tree"},{["conditions"]:[ac,{["fn"]:"substring",["argv"]:[ad,49,50,!0],["assign"]:"hardwareType"},{["fn"]:"substring",["argv"]:[ad,8,12,!0],["assign"]:"regionPrefix"},{["fn"]:"substring",["argv"]:bS,["assign"]:"bucketAliasSuffix"},{["fn"]:"substring",["argv"]:[ad,32,49,!0],["assign"]:"outpostId"},{["fn"]:"aws.partition",["argv"]:by,["assign"]:"regionPartition"},{["fn"]:"stringEquals",["argv"]:[{["ref"]:"bucketAliasSuffix"},"--op-s3"]}],["rules"]:[{["conditions"]:bZ,["rules"]:[{["conditions"]:bF,["rules"]:[{["conditions"]:[{["fn"]:"stringEquals",["argv"]:[av,"e"]}],["rules"]:[{["conditions"]:ca,["rules"]:[aw,{["conditions"]:bC,endpoint:{["url"]:"https://{Bucket}.ec2.{url#authority}",["properties"]:ax,["headers"]:al},["type"]:"endpoint"}],["type"]:"tree"},{endpoint:{["url"]:"https://{Bucket}.ec2.s3-outposts.{Region}.{regionPartition#dnsSuffix}",["properties"]:ax,["headers"]:al},["type"]:"endpoint"}],["type"]:"tree"},{["conditions"]:[{["fn"]:"stringEquals",["argv"]:[av,"o"]}],["rules"]:[{["conditions"]:ca,["rules"]:[aw,{["conditions"]:bC,endpoint:{["url"]:"https://{Bucket}.op-{outpostId}.{url#authority}",["properties"]:ax,["headers"]:al},["type"]:"endpoint"}],["type"]:"tree"},{endpoint:{["url"]:"https://{Bucket}.op-{outpostId}.s3-outposts.{Region}.{regionPartition#dnsSuffix}",["properties"]:ax,["headers"]:al},["type"]:"endpoint"}],["type"]:"tree"},{error:'Unrecognized hardware type: "Expected hardware type o or e but got {hardwareType}"',["type"]:"error"}],["type"]:"tree"},{error:"Invalid Outposts Bucket alias - it must be a valid bucket name.",["type"]:"error"}],["type"]:"tree"},{error:"Invalid ARN: The outpost Id must only contain a-z, A-Z, 0-9 and `-`.",["type"]:"error"}],["type"]:"tree"},{["conditions"]:bY,["rules"]:[{["conditions"]:[Z,{["fn"]:"not",["argv"]:[{["fn"]:"isSet",["argv"]:[{["fn"]:"parseURL",["argv"]:bz}]}]}],error:"Custom endpoint `{Endpoint}` was not a valid URI",["type"]:"error"},{["conditions"]:[ay,am],["rules"]:[{["conditions"]:bG,["rules"]:[{["conditions"]:cc,["rules"]:[{["conditions"]:[W,ab],error:"S3 Accelerate cannot be used in this region",["type"]:"error"},{["conditions"]:[Y2,X,aA,aq,aB],endpoint:{["url"]:"https://{Bucket}.s3-fips.dualstack.us-east-1.{partitionResult#dnsSuffix}",["properties"]:aC,["headers"]:al},["type"]:"endpoint"},{["conditions"]:[Y2,X,aA,aq,aD,aE],["rules"]:[{endpoint:aF,["type"]:"endpoint"}],["type"]:"tree"},{["conditions"]:[Y2,X,aA,aq,aD,aH],endpoint:aF,["type"]:"endpoint"},{["conditions"]:[ar,X,aA,aq,aB],endpoint:{["url"]:"https://{Bucket}.s3-fips.us-east-1.{partitionResult#dnsSuffix}",["properties"]:aC,["headers"]:al},["type"]:"endpoint"},{["conditions"]:[ar,X,aA,aq,aD,aE],["rules"]:[{endpoint:aI,["type"]:"endpoint"}],["type"]:"tree"},{["conditions"]:[ar,X,aA,aq,aD,aH],endpoint:aI,["type"]:"endpoint"},{["conditions"]:[Y2,as,W,aq,aB],endpoint:{["url"]:"https://{Bucket}.s3-accelerate.dualstack.us-east-1.{partitionResult#dnsSuffix}",["properties"]:aC,["headers"]:al},["type"]:"endpoint"},{["conditions"]:[Y2,as,W,aq,aD,aE],["rules"]:[{endpoint:aJ,["type"]:"endpoint"}],["type"]:"tree"},{["conditions"]:[Y2,as,W,aq,aD,aH],endpoint:aJ,["type"]:"endpoint"},{["conditions"]:[Y2,as,aA,aq,aB],endpoint:{["url"]:"https://{Bucket}.s3.dualstack.us-east-1.{partitionResult#dnsSuffix}",["properties"]:aC,["headers"]:al},["type"]:"endpoint"},{["conditions"]:[Y2,as,aA,aq,aD,aE],["rules"]:[{endpoint:aK,["type"]:"endpoint"}],["type"]:"tree"},{["conditions"]:[Y2,as,aA,aq,aD,aH],endpoint:aK,["type"]:"endpoint"},{["conditions"]:[ar,as,aA,Z,ag,ah,aB],endpoint:{["url"]:"{url#scheme}://{url#authority}{url#normalizedPath}{Bucket}",["properties"]:aC,["headers"]:al},["type"]:"endpoint"},{["conditions"]:[ar,as,aA,Z,ag,aL,aB],endpoint:{["url"]:"{url#scheme}://{Bucket}.{url#authority}{url#path}",["properties"]:aC,["headers"]:al},["type"]:"endpoint"},{["conditions"]:[ar,as,aA,Z,ag,ah,aD,aE],["rules"]:[{["conditions"]:cd,endpoint:aM,["type"]:"endpoint"},{endpoint:aM,["type"]:"endpoint"}],["type"]:"tree"},{["conditions"]:[ar,as,aA,Z,ag,aL,aD,aE],["rules"]:[{["conditions"]:cd,endpoint:aN,["type"]:"endpoint"},aO],["type"]:"tree"},{["conditions"]:[ar,as,aA,Z,ag,ah,aD,aH],endpoint:aM,["type"]:"endpoint"},{["conditions"]:[ar,as,aA,Z,ag,aL,aD,aH],endpoint:aN,["type"]:"endpoint"},{["conditions"]:[ar,as,W,aq,aB],endpoint:{["url"]:"https://{Bucket}.s3-accelerate.{partitionResult#dnsSuffix}",["properties"]:aC,["headers"]:al},["type"]:"endpoint"},{["conditions"]:[ar,as,W,aq,aD,aE],["rules"]:[{["conditions"]:cd,endpoint:aP,["type"]:"endpoint"},{endpoint:aP,["type"]:"endpoint"}],["type"]:"tree"},{["conditions"]:[ar,as,W,aq,aD,aH],endpoint:aP,["type"]:"endpoint"},{["conditions"]:[ar,as,aA,aq,aB],endpoint:{["url"]:"https://{Bucket}.s3.{partitionResult#dnsSuffix}",["properties"]:aC,["headers"]:al},["type"]:"endpoint"},{["conditions"]:[ar,as,aA,aq,aD,aE],["rules"]:[{["conditions"]:cd,endpoint:{["url"]:"https://{Bucket}.s3.{partitionResult#dnsSuffix}",["properties"]:aG,["headers"]:al},["type"]:"endpoint"},{endpoint:aQ,["type"]:"endpoint"}],["type"]:"tree"},{["conditions"]:[ar,as,aA,aq,aD,aH],endpoint:aQ,["type"]:"endpoint"}],["type"]:"tree"},aR],["type"]:"tree"}],["type"]:"tree"},{["conditions"]:[Z,ag,{["fn"]:"stringEquals",["argv"]:[{["fn"]:"getAttr",["argv"]:[ai,"scheme"]},"http"]},{["fn"]:"aws.isVirtualHostableS3Bucket",["argv"]:[ad,!0]},ay,as,ar,aA],["rules"]:[{["conditions"]:bG,["rules"]:[{["conditions"]:cc,["rules"]:[aO],["type"]:"tree"},aR],["type"]:"tree"}],["type"]:"tree"},{["conditions"]:[ay,{["fn"]:"aws.parseArn",["argv"]:bA,["assign"]:"bucketArn"}],["rules"]:[{["conditions"]:[{["fn"]:"getAttr",["argv"]:[aS,"resourceId[0]"],["assign"]:"arnType"},{["fn"]:"not",["argv"]:[{["fn"]:"stringEquals",["argv"]:[aT,""]}]}],["rules"]:[{["conditions"]:[{["fn"]:"stringEquals",["argv"]:[aU,"s3-object-lambda"]}],["rules"]:[{["conditions"]:ce,["rules"]:[{["conditions"]:cf,["rules"]:[aW,aX,{["conditions"]:ci,["rules"]:[aY,{["conditions"]:cj,["rules"]:[aZ,{["conditions"]:cl,["rules"]:[{["conditions"]:bG,["rules"]:[{["conditions"]:cm,["rules"]:[{["conditions"]:cn,["rules"]:[{["conditions"]:[{["fn"]:"stringEquals",["argv"]:[bb,""]}],error:"Invalid ARN: Missing account id",["type"]:"error"},{["conditions"]:co,["rules"]:[{["conditions"]:cp,["rules"]:[{["conditions"]:bC,endpoint:{["url"]:"{url#scheme}://{accessPointName}-{bucketArn#accountId}.{url#authority}{url#path}",["properties"]:bc,["headers"]:al},["type"]:"endpoint"},{["conditions"]:cq,endpoint:{["url"]:"https://{accessPointName}-{bucketArn#accountId}.s3-object-lambda-fips.{bucketArn#region}.{bucketPartition#dnsSuffix}",["properties"]:bc,["headers"]:al},["type"]:"endpoint"},{endpoint:{["url"]:"https://{accessPointName}-{bucketArn#accountId}.s3-object-lambda.{bucketArn#region}.{bucketPartition#dnsSuffix}",["properties"]:bc,["headers"]:al},["type"]:"endpoint"}],["type"]:"tree"},bd],["type"]:"tree"},be],["type"]:"tree"},bf],["type"]:"tree"},bg],["type"]:"tree"}],["type"]:"tree"}],["type"]:"tree"},bh],["type"]:"tree"},{error:"Invalid ARN: bucket ARN is missing a region",["type"]:"error"}],["type"]:"tree"},bi],["type"]:"tree"},{error:"Invalid ARN: Object Lambda ARNs only support `accesspoint` arn types, but found: `{arnType}`",["type"]:"error"}],["type"]:"tree"},{["conditions"]:ce,["rules"]:[{["conditions"]:cf,["rules"]:[{["conditions"]:ci,["rules"]:[{["conditions"]:ce,["rules"]:[{["conditions"]:ci,["rules"]:[aY,{["conditions"]:cj,["rules"]:[aZ,{["conditions"]:cl,["rules"]:[{["conditions"]:bG,["rules"]:[{["conditions"]:[{["fn"]:"stringEquals",["argv"]:[ba,"{partitionResult#name}"]}],["rules"]:[{["conditions"]:cn,["rules"]:[{["conditions"]:[{["fn"]:"stringEquals",["argv"]:[aU,"s3"]}],["rules"]:[{["conditions"]:co,["rules"]:[{["conditions"]:cp,["rules"]:[{["conditions"]:bB,error:"Access Points do not support S3 Accelerate",["type"]:"error"},{["conditions"]:bH,endpoint:{["url"]:"https://{accessPointName}-{bucketArn#accountId}.s3-accesspoint-fips.dualstack.{bucketArn#region}.{bucketPartition#dnsSuffix}",["properties"]:bj,["headers"]:al},["type"]:"endpoint"},{["conditions"]:bI,endpoint:{["url"]:"https://{accessPointName}-{bucketArn#accountId}.s3-accesspoint-fips.{bucketArn#region}.{bucketPartition#dnsSuffix}",["properties"]:bj,["headers"]:al},["type"]:"endpoint"},{["conditions"]:bJ,endpoint:{["url"]:"https://{accessPointName}-{bucketArn#accountId}.s3-accesspoint.dualstack.{bucketArn#region}.{bucketPartition#dnsSuffix}",["properties"]:bj,["headers"]:al},["type"]:"endpoint"},{["conditions"]:[as,ar,Z,ag],endpoint:{["url"]:"{url#scheme}://{accessPointName}-{bucketArn#accountId}.{url#authority}{url#path}",["properties"]:bj,["headers"]:al},["type"]:"endpoint"},{["conditions"]:bK,endpoint:{["url"]:"https://{accessPointName}-{bucketArn#accountId}.s3-accesspoint.{bucketArn#region}.{bucketPartition#dnsSuffix}",["properties"]:bj,["headers"]:al},["type"]:"endpoint"}],["type"]:"tree"},bd],["type"]:"tree"},be],["type"]:"tree"},{error:"Invalid ARN: The ARN was not for the S3 service, found: {bucketArn#service}",["type"]:"error"}],["type"]:"tree"},bf],["type"]:"tree"},bg],["type"]:"tree"}],["type"]:"tree"}],["type"]:"tree"},bh],["type"]:"tree"}],["type"]:"tree"}],["type"]:"tree"},{["conditions"]:[{["fn"]:"isValidHostLabel",["argv"]:[aV,!0]}],["rules"]:[{["conditions"]:ch,error:"S3 MRAP does not support dual-stack",["type"]:"error"},{["conditions"]:cq,error:"S3 MRAP does not support FIPS",["type"]:"error"},{["conditions"]:bB,error:"S3 MRAP does not support S3 Accelerate",["type"]:"error"},{["conditions"]:[{["fn"]:"booleanEquals",["argv"]:[{["ref"]:"DisableMultiRegionAccessPoints"},!0]}],error:"Invalid configuration: Multi-Region Access Point ARNs are disabled.",["type"]:"error"},{["conditions"]:[{["fn"]:"aws.partition",["argv"]:by,["assign"]:"mrapPartition"}],["rules"]:[{["conditions"]:[{["fn"]:"stringEquals",["argv"]:[{["fn"]:"getAttr",["argv"]:[{["ref"]:"mrapPartition"},"name"]},{["fn"]:"getAttr",["argv"]:[aS,"partition"]}]}],["rules"]:[{endpoint:{["url"]:"https://{accessPointName}.accesspoint.s3-global.{mrapPartition#dnsSuffix}",["properties"]:{["authSchemes"]:[{["disableDoubleEncoding"]:!0,name:"sigv4a",["signingName"]:"s3",["signingRegionSet"]:cb}]},["headers"]:al},["type"]:"endpoint"}],["type"]:"tree"},{error:"Client was configured for partition `{mrapPartition#name}` but bucket referred to partition `{bucketArn#partition}`",["type"]:"error"}],["type"]:"tree"}],["type"]:"tree"},{error:"Invalid Access Point Name",["type"]:"error"}],["type"]:"tree"},bi],["type"]:"tree"},{["conditions"]:[{["fn"]:"stringEquals",["argv"]:[aU,"s3-outposts"]}],["rules"]:[{["conditions"]:ch,error:"S3 Outposts does not support Dual-stack",["type"]:"error"},{["conditions"]:cq,error:"S3 Outposts does not support FIPS",["type"]:"error"},{["conditions"]:bB,error:"S3 Outposts does not support S3 Accelerate",["type"]:"error"},{["conditions"]:[{["fn"]:"isSet",["argv"]:[{["fn"]:"getAttr",["argv"]:[aS,"resourceId[4]"]}]}],error:"Invalid Arn: Outpost Access Point ARN contains sub resources",["type"]:"error"},{["conditions"]:[{["fn"]:"getAttr",["argv"]:cg,["assign"]:"outpostId"}],["rules"]:[{["conditions"]:bZ,["rules"]:[aZ,{["conditions"]:cl,["rules"]:[{["conditions"]:bG,["rules"]:[{["conditions"]:cm,["rules"]:[{["conditions"]:cn,["rules"]:[{["conditions"]:co,["rules"]:[{["conditions"]:[{["fn"]:"getAttr",["argv"]:ck,["assign"]:"outpostType"}],["rules"]:[{["conditions"]:[{["fn"]:"getAttr",["argv"]:[aS,"resourceId[3]"],["assign"]:"accessPointName"}],["rules"]:[{["conditions"]:[{["fn"]:"stringEquals",["argv"]:[{["ref"]:"outpostType"},"accesspoint"]}],["rules"]:[{["conditions"]:bC,endpoint:{["url"]:"https://{accessPointName}-{bucketArn#accountId}.{outpostId}.{url#authority}",["properties"]:bk,["headers"]:al},["type"]:"endpoint"},{endpoint:{["url"]:"https://{accessPointName}-{bucketArn#accountId}.{outpostId}.s3-outposts.{bucketArn#region}.{bucketPartition#dnsSuffix}",["properties"]:bk,["headers"]:al},["type"]:"endpoint"}],["type"]:"tree"},{error:"Expected an outpost type `accesspoint`, found {outpostType}",["type"]:"error"}],["type"]:"tree"},{error:"Invalid ARN: expected an access point name",["type"]:"error"}],["type"]:"tree"},{error:"Invalid ARN: Expected a 4-component resource",["type"]:"error"}],["type"]:"tree"},be],["type"]:"tree"},bf],["type"]:"tree"},bg],["type"]:"tree"}],["type"]:"tree"}],["type"]:"tree"},{error:"Invalid ARN: The outpost Id may only contain a-z, A-Z, 0-9 and `-`. Found: `{outpostId}`",["type"]:"error"}],["type"]:"tree"},{error:"Invalid ARN: The Outpost Id was not set",["type"]:"error"}],["type"]:"tree"},{error:"Invalid ARN: Unrecognized format: {Bucket} (type: {arnType})",["type"]:"error"}],["type"]:"tree"},{error:"Invalid ARN: No ARN type specified",["type"]:"error"}],["type"]:"tree"},{["conditions"]:[{["fn"]:"substring",["argv"]:[ad,0,4,!1],["assign"]:"arnPrefix"},{["fn"]:"stringEquals",["argv"]:[{["ref"]:"arnPrefix"},"arn:"]},{["fn"]:"not",["argv"]:[{["fn"]:"isSet",["argv"]:[bl]}]}],error:"Invalid ARN: `{Bucket}` was not a valid ARN",["type"]:"error"},{["conditions"]:[{["fn"]:"booleanEquals",["argv"]:[az,!0]},bl],error:"Path-style addressing cannot be used with ARN buckets",["type"]:"error"},{["conditions"]:bE,["rules"]:[{["conditions"]:bG,["rules"]:[{["conditions"]:[aA],["rules"]:[{["conditions"]:[Y2,aq,X,aB],endpoint:{["url"]:"https://s3-fips.dualstack.us-east-1.{partitionResult#dnsSuffix}/{uri_encoded_bucket}",["properties"]:aC,["headers"]:al},["type"]:"endpoint"},{["conditions"]:[Y2,aq,X,aD,aE],["rules"]:[{endpoint:bm,["type"]:"endpoint"}],["type"]:"tree"},{["conditions"]:[Y2,aq,X,aD,aH],endpoint:bm,["type"]:"endpoint"},{["conditions"]:[ar,aq,X,aB],endpoint:{["url"]:"https://s3-fips.us-east-1.{partitionResult#dnsSuffix}/{uri_encoded_bucket}",["properties"]:aC,["headers"]:al},["type"]:"endpoint"},{["conditions"]:[ar,aq,X,aD,aE],["rules"]:[{endpoint:bn,["type"]:"endpoint"}],["type"]:"tree"},{["conditions"]:[ar,aq,X,aD,aH],endpoint:bn,["type"]:"endpoint"},{["conditions"]:[Y2,aq,as,aB],endpoint:{["url"]:"https://s3.dualstack.us-east-1.{partitionResult#dnsSuffix}/{uri_encoded_bucket}",["properties"]:aC,["headers"]:al},["type"]:"endpoint"},{["conditions"]:[Y2,aq,as,aD,aE],["rules"]:[{endpoint:bo,["type"]:"endpoint"}],["type"]:"tree"},{["conditions"]:[Y2,aq,as,aD,aH],endpoint:bo,["type"]:"endpoint"},{["conditions"]:[ar,Z,ag,as,aB],endpoint:{["url"]:"{url#scheme}://{url#authority}{url#normalizedPath}{uri_encoded_bucket}",["properties"]:aC,["headers"]:al},["type"]:"endpoint"},{["conditions"]:[ar,Z,ag,as,aD,aE],["rules"]:[{["conditions"]:cd,endpoint:bp,["type"]:"endpoint"},{endpoint:bp,["type"]:"endpoint"}],["type"]:"tree"},{["conditions"]:[ar,Z,ag,as,aD,aH],endpoint:bp,["type"]:"endpoint"},{["conditions"]:[ar,aq,as,aB],endpoint:{["url"]:"https://s3.{partitionResult#dnsSuffix}/{uri_encoded_bucket}",["properties"]:aC,["headers"]:al},["type"]:"endpoint"},{["conditions"]:[ar,aq,as,aD,aE],["rules"]:[{["conditions"]:cd,endpoint:{["url"]:"https://s3.{partitionResult#dnsSuffix}/{uri_encoded_bucket}",["properties"]:aG,["headers"]:al},["type"]:"endpoint"},{endpoint:bq,["type"]:"endpoint"}],["type"]:"tree"},{["conditions"]:[ar,aq,as,aD,aH],endpoint:bq,["type"]:"endpoint"}],["type"]:"tree"},{error:"Path-style addressing cannot be used with S3 Accelerate",["type"]:"error"}],["type"]:"tree"}],["type"]:"tree"}],["type"]:"tree"},{["conditions"]:[{["fn"]:"isSet",["argv"]:[br]},{["fn"]:"booleanEquals",["argv"]:[br,!0]}],["rules"]:[{["conditions"]:bG,["rules"]:[{["conditions"]:cr,["rules"]:[aW,aX,{["conditions"]:bC,endpoint:{["url"]:"{url#scheme}://{url#authority}{url#path}",["properties"]:bs,["headers"]:al},["type"]:"endpoint"},{["conditions"]:cq,endpoint:{["url"]:"https://s3-object-lambda-fips.{Region}.{partitionResult#dnsSuffix}",["properties"]:bs,["headers"]:al},["type"]:"endpoint"},{endpoint:{["url"]:"https://s3-object-lambda.{Region}.{partitionResult#dnsSuffix}",["properties"]:bs,["headers"]:al},["type"]:"endpoint"}],["type"]:"tree"},aR],["type"]:"tree"}],["type"]:"tree"},{["conditions"]:[au],["rules"]:[{["conditions"]:bG,["rules"]:[{["conditions"]:cr,["rules"]:[{["conditions"]:[X,Y2,aq,aB],endpoint:{["url"]:"https://s3-fips.dualstack.us-east-1.{partitionResult#dnsSuffix}",["properties"]:aC,["headers"]:al},["type"]:"endpoint"},{["conditions"]:[X,Y2,aq,aD,aE],["rules"]:[{endpoint:bt,["type"]:"endpoint"}],["type"]:"tree"},{["conditions"]:[X,Y2,aq,aD,aH],endpoint:bt,["type"]:"endpoint"},{["conditions"]:[X,ar,aq,aB],endpoint:{["url"]:"https://s3-fips.us-east-1.{partitionResult#dnsSuffix}",["properties"]:aC,["headers"]:al},["type"]:"endpoint"},{["conditions"]:[X,ar,aq,aD,aE],["rules"]:[{endpoint:bu,["type"]:"endpoint"}],["type"]:"tree"},{["conditions"]:[X,ar,aq,aD,aH],endpoint:bu,["type"]:"endpoint"},{["conditions"]:[as,Y2,aq,aB],endpoint:{["url"]:"https://s3.dualstack.us-east-1.{partitionResult#dnsSuffix}",["properties"]:aC,["headers"]:al},["type"]:"endpoint"},{["conditions"]:[as,Y2,aq,aD,aE],["rules"]:[{endpoint:bv,["type"]:"endpoint"}],["type"]:"tree"},{["conditions"]:[as,Y2,aq,aD,aH],endpoint:bv,["type"]:"endpoint"},{["conditions"]:[as,ar,Z,ag,aB],endpoint:{["url"]:"{url#scheme}://{url#authority}{url#path}",["properties"]:aC,["headers"]:al},["type"]:"endpoint"},{["conditions"]:[as,ar,Z,ag,aD,aE],["rules"]:[{["conditions"]:cd,endpoint:bw,["type"]:"endpoint"},{endpoint:bw,["type"]:"endpoint"}],["type"]:"tree"},{["conditions"]:[as,ar,Z,ag,aD,aH],endpoint:bw,["type"]:"endpoint"},{["conditions"]:[as,ar,aq,aB],endpoint:{["url"]:"https://s3.{partitionResult#dnsSuffix}",["properties"]:aC,["headers"]:al},["type"]:"endpoint"},{["conditions"]:[as,ar,aq,aD,aE],["rules"]:[{["conditions"]:cd,endpoint:{["url"]:"https://s3.{partitionResult#dnsSuffix}",["properties"]:aG,["headers"]:al},["type"]:"endpoint"},{endpoint:bx,["type"]:"endpoint"}],["type"]:"tree"},{["conditions"]:[as,ar,aq,aD,aH],endpoint:bx,["type"]:"endpoint"}],["type"]:"tree"},aR],["type"]:"tree"}],["type"]:"tree"}],["type"]:"tree"},{error:"A region must be set when sending requests to S3.",["type"]:"error"}]},ruleSet=_data;var cache2=new import_util_endpoints2.EndpointCache({size:50,params:["Accelerate","Bucket","DisableAccessPoints","DisableMultiRegionAccessPoints","DisableS3ExpressSessionAuth","Endpoint","ForcePathStyle","Region","UseArnRegion","UseDualStack","UseFIPS","UseGlobalEndpoint","UseObjectLambdaEndpoint","UseS3ExpressControlEndpoint"]}),defaultEndpointResolver=(endpointParams,context={})=>{return cache2.get(endpointParams,()=>import_util_endpoints2.resolveEndpoint(ruleSet,{endpointParams,logger:context.logger}))};import_util_endpoints2.customEndpointFunctions.aws=import_util_endpoints.awsEndpointFunctions;var createEndpointRuleSetHttpAuthSchemeParametersProvider=(defaultHttpAuthSchemeParametersProvider)=>async(config,context,input)=>{if(!input)throw Error("Could not find `input` for `defaultEndpointRuleSetHttpAuthSchemeParametersProvider`");let defaultParameters=await defaultHttpAuthSchemeParametersProvider(config,context,input),instructionsFn=import_util_middleware3.getSmithyContext(context)?.commandInstance?.constructor?.getEndpointParameterInstructions;if(!instructionsFn)throw Error(`getEndpointParameterInstructions() is not defined on '${context.commandName}'`);let endpointParameters=await import_middleware_endpoint.resolveParams(input,{getEndpointParameterInstructions:instructionsFn},config);return Object.assign(defaultParameters,endpointParameters)},_defaultS3HttpAuthSchemeParametersProvider=async(config,context,input)=>{return{operation:import_util_middleware3.getSmithyContext(context).operation,region:await import_util_middleware3.normalizeProvider(config.region)()||(()=>{throw Error("expected `region` to be configured for `aws.auth#sigv4`")})()}},defaultS3HttpAuthSchemeParametersProvider=createEndpointRuleSetHttpAuthSchemeParametersProvider(_defaultS3HttpAuthSchemeParametersProvider);function createAwsAuthSigv4HttpAuthOption(authParameters){return{schemeId:"aws.auth#sigv4",signingProperties:{name:"s3",region:authParameters.region},propertiesExtractor:(config,context)=>({signingProperties:{config,context}})}}function createAwsAuthSigv4aHttpAuthOption(authParameters){return{schemeId:"aws.auth#sigv4a",signingProperties:{name:"s3",region:authParameters.region},propertiesExtractor:(config,context)=>({signingProperties:{config,context}})}}var createEndpointRuleSetHttpAuthSchemeProvider=(defaultEndpointResolver2,defaultHttpAuthSchemeResolver,createHttpAuthOptionFunctions)=>{return(authParameters)=>{let authSchemes=defaultEndpointResolver2(authParameters).properties?.authSchemes;if(!authSchemes)return defaultHttpAuthSchemeResolver(authParameters);let options=[];for(let scheme of authSchemes){let{name:resolvedName,properties={},...rest}=scheme,name=resolvedName.toLowerCase();if(resolvedName!==name)console.warn(`HttpAuthScheme has been normalized with lowercasing: '${resolvedName}' to '${name}'`);let schemeId;if(name==="sigv4a"){schemeId="aws.auth#sigv4a";let sigv4Present=authSchemes.find((s)=>{let name2=s.name.toLowerCase();return name2!=="sigv4a"&&name2.startsWith("sigv4")});if(SignatureV4MultiRegion.sigv4aDependency()==="none"&&sigv4Present)continue}else if(name.startsWith("sigv4"))schemeId="aws.auth#sigv4";else throw Error(`Unknown HttpAuthScheme found in '@smithy.rules#endpointRuleSet': '${name}'`);let createOption=createHttpAuthOptionFunctions[schemeId];if(!createOption)throw Error(`Could not find HttpAuthOption create function for '${schemeId}'`);let option=createOption(authParameters);option.schemeId=schemeId,option.signingProperties={...option.signingProperties||{},...rest,...properties},options.push(option)}return options}},_defaultS3HttpAuthSchemeProvider=(authParameters)=>{let options=[];switch(authParameters.operation){default:options.push(createAwsAuthSigv4HttpAuthOption(authParameters)),options.push(createAwsAuthSigv4aHttpAuthOption(authParameters))}return options},defaultS3HttpAuthSchemeProvider=createEndpointRuleSetHttpAuthSchemeProvider(defaultEndpointResolver,_defaultS3HttpAuthSchemeProvider,{"aws.auth#sigv4":createAwsAuthSigv4HttpAuthOption,"aws.auth#sigv4a":createAwsAuthSigv4aHttpAuthOption}),resolveHttpAuthSchemeConfig=(config)=>{let config_0=import_core10.resolveAwsSdkSigV4Config(config),config_1=import_core10.resolveAwsSdkSigV4AConfig(config_0);return Object.assign(config_1,{authSchemePreference:import_util_middleware3.normalizeProvider(config.authSchemePreference??[])})};var import_middleware_endpoint2=__toESM(require_dist_cjs37(),1),import_smithy_client4=__toESM(require_dist_cjs21(),1);var resolveClientEndpointParameters=(options)=>{return Object.assign(options,{useFipsEndpoint:options.useFipsEndpoint??!1,useDualstackEndpoint:options.useDualstackEndpoint??!1,forcePathStyle:options.forcePathStyle??!1,useAccelerateEndpoint:options.useAccelerateEndpoint??!1,useGlobalEndpoint:options.useGlobalEndpoint??!1,disableMultiregionAccessPoints:options.disableMultiregionAccessPoints??!1,defaultSigningName:"s3",clientContextParams:options.clientContextParams??{}})},commonParams={ForcePathStyle:{type:"clientContextParams",name:"forcePathStyle"},UseArnRegion:{type:"clientContextParams",name:"useArnRegion"},DisableMultiRegionAccessPoints:{type:"clientContextParams",name:"disableMultiregionAccessPoints"},Accelerate:{type:"clientContextParams",name:"useAccelerateEndpoint"},DisableS3ExpressSessionAuth:{type:"clientContextParams",name:"disableS3ExpressSessionAuth"},UseGlobalEndpoint:{type:"builtInParams",name:"useGlobalEndpoint"},UseFIPS:{type:"builtInParams",name:"useFipsEndpoint"},Endpoint:{type:"builtInParams",name:"endpoint"},Region:{type:"builtInParams",name:"region"},UseDualStack:{type:"builtInParams",name:"useDualstackEndpoint"}};var import_schema7=__toESM(require_schema(),1);var import_smithy_client3=__toESM(require_dist_cjs21(),1);class S3ServiceException extends import_smithy_client3.ServiceException{constructor(options){super(options);Object.setPrototypeOf(this,S3ServiceException.prototype)}}class NoSuchUpload extends S3ServiceException{name="NoSuchUpload";$fault="client";constructor(opts){super({name:"NoSuchUpload",$fault:"client",...opts});Object.setPrototypeOf(this,NoSuchUpload.prototype)}}class AccessDenied extends S3ServiceException{name="AccessDenied";$fault="client";constructor(opts){super({name:"AccessDenied",$fault:"client",...opts});Object.setPrototypeOf(this,AccessDenied.prototype)}}class ObjectNotInActiveTierError extends S3ServiceException{name="ObjectNotInActiveTierError";$fault="client";constructor(opts){super({name:"ObjectNotInActiveTierError",$fault:"client",...opts});Object.setPrototypeOf(this,ObjectNotInActiveTierError.prototype)}}class BucketAlreadyExists extends S3ServiceException{name="BucketAlreadyExists";$fault="client";constructor(opts){super({name:"BucketAlreadyExists",$fault:"client",...opts});Object.setPrototypeOf(this,BucketAlreadyExists.prototype)}}class BucketAlreadyOwnedByYou extends S3ServiceException{name="BucketAlreadyOwnedByYou";$fault="client";constructor(opts){super({name:"BucketAlreadyOwnedByYou",$fault:"client",...opts});Object.setPrototypeOf(this,BucketAlreadyOwnedByYou.prototype)}}class NoSuchBucket extends S3ServiceException{name="NoSuchBucket";$fault="client";constructor(opts){super({name:"NoSuchBucket",$fault:"client",...opts});Object.setPrototypeOf(this,NoSuchBucket.prototype)}}class InvalidObjectState extends S3ServiceException{name="InvalidObjectState";$fault="client";StorageClass;AccessTier;constructor(opts){super({name:"InvalidObjectState",$fault:"client",...opts});Object.setPrototypeOf(this,InvalidObjectState.prototype),this.StorageClass=opts.StorageClass,this.AccessTier=opts.AccessTier}}class NoSuchKey extends S3ServiceException{name="NoSuchKey";$fault="client";constructor(opts){super({name:"NoSuchKey",$fault:"client",...opts});Object.setPrototypeOf(this,NoSuchKey.prototype)}}class NotFound extends S3ServiceException{name="NotFound";$fault="client";constructor(opts){super({name:"NotFound",$fault:"client",...opts});Object.setPrototypeOf(this,NotFound.prototype)}}class EncryptionTypeMismatch extends S3ServiceException{name="EncryptionTypeMismatch";$fault="client";constructor(opts){super({name:"EncryptionTypeMismatch",$fault:"client",...opts});Object.setPrototypeOf(this,EncryptionTypeMismatch.prototype)}}class InvalidRequest extends S3ServiceException{name="InvalidRequest";$fault="client";constructor(opts){super({name:"InvalidRequest",$fault:"client",...opts});Object.setPrototypeOf(this,InvalidRequest.prototype)}}class InvalidWriteOffset extends S3ServiceException{name="InvalidWriteOffset";$fault="client";constructor(opts){super({name:"InvalidWriteOffset",$fault:"client",...opts});Object.setPrototypeOf(this,InvalidWriteOffset.prototype)}}class TooManyParts extends S3ServiceException{name="TooManyParts";$fault="client";constructor(opts){super({name:"TooManyParts",$fault:"client",...opts});Object.setPrototypeOf(this,TooManyParts.prototype)}}class IdempotencyParameterMismatch extends S3ServiceException{name="IdempotencyParameterMismatch";$fault="client";constructor(opts){super({name:"IdempotencyParameterMismatch",$fault:"client",...opts});Object.setPrototypeOf(this,IdempotencyParameterMismatch.prototype)}}class ObjectAlreadyInActiveTierError extends S3ServiceException{name="ObjectAlreadyInActiveTierError";$fault="client";constructor(opts){super({name:"ObjectAlreadyInActiveTierError",$fault:"client",...opts});Object.setPrototypeOf(this,ObjectAlreadyInActiveTierError.prototype)}}var _s_registry=import_schema7.TypeRegistry.for("smithy.ts.sdk.synthetic.com.amazonaws.s3"),S3ServiceException$=[-3,"smithy.ts.sdk.synthetic.com.amazonaws.s3","S3ServiceException",0,[],[]];_s_registry.registerError(S3ServiceException$,S3ServiceException);var n0_registry=import_schema7.TypeRegistry.for("com.amazonaws.s3"),AccessDenied$=[-3,"com.amazonaws.s3","AccessDenied",{["error"]:"client",["httpError"]:403},[],[]];n0_registry.registerError(AccessDenied$,AccessDenied);var BucketAlreadyExists$=[-3,"com.amazonaws.s3","BucketAlreadyExists",{["error"]:"client",["httpError"]:409},[],[]];n0_registry.registerError(BucketAlreadyExists$,BucketAlreadyExists);var BucketAlreadyOwnedByYou$=[-3,"com.amazonaws.s3","BucketAlreadyOwnedByYou",{["error"]:"client",["httpError"]:409},[],[]];n0_registry.registerError(BucketAlreadyOwnedByYou$,BucketAlreadyOwnedByYou);var EncryptionTypeMismatch$=[-3,"com.amazonaws.s3","EncryptionTypeMismatch",{["error"]:"client",["httpError"]:400},[],[]];n0_registry.registerError(EncryptionTypeMismatch$,EncryptionTypeMismatch);var IdempotencyParameterMismatch$=[-3,"com.amazonaws.s3","IdempotencyParameterMismatch",{["error"]:"client",["httpError"]:400},[],[]];n0_registry.registerError(IdempotencyParameterMismatch$,IdempotencyParameterMismatch);var InvalidObjectState$=[-3,"com.amazonaws.s3","InvalidObjectState",{["error"]:"client",["httpError"]:403},["StorageClass","AccessTier"],[0,0]];n0_registry.registerError(InvalidObjectState$,InvalidObjectState);var InvalidRequest$=[-3,"com.amazonaws.s3","InvalidRequest",{["error"]:"client",["httpError"]:400},[],[]];n0_registry.registerError(InvalidRequest$,InvalidRequest);var InvalidWriteOffset$=[-3,"com.amazonaws.s3","InvalidWriteOffset",{["error"]:"client",["httpError"]:400},[],[]];n0_registry.registerError(InvalidWriteOffset$,InvalidWriteOffset);var NoSuchBucket$=[-3,"com.amazonaws.s3","NoSuchBucket",{["error"]:"client",["httpError"]:404},[],[]];n0_registry.registerError(NoSuchBucket$,NoSuchBucket);var NoSuchKey$=[-3,"com.amazonaws.s3","NoSuchKey",{["error"]:"client",["httpError"]:404},[],[]];n0_registry.registerError(NoSuchKey$,NoSuchKey);var NoSuchUpload$=[-3,"com.amazonaws.s3","NoSuchUpload",{["error"]:"client",["httpError"]:404},[],[]];n0_registry.registerError(NoSuchUpload$,NoSuchUpload);var NotFound$=[-3,"com.amazonaws.s3","NotFound",{["error"]:"client"},[],[]];n0_registry.registerError(NotFound$,NotFound);var ObjectAlreadyInActiveTierError$=[-3,"com.amazonaws.s3","ObjectAlreadyInActiveTierError",{["error"]:"client",["httpError"]:403},[],[]];n0_registry.registerError(ObjectAlreadyInActiveTierError$,ObjectAlreadyInActiveTierError);var ObjectNotInActiveTierError$=[-3,"com.amazonaws.s3","ObjectNotInActiveTierError",{["error"]:"client",["httpError"]:403},[],[]];n0_registry.registerError(ObjectNotInActiveTierError$,ObjectNotInActiveTierError);var TooManyParts$=[-3,"com.amazonaws.s3","TooManyParts",{["error"]:"client",["httpError"]:400},[],[]];n0_registry.registerError(TooManyParts$,TooManyParts);var errorTypeRegistries=[_s_registry,n0_registry];var SessionCredentialValue=[0,"com.amazonaws.s3","SessionCredentialValue",8,0],SSECustomerKey=[0,"com.amazonaws.s3","SSECustomerKey",8,0],SSEKMSEncryptionContext=[0,"com.amazonaws.s3","SSEKMSEncryptionContext",8,0],SSEKMSKeyId=[0,"com.amazonaws.s3","SSEKMSKeyId",8,0],StreamingBlob=[0,"com.amazonaws.s3","StreamingBlob",{["streaming"]:1},42];var CreateSessionOutput$=[3,"com.amazonaws.s3","CreateSessionOutput",{["xmlName"]:"CreateSessionResult"},["Credentials","ServerSideEncryption","SSEKMSKeyId","SSEKMSEncryptionContext","BucketKeyEnabled"],[[()=>SessionCredentials$,{["xmlName"]:"Credentials"}],[0,{["httpHeader"]:"x-amz-server-side-encryption"}],[()=>SSEKMSKeyId,{["httpHeader"]:"x-amz-server-side-encryption-aws-kms-key-id"}],[()=>SSEKMSEncryptionContext,{["httpHeader"]:"x-amz-server-side-encryption-context"}],[2,{["httpHeader"]:"x-amz-server-side-encryption-bucket-key-enabled"}]],1],CreateSessionRequest$=[3,"com.amazonaws.s3","CreateSessionRequest",0,["Bucket","SessionMode","ServerSideEncryption","SSEKMSKeyId","SSEKMSEncryptionContext","BucketKeyEnabled"],[[0,1],[0,{["httpHeader"]:"x-amz-create-session-mode"}],[0,{["httpHeader"]:"x-amz-server-side-encryption"}],[()=>SSEKMSKeyId,{["httpHeader"]:"x-amz-server-side-encryption-aws-kms-key-id"}],[()=>SSEKMSEncryptionContext,{["httpHeader"]:"x-amz-server-side-encryption-context"}],[2,{["httpHeader"]:"x-amz-server-side-encryption-bucket-key-enabled"}]],1];var GetObjectOutput$=[3,"com.amazonaws.s3","GetObjectOutput",0,["Body","DeleteMarker","AcceptRanges","Expiration","Restore","LastModified","ContentLength","ETag","ChecksumCRC32","ChecksumCRC32C","ChecksumCRC64NVME","ChecksumSHA1","ChecksumSHA256","ChecksumType","MissingMeta","VersionId","CacheControl","ContentDisposition","ContentEncoding","ContentLanguage","ContentRange","ContentType","Expires","ExpiresString","WebsiteRedirectLocation","ServerSideEncryption","Metadata","SSECustomerAlgorithm","SSECustomerKeyMD5","SSEKMSKeyId","BucketKeyEnabled","StorageClass","RequestCharged","ReplicationStatus","PartsCount","TagCount","ObjectLockMode","ObjectLockRetainUntilDate","ObjectLockLegalHoldStatus"],[[()=>StreamingBlob,16],[2,{["httpHeader"]:"x-amz-delete-marker"}],[0,{["httpHeader"]:"accept-ranges"}],[0,{["httpHeader"]:"x-amz-expiration"}],[0,{["httpHeader"]:"x-amz-restore"}],[4,{["httpHeader"]:"Last-Modified"}],[1,{["httpHeader"]:"Content-Length"}],[0,{["httpHeader"]:"ETag"}],[0,{["httpHeader"]:"x-amz-checksum-crc32"}],[0,{["httpHeader"]:"x-amz-checksum-crc32c"}],[0,{["httpHeader"]:"x-amz-checksum-crc64nvme"}],[0,{["httpHeader"]:"x-amz-checksum-sha1"}],[0,{["httpHeader"]:"x-amz-checksum-sha256"}],[0,{["httpHeader"]:"x-amz-checksum-type"}],[1,{["httpHeader"]:"x-amz-missing-meta"}],[0,{["httpHeader"]:"x-amz-version-id"}],[0,{["httpHeader"]:"Cache-Control"}],[0,{["httpHeader"]:"Content-Disposition"}],[0,{["httpHeader"]:"Content-Encoding"}],[0,{["httpHeader"]:"Content-Language"}],[0,{["httpHeader"]:"Content-Range"}],[0,{["httpHeader"]:"Content-Type"}],[4,{["httpHeader"]:"Expires"}],[0,{["httpHeader"]:"ExpiresString"}],[0,{["httpHeader"]:"x-amz-website-redirect-location"}],[0,{["httpHeader"]:"x-amz-server-side-encryption"}],[128,{["httpPrefixHeaders"]:"x-amz-meta-"}],[0,{["httpHeader"]:"x-amz-server-side-encryption-customer-algorithm"}],[0,{["httpHeader"]:"x-amz-server-side-encryption-customer-key-MD5"}],[()=>SSEKMSKeyId,{["httpHeader"]:"x-amz-server-side-encryption-aws-kms-key-id"}],[2,{["httpHeader"]:"x-amz-server-side-encryption-bucket-key-enabled"}],[0,{["httpHeader"]:"x-amz-storage-class"}],[0,{["httpHeader"]:"x-amz-request-charged"}],[0,{["httpHeader"]:"x-amz-replication-status"}],[1,{["httpHeader"]:"x-amz-mp-parts-count"}],[1,{["httpHeader"]:"x-amz-tagging-count"}],[0,{["httpHeader"]:"x-amz-object-lock-mode"}],[5,{["httpHeader"]:"x-amz-object-lock-retain-until-date"}],[0,{["httpHeader"]:"x-amz-object-lock-legal-hold"}]]],GetObjectRequest$=[3,"com.amazonaws.s3","GetObjectRequest",0,["Bucket","Key","IfMatch","IfModifiedSince","IfNoneMatch","IfUnmodifiedSince","Range","ResponseCacheControl","ResponseContentDisposition","ResponseContentEncoding","ResponseContentLanguage","ResponseContentType","ResponseExpires","VersionId","SSECustomerAlgorithm","SSECustomerKey","SSECustomerKeyMD5","RequestPayer","PartNumber","ExpectedBucketOwner","ChecksumMode"],[[0,1],[0,1],[0,{["httpHeader"]:"If-Match"}],[4,{["httpHeader"]:"If-Modified-Since"}],[0,{["httpHeader"]:"If-None-Match"}],[4,{["httpHeader"]:"If-Unmodified-Since"}],[0,{["httpHeader"]:"Range"}],[0,{["httpQuery"]:"response-cache-control"}],[0,{["httpQuery"]:"response-content-disposition"}],[0,{["httpQuery"]:"response-content-encoding"}],[0,{["httpQuery"]:"response-content-language"}],[0,{["httpQuery"]:"response-content-type"}],[6,{["httpQuery"]:"response-expires"}],[0,{["httpQuery"]:"versionId"}],[0,{["httpHeader"]:"x-amz-server-side-encryption-customer-algorithm"}],[()=>SSECustomerKey,{["httpHeader"]:"x-amz-server-side-encryption-customer-key"}],[0,{["httpHeader"]:"x-amz-server-side-encryption-customer-key-MD5"}],[0,{["httpHeader"]:"x-amz-request-payer"}],[1,{["httpQuery"]:"partNumber"}],[0,{["httpHeader"]:"x-amz-expected-bucket-owner"}],[0,{["httpHeader"]:"x-amz-checksum-mode"}]],2];var PutObjectOutput$=[3,"com.amazonaws.s3","PutObjectOutput",0,["Expiration","ETag","ChecksumCRC32","ChecksumCRC32C","ChecksumCRC64NVME","ChecksumSHA1","ChecksumSHA256","ChecksumType","ServerSideEncryption","VersionId","SSECustomerAlgorithm","SSECustomerKeyMD5","SSEKMSKeyId","SSEKMSEncryptionContext","BucketKeyEnabled","Size","RequestCharged"],[[0,{["httpHeader"]:"x-amz-expiration"}],[0,{["httpHeader"]:"ETag"}],[0,{["httpHeader"]:"x-amz-checksum-crc32"}],[0,{["httpHeader"]:"x-amz-checksum-crc32c"}],[0,{["httpHeader"]:"x-amz-checksum-crc64nvme"}],[0,{["httpHeader"]:"x-amz-checksum-sha1"}],[0,{["httpHeader"]:"x-amz-checksum-sha256"}],[0,{["httpHeader"]:"x-amz-checksum-type"}],[0,{["httpHeader"]:"x-amz-server-side-encryption"}],[0,{["httpHeader"]:"x-amz-version-id"}],[0,{["httpHeader"]:"x-amz-server-side-encryption-customer-algorithm"}],[0,{["httpHeader"]:"x-amz-server-side-encryption-customer-key-MD5"}],[()=>SSEKMSKeyId,{["httpHeader"]:"x-amz-server-side-encryption-aws-kms-key-id"}],[()=>SSEKMSEncryptionContext,{["httpHeader"]:"x-amz-server-side-encryption-context"}],[2,{["httpHeader"]:"x-amz-server-side-encryption-bucket-key-enabled"}],[1,{["httpHeader"]:"x-amz-object-size"}],[0,{["httpHeader"]:"x-amz-request-charged"}]]],PutObjectRequest$=[3,"com.amazonaws.s3","PutObjectRequest",0,["Bucket","Key","ACL","Body","CacheControl","ContentDisposition","ContentEncoding","ContentLanguage","ContentLength","ContentMD5","ContentType","ChecksumAlgorithm","ChecksumCRC32","ChecksumCRC32C","ChecksumCRC64NVME","ChecksumSHA1","ChecksumSHA256","Expires","IfMatch","IfNoneMatch","GrantFullControl","GrantRead","GrantReadACP","GrantWriteACP","WriteOffsetBytes","Metadata","ServerSideEncryption","StorageClass","WebsiteRedirectLocation","SSECustomerAlgorithm","SSECustomerKey","SSECustomerKeyMD5","SSEKMSKeyId","SSEKMSEncryptionContext","BucketKeyEnabled","RequestPayer","Tagging","ObjectLockMode","ObjectLockRetainUntilDate","ObjectLockLegalHoldStatus","ExpectedBucketOwner"],[[0,1],[0,1],[0,{["httpHeader"]:"x-amz-acl"}],[()=>StreamingBlob,16],[0,{["httpHeader"]:"Cache-Control"}],[0,{["httpHeader"]:"Content-Disposition"}],[0,{["httpHeader"]:"Content-Encoding"}],[0,{["httpHeader"]:"Content-Language"}],[1,{["httpHeader"]:"Content-Length"}],[0,{["httpHeader"]:"Content-MD5"}],[0,{["httpHeader"]:"Content-Type"}],[0,{["httpHeader"]:"x-amz-sdk-checksum-algorithm"}],[0,{["httpHeader"]:"x-amz-checksum-crc32"}],[0,{["httpHeader"]:"x-amz-checksum-crc32c"}],[0,{["httpHeader"]:"x-amz-checksum-crc64nvme"}],[0,{["httpHeader"]:"x-amz-checksum-sha1"}],[0,{["httpHeader"]:"x-amz-checksum-sha256"}],[4,{["httpHeader"]:"Expires"}],[0,{["httpHeader"]:"If-Match"}],[0,{["httpHeader"]:"If-None-Match"}],[0,{["httpHeader"]:"x-amz-grant-full-control"}],[0,{["httpHeader"]:"x-amz-grant-read"}],[0,{["httpHeader"]:"x-amz-grant-read-acp"}],[0,{["httpHeader"]:"x-amz-grant-write-acp"}],[1,{["httpHeader"]:"x-amz-write-offset-bytes"}],[128,{["httpPrefixHeaders"]:"x-amz-meta-"}],[0,{["httpHeader"]:"x-amz-server-side-encryption"}],[0,{["httpHeader"]:"x-amz-storage-class"}],[0,{["httpHeader"]:"x-amz-website-redirect-location"}],[0,{["httpHeader"]:"x-amz-server-side-encryption-customer-algorithm"}],[()=>SSECustomerKey,{["httpHeader"]:"x-amz-server-side-encryption-customer-key"}],[0,{["httpHeader"]:"x-amz-server-side-encryption-customer-key-MD5"}],[()=>SSEKMSKeyId,{["httpHeader"]:"x-amz-server-side-encryption-aws-kms-key-id"}],[()=>SSEKMSEncryptionContext,{["httpHeader"]:"x-amz-server-side-encryption-context"}],[2,{["httpHeader"]:"x-amz-server-side-encryption-bucket-key-enabled"}],[0,{["httpHeader"]:"x-amz-request-payer"}],[0,{["httpHeader"]:"x-amz-tagging"}],[0,{["httpHeader"]:"x-amz-object-lock-mode"}],[5,{["httpHeader"]:"x-amz-object-lock-retain-until-date"}],[0,{["httpHeader"]:"x-amz-object-lock-legal-hold"}],[0,{["httpHeader"]:"x-amz-expected-bucket-owner"}]],2];var SessionCredentials$=[3,"com.amazonaws.s3","SessionCredentials",0,["AccessKeyId","SecretAccessKey","SessionToken","Expiration"],[[0,{["xmlName"]:"AccessKeyId"}],[()=>SessionCredentialValue,{["xmlName"]:"SecretAccessKey"}],[()=>SessionCredentialValue,{["xmlName"]:"SessionToken"}],[4,{["xmlName"]:"Expiration"}]],4];var CreateSession$=[9,"com.amazonaws.s3","CreateSession",{["http"]:["GET","/?session",200]},()=>CreateSessionRequest$,()=>CreateSessionOutput$];var GetObject$=[9,"com.amazonaws.s3","GetObject",{["httpChecksum"]:"-",["http"]:["GET","/{Key+}?x-id=GetObject",200]},()=>GetObjectRequest$,()=>GetObjectOutput$];var PutObject$=[9,"com.amazonaws.s3","PutObject",{["httpChecksum"]:"-",["http"]:["PUT","/{Key+}?x-id=PutObject",200]},()=>PutObjectRequest$,()=>PutObjectOutput$];class CreateSessionCommand extends import_smithy_client4.Command.classBuilder().ep({...commonParams,DisableS3ExpressSessionAuth:{type:"staticContextParams",value:!0},Bucket:{type:"contextParams",name:"Bucket"}}).m(function(Command,cs,config,o){return[import_middleware_endpoint2.getEndpointPlugin(config,Command.getEndpointParameterInstructions()),getThrow200ExceptionsPlugin(config)]}).s("AmazonS3","CreateSession",{}).n("S3Client","CreateSessionCommand").sc(CreateSession$).build(){}var package_default={name:"@aws-sdk/client-s3",description:"AWS SDK for JavaScript S3 Client for Node.js, Browser and React Native",version:"3.988.0",scripts:{build:"concurrently 'yarn:build:types' 'yarn:build:es' && yarn build:cjs","build:cjs":"node ../../scripts/compilation/inline client-s3","build:es":"tsc -p tsconfig.es.json","build:include:deps":'yarn g:turbo run build -F="$npm_package_name"',"build:types":"tsc -p tsconfig.types.json","build:types:downlevel":"downlevel-dts dist-types dist-types/ts3.4",clean:"premove dist-cjs dist-es dist-types tsconfig.cjs.tsbuildinfo tsconfig.es.tsbuildinfo tsconfig.types.tsbuildinfo","extract:docs":"api-extractor run --local","generate:client":"node ../../scripts/generate-clients/single-service --solo s3",test:"yarn g:vitest run","test:browser":"node ./test/browser-build/esbuild && yarn g:vitest run -c vitest.config.browser.mts","test:browser:watch":"node ./test/browser-build/esbuild && yarn g:vitest watch -c vitest.config.browser.mts","test:e2e":"yarn g:vitest run -c vitest.config.e2e.mts && yarn test:browser","test:e2e:watch":"yarn g:vitest watch -c vitest.config.e2e.mts","test:index":"tsc --noEmit ./test/index-types.ts && node ./test/index-objects.spec.mjs","test:integration":"yarn g:vitest run -c vitest.config.integ.mts","test:integration:watch":"yarn g:vitest watch -c vitest.config.integ.mts","test:watch":"yarn g:vitest watch"},main:"./dist-cjs/index.js",types:"./dist-types/index.d.ts",module:"./dist-es/index.js",sideEffects:!1,dependencies:{"@aws-crypto/sha1-browser":"5.2.0","@aws-crypto/sha256-browser":"5.2.0","@aws-crypto/sha256-js":"5.2.0","@aws-sdk/core":"^3.973.8","@aws-sdk/credential-provider-node":"^3.972.7","@aws-sdk/middleware-bucket-endpoint":"^3.972.3","@aws-sdk/middleware-expect-continue":"^3.972.3","@aws-sdk/middleware-flexible-checksums":"^3.972.6","@aws-sdk/middleware-host-header":"^3.972.3","@aws-sdk/middleware-location-constraint":"^3.972.3","@aws-sdk/middleware-logger":"^3.972.3","@aws-sdk/middleware-recursion-detection":"^3.972.3","@aws-sdk/middleware-sdk-s3":"^3.972.8","@aws-sdk/middleware-ssec":"^3.972.3","@aws-sdk/middleware-user-agent":"^3.972.8","@aws-sdk/region-config-resolver":"^3.972.3","@aws-sdk/signature-v4-multi-region":"3.988.0","@aws-sdk/types":"^3.973.1","@aws-sdk/util-endpoints":"3.988.0","@aws-sdk/util-user-agent-browser":"^3.972.3","@aws-sdk/util-user-agent-node":"^3.972.6","@smithy/config-resolver":"^4.4.6","@smithy/core":"^3.23.0","@smithy/eventstream-serde-browser":"^4.2.8","@smithy/eventstream-serde-config-resolver":"^4.3.8","@smithy/eventstream-serde-node":"^4.2.8","@smithy/fetch-http-handler":"^5.3.9","@smithy/hash-blob-browser":"^4.2.9","@smithy/hash-node":"^4.2.8","@smithy/hash-stream-node":"^4.2.8","@smithy/invalid-dependency":"^4.2.8","@smithy/md5-js":"^4.2.8","@smithy/middleware-content-length":"^4.2.8","@smithy/middleware-endpoint":"^4.4.14","@smithy/middleware-retry":"^4.4.31","@smithy/middleware-serde":"^4.2.9","@smithy/middleware-stack":"^4.2.8","@smithy/node-config-provider":"^4.3.8","@smithy/node-http-handler":"^4.4.10","@smithy/protocol-http":"^5.3.8","@smithy/smithy-client":"^4.11.3","@smithy/types":"^4.12.0","@smithy/url-parser":"^4.2.8","@smithy/util-base64":"^4.3.0","@smithy/util-body-length-browser":"^4.2.0","@smithy/util-body-length-node":"^4.2.1","@smithy/util-defaults-mode-browser":"^4.3.30","@smithy/util-defaults-mode-node":"^4.2.33","@smithy/util-endpoints":"^3.2.8","@smithy/util-middleware":"^4.2.8","@smithy/util-retry":"^4.2.8","@smithy/util-stream":"^4.5.12","@smithy/util-utf8":"^4.2.0","@smithy/util-waiter":"^4.2.8",tslib:"^2.6.2"},devDependencies:{"@aws-sdk/signature-v4-crt":"3.988.0","@tsconfig/node20":"20.1.8","@types/node":"^20.14.8",concurrently:"7.0.0","downlevel-dts":"0.10.1",premove:"4.0.0",typescript:"~5.8.3"},engines:{node:">=20.0.0"},typesVersions:{"<4.0":{"dist-types/*":["dist-types/ts3.4/*"]}},files:["dist-*/**"],author:{name:"AWS SDK for JavaScript Team",url:"https://aws.amazon.com/javascript/"},license:"Apache-2.0",browser:{"./dist-es/runtimeConfig":"./dist-es/runtimeConfig.browser"},"react-native":{"./dist-es/runtimeConfig":"./dist-es/runtimeConfig.native"},homepage:"https://github.com/aws/aws-sdk-js-v3/tree/main/clients/client-s3",repository:{type:"git",url:"https://github.com/aws/aws-sdk-js-v3.git",directory:"clients/client-s3"}};var import_core19=__toESM(require_dist_cjs23(),1);init_dist_es();var import_property_provider23=__toESM(require_dist_cjs17(),1),import_shared_ini_file_loader12=__toESM(require_dist_cjs35(),1);var import_property_provider9=__toESM(require_dist_cjs17(),1),ENV_IMDS_DISABLED="AWS_EC2_METADATA_DISABLED",remoteProvider=async(init)=>{let{ENV_CMDS_FULL_URI:ENV_CMDS_FULL_URI2,ENV_CMDS_RELATIVE_URI:ENV_CMDS_RELATIVE_URI2,fromContainerMetadata:fromContainerMetadata3,fromInstanceMetadata:fromInstanceMetadata3}=await Promise.resolve().then(() => (init_dist_es2(),exports_dist_es2));if(process.env[ENV_CMDS_RELATIVE_URI2]||process.env[ENV_CMDS_FULL_URI2]){init.logger?.debug("@aws-sdk/credential-provider-node - remoteProvider::fromHttp/fromContainerMetadata");let{fromHttp:fromHttp2}=await Promise.resolve().then(() => (init_dist_es3(),exports_dist_es3));return import_property_provider9.chain(fromHttp2(init),fromContainerMetadata3(init))}if(process.env[ENV_IMDS_DISABLED]&&process.env[ENV_IMDS_DISABLED]!=="false")return async()=>{throw new import_property_provider9.CredentialsProviderError("EC2 Instance Metadata Service access disabled",{logger:init.logger})};return init.logger?.debug("@aws-sdk/credential-provider-node - remoteProvider::fromInstanceMetadata"),fromInstanceMetadata3(init)};function memoizeChain(providers,treatAsExpired){let chain2=internalCreateChain(providers),activeLock,passiveLock,credentials,provider=async(options)=>{if(options?.forceRefresh)return await chain2(options);if(credentials?.expiration){if(credentials?.expiration?.getTime()<Date.now())credentials=void 0}if(activeLock)await activeLock;else if(!credentials||treatAsExpired?.(credentials))if(credentials){if(!passiveLock)passiveLock=chain2(options).then((c)=>{credentials=c}).finally(()=>{passiveLock=void 0})}else return activeLock=chain2(options).then((c)=>{credentials=c}).finally(()=>{activeLock=void 0}),provider(options);return credentials};return provider}var internalCreateChain=(providers)=>async(awsIdentityProperties)=>{let lastProviderError;for(let provider of providers)try{return await provider(awsIdentityProperties)}catch(err){if(lastProviderError=err,err?.tryNextLink)continue;throw err}throw lastProviderError};var multipleCredentialSourceWarningEmitted=!1,defaultProvider=(init={})=>memoizeChain([async()=>{if(init.profile??process.env[import_shared_ini_file_loader12.ENV_PROFILE]){if(process.env[ENV_KEY]&&process.env[ENV_SECRET]){if(!multipleCredentialSourceWarningEmitted)(init.logger?.warn&&init.logger?.constructor?.name!=="NoOpLogger"?init.logger.warn.bind(init.logger):console.warn)(`@aws-sdk/credential-provider-node - defaultProvider::fromEnv WARNING:
    Multiple credential sources detected: 
    Both AWS_PROFILE and the pair AWS_ACCESS_KEY_ID/AWS_SECRET_ACCESS_KEY static credentials are set.
    This SDK will proceed with the AWS_PROFILE value.
    
    However, a future version may change this behavior to prefer the ENV static credentials.
    Please ensure that your environment only sets either the AWS_PROFILE or the
    AWS_ACCESS_KEY_ID/AWS_SECRET_ACCESS_KEY pair.
`),multipleCredentialSourceWarningEmitted=!0}throw new import_property_provider23.CredentialsProviderError("AWS_PROFILE is set, skipping fromEnv provider.",{logger:init.logger,tryNextLink:!0})}return init.logger?.debug("@aws-sdk/credential-provider-node - defaultProvider::fromEnv"),fromEnv(init)()},async(awsIdentityProperties)=>{init.logger?.debug("@aws-sdk/credential-provider-node - defaultProvider::fromSSO");let{ssoStartUrl,ssoAccountId,ssoRegion,ssoRoleName,ssoSession}=init;if(!ssoStartUrl&&!ssoAccountId&&!ssoRegion&&!ssoRoleName&&!ssoSession)throw new import_property_provider23.CredentialsProviderError("Skipping SSO provider in default chain (inputs do not include SSO fields).",{logger:init.logger});let{fromSSO:fromSSO3}=await Promise.resolve().then(() => (init_dist_es6(),exports_dist_es4));return fromSSO3(init)(awsIdentityProperties)},async(awsIdentityProperties)=>{init.logger?.debug("@aws-sdk/credential-provider-node - defaultProvider::fromIni");let{fromIni:fromIni3}=await Promise.resolve().then(() => (init_dist_es10(),exports_dist_es7));return fromIni3(init)(awsIdentityProperties)},async(awsIdentityProperties)=>{init.logger?.debug("@aws-sdk/credential-provider-node - defaultProvider::fromProcess");let{fromProcess:fromProcess3}=await Promise.resolve().then(() => (init_dist_es8(),exports_dist_es5));return fromProcess3(init)(awsIdentityProperties)},async(awsIdentityProperties)=>{init.logger?.debug("@aws-sdk/credential-provider-node - defaultProvider::fromTokenFile");let{fromTokenFile:fromTokenFile3}=await Promise.resolve().then(() => (init_dist_es9(),exports_dist_es6));return fromTokenFile3(init)(awsIdentityProperties)},async()=>{return init.logger?.debug("@aws-sdk/credential-provider-node - defaultProvider::remoteProvider"),(await remoteProvider(init))()},async()=>{throw new import_property_provider23.CredentialsProviderError("Could not load credentials from any providers",{tryNextLink:!1,logger:init.logger})}],credentialsTreatedAsExpired);var credentialsTreatedAsExpired=(credentials)=>credentials?.expiration!==void 0&&credentials.expiration.getTime()-Date.now()<300000;var import_util_config_provider2=__toESM(require_dist_cjs27(),1),NODE_USE_ARN_REGION_ENV_NAME="AWS_S3_USE_ARN_REGION",NODE_USE_ARN_REGION_INI_NAME="s3_use_arn_region",NODE_USE_ARN_REGION_CONFIG_OPTIONS={environmentVariableSelector:(env3)=>import_util_config_provider2.booleanSelector(env3,NODE_USE_ARN_REGION_ENV_NAME,import_util_config_provider2.SelectorType.ENV),configFileSelector:(profile)=>import_util_config_provider2.booleanSelector(profile,NODE_USE_ARN_REGION_INI_NAME,import_util_config_provider2.SelectorType.CONFIG),default:void 0};var import_util_user_agent_node2=__toESM(require_dist_cjs41(),1),import_config_resolver3=__toESM(require_dist_cjs33(),1);var import_util_hex_encoding2=__toESM(require_dist_cjs13(),1);var import_util_hex_encoding=__toESM(require_dist_cjs13(),1);class Int64{bytes;constructor(bytes){if(this.bytes=bytes,bytes.byteLength!==8)throw Error("Int64 buffers must be exactly 8 bytes")}static fromNumber(number){if(number>9223372036854776000||number<-9223372036854776000)throw Error(`${number} is too large (or, if negative, too small) to represent as an Int64`);let bytes=new Uint8Array(8);for(let i2=7,remaining=Math.abs(Math.round(number));i2>-1&&remaining>0;i2--,remaining/=256)bytes[i2]=remaining;if(number<0)negate(bytes);return new Int64(bytes)}valueOf(){let bytes=this.bytes.slice(0),negative=bytes[0]&128;if(negative)negate(bytes);return parseInt(import_util_hex_encoding.toHex(bytes),16)*(negative?-1:1)}toString(){return String(this.valueOf())}}function negate(bytes){for(let i2=0;i2<8;i2++)bytes[i2]^=255;for(let i2=7;i2>-1;i2--)if(bytes[i2]++,bytes[i2]!==0)break}class HeaderMarshaller{toUtf8;fromUtf8;constructor(toUtf83,fromUtf85){this.toUtf8=toUtf83,this.fromUtf8=fromUtf85}format(headers){let chunks=[];for(let headerName of Object.keys(headers)){let bytes=this.fromUtf8(headerName);chunks.push(Uint8Array.from([bytes.byteLength]),bytes,this.formatHeaderValue(headers[headerName]))}let out=new Uint8Array(chunks.reduce((carry,bytes)=>carry+bytes.byteLength,0)),position=0;for(let chunk of chunks)out.set(chunk,position),position+=chunk.byteLength;return out}formatHeaderValue(header){switch(header.type){case"boolean":return Uint8Array.from([header.value?0:1]);case"byte":return Uint8Array.from([2,header.value]);case"short":let shortView=new DataView(new ArrayBuffer(3));return shortView.setUint8(0,3),shortView.setInt16(1,header.value,!1),new Uint8Array(shortView.buffer);case"integer":let intView=new DataView(new ArrayBuffer(5));return intView.setUint8(0,4),intView.setInt32(1,header.value,!1),new Uint8Array(intView.buffer);case"long":let longBytes=new Uint8Array(9);return longBytes[0]=5,longBytes.set(header.value.bytes,1),longBytes;case"binary":let binView=new DataView(new ArrayBuffer(3+header.value.byteLength));binView.setUint8(0,6),binView.setUint16(1,header.value.byteLength,!1);let binBytes=new Uint8Array(binView.buffer);return binBytes.set(header.value,3),binBytes;case"string":let utf8Bytes=this.fromUtf8(header.value),strView=new DataView(new ArrayBuffer(3+utf8Bytes.byteLength));strView.setUint8(0,7),strView.setUint16(1,utf8Bytes.byteLength,!1);let strBytes=new Uint8Array(strView.buffer);return strBytes.set(utf8Bytes,3),strBytes;case"timestamp":let tsBytes=new Uint8Array(9);return tsBytes[0]=8,tsBytes.set(Int64.fromNumber(header.value.valueOf()).bytes,1),tsBytes;case"uuid":if(!UUID_PATTERN.test(header.value))throw Error(`Invalid UUID received: ${header.value}`);let uuidBytes=new Uint8Array(17);return uuidBytes[0]=9,uuidBytes.set(import_util_hex_encoding2.fromHex(header.value.replace(/\-/g,"")),1),uuidBytes}}parse(headers){let out={},position=0;while(position<headers.byteLength){let nameLength=headers.getUint8(position++),name=this.toUtf8(new Uint8Array(headers.buffer,headers.byteOffset+position,nameLength));switch(position+=nameLength,headers.getUint8(position++)){case 0:out[name]={type:BOOLEAN_TAG,value:!0};break;case 1:out[name]={type:BOOLEAN_TAG,value:!1};break;case 2:out[name]={type:BYTE_TAG,value:headers.getInt8(position++)};break;case 3:out[name]={type:SHORT_TAG,value:headers.getInt16(position,!1)},position+=2;break;case 4:out[name]={type:INT_TAG,value:headers.getInt32(position,!1)},position+=4;break;case 5:out[name]={type:LONG_TAG,value:new Int64(new Uint8Array(headers.buffer,headers.byteOffset+position,8))},position+=8;break;case 6:let binaryLength=headers.getUint16(position,!1);position+=2,out[name]={type:BINARY_TAG,value:new Uint8Array(headers.buffer,headers.byteOffset+position,binaryLength)},position+=binaryLength;break;case 7:let stringLength=headers.getUint16(position,!1);position+=2,out[name]={type:STRING_TAG,value:this.toUtf8(new Uint8Array(headers.buffer,headers.byteOffset+position,stringLength))},position+=stringLength;break;case 8:out[name]={type:TIMESTAMP_TAG,value:new Date(new Int64(new Uint8Array(headers.buffer,headers.byteOffset+position,8)).valueOf())},position+=8;break;case 9:let uuidBytes=new Uint8Array(headers.buffer,headers.byteOffset+position,16);position+=16,out[name]={type:UUID_TAG,value:`${import_util_hex_encoding2.toHex(uuidBytes.subarray(0,4))}-${import_util_hex_encoding2.toHex(uuidBytes.subarray(4,6))}-${import_util_hex_encoding2.toHex(uuidBytes.subarray(6,8))}-${import_util_hex_encoding2.toHex(uuidBytes.subarray(8,10))}-${import_util_hex_encoding2.toHex(uuidBytes.subarray(10))}`};break;default:throw Error("Unrecognized header type tag")}}return out}}var HEADER_VALUE_TYPE;(function(HEADER_VALUE_TYPE2){HEADER_VALUE_TYPE2[HEADER_VALUE_TYPE2.boolTrue=0]="boolTrue",HEADER_VALUE_TYPE2[HEADER_VALUE_TYPE2.boolFalse=1]="boolFalse",HEADER_VALUE_TYPE2[HEADER_VALUE_TYPE2.byte=2]="byte",HEADER_VALUE_TYPE2[HEADER_VALUE_TYPE2.short=3]="short",HEADER_VALUE_TYPE2[HEADER_VALUE_TYPE2.integer=4]="integer",HEADER_VALUE_TYPE2[HEADER_VALUE_TYPE2.long=5]="long",HEADER_VALUE_TYPE2[HEADER_VALUE_TYPE2.byteArray=6]="byteArray",HEADER_VALUE_TYPE2[HEADER_VALUE_TYPE2.string=7]="string",HEADER_VALUE_TYPE2[HEADER_VALUE_TYPE2.timestamp=8]="timestamp",HEADER_VALUE_TYPE2[HEADER_VALUE_TYPE2.uuid=9]="uuid"})(HEADER_VALUE_TYPE||(HEADER_VALUE_TYPE={}));var BOOLEAN_TAG="boolean",BYTE_TAG="byte",SHORT_TAG="short",INT_TAG="integer",LONG_TAG="long",BINARY_TAG="binary",STRING_TAG="string",TIMESTAMP_TAG="timestamp",UUID_TAG="uuid",UUID_PATTERN=/^[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}$/;var PRELUDE_MEMBER_LENGTH=4,PRELUDE_LENGTH=PRELUDE_MEMBER_LENGTH*2,CHECKSUM_LENGTH=4,MINIMUM_MESSAGE_LENGTH=PRELUDE_LENGTH+CHECKSUM_LENGTH*2;function splitMessage({byteLength,byteOffset,buffer:buffer2}){if(byteLength<MINIMUM_MESSAGE_LENGTH)throw Error("Provided message too short to accommodate event stream message overhead");let view=new DataView(buffer2,byteOffset,byteLength),messageLength=view.getUint32(0,!1);if(byteLength!==messageLength)throw Error("Reported message length does not match received message length");let headerLength=view.getUint32(PRELUDE_MEMBER_LENGTH,!1),expectedPreludeChecksum=view.getUint32(PRELUDE_LENGTH,!1),expectedMessageChecksum=view.getUint32(byteLength-CHECKSUM_LENGTH,!1),checksummer=new Crc32().update(new Uint8Array(buffer2,byteOffset,PRELUDE_LENGTH));if(expectedPreludeChecksum!==checksummer.digest())throw Error(`The prelude checksum specified in the message (${expectedPreludeChecksum}) does not match the calculated CRC32 checksum (${checksummer.digest()})`);if(checksummer.update(new Uint8Array(buffer2,byteOffset+PRELUDE_LENGTH,byteLength-(PRELUDE_LENGTH+CHECKSUM_LENGTH))),expectedMessageChecksum!==checksummer.digest())throw Error(`The message checksum (${checksummer.digest()}) did not match the expected value of ${expectedMessageChecksum}`);return{headers:new DataView(buffer2,byteOffset+PRELUDE_LENGTH+CHECKSUM_LENGTH,headerLength),body:new Uint8Array(buffer2,byteOffset+PRELUDE_LENGTH+CHECKSUM_LENGTH+headerLength,messageLength-headerLength-(PRELUDE_LENGTH+CHECKSUM_LENGTH+CHECKSUM_LENGTH))}}class EventStreamCodec{headerMarshaller;messageBuffer;isEndOfStream;constructor(toUtf83,fromUtf85){this.headerMarshaller=new HeaderMarshaller(toUtf83,fromUtf85),this.messageBuffer=[],this.isEndOfStream=!1}feed(message){this.messageBuffer.push(this.decode(message))}endOfStream(){this.isEndOfStream=!0}getMessage(){let message=this.messageBuffer.pop(),isEndOfStream=this.isEndOfStream;return{getMessage(){return message},isEndOfStream(){return isEndOfStream}}}getAvailableMessages(){let messages2=this.messageBuffer;this.messageBuffer=[];let isEndOfStream=this.isEndOfStream;return{getMessages(){return messages2},isEndOfStream(){return isEndOfStream}}}encode({headers:rawHeaders,body}){let headers=this.headerMarshaller.format(rawHeaders),length=headers.byteLength+body.byteLength+16,out=new Uint8Array(length),view=new DataView(out.buffer,out.byteOffset,out.byteLength),checksum2=new Crc32;return view.setUint32(0,length,!1),view.setUint32(4,headers.byteLength,!1),view.setUint32(8,checksum2.update(out.subarray(0,8)).digest(),!1),out.set(headers,12),out.set(body,headers.byteLength+12),view.setUint32(length-4,checksum2.update(out.subarray(8,length-4)).digest(),!1),out}decode(message){let{headers,body}=splitMessage(message);return{headers:this.headerMarshaller.parse(headers),body}}formatHeaders(rawHeaders){return this.headerMarshaller.format(rawHeaders)}}class MessageDecoderStream{options;constructor(options){this.options=options}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(let bytes of this.options.inputStream)yield this.options.decoder.decode(bytes)}}class MessageEncoderStream{options;constructor(options){this.options=options}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(let msg of this.options.messageStream)yield this.options.encoder.encode(msg);if(this.options.includeEndFrame)yield new Uint8Array(0)}}class SmithyMessageDecoderStream{options;constructor(options){this.options=options}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(let message of this.options.messageStream){let deserialized=await this.options.deserializer(message);if(deserialized===void 0)continue;yield deserialized}}}class SmithyMessageEncoderStream{options;constructor(options){this.options=options}[Symbol.asyncIterator](){return this.asyncIterator()}async*asyncIterator(){for await(let chunk of this.options.inputStream)yield this.options.serializer(chunk)}}function getChunkedStream(source){let currentMessageTotalLength=0,currentMessagePendingLength=0,currentMessage=null,messageLengthBuffer=null,allocateMessage=(size)=>{if(typeof size!=="number")throw Error("Attempted to allocate an event message where size was not a number: "+size);currentMessageTotalLength=size,currentMessagePendingLength=4,currentMessage=new Uint8Array(size),new DataView(currentMessage.buffer).setUint32(0,size,!1)},iterator=async function*(){let sourceIterator=source[Symbol.asyncIterator]();while(!0){let{value,done}=await sourceIterator.next();if(done){if(!currentMessageTotalLength)return;else if(currentMessageTotalLength===currentMessagePendingLength)yield currentMessage;else throw Error("Truncated event message received.");return}let chunkLength=value.length,currentOffset=0;while(currentOffset<chunkLength){if(!currentMessage){let bytesRemaining=chunkLength-currentOffset;if(!messageLengthBuffer)messageLengthBuffer=new Uint8Array(4);let numBytesForTotal=Math.min(4-currentMessagePendingLength,bytesRemaining);if(messageLengthBuffer.set(value.slice(currentOffset,currentOffset+numBytesForTotal),currentMessagePendingLength),currentMessagePendingLength+=numBytesForTotal,currentOffset+=numBytesForTotal,currentMessagePendingLength<4)break;allocateMessage(new DataView(messageLengthBuffer.buffer).getUint32(0,!1)),messageLengthBuffer=null}let numBytesToWrite=Math.min(currentMessageTotalLength-currentMessagePendingLength,chunkLength-currentOffset);if(currentMessage.set(value.slice(currentOffset,currentOffset+numBytesToWrite),currentMessagePendingLength),currentMessagePendingLength+=numBytesToWrite,currentOffset+=numBytesToWrite,currentMessageTotalLength&&currentMessageTotalLength===currentMessagePendingLength)yield currentMessage,currentMessage=null,currentMessageTotalLength=0,currentMessagePendingLength=0}}};return{[Symbol.asyncIterator]:iterator}}function getMessageUnmarshaller(deserializer,toUtf83){return async function(message){let{value:messageType}=message.headers[":message-type"];if(messageType==="error"){let unmodeledError=Error(message.headers[":error-message"].value||"UnknownError");throw unmodeledError.name=message.headers[":error-code"].value,unmodeledError}else if(messageType==="exception"){let code=message.headers[":exception-type"].value,exception={[code]:message},deserializedException=await deserializer(exception);if(deserializedException.$unknown){let error=Error(toUtf83(message.body));throw error.name=code,error}throw deserializedException[code]}else if(messageType==="event"){let event={[message.headers[":event-type"].value]:message},deserialized=await deserializer(event);if(deserialized.$unknown)return;return deserialized}else throw Error(`Unrecognizable event type: ${message.headers[":event-type"].value}`)}}class EventStreamMarshaller{eventStreamCodec;utfEncoder;constructor({utf8Encoder,utf8Decoder}){this.eventStreamCodec=new EventStreamCodec(utf8Encoder,utf8Decoder),this.utfEncoder=utf8Encoder}deserialize(body,deserializer){let inputStream=getChunkedStream(body);return new SmithyMessageDecoderStream({messageStream:new MessageDecoderStream({inputStream,decoder:this.eventStreamCodec}),deserializer:getMessageUnmarshaller(deserializer,this.utfEncoder)})}serialize(inputStream,serializer){return new MessageEncoderStream({messageStream:new SmithyMessageEncoderStream({inputStream,serializer}),encoder:this.eventStreamCodec,includeEndFrame:!0})}}import{Readable as Readable2}from"stream";async function*readabletoIterable(readStream){let streamEnded=!1,generationEnded=!1,records=[];readStream.on("error",(err)=>{if(!streamEnded)streamEnded=!0;if(err)throw err}),readStream.on("data",(data)=>{records.push(data)}),readStream.on("end",()=>{streamEnded=!0});while(!generationEnded){let value=await new Promise((resolve)=>setTimeout(()=>resolve(records.shift()),0));if(value)yield value;generationEnded=streamEnded&&records.length===0}}class EventStreamMarshaller2{universalMarshaller;constructor({utf8Encoder,utf8Decoder}){this.universalMarshaller=new EventStreamMarshaller({utf8Decoder,utf8Encoder})}deserialize(body,deserializer){let bodyIterable=typeof body[Symbol.asyncIterator]==="function"?body:readabletoIterable(body);return this.universalMarshaller.deserialize(bodyIterable,deserializer)}serialize(input,serializer){return Readable2.from(this.universalMarshaller.serialize(input,serializer))}}var eventStreamSerdeProvider=(options)=>new EventStreamMarshaller2(options);var import_hash_node2=__toESM(require_dist_cjs42(),1);var import_util_utf84=__toESM(require_dist_cjs7(),1);import{Writable}from"stream";class HashCalculator extends Writable{hash;constructor(hash3,options){super(options);this.hash=hash3}_write(chunk,encoding,callback){try{this.hash.update(import_util_utf84.toUint8Array(chunk))}catch(err){return callback(err)}callback()}}var readableStreamHasher=(hashCtor,readableStream)=>{if(readableStream.readableFlowing!==null)throw Error("Unable to calculate hash for flowing readable stream");let hash3=new hashCtor,hashCalculator=new HashCalculator(hash3);return readableStream.pipe(hashCalculator),new Promise((resolve,reject)=>{readableStream.on("error",(err)=>{hashCalculator.end(),reject(err)}),hashCalculator.on("error",reject),hashCalculator.on("finish",()=>{hash3.digest().then(resolve).catch(reject)})})};var import_middleware_retry3=__toESM(require_dist_cjs40(),1),import_node_config_provider4=__toESM(require_dist_cjs36(),1),import_node_http_handler3=__toESM(require_dist_cjs11(),1),import_smithy_client17=__toESM(require_dist_cjs21(),1),import_util_body_length_node2=__toESM(require_dist_cjs43(),1),import_util_defaults_mode_node2=__toESM(require_dist_cjs44(),1),import_util_retry2=__toESM(require_dist_cjs39(),1);var import_core18=__toESM(require_dist_cjs23(),1),import_protocols2=__toESM(require_protocols2(),1);var import_smithy_client16=__toESM(require_dist_cjs21(),1),import_url_parser3=__toESM(require_dist_cjs30(),1),import_util_base642=__toESM(require_dist_cjs8(),1),import_util_stream5=__toESM(require_dist_cjs14(),1),import_util_utf85=__toESM(require_dist_cjs7(),1);var getRuntimeConfig3=(config)=>{return{apiVersion:"2006-03-01",base64Decoder:config?.base64Decoder??import_util_base642.fromBase64,base64Encoder:config?.base64Encoder??import_util_base642.toBase64,disableHostPrefix:config?.disableHostPrefix??!1,endpointProvider:config?.endpointProvider??defaultEndpointResolver,extensions:config?.extensions??[],getAwsChunkedEncodingStream:config?.getAwsChunkedEncodingStream??import_util_stream5.getAwsChunkedEncodingStream,httpAuthSchemeProvider:config?.httpAuthSchemeProvider??defaultS3HttpAuthSchemeProvider,httpAuthSchemes:config?.httpAuthSchemes??[{schemeId:"aws.auth#sigv4",identityProvider:(ipc)=>ipc.getIdentityProvider("aws.auth#sigv4"),signer:new import_core18.AwsSdkSigV4Signer},{schemeId:"aws.auth#sigv4a",identityProvider:(ipc)=>ipc.getIdentityProvider("aws.auth#sigv4a"),signer:new import_core18.AwsSdkSigV4ASigner}],logger:config?.logger??new import_smithy_client16.NoOpLogger,protocol:config?.protocol??import_protocols2.AwsRestXmlProtocol,protocolSettings:config?.protocolSettings??{defaultNamespace:"com.amazonaws.s3",errorTypeRegistries,xmlNamespace:"http://s3.amazonaws.com/doc/2006-03-01/",version:"2006-03-01",serviceTarget:"AmazonS3"},sdkStreamMixin:config?.sdkStreamMixin??import_util_stream5.sdkStreamMixin,serviceId:config?.serviceId??"S3",signerConstructor:config?.signerConstructor??SignatureV4MultiRegion,signingEscapePath:config?.signingEscapePath??!1,urlParser:config?.urlParser??import_url_parser3.parseUrl,useArnRegion:config?.useArnRegion??void 0,utf8Decoder:config?.utf8Decoder??import_util_utf85.fromUtf8,utf8Encoder:config?.utf8Encoder??import_util_utf85.toUtf8}};var getRuntimeConfig4=(config)=>{import_smithy_client17.emitWarningIfUnsupportedVersion(process.version);let defaultsMode=import_util_defaults_mode_node2.resolveDefaultsModeConfig(config),defaultConfigProvider=()=>defaultsMode().then(import_smithy_client17.loadConfigsForDefaultMode),clientSharedValues=getRuntimeConfig3(config);import_core19.emitWarningIfUnsupportedVersion(process.version);let loaderConfig={profile:config?.profile,logger:clientSharedValues.logger};return{...clientSharedValues,...config,runtime:"node",defaultsMode,authSchemePreference:config?.authSchemePreference??import_node_config_provider4.loadConfig(import_core19.NODE_AUTH_SCHEME_PREFERENCE_OPTIONS,loaderConfig),bodyLengthChecker:config?.bodyLengthChecker??import_util_body_length_node2.calculateBodyLength,credentialDefaultProvider:config?.credentialDefaultProvider??defaultProvider,defaultUserAgentProvider:config?.defaultUserAgentProvider??import_util_user_agent_node2.createDefaultUserAgentProvider({serviceId:clientSharedValues.serviceId,clientVersion:package_default.version}),disableS3ExpressSessionAuth:config?.disableS3ExpressSessionAuth??import_node_config_provider4.loadConfig(NODE_DISABLE_S3_EXPRESS_SESSION_AUTH_OPTIONS,loaderConfig),eventStreamSerdeProvider:config?.eventStreamSerdeProvider??eventStreamSerdeProvider,maxAttempts:config?.maxAttempts??import_node_config_provider4.loadConfig(import_middleware_retry3.NODE_MAX_ATTEMPT_CONFIG_OPTIONS,config),md5:config?.md5??import_hash_node2.Hash.bind(null,"md5"),region:config?.region??import_node_config_provider4.loadConfig(import_config_resolver3.NODE_REGION_CONFIG_OPTIONS,{...import_config_resolver3.NODE_REGION_CONFIG_FILE_OPTIONS,...loaderConfig}),requestChecksumCalculation:config?.requestChecksumCalculation??import_node_config_provider4.loadConfig(NODE_REQUEST_CHECKSUM_CALCULATION_CONFIG_OPTIONS,loaderConfig),requestHandler:import_node_http_handler3.NodeHttpHandler.create(config?.requestHandler??defaultConfigProvider),responseChecksumValidation:config?.responseChecksumValidation??import_node_config_provider4.loadConfig(NODE_RESPONSE_CHECKSUM_VALIDATION_CONFIG_OPTIONS,loaderConfig),retryMode:config?.retryMode??import_node_config_provider4.loadConfig({...import_middleware_retry3.NODE_RETRY_MODE_CONFIG_OPTIONS,default:async()=>(await defaultConfigProvider()).retryMode||import_util_retry2.DEFAULT_RETRY_MODE},config),sha1:config?.sha1??import_hash_node2.Hash.bind(null,"sha1"),sha256:config?.sha256??import_hash_node2.Hash.bind(null,"sha256"),sigv4aSigningRegionSet:config?.sigv4aSigningRegionSet??import_node_config_provider4.loadConfig(import_core19.NODE_SIGV4A_CONFIG_OPTIONS,loaderConfig),streamCollector:config?.streamCollector??import_node_http_handler3.streamCollector,streamHasher:config?.streamHasher??readableStreamHasher,useArnRegion:config?.useArnRegion??import_node_config_provider4.loadConfig(NODE_USE_ARN_REGION_CONFIG_OPTIONS,loaderConfig),useDualstackEndpoint:config?.useDualstackEndpoint??import_node_config_provider4.loadConfig(import_config_resolver3.NODE_USE_DUALSTACK_ENDPOINT_CONFIG_OPTIONS,loaderConfig),useFipsEndpoint:config?.useFipsEndpoint??import_node_config_provider4.loadConfig(import_config_resolver3.NODE_USE_FIPS_ENDPOINT_CONFIG_OPTIONS,loaderConfig),userAgentAppId:config?.userAgentAppId??import_node_config_provider4.loadConfig(import_util_user_agent_node2.NODE_APP_ID_CONFIG_OPTIONS,loaderConfig)}};var import_region_config_resolver2=__toESM(require_dist_cjs45(),1),import_protocol_http12=__toESM(require_dist_cjs2(),1),import_smithy_client18=__toESM(require_dist_cjs21(),1);var getHttpAuthExtensionConfiguration2=(runtimeConfig)=>{let{httpAuthSchemes:_httpAuthSchemes,httpAuthSchemeProvider:_httpAuthSchemeProvider,credentials:_credentials}=runtimeConfig;return{setHttpAuthScheme(httpAuthScheme){let index2=_httpAuthSchemes.findIndex((scheme)=>scheme.schemeId===httpAuthScheme.schemeId);if(index2===-1)_httpAuthSchemes.push(httpAuthScheme);else _httpAuthSchemes.splice(index2,1,httpAuthScheme)},httpAuthSchemes(){return _httpAuthSchemes},setHttpAuthSchemeProvider(httpAuthSchemeProvider){_httpAuthSchemeProvider=httpAuthSchemeProvider},httpAuthSchemeProvider(){return _httpAuthSchemeProvider},setCredentials(credentials){_credentials=credentials},credentials(){return _credentials}}},resolveHttpAuthRuntimeConfig2=(config)=>{return{httpAuthSchemes:config.httpAuthSchemes(),httpAuthSchemeProvider:config.httpAuthSchemeProvider(),credentials:config.credentials()}};var resolveRuntimeExtensions2=(runtimeConfig,extensions2)=>{let extensionConfiguration=Object.assign(import_region_config_resolver2.getAwsRegionExtensionConfiguration(runtimeConfig),import_smithy_client18.getDefaultExtensionConfiguration(runtimeConfig),import_protocol_http12.getHttpHandlerExtensionConfiguration(runtimeConfig),getHttpAuthExtensionConfiguration2(runtimeConfig));return extensions2.forEach((extension)=>extension.configure(extensionConfiguration)),Object.assign(runtimeConfig,import_region_config_resolver2.resolveAwsRegionExtensionConfiguration(extensionConfiguration),import_smithy_client18.resolveDefaultRuntimeConfig(extensionConfiguration),import_protocol_http12.resolveHttpHandlerRuntimeConfig(extensionConfiguration),resolveHttpAuthRuntimeConfig2(extensionConfiguration))};class S3Client extends import_smithy_client19.Client{config;constructor(...[configuration]){let _config_0=getRuntimeConfig4(configuration||{});super(_config_0);this.initConfig=_config_0;let _config_1=resolveClientEndpointParameters(_config_0),_config_2=import_middleware_user_agent2.resolveUserAgentConfig(_config_1),_config_3=resolveFlexibleChecksumsConfig(_config_2),_config_4=import_middleware_retry4.resolveRetryConfig(_config_3),_config_5=import_config_resolver4.resolveRegionConfig(_config_4),_config_6=import_middleware_host_header2.resolveHostHeaderConfig(_config_5),_config_7=import_middleware_endpoint8.resolveEndpointConfig(_config_6),_config_8=resolveEventStreamSerdeConfig(_config_7),_config_9=resolveHttpAuthSchemeConfig(_config_8),_config_10=resolveS3Config(_config_9,{session:[()=>this,CreateSessionCommand]}),_config_11=resolveRuntimeExtensions2(_config_10,configuration?.extensions||[]);this.config=_config_11,this.middlewareStack.use(import_schema10.getSchemaSerdePlugin(this.config)),this.middlewareStack.use(import_middleware_user_agent2.getUserAgentPlugin(this.config)),this.middlewareStack.use(import_middleware_retry4.getRetryPlugin(this.config)),this.middlewareStack.use(import_middleware_content_length2.getContentLengthPlugin(this.config)),this.middlewareStack.use(import_middleware_host_header2.getHostHeaderPlugin(this.config)),this.middlewareStack.use(import_middleware_logger2.getLoggerPlugin(this.config)),this.middlewareStack.use(import_middleware_recursion_detection2.getRecursionDetectionPlugin(this.config)),this.middlewareStack.use(import_core20.getHttpAuthSchemeEndpointRuleSetPlugin(this.config,{httpAuthSchemeParametersProvider:defaultS3HttpAuthSchemeParametersProvider,identityProviderConfigProvider:async(config)=>new import_core20.DefaultIdentityProviderConfig({"aws.auth#sigv4":config.credentials,"aws.auth#sigv4a":config.credentials})})),this.middlewareStack.use(import_core20.getHttpSigningPlugin(this.config)),this.middlewareStack.use(getValidateBucketNamePlugin(this.config)),this.middlewareStack.use(getAddExpectContinuePlugin(this.config)),this.middlewareStack.use(getRegionRedirectMiddlewarePlugin(this.config)),this.middlewareStack.use(getS3ExpressPlugin(this.config)),this.middlewareStack.use(getS3ExpressHttpSigningPlugin(this.config))}destroy(){super.destroy()}}function ssecMiddleware(options){return(next)=>async(args)=>{let input={...args.input},properties=[{target:"SSECustomerKey",hash:"SSECustomerKeyMD5"},{target:"CopySourceSSECustomerKey",hash:"CopySourceSSECustomerKeyMD5"}];for(let prop of properties){let value=input[prop.target];if(value){let valueForHash;if(typeof value==="string")if(isValidBase64EncodedSSECustomerKey(value,options))valueForHash=options.base64Decoder(value);else valueForHash=options.utf8Decoder(value),input[prop.target]=options.base64Encoder(valueForHash);else valueForHash=ArrayBuffer.isView(value)?new Uint8Array(value.buffer,value.byteOffset,value.byteLength):new Uint8Array(value),input[prop.target]=options.base64Encoder(valueForHash);let hash3=new options.md5;hash3.update(valueForHash),input[prop.hash]=options.base64Encoder(await hash3.digest())}}return next({...args,input})}}var ssecMiddlewareOptions={name:"ssecMiddleware",step:"initialize",tags:["SSE"],override:!0},getSsecPlugin=(config)=>({applyToStack:(clientStack)=>{clientStack.add(ssecMiddleware(config),ssecMiddlewareOptions)}});function isValidBase64EncodedSSECustomerKey(str,options){if(!/^(?:[A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(str))return!1;try{return options.base64Decoder(str).length===32}catch{return!1}}var import_middleware_endpoint9=__toESM(require_dist_cjs37(),1),import_smithy_client20=__toESM(require_dist_cjs21(),1);class GetObjectCommand extends import_smithy_client20.Command.classBuilder().ep({...commonParams,Bucket:{type:"contextParams",name:"Bucket"},Key:{type:"contextParams",name:"Key"}}).m(function(Command,cs,config,o2){return[import_middleware_endpoint9.getEndpointPlugin(config,Command.getEndpointParameterInstructions()),getFlexibleChecksumsPlugin(config,{requestChecksumRequired:!1,requestValidationModeMember:"ChecksumMode",responseAlgorithms:["CRC64NVME","CRC32","CRC32C","SHA256","SHA1"]}),getSsecPlugin(config),getS3ExpiresMiddlewarePlugin(config)]}).s("AmazonS3","GetObject",{}).n("S3Client","GetObjectCommand").sc(GetObject$).build(){}var import_middleware_endpoint10=__toESM(require_dist_cjs37(),1),import_smithy_client21=__toESM(require_dist_cjs21(),1);class PutObjectCommand extends import_smithy_client21.Command.classBuilder().ep({...commonParams,Bucket:{type:"contextParams",name:"Bucket"},Key:{type:"contextParams",name:"Key"}}).m(function(Command,cs,config,o2){return[import_middleware_endpoint10.getEndpointPlugin(config,Command.getEndpointParameterInstructions()),getFlexibleChecksumsPlugin(config,{requestAlgorithmMember:{httpHeader:"x-amz-sdk-checksum-algorithm",name:"ChecksumAlgorithm"},requestChecksumRequired:!1}),getCheckContentLengthHeaderPlugin(config),getThrow200ExceptionsPlugin(config),getSsecPlugin(config)]}).s("AmazonS3","PutObject",{}).n("S3Client","PutObjectCommand").sc(PutObject$).build(){}var import_querystring_builder=__toESM(require_dist_cjs10(),1);function formatUrl(request2){let{port,query}=request2,{protocol,path,hostname}=request2;if(protocol&&protocol.slice(-1)!==":")protocol+=":";if(port)hostname+=`:${port}`;if(path&&path.charAt(0)!=="/")path=`/${path}`;let queryString=query?import_querystring_builder.buildQueryString(query):"";if(queryString&&queryString[0]!=="?")queryString=`?${queryString}`;let auth="";if(request2.username!=null||request2.password!=null){let username=request2.username??"",password=request2.password??"";auth=`${username}:${password}@`}let fragment2="";if(request2.fragment)fragment2=`#${request2.fragment}`;return`${protocol}//${auth}${hostname}${path}${queryString}${fragment2}`}var import_middleware_endpoint11=__toESM(require_dist_cjs37(),1),import_protocol_http13=__toESM(require_dist_cjs2(),1);var UNSIGNED_PAYLOAD="UNSIGNED-PAYLOAD",SHA256_HEADER="X-Amz-Content-Sha256";class S3RequestPresigner{signer;constructor(options){let resolvedOptions={service:options.signingName||options.service||"s3",uriEscapePath:options.uriEscapePath||!1,applyChecksum:options.applyChecksum||!1,...options};this.signer=new SignatureV4MultiRegion(resolvedOptions)}presign(requestToSign,{unsignableHeaders=new Set,hoistableHeaders=new Set,unhoistableHeaders=new Set,...options}={}){return this.prepareRequest(requestToSign,{unsignableHeaders,unhoistableHeaders,hoistableHeaders}),this.signer.presign(requestToSign,{expiresIn:900,unsignableHeaders,unhoistableHeaders,...options})}presignWithCredentials(requestToSign,credentials,{unsignableHeaders=new Set,hoistableHeaders=new Set,unhoistableHeaders=new Set,...options}={}){return this.prepareRequest(requestToSign,{unsignableHeaders,unhoistableHeaders,hoistableHeaders}),this.signer.presignWithCredentials(requestToSign,credentials,{expiresIn:900,unsignableHeaders,unhoistableHeaders,...options})}prepareRequest(requestToSign,{unsignableHeaders=new Set,unhoistableHeaders=new Set,hoistableHeaders=new Set}={}){unsignableHeaders.add("content-type"),Object.keys(requestToSign.headers).map((header)=>header.toLowerCase()).filter((header)=>header.startsWith("x-amz-server-side-encryption")).forEach((header)=>{if(!hoistableHeaders.has(header))unhoistableHeaders.add(header)}),requestToSign.headers[SHA256_HEADER]=UNSIGNED_PAYLOAD;let currentHostHeader=requestToSign.headers.host,port=requestToSign.port,expectedHostHeader=`${requestToSign.hostname}${requestToSign.port!=null?":"+port:""}`;if(!currentHostHeader||currentHostHeader===requestToSign.hostname&&requestToSign.port!=null)requestToSign.headers.host=expectedHostHeader}}var getSignedUrl=async(client,command,options={})=>{let s3Presigner,region;if(typeof client.config.endpointProvider==="function"){let authScheme=(await import_middleware_endpoint11.getEndpointFromInstructions(command.input,command.constructor,client.config)).properties?.authSchemes?.[0];if(authScheme?.name==="sigv4a")region=authScheme?.signingRegionSet?.join(",");else region=authScheme?.signingRegion;s3Presigner=new S3RequestPresigner({...client.config,signingName:authScheme?.signingName,region:async()=>region})}else s3Presigner=new S3RequestPresigner(client.config);let presignInterceptMiddleware=(next,context)=>async(args)=>{let{request:request2}=args;if(!import_protocol_http13.HttpRequest.isInstance(request2))throw Error("Request to be presigned is not an valid HTTP request.");delete request2.headers["amz-sdk-invocation-id"],delete request2.headers["amz-sdk-request"],delete request2.headers["x-amz-user-agent"];let presigned2,presignerOptions={...options,signingRegion:options.signingRegion??context.signing_region??region,signingService:options.signingService??context.signing_service};if(context.s3ExpressIdentity)presigned2=await s3Presigner.presignWithCredentials(request2,context.s3ExpressIdentity,presignerOptions);else presigned2=await s3Presigner.presign(request2,presignerOptions);return{response:{},output:{$metadata:{httpStatusCode:200},presigned:presigned2}}},middlewareName="presignInterceptMiddleware",clientStack=client.middlewareStack.clone();clientStack.addRelativeTo(presignInterceptMiddleware,{name:middlewareName,relation:"before",toMiddleware:"awsAuthMiddleware",override:!0});let handler=command.resolveMiddleware(clientStack,client.config,{}),{output}=await handler({input:command.input}),{presigned}=output;return formatUrl(presigned)};var endpoint=process.env.S3_ENDPOINT,accessKeyId=process.env.S3_ACCESS_KEY_ID,secretAccessKey=process.env.S3_SECRET_ACCESS_KEY,region=process.env.S3_REGION??"auto",S3_BUCKET=process.env.S3_BUCKET;if(!endpoint||!accessKeyId||!secretAccessKey||!S3_BUCKET)throw Error("Missing S3 env vars (S3_ENDPOINT/S3_ACCESS_KEY_ID/S3_SECRET_ACCESS_KEY/S3_BUCKET)");var s3=new S3Client({region,endpoint,credentials:{accessKeyId,secretAccessKey},forcePathStyle:!0});async function presignPut(params){let cmd=new PutObjectCommand({Bucket:S3_BUCKET,Key:params.key,ContentType:params.contentType});return await getSignedUrl(s3,cmd,{expiresIn:params.expiresInSec??300})}async function presignGet(params){let cmd=new GetObjectCommand({Bucket:S3_BUCKET,Key:params.key,ResponseContentDisposition:params.responseContentDisposition});return await getSignedUrl(s3,cmd,{expiresIn:params.expiresInSec??600})}var ALLOWED_TYPES=["image/jpeg","image/png","application/pdf","image/webp"],MAX_SIZE=10485760;function isAllowedType(v){return ALLOWED_TYPES.includes(v)}function normalizeProviderId(raw){if(raw===null||raw===void 0)return null;if(typeof raw==="string"){let v=raw.trim();if(v===""||v==="0"||v.toLowerCase()==="null")return null;let n3=Number(v);return Number.isInteger(n3)&&n3>0?n3:null}if(typeof raw==="number")return Number.isInteger(raw)&&raw>0?raw:null;return null}async function assertProviderBelongsToTenant(tenantId,providerId){let[p2]=await db.select({provider_id:providerTable.provider_id}).from(providerTable).where(and(eq(providerTable.provider_id,providerId),eq(providerTable.tenant_id,tenantId))).limit(1);if(!p2)throw Error("PROVIDER_NOT_FOUND")}function makeReceiptKey(tenantId,expenseId,filename){let ext=(filename.split(".").pop()||"bin").toLowerCase().replace(/[^a-z0-9]/g,""),ts=Date.now(),rand=crypto.randomUUID();return`tenants/${tenantId}/expenses/${expenseId}/${ts}-${rand}.${ext}`}var getAllExpenses=async(tenantId)=>{return await db.select().from(expenseTable).where(eq(expenseTable.tenant_id,tenantId)).orderBy(expenseTable.expense_id)};async function getExpensesByFilter(tenantId,filters){if(filters.provider_id){let pid=Number(filters.provider_id);if(Number.isFinite(pid)&&pid>0)await assertProviderBelongsToTenant(tenantId,pid)}return await db.select().from(expenseTable).where(and(eq(expenseTable.tenant_id,tenantId),filters.date?eq(sql`date(${expenseTable.datetime})`,filters.date):void 0,filters.category?ilike(expenseTable.category,`%${filters.category}%`):void 0,filters.payment_method?ilike(expenseTable.payment_method,`%${filters.payment_method}%`):void 0,filters.provider_id?eq(expenseTable.provider_id,Number(filters.provider_id)):void 0,filters.amount_min?gte(expenseTable.amount,filters.amount_min):void 0,filters.amount_max?lte(expenseTable.amount,filters.amount_max):void 0,filters.is_deleted!==void 0?eq(expenseTable.is_deleted,filters.is_deleted):eq(expenseTable.is_deleted,!1))).orderBy(sql`${expenseTable.datetime} DESC`)}var addExpense=async(tenantId,actorUserId,newExpense)=>{let provider_id=normalizeProviderId(newExpense.provider_id);if(provider_id!==null)await assertProviderBelongsToTenant(tenantId,provider_id);let normalizedExpense={...newExpense,provider_id,tenant_id:tenantId,created_by_user_id:actorUserId,category:normalizeShortString(newExpense.category),payment_method:normalizeShortString(newExpense.payment_method),description:newExpense.description?.trim()??void 0};return console.log("datetime typeof:",typeof normalizedExpense.datetime,normalizedExpense.datetime),await db.insert(expenseTable).values(normalizedExpense).returning()},updateExpense=async(tenantId,expense_id,expense_upd)=>{let provider_id=normalizeProviderId(expense_upd.provider_id);if(provider_id)await assertProviderBelongsToTenant(tenantId,provider_id);let updateData={datetime:expense_upd.datetime,category:expense_upd.category?normalizeShortString(expense_upd.category):void 0,description:expense_upd.description!==void 0?expense_upd.description?.trim()??null:void 0,amount:expense_upd.amount,currency:expense_upd.currency,payment_method:expense_upd.payment_method?normalizeShortString(expense_upd.payment_method):void 0,provider_id};return await db.update(expenseTable).set(updateData).where(and(eq(expenseTable.expense_id,expense_id),eq(expenseTable.tenant_id,tenantId))).returning()};async function softDeleteExpense(tenantId,id){return(await db.update(expenseTable).set({is_deleted:!0}).where(and(eq(expenseTable.expense_id,id),eq(expenseTable.tenant_id,tenantId))).returning()).length>0}var getTotalExpenses=async(tenantId)=>{let result2=await db.select({total_expenses:sql`SUM(${expenseTable.amount})`}).from(expenseTable).where(and(eq(expenseTable.tenant_id,tenantId),eq(expenseTable.is_deleted,!1))),{total_expenses}=result2[0]??{total_expenses:0};return Number(total_expenses??0)},getTopExpensesByCategory=async(tenantId,display,fx,limit=5)=>{let since=new Date;since.setMonth(since.getMonth()-6);let rows=await db.select({category:expenseTable.category,amount:sql`COALESCE(${expenseTable.amount}, 0)`,currency:expenseTable.currency,datetime:expenseTable.datetime}).from(expenseTable).where(and(eq(expenseTable.tenant_id,tenantId),eq(expenseTable.is_deleted,!1),gte(expenseTable.datetime,since))),totals=new Map;for(let r3 of rows){let category=String(r3.category??"Sin categor\xEDa"),amt=Number(r3.amount??0);if(!Number.isFinite(amt)||amt===0)continue;let cur=isCurrency(r3.currency)?r3.currency:"ARS",converted=convert2(amt,cur,display,fx.ratesToARS);totals.set(category,(totals.get(category)??0)+converted)}return[...totals.entries()].map(([category,total])=>({category,total:round2(total)})).sort((a12,b2)=>b2.total-a12.total).slice(0,limit)};async function presignExpenseReceiptUpload(tenantId,expenseId,input){if(!isAllowedType(input.contentType))return{ok:!1,status:400,message:"INVALID_RECEIPT_TYPE"};if(input.size>MAX_SIZE)return{ok:!1,status:400,message:"RECEIPT_TOO_LARGE"};let[exp]=await db.select({expense_id:expenseTable.expense_id}).from(expenseTable).where(and(eq(expenseTable.expense_id,expenseId),eq(expenseTable.tenant_id,tenantId))).limit(1);if(!exp)return{ok:!1,status:404,message:"EXPENSE_NOT_FOUND"};let key=makeReceiptKey(tenantId,expenseId,input.filename),putUrl=await presignPut({key,contentType:input.contentType,expiresInSec:300});return{ok:!0,key,putUrl}}async function linkExpenseReceipt(tenantId,expenseId,input){if(!isAllowedType(input.contentType))return{ok:!1,status:400,message:"INVALID_RECEIPT_TYPE"};if(input.size>MAX_SIZE)return{ok:!1,status:400,message:"RECEIPT_TOO_LARGE"};if(!(await db.update(expenseTable).set({receipt_key:input.key,receipt_mime:input.contentType,receipt_original_name:input.filename,receipt_size:input.size,receipt_uploaded_at:new Date}).where(and(eq(expenseTable.expense_id,expenseId),eq(expenseTable.tenant_id,tenantId))).returning({expense_id:expenseTable.expense_id})).length)return{ok:!1,status:404,message:"EXPENSE_NOT_FOUND"};return{ok:!0}}async function getExpenseReceiptSignedUrl(tenantId,expenseId){let[expense]=await db.select({receipt_key:expenseTable.receipt_key,receipt_original_name:expenseTable.receipt_original_name,receipt_mime:expenseTable.receipt_mime}).from(expenseTable).where(and(eq(expenseTable.expense_id,expenseId),eq(expenseTable.tenant_id,tenantId))).limit(1);if(!expense?.receipt_key)return null;let disposition=`inline; filename="${(expense.receipt_original_name??"comprobante").replace(/"/g,"")}"`;return presignGet({key:expense.receipt_key,expiresInSec:600,responseContentDisposition:disposition})}var expenseController=new Elysia({prefix:"/expense"}).get("/",()=>({message:"Expense endpoint"})).get("/all",protectedController(async(ctx)=>{let{query,tenantId}=ctx;if(query.date||query.category||query.payment_method||query.provider_id||query.amount_min||query.amount_max||query.is_deleted)return await getExpensesByFilter(tenantId,{date:query.date,category:query.category,payment_method:query.payment_method,provider_id:query.provider_id,amount_min:query.amount_min,amount_max:query.amount_max,is_deleted:query.is_deleted===void 0?void 0:query.is_deleted==="true"});return await getAllExpenses(tenantId)}),{detail:{summary:"Get all expenses in DB (scoped by tenant)",tags:["expenses"]}}).get("/:id/receipt",protectedController(async(ctx)=>{let expenseId=Number(ctx.params.id),url=await getExpenseReceiptSignedUrl(ctx.tenantId,expenseId);if(!url){ctx.set.status=404;return}ctx.set.status=302,ctx.set.headers.Location=url;return})).post("/",protectedController(async(ctx)=>{let{body,set:set2}=ctx,result2=await addExpense(ctx.tenantId,ctx.user.id,{...body,datetime:body.datetime?new Date(body.datetime):void 0});return set2.status=201,result2}),{body:t.Object({...expenseInsertDTO.properties,datetime:t.Optional(t.String({format:"date-time"})),provider_id:t.Optional(t.Union([t.Integer(),t.Null(),t.String()]))})}).put("/:id",protectedController(async(ctx)=>{let{body,set:set2}=ctx,expenseId=Number(ctx.params.id);try{let result2=await updateExpense(ctx.tenantId,expenseId,{datetime:body.datetime?new Date(body.datetime):void 0,category:body.category,description:body.description,amount:body.amount,currency:body.currency,payment_method:body.payment_method,provider_id:body.provider_id});if(!result2.length)return set2.status=404,{error:"Gasto no encontrado"};return set2.status=200,result2[0]}catch(err){switch(err.message){case"PROVIDER_NOT_FOUND":return set2.status=400,{error:"Proveedor inv\xE1lido"};default:throw err}}}),{body:t.Object({...expenseUpdateDTO.properties,datetime:t.Optional(t.String({format:"date-time"})),provider_id:t.Optional(t.Union([t.Integer(),t.Null(),t.String()]))}),detail:{summary:"Update an expense (without receipt, bucket-based storage)",tags:["expenses"]}}).post("/:id/receipt/presign",protectedController(async(ctx)=>{let expenseId=Number(ctx.params.id),{contentType,filename,size}=ctx.body,result2=await presignExpenseReceiptUpload(ctx.tenantId,expenseId,{contentType,filename,size});if(!result2.ok)return ctx.set.status=result2.status,{ok:!1,message:result2.message};return{ok:!0,key:result2.key,putUrl:result2.putUrl}}),{body:t.Object({contentType:t.String({minLength:1,maxLength:100}),filename:t.String({minLength:1,maxLength:255}),size:t.Integer({minimum:1})})}).post("/:id/receipt/link",protectedController(async(ctx)=>{let expenseId=Number(ctx.params.id),{key,contentType,filename,size}=ctx.body,result2=await linkExpenseReceipt(ctx.tenantId,expenseId,{key,contentType,filename,size});if(!result2.ok)return ctx.set.status=result2.status,{ok:!1,message:result2.message};return{ok:!0}}),{body:t.Object({key:t.String({minLength:1,maxLength:1024}),contentType:t.String({minLength:1,maxLength:100}),filename:t.String({minLength:1,maxLength:255}),size:t.Integer({minimum:1})})}).delete("/:id",protectedController(async(ctx)=>{let expenseId=Number(ctx.params.id),ok=await softDeleteExpense(ctx.tenantId,expenseId);return ctx.set.status=ok?200:404,ok})).get("/expenses",protectedController(async(ctx)=>{return await getTotalExpenses(ctx.tenantId)}),{detail:{summary:"Get expenses (scoped by tenant)",tags:["sales"]}}).get("/top-by-category",protectedController(async(ctx)=>{let display=ctx.tenantSettings.display_currency??"ARS",fx=await getFxSnapshotVenta();return await getTopExpensesByCategory(ctx.tenantId,display,fx,5)}));async function getProviderByFilter(tenantId,filters){return await db.select().from(providerTable).where(and(eq(providerTable.tenant_id,tenantId),filters.name?ilike(providerTable.name,`%${filters.name}%`):void 0,filters.email?ilike(providerTable.email,`%${filters.email}%`):void 0,filters.phone_number?ilike(providerTable.phone_number,`%${filters.phone_number}%`):void 0,filters.address?ilikeWordsNormalized(providerTable.address,filters.address):void 0,filters.is_deleted!==void 0?eq(providerTable.is_deleted,filters.is_deleted):void 0)).orderBy(providerTable.provider_id)}var getAllProviders=async(tenantId)=>{return await db.select().from(providerTable).where(eq(providerTable.tenant_id,tenantId)).orderBy(providerTable.provider_id)},getProviderById=async(tenantId,id)=>{return await db.query.providerTable.findFirst({where:and(eq(providerTable.tenant_id,tenantId),eq(providerTable.provider_id,id),eq(providerTable.is_deleted,!1))})},addProvider=async(newProvider)=>{let normalizedProvider={...newProvider,name:normalizeShortString(newProvider.name),address:normalizeShortString(newProvider.address),phone_number:newProvider.phone_number.trim(),email:newProvider.email?.toLowerCase().trim()};return await db.insert(providerTable).values(normalizedProvider).returning()};async function updateProvider(tenantId,provider_id,provider_upd){let normalized={...provider_upd,name:provider_upd.name?normalizeShortString(provider_upd.name):void 0,address:provider_upd.address?normalizeShortString(provider_upd.address):void 0,phone_number:provider_upd.phone_number?provider_upd.phone_number.trim():void 0,email:provider_upd.email?provider_upd.email.toLowerCase().trim():void 0};return await db.update(providerTable).set(normalized).where(and(eq(providerTable.tenant_id,tenantId),eq(providerTable.provider_id,provider_id))).returning()}async function softDeleteProvider(tenantId,id){return(await db.update(providerTable).set({is_deleted:!0}).where(and(eq(providerTable.tenant_id,tenantId),eq(providerTable.provider_id,id))).returning()).length>0}var providerController=new Elysia({prefix:"/provider"}).get("/",()=>({message:"Provider endpoint"})).get("/all",protectedController(async(ctx)=>{let{tenantId,query}=ctx;if(query.name||query.email||query.phone_number||query.address||query.is_deleted)return await getProviderByFilter(tenantId,{name:query.name,email:query.email,phone_number:query.phone_number,address:query.address,is_deleted:query.is_deleted===void 0?void 0:query.is_deleted==="true"});return await getAllProviders(tenantId)}),{detail:{summary:"Get all providers in DB (scoped by tenant)",tags:["providers"]}}).get("/:id",protectedController(async(ctx)=>{let providerId=Number(ctx.params.id);return await getProviderById(ctx.tenantId,providerId)}),{detail:{summary:"Get provider details by ID (scoped by tenant)",tags:["providers"]}}).post("/",protectedController(async(ctx)=>{let{tenantId,body}=ctx,newProvider={tenant_id:tenantId,name:body.name,phone_number:body.phone_number,...body.email&&{email:body.email},address:body.address},result2=await addProvider(newProvider);return ctx.set.status=201,result2}),{body:t.Object({...providerInsertDTO.properties}),detail:{summary:"Insert a new provider (scoped by tenant)",tags:["providers"]}}).put("/:id",protectedController(async(ctx)=>{let providerId=Number(ctx.params.id),body=ctx.body,updProvider={name:body.name,phone_number:body.phone_number,...body.email&&{email:body.email},address:body.address},result2=await updateProvider(ctx.tenantId,providerId,updProvider);return ctx.set.status=200,result2}),{body:t.Object({...providerUpdateDTO.properties}),detail:{summary:"Update a provider (scoped by tenant)",tags:["providers"]}}).delete("/:id",protectedController(async(ctx)=>{let providerId=Number(ctx.params.id),ok=await softDeleteProvider(ctx.tenantId,providerId);return ctx.set.status=ok?200:404,ok}));async function assertTenantClient2(tenantId,clientId){let rows=await db.select({id:clientTable.client_id,is_deleted:clientTable.is_deleted}).from(clientTable).where(and(eq(clientTable.tenant_id,tenantId),eq(clientTable.client_id,clientId))).limit(1);if(!rows[0]||rows[0].is_deleted)throw Error("INVALID_CLIENT")}async function assertTenantSeller(tenantId,sellerId){let rows=await db.select({id:sellerTable.seller_id,is_deleted:sellerTable.is_deleted}).from(sellerTable).where(and(eq(sellerTable.tenant_id,tenantId),eq(sellerTable.seller_id,sellerId))).limit(1);if(!rows[0]||rows[0].is_deleted)throw Error("INVALID_SELLER")}async function assertTenantDevice2(tenantId,deviceId){let rows=await db.select({id:phoneTable.device_id,is_deleted:phoneTable.is_deleted}).from(phoneTable).where(and(eq(phoneTable.tenant_id,tenantId),eq(phoneTable.device_id,deviceId))).limit(1);if(!rows[0]||rows[0].is_deleted)throw Error("INVALID_DEVICE")}async function assertTenantTradeIn(tenantId,deviceId){let rows=await db.select({id:phoneTable.device_id,is_deleted:phoneTable.is_deleted}).from(phoneTable).where(and(eq(phoneTable.tenant_id,tenantId),eq(phoneTable.device_id,deviceId))).limit(1);if(!rows[0]||rows[0].is_deleted)throw Error("INVALID_TRADE_IN")}function toRoundedInt(n3){let v=Number(n3);if(!Number.isFinite(v))return 0;return Math.round(v)}async function getSellerCommissionPct(tx,tenantId,sellerId){let r3=(await tx.select({commission:sql`COALESCE(${sellerTable.commission}, '0.00')::text`,is_deleted:sellerTable.is_deleted}).from(sellerTable).where(and(eq(sellerTable.tenant_id,tenantId),eq(sellerTable.seller_id,sellerId))).limit(1))[0];if(!r3||r3.is_deleted)throw Error("INVALID_SELLER");return Number(r3.commission??0)}var generalStringFormat=(v)=>{if(!v)return"";return v.split("-").map((p2)=>{if(!p2)return"";let word=p2.charAt(0).toUpperCase()+p2.slice(1);if(word==="Iphone")word="iPhone";return word}).join(" ")};async function upsertCommissionExpense(tx,tenantId,saleId,datetime,paymentMethod,currency,sellerId,saleTotalAmount){let pct=await getSellerCommissionPct(tx,tenantId,sellerId),seller=(await db.select().from(sellerTable).where(and(eq(sellerTable.tenant_id,tenantId),eq(sellerTable.seller_id,sellerId))).limit(1))[0];if(!seller)throw Error("INVALID_SELLER");let total=Number(saleTotalAmount??0),amount=Number((total*pct/100).toFixed(2)),description=`Comisi\xF3n vendedor ${generalStringFormat(seller.name)} (${pct.toFixed(2)}%)`,existing=await tx.select({expense_id:expenseTable.expense_id}).from(expenseTable).where(and(eq(expenseTable.tenant_id,tenantId),eq(expenseTable.is_deleted,!1),eq(expenseTable.category,"Comisiones"),eq(expenseTable.sale_id,saleId))).limit(1);if(amount<=0){if(existing[0]?.expense_id)await tx.update(expenseTable).set({is_deleted:!0}).where(and(eq(expenseTable.tenant_id,tenantId),eq(expenseTable.expense_id,existing[0].expense_id)));return}if(existing[0]?.expense_id){await tx.update(expenseTable).set({datetime:datetime??new Date,amount:String(amount),payment_method:paymentMethod,description}).where(and(eq(expenseTable.tenant_id,tenantId),eq(expenseTable.expense_id,existing[0].expense_id)));return}await tx.insert(expenseTable).values({tenant_id:tenantId,sale_id:saleId,datetime:datetime??new Date,category:"Comisiones",description,amount:String(amount),payment_method:paymentMethod,currency,receipt_number:null,provider_id:null,is_deleted:!1})}async function softDeleteExpensesBySale(tx,tenantId,saleId){await tx.update(expenseTable).set({is_deleted:!0}).where(and(eq(expenseTable.tenant_id,tenantId),eq(expenseTable.sale_id,saleId),eq(expenseTable.is_deleted,!1)))}async function applyGiftStockAndBridgeInsert(tx,tenantId,saleId,giftLines){if(!giftLines.length)return{giftExpenseTotal:0,giftDescription:""};let grouped=new Map;for(let g of giftLines){if(!g?.accessory_id)continue;let qty=Math.max(1,Number(g.qty||1));grouped.set(g.accessory_id,(grouped.get(g.accessory_id)??0)+qty)}let cleanLines=Array.from(grouped.entries()).map(([accessory_id,qty])=>({accessory_id,qty})),ids=cleanLines.map((g)=>g.accessory_id),accessories=await tx.select({accessory_id:accessoryTable.accessory_id,name:accessoryTable.name,brand:accessoryTable.brand,stock:accessoryTable.stock,price:sql`(${accessoryTable.price})::text`,buy_cost:sql`(${accessoryTable.buy_cost})::text`}).from(accessoryTable).where(and(eq(accessoryTable.tenant_id,tenantId),inArray(accessoryTable.accessory_id,ids),eq(accessoryTable.is_deleted,!1))),byId=new Map(accessories.map((a12)=>[a12.accessory_id,a12]));for(let line2 of cleanLines){let a12=byId.get(line2.accessory_id);if(!a12)throw Error("ACCESSORY_NOT_FOUND");if(line2.qty>a12.stock)throw Error("INSUFFICIENT_STOCK")}let total=0,parts=[];for(let line2 of cleanLines){let a12=byId.get(line2.accessory_id);await tx.update(accessoryTable).set({stock:sql`${accessoryTable.stock} - ${line2.qty}`}).where(and(eq(accessoryTable.tenant_id,tenantId),eq(accessoryTable.accessory_id,line2.accessory_id),eq(accessoryTable.is_deleted,!1))),await tx.insert(saleGiftAccessoryTable).values({tenant_id:tenantId,sale_id:saleId,accessory_id:line2.accessory_id,qty:line2.qty,unit_price:a12.price,unit_buy_cost:a12.buy_cost,is_deleted:!1}).onConflictDoUpdate({target:[saleGiftAccessoryTable.sale_id,saleGiftAccessoryTable.accessory_id],set:{qty:line2.qty,unit_price:a12.price,unit_buy_cost:a12.buy_cost,is_deleted:!1}});let priceNum=Number(a12.price??0);total+=priceNum*line2.qty,parts.push(`${line2.qty}x ${a12.brand} ${a12.name}`.trim())}let giftDescription=`Regalo accesorios: ${parts.join(", ")}`;return{giftExpenseTotal:Number(total.toFixed(2)),giftDescription}}async function upsertGiftExpense(tx,tenantId,saleId,datetime,paymentMethod,currency,amount,description){let existing=await tx.select({expense_id:expenseTable.expense_id}).from(expenseTable).where(and(eq(expenseTable.tenant_id,tenantId),eq(expenseTable.is_deleted,!1),eq(expenseTable.category,"Regalos"),eq(expenseTable.sale_id,saleId))).limit(1);if(amount<=0){if(existing[0]?.expense_id)await tx.update(expenseTable).set({is_deleted:!0}).where(and(eq(expenseTable.tenant_id,tenantId),eq(expenseTable.expense_id,existing[0].expense_id)));return}if(existing[0]?.expense_id){await tx.update(expenseTable).set({datetime:datetime??new Date,amount:String(amount),payment_method:paymentMethod,currency,description}).where(and(eq(expenseTable.tenant_id,tenantId),eq(expenseTable.expense_id,existing[0].expense_id)));return}await tx.insert(expenseTable).values({tenant_id:tenantId,sale_id:saleId,datetime:datetime??new Date,category:"Regalos",description,amount:String(amount),payment_method:paymentMethod,currency,receipt_number:null,provider_id:null,is_deleted:!1})}async function revertExistingGiftsToStockAndDeleteBridge(tx,tenantId,saleId){let existing=await tx.select({accessory_id:saleGiftAccessoryTable.accessory_id,qty:saleGiftAccessoryTable.qty,is_deleted:saleGiftAccessoryTable.is_deleted}).from(saleGiftAccessoryTable).where(and(eq(saleGiftAccessoryTable.tenant_id,tenantId),eq(saleGiftAccessoryTable.sale_id,saleId),eq(saleGiftAccessoryTable.is_deleted,!1)));for(let line2 of existing)await tx.update(accessoryTable).set({stock:sql`${accessoryTable.stock} + ${line2.qty}`}).where(and(eq(accessoryTable.tenant_id,tenantId),eq(accessoryTable.accessory_id,line2.accessory_id),eq(accessoryTable.is_deleted,!1)));await tx.update(saleGiftAccessoryTable).set({is_deleted:!0}).where(and(eq(saleGiftAccessoryTable.tenant_id,tenantId),eq(saleGiftAccessoryTable.sale_id,saleId),eq(saleGiftAccessoryTable.is_deleted,!1)))}async function getSaleByFilter(tenantId,filters){return await db.select().from(saleTable).where(and(eq(saleTable.tenant_id,tenantId),filters.date?eq(sql`date(${saleTable.datetime})`,filters.date):void 0,filters.client_id?eq(saleTable.client_id,Number(filters.client_id)):void 0,filters.seller_id?eq(saleTable.seller_id,Number(filters.seller_id)):void 0,filters.device_id?eq(saleTable.device_id,Number(filters.device_id)):void 0,filters.is_deleted!==void 0?eq(saleTable.is_deleted,filters.is_deleted):void 0)).orderBy(sql`${saleTable.datetime} DESC`)}var getAllSales=async(tenantId)=>{return await db.select().from(saleTable).where(eq(saleTable.tenant_id,tenantId)).orderBy(sql`${saleTable.datetime} DESC`)},getSaleById=async(tenantId,id)=>{return await db.query.saleTable.findFirst({where:and(eq(saleTable.tenant_id,tenantId),eq(saleTable.sale_id,id),eq(saleTable.is_deleted,!1))})},addSale=async(tenantId,newSale)=>{if(await assertTenantClient2(tenantId,newSale.client_id),await assertTenantSeller(tenantId,newSale.seller_id),await assertTenantDevice2(tenantId,newSale.device_id),newSale.trade_in_device!==void 0)await assertTenantTradeIn(tenantId,newSale.trade_in_device);let giftLines=newSale.gift_accessories??[],{gift_accessories,trade_in_phone,trade_in_device,...saleOnly}=newSale,normalizedSale={...saleOnly,tenant_id:tenantId,payment_method:normalizeShortString(newSale.payment_method)};return await db.transaction(async(tx)=>{let tradeInId=trade_in_device??null;if(!tradeInId&&trade_in_phone){console.log(trade_in_phone);let values2={...trade_in_phone,tenant_id:tenantId,trade_in:!0,sold:!1,brand:normalizeShortString(trade_in_phone.brand),name:normalizeShortString(trade_in_phone.name),device_type:normalizeShortString(trade_in_phone.device_type),color:trade_in_phone.color?normalizeShortString(trade_in_phone.color):trade_in_phone.color,category:trade_in_phone.category?normalizeShortString(trade_in_phone.category):trade_in_phone.category,imei:trade_in_phone.imei.trim()};if(tradeInId=(await tx.insert(phoneTable).values(values2).returning({device_id:phoneTable.device_id}))[0]?.device_id??null,!tradeInId)throw Error("TRADE_IN_CREATE_FAILED")}let inserted=await tx.insert(saleTable).values({...normalizedSale,trade_in_device:tradeInId}).returning(),saleId=inserted[0]?.sale_id;if(!saleId)throw Error("SALE_NOT_FOUND");await tx.update(phoneTable).set({sold:!0}).where(and(eq(phoneTable.tenant_id,tenantId),eq(phoneTable.device_id,newSale.device_id)));let addDebt=newSale.debt&&newSale.debt_amount?toRoundedInt(newSale.debt_amount):0;if(addDebt!==0){let c=(await tx.select({debt:clientTable.debt,is_deleted:clientTable.is_deleted}).from(clientTable).where(and(eq(clientTable.tenant_id,tenantId),eq(clientTable.client_id,newSale.client_id))).limit(1))[0];if(!c||c.is_deleted)throw Error("INVALID_CLIENT");await tx.update(clientTable).set({debt:Math.max(0,Number(c.debt)+addDebt)}).where(and(eq(clientTable.tenant_id,tenantId),eq(clientTable.client_id,newSale.client_id)))}await upsertCommissionExpense(tx,tenantId,saleId,normalizedSale.datetime,normalizedSale.payment_method,normalizedSale.currency,newSale.seller_id,newSale.total_amount);let giftLines2=newSale.gift_accessories??[],{giftExpenseTotal,giftDescription}=await applyGiftStockAndBridgeInsert(tx,tenantId,saleId,giftLines2);return await upsertGiftExpense(tx,tenantId,saleId,normalizedSale.datetime,normalizedSale.payment_method,normalizedSale.currency,giftExpenseTotal,giftDescription),inserted})};async function updateSale(tenantId,sale_id,sale_upd){let current=(await db.select().from(saleTable).where(and(eq(saleTable.tenant_id,tenantId),eq(saleTable.sale_id,sale_id))).limit(1))[0];if(!current||current.is_deleted)throw Error("SALE_NOT_FOUND");if(sale_upd.client_id!==void 0)await assertTenantClient2(tenantId,sale_upd.client_id);if(sale_upd.seller_id!==void 0)await assertTenantSeller(tenantId,sale_upd.seller_id);if(sale_upd.device_id!==void 0)await assertTenantDevice2(tenantId,sale_upd.device_id);if(sale_upd.trade_in_device!==void 0)await assertTenantTradeIn(tenantId,sale_upd.trade_in_device);let giftLines=sale_upd.gift_accessories,{gift_accessories,...saleOnlyUpd}=sale_upd,normalizedUpd={...saleOnlyUpd,payment_method:saleOnlyUpd.payment_method?normalizeShortString(saleOnlyUpd.payment_method):void 0},prevDebt=current.debt&&current.debt_amount?toRoundedInt(current.debt_amount):0,nextDebtFlag=sale_upd.debt??current.debt,nextDebtAmount=sale_upd.debt_amount??current.debt_amount,nextDebt=nextDebtFlag&&nextDebtAmount?toRoundedInt(nextDebtAmount):0,prevClientId=current.client_id,nextClientId=sale_upd.client_id??prevClientId;return await db.transaction(async(tx)=>{let updated=await tx.update(saleTable).set(normalizedUpd).where(and(eq(saleTable.tenant_id,tenantId),eq(saleTable.sale_id,sale_id))).returning(),nextPayment=normalizedUpd.payment_method??String(current.payment_method),nextDatetime=normalizedUpd.datetime??current.datetime,nextSellerId=sale_upd.seller_id??current.seller_id,nextTotalAmount=sale_upd.total_amount??String(current.total_amount??"0"),nextCurrency=sale_upd.currency??current.currency;if(await upsertCommissionExpense(tx,tenantId,sale_id,nextDatetime,nextPayment,nextCurrency,nextSellerId,nextTotalAmount),sale_upd.device_id!==void 0&&sale_upd.device_id!==current.device_id)await tx.update(phoneTable).set({sold:!1}).where(and(eq(phoneTable.tenant_id,tenantId),eq(phoneTable.device_id,current.device_id))),await tx.update(phoneTable).set({sold:!0}).where(and(eq(phoneTable.tenant_id,tenantId),eq(phoneTable.device_id,sale_upd.device_id)));if(prevClientId===nextClientId){let delta2=nextDebt-prevDebt;if(delta2!==0){let[c]=await tx.select({debt:clientTable.debt,is_deleted:clientTable.is_deleted}).from(clientTable).where(and(eq(clientTable.tenant_id,tenantId),eq(clientTable.client_id,nextClientId))).limit(1);if(!c||c.is_deleted)throw Error("INVALID_CLIENT");await tx.update(clientTable).set({debt:Math.max(0,Number(c.debt)+delta2)}).where(and(eq(clientTable.tenant_id,tenantId),eq(clientTable.client_id,nextClientId)))}}else{if(prevDebt!==0){let[cPrev]=await tx.select({debt:clientTable.debt,is_deleted:clientTable.is_deleted}).from(clientTable).where(and(eq(clientTable.tenant_id,tenantId),eq(clientTable.client_id,prevClientId))).limit(1);if(!cPrev||cPrev.is_deleted)throw Error("INVALID_CLIENT");await tx.update(clientTable).set({debt:Math.max(0,Number(cPrev.debt)-prevDebt)}).where(and(eq(clientTable.tenant_id,tenantId),eq(clientTable.client_id,prevClientId)))}if(nextDebt!==0){let[cNext]=await tx.select({debt:clientTable.debt,is_deleted:clientTable.is_deleted}).from(clientTable).where(and(eq(clientTable.tenant_id,tenantId),eq(clientTable.client_id,nextClientId))).limit(1);if(!cNext||cNext.is_deleted)throw Error("INVALID_CLIENT");await tx.update(clientTable).set({debt:Math.max(0,Number(cNext.debt)+nextDebt)}).where(and(eq(clientTable.tenant_id,tenantId),eq(clientTable.client_id,nextClientId)))}}if(sale_upd.gift_accessories!==void 0){await revertExistingGiftsToStockAndDeleteBridge(tx,tenantId,sale_id);let{giftExpenseTotal,giftDescription}=await applyGiftStockAndBridgeInsert(tx,tenantId,sale_id,sale_upd.gift_accessories??[]),nextPayment2=normalizedUpd.payment_method??String(current.payment_method),nextDatetime2=normalizedUpd.datetime??current.datetime;await upsertGiftExpense(tx,tenantId,sale_id,nextDatetime2,nextPayment2,nextCurrency,giftExpenseTotal,giftDescription)}return updated})}async function softDeleteSale(tenantId,id){return await db.transaction(async(tx)=>{let saleRows=await tx.select().from(saleTable).where(and(eq(saleTable.tenant_id,tenantId),eq(saleTable.sale_id,id)));if(saleRows.length===0)return!1;let sale=saleRows[0];if(!sale||sale.is_deleted)return!1;if(await tx.update(saleTable).set({is_deleted:!0}).where(and(eq(saleTable.tenant_id,tenantId),eq(saleTable.sale_id,id))),sale.device_id)await tx.update(phoneTable).set({sold:!1}).where(and(eq(phoneTable.tenant_id,tenantId),eq(phoneTable.device_id,sale.device_id)));let subtract=sale.debt&&sale.debt_amount?toRoundedInt(sale.debt_amount):0;if(subtract!==0&&sale.client_id){let[client]=await tx.select({debt:clientTable.debt,is_deleted:clientTable.is_deleted}).from(clientTable).where(and(eq(clientTable.tenant_id,tenantId),eq(clientTable.client_id,sale.client_id))).limit(1);if(client&&!client.is_deleted){let newDebt=Math.max(0,Number(client.debt)-subtract);await tx.update(clientTable).set({debt:newDebt}).where(and(eq(clientTable.tenant_id,tenantId),eq(clientTable.client_id,sale.client_id)))}}return await softDeleteExpensesBySale(tx,tenantId,id),!0})}var getGrossIncome=async(tenantId,display,fx)=>{let sales=await db.select({amount:saleTable.total_amount,debt_amount:saleTable.debt_amount,currency:saleTable.currency}).from(saleTable).where(and(eq(saleTable.tenant_id,tenantId),eq(saleTable.is_deleted,!1))),round22=(n3)=>Math.round(n3*100)/100,gross=0;for(let s2 of sales)if(gross+=convert2(Number(s2.amount),s2.currency,display,fx.ratesToARS),s2.debt_amount)gross-=convert2(Number(s2.debt_amount),s2.currency,display,fx.ratesToARS);return gross=round22(gross),gross},getNetIncome=async(tenantId,display,fx)=>{let result2=await db.select({amount:saleTable.total_amount,buy_cost:phoneTable.buy_cost,currency:saleTable.currency}).from(saleTable).innerJoin(phoneTable,eq(saleTable.device_id,phoneTable.device_id)).where(and(eq(saleTable.tenant_id,tenantId),eq(saleTable.is_deleted,!1))),net2=0;for(let s2 of result2)net2+=convert2(Number(s2.amount),s2.currency,display,fx.ratesToARS),net2-=convert2(Number(s2.buy_cost),s2.currency,display,fx.ratesToARS);return net2=round2(net2),net2},getSalesByMonth=async(tenantId,year)=>{let start=new Date(Date.UTC(year,0,1)),end=new Date(Date.UTC(year+1,0,1)),rows=await db.select({month_start_date:sql`DATE_TRUNC('month', ${saleTable.datetime})`,count:sql`CAST(COUNT(*) AS INTEGER)`}).from(saleTable).where(and(eq(saleTable.tenant_id,tenantId),eq(saleTable.is_deleted,!1),gte(saleTable.datetime,start),lt(saleTable.datetime,end))).groupBy(sql`DATE_TRUNC('month', ${saleTable.datetime})`).orderBy(sql`DATE_TRUNC('month', ${saleTable.datetime}) ASC`),countsByMonth=new Map;for(let r3 of rows){let monthIndex=new Date(r3.month_start_date).getUTCMonth();countsByMonth.set(monthIndex,Number(r3.count)||0)}return Array.from({length:12},(_2,i2)=>{return{month_start_date:new Date(Date.UTC(year,i2,1)).toISOString(),count:countsByMonth.get(i2)??0}})},getProductSoldCount=async(tenantId)=>{return await db.select({name:phoneTable.name,sold_count:sql`CAST(COUNT(${saleTable.device_id}) AS INTEGER)`}).from(saleTable).innerJoin(phoneTable,and(eq(saleTable.device_id,phoneTable.device_id),eq(phoneTable.tenant_id,tenantId))).where(and(eq(saleTable.tenant_id,tenantId),eq(saleTable.is_deleted,!1))).groupBy(phoneTable.name).orderBy(sql`COUNT(${saleTable.device_id}) DESC`).limit(5)},getDebts2=async(tenantId)=>{return await db.select().from(saleTable).where(and(eq(saleTable.tenant_id,tenantId),eq(saleTable.debt,!0),eq(saleTable.is_deleted,!1)))},getTotalDebt2=async(tenantId)=>{let debts=await db.select({total_debt:sql`SUM(${saleTable.debt_amount})`}).from(saleTable).where(and(eq(saleTable.tenant_id,tenantId),eq(saleTable.debt,!0),eq(saleTable.is_deleted,!1)));return Number(debts[0]?.total_debt)||0},getNetIncomeBreakdown=async(tenantId,display,fx)=>{return(await db.select({sale_id:saleTable.sale_id,device_name:phoneTable.name,buy_cost:sql`COALESCE(${phoneTable.buy_cost}, 0)`,phone_currency:phoneTable.currency_buy,total_amount:sql`COALESCE(${saleTable.total_amount}, 0)`,sale_currency:saleTable.currency}).from(saleTable).innerJoin(phoneTable,eq(saleTable.device_id,phoneTable.device_id)).where(and(eq(saleTable.tenant_id,tenantId),eq(saleTable.is_deleted,!1)))).map((r3)=>{let buy=Number(r3.buy_cost??0),sale=Number(r3.total_amount??0),buyCur=isCurrency(r3.phone_currency)?r3.phone_currency:"ARS",saleCur=isCurrency(r3.sale_currency)?r3.sale_currency:"ARS",buyDisplay=convert2(buy,buyCur,display,fx.ratesToARS),netDisplay=convert2(sale,saleCur,display,fx.ratesToARS)-buyDisplay;return{sale_id:r3.sale_id,device_name:r3.device_name,displayCurrency:display,buy_display:fmtMoney(buy,r3.phone_currency),sale_display:fmtMoney(sale,r3.sale_currency),net_display:fmtMoney(netDisplay,display)}})};function startOfDayUTC(dateStr){return new Date(`${dateStr}T00:00:00.000Z`)}function nextDayUTC(dateStr){let d=startOfDayUTC(dateStr);return d.setUTCDate(d.getUTCDate()+1),d}async function getSellersOverviewMetrics(tenantId,display,fx){let from=new Date;from.setUTCMonth(from.getUTCMonth()-6);let fromDate=startOfDayUTC(from.toISOString().slice(0,10)),todayIso=new Date().toISOString().slice(0,10),toDateExclusive=nextDayUTC(todayIso),rows=await db.select({amount:sql`COALESCE(${saleTable.total_amount}, 0)`,currency:saleTable.currency,commission_pct:sql`COALESCE(${sellerTable.commission}, 0)`}).from(saleTable).innerJoin(sellerTable,and(eq(sellerTable.tenant_id,tenantId),eq(sellerTable.seller_id,saleTable.seller_id))).where(and(eq(saleTable.tenant_id,tenantId),eq(saleTable.is_deleted,!1),gte(saleTable.datetime,fromDate),lt(saleTable.datetime,toDateExclusive))),sales_count=0,total_sold_display=0,commission_total_display=0;for(let r3 of rows){sales_count+=1;let amt=Number(r3.amount??0);if(!Number.isFinite(amt))continue;let cur=isCurrency(r3.currency)?r3.currency:"ARS",saleDisplay=convert2(amt,cur,display,fx.ratesToARS);total_sold_display+=saleDisplay;let pct=Number(r3.commission_pct??0);commission_total_display+=saleDisplay*(pct/100)}total_sold_display=round2(total_sold_display),commission_total_display=round2(commission_total_display);let avg_ticket=sales_count>0?round2(total_sold_display/sales_count):0;return{displayCurrency:display,sales_count,total_sold:total_sold_display,total_sold_formatted:fmtMoney(total_sold_display,display),commission_total:commission_total_display,commission_total_formatted:fmtMoney(commission_total_display,display),avg_ticket,avg_ticket_formatted:fmtMoney(avg_ticket,display),range:{from:fromDate.toISOString(),toExclusive:toDateExclusive.toISOString()}}}async function getSalesCountBySeller(tenantId,filters){return await db.select({seller_id:sellerTable.seller_id,name:sellerTable.name,sales_count:sql`CAST(COUNT(${saleTable.sale_id}) AS INTEGER)`}).from(sellerTable).leftJoin(saleTable,and(eq(saleTable.seller_id,sellerTable.seller_id),eq(saleTable.tenant_id,tenantId),eq(saleTable.is_deleted,!1),filters?.from?gte(saleTable.datetime,new Date(filters.from)):void 0,filters?.to?lte(saleTable.datetime,new Date(filters.to)):void 0)).where(and(eq(sellerTable.tenant_id,tenantId),eq(sellerTable.is_deleted,!1))).groupBy(sellerTable.seller_id,sellerTable.name).orderBy(sql`COUNT(${saleTable.sale_id}) DESC`)}async function getSellerLeaderboard(tenantId,display,fx,opts){let limit=Math.min(Math.max(Number(opts?.limit??5),1),20),from=new Date;from.setUTCMonth(from.getUTCMonth()-6);let fromDate=startOfDayUTC(from.toISOString().slice(0,10)),todayIso=new Date().toISOString().slice(0,10),toDateExclusive=nextDayUTC(todayIso),rows=await db.select({seller_id:sellerTable.seller_id,name:sellerTable.name,commission_pct:sql`COALESCE(${sellerTable.commission}, 0)`,amount:sql`COALESCE(${saleTable.total_amount}, 0)`,currency:saleTable.currency,datetime:saleTable.datetime}).from(saleTable).innerJoin(sellerTable,and(eq(sellerTable.tenant_id,tenantId),eq(sellerTable.seller_id,saleTable.seller_id),eq(sellerTable.is_deleted,!1))).where(and(eq(saleTable.tenant_id,tenantId),eq(saleTable.is_deleted,!1),gte(saleTable.datetime,fromDate),lt(saleTable.datetime,toDateExclusive))),bySeller=new Map;for(let r3 of rows){let sid=Number(r3.seller_id);if(!Number.isFinite(sid))continue;let amt=Number(r3.amount??0);if(!Number.isFinite(amt))continue;let cur=isCurrency(r3.currency)?r3.currency:"ARS",saleDisplay=convert2(amt,cur,display,fx.ratesToARS),pct=Number(r3.commission_pct??0),commissionAdd=saleDisplay*(pct/100),existing=bySeller.get(sid)??{seller_id:sid,name:String(r3.name??""),commission_pct:pct,sales_count:0,total_sold_display:0,commission_total_display:0};existing.sales_count+=1,existing.total_sold_display+=saleDisplay,existing.commission_total_display+=commissionAdd,existing.name=String(r3.name??existing.name),existing.commission_pct=pct,bySeller.set(sid,existing)}return[...bySeller.values()].map((s2)=>{let total_sold=round2(s2.total_sold_display),commission_total=round2(s2.commission_total_display),avg_ticket=s2.sales_count>0?round2(total_sold/s2.sales_count):0;return{seller_id:s2.seller_id,name:s2.name,sales_count:s2.sales_count,total_sold,total_sold_formatted:fmtMoney(total_sold,display),commission_total,commission_total_formatted:fmtMoney(commission_total,display),avg_ticket,avg_ticket_formatted:fmtMoney(avg_ticket,display),displayCurrency:display}}).sort((a12,b2)=>b2.total_sold-a12.total_sold).slice(0,limit)}function startOfMonthUTC(d=new Date){return new Date(Date.UTC(d.getUTCFullYear(),d.getUTCMonth(),1))}function nextMonthUTC(d=new Date){return new Date(Date.UTC(d.getUTCFullYear(),d.getUTCMonth()+1,1))}async function getSalesPublicOverviewWithMonthSeries(tenantId,display,fx){let from=startOfMonthUTC(new Date),to=nextMonthUTC(new Date),o2=(await db.select({sales_count:sql`CAST(COUNT(${saleTable.sale_id}) AS INTEGER)`,debt_sales_count:sql`
        CAST(
          COUNT(
            CASE 
              WHEN ${saleTable.debt} = true 
              AND COALESCE(${saleTable.debt_amount}, 0) > 0 
              THEN 1 
            END
          ) AS INTEGER
        )
      `}).from(saleTable).where(and(eq(saleTable.tenant_id,tenantId),eq(saleTable.is_deleted,!1))))[0]??{},sales_count=Number(o2.sales_count??0),salesMoneyRows=await db.select({amount:sql`COALESCE(${saleTable.total_amount}, 0)`,currency:saleTable.currency}).from(saleTable).where(and(eq(saleTable.tenant_id,tenantId),eq(saleTable.is_deleted,!1))),total_sold_all_time_display=0;for(let r3 of salesMoneyRows){let amt=Number(r3.amount??0);if(!Number.isFinite(amt)||amt===0)continue;let cur=isCurrency(r3.currency)?r3.currency:"ARS";total_sold_all_time_display+=convert2(amt,cur,display,fx.ratesToARS)}total_sold_all_time_display=round2(total_sold_all_time_display);let avg_ticket=sales_count>0?round2(total_sold_all_time_display/sales_count):0,seriesRows=await db.select({day:sql`to_char(DATE_TRUNC('day', ${saleTable.datetime}), 'YYYY-MM-DD')`,sold_count:sql`CAST(COUNT(${saleTable.sale_id}) AS INTEGER)`}).from(saleTable).where(and(eq(saleTable.tenant_id,tenantId),eq(saleTable.is_deleted,!1),gte(saleTable.datetime,from),lt(saleTable.datetime,to))).groupBy(sql`DATE_TRUNC('day', ${saleTable.datetime})`).orderBy(sql`DATE_TRUNC('day', ${saleTable.datetime}) ASC`),map3=new Map;for(let r3 of seriesRows)map3.set(String(r3.day),Number(r3.sold_count??0));let points=[],cursor=new Date(from);while(cursor<to){let dayStr=cursor.toISOString().slice(0,10);points.push({day:dayStr,sold_count:map3.get(dayStr)??0}),cursor.setUTCDate(cursor.getUTCDate()+1)}return{displayCurrency:display,total_sold_all_time:total_sold_all_time_display,avg_ticket:fmtMoney(avg_ticket,display),debt_sales_count:Number(o2.debt_sales_count??0),month_series:points}}var saleController=new Elysia({prefix:"/sale"}).get("/",()=>({message:"Sale endpoint"})).get("/all",protectedController(async(ctx)=>{let{tenantId,query}=ctx;if(query.date||query.client_id||query.seller_id||query.device_id||query.is_deleted)return await getSaleByFilter(tenantId,{date:query.date,client_id:query.client_id,seller_id:query.seller_id,device_id:query.device_id,is_deleted:query.is_deleted===void 0?void 0:query.is_deleted==="true"});return await getAllSales(tenantId)}),{detail:{summary:"Get all sales in DB (scoped by tenant)",tags:["sales"]}}).get("/:id",protectedController(async(ctx)=>{let tenantId=ctx.tenantId,saleId=Number(ctx.params.id);return await getSaleById(tenantId,saleId)}),{detail:{summary:"Get sale details by ID (scoped by tenant)",tags:["sales"]}}).post("/",protectedController(async(ctx)=>{let{tenantId,body}=ctx;if(body.trade_in_device&&body.trade_in_phone)return ctx.set.status=400,{error:"TRADE_IN_CONFLICT"};let newSale={datetime:body.datetime?new Date(body.datetime):void 0,total_amount:body.total_amount,currency:body.currency,payment_method:body.payment_method,debt:body.debt,...body.debt_amount&&{debt_amount:body.debt_amount},client_id:body.client_id,seller_id:body.seller_id,device_id:body.device_id,trade_in_phone:body.trade_in_phone??void 0,...body.trade_in_device&&{trade_in_device:body.trade_in_device},gift_accessories:body.gift_accessories??[]};try{let result2=await addSale(tenantId,newSale);return ctx.set.status=201,result2}catch(err){let msg=err?.message;if(msg==="INVALID_CLIENT"||msg==="INVALID_SELLER"||msg==="INVALID_DEVICE"||msg==="INVALID_TRADE_IN")return ctx.set.status=400,{error:msg};if(msg==="SALE_NOT_FOUND")return ctx.set.status=404,{error:msg};throw err}}),{body:saleInsertDTO,detail:{summary:"Insert a new sale (scoped by tenant)",tags:["sales"]}}).put("/:id",protectedController(async(ctx)=>{let tenantId=ctx.tenantId,saleId=Number(ctx.params.id),body=ctx.body,updSale={datetime:body.datetime?new Date(body.datetime):void 0,total_amount:body.total_amount,currency:body.currency,payment_method:body.payment_method,debt:body.debt,...body.debt_amount&&{debt_amount:body.debt_amount},client_id:body.client_id,seller_id:body.seller_id,device_id:body.device_id,...body.trade_in_device&&{trade_in_device:body.trade_in_device}};try{let result2=await updateSale(tenantId,saleId,updSale);return ctx.set.status=200,result2}catch(err){let msg=err?.message;if(msg==="INVALID_CLIENT"||msg==="INVALID_SELLER"||msg==="INVALID_DEVICE"||msg==="INVALID_TRADE_IN")return ctx.set.status=400,{error:msg};if(msg==="SALE_NOT_FOUND")return ctx.set.status=404,{error:msg};throw err}}),{body:saleUpdateDTO,detail:{summary:"Update a sale (scoped by tenant)",tags:["sales"]}}).delete("/:id",protectedController(async(ctx)=>{let tenantId=ctx.tenantId,saleId=Number(ctx.params.id),ok=await softDeleteSale(tenantId,saleId);return ctx.set.status=ok?200:404,ok})).get("/net-income",protectedController(async(ctx)=>{let display=ctx.tenantSettings.display_currency??"ARS",fx=await getFxSnapshotVenta();return await getNetIncome(ctx.tenantId,display,fx)}),{detail:{summary:"Get net income (scoped by tenant)",tags:["sales"]}}).get("/sales-by-month",protectedController(async(ctx)=>{let tenantId=ctx.tenantId,year=Number(ctx.query.year);if(!year||Number.isNaN(year))return ctx.set.status=400,{ok:!1,message:"Invalid year"};return await getSalesByMonth(tenantId,year)}),{query:t.Object({year:t.String()}),detail:{summary:"Get sales grouped by month for a given year (scoped by tenant)",tags:["sales"]}}).get("/products-sold-count",protectedController(async(ctx)=>{return await getProductSoldCount(ctx.tenantId)}),{detail:{summary:"Get products sold count (scoped by tenant)",tags:["sales"]}}).get("/debts",protectedController(async(ctx)=>{return await getDebts2(ctx.tenantId)}),{detail:{summary:"Get all debts (scoped by tenant)",tags:["sales"]}}).get("/total-debt",protectedController(async(ctx)=>{return await getTotalDebt2(ctx.tenantId)}),{detail:{summary:"Get total debt amount (scoped by tenant)",tags:["sales"]}}).get("/net-income-breakdown",protectedController(async(ctx)=>{let display=ctx.tenantSettings.display_currency??"ARS",fx=await getFxSnapshotVenta();return await getNetIncomeBreakdown(ctx.tenantId,display,fx)}),{detail:{summary:"Net income breakdown by sale",tags:["sales"]}}).get("/metrics/overview",protectedController(async(ctx)=>{let display=ctx.tenantSettings.display_currency??"ARS",fx=await getFxSnapshotVenta();return await getSalesPublicOverviewWithMonthSeries(ctx.tenantId,display,fx)}),{detail:{summary:"Public sales metrics overview (staff + owner)",tags:["sales","metrics"]}});var getSellersByFilter=async(tenantId,filters)=>{return await db.select().from(sellerTable).where(and(eq(sellerTable.tenant_id,tenantId),filters.name?ilike(sellerTable.name,`%${filters.name}%`):void 0,filters.hire_date?eq(sql`date(${sellerTable.hire_date})`,filters.hire_date):void 0,filters.pay_date?eq(sql`date(${sellerTable.pay_date})`,filters.pay_date):void 0,filters.age_min?gte(sellerTable.age,Number(filters.age_min)):void 0,filters.age_max?lte(sellerTable.age,Number(filters.age_max)):void 0,filters.commission_min?gte(sellerTable.commission,filters.commission_min):void 0,filters.commission_max?lte(sellerTable.commission,filters.commission_max):void 0,filters.is_deleted!==void 0?eq(sellerTable.is_deleted,filters.is_deleted):void 0)).orderBy(sellerTable.seller_id)},getAllSellers=async(tenantId)=>{return await db.select().from(sellerTable).where(eq(sellerTable.tenant_id,tenantId)).orderBy(sellerTable.seller_id)},getSellerById=async(tenantId,id)=>{return await db.query.sellerTable.findFirst({where:and(eq(sellerTable.tenant_id,tenantId),eq(sellerTable.seller_id,id))})},addSeller=async(tenantId,newSeller)=>{let normalizedSeller={...newSeller,tenant_id:tenantId,name:normalizeShortString(newSeller.name),email:newSeller.email?newSeller.email.trim().toLowerCase():void 0,phone_number:newSeller.phone_number?newSeller.phone_number.trim():void 0};return await db.insert(sellerTable).values(normalizedSeller).returning()},updateSeller=async(tenantId,seller_id,seller_upd)=>{let normalizedUpd={...seller_upd,name:seller_upd.name?normalizeShortString(seller_upd.name):void 0,email:seller_upd.email?seller_upd.email.trim().toLowerCase():void 0,phone_number:seller_upd.phone_number?seller_upd.phone_number.trim():void 0};return await db.update(sellerTable).set(normalizedUpd).where(and(eq(sellerTable.tenant_id,tenantId),eq(sellerTable.seller_id,seller_id))).returning()};async function softDeleteSeller(tenantId,id){return(await db.update(sellerTable).set({is_deleted:!0}).where(and(eq(sellerTable.tenant_id,tenantId),eq(sellerTable.seller_id,id))).returning()).length>0}var sellerController=new Elysia({prefix:"/seller"}).get("/",()=>({message:"Seller endpoint"})).get("/all",protectedController(async(ctx)=>{let{tenantId,query}=ctx;if(query.name||query.hire_date||query.pay_date||query.age_min||query.age_max||query.commission_min||query.commission_max||query.is_deleted)return await getSellersByFilter(tenantId,{name:query.name,hire_date:query.hire_date,pay_date:query.pay_date,age_min:query.age_min,age_max:query.age_max,commission_min:query.commission_min,commission_max:query.commission_max,is_deleted:query.is_deleted===void 0?void 0:query.is_deleted==="true"});return await getAllSellers(tenantId)}),{detail:{summary:"Get all sellers in DB (scoped by tenant)",tags:["sellers"]}}).post("/",protectedController(async(ctx)=>{let{tenantId,body}=ctx,newSeller={tenant_id:tenantId,name:body.name,age:body.age,...body.email!==void 0&&{email:body.email},...body.phone_number!==void 0&&{phone_number:body.phone_number},...body.hire_date!==void 0&&{hire_date:body.hire_date},...body.pay_date!==void 0&&{pay_date:body.pay_date},...body.commission!==void 0&&{commission:body.commission}},result2=await addSeller(tenantId,newSeller);return ctx.set.status=201,result2}),{body:t.Object({...sellerInsertDTO.properties}),detail:{summary:"Insert a new seller (scoped by tenant)",tags:["sellers"]}}).get("/:id",protectedController(async(ctx)=>{let tenantId=ctx.tenantId,sellerId=Number(ctx.params.id);return await getSellerById(tenantId,sellerId)}),{detail:{summary:"Get seller details by ID (scoped by tenant)",tags:["sellers"]}}).put("/:id",protectedController(async(ctx)=>{let tenantId=ctx.tenantId,sellerId=Number(ctx.params.id),body=ctx.body,updSeller={name:body.name,age:body.age,...body.email!==void 0&&{email:body.email},...body.phone_number!==void 0&&{phone_number:body.phone_number},...body.pay_date!==void 0&&{pay_date:body.pay_date},...body.hire_date!==void 0&&{hire_date:body.hire_date},...body.commission!==void 0&&{commission:body.commission}},result2=await updateSeller(tenantId,sellerId,updSeller);return ctx.set.status=200,result2}),{body:t.Object({...sellerUpdateDTO.properties}),detail:{summary:"Update a seller (scoped by tenant)",tags:["sellers"]}}).delete("/:id",protectedController(async(ctx)=>{let tenantId=ctx.tenantId,sellerId=Number(ctx.params.id),ok=await softDeleteSeller(tenantId,sellerId);return ctx.set.status=ok?200:404,ok})).get("/metrics/sales-count",protectedController(async(ctx)=>{let tenantId=ctx.tenantId,{from,to}=ctx.query;return await getSalesCountBySeller(tenantId,{from,to})}),{detail:{summary:"Get sales count per seller",tags:["sellers","metrics"]}}).get("/metrics/overview",protectedController(async(ctx)=>{let display=ctx.tenantSettings.display_currency??"ARS",fx=await getFxSnapshotVenta(),tenantId=ctx.tenantId;return await getSellersOverviewMetrics(tenantId,display,fx)}),{detail:{summary:"Global sellers overview metrics (count, total sold, commission, avg ticket)",tags:["sellers","metrics"]}}).get("/metrics/leaderboard",protectedController(async(ctx)=>{if(ctx.roleInTenant!=="owner")return ctx.set.status=403,{error:"FORBIDDEN"};let display=ctx.tenantSettings.display_currency??"ARS",fx=await getFxSnapshotVenta(),tenantId=ctx.tenantId,{limit}=ctx.query;return await getSellerLeaderboard(tenantId,display,fx,{limit:limit?Number(limit):5})}),{detail:{summary:"Top sellers leaderboard (owner only)",tags:["sellers","metrics"]}});async function getAllAccessories(tenantId){return await db.select().from(accessoryTable).where(and(eq(accessoryTable.tenant_id,tenantId),eq(accessoryTable.is_deleted,!1))).orderBy(desc(accessoryTable.datetime))}async function getAccessoriesByFilter(tenantId,filters){let conditions=[eq(accessoryTable.tenant_id,tenantId),filters.is_deleted===void 0?eq(accessoryTable.is_deleted,!1):eq(accessoryTable.is_deleted,filters.is_deleted)];if(filters.name?.trim())conditions.push(ilike(accessoryTable.name,`%${filters.name.trim()}%`));if(filters.brand?.trim())conditions.push(ilike(accessoryTable.brand,`%${filters.brand.trim()}%`));if(filters.category?.trim())conditions.push(ilike(accessoryTable.category,`%${filters.category.trim()}%`));if(filters.color?.trim())conditions.push(ilike(accessoryTable.color,`%${filters.color.trim()}%`));if(filters.deposit?.trim())conditions.push(ilike(accessoryTable.deposit,`%${filters.deposit.trim()}%`));if(filters.gift!==void 0)conditions.push(eq(accessoryTable.gift,filters.gift));return await db.select().from(accessoryTable).where(and(...conditions)).orderBy(desc(accessoryTable.datetime))}async function getAccessoryById(tenantId,accessoryId){return(await db.select().from(accessoryTable).where(and(eq(accessoryTable.tenant_id,tenantId),eq(accessoryTable.accessory_id,accessoryId),eq(accessoryTable.is_deleted,!1))).limit(1))[0]??null}async function addAccessory(data){return(await db.insert(accessoryTable).values({tenant_id:data.tenant_id,datetime:data.datetime,name:normalizeShortString(data.name),brand:normalizeShortString(data.brand),stock:data.stock??0,color:data.color?normalizeShortString(data.color):null,category:data.category,price:data.price,currency_sale:data.currency_sale,buy_cost:data.buy_cost,currency_buy:data.currency_buy,deposit:data.deposit,gift:data.gift??!1}).returning())[0]}async function updateAccessory(tenantId,accessoryId,data){return(await db.update(accessoryTable).set({datetime:data.datetime,name:normalizeShortString(data.name),brand:normalizeShortString(data.brand),stock:data.stock,color:data.color?normalizeShortString(data.color):null,category:data.category,price:data.price,currency_sale:data.currency_sale,buy_cost:data.buy_cost,currency_buy:data.currency_buy,deposit:data.deposit,gift:data.gift}).where(and(eq(accessoryTable.tenant_id,tenantId),eq(accessoryTable.accessory_id,accessoryId),eq(accessoryTable.is_deleted,!1))).returning())[0]??null}async function softDeleteAccessory(tenantId,accessoryId){return(await db.update(accessoryTable).set({is_deleted:!0}).where(and(eq(accessoryTable.tenant_id,tenantId),eq(accessoryTable.accessory_id,accessoryId),eq(accessoryTable.is_deleted,!1))).returning({id:accessoryTable.accessory_id})).length>0}async function getAccessoryStockInvestment(tenantId){return(await db.select({total:sql`COALESCE(SUM(${accessoryTable.buy_cost} * ${accessoryTable.stock}), 0)::numeric`}).from(accessoryTable).where(and(eq(accessoryTable.tenant_id,tenantId),eq(accessoryTable.is_deleted,!1))))[0]?.total??"0"}async function getAccessoryStockInvestmentBreakdown(tenantId){return await db.select({category:accessoryTable.category,total:sql`COALESCE(SUM(${accessoryTable.buy_cost} * ${accessoryTable.stock}), 0)::numeric`,units:sql`COALESCE(SUM(${accessoryTable.stock}), 0)::int`}).from(accessoryTable).where(and(eq(accessoryTable.tenant_id,tenantId),eq(accessoryTable.is_deleted,!1))).groupBy(accessoryTable.category).orderBy(desc(sql`SUM(${accessoryTable.buy_cost} * ${accessoryTable.stock})`))}async function adjustAccessoryStock(tenantId,accessoryId,delta2){if(!Number.isInteger(delta2))throw Error("delta must be an integer");let whereClause=delta2>=0?and(eq(accessoryTable.tenant_id,tenantId),eq(accessoryTable.accessory_id,accessoryId),eq(accessoryTable.is_deleted,!1)):and(eq(accessoryTable.tenant_id,tenantId),eq(accessoryTable.accessory_id,accessoryId),eq(accessoryTable.is_deleted,!1),gte(accessoryTable.stock,-delta2));return(await db.update(accessoryTable).set({stock:sql`${accessoryTable.stock} + ${delta2}`}).where(whereClause).returning({accessory_id:accessoryTable.accessory_id,stock:accessoryTable.stock}))[0]??null}var accessoryController=new Elysia({prefix:"/accessory"}).get("/",()=>({message:"Accessory endpoint"})).get("/all",protectedController(async(ctx)=>{let{tenantId,query}=ctx;if(query.name||query.brand||query.category||query.color||query.deposit||query.gift||query.is_deleted)return await getAccessoriesByFilter(tenantId,{name:query.name,brand:query.brand,category:query.category,color:query.color,deposit:query.deposit,gift:query.gift===void 0?void 0:query.gift==="true",is_deleted:query.is_deleted===void 0?void 0:query.is_deleted==="true"});return await getAllAccessories(tenantId)}),{detail:{summary:"Get all accessories in DB (scoped by tenant)",tags:["accessories"]}}).get("/:id",protectedController(async(ctx)=>{let accessoryId=Number(ctx.params.id);return await getAccessoryById(ctx.tenantId,accessoryId)}),{detail:{summary:"Get accessory details by ID (scoped by tenant)",tags:["accessories"]}}).post("/",protectedController(async(ctx)=>{let{tenantId,body}=ctx,newAccessory={tenant_id:tenantId,datetime:new Date(body.datetime),name:body.name,brand:body.brand,stock:body.stock??0,...body.color&&{color:body.color},category:body.category,price:body.price,currency_sale:body.currency_sale,buy_cost:body.buy_cost,currency_buy:body.currency_buy,deposit:body.deposit,gift:body.gift??!1},result2=await addAccessory(newAccessory);return ctx.set.status=201,result2}),{body:t.Object({...accessoryInsertDTO.properties,datetime:t.String({format:"date-time"})}),detail:{summary:"Insert a new accessory (scoped by tenant)",tags:["accessories"]}}).put("/:id",protectedController(async(ctx)=>{let tenantId=ctx.tenantId,accessoryId=Number(ctx.params.id),body=ctx.body,updAccessory={datetime:new Date(body.datetime),name:body.name,brand:body.brand,stock:body.stock,...body.color!==void 0&&{color:body.color},category:body.category,price:body.price,currency_sale:body.currency_sale,buy_cost:body.buy_cost,currency_buy:body.currency_buy,deposit:body.deposit,gift:body.gift},result2=await updateAccessory(tenantId,accessoryId,updAccessory);return ctx.set.status=200,result2}),{body:t.Object({...accessoryUpdateDTO.properties,datetime:t.String({format:"date-time"})}),detail:{summary:"Update an accessory (scoped by tenant)",tags:["accessories"]}}).patch("/:id/stock",protectedController(async(ctx)=>{let tenantId=ctx.tenantId,accessoryId=Number(ctx.params.id),{delta:delta2}=ctx.body,result2=await adjustAccessoryStock(tenantId,accessoryId,delta2);if(!result2)return ctx.set.status=delta2<0?409:404,{ok:!1,message:delta2<0?"Stock insuficiente o accesorio inexistente":"Accesorio inexistente"};return ctx.set.status=200,{ok:!0,...result2}}),{body:t.Object({delta:t.Integer()}),detail:{summary:"Adjust accessory stock by delta (scoped by tenant)",tags:["accessories"]}}).delete("/:id",protectedController(async(ctx)=>{let accessoryId=Number(ctx.params.id),ok=await softDeleteAccessory(ctx.tenantId,accessoryId);return ctx.set.status=ok?200:404,ok})).get("/stock-investment",protectedController(async(ctx)=>{return await getAccessoryStockInvestment(ctx.tenantId)}),{detail:{summary:"Get accessories stock investment (sum buy_cost * stock) scoped by tenant",tags:["accessories"]}}).get("/stock-investment-breakdown",protectedController(async(ctx)=>{return await getAccessoryStockInvestmentBreakdown(ctx.tenantId)}),{detail:{summary:"Get accessories stock investment breakdown (grouped) scoped by tenant",tags:["accessories"]}});async function assertActiveMembership(tenantId,userId){let[m3]=await db.select({is_active:tenantMembershipTable.is_active,role:tenantMembershipTable.role}).from(tenantMembershipTable).where(and(eq(tenantMembershipTable.tenant_id,tenantId),eq(tenantMembershipTable.user_id,userId)));if(!m3||!m3.is_active)throw Error("Membership inv\xE1lida o inactiva.");return m3}function pickDefined(obj){let out={};for(let[k3,v]of Object.entries(obj))if(v!==void 0)out[k3]=v;return out}async function getMyUser(tenantId,userId){let membership=await assertActiveMembership(tenantId,userId),[user]=await db.select({user_id:userTable.user_id,email:userTable.email,role:userTable.role,is_active:userTable.is_active,created_at:userTable.created_at,last_login:userTable.last_login}).from(userTable).where(eq(userTable.user_id,userId));if(!user)return null;let[settings]=await db.select().from(userSettingsTable).where(eq(userSettingsTable.user_id,userId));return{user,userSettings:settings??null,roleInTenant:membership.role,tenant_id:tenantId}}async function patchMyUserSettings(tenantId,userId,patch){await assertActiveMembership(tenantId,userId);let now=new Date,defined=pickDefined(patch);if(Object.keys(defined).length===0){let[existing]=await db.select().from(userSettingsTable).where(eq(userSettingsTable.user_id,userId));return existing??null}let[row]=await db.insert(userSettingsTable).values({user_id:userId,...defined,updated_at:now}).onConflictDoUpdate({target:userSettingsTable.user_id,set:{...defined,updated_at:now}}).returning();return row}async function replaceMyUserSettings(tenantId,userId,input){await assertActiveMembership(tenantId,userId);let now=new Date,[row]=await db.insert(userSettingsTable).values({user_id:userId,...input,updated_at:now}).onConflictDoUpdate({target:userSettingsTable.user_id,set:{...input,updated_at:now}}).returning();return row}async function resetMyUserSettings(tenantId,userId){await assertActiveMembership(tenantId,userId);let[row]=await db.delete(userSettingsTable).where(eq(userSettingsTable.user_id,userId)).returning();return row??null}async function deactivateMyUser(tenantId,userId){await assertActiveMembership(tenantId,userId);let[u]=await db.update(userTable).set({is_active:!1}).where(eq(userTable.user_id,userId)).returning({user_id:userTable.user_id});return await db.update(sessionTable).set({revoked_at:new Date}).where(and(eq(sessionTable.user_id,userId),eq(sessionTable.tenant_id,tenantId))),Boolean(u)}var userController=new Elysia({prefix:"/user"}).get("/me",protectedController(async(ctx)=>{return await getMyUser(ctx.tenantId,ctx.user.id)}),{detail:{summary:"Get my user info + settings",tags:["users"]}}).patch("/me/settings",protectedController(async(ctx)=>{let row=await patchMyUserSettings(ctx.tenantId,ctx.user.id,ctx.body);return ctx.set.status=200,row}),{body:t.Object({display_name:t.Optional(t.Union([t.String({maxLength:120}),t.Null()])),phone:t.Optional(t.Union([t.String({maxLength:32}),t.Null()])),email_notifications:t.Optional(t.Boolean())}),detail:{summary:"Patch my user settings",tags:["users"]}}).put("/me/settings",protectedController(async(ctx)=>{let row=await replaceMyUserSettings(ctx.tenantId,ctx.user.id,ctx.body);return ctx.set.status=200,row}),{body:t.Object({display_name:t.Union([t.String({maxLength:120}),t.Null()]),phone:t.Union([t.String({maxLength:32}),t.Null()]),email_notifications:t.Boolean()}),detail:{summary:"Replace my user settings",tags:["users"]}}).delete("/me/settings",protectedController(async(ctx)=>{let deleted=await resetMyUserSettings(ctx.tenantId,ctx.user.id);return ctx.set.status=deleted?200:404,deleted}),{detail:{summary:"Delete/reset my user settings",tags:["users"]}}).delete("/me",protectedController(async(ctx)=>{let ok=await deactivateMyUser(ctx.tenantId,ctx.user.id);return ctx.set.status=ok?200:404,ok}),{detail:{summary:"Deactivate my user and revoke sessions for this tenant",tags:["users"]}});function assertOwnerOrAdmin(role){if(role!=="owner"&&role!=="admin")throw Error("FORBIDDEN")}function assertOwner(role){if(role!=="owner")throw Error("FORBIDDEN")}async function getCurrentTenant(tenantId){let[tenant]=await db.select({tenant_id:tenantTable.tenant_id,name:tenantTable.name,is_active:tenantTable.is_active,created_at:tenantTable.created_at,updated_at:tenantTable.updated_at}).from(tenantTable).where(eq(tenantTable.tenant_id,tenantId));if(!tenant)return null;let[settings]=await db.select().from(tenantSettingsTable).where(eq(tenantSettingsTable.tenant_id,tenantId));return{tenant,tenantSettings:settings??null}}async function upsertTenantSettings(tenantId,roleInTenant,patch){assertOwnerOrAdmin(roleInTenant);let now=new Date,[row]=await db.insert(tenantSettingsTable).values({tenant_id:tenantId,...patch,updated_at:now}).onConflictDoUpdate({target:tenantSettingsTable.tenant_id,set:{...patch,updated_at:now}}).returning();return row}async function updateTenantName(tenantId,roleInTenant,name){assertOwnerOrAdmin(roleInTenant);let[row]=await db.update(tenantTable).set({name,updated_at:new Date}).where(eq(tenantTable.tenant_id,tenantId)).returning({tenant_id:tenantTable.tenant_id,name:tenantTable.name});return row??null}async function deactivateTenant(tenantId,roleInTenant){assertOwner(roleInTenant);let[row]=await db.update(tenantTable).set({is_active:!1,updated_at:new Date}).where(eq(tenantTable.tenant_id,tenantId)).returning({tenant_id:tenantTable.tenant_id});return await db.update(sessionTable).set({revoked_at:new Date}).where(eq(sessionTable.tenant_id,tenantId)),Boolean(row)}function pickDefined2(obj){let out={};for(let[k3,v]of Object.entries(obj))if(v!==void 0)out[k3]=v;return out}async function assertCanEditTenant(tenantId,userId){let[m3]=await db.select({is_active:tenantMembershipTable.is_active,role:tenantMembershipTable.role}).from(tenantMembershipTable).where(and(eq(tenantMembershipTable.tenant_id,tenantId),eq(tenantMembershipTable.user_id,userId)));if(!m3||!m3.is_active)throw Error("Membership inv\xE1lida o inactiva.");if(m3.role!=="owner"&&m3.role!=="admin")throw Error("No autorizado.");return m3}async function patchMyTenant(tenantId,userId,patch){await assertCanEditTenant(tenantId,userId);let defined=pickDefined2(patch);if(!Object.keys(defined).length){let[t9]=await db.select().from(tenantTable).where(eq(tenantTable.tenant_id,tenantId));return t9??null}let[row]=await db.update(tenantTable).set({...defined,updated_at:new Date}).where(eq(tenantTable.tenant_id,tenantId)).returning();return row}async function patchMyTenantSettings(tenantId,userId,patch){await assertCanEditTenant(tenantId,userId);let now=new Date,defined=pickDefined2(patch);if(!Object.keys(defined).length){let[s2]=await db.select().from(tenantSettingsTable).where(eq(tenantSettingsTable.tenant_id,tenantId));return s2??null}let[row]=await db.insert(tenantSettingsTable).values({tenant_id:tenantId,...defined,updated_at:now}).onConflictDoUpdate({target:tenantSettingsTable.tenant_id,set:{...defined,updated_at:now}}).returning();return row}var LOGO_ALLOWED_TYPES=["image/png","image/jpeg","image/webp"],LOGO_MAX_SIZE=5242880;function isAllowedLogoType(v){return LOGO_ALLOWED_TYPES.includes(v)}function makeLogoKey(tenantId,filename){let ext=(filename.split(".").pop()||"bin").toLowerCase().replace(/[^a-z0-9]/g,""),ts=Date.now(),rand=crypto.randomUUID();return`tenants/${tenantId}/logo/${ts}-${rand}.${ext}`}async function presignTenantLogoUpload(tenantId,roleInTenant,input){if(assertOwnerOrAdmin(roleInTenant),!isAllowedLogoType(input.contentType))return{ok:!1,status:400,message:"INVALID_LOGO_TYPE"};if(input.size>LOGO_MAX_SIZE)return{ok:!1,status:400,message:"LOGO_TOO_LARGE"};let key=makeLogoKey(tenantId,input.filename),putUrl=await presignPut({key,contentType:input.contentType,expiresInSec:300});return{ok:!0,key,putUrl}}async function linkTenantLogo(tenantId,roleInTenant,input){if(assertOwnerOrAdmin(roleInTenant),!isAllowedLogoType(input.contentType))return{ok:!1,status:400,message:"INVALID_LOGO_TYPE"};let now=new Date;return await db.insert(tenantSettingsTable).values({tenant_id:tenantId,logo_key:input.key,logo_mime:input.contentType,logo_updated_at:now,updated_at:now}).onConflictDoUpdate({target:tenantSettingsTable.tenant_id,set:{logo_key:input.key,logo_mime:input.contentType,logo_updated_at:now,updated_at:now}}),{ok:!0}}async function getTenantLogoSignedUrl(tenantId){let[s2]=await db.select({logo_key:tenantSettingsTable.logo_key,logo_mime:tenantSettingsTable.logo_mime}).from(tenantSettingsTable).where(eq(tenantSettingsTable.tenant_id,tenantId)).limit(1);if(!s2?.logo_key)return null;let disposition='inline; filename="logo"';return presignGet({key:s2.logo_key,expiresInSec:600,responseContentDisposition:disposition})}var tenantController=new Elysia({prefix:"/tenant"}).get("/",()=>({message:"Tenant endpoint"})).get("/current",protectedController(async(ctx)=>{return await getCurrentTenant(ctx.tenantId)}),{detail:{summary:"Get current tenant + settings (scoped by session/tenant)",tags:["tenants"]}}).put("/current",protectedController(async(ctx)=>{let result2=await upsertTenantSettings(ctx.tenantId,ctx.roleInTenant,ctx.body);return ctx.set.status=200,result2}),{body:t.Object({business_name:t.Optional(t.Union([t.String({maxLength:255}),t.Null()])),cuit:t.Optional(t.Union([t.String({maxLength:32}),t.Null()])),address:t.Optional(t.Union([t.String({maxLength:255}),t.Null()])),display_currency:t.Optional(t.String({maxLength:8})),timezone:t.Optional(t.String({maxLength:64})),low_stock_threshold_default:t.Optional(t.Number({minimum:0,maximum:1e5}))}),detail:{summary:"Upsert tenant settings (owner/admin only)",tags:["tenants"]}}).put("/name",protectedController(async(ctx)=>{let result2=await updateTenantName(ctx.tenantId,ctx.roleInTenant,ctx.body.name);return ctx.set.status=200,result2}),{body:t.Object({name:t.String({minLength:1,maxLength:255})}),detail:{summary:"Update tenant name (owner/admin only)",tags:["tenants"]}}).delete("/current",protectedController(async(ctx)=>{let ok=await deactivateTenant(ctx.tenantId,ctx.roleInTenant);return ctx.set.status=ok?200:404,ok}),{detail:{summary:"Deactivate tenant (soft) + revoke all tenant sessions (owner only)",tags:["tenants"]}}).get("/logo",protectedController(async(ctx)=>{let url=await getTenantLogoSignedUrl(ctx.tenantId);if(!url){ctx.set.status=404;return}ctx.set.status=302,ctx.set.headers.Location=url;return})).post("/logo/presign",protectedController(async(ctx)=>{let{contentType,filename,size}=ctx.body,result2=await presignTenantLogoUpload(ctx.tenantId,ctx.roleInTenant,{contentType,filename,size});if(!result2.ok)return ctx.set.status=result2.status,{ok:!1,message:result2.message};return{ok:!0,key:result2.key,putUrl:result2.putUrl}}),{body:t.Object({contentType:t.String({minLength:1,maxLength:100}),filename:t.String({minLength:1,maxLength:255}),size:t.Integer({minimum:1})})}).post("/logo/link",protectedController(async(ctx)=>{let{key,contentType}=ctx.body,result2=await linkTenantLogo(ctx.tenantId,ctx.roleInTenant,{key,contentType});if(!result2.ok)return ctx.set.status=result2.status,{ok:!1,message:result2.message};return{ok:!0}}),{body:t.Object({key:t.String({minLength:1,maxLength:1024}),contentType:t.String({minLength:1,maxLength:100})})}).patch("/me",protectedController(async(ctx)=>{let row=await patchMyTenant(ctx.tenantId,ctx.user.id,ctx.body);return ctx.set.status=200,row}),{body:t.Object({name:t.Optional(t.String({maxLength:255}))}),detail:{summary:"Patch my tenant (name)",tags:["tenants"]}}).patch("/me/settings",protectedController(async(ctx)=>{let row=await patchMyTenantSettings(ctx.tenantId,ctx.user.id,ctx.body);return ctx.set.status=200,row}),{body:t.Object({business_name:t.Optional(t.Union([t.String({maxLength:255}),t.Null()])),cuit:t.Optional(t.Union([t.String({maxLength:32}),t.Null()])),address:t.Optional(t.Union([t.String({maxLength:255}),t.Null()])),display_currency:t.Optional(t.String({maxLength:8})),timezone:t.Optional(t.String({maxLength:64})),low_stock_threshold_default:t.Optional(t.Number())}),detail:{summary:"Patch my tenant settings",tags:["tenants"]}});import path from"path";var UPLOADS_DIR=path.join(import.meta.dir,"../../uploads"),uploadsController=new Elysia({prefix:"/uploads"}).get("/logos/tenants/:tenantId/:filename",async(ctx)=>{let{tenantId,filename}=ctx.params;if(String(filename).includes("..")||String(tenantId).includes(".."))return ctx.set.status=400,"Bad request";let absPath=path.join(UPLOADS_DIR,"logos","tenants",String(tenantId),String(filename)),file=Bun.file(absPath);if(!await file.exists())return ctx.set.status=404,"Not found";return new Response(file)});var currencyController=new Elysia({prefix:"/currency"}).get("/fx/latest",protectedController(async()=>{return await getFxSnapshotVenta()})).get("/metrics/overview",protectedController(async(ctx)=>{let display=ctx.tenantSettings.display_currency??"ARS";console.log("Display currency in currencyController:",display);let fx=await getFxSnapshotVenta();console.log("FX in currencyController:",fx);let gross=await getGrossIncome(ctx.tenantId,display,fx),net2=await getNetIncome(ctx.tenantId,display,fx),investment=await getStockInvestment(ctx.tenantId,display,fx),debtors=await getDebts(ctx.tenantId,display,fx),total_debt=await getTotalDebt(ctx.tenantId,display,fx),expenses=await getTopExpensesByCategory(ctx.tenantId,display,fx);return{displayCurrency:display,fx:{updatedAt:fx.updatedAt,isStale:fx.isStale??!1},grossIncome:gross,netIncome:net2,stockInvestment:investment,debtors,total_debt,top_expenses:expenses}}));import crypto3 from"crypto";function safeStr(x){return typeof x==="string"&&x.length?x:void 0}function parseMpWebhook(ctx){let body=ctx.body??{},q2=ctx.query??{},topic=safeStr(body?.topic)??safeStr(body?.type)??safeStr(q2?.topic)??safeStr(q2?.type)??"unknown",resourceId=safeStr(body?.data?.id)??safeStr(body?.id)??safeStr(q2?.["data.id"])??safeStr(q2?.id)??(safeStr(body?.resource)?.split("/").pop()||void 0)??"unknown",xRequestId=ctx.request?.headers?.get?.("x-request-id")??null,xSignature=ctx.request?.headers?.get?.("x-signature")??null,rawEventId=safeStr(body?.id)??(xRequestId?`${xRequestId}:${topic}:${resourceId}`:`${topic}:${resourceId}`);return{topic,resourceId,rawEventId,xRequestId,xSignature}}function verifyMpSignatureOrThrow(parsed,secret){if(!secret)return;let{xSignature:sig,xRequestId:reqId}=parsed;if(!sig||!reqId)throw Error("Missing x-signature or x-request-id");let parts=sig.split(",").map((p2)=>p2.trim()),ts=parts.find((p2)=>p2.startsWith("ts="))?.slice(3),v1=parts.find((p2)=>p2.startsWith("v1="))?.slice(3);if(!ts||!v1)throw Error("Invalid x-signature format");let manifest=`id:${parsed.resourceId};request-id:${reqId};ts:${ts};`,computed=crypto3.createHmac("sha256",secret).update(manifest).digest("hex"),a12=Buffer.from(computed,"hex"),b2=Buffer.from(v1,"hex");if(a12.length!==b2.length||!crypto3.timingSafeEqual(a12,b2))throw Error("Invalid signature")}function mpHeaders(){let token=process.env.MP_ACCESS_TOKEN;if(!token)throw Error("MP_ACCESS_TOKEN missing");return{Authorization:`Bearer ${token}`,"Content-Type":"application/json"}}async function mpGet(path2){let res=await fetch(`https://api.mercadopago.com${path2}`,{headers:mpHeaders()}),text2=await res.text();if(!res.ok)throw Error(`MP GET ${path2} failed: ${res.status} ${text2}`);return JSON.parse(text2)}function mapMpStatusToLocal(mpStatus){let s2=(mpStatus??"").toLowerCase();if(s2==="authorized"||s2==="active")return"active";if(s2==="pending")return"pending";if(s2==="paused")return"past_due";if(s2==="cancelled"||s2==="canceled")return"canceled";return"pending"}function parseExternalRef(ext){if(!ext)return null;if(ext.startsWith("tenant:")){let parts=ext.split(":"),tenantId=Number(parts[1]),planKey=parts[3]||null;if(Number.isFinite(tenantId))return{kind:"tenant",tenantId,planKey}}if(ext.startsWith("signup:")){let intentId=ext.slice(7);if(intentId)return{kind:"signup",intentId}}return{kind:"unknown",raw:ext}}async function processMpWebhookEvent(parsed,rawPayload,eventId){let now=new Date;if(!(await db.insert(mpEventTable).values({mp_event_id:eventId,topic:parsed.topic,resource_id:parsed.resourceId,payload:rawPayload,received_at:now}).onConflictDoNothing().returning({mp_event_id:mpEventTable.mp_event_id})).length)return{ok:!0,dedup:!0};let topicLower=(parsed.topic??"").toLowerCase();if(!(topicLower.includes("preapproval")||topicLower==="subscription_preapproval"||topicLower==="preapproval")||parsed.resourceId==="unknown")return await db.update(mpEventTable).set({processed_at:now}).where(eq(mpEventTable.mp_event_id,eventId)),{ok:!0,ignored:!0};let pre=await mpGet(`/preapproval/${parsed.resourceId}`),localStatus=mapMpStatusToLocal(pre.status),ext=parseExternalRef(pre.external_reference);if(ext?.kind==="tenant"){let planId=null;if(ext.planKey){let[plan]=await db.select({plan_id:subscriptionPlanTable.plan_id}).from(subscriptionPlanTable).where(eq(subscriptionPlanTable.key,ext.planKey)).limit(1);planId=plan?.plan_id??null}let nextPayment=pre.next_payment_date?new Date(pre.next_payment_date):null,startAt=pre.auto_recurring?.start_date?new Date(pre.auto_recurring.start_date):null;return await db.update(tenantSettingsTable).set({subscription_status:localStatus,subscription_plan_id:planId??void 0,mp_preapproval_id:pre.id,subscription_started_at:localStatus==="active"?now:void 0,current_period_end:nextPayment??void 0,last_mp_event_at:now}).where(eq(tenantSettingsTable.tenant_id,ext.tenantId)),await db.update(mpEventTable).set({tenant_id:ext.tenantId,processed_at:now}).where(eq(mpEventTable.mp_event_id,eventId)),{ok:!0,applied:!0,tenantId:ext.tenantId,status:localStatus}}if(ext?.kind==="signup"){if(localStatus==="active")await db.update(signupIntentTable).set({status:"approved",approved_at:now,mp_preapproval_id:pre.id}).where(eq(signupIntentTable.intent_id,ext.intentId)),await db.update(mpEventTable).set({intent_id:ext.intentId,processed_at:now}).where(eq(mpEventTable.mp_event_id,eventId));else await db.update(mpEventTable).set({intent_id:ext.intentId,processed_at:now}).where(eq(mpEventTable.mp_event_id,eventId));return{ok:!0,applied:!0,intentId:ext.intentId,status:localStatus}}return await db.update(mpEventTable).set({processed_at:now}).where(eq(mpEventTable.mp_event_id,eventId)),{ok:!0,applied:!1,status:localStatus}}import{createHash as createHash2}from"crypto";var mpWebhookController=new Elysia({prefix:"/webhooks"}).post("/mercadopago",async(ctx)=>{let parsed=parseMpWebhook(ctx);if(!parsed)return ctx.set.status=200,{ok:!0};try{verifyMpSignatureOrThrow(parsed,process.env.MP_WEBHOOK_SECRET)}catch(e){if(process.env.MP_WEBHOOK_SECRET)return ctx.set.status=401,{ok:!1,error:"INVALID_SIGNATURE"}}let reqId=parsed.xRequestId??"",eventId=createHash2("sha256").update(`${reqId}:${parsed.topic}:${parsed.resourceId}`).digest("hex"),rawPayload={body:ctx.body,query:ctx.query,headers:{"x-request-id":parsed.xRequestId,"x-signature":parsed.xSignature}};try{await processMpWebhookEvent(parsed,rawPayload,eventId)}catch(e){return ctx.set.status=500,{ok:!1,error:"WEBHOOK_PROCESSING_FAILED"}}return ctx.set.status=200,{ok:!0}},{body:t.Any(),detail:{summary:"Mercado Pago webhook (subscriptions)",tags:["mercadopago"]}});async function mpGetRaw(path2){let r3=await fetch(`https://api.mercadopago.com${path2}`,{headers:{Authorization:`Bearer ${MP_ACCESS_TOKEN}`}}),json2=await r3.json().catch(()=>({}));return{ok:r3.ok,status:r3.status,json:json2}}async function getBillingStatus(tenantId){let[ts]=await db.select({subscription_status:tenantSettingsTable.subscription_status,trial_ends_at:tenantSettingsTable.trial_ends_at,subscription_plan_id:tenantSettingsTable.subscription_plan_id,mp_preapproval_id:tenantSettingsTable.mp_preapproval_id,current_period_end:tenantSettingsTable.current_period_end}).from(tenantSettingsTable).where(eq(tenantSettingsTable.tenant_id,tenantId)).limit(1),plans=await db.select({plan_id:subscriptionPlanTable.plan_id,key:subscriptionPlanTable.key,name:subscriptionPlanTable.name,price_amount:subscriptionPlanTable.price_amount,currency:subscriptionPlanTable.currency,is_active:subscriptionPlanTable.is_active}).from(subscriptionPlanTable).where(eq(subscriptionPlanTable.is_active,!0));return{tenant:ts??null,plans,now:new Date().toISOString()}}var MP_ACCESS_TOKEN=process.env.MP_ACCESS_TOKEN;if(!MP_ACCESS_TOKEN)throw Error("Missing MP_ACCESS_TOKEN");async function mpPost(path2,body){let r3=await fetch(`https://api.mercadopago.com${path2}`,{method:"POST",headers:{Authorization:`Bearer ${MP_ACCESS_TOKEN}`,"Content-Type":"application/json"},body:JSON.stringify(body)}),json2=await r3.json().catch(()=>({}));if(!r3.ok)throw console.error("[MP] POST failed",{path:path2,status:r3.status,json:json2}),Error(`MP POST ${path2} failed (${r3.status}): ${JSON.stringify(json2)}`);return json2}async function createSubscriptionForTenant(tenantId,payerEmail,planKey,backUrl,cardTokenId){try{let u=new URL(backUrl);if(u.protocol!=="https:"&&u.protocol!=="http:")throw Error("bad protocol")}catch{return{ok:!1,status:400,message:`Invalid backUrl: "${backUrl}"`}}let[ts]=await db.select({subscription_status:tenantSettingsTable.subscription_status,mp_preapproval_id:tenantSettingsTable.mp_preapproval_id,trial_ends_at:tenantSettingsTable.trial_ends_at}).from(tenantSettingsTable).where(eq(tenantSettingsTable.tenant_id,tenantId)).limit(1),currentStatus=ts?.subscription_status??"inactive";if(currentStatus==="active")return{ok:!1,status:409,message:"Subscription already active"};if(currentStatus==="pending"&&ts?.mp_preapproval_id)return{ok:!1,status:409,message:"Subscription already pending confirmation"};let[plan]=await db.select({plan_id:subscriptionPlanTable.plan_id,key:subscriptionPlanTable.key,mp_preapproval_plan_id:subscriptionPlanTable.mp_preapproval_plan_id,is_active:subscriptionPlanTable.is_active}).from(subscriptionPlanTable).where(eq(subscriptionPlanTable.key,planKey)).limit(1);if(!plan||!plan.is_active)return{ok:!1,status:404,message:"Plan not found or inactive"};if(!cardTokenId)return{ok:!1,status:400,message:"cardTokenId is required"};let externalReference=`tenant:${tenantId}:plan:${plan.key}`,mpBody={preapproval_plan_id:plan.mp_preapproval_plan_id,payer_email:payerEmail,reason:"Zuma+ Pro",external_reference:externalReference,back_url:backUrl,card_token_id:cardTokenId,redirect_url:backUrl,return_url:backUrl},me2=await mpGetRaw("/users/me"),mp;try{mp=await mpPost("/preapproval",mpBody)}catch(e){return console.error("[MP] create preapproval failed",{message:e?.message,name:e?.name,cause:e?.cause,mpBody:{preapproval_plan_id:mpBody.preapproval_plan_id,payer_email:mpBody.payer_email,back_url:mpBody.back_url,external_reference:mpBody.external_reference,reason:mpBody.reason}}),{ok:!1,status:502,message:e?.message??"MP error"}}let initPoint=mp.init_point;if(!initPoint)return{ok:!1,status:502,message:"MP did not return init_point"};return await db.update(tenantSettingsTable).set({subscription_status:"pending",subscription_plan_id:plan.plan_id,mp_preapproval_id:mp.id,last_mp_event_at:new Date}).where(eq(tenantSettingsTable.tenant_id,tenantId)),{ok:!0,status:200,init_point:initPoint,preapproval_id:mp.id,subscription_status:"pending"}}async function mpPut(path2,body){let r3=await fetch(`https://api.mercadopago.com${path2}`,{method:"PUT",headers:{Authorization:`Bearer ${MP_ACCESS_TOKEN}`,"Content-Type":"application/json"},body:JSON.stringify(body)}),json2=await r3.json().catch(()=>({}));if(!r3.ok)throw console.error("[MP] PUT failed",{path:path2,status:r3.status,json:json2}),Error(`MP PUT ${path2} failed (${r3.status}): ${JSON.stringify(json2)}`);return json2}async function cancelSubscriptionForTenant(tenantId){let[ts]=await db.select({subscription_status:tenantSettingsTable.subscription_status,mp_preapproval_id:tenantSettingsTable.mp_preapproval_id}).from(tenantSettingsTable).where(eq(tenantSettingsTable.tenant_id,tenantId)).limit(1),preapprovalId=ts?.mp_preapproval_id;if(!preapprovalId)return{ok:!1,status:404,message:"No hay suscripci\xF3n asociada a este tenant."};let mpUpdated;try{mpUpdated=await mpPut(`/preapproval/${preapprovalId}`,{status:"cancelled"})}catch(e){return{ok:!1,status:502,message:e?.message??"MercadoPago error"}}let mpTruth=await mpGetRaw(`/preapproval/${preapprovalId}`),mpStatus=mpTruth?.json?.status??mpUpdated?.status??null,nextPaymentDate=mpTruth?.json?.next_payment_date??null;return await db.update(tenantSettingsTable).set({subscription_status:"canceled",current_period_end:nextPaymentDate?new Date(nextPaymentDate):null,last_mp_event_at:new Date}).where(eq(tenantSettingsTable.tenant_id,tenantId)),{ok:!0,status:200,mp_preapproval_id:preapprovalId,mp_status:mpStatus}}var DEFAULT_PLAN_KEY="pro",billingController=new Elysia({prefix:"/billing"}).get("/status",protectedController(async(ctx)=>{return{ok:!0,...await getBillingStatus(ctx.tenantId)}}),{detail:{summary:"Billing status",tags:["billing"]}}).post("/subscription",protectedController(async(ctx)=>{let planKey=ctx.body?.planKey??DEFAULT_PLAN_KEY,cardTokenId=ctx.body.cardTokenId,backUrl=process.env.APP_BILLING_RETURN_URL??"http://localhost:4321/dashboard/billing?mp=return",result2=await createSubscriptionForTenant(ctx.tenantId,ctx.user.email,planKey,backUrl,cardTokenId);if(!result2.ok)return ctx.set.status=result2.status,{ok:!1,message:result2.message};return{ok:!0,preapproval_id:result2.preapproval_id,init_point:result2.init_point}}),{body:t.Object({planKey:t.Optional(t.String({minLength:1,maxLength:64})),cardTokenId:t.String({minLength:10})}),detail:{summary:"Create MP subscription (card token)",tags:["billing"]}}).post("/cancel",protectedController(async(ctx)=>{let role=ctx.roleInTenant;if(role!=="owner"&&role!=="admin")return ctx.set.status=403,{ok:!1,message:"No autorizado para cancelar la suscripci\xF3n."};let result2=await cancelSubscriptionForTenant(ctx.tenantId);if(!result2.ok)return ctx.set.status=result2.status,{ok:!1,message:result2.message};return result2}),{detail:{summary:"Cancel MP subscription",tags:["billing"]}});var port=Number(process.env.PORT??3000),app=new Elysia({prefix:"/api"}).use(cors({origin:[process.env.PUBLIC_FRONTEND_URL].filter(Boolean)})).get("/",()=>{return{message:"app"}}).get("/health",()=>({status:"ok"})).use(authController).use(clientController).use(technicianController).use(phoneController).use(repairController).use(expenseController).use(providerController).use(saleController).use(sellerController).use(accessoryController).use(userController).use(tenantController).use(uploadsController).use(currencyController).use(mpWebhookController).use(billingController).listen({hostname:"0.0.0.0",port});console.log(`\uD83E\uDD8A Elysia is running in http://${app.server?.hostname}:${app.server?.port}`);var devPreset=new Elysia().onError(({error,code})=>{if(code==="NOT_FOUND")return{error:code};console.error(error)}).use(swagger({path:"/swagger"})).use(app),api=devPreset;export{api};
